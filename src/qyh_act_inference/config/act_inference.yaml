# ACT 推理配置文件
# 用于 act_inference_node

# ==================== 模型配置 ====================
model_path: ""                           # 模型文件路径 (policy.pt)
normalization_path: ""                   # normalization 参数路径
device: "cuda"                           # cuda 或 cpu

# ==================== 控制参数 ====================
observation_horizon: 10                  # N - 历史帧数
action_horizon: 20                       # K - 预测未来步数
action_steps: 3                          # M - 每次执行几步

# ==================== 频率配置 ====================
control_frequency: 20.0                  # 控制频率 (Hz)
inference_frequency: 10.0                # 推理频率 (Hz)

# ==================== 动作缩放与平滑（关键调参项！） ====================
# 初始部署建议从保守值开始，稳定后逐步提高
# 调参策略：
#   极保守: action_scale=0.2, smoothing_alpha=0.5, max_joint_delta=0.03
#   保守:   action_scale=0.3, smoothing_alpha=0.4, max_joint_delta=0.04
#   正常:   action_scale=0.4, smoothing_alpha=0.3, max_joint_delta=0.05
action_scale: 0.25                       # 动作缩放 (0.2-1.0) - 首次测试用25%幅度
smoothing_alpha: 0.5                     # 平滑系数 (0.2-0.5) - 强平滑，70%旧动作+30%新预测

# ==================== 安全限制 ====================
max_joint_velocity: 1.0                  # 最大关节速度 (rad/s) - 驱动层限制，ACT层未使用
max_joint_delta: 0.03                    # 单步最大变化 (rad) - 硬限制≈1.7°/步，防止突变
gripper_threshold: 0.6                   # 夹爪阈值
gripper_hysteresis: 0.1                  # 夹爪滞后

# ==================== 使用的设备 ====================
use_left_arm: false
use_right_arm: true
use_left_gripper: false
use_right_gripper: true
use_head_camera: true
use_wrist_cameras: false
use_depth: true                              # 使用深度图像

# ==================== 动作类型 ====================
action_type: "absolute"                      # 跟训练配置保持一致！

# ==================== 话题配置 ====================
# 输入话题 - 关节状态
left_arm_state_topic: "/left_arm/joint_states"
right_arm_state_topic: "/right_arm/joint_states"

# 输入话题 - 相机 (与 action.yaml 中 collection.cameras 保持一致)
head_camera_topic: "/head_camera/color/image_raw"
head_camera_depth_topic: "/head_camera/depth/image_raw"
left_wrist_camera_topic: "/left_camera/color/image_raw"
right_wrist_camera_topic: "/right_camera/color/image_raw"

# 输入话题 - 夹爪状态 (与 action.yaml 中 collection.grippers 保持一致)
left_gripper_state_topic: "/left/gripper_state"
right_gripper_state_topic: "/right/gripper_state"

# 输出话题 - 机械臂 servo_j 命令 (Float64MultiArray, 7 joints)
left_arm_servo_j_topic: "/teleop/left/servo_j"
right_arm_servo_j_topic: "/teleop/right/servo_j"

# 输出服务 - 夹爪控制
left_gripper_service: "/left/move_gripper"
right_gripper_service: "/right/move_gripper"

# ==================== 调试 ====================
verbose: true                            # 开启详细日志，观察执行情况
visualize: false


# # 阶段1（当前）：极保守 - 速度约25%
# action_scale: 0.25
# smoothing_alpha: 0.5
# max_joint_delta: 0.03

# # 阶段2：保守 - 速度约40%  
# action_scale: 0.3
# smoothing_alpha: 0.4
# max_joint_delta: 0.04

# # 阶段3：正常 - 速度约70%
# action_scale: 0.4
# smoothing_alpha: 0.3
# max_joint_delta: 0.05