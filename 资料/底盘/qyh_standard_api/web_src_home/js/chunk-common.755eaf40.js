(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"0103":function(t,e,i){"use strict";i("e46e")},"0337":function(t,e,i){"use strict";i.r(e);i("7d54");var a=i("b5ae"),s=i("dde5"),n=i("bf4c"),o=i("32e0"),r=i("de9c"),l={name:"AccountEditPage",components:{MessageDialog:i("d5bc").a,PinCodeInput:n.a,HeaderItem:o.a,ChoiceButtons:r.a},data(){return{opened:!1,account:null,isSetPassword:!0,isSetPinCode:!0,isEditAccount:!0,isDefaultAccount:!1,loading:!1,isPassword:!0,permission:"10",password:"123456",reinputPassword:"123456",username:"",lstMissions:[],userMissionIds:[],authorityOptions:[{label:this.$t("label.executor"),value:"5"},{label:this.$t("label.normal"),value:"10"},{label:this.$t("label.admin"),value:"20"}]}},validations:{username:{required:a.required,alphaNum:a.alphaNum,maxLength:Object(a.maxLength)(30)},password:{required:a.required,alphaNum:a.alphaNum,maxLength:Object(a.maxLength)(8)},reinputPassword:{required:a.required,alphaNum:a.alphaNum,maxLength:Object(a.maxLength)(8)}},created:function(){},mounted:async function(){},computed:{},watch:{permission:function(t,e){parseInt(t)<20?this.setTaskState(this.userMissionIds,this.lstMissions):this.setAllTaskState(!0)}},methods:{async doEdtiAccount(t){this.account=t,this.isSetPassword=this.account.id<=0,this.isSetPinCode=this.account.id<=0,this.isEditAccount=this.account.id>0,this.isDefaultAccount=this.account.id>0&&this.account.id<=3||Object(s.M)(parseInt(this.account.permission)),this.permission=this.account.permission,this.password=this.account.passwd.length>6?this.account.passwd.substr(0,6):this.account.passwd,this.reinputPassword=this.password,this.username=this.account.username,this.opened=!0,await this.loadMissionList(),this.fetchUserAvailableTask(this.account.id)},async fetchUserAvailableTask(t=0){if(t<1)return;this.userMissionIds=[];const{state:e=!0,data:i=[]}=await Object(s.o)(this.account.id);e&&(i.forEach(t=>{this.userMissionIds.push(t.id)}),this.setTaskState(this.userMissionIds,this.lstMissions))},setTaskState:function(t,e){this.setAllTaskState(!1),t.forEach(t=>{for(let i=0;i<e.length;i++)e[i].id===t&&(e[i].available=!0)})},setAllTaskState:function(t){this.lstMissions.forEach(e=>{e.available=t})},resetPassword:function(t){t&&(this.password="",this.reinputPassword="")},resetPinCode:function(t){},availableTaskIds:function(){let t=[];return this.lstMissions.forEach(e=>{!0===e.available&&t.push(e.id)}),t},async loadMissionList(){const{state:t=!0,data:e=[]}=await Object(s.o)(0);t&&(this.lstMissions=[],e.forEach(t=>{this.lstMissions.push({id:t.id,name:t.name,available:!1})}))},async commitAccount(){if(this.$v.$touch(),this.$v.username.$error)return this.$notify({message:this.$t("text.invalidAccountName"),timeout:3e3,type:"negative",position:"top"}),!1;if(this.isSetPassword&&this.$v.password.$error)return this.password.length>8?(this.$notify({message:this.$t("text.passwordTooLong"),timeout:3e3,type:"negative",position:"top"}),!1):(this.$notify({message:this.$t("text.illegalPassword"),timeout:3e3,type:"negative",position:"top"}),!1);if(this.isSetPassword&&this.password!==this.reinputPassword)return this.$notify({message:this.$t("text.passwordNotSame"),timeout:3e3,type:"negative",position:"top"}),!1;if(this.isSetPinCode&&this.isUserPermission()&&!this.$refs.inputPinCode.checkInput())return this.$notify({message:this.$t("text.illegalPincode"),timeout:3e3,type:"negative",position:"top"}),!1;let t=this.account;if(this.isUserPermission()&&this.isSetPinCode){let e=this.$refs.inputPinCode.getInput();t.pincode=""+e.pin1+e.pin2+e.pin3+e.pin4}if(this.isSetPinCode&&this.isUserPermission()){let e=await Object(s.n)("pincode",t.pincode);if(null!==e&&t.id!==e.id)return await this.$refs.messageDlg.doShowMessage({title:this.$t("label.setPincode"),message:this.$t("text.pincodeHasExisted",{pincode:t.pincode})}),!1}else t.pincode="";return t.permission=this.permission,t.mission_ids=this.availableTaskIds(),t.username=this.username,this.isSetPassword||(this.password=""),t.passwd=this.password,this.$emit("commit",t),!0},isUserPermission(){return Object(s.N)(parseInt(this.permission))},onCancel:function(){this.opened=!1},onCommit:async function(){await this.commitAccount()&&(this.opened=!1)}}},c=(i("31e1"),i("2877")),d=i("24e8"),h=i("f09f"),u=i("eb85"),p=i("2c91"),m=i("27f9"),f=i("9564"),g=i("0016"),_=i("9f0a"),y=i("1c1c"),v=i("66e5"),b=i("4074"),E=i("0170"),A=i("8f8e"),w=i("74f7"),S=i("d9b2"),C=i("9c40"),I=i("eebe"),x=i.n(I),T=Object(c.a)(l,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},on:{"escape-key":t.onCancel},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticStyle:{width:"560px"}},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.isEditAccount?t.$t("label.editAccount"):t.$t("button.add")+t.$t("label.account")},on:{close:t.onCancel}})],1),e("div",{staticClass:"q-mx-md q-mt-md"},[e("div",{staticClass:"full-width"},[e("div",{staticClass:"text_small_light_grey"},[t._v(t._s(t.$t("label.basicInfo")))]),e("q-separator",{staticClass:"q-mt-sm"}),e("div",{staticClass:"row q-mt-md"},[e("div",{staticClass:"text_main_grey_style q-mt-sm"},[t._v(t._s(t.$t("label.account")))]),e("q-space"),e("q-input",{staticClass:"input_style",attrs:{outlined:"",dense:"",placeholder:t.$t("text.inputAccount"),disable:t.isEditAccount,error:t.$v.username.$error},on:{blur:t.$v.username.$touch},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}})],1),t.isEditAccount?e("div",{staticClass:"row"},[e("div",{staticClass:"text_main_grey_style"},[t._v(t._s(t.$t("button.resetPassword")))]),e("q-space"),e("q-toggle",{on:{input:t.resetPassword},model:{value:t.isSetPassword,callback:function(e){t.isSetPassword=e},expression:"isSetPassword"}})],1):t._e(),!t.isEditAccount||t.isSetPassword?e("div",{staticClass:"row"},[e("div",{staticClass:"text_main_grey_style q-mt-sm"},[t._v(t._s(t.$t("label.password")))]),e("q-space"),e("q-input",{staticClass:"input_style",attrs:{outlined:"",dense:"",placeholder:t.$t("text.setPassword"),type:t.isPassword?"password":"text",disable:!t.isSetPassword,error:t.$v.password.$error},on:{blur:t.$v.password.$touch},scopedSlots:t._u([{key:"append",fn:function(){return[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:t.isPassword?"visibility_off":"visibility"},on:{click:function(e){t.isPassword=!t.isPassword}}})]},proxy:!0}],null,!1,1009450914),model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1):t._e(),!t.isEditAccount||t.isSetPassword?e("div",{staticClass:"row"},[e("div",{staticClass:"text_main_grey_style q-mt-sm"},[t._v("\n            "+t._s(t.$t("label.reinput")+t.$t("label.password"))+"\n          ")]),e("q-space"),e("q-input",{staticClass:"input_style",attrs:{outlined:"",dense:"",placeholder:t.$t("text.setPassword"),type:t.isPassword?"password":"text",disable:!t.isSetPassword,error:t.$v.reinputPassword.$error},on:{blur:t.$v.reinputPassword.$touch},scopedSlots:t._u([{key:"append",fn:function(){return[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:t.isPassword?"visibility_off":"visibility"},on:{click:function(e){t.isPassword=!t.isPassword}}})]},proxy:!0}],null,!1,1009450914),model:{value:t.reinputPassword,callback:function(e){t.reinputPassword=e},expression:"reinputPassword"}})],1):t._e(),t.isEditAccount&&t.isUserPermission()?e("div",{staticClass:"row"},[e("div",{staticClass:"text_main_grey_style"},[t._v(t._s(t.$t("button.resetPincode")))]),e("q-space"),e("q-toggle",{on:{input:t.resetPinCode},model:{value:t.isSetPinCode,callback:function(e){t.isSetPinCode=e},expression:"isSetPinCode"}})],1):t._e(),t.isEditAccount&&!t.isSetPinCode||!t.isUserPermission()?t._e():e("div",{staticClass:"row q-mt-sm"},[e("div",{staticClass:"text_main_grey_style q-mt-sm"},[t._v(t._s(t.$t("label.pincode")))]),e("q-space"),e("pin-code-input",{ref:"inputPinCode",staticClass:"input_style",attrs:{editable:t.isSetPinCode}})],1)],1),e("div",{staticClass:"full-width"},[e("div",{staticClass:"text_small_light_grey"},[t._v(t._s(t.$t("label.account")+t.$t("label.authority")))]),e("q-separator",{staticClass:"q-mt-sm"}),e("q-option-group",{staticClass:"float-right text_main_grey_style q-mx-md",attrs:{disable:t.isDefaultAccount,options:t.authorityOptions,color:"primary",inline:""},model:{value:t.permission,callback:function(e){t.permission=e},expression:"permission"}})],1),e("div",{staticClass:"q-mt-lg"},[e("div",{staticClass:"text_small_light_grey"},[t._v(t._s(t.$t("label.availableMission")))]),e("q-separator",{staticClass:"q-mt-sm"}),e("q-list",{staticClass:"q-mt-sm scroll",staticStyle:{"max-height":"340px"},attrs:{"no-border":"",dense:""}},t._l(t.lstMissions,function(i){return e("q-item",{key:i.id,attrs:{clickable:""}},[e("q-item-section",[e("q-item-label",{staticClass:"text_main_grey_style"},[t._v("\n                "+t._s(i.name)+"\n              ")])],1),e("q-item-section",{attrs:{side:""}},[e("q-checkbox",{attrs:{disable:parseInt(t.permission)>=20},model:{value:i.available,callback:function(e){t.$set(i,"available",e)},expression:"task.available"}})],1)],1)}),1)],1)]),e("div",{staticClass:"float-right q-ma-md"},[e("choice-buttons",{on:{okay:t.onCommit,cancel:t.onCancel}})],1)]),e("message-dialog",{ref:"messageDlg"}),e("q-inner-loading",{attrs:{showing:t.loading}},[e("q-spinner-ios",{attrs:{size:"50px",color:"primary"}})],1)],1)},[],!1,null,"14b43132",null);e.default=T.exports;x()(T,"components",{QDialog:d.a,QCard:h.a,QSeparator:u.a,QSpace:p.a,QInput:m.a,QToggle:f.a,QIcon:g.a,QOptionGroup:_.a,QList:y.a,QItem:v.a,QItemSection:b.a,QItemLabel:E.a,QCheckbox:A.a,QInnerLoading:w.a,QSpinnerIos:S.a,QBtn:C.a})},"03a3":function(t,e,i){"use strict";i("910d");var a=i("f226"),s=i("b5ae"),n=i("fca8"),o=i("de9c"),r=i("32e0"),l=i("c02f"),c={name:"ExcuteActionTaskModal",components:{HeaderItem:r.a,ChoiceButtons:o.a},data:()=>({opened:!1,actionType:0,actionId:0,actionParam0:0,actionParam1:0,actionOptions:[],allActionList:[],isActionIdFixed:!1,isParam0Fixed:!1,isParam1Fixed:!1,actionDesc:""}),validations:{actionId:{required:s.required,minValue:Object(s.minValue)(1)},actionParam0:{required:s.required},actionParam1:{required:s.required}},methods:{async accept(){if(this.$v.$touch(),this.$v.$error)this.$notify({message:this.$t("text.inputParams"),timeout:3e3,type:"negative",position:"top"});else if(Object(l.e)()){try{await a.d.excuteActionTask(this.actionId,this.actionParam0,this.actionParam1),this.$notify({message:this.$t("text.sendSucceed"),timeout:3e3,type:"positive",position:"top"})}catch(t){this.$notify({message:this.$t("text.sendFailed")+t.message,timeout:3e3,type:"negative",position:"top"})}this.opened=!1}},reject(){this.opened=!1},filterFn(t,e){e(""!==t?()=>{const e=t.toLowerCase();this.actionOptions=this.allActionList.filter(t=>t.label.toLowerCase().indexOf(e)>-1),1===this.actionOptions.length&&(this.actionType=this.actionOptions[0].value)}:()=>{this.actionOptions=this.allActionList})},initActionTypes(){this.allActionList=[];let t=Object(n.e)();for(let e in t)this.allActionList.push({label:t[e].name,value:parseInt(e)});this.actionOptions=this.allActionList},setActionParams(t){let e=Object(n.e)();if(t>=e.length)return;let i=e[t];this.actionDesc=i.desc,isNaN(i.id)?(this.isActionIdFixed=!1,this.actionId=0):(this.isActionIdFixed=!0,this.actionId=parseInt(i.id)),isNaN(i.param0)?(this.isParam0Fixed=!1,this.actionParam0=0):(this.isParam0Fixed=!0,this.actionParam0=parseInt(i.param0)),isNaN(i.param1)?(this.isParam1Fixed=!1,this.actionParam1=0):(this.isParam1Fixed=!0,this.actionParam1=parseInt(i.param1))}},watch:{opened(t,e){t&&this.initActionTypes()},actionType(t,e){this.setActionParams(t)}}},d=i("2877"),h=i("24e8"),u=i("f09f"),p=i("eb85"),m=i("ddd8"),f=i("27f9"),g=i("eebe"),_=i.n(g),y=Object(d.a)(c,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},on:{"escape-key":t.reject},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"dialog_small_style"},[e("div",{staticClass:"q-ma-md"},[e("header-item",{attrs:{title:t.$t("label.executeAction")},on:{close:t.reject}}),e("div",{staticClass:"text_small_light_grey q-mt-md"},[t._v(t._s(t.$t("text.chooseAction")))]),e("q-separator",{staticClass:"background_grey q-my-sm"}),e("div",{staticClass:"q-mt-md"},[e("q-select",{attrs:{outlined:"",dense:"",autofocus:"","use-input":"","hide-selected":"","fill-input":"","emit-value":"","map-options":"",options:t.actionOptions},on:{filter:t.filterFn},model:{value:t.actionType,callback:function(e){t.actionType=e},expression:"actionType"}}),e("div",{staticClass:"text_small_light_grey q-mt-md"},[t._v(t._s(t.$t("label.actionParams")))]),e("q-separator",{staticClass:"background_grey q-my-sm"}),e("div",{staticClass:"row q-mt-md"},[e("div",{staticClass:"col-4 q-mt-sm text_main_grey_style"},[t._v(t._s(t.$t("label.actionId")))]),e("q-input",{staticClass:"col-8",attrs:{dense:"",outlined:"",type:"number",disable:t.isActionIdFixed,"input-class":"text_main_light_grey",error:t.$v.actionId.$error},on:{blur:t.$v.actionId.$touch},model:{value:t.actionId,callback:function(e){t.actionId=t._n(e)},expression:"actionId"}})],1),e("div",{staticClass:"row q-my-sm"},[e("div",{staticClass:"col-4 q-mt-sm text_main_grey_style"},[t._v(t._s(t.$t("label.actionParam0")))]),e("q-input",{staticClass:"col-8",attrs:{dense:"",outlined:"",type:"number",disable:t.isParam0Fixed,"input-class":"text_main_light_grey",error:t.$v.actionParam0.$error},on:{blur:t.$v.actionParam0.$touch},model:{value:t.actionParam0,callback:function(e){t.actionParam0=t._n(e)},expression:"actionParam0"}})],1),e("div",{staticClass:"row"},[e("div",{staticClass:"col-4 q-mt-sm text_main_grey_style"},[t._v(t._s(t.$t("label.actionParam1")))]),e("q-input",{staticClass:"col-8",attrs:{dense:"",outlined:"",type:"number",disable:t.isParam1Fixed,"input-class":"text_main_light_grey",error:t.$v.actionParam1.$error},on:{blur:t.$v.actionParam1.$touch},model:{value:t.actionParam1,callback:function(e){t.actionParam1=t._n(e)},expression:"actionParam1"}})],1),e("div",{staticClass:"q-my-md text_main_grey_style"},[t._v(t._s(t.actionDesc))]),e("div",{staticClass:"row flex justify-center q-my-lg full-width"},[e("div",{},[e("choice-buttons",{attrs:{"enable-okay":!0},on:{okay:t.accept,cancel:t.reject}})],1)])],1)],1)])],1)},[],!1,null,"2b17cec3",null);e.a=y.exports;_()(y,"components",{QDialog:h.a,QCard:u.a,QSeparator:p.a,QSelect:m.a,QInput:f.a})},"03ed":function(t,e,i){"use strict";i("ab43");var a=i("2b0e"),s=i("eb85"),n=i("dde5"),o=i("8847"),r={__name:"DeviceHealth",props:{showFunctionActiveTip:{type:Boolean,default:!1}},setup(t){const e=Object(a.inject)("showMessage"),i=Object(a.ref)(!1),r=Object(a.ref)(!1),l=Object(a.ref)({page:1,rowsPerPage:10,total:0}),c=Object(a.ref)([]),d=async()=>{i.value=!0,c.value=(await Object(n.u)()).map(t=>({...t,check_prompt:t.check_prompt.replace(/\\n/g,"\n")})),i.value=!1},h=Object(a.ref)([{name:"device_name",label:o.b.t("label.module"),field:"device_name",align:"center"},{name:"health_indicator",label:o.b.t("label.project"),field:"health_indicator",align:"center"},{name:"current_value",label:o.b.t("label.totalUnit"),field:"current_value",align:"center"},{name:"remaining_life_percentage",label:o.b.t("label.remainingLife"),field:"remaining_life_percentage",align:"center"},{name:"health_level",label:o.b.t("label.health"),field:"health_level",align:"center"},{name:"check_frequency",label:o.b.t("label.checkFrequency"),field:"check_frequency",align:"center"},{name:"next_check_time",label:o.b.t("label.nextCheckDate"),field:"next_check_time",align:"center"},{name:"check_prompt",label:o.b.t("label.notice"),field:"check_prompt",align:"center"}]);return Object(a.onMounted)(async()=>{const{value:t}=await Object(n.s)("function.system.device_health","0");r.value="1"===t,r.value&&await d()}),{__sfc:!0,showMessage:e,loading:i,enableDeviceHealth:r,pagination:l,deviceHealths:c,getDeviceHealths:d,columns:h,handleCheckPrompt:async function(t={}){await e({title:o.b.t("label.notice"),message:t.check_prompt,chooseButton:!0})&&await Object(n.S)({device_id:t.device_id,is_checked:1})},getHealthLevelBgColor:(t=0)=>({1:"light-green-3",2:"amber-3",3:"deep-orange-3"}[t]),getHealthLevelColor:(t=0)=>({1:"green-5",2:"amber-5",3:"red-5"}[t]),getHealthLevelIcon:(t=0)=>({1:"check_circle",2:"info",3:"cancel"}[t]),QSeparator:s.a}}},l=(i("d6b9"),i("2877")),c=i("eaac"),d=i("db86"),h=i("0016"),u=i("9c40"),p=i("eebe"),m=i.n(p),f=Object(l.a)(r,function(){var t=this,e=t._self._c,i=t._self._setupProxy;return i.enableDeviceHealth?e("div",{staticClass:"q-ma-sm q-pa-md background_white"},[e("div",{staticClass:"text_small_light_grey q-mb-sm"},[t._v(t._s(t.$t("label.componentHealth")))]),e(i.QSeparator,{staticClass:"text_small_light_grey q-my-sm"}),e("q-table",{staticClass:"no-border no-shadow text_main_grey_style",attrs:{data:i.deviceHealths,columns:i.columns,"row-key":"id",pagination:i.pagination,loading:i.loading,"no-data-label":t.$q.lang.table.noData},on:{request:i.getDeviceHealths},scopedSlots:t._u([{key:"body-cell-remaining_life_percentage",fn:function(a){return[e("q-td",{staticClass:"q-my-md w150px",attrs:{props:a}},[e("div",{staticClass:"full-width h20px b-1-gray text-center relative-position"},[e("div",{class:`absolute full-height bg-${i.getHealthLevelBgColor(a.row.health_level)}`,style:{width:100*a.row.remaining_life_percentage+"%"}}),e("div",{staticClass:"absolute full-height full-width"},[t._v("\n            "+t._s((100*a.row.remaining_life_percentage).toFixed(2))+"%\n          ")])])])]}},{key:"body-cell-health_level",fn:function(t){return[e("q-td",{attrs:{props:t}},[e("q-icon",{attrs:{size:"sm",name:i.getHealthLevelIcon(t.row.health_level),color:i.getHealthLevelColor(t.row.health_level)}})],1)]}},{key:"body-cell-check_prompt",fn:function(a){return[e("q-td",{attrs:{props:a}},[a.row.check_prompt?e("q-btn",{attrs:{dense:"",size:"sm",icon:"info",unelevated:"",color:i.getHealthLevelColor(a.row.health_level)},on:{click:function(t){return i.handleCheckPrompt(a.row)}}}):t._e()],1)]}}],null,!1,333924167)})],1):t.showFunctionActiveTip?e("div",[e("p",[t._v(t._s(t.$t("text.featuresToBeReleased")))])]):t._e()},[],!1,null,"ef0de63c",null);e.a=f.exports;m()(f,"components",{QSeparator:s.a,QTable:c.a,QTd:d.a,QIcon:h.a,QBtn:u.a})},"08c8":function(t,e,i){"use strict";var a={name:"ProgressDialog",components:{HeaderItem:i("32e0").a},data:()=>({title:"",opened:!1}),props:{progress:Number},watch:{progress(t,e){}},methods:{showProgress(t){this.title=t,this.opened=!0},hideProgress(){this.opened=!1}}},s=i("2877"),n=i("24e8"),o=i("f09f"),r=i("6b1d"),l=i("eebe"),c=i.n(l),d=Object(s.a)(a,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},on:{"escape-key":t.hideProgress},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"popup_style"},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.title},on:{close:t.hideProgress}}),e("div",{staticClass:"text_main_grey_style q-mt-lg text-center"},[t._v(t._s(t.progress)+"%")]),e("q-linear-progress",{staticClass:"q-mb-xl q-mt-sm",staticStyle:{width:"290px",height:"14px"},attrs:{value:t.progress/100,stripe:"",rounded:"","show-value":"",indeterminate:!1,query:!1,color:"primay"}})],1)])],1)},[],!1,null,"bee3f146",null);e.a=d.exports;c()(d,"components",{QDialog:n.a,QCard:o.a,QLinearProgress:r.a})},"09c3":function(t,e,i){"use strict";var a=i("de9c"),s=i("32e0"),n=i("e4ef"),o={name:"EdgeGroupEditor",components:{AddProperty:i("13ad").a,HeaderItem:s.a,ChoiceButtons:a.a},data(){return{opened:!1,model:null,userDefineProperties:[],selectedProperty:[],pagination:{rowsPerPage:30},typeOptions:[{label:this.$t("label.singleVehicle"),value:"SINGLE_VEHICLE_ONLY"},{label:this.$t("label.singleDirection"),value:"SAME_DIRECTION_ONLY"}],columns:[{name:"name",label:this.$t("label.name"),field:"name",required:!0,align:"center",sortable:!1},{name:"value",label:this.$t("label.value"),field:"value",required:!0,align:"center",sortable:!1}],callbackReject:null,callbackResolve:null}},props:{edgeGroups:Array},computed:{title(){let t=this.$t("button.edit");return this.isAddGroup&&(t=this.$t("button.create")),t+this.$t("label.edgeGroup")},isAddGroup(){return null!=this.model&&this.model.id<=0}},watch:{opened(t,e){if(t){let t=this.model.user_define_properties;this.userDefineProperties=[];for(let e in t)this.userDefineProperties.push({name:e,value:t[e]});document.addEventListener("keydown",this.onKeyDown)}else document.removeEventListener("keydown",this.onKeyDown)}},mounted(){},methods:{doEditEdgeGroup(t){return this.model=t,this.opened=!0,new Promise((t,e)=>{this.callbackResolve=t,this.callbackReject=e})},onClosed:function(){!0!==this.$refs.addPropertyDlg.opened&&(this.callbackReject&&this.callbackReject("cancel"),this.opened=!1)},onKeyDown(t){"s"===t.key&&t.ctrlKey&&(t.stopPropagation(),t.preventDefault(),this.onSaved())},onSaved:function(){if(!0===this.$refs.addPropertyDlg.opened)return;if(this.model.name=this.model.name.trim(),!Object(n.C)(this.model.name,this.$t("label.edgeGroup")))return;if(this.isAddGroup&&this.hasExist(this.model.name))return void this.$notify({message:this.$t("text.specifyNameHasExist"),timeout:3e3,type:"negative",position:"top"});let t={};for(let e of Array.from(this.userDefineProperties))t[e.name]=e.value;this.model.user_define_properties=t,this.callbackResolve&&this.callbackResolve(this.model),this.opened=!1},hasExist(t){for(let e of Array.from(this.edgeGroups))if(e.label===t)return!0;return!1},getProperty(t){for(let e of Array.from(this.userDefineProperties))if(e.name===t)return e;return null},onAddProperty(t){let e=t.name;null===this.getProperty(e)?this.doAddProperty(t):this.$notify({message:this.$t("text.userDefinedPropertyHasExist",{name:e}),timeout:3e3,type:"warning",position:"top"})},doAddProperty(t){this.userDefineProperties.push(t)},onAddUserDefinedProperty(){this.$refs.addPropertyDlg.model={name:"",value:""},this.$refs.addPropertyDlg.opened=!0},onDeleteProperty(){for(let t of Array.from(this.selectedProperty))this.doDeleteProperty(t.name);this.selectedProperty=[]},doDeleteProperty(t){let e=-1;for(let i=0;i<this.userDefineProperties.length;i++)if(t===this.userDefineProperties[i].name){e=i;break}e>=0&&this.userDefineProperties.splice(e,1)}}},r=(i("c405"),i("2877")),l=i("24e8"),c=i("f09f"),d=i("1c1c"),h=i("66e5"),u=i("4074"),p=i("27f9"),m=i("9f0a"),f=i("eaac"),g=i("9c40"),_=i("eebe"),y=i.n(_),v=Object(r.a)(o,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},on:{"escape-key":t.onClosed},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"default_dialog_style"},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.title},on:{close:t.onClosed}}),null!=t.model?e("div",[e("q-list",{attrs:{"no-border":""}},[t.isAddGroup?t._e():e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_small_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                  "+t._s(t.$t("label.groupId"))+"\n                ")]),e("q-input",{staticClass:"col-sm-8 col-md-8 col-lg-8",attrs:{outlined:"",dense:"",type:"number",disable:""},model:{value:t.model.id,callback:function(e){t.$set(t.model,"id",t._n(e))},expression:"model.id"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_small_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                  "+t._s(t.$t("label.groupName"))+"\n                ")]),e("q-input",{staticClass:"col-sm-8 col-md-8 col-lg-8",attrs:{outlined:"",dense:"",type:"text"},model:{value:t.model.name,callback:function(e){t.$set(t.model,"name",e)},expression:"model.name"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_small_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                  "+t._s(t.$t("label.type"))+"\n                ")]),e("q-option-group",{staticClass:"input_style text_main_grey_style col-sm-8 col-md-8 col-lg-8",attrs:{color:"primary",type:"checkbox",options:t.typeOptions},model:{value:t.model.types,callback:function(e){t.$set(t.model,"types",e)},expression:"model.types"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_small_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                  "+t._s(t.$t("label.remark"))+"\n                ")]),e("q-input",{staticClass:"col-sm-8 col-md-8 col-lg-8",staticStyle:{"max-height":"64px"},attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"textarea"},model:{value:t.model.desc,callback:function(e){t.$set(t.model,"desc",e)},expression:"model.desc"}})],1)])],1),e("q-item",[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-4"},[t._v("\n                "+t._s(t.$t("label.userDefinedProperty"))+"\n              ")]),e("div",{staticClass:"col-6"},[e("q-table",{staticClass:"no-shadow q-mt-md border_passive_style",staticStyle:{width:"280px"},attrs:{dense:"","hide-bottom":"",columns:t.columns,data:t.userDefineProperties,"row-key":"name",color:"primary",separator:"cell","table-class":"no-scroll text_main_grey_style",pagination:t.pagination,selection:"multiple",selected:t.selectedProperty},on:{"update:pagination":function(e){t.pagination=e},"update:selected":function(e){t.selectedProperty=e}}}),e("div",{staticClass:"flex justify-end q-mt-md"},[e("q-btn",{staticClass:"no-shadow q-ml-lg q-mt-md",staticStyle:{height:"32px"},attrs:{outline:"",unelevated:"","no-caps":"",label:t.$t("button.newAdd"),color:"primary",size:"sm"},on:{click:t.onAddUserDefinedProperty}}),e("q-btn",{staticClass:"background_red no-shadow q-ml-lg q-mt-md text_main_white_style",staticStyle:{height:"32px"},attrs:{"no-caps":"",unelevated:"",label:t.$t("button.delete"),size:"sm",disable:t.selectedProperty.length<=0},on:{click:t.onDeleteProperty}})],1)],1)])])],1)],1):t._e(),e("choice-buttons",{staticClass:"q-mt-md q-mb-md",attrs:{"enable-okay":!0},on:{okay:t.onSaved,cancel:t.onClosed}})],1)]),e("add-property",{ref:"addPropertyDlg",on:{add:t.onAddProperty}})],1)},[],!1,null,"143e7c78",null);e.a=v.exports;y()(v,"components",{QDialog:l.a,QCard:c.a,QList:d.a,QItem:h.a,QItemSection:u.a,QInput:p.a,QOptionGroup:m.a,QTable:f.a,QBtn:g.a})},1144:function(t,e,i){},1278:function(t,e,i){"use strict";i("5d33")},"13ad":function(t,e,i){"use strict";var a=i("32e0"),s={name:"AddProperty",components:{ChoiceButtons:i("de9c").a,HeaderItem:a.a},data:()=>({opened:!1,model:null}),methods:{onClosed(){this.opened=!1},onSaved(){""!==this.model.name&&""!==this.model.value&&(this.opened=!1,this.$emit("add",this.model))}}},n=i("2877"),o=i("24e8"),r=i("f09f"),l=i("1c1c"),c=i("66e5"),d=i("4074"),h=i("27f9"),u=i("eebe"),p=i.n(u),m=Object(n.a)(s,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"popup_style"},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.$t("button.newAdd")},on:{close:t.onClosed}})],1),null!=t.model?e("div",[e("q-list",{staticClass:"q-mt-xs",attrs:{"no-border":""}},[e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.name"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"","input-class":"text-right"},model:{value:t.model.name,callback:function(e){t.$set(t.model,"name","string"==typeof e?e.trim():e)},expression:"model.name"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.value"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"","input-class":"text-right"},model:{value:t.model.value,callback:function(e){t.$set(t.model,"value","string"==typeof e?e.trim():e)},expression:"model.value"}})],1)])],1)],1),e("div",{staticClass:"q-my-md q-mr-md float-right"},[e("ChoiceButtons",{attrs:{"label-okay":t.$t("button.save")},on:{okay:t.onSaved,cancel:t.onClosed}})],1)],1):t._e()])],1)},[],!1,null,"5642f268",null);e.a=m.exports;p()(m,"components",{QDialog:o.a,QCard:r.a,QList:l.a,QItem:c.a,QItemSection:d.a,QInput:h.a})},"149c":function(t,e,i){"use strict";var a=i("b69e"),s=i("32e0"),n={name:"BarcodeEditor",components:{ChoiceButtons:i("de9c").a,HeaderItem:s.a},data:()=>({opened:!1,model:{dmcode_id:"",type:0,x:0,y:0,yaw:0},stationNames:[]}),computed:{barcodeName(){return`${this.isFLQRCode?"FLQR":"SCQR"}${this.model.dmcode_id}`},isFLQRCode(){return this.model.type===a.e.QRCODE_TYPE_FUSE_LOCATE},canEditPos(){return this.isFLQRCode},angle:{get(){return Object(a.h)(this.model.yaw)},set(t){this.model.yaw=Object(a.b)(t)}},stationNamesText(){return this.stationNames.join(", ")}},methods:{init(t,e){this.model=t,this.stationNames=e,this.opened=!0},onClosed:function(){this.opened=!1},onSaved:function(){this.$emit("updateModel",this.model),this.onClosed()}}},o=i("2877"),r=i("24e8"),l=i("f09f"),c=i("1c1c"),d=i("66e5"),h=i("4074"),u=i("27f9"),p=i("eebe"),m=i.n(p),f=Object(o.a)(n,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticStyle:{width:"480px"}},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.$t("label.editBarcode")},on:{close:t.onClosed}})],1),e("div",[e("q-list",{staticClass:"q-mt-xs scroll",staticStyle:{"max-height":"600px"},attrs:{"no-no-border":""}},[e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.barcode")+t.$t("label.name"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",disable:"","input-class":"text-right"},model:{value:t.barcodeName,callback:function(e){t.barcodeName=e},expression:"barcodeName"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.barcode")+"id")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",disable:"","input-class":"text-right"},model:{value:t.model.dmcode_id,callback:function(e){t.$set(t.model,"dmcode_id",e)},expression:"model.dmcode_id"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.coordinate")+"x(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",disable:!t.canEditPos,type:"number","input-class":"text-right"},model:{value:t.model.x,callback:function(e){t.$set(t.model,"x",t._n(e))},expression:"model.x"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.coordinate")+"y(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",disable:!t.canEditPos,"input-class":"text-right"},model:{value:t.model.y,callback:function(e){t.$set(t.model,"y",t._n(e))},expression:"model.y"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.angle")+"(Â°)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",disable:!t.canEditPos,"input-class":"text-right"},model:{value:t.angle,callback:function(e){t.angle=t._n(e)},expression:"angle"}})],1)])],1),t.canEditPos?t._e():e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.associate",{name:t.$t("label.station")}))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",disable:!t.canEditPos,"input-class":"text-right"},model:{value:t.stationNamesText,callback:function(e){t.stationNamesText=e},expression:"stationNamesText"}})],1)])],1)],1),t.canEditPos?e("div",{staticClass:"q-my-md q-mr-md float-right"},[e("choice-buttons",{attrs:{"label-okay":t.$t("button.save")},on:{okay:t.onSaved,cancel:t.onClosed}})],1):t._e()],1)])],1)},[],!1,null,"de22d8be",null);e.a=f.exports;m()(f,"components",{QDialog:r.a,QCard:l.a,QList:c.a,QItem:d.a,QItemSection:h.a,QInput:u.a})},"14a3":function(t,e,i){},"14b2":function(t,e,i){"use strict";i("910d"),i("f665"),i("7d54");var a=i("2f62"),s=i("b69e"),n=i("6825"),o=i("d5bc"),r=i("8163");const l={TAB_BUTTON:"tabButton",TAB_LIST:"tabList"},c=1,d=2,h=3,u=4,p=5,m=6,f=7,g=4001,_=4002,y=4003,v=5001;var b={name:"EditMapToolBar",components:{ContextMenu:n.a,MessageDialog:o.a,SystemStatus:r.a},props:{curAction:Number,displayMap:String,stations:Array,nodes:Array,tags:Array,edges:Array,areas:Array,locationAreas:Array,noteAreas:Array,pgvs:Array,edgeGroups:Array},computed:{...Object(a.f)(["isMapRedraw"]),...Object(a.d)(["isLanguageZh"]),...Object(a.f)("srp",["redrawInfo"]),...Object(a.d)("srp",["displayedMapNameIsEqualSrosCurMapName","isLockedByOthers","hasRunningState"]),isEditTab(){return this.curTab===l.TAB_BUTTON},isShowDrawRedrawArea(){return this.isMapRedraw&&[2,5].includes(this.redrawInfo.redrawInfoType)},actionList(){return[{id:1,label:this.$t("label.drawPosSelection"),hideRule:this.isMapRedraw,children:[{id:s.e.ACTION_SET_SELECTION,label:this.$t("button.selectArea")+"(space)",passiveIcon:"std_select_grey",activeIcon:"std_select_blue",hideRule:this.isMapRedraw,isActive:!1},{id:s.e.ACTION_SET_TAG,label:this.$t("button.drawTag")+"(shift+t)",passiveIcon:"std_add_tag_grey",activeIcon:"std_add_tag_blue",hideRule:this.isMapRedraw,isActive:!1},{id:s.e.ACTION_SET_STATION,label:this.$t("button.drawStation")+"(s)",passiveIcon:"std_add_station_grey",activeIcon:"std_add_station_blue",hideRule:this.isMapRedraw,isActive:!1},{id:s.e.ACTION_SET_NODE,label:this.$t("button.drawNode")+"(n)",passiveIcon:"std_add_node_grey",activeIcon:"std_add_node_blue",hideRule:this.isMapRedraw,isActive:!1},{id:s.e.ACTION_SET_BARCODE,label:this.$t("button.recordBarcode")+"(q)",passiveIcon:"std_add_barcode_grey",activeIcon:"std_add_barcode_blue",hideRule:this.isMapRedraw,isActive:!1},{id:s.e.ACTION_SET_STATION_AND_FEATURE_BINDING,label:this.$t("label.stationBindingFeatures"),passiveIcon:"std_feature_plus_gray",activeIcon:"std_feature_plus_blue",hideRule:this.isMapRedraw,isActive:!1}]},{id:2,label:this.$t("label.drawEdgeArea"),hideRule:this.isMapRedraw,children:[{id:s.e.ACTION_SET_LINE,label:this.$t("button.drawLine")+"(l)",passiveIcon:"std_add_line_grey",activeIcon:"std_add_line_blue",isActive:!1},{id:s.e.ACTION_SET_BEZIER,label:this.$t("button.drawBezier")+"(b)",passiveIcon:"std_add_bezier_grey",activeIcon:"std_add_bezier_blue",isActive:!1},{id:s.e.ACTION_SET_ROUND_CORNER,label:this.$t("button.drawBezierCorner")+"(f)",passiveIcon:"std_add_corner_grey",activeIcon:"std_add_corner_blue",isActive:!1},{id:s.e.ACTION_SET_AREA,label:this.$t("button.drawFuncArea")+"(r)",passiveIcon:"std_add_area_grey",activeIcon:"std_add_area_blue",isActive:!1},{id:s.e.ACTION_SET_NOTE_AREA,label:this.$t("button.drawData",{name:this.$t("label.noteArea")}),icon:"mdi-comment-text-outline",hideRule:this.isMapRedraw,isActive:!1}]},{id:4,label:this.$t("label.others"),hideRule:this.isMapRedraw,children:[{id:y,label:this.$t("label.settings")+""+(this.isLanguageZh?"":" ")+this.$t("label.wareroomStationArea"),passiveIcon:"std_wareroom_config_gray",activeIcon:"std_wareroom_config_blue",isActive:!1},{id:s.e.ACTION_SET_CLEAN_AREA,label:this.$t("button.cleanObstacle")+"(c)",passiveIcon:"std_eraser_grey",activeIcon:"std_eraser_blue",isActive:!1},{id:s.e.ACTION_SET_UNCLEAN_AREA,label:this.$t("button.cancelCleanObstacle")+"(shift+c)",passiveIcon:"std_cancel_eraser_grey",activeIcon:"std_cancel_eraser_blue",isActive:!1},{id:g,label:this.$t("button.undo")+"(ctrl+z)",passiveIcon:"std_map_undo_gray",activeIcon:"std_map_undo_blue",isActive:!1},{id:_,label:this.$t("button.redo")+"(ctrl+y)",passiveIcon:"std_map_redo_gray",activeIcon:"std_map_redo_blue",isActive:!1},{id:v,label:this.$t("button.keyboardShortcuts"),passiveIcon:"std_hotkey_icon_gray",activeIcon:"std_hotkey_icon_blue",isActive:!1}]},{id:5,label:"",hideRule:!this.isShowDrawRedrawArea,children:[{id:s.e.ACTION_SET_REDRAW_AREA,label:this.$t("button.drawRedrawArea"),passiveIcon:"std_add_redraw_area_grey",activeIcon:"std_add_redraw_area_blue",isActive:!1,hideRule:!this.isShowDrawRedrawArea}]}]},isNotCanMapSave(){return this.isLockedByOthers||this.displayedMapNameIsEqualSrosCurMapName&&this.hasRunningState}},watch:{edgeGroups(t,e){const i=e.find(t=>t.isExpand);if(i){const e=t.find(t=>t.groupId===i.groupId);e&&(e.isExpand=!0)}const a=this.getMapItemListInfo(s.e.KEY_EDGE_GROUP);a&&(a.children=t)}},data(){return{searchModel:"",contextMenuOpened:!1,tabs:l,curTab:l.TAB_BUTTON,keyboardShortcutList:Object.freeze([{title:this.$t("label.move")+this.$t("label.mapPage"),description:this.$t("text.moveMapMode")},{title:this.$t("button.zoomOut")+" / "+this.$t("button.zoomIn")+this.$t("label.mapPage")+"(ctrl+Mouse Wheel)",description:""},{title:this.$t("button.selectArea")+"(space)",description:""},{title:this.$t("text.moveSelectedMapElementUp")+"(up)",description:""},{title:this.$t("text.moveSelectedMapElementDown")+"(down)",description:""},{title:this.$t("text.moveSelectedMapElementLeft")+"(left)",description:""},{title:this.$t("text.moveSelectedMapElementRight")+"(right)",description:""},{title:this.$t("text.setCoordinateBatch",{axisType:"X"})+"(shift+x)",description:""},{title:this.$t("text.setCoordinateBatch",{axisType:"Y"})+"(shift+y)",description:""},{title:this.$t("label.setOffset")+this.$t("label.coordinateOffset",{type:"x,y"})+"/cm(shift+m)",description:""},{title:this.$t("button.delete")+"(delete / backspace)",description:""},{title:`${this.$t("button.cancel")+this.$t("button.edit")}(escape)`,description:""},{title:`${this.$t("button.save")+this.$t("button.edit")}(enter)`,description:""},{title:this.$t("label.saveMap")+"(ctrl+s)",description:""},{title:this.$t("button.drawTag")+"(shift+t)",description:""},{title:this.$t("button.drawStation")+"(s)",description:""},{title:this.$t("button.drawNode")+"(n)",description:""},{title:this.$t("button.recordBarcode")+"(q)",description:""},{title:this.$t("button.drawLine")+"(l)",description:""},{title:this.$t("button.drawStraightExtensionLine")+"(t)",description:""},{title:this.$t("button.drawBezier")+"(b)",description:""},{title:this.$t("button.drawBezierCorner")+"(f)",description:""},{title:this.$t("button.drawFuncArea")+"(r)",description:""},{title:this.$t("button.cleanObstacle")+"(c)",description:""},{title:this.$t("button.cancelCleanObstacle")+"(shift+c)",description:""},{title:this.$t("button.copy")+"(ctrl+c)",description:`${this.$t("label.funcRegion")}, ${this.$t("label.noteArea")}[${this.$t("label.mapEdit")}(${this.$t("label.forward")})]`},{title:this.$t("button.paste")+"(ctrl+v)",description:`${this.$t("label.funcRegion")}, ${this.$t("label.noteArea")}[${this.$t("label.mapEdit")}(${this.$t("label.forward")})]`},{title:this.$t("button.undo")+"(ctrl+z)",description:""},{title:this.$t("button.redo")+"(ctrl+y)",description:""}]),mapItemList:[{id:s.e.KEY_STATIONS,type:s.e.KEY_STATIONS,label:this.$t("label.station"),passiveIcon:"std_station_grey",activeIcon:"std_station_blue",isActive:!1,isExpand:!1,children:this.stations},{id:s.e.KEY_EDGES,type:s.e.KEY_EDGES,label:this.$t("label.edge"),passiveIcon:"std_edge_grey",activeIcon:"std_edge_blue",isActive:!1,isExpand:!1,children:this.edges},{id:s.e.KEY_NODES,type:s.e.KEY_NODES,label:this.$t("label.node"),passiveIcon:"std_node_grey",activeIcon:"std_node_blue",isActive:!1,isExpand:!1,children:this.nodes},{id:s.e.KEY_AREAS,type:s.e.KEY_AREAS,label:this.$t("label.funcRegion"),passiveIcon:"std_area_grey",activeIcon:"std_area_blue",isActive:!1,isExpand:!1,children:this.areas},{id:s.e.KEY_MAP_NOTE_AREA_STATE,type:s.e.KEY_MAP_NOTE_AREA_STATE,label:this.$t("label.noteArea"),icon:"mdi-comment-text-outline",isActive:!1,isExpand:!1,children:this.noteAreas},{id:s.e.KEY_PGVS,type:s.e.KEY_PGVS,label:this.$t("label.barcode"),passiveIcon:"std_barcode_grey",activeIcon:"std_barcode_blue",isActive:!1,isExpand:!1,children:this.pgvs},{id:s.e.KEY_TAGS,type:s.e.KEY_TAGS,label:this.$t("label.tag"),passiveIcon:"std_tag_grey",activeIcon:"std_tag_blue",isActive:!1,isExpand:!1,children:this.tags},{id:s.e.KEY_EDGE_GROUP,type:s.e.KEY_EDGE_GROUP,label:this.$t("label.edgeGroup"),passiveIcon:"std_edge_grey",activeIcon:"std_edge_blue",isActive:!1,isExpand:!1,children:this.edgeGroups}]}},inject:["doAsk"],methods:{onClickedSave(){this.isNotCanMapSave?this.$notify({message:this.$t("text.forbiddenSaveMapTip"),type:"negative",timeout:3e3,position:"bottom"}):this.$emit("saveMap",!0)},async onClickExit(){if(this.isNotCanMapSave){this.$notify({message:this.$t("text.forbiddenSaveMapTip"),type:"negative",timeout:3e3,position:"bottom"});if(!await this.doAsk({title:this.$t("label.notice"),question:this.$t("text.askExitMapEdit"),labelCancel:this.$t("label.no"),labelOkay:this.$t("label.yes")}))return}this.$emit("exitEdit",!0)},async onButtonClicked(t){switch(t){case v:try{await this.$refs.messageDlg.doShowMessage({title:this.$t("button.keyboardShortcuts"),texts:this.keyboardShortcutList})}catch(t){}break;case g:this.$emit("executeHistory","undo");break;case _:this.$emit("executeHistory","redo");break;case y:this.$emit("editWareroomAreaAndWareroomRegion");break;default:this.$emit("doAction",t)}},async onMapItemClicked(t,e={},i=1){if(0===t.button){if(null!==e){if(!e.isExpand)if(1===i)this.mapItemList.forEach(t=>{t.isExpand&&t!==e&&(t.isExpand=!1,t.type===s.e.KEY_EDGE_GROUP&&t.children.forEach(t=>{t.isExpand&&(t.isExpand=!1)}))});else if(2===i){const t=this.getMapItemListInfo(s.e.KEY_EDGE_GROUP);null==t||t.children.forEach(t=>{t.isExpand&&t!==e&&(t.isExpand=!1)})}e.isExpand=!e.isExpand}1!==i&&this.$emit("clickItem",e)}else 2===t.button&&(this.contextMenuOpened=!0,this.$nextTick(async()=>{await this.openContextMenu(e)}))},onMapItemDBClick(t,e){this.$emit("dblClickItem",e)},async openContextMenu(t){let e=[],i=t=>{e.push({id:t.id,isActive:!1,name:t.name})};switch(t.type){case s.e.KEY_TAGS:this.tags.length>0&&(i({id:h,name:this.$t("label.toNodes")}),i({id:p,name:this.$t("label.toStations")}));break;case s.e.MODEL_TYPE_EDGE_GROUP:i({id:m,name:this.$t("button.edit")});break;case s.e.MODEL_TYPE_TAG:i({id:d,name:this.$t("label.toNode")}),i({id:u,name:this.$t("label.toStation")});break;case s.e.MODEL_TYPE_EDGE:this.isEdgeOfGroup(t)&&i({id:f,name:this.$t("button.removeFromGroup")})}!this.isEdgeOfGroup(t)&&(void 0===t.children||t.children.length>0)&&i({id:c,name:this.$t("button.delete")});let a=null;try{a=await this.$refs.ctxMenuRoot.openContextMenu(e),this.contextMenuOpened=!1}catch(t){return void(this.contextMenuOpened=!1)}null!=a&&this.doMenuAction(t,a)},doMenuAction(t,e){switch(e.id){case c:if(this.isEdgeOfGroup(t))break;this.deleteItem(t);break;case f:this.removeEdgeFromGroup(t);break;case m:t.type===s.e.MODEL_TYPE_EDGE_GROUP&&this.$emit("edit",t);break;case p:t.type===s.e.KEY_TAGS&&this.$emit("tag2station",-1);break;case u:t.type===s.e.MODEL_TYPE_TAG&&this.$emit("tag2station",t.id);break;case h:t.type===s.e.KEY_TAGS&&this.$emit("tag2node",-1);break;case d:t.type===s.e.MODEL_TYPE_TAG&&this.$emit("tag2node",t.id)}},removeEdgeFromGroup(t){if(this.isEdgeOfGroup(t)){let e={};e.type=t.type,e.id=t.id,e.groupId=t.groupId,this.$emit("deleteItem",e)}},deleteItem(t){let e={};switch(t.type){case s.e.KEY_STATIONS:e.type=s.e.MODEL_TYPE_STATION,e.id=-1;break;case s.e.KEY_NODES:e.type=s.e.MODEL_TYPE_NODE,e.id=-1;break;case s.e.KEY_TAGS:e.type=s.e.MODEL_TYPE_TAG,e.id=-1;break;case s.e.KEY_PGVS:e.type=s.e.MODEL_TYPE_BARCODE,e.id=-1;break;case s.e.KEY_EDGES:e.type=s.e.MODEL_TYPE_EDGE,e.id=-1;break;case s.e.KEY_AREAS:e.type=s.e.MODEL_TYPE_FUNC_AREA,e.id=-1;break;case s.e.KEY_MAP_LOCATION_AREA_STATE:e.type=s.e.MODEL_TYPE_LOCATION_AREA,e.id=-1;break;case s.e.KEY_MAP_NOTE_AREA_STATE:e.type=s.e.MODEL_TYPE_NOTE_AREA,e.id=-1;break;case s.e.KEY_EDGE_GROUP:e.type=s.e.MODEL_TYPE_EDGE_GROUP,e.id=-1;break;default:e.type=t.type,e.id=t.id}this.$emit("deleteItem",e)},isEdgeGroup:t=>t.type===s.e.MODEL_TYPE_EDGE_GROUP,isEdgeOfGroup:t=>!!t.hasOwnProperty("groupId")&&t.groupId>0,isTagRoot:t=>t.id===s.e.KEY_TAGS,isTagItem:t=>t.type===s.e.MODEL_TYPE_TAG,getMapItemListInfo(t){return this.mapItemList.find(e=>e.type===t)}}},E=(i("a03c"),i("2877")),A=i("0016"),w=i("9c40"),S=i("05c0"),C=i("429b"),I=i("7460"),x=i("adad"),T=i("823b"),M=i("1c1c"),P=i("0170"),O=i("66e5"),L=i("4074"),R=i("eb85"),D=i("2c91"),N=i("a12b"),k=i("eebe"),F=i.n(k),$=Object(E.a)(b,function(){var t=this,e=t._self._c;return e("div",{staticClass:"background_white z-top box-tool-bar"},[e("div",{staticClass:"q-ml-md q-mt-md"},[e("q-icon",{staticClass:"std_map_icon_grey icon_size_16",attrs:{name:"img:xx"}}),e("label",{staticClass:"text_main_grey_style text-bold q-ml-md"},[t._v(t._s(t.displayMap))])],1),t.isMapRedraw?t._e():e("div",{staticClass:"flex justify-between q-mt-md q-px-md"},[e("q-btn",{staticClass:"background_blue no-shadow",staticStyle:{width:"45%",height:"28px"},attrs:{unelevated:"","no-caps":"",disable:t.isNotCanMapSave},on:{click:t.onClickedSave}},[e("q-icon",{staticClass:"std_save_white q-mb-xs"}),e("div",{staticClass:"text_small_white_style q-ml-sm q-mb-xs"},[t._v(t._s(t.$t("button.save")))])],1),e("q-btn",{staticClass:"background_red no-shadow",staticStyle:{"min-width":"112px",height:"28px"},attrs:{unelevated:"","no-caps":""},nativeOn:{click:function(e){return t.onClickExit.apply(null,arguments)}}},[e("q-icon",{staticClass:"std_exit_white q-mb-xs exit-icon"}),e("div",{staticClass:"text_small_white_style q-ml-sm q-mb-xs"},[t._v(t._s(t.$t("button.finishEditMap")))]),t.isNotCanMapSave?e("q-tooltip",[t._v(t._s(t.$t("text.forbiddenSaveMapTip")))]):t._e()],1)],1),e("q-tabs",{staticClass:"q-mt-md",attrs:{dense:"","no-caps":"","inline-label":"","indicator-color":"primary","active-bg-color":""},model:{value:t.curTab,callback:function(e){t.curTab=e},expression:"curTab"}},[e("q-tab",{attrs:{name:t.tabs.TAB_BUTTON}},[e("q-icon",{class:t.isEditTab?"std_pen_blue":"std_pen_grey"}),e("div",{class:"q-ml-sm "+(t.isEditTab?"text_main_blue_style":"text_main_grey_style")},[t._v("\n        "+t._s(t.$t("button.edit"))+"\n      ")])],1),e("q-tab",{attrs:{name:t.tabs.TAB_LIST}},[e("q-icon",{class:t.isEditTab?"std_list_grey":"std_list_blue"}),e("div",{class:"q-ml-sm "+(t.isEditTab?"text_main_grey_style":"text_main_blue_style")},[t._v("\n        "+t._s(t.$t("label.list"))+"\n      ")])],1)],1),e("div",{staticClass:"box-panels"},[e("q-tab-panels",{attrs:{animated:""},model:{value:t.curTab,callback:function(e){t.curTab=e},expression:"curTab"}},[e("q-tab-panel",{staticClass:"q-pa-none",attrs:{name:t.tabs.TAB_BUTTON}},[e("q-list",{staticClass:"scroll q-mt-sm",attrs:{dense:""}},[t._l(t.actionList.filter(t=>!t.hideRule),function(i){return[e("q-item-label",{key:`header-${i.label}`,staticClass:"text_small_light_grey",attrs:{header:""}},[t._v(t._s(i.label))]),t._l(i.children.filter(t=>!t.hideRule),function(i){return e("q-item",{key:i.label,attrs:{clickable:""},on:{mouseover:function(t){i.isActive=!0},mouseout:function(t){i.isActive=!1},click:function(e){return t.onButtonClicked(i.id)}}},[e("q-item-section",[e("div",{staticClass:"row"},[i.icon?e("q-icon",{staticClass:"q-mr-sm",attrs:{name:i.icon,size:"22px",color:i.isActive||t.curAction===i.id?"primary":"grey"}}):e("q-icon",{staticClass:"q-mr-sm",class:"icon_size_22 "+(i.isActive||t.curAction===i.id?i.activeIcon:i.passiveIcon)}),e("div",{class:"q-ml-sm "+(i.isActive||t.curAction===i.id?"text_main_blue_style":"text_main_grey_style")},[t._v("\n                    "+t._s(i.label)+"\n                  ")])],1)])],1)})]})],2)],1),e("q-tab-panel",{staticClass:"q-pa-none",attrs:{name:t.tabs.TAB_LIST}},[e("q-list",{staticClass:"scroll q-mt-md",attrs:{dense:""}},[t._l(t.mapItemList,function(i){return[e("q-item",{key:`header-${i.label}`,attrs:{clickable:""},nativeOn:{mousedown:function(e){return t.onMapItemClicked(e,i,1)}}},[e("q-item-section",[e("div",[e("div",{staticClass:"row"},[i.icon?e("q-icon",{staticClass:"q-mr-sm",attrs:{name:i.icon,size:"16px",color:i.isActive||i===i.id?"primary":"grey"}}):e("q-icon",{staticClass:"q-mr-sm",class:"icon_size_16 "+(i.isActive?i.activeIcon:i.passiveIcon)}),e("q-item-label",{staticClass:"text_small_light_grey"},[t._v(t._s(i.label))]),e("q-space"),i.children.length>0?e("q-icon",{staticClass:"float-right",class:i.isExpand?"std_collapse":"std_expand",staticStyle:{width:"10px",height:"6px"}}):t._e()],1),e("q-separator",{staticClass:"text_small_light_grey q-ml-md q-mt-sm"})],1)])],1),i.isExpand&&i.children.length?[e("q-virtual-scroll",{staticStyle:{"max-height":"540px"},attrs:{items:i.children},scopedSlots:t._u([{key:"default",fn:function({item:i}){return[e("q-item",{key:i.key,attrs:{clickable:"",dense:""},on:{mouseover:function(t){i.isActive=!0},mouseout:function(t){i.isActive=!1}},nativeOn:{mousedown:function(e){return t.onMapItemClicked(e,i,2)},dblclick:function(e){return t.onMapItemDBClick(e,i)}}},[e("q-item-section",[e("div",{staticClass:"row q-ml-sm"},[e("div",{class:"q-ml-sm "+(i.isActive?"text_main_blue_style":"text_main_grey_style")},[t._v("\n                          "+t._s(i.label)+"\n                        ")]),e("q-space"),t.isEdgeGroup(i)?e("q-icon",{staticClass:"float-right",class:i.isExpand?"std_collapse":"std_expand",staticStyle:{width:"10px",height:"6px"}}):t._e()],1)])],1),t.isEdgeGroup(i)&&i.isExpand&&i.edges.length?t._l(i.edges,function(a){return e("q-item",{key:`${i.key}-${a.key}`,staticClass:"q-ml-lg",attrs:{dense:"",clickable:""},on:{mouseover:function(t){a.isActive=!0},mouseout:function(t){a.isActive=!1}},nativeOn:{mousedown:function(e){return t.onMapItemClicked(e,a,3)},dblclick:function(e){return t.onMapItemDBClick(e,a)}}},[e("q-item-section",[e("div",{class:"q-ml-sm "+(a.isActive?"text_main_blue_style":"text_main_grey_style")},[t._v("\n                          "+t._s(a.label)+"\n                        ")])])],1)}):t._e()]}}],null,!0)})]:t._e()]})],2)],1)],1)],1),e("div",{staticClass:"q-mt-lg q-pb-xl"},[e("system-status",{attrs:{"is-can-toggle-map":!1}})],1),t.contextMenuOpened?e("context-menu",{ref:"ctxMenuRoot"}):t._e(),e("message-dialog",{ref:"messageDlg"})],1)},[],!1,null,"273eca97",null);e.a=$.exports;F()($,"components",{QIcon:A.a,QBtn:w.a,QTooltip:S.a,QTabs:C.a,QTab:I.a,QTabPanels:x.a,QTabPanel:T.a,QList:M.a,QItemLabel:P.a,QItem:O.a,QItemSection:L.a,QSeparator:R.a,QSpace:D.a,QVirtualScroll:N.a})},1859:function(t,e,i){"use strict";i("38c4")},"1d79":function(t,e,i){"use strict";i.d(e,"a",function(){return n});i("f665"),i("7d54");var a=i("73cf"),s=i("b965");class n extends s.n{constructor(t,e){super(t,e),this.vehicleBody=null,this.deviceSensorList=[],this.forkliftArms=[],this.liftingBoard=null,this.obaPointInfoListGroup=null}async renderVehicleBody(t="",e=!0){var i;if(null===(i=this.vehicleBody)||void 0===i||i.mesh.removeFromParent(),!e)return;const s=this.findChassisValueByKey("chassis.body.vehicle_length"),n=this.findChassisValueByKey("chassis.body.vehicle_width"),o=this.findChassisValueByKey("chassis.body.vehicle_height");this.vehicleBody=new a.d({url:`${t}/api/v0/file/get?file=/sros/web/ui-server/static/source/robot/model/vehicle.glb`,dracoLoaderPath:"/statics/draco/",width:s,height:n,depth:o}),this.vehicleBody.mesh=await this.vehicleBody.render(),this.addMeshes([this.vehicleBody.mesh])}setVehicleBodyVisible(t=!0){this.vehicleBody&&(this.vehicleBody.mesh.visible=t)}initDeviceSensorList(){const t=[],e=[];this.device_info.forEach(i=>{const{device_id:a,device_type:n}=i;n===s.j.LIDAR?e.push({device_id:a,color:"",instance:null}):n===s.j.CAMERA&&t.push({device_id:a,color:"",mesh:null})});const i=s.h.length;e.forEach((t,e)=>{t.color=s.h[e%i]});const a=s.b.length;t.forEach((t,e)=>{t.color=s.b[e%a]}),this.deviceSensorList=[...e,...t]}setDeviceSensorVisible(t={}){const{key:e,visible:i}=t,a=this.deviceSensorList.find(({device_id:t})=>t===e);if(a&&!(i&&a.instance||!i&&!a.instance))if(i){const t=this.device_info.find(({device_id:t})=>t===e);if(!t)return;t.device_type===s.j.LIDAR?a.instance=this.renderLidar(t,a.color):t.device_type===s.j.CAMERA&&(a.instance=this.renderCamera(t,a.color))}else a.instance.mesh.removeFromParent(),a.instance=null}renderLidar(t={},e=s.h[0]){const{"device.install_x":i,"device.install_y":a,"device.install_z":n,"device.install_pitch":o,"device.install_roll":r,"device.install_yaw":l,"lidar.scan_angle_min":c,"lidar.scan_angle_max":d,device_id:h}=t,u={radius:s.i,aStartAngle:c,aEndAngle:d,color:e,opacity:.5},p=Object(s.D)(u,[Object(s.y)(i),Object(s.y)(a),Object(s.y)(n)]);return p.setRotation(o,r,l),this.deviceSensorList.push({device_id:h,deviceSensor:p}),this.addMeshes([p.mesh]),p}renderCamera(t={},e=s.b[0]){const{"device.install_x":i,"device.install_y":a,"device.install_z":n,"device.install_pitch":o,"device.install_roll":r,"device.install_yaw":l,"camera.driver.horizontal_fov":c,"camera.driver.vertical_fov":d,device_id:h}=t,u={radius:s.c,horizontal_fov:c,vertical_fov:d,color:e,opacity:.5},p=Object(s.E)(u,[Object(s.y)(i),Object(s.y)(a),Object(s.y)(n)]);return p.setRotation(r,l,o),this.deviceSensorList.push({device_id:h,deviceSensor:p}),this.addMeshes([p.mesh]),p}renderForkliftArms(t=!0){if(this.forkliftArms.forEach(t=>t.mesh.removeFromParent()),this.forkliftArms=[],!t)return;const e=this.findChassisValueByKey("chassis.fork_arm.arm_length"),i=this.findChassisValueByKey("chassis.fork_arm.arm_width"),a=this.findChassisValueByKey("chassis.fork_arm.arm_height"),n={width:-e,height:i,depth:a,color:"rgb(66, 66, 66)",opacity:.6},o=this.findChassisValueByKey("chassis.fork_arm.out_outline_width")/2-i/2,r=s.d-a/2,l=Object(s.z)(n,this.vehicleBodyBox,"-x"),c=Object(s.z)(n,this.vehicleBodyBox,"-x");l.setPosition(l.getPosition().x,-o,r),c.setPosition(c.getPosition().x,o,r),this.forkliftArms.push(l,c),this.addMeshes([l.mesh,c.mesh])}renderLiftingBoard(t=!0,e=0){var i;if(null===(i=this.liftingBoard)||void 0===i||i.mesh.removeFromParent(),this.liftingBoard=null,!t)return;const a={width:this.liftingBoardLengthByInfo,height:this.liftingBoardWidthByInfo,depth:this.liftingBoardHeightByInfo+e,color:"rgb(255, 87, 34)",opacity:.7};this.liftingBoard=Object(s.z)(a,this.vehicleBodyBox,"z"),this.addMeshes([this.liftingBoard.mesh])}renderObaPointeInfoList(t,e=[]){var i;if(null===(i=this.obaPointInfoListGroup)||void 0===i||i.clear(),0===e.length)return;this.obaPointInfoListGroup||(this.obaPointInfoListGroup=t.addGroup());const a=new Map;e.forEach(t=>{const{obaClassName:e,obaFeaturePoints:i}=t;i.forEach(t=>{const{sensorUuid:i,obaPoints:n}=t;n.forEach(t=>{const{level:n,pose:o}=t,{x:r,y:l,z:c,pitch:d,roll:h,yaw:u}=o;a.has(n)||a.set(n,[]),a.get(n).push({obaClassName:e,sensorUuid:i,pose:{x:Object(s.y)(r),y:Object(s.y)(l),z:Object(s.y)(c),pitch:d,roll:h,yaw:u}})})})});const n=[];a.forEach((t,e)=>{const i=Object(s.B)({data:t,type:s.k.OBA_POINT,shape:{radius:.02,color:s.m[e]}});n.push(i.mesh)}),this.obaPointInfoListGroup.add(...n)}removeObaPointInfo(){var t;null===(t=this.obaPointInfoListGroup)||void 0===t||t.removeFromParent()}get liftingBoardLengthByInfo(){return this.findChassisValueByKey("chassis.lifting_board.vehicle_length")}get liftingBoardWidthByInfo(){return this.findChassisValueByKey("chassis.lifting_board.vehicle_width")}get liftingBoardHeightByInfo(){return this.findChassisValueByKey("chassis.lifting_board.vehicle_height")}get obstacleDetectMinHeightByInfo(){return this.findObaInfoValueByKey("obstacle.detect_min_height")}get obstacleDetectMaxHeightByInfo(){return this.findObaInfoValueByKey("obstacle.detect_max_height")}}},"1e4b":function(t,e,i){"use strict";i("910d"),i("f665");var a=i("de9c"),s={name:"SelectEdgeGroup",components:{HeaderItem:i("32e0").a,ChoiceButtons:a.a},data(){return{opened:!1,selectedItem:-1,edgeGroupOptions:this.options}},props:{options:{type:Array,default:()=>[]}},methods:{onClosed:function(){this.opened=!1,this.selectedItem=-1},onOkay:function(){this.$emit("selectItem",this.selectedItem),this.opened=!1,this.selectedItem=-1},setSeletedItem(t){this.edgeGroupOptions=this.options,this.selectedItem=t},filterGroups(t,e){if(""!==t){if(e(()=>{const e=t.toLowerCase();this.edgeGroupOptions=this.options.filter(t=>t.label.toLowerCase().indexOf(e)>-1)}),1===this.edgeGroupOptions.length){const t=this.edgeGroupOptions[0].value;t>=0&&(this.selectedItem=t)}}else e(()=>{this.edgeGroupOptions=this.options})},getSelectedOptLabel:function(t){var e;return(null===(e=this.edgeGroupOptions.find(e=>e.value===t))||void 0===e?void 0:e.label)||""}}},n=i("2877"),o=i("24e8"),r=i("f09f"),l=i("ddd8"),c=i("66e5"),d=i("4074"),h=i("0170"),u=i("eebe"),p=i.n(u),m=Object(n.a)(s,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},on:{"escape-key":t.onClosed},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"popup_style"},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.$t("button.addToGroup")},on:{close:t.onClosed}})],1),e("div",{staticClass:"q-mt-md q-pa-md"},[e("q-select",{attrs:{outlined:"",dense:"","emit-value":"","map-options":"",autofocus:"","use-input":"","hide-selected":"","fill-input":"",options:t.edgeGroupOptions,"display-value":t.selectedItem<=0?"":t.getSelectedOptLabel(t.selectedItem)},on:{filter:t.filterGroups},scopedSlots:t._u([{key:"option",fn:function(i){return[e("q-item",t._g(t._b({attrs:{dense:""}},"q-item",i.itemProps,!1),i.itemEvents),[e("q-item-section",[e("q-item-label",{class:i.opt.value>0?"text_main_grey_style":"text_main_blue_style"},[t._v(t._s(i.opt.label))])],1)],1)]}}]),model:{value:t.selectedItem,callback:function(e){t.selectedItem=e},expression:"selectedItem"}})],1),e("div",{staticClass:"text-center q-mt-lg q-mb-md"},[e("choice-buttons",{attrs:{"enable-okay":!0},on:{okay:t.onOkay,cancel:t.onClosed}})],1)])],1)},[],!1,null,"abe0bd3c",null);e.a=m.exports;p()(m,"components",{QDialog:o.a,QCard:r.a,QSelect:l.a,QItem:c.a,QItemSection:d.a,QItemLabel:h.a})},"206e":function(t,e,i){},"20ff":function(t,e,i){"use strict";var a={name:"ScaleItem",props:{mousePos:String,scale:Number|String},computed:{mapScale(){return(this.$debug?this.scale+" * ":"")+(70*this.scale/100).toFixed(2)+" m"}},methods:{}},s=i("2877"),n=i("9c40"),o=i("0016"),r=i("2c91"),l=i("eebe"),c=i.n(l),d=Object(s.a)(a,function(){var t=this,e=t._self._c;return e("div",{staticClass:"row group"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"80px",height:"40px"}},[e("text",{attrs:{x:"10",y:"24",fill:"#5A5D74"}},[t._v(t._s(t.mapScale))]),e("path",{attrs:{d:"M 0 30 l 0 6 l 60 0 l 0 -6",stroke:"#5A5D74","stroke-width":"2px",fill:"none"}})]),this.$q.platform.is.mobile?t._e():e("q-btn",{staticClass:"q-ma-none no-pointer-events",staticStyle:{"min-width":"160px",height:"36px",background:"#5a5d74"},attrs:{unelevated:"","no-caps":""}},[e("q-icon",{staticClass:"std_target_white"}),e("q-space"),e("span",{staticClass:"q-ml-sm text_small_white_style"},[t._v(t._s(t.mousePos))])],1)],1)},[],!1,null,"900f5d50",null);e.a=d.exports;c()(d,"components",{QBtn:n.a,QIcon:o.a,QSpace:r.a})},"26ed":function(t,e,i){},"2cd7":function(t,e,i){"use strict";i("910d");var a=i("de9c"),s={name:"SelectDialog",components:{HeaderItem:i("32e0").a,ChoiceButtons:a.a},data(){return{isMobile:this.$q.platform.is.mobile,opened:!1,showButtons:!0,selectedModel:null,title:"",desc:"",options:[],optionList:this.options,callbackReject:null,callbackResolve:null}},watch:{opened(t,e){t?(this.initSelectItem(),document.addEventListener("keydown",this.onKeyDown)):document.removeEventListener("keydown",this.onKeyDown)}},mounted(){},methods:{doSelect(t){return t.hasOwnProperty("title")?this.title=t.title:this.title="",t.hasOwnProperty("options")?(this.options=t.options,this.optionList=t.options):(this.options=[],this.optionList=[]),t.hasOwnProperty("value")&&t.value?this.selectedModel=t.value:this.selectedModel=this.options[0].value,t.hasOwnProperty("desc")?this.desc=t.desc:this.desc="",this.opened=!0,new Promise((t,e)=>{this.callbackResolve=t,this.callbackReject=e})},initSelectItem:async function(){this.optionList.length>0&&null===this.selectedModel&&(this.selectedModel=this.optionList[0].value)},filterFn(t,e){e(""!==t?()=>{const e=t.toLowerCase();this.optionList=this.options.filter(t=>t.label.toLowerCase().indexOf(e)>-1),1===this.optionList.length&&(this.selectedModel=this.optionList[0].value)}:()=>{this.optionList=this.options})},onClosed:function(t){this.opened=!1,this.callbackReject&&this.callbackReject(t)},onKeyDown(t){"s"===t.key&&t.ctrlKey&&(t.stopPropagation(),t.preventDefault(),this.onOkay())},onInput(t){},onOkay:function(){this.opened=!1,null!=this.selectedModel&&this.callbackResolve&&this.callbackResolve(this.selectedModel)}}},n=i("2877"),o=i("24e8"),r=i("f09f"),l=i("ddd8"),c=i("eebe"),d=i.n(c),h=Object(n.a)(s,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},on:{"escape-key":function(e){return t.onClosed(!1)}},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"popup_style"},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.title},on:{close:function(e){return t.onClosed(!0)}}}),""!=t.desc?e("div",{staticClass:"text_main_grey_styl q-mt-md"},[t._v(t._s(t.desc))]):t._e(),e("div",{staticClass:"no-scroll q-mt-md"},[e("q-select",{ref:"selectList",attrs:{options:t.optionList,outlined:"",dense:"","use-input":"","hide-selected":"","fill-input":"","emit-value":"","map-options":""},on:{input:t.onInput,filter:t.filterFn},model:{value:t.selectedModel,callback:function(e){t.selectedModel=e},expression:"selectedModel"}})],1),t.showButtons?e("choice-buttons",{staticClass:"q-mt-lg q-mb-md",attrs:{"enable-okay":!0},on:{okay:t.onOkay,cancel:t.onClosed}}):t._e()],1)])],1)},[],!1,null,"2cceb6b7",null);e.a=h.exports;d()(h,"components",{QDialog:o.a,QCard:r.a,QSelect:l.a})},"2d22":function(t,e,i){"use strict";i("910d");var a=i("de9c"),s=i("32e0"),n=i("b5ae"),o={name:"StationRotateEditor",components:{MessageDialog:i("d5bc").a,HeaderItem:s.a,ChoiceButtons:a.a},props:{stations:Array},data(){return{opened:!1,optionList:this.stations,degree:0,stationId:0,isSyncYaw:!1,callbackReject:null,callbackResolve:null}},validations:{degree:{required:n.required,minValue:Object(n.minValue)(0),maxValue:Object(n.maxValue)(360)}},methods:{initDat(){return this.opened=!0,this.degree=0,this.stationId=0,this.isSyncYaw=!1,this.optionList=this.stations,new Promise((t,e)=>{this.callbackResolve=t,this.callbackReject=e})},async onOkay(){this.$v.$touch(),this.$v.degree.$invalid||0===this.degree||360===this.degree||0===this.stationId?this.$notify({message:this.$t("text.inputParams"),timeout:3e3,type:"negative",position:"top"}):(this.callbackResolve&&this.callbackResolve({degree:this.degree,isSyncYaw:this.isSyncYaw,stationId:this.stationId}),this.opened=!1)},onClosed(){this.callbackReject&&this.callbackReject("cancel"),this.opened=!1},filterFn(t,e){""!==t?(e(()=>{const e=t.toLowerCase();this.optionList=this.stations.filter(t=>t.label.toLowerCase().indexOf(e)>-1)}),1===this.optionList.length&&(this.stationId=this.optionList[0].value)):e(()=>{this.optionList=this.stations})}}},r=i("2877"),l=i("24e8"),c=i("f09f"),d=i("27f9"),h=i("ddd8"),u=i("9564"),p=i("eebe"),m=i.n(p),f=Object(r.a)(o,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},on:{"escape-key":t.onClosed},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"popup_style",staticStyle:{width:"400px"}},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.$t("button.rotateSitesInBatches")},on:{close:t.onClosed}}),e("div",{staticClass:"no-scroll q-mt-md"},[e("div",{staticClass:"row q-mb-sm items-center"},[e("div",{staticClass:"text_main_grey_style col-6"},[t._v("\n            "+t._s(t.$t("label.rotationAngle"))+"\n          ")]),e("q-input",{staticClass:"col-6",attrs:{autofocus:"","hide-bottom-space":"",type:"number",outlined:"",dense:"",min:"0",max:"360",error:t.$v.degree.$error},on:{blur:t.$v.degree.$touch},model:{value:t.degree,callback:function(e){t.degree=t._n(e)},expression:"degree"}})],1),e("div",{staticClass:"row q-mb-sm items-center"},[e("div",{staticClass:"text_main_grey_style col-6"},[t._v("\n            "+t._s(t.$t("label.centerOfRotation"))+"\n          ")]),e("q-select",{staticClass:"col-6",attrs:{options:t.optionList,outlined:"",dense:"","option-value":"id","option-label":"label","emit-value":"","map-options":"","use-input":"","hide-selected":"","fill-input":""},on:{filter:t.filterFn},model:{value:t.stationId,callback:function(e){t.stationId=e},expression:"stationId"}})],1),e("div",{staticClass:"row q-mb-sm items-center"},[e("div",{staticClass:"text_main_grey_style col-6"},[t._v("\n            "+t._s(t.$t("label.isItInTheSameDirectionAsTheCenterOfRotation"))+"\n          ")]),e("q-toggle",{staticClass:"col-6",model:{value:t.isSyncYaw,callback:function(e){t.isSyncYaw=e},expression:"isSyncYaw"}})],1),e("choice-buttons",{staticClass:"q-mt-md q-mb-md",attrs:{"enable-okay":!0},on:{okay:t.onOkay,cancel:t.onClosed}})],1)],1)]),e("message-dialog",{ref:"message"})],1)},[],!1,null,null,null);e.a=f.exports;m()(f,"components",{QDialog:l.a,QCard:c.a,QInput:d.a,QSelect:h.a,QToggle:u.a})},"31e1":function(t,e,i){"use strict";i("57fd")},"32e0":function(t,e,i){"use strict";var a={name:"HeaderItem",props:{title:String},methods:{onClose(){this.$emit("close",!0)}}},s=i("2877"),n=i("0016"),o=i("eebe"),r=i.n(o),l=Object(s.a)(a,function(){var t=this,e=t._self._c;return e("div",{staticClass:"row full-width justify-between"},[e("div",{staticClass:"text_large_grey_style text-bold"},[t._v(t._s(t.title))]),e("q-icon",{staticClass:"std_close_grey",on:{click:t.onClose}})],1)},[],!1,null,"74ea8246",null);e.a=l.exports;r()(l,"components",{QIcon:n.a})},"33e4":function(t,e,i){"use strict";var a={name:"SearchItem",props:{placeholder:{type:String,default:""},searchSuffix:{type:String,default:""}},computed:{searchWidth(){return"paramConfigs"===this.$route.name?"search-width":""}},data(){return{isMobile:this.$q.platform.is.mobile,search:""}},methods:{onInput(t){this.$emit("input",t)},onNext(){this.$emit("next",!0)},onPrevious(){this.$emit("before",!0)},onSearchKeydown(t){t.stopPropagation()},onSearchKeyup(t){t.stopPropagation()}}},s=(i("f2c2"),i("2877")),n=i("27f9"),o=i("0016"),r=i("eebe"),l=i.n(r),c=Object(s.a)(a,function(){var t=this,e=t._self._c;return e("q-input",{class:t.searchWidth,staticStyle:{height:"40px"},attrs:{type:"search",debounce:"500",outlined:"",dense:"","hide-bottom-space":"",borderless:"",color:"primary","input-class":"text_main_grey_style",placeholder:t.placeholder,suffix:t.searchSuffix},on:{input:t.onInput,keydown:t.onSearchKeydown,keyup:t.onSearchKeyup},scopedSlots:t._u([{key:"prepend",fn:function(){return[e("q-icon",{staticClass:"std_search",style:t.isMobile?"margin-bottom: 6px;":""})]},proxy:!0},{key:"append",fn:function(){return[""!==t.searchSuffix?e("div",[e("q-icon",{attrs:{name:"mdi-chevron-up"},on:{click:t.onPrevious}}),e("q-icon",{attrs:{name:"mdi-chevron-down"},on:{click:t.onNext}})],1):t._e()]},proxy:!0}]),model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})},[],!1,null,"9cc0b682",null);e.a=c.exports;l()(c,"components",{QInput:n.a,QIcon:o.a})},"384c":function(t,e,i){"use strict";i("26ed")},"38c4":function(t,e,i){},"3bbf":function(t,e,i){"use strict";i("4eb5")},4394:function(t,e,i){},"45ae":function(t,e,i){"use strict";i("4918")},"482f":function(t,e,i){"use strict";var a={name:"LoadingDialog",components:{HeaderItem:i("32e0").a},data:()=>({opened:!1,title:""}),methods:{doOpen(t){this.title=t,this.opened=!0},doClose(){this.opened=!1}}},s=i("2877"),n=i("24e8"),o=i("f09f"),r=i("74f7"),l=i("d9b2"),c=i("eebe"),d=i.n(c),h=Object(s.a)(a,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{persistent:""},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"popup_style",staticStyle:{height:"136px"}},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{staticClass:"z-top",attrs:{title:t.title}})],1),e("q-inner-loading",{staticStyle:{"background-color":"rgba(255, 255, 255, 0)"},attrs:{showing:t.opened}},[e("q-spinner-ios",{attrs:{size:"32px",color:"primary"}})],1)],1)],1)},[],!1,null,"de1f24e6",null);e.a=h.exports;d()(h,"components",{QDialog:n.a,QCard:o.a,QInnerLoading:r.a,QSpinnerIos:l.a})},4918:function(t,e,i){},"4e69":function(t,e,i){"use strict";i("f665");var a=i("f2b3"),s=i("f226"),n=(i("7d54"),i("b965")),o={name:"DeviceParameterNest",data:()=>({test:!1,PARAMETER_DATA_TYPE:n.p,PARAMETER_BOOL_TYPE:n.o}),computed:{isHardWarePage(){return"hardwareState"===this.$route.name}},props:{dataParent:{type:Object,default:()=>({isGroupType:!1,children:[],name:""})},dataSource:{type:Array,default:()=>[]},canEditable:{type:Boolean,default:!0}},methods:{toggleCurrentValue(t={}){if(!t.isEditable)return;const e=t.current_value===n.o.ON;t.children.length&&t.isOpened!==e&&(t.isOpened=e),t.group_id!==n.o.OFF&&this.dataParent.children.forEach((e={})=>{t.group_id===e.group_id&&t.key!==e.key&&e.data_type===n.p.BOOL&&e.current_value===n.o.ON&&(e.isOpened=!1,e.current_value=n.o.OFF)})},openUpgradeRecordsDialog(t={}){this.$emit("openUpgradeRecordsDialog",t)}}},r=(i("e287"),i("2877")),l=i("1c1c"),c=i("66e5"),d=i("4074"),h=i("7cbe"),u=i("9c40"),p=i("05c0"),m=i("9564"),f=i("ddd8"),g=i("27f9"),_=i("eebe"),y=i.n(_),v=Object(r.a)(o,function(){var t=this,e=t._self._c;return e("q-list",[t._l(t.dataSource,function(i){return[e("q-item",{directives:[{name:"show",rawName:"v-show",value:i.show,expression:"item.show"}],key:i.key},[e("q-item-section",{class:{"q-pl-none":1===i.level,"q-pl-md":2===i.level,"q-pl-xl":3===i.level}},[i.isGroupType?e("div",{staticClass:"row items-center full-width box-group-name"},[e("strong",[t._v(" "+t._s(i.name))]),e("i",{staticClass:"divider-line"})]):[e("span",{staticClass:"cursor-pointer"},[t._v(" "+t._s(i.name))]),e("q-popup-proxy",[e("div",{staticClass:"q-pa-md bg-grey-10 text-white"},[e("q-list",{staticStyle:{width:"35vw"},attrs:{dark:"",bordered:"",dense:"",separator:""}},[e("q-item",[e("q-item-section",[t._v(t._s(t.$t("label.category")))]),e("q-item-section",[t._v(t._s(i.group_name))])],1),e("q-item",[e("q-item-section",[t._v(t._s(t.$t("label.name")))]),e("q-item-section",[t._v(t._s(i.name))])],1),e("q-item",[e("q-item-section",[t._v("key")]),e("q-item-section",[t._v(t._s(i.key))])],1),e("q-item",[e("q-item-section",[t._v(t._s(t.$t("label.defaultValue")))]),e("q-item-section",[t._v(t._s(i.default_value)+" "+t._s(i.unit))])],1),e("q-item",[e("q-item-section",[t._v(t._s(t.$t("label.type")))]),e("q-item-section",[t._v(t._s(i.data_type))])],1),e("q-item",[e("q-item-section",[t._v(t._s(t.$t("label.desc")))]),e("q-item-section",{staticClass:"white-space-pre-line"},[t._v(t._s(i.description))])],1),t.isHardWarePage?e("q-item",[e("q-item-section",[t._v(t._s(t.$t("label.others")))]),e("q-item-section",[e("div",[e("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"mdi-history"},on:{click:function(e){return t.openUpgradeRecordsDialog({device_id:"",key:i.key})}}},[e("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("\n                          "+t._s(t.$t("label.updateRecord"))+"\n                        ")])],1)],1)])],1):t._e()],1)],1)])]],2),i.isGroupType?t._e():e("q-item-section",[i.data_type===t.PARAMETER_DATA_TYPE.BOOL?e("div",[e("q-toggle",{attrs:{"false-value":t.PARAMETER_BOOL_TYPE.OFF,"true-value":t.PARAMETER_BOOL_TYPE.ON,disable:!t.canEditable||!i.isEditable},nativeOn:{click:function(e){return t.toggleCurrentValue(i)}},model:{value:i.current_value,callback:function(e){t.$set(i,"current_value",e)},expression:"item.current_value"}})],1):[t.PARAMETER_DATA_TYPE.ENUM,t.PARAMETER_DATA_TYPE.ENUM_STR].includes(i.data_type)?e("q-select",{attrs:{outlined:"",dense:"","use-input":"","hide-selected":"","fill-input":"","emit-value":"","map-options":"",options:i.selectOptions,disable:!t.canEditable||!i.isEditable},model:{value:i.current_value,callback:function(e){t.$set(i,"current_value",e)},expression:"item.current_value"}}):[t.PARAMETER_DATA_TYPE.INT,t.PARAMETER_DATA_TYPE.DOUBLE,t.PARAMETER_DATA_TYPE.FLOAT,t.PARAMETER_DATA_TYPE.HEX].includes(i.data_type)?[i.value_range?e("q-input",{staticClass:"wrapper-configure-input",attrs:{dense:"","hide-bottom-space":"",outlined:"",prefix:i.value_range,suffix:i.unit,disable:!t.canEditable||!i.isEditable},model:{value:i.current_value,callback:function(e){t.$set(i,"current_value","string"==typeof e?e.trim():e)},expression:"item.current_value"}}):e("q-input",{staticClass:"wrapper-configure-input",attrs:{dense:"","hide-bottom-space":"",outlined:"",suffix:i.unit,disable:!t.canEditable||!i.isEditable},model:{value:i.current_value,callback:function(e){t.$set(i,"current_value","string"==typeof e?e.trim():e)},expression:"item.current_value"}})]:e("q-input",{staticClass:"wrapper-configure-input",attrs:{dense:"","hide-bottom-space":"",outlined:"",suffix:i.unit,disable:!t.canEditable||!i.isEditable},model:{value:i.current_value,callback:function(e){t.$set(i,"current_value","string"==typeof e?e.trim():e)},expression:"item.current_value"}})],2)],1),i.isOpened&&i.children.length?[e("device-parameter-nest",{attrs:{"can-editable":t.canEditable,"data-source":i.children,"data-parent":i},on:{openUpgradeRecordsDialog:t.openUpgradeRecordsDialog}})]:t._e()]})],2)},[],!1,null,"21997ec6",null),b=v.exports;y()(v,"components",{QList:l.a,QItem:c.a,QItemSection:d.a,QPopupProxy:h.a,QBtn:u.a,QTooltip:p.a,QToggle:m.a,QSelect:f.a,QInput:g.a});var E=i("a39b");var A={name:"DeviceInfo",components:{DeviceParameterNest:b,DeviceUpgradeRecord:()=>i.e(3).then(i.bind(null,"28d1"))},data:()=>({opened:!1,loading:!1,tableData:[],deviceTemplateList:[],deviceParameterConfigure:null}),props:{deviceInfo:{id:Number,name:String,items:Array},canEditable:{type:Boolean,default:!0}},computed:{deviceIsNormal(){let t=this.deviceInfo.items[0];return t.name!==this.$t("label.state")||t.name===this.$t("label.state")&&t.value===this.$t("label.regular")},isNotModified(){return!this.canEditable||!this.tableData.length||Object(n.u)(this.tableData,this.deviceParameterConfigure)},isShowOperation:()=>!1},watch:{isNotModified(t,e){this.setUnloadCallback(!t)}},inject:["setUnloadCallback"],methods:{showDeviceInfo(){this.tableData=[],this.opened=!0,this.$nextTick(async()=>{await this.initData()})},async initData(){this.loading=!0,this.deviceParameterConfigure=1===this.deviceInfo.id?(await Object(E.H)()).find(t=>t.device_type===n.e.Chassis):await Object(E.Y)(this.deviceInfo.id),this.deviceTemplateList.length||(this.deviceTemplateList=await Object(E.I)()),await this.getTableData(),await this.updateByTemplate(),this.loading=!1},onClosed(){this.tableData=[],this.deviceParameterConfigure=null,this.setUnloadCallback(!1),this.opened=!1},async onSave(t=!0){if(!Object(n.t)(this.tableData))return!1;const e={},i={};Object(n.O)(this.tableData,e,i),this.deviceParameterConfigure.device_params_value=e,this.deviceParameterConfigure.device_params_attribute=i,this.loading=!0,await Object(E.ub)(this.deviceParameterConfigure,t),this.loading=!1},async getTableData(){if(!this.deviceParameterConfigure)return;const t=Object(a.a)(this.deviceParameterConfigure);this.tableData=[...Object(n.V)(Object(n.R)(this.deviceTemplateList,n.e.Device),t.device_params_value,t.device_params_attribute),...Object(n.V)(Object(n.R)(this.deviceTemplateList,t.device_type),t.device_params_value,t.device_params_attribute)]},async updateByTemplate(){this.isNotModified||await this.onSave(!1)},setCalibrate(){var t;(null===(t=this.deviceParameterConfigure)||void 0===t?void 0:t.device_type)===n.e.IMU&&s.d.setCalibrateIMU()},openUpgradeRecordsDialog(t={}){let{device_id:e,key:i}=t;e=e||this.deviceInfo.id,this.$refs.refDeviceUpgradeRecord.init({device_id:e,key:i})}}},w=(i("45ae"),i("24e8")),S=i("65c6"),C=i("6ac5"),I=i("0d59"),x=Object(r.a)(A,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{persistent:"","transition-show":"scale","transition-hide":"scale"},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("div",{staticClass:"box-device column q-pb-md"},[e("q-toolbar",{staticClass:"bg-primary text-white shadow-2"},[e("q-toolbar-title",[t._v(t._s(t.deviceInfo.name))]),t.canEditable?e("q-btn",{staticClass:"q-mr-md",attrs:{flat:"",round:"",dense:"",icon:"mdi-history"},on:{click:function(e){return t.openUpgradeRecordsDialog({device_id:t.deviceInfo.id,key:""})}}},[e("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v(t._s(t.$t("label.updateRecord")))])],1):t._e(),t.canEditable&&t.tableData.length?e("q-btn",{staticClass:"q-mr-md",attrs:{flat:"",round:"",dense:"",icon:"save",disable:t.isNotModified},on:{click:t.onSave}},[e("q-tooltip",[t._v("\n          "+t._s(t.$t("button.save"))+"\n        ")])],1):t._e(),e("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"close"},on:{click:t.onClosed}})],1),e("div",{staticClass:"box-configure q-mt-md"},[t.deviceInfo.items.length?e("q-list",{staticClass:"q-border-bottom"},[t._l(t.deviceInfo.items,function(i,a){return e("q-item",{key:i.name,attrs:{dense:""}},[e("q-item-section",[t._v(" "+t._s(i.name)+" ")]),e("q-item-section",{class:a>0||i.name!==t.$t("label.state")?"":t.deviceIsNormal?"text_small_green_style":"text_small_red_style"},[e("div",[t._v(t._s(i.value+i.units))])])],1)}),t.isShowOperation?e("q-item",[e("q-item-section",[t._v(t._s(t.$t("label.operation")))]),e("q-item-section",[e("div",[e("q-btn",{attrs:{color:"primary",unelevated:"",label:t.$t("button.calibrate")},on:{click:t.setCalibrate}})],1)])],1):t._e()],2):t._e(),e("device-parameter-nest",{staticClass:"scrollbar overflow-y-auto flex-1 pb-5",attrs:{"can-editable":t.canEditable,"data-source":t.tableData,"data-parent":{children:t.tableData}},on:{openUpgradeRecordsDialog:t.openUpgradeRecordsDialog}}),e("DeviceUpgradeRecord",{ref:"refDeviceUpgradeRecord"}),t.loading?e("div",{staticClass:"full-width row justify-center q-mt-xl"},[e("q-spinner",{attrs:{color:"primary",size:"6em",thickness:2}})],1):t._e()],1)],1)])},[],!1,null,"3c6726c7",null);e.a=x.exports;y()(x,"components",{QDialog:w.a,QToolbar:S.a,QToolbarTitle:C.a,QBtn:u.a,QTooltip:p.a,QList:l.a,QItem:c.a,QItemSection:d.a,QSpinner:I.a})},"4eb5":function(t,e,i){},"4ff6":function(t,e,i){"use strict";i("ab43");var a=i("2f62"),s=i("f1c2"),n=i("a39b"),o=i("b69e");let r=function(){const t={},e=Object.create(t);return e[t[0]="MapOnly"]=0,e[t[1]="ManualControl"]=1,e}();var l={name:"MissionMiniMap",components:{MapPage:s.a},mixins:[],data:()=>({ModelType:r,loading:!1,callbackLoadMap:{resolve:null,reject:null},dragging:!1,isResizeFirst:!0,boxTop:100,boxLeft:500}),props:{mapName:{type:String,default:""}},computed:{...Object(a.d)(["isEditMap","rightDrawerState"]),...Object(a.d)("srp",["isManualCtrlState","pose","isSystemIdle","isEmergencyNone"])},watch:{mapName(t,e){t&&this.$emit("lookMap",!1)},pose:{handler:function(t,e){let i=this.getMapReference();null!=i&&i.updateRobotPos(t)},deep:!0},isSystemIdle(t,e){let i=this.getMapReference();null!=i&&i.setSystemIdleState(t)},isEmergencyNone(t,e){let i=this.getMapReference();null!=i&&i.setEmergencyState(!t)}},methods:{async updateDisplayMap(t=""){this.getMapReference().resetAll(),await this.loadMap(t)},getMapReference(){return void 0!==this.$refs.map?this.$refs.map:null},doLoadMapImage(t){let e=this.getMapReference();null!=e&&e.loadMapImage(t)},async doLoadMapJson(t,e,i=!1){let a=this.getMapReference();null!=a&&(e.hasOwnProperty("private")?(e.private.hasOwnProperty("fuseLocateQRCode")||(e.private.fuseLocateQRCode=[]),e.private.hasOwnProperty("cleanArea")||(e.private.cleanArea=[])):e.private={cleanArea:[],fuseLocateQRCode:[]},a.loadMapJson(t,e,i))},async loadMap(t){this.loading=!0,await Promise.all([Object(n.O)(t),Object(n.N)(t,this.$refs.map.mapImageScale())]).then(async e=>{await this.doLoadMapJson(t,e[0],!1),this.doLoadMapImage(e[1])}).catch(t=>{this.loading=!1})},loadMapFinished:async function(t){var e;t===o.d.LOAD_MAP_OK?null!==this.callbackLoadMap.resolve&&(this.callbackLoadMap.resolve(t),this.callbackLoadMap.resolve=null):(this.$notify({message:this.$t("text.loadMapFailed"),timeout:3e3,type:"negative",position:"top"}),null!==this.callbackLoadMap.reject&&(this.callbackLoadMap.reject(t),this.callbackLoadMap.reject=null)),null===(e=this.getMapReference())||void 0===e||e.updateRobotPos(this.pose),this.loading=!1},moveMiniMap(t){this.dragging=!0!==t.isFirst&&!0!==t.isFinal;let e=this.boxTop+t.delta.y,i=this.boxLeft+t.delta.x;e<=-62&&(e=-62),this.boxTop=e,this.boxLeft=i},resizeMiniMap(){this.isResizeFirst?this.isResizeFirst=!1:Object(o.y)()}},async mounted(){this.$nextTick(async()=>{this.mapName&&await this.loadMap(this.mapName)})}},c=l,d=(i("ca45"),i("2877")),h=i("2c91"),u=i("74f7"),p=i("d9b2"),m=i("3980"),f=i("75c3"),g=i("eebe"),_=i.n(g),y=Object(d.a)(c,function(){var t=this,e=t._self._c;return e("div",{staticClass:"box-mission-mini-map",style:{top:t.boxTop+"px",left:t.boxLeft+"px"}},[e("div",{staticClass:"header-mission-mini-map flex justify-between items-center"},[e("div",{staticClass:"flex items-center cursor-default"},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18.1415 10.0017C18.1415 9.90388 18.1249 9.8221 18.1202 9.81237C18.1167 9.76392 18.1001 9.67562 18.0848 9.62927C18.0807 9.61774 18.0753 9.60564 18.0706 9.59411C18.0623 9.56753 18.0535 9.54155 18.0435 9.52088C16.5421 6.23695 13.3096 4.02979 10.0008 4.02979C6.69272 4.02979 3.46049 6.23491 1.96591 9.50108C1.9479 9.53653 1.93519 9.57049 1.92721 9.60003C1.92368 9.60976 1.91954 9.61892 1.9163 9.62749C1.88676 9.71403 1.88618 9.77425 1.88854 9.7586C1.87467 9.8221 1.86196 9.94849 1.86196 9.94849C1.85842 9.98657 1.85842 10.017 1.86256 10.0548C1.86256 10.0548 1.87525 10.1652 1.88146 10.1877C1.88322 10.219 1.8909 10.2645 1.90005 10.3058H1.89945C1.90743 10.3412 1.91836 10.3755 1.93341 10.4092C1.9411 10.4351 1.95026 10.4594 1.95823 10.4777C3.46167 13.7622 6.69332 15.9699 10.0008 15.9699C13.3102 15.9699 16.5427 13.764 18.0269 10.5143C18.0499 10.4718 18.0647 10.4316 18.0748 10.3967C18.0795 10.3861 18.0836 10.3767 18.0866 10.3672C18.1126 10.2916 18.1179 10.2261 18.1155 10.2261L18.115 10.2266C18.1256 10.1741 18.1415 10.0956 18.1415 10.0017ZM17.0453 10.0418C17.0447 10.0442 17.0435 10.0471 17.0423 10.0495C17.0406 10.0566 17.0376 10.0649 17.0358 10.0731C15.6998 12.9524 12.879 14.8844 10.0008 14.8844C7.12979 14.8844 4.31396 12.9578 2.96465 10.0684C2.96139 10.0584 2.95903 10.0489 2.9555 10.0395C2.9549 10.03 2.95314 10.0223 2.95256 10.017C2.95138 10.0111 2.9502 10.0029 2.9493 9.99574V9.98837C2.95256 9.97625 2.9549 9.96416 2.9561 9.95087C2.95845 9.9438 2.96023 9.937 2.96289 9.92933C4.29946 7.04852 7.12267 5.11567 10.0008 5.11567C12.8801 5.11567 15.7028 7.05028 17.0352 9.92665C17.0364 9.93226 17.0376 9.937 17.0394 9.94084C17.0406 9.94555 17.0417 9.95029 17.0441 9.95531C17.047 9.97687 17.0494 9.99814 17.0524 10.0088C17.0488 10.02 17.0471 10.0306 17.0453 10.0418Z",fill:"#5B5E72"}}),e("path",{attrs:{d:"M10.0008 7.28662C8.5047 7.28662 7.2868 8.50391 7.2868 10.0003C7.2868 11.4963 8.5047 12.7142 10.0008 12.7142C11.4968 12.7142 12.7147 11.4963 12.7147 10.0003C12.7147 8.50391 11.4968 7.28662 10.0008 7.28662ZM10.0008 11.6287C9.10359 11.6287 8.37241 10.8981 8.37241 10.0003C8.37241 9.10283 9.10359 8.37224 10.0008 8.37224C10.8985 8.37224 11.6292 9.10285 11.6292 10.0003C11.6291 10.8981 10.8985 11.6287 10.0008 11.6287Z",fill:"#5B5E72"}})]),e("span",{staticClass:"q-ml-xs"},[t._v(t._s(t.mapName))])]),e("q-space",{directives:[{name:"touch-pan",rawName:"v-touch-pan.prevent.mouse",value:t.moveMiniMap,expression:"moveMiniMap",modifiers:{prevent:!0,mouse:!0}}],staticClass:"drag-mini-map",attrs:{disable:t.dragging}}),e("div",{staticClass:"flex items-center cursor-pointer"},[e("svg",{staticClass:"q-ml-xs cursor-pointer",attrs:{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},on:{click:function(e){return e.stopPropagation(),t.$emit("lookMap",!1)}}},[e("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9.99996 11.4106L3.38989 18.0207L1.97913 16.6099L8.5892 9.99984L1.97913 3.38977L3.38989 1.979L9.99996 8.58907L16.61 1.979L18.0208 3.38977L11.4107 9.99984L18.0208 16.6099L16.61 18.0207L9.99996 11.4106Z",fill:"#5B5E72"}})])])],1),e("div",{staticClass:"wrapper-mission-mini-map"},[e("map-page",{ref:"map",attrs:{"map-editable":t.isEditMap,"is-right-drawer-open":t.rightDrawerState,"is-manual-ctrl":t.isManualCtrlState,"maps-groups-index":1},on:{loadMapFinished:t.loadMapFinished}}),e("q-inner-loading",{attrs:{showing:t.loading}},[e("q-spinner-ios",{attrs:{size:"50px",color:"primary"}})],1),e("q-resize-observer",{attrs:{debounce:2e3},on:{resize:t.resizeMiniMap}})],1)])},[],!1,null,"726fce78",null);e.a=y.exports;_()(y,"components",{QSpace:h.a,QInnerLoading:u.a,QSpinnerIos:p.a,QResizeObserver:m.a}),_()(y,"directives",{TouchPan:f.a})},5044:function(t,e,i){"use strict";i("910d"),i("7d54"),i("ab43");var a=i("32e0"),s={name:"WareroomAreaAndWareroomRegionEditor",components:{ChoiceButtons:i("de9c").a,HeaderItem:a.a},data:()=>({opened:!1,wareroomAreas:[],wareroomRegions:[],wareroomAreaCurId:0,wareroomRegionCurId:0}),computed:{},watch:{opened(t,e){t?document.addEventListener("keydown",this.onKeyDown):document.removeEventListener("keydown",this.onKeyDown)}},methods:{addArea(){let t=this.createId(this.wareroomAreas);this.wareroomAreas.push({id:t,name:"",canDelete:!0}),this.$nextTick(async()=>{try{document.getElementById("wareroomAreaId"+t).scrollIntoView()}catch(t){}}),this.wareroomAreaCurId=t},deleteArea(t=0){this.wareroomRegions=this.wareroomRegions.filter(e=>e.wareroomAreaId!==t),this.wareroomAreas=this.wareroomAreas.filter(e=>e.id!==t)},wareroomAreaCurIdSet(t=0){this.wareroomAreaCurId!==t&&(this.wareroomAreaCurId=t,this.wareroomRegionCurId=0)},addRegion(){if(this.wareroomAreaCurId){let t=this.createId(this.wareroomRegions);this.wareroomRegions.push({id:t,name:"",canDelete:!0,wareroomAreaId:this.wareroomAreaCurId}),this.$nextTick(async()=>{try{document.getElementById("wareroomRegionId"+t).scrollIntoView()}catch(t){}})}},deleteRegion(t=0){this.wareroomRegions=this.wareroomRegions.filter(e=>e.id!==t)},wareroomRegionCurIdSet(t=0){this.wareroomRegionCurId!==t&&(this.wareroomRegionCurId=t)},checkSameName(){},checkNameFormat(){let t=this.wareroomAreas.filter(t=>""===t.name),e=this.wareroomRegions.filter(t=>""===t.name);return t.forEach(t=>{this.$notify({message:this.$t("text.inputNameIsNull",{name:`${this.$t("label.region")} ID:${t.id} ${this.$t("label.name")}`}),timeout:3e3,type:"negative",position:"top"})}),e.forEach(t=>{this.$notify({message:this.$t("text.inputNameIsNull",{name:`${this.$t("label.region")} ID: ${t.wareroomAreaId}, ${this.$t("label.wareroomStationRegion")} ID: ${t.id} ${this.$t("label.name")}`}),timeout:3e3,type:"negative",position:"top"})}),!(t.length||e.length)},reset(){this.wareroomAreas=[],this.wareroomRegions=[],this.wareroomAreaCurId=0,this.wareroomRegionCurId=0,this.opened=!1},createId(t){let e=0;return t.forEach(t=>{t.id>=e&&(e=t.id)}),++e},onClosed:function(){this.reset()},onKeyDown(t){"s"===t.key&&t.ctrlKey&&(t.stopPropagation(),t.preventDefault(),this.onSaved())},onSaved:function(){this.checkNameFormat()&&(this.$emit("updateModel",this.wareroomAreas.map(t=>({id:t.id,name:t.name})),this.wareroomRegions.map(t=>({id:t.id,name:t.name,wareroomAreaId:t.wareroomAreaId}))),this.onClosed())}}},n=(i("9ea9"),i("2877")),o=i("24e8"),r=i("f09f"),l=i("65c6"),c=i("6ac5"),d=i("0016"),h=i("1c1c"),u=i("66e5"),p=i("4074"),m=i("0170"),f=i("27f9"),g=i("714f"),_=i("eebe"),y=i.n(_),v=Object(n.a)(s,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"wrapper-wareroom q-px-md q-pt-md"},[e("div",{staticClass:"full-width"},[e("header-item",{attrs:{title:t.$t("label.editingInformationForAMapLibraryLocation")},on:{close:t.onClosed}})],1),e("div",{staticClass:"container-wareroom"},[e("div",{staticClass:"q-pa-md wareroom-content"},[e("q-toolbar",{staticClass:"bg-primary text-white shadow-2",attrs:{dense:""}},[e("q-toolbar-title",[t._v(t._s(t.$t("label.wareroomStationArea")))]),e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"mdi-plus",color:"white",size:"36px"},on:{click:t.addArea}})],1),e("q-list",{staticClass:"wareroom-main",attrs:{dense:"",bordered:""}},t._l(t.wareroomAreas,function(i,a){return e("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:i.id,staticClass:"q-my-sm",attrs:{clickable:"",dense:"",id:`wareroomAreaId${i.id}`,active:i.id===t.wareroomAreaCurId},on:{click:function(e){return t.wareroomAreaCurIdSet(i.id)}}},[e("q-item-section",{attrs:{side:""}},[t._v("\n              "+t._s(a+1)+"\n            ")]),e("q-item-section",{attrs:{side:""}},[t._v(" "+t._s(t.$t("label.ID"))+": "+t._s(i.id)+" ")]),e("q-item-section",[e("q-item-label",[e("q-input",{attrs:{dense:"",placeholder:t.$t("text.inputPlease")},on:{blur:t.checkSameName},model:{value:i.name,callback:function(e){t.$set(i,"name","string"==typeof e?e.trim():e)},expression:"item.name"}})],1)],1),i.canDelete?e("q-item-section",{attrs:{side:""}},[e("q-icon",{attrs:{name:"mdi-delete",color:"red-5"},on:{click:function(e){return t.deleteArea(i.id)}}})],1):t._e()],1)}),1)],1),e("div",{staticClass:"q-pa-md wareroom-content"},[e("q-toolbar",{staticClass:"bg-primary text-white shadow-2"},[e("q-toolbar-title",[t._v(t._s(t.$t("label.wareroomStationRegion")))]),t.wareroomAreaCurId?e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"mdi-plus",color:"white",size:"36px"},on:{click:t.addRegion}}):t._e()],1),e("q-list",{staticClass:"wareroom-main",attrs:{dense:"",bordered:""}},[t._l(t.wareroomRegions.filter(e=>e.wareroomAreaId===t.wareroomAreaCurId),function(i,a){return[i.wareroomAreaId===t.wareroomAreaCurId?e("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:i.id,staticClass:"q-my-sm",attrs:{clickable:"",id:`wareroomRegionId${i.id}`,active:i.id===t.wareroomRegionCurId},on:{click:function(e){return t.wareroomRegionCurIdSet(i.id)}}},[e("q-item-section",{attrs:{side:""}},[t._v("\n                "+t._s(a+1)+"\n              ")]),e("q-item-section",{attrs:{side:""}},[t._v(" "+t._s(t.$t("label.ID"))+": "+t._s(i.id)+" ")]),e("q-item-section",[e("q-item-label",[e("q-input",{attrs:{dense:"",placeholder:t.$t("text.inputPlease")},model:{value:i.name,callback:function(e){t.$set(i,"name","string"==typeof e?e.trim():e)},expression:"item.name"}})],1)],1),i.canDelete?e("q-item-section",{attrs:{side:""}},[e("q-icon",{attrs:{name:"mdi-delete",color:"red-5"},on:{click:function(e){return t.deleteRegion(i.id)}}})],1):t._e()],1):t._e()]})],2)],1)]),e("div",{staticClass:"q-my-md q-mr-md"},[e("choice-buttons",{attrs:{"label-okay":t.$t("button.save")},on:{okay:t.onSaved,cancel:t.onClosed}})],1)])],1)},[],!1,null,"2d67b85a",null);e.a=v.exports;y()(v,"components",{QDialog:o.a,QCard:r.a,QToolbar:l.a,QToolbarTitle:c.a,QIcon:d.a,QList:h.a,QItem:u.a,QItemSection:p.a,QItemLabel:m.a,QInput:f.a}),y()(v,"directives",{Ripple:g.a})},"57fd":function(t,e,i){},5829:function(t,e,i){"use strict";i("910d");var a=i("fca8"),s={name:"RegisterComponent",data(){return{selectedValue:"",regType:this.registerType,inputValue:this.registerAddr,filterRegOptions:[]}},validations:{inputValue:{required:!0}},props:{registerType:Number,registerAddr:Number,options:Array,regTypeOpts:Array},computed:{isInputEditable(){let t=this.getSelectedOpt();return null==t||"manualInputParams"===t.value}},mounted(){this.filterRegOptions=this.options,this.initValue()},methods:{onInput(t){let e=this.getSelectedOpt();null!=e&&(this.updateRegisterType(e.type),this.inputValue=Object(a.h)(e.addr,e.type),this.inputValue>0&&this.onChanged(e.addr))},filterFn(t,e){e(""!==t?()=>{const e=t.toLowerCase();this.filterRegOptions=this.options.filter(t=>t.label.toLowerCase().indexOf(e)>-1),1===this.filterRegOptions.length&&(this.selectedValue=this.filterRegOptions[0].value,this.onInput(this.selectedValue))}:()=>{this.filterRegOptions=this.options})},onSelectRegType(t){this.updateRegisterType(t)},onChanged(t){this.isInputEditable&&(t=Object(a.b)(t)),this.updateRegisterAddr(t)},updateRegisterAddr(t){this.$emit("update:registerAddr",t)},updateRegisterType(t){this.$emit("update:registerType",t)},checkRegisterAddr(){if(!this.isInputEditable)return!0;let t=parseInt(this.inputValue);return!(t>=0&&Object(a.l)(t)!==this.regType)||(this.$notify({message:this.$t("text.registerAddrNotMatchType"),timeout:3e3,type:"negative",position:"top"}),!1)},initValue(){this.regType=this.registerType;for(let t of Array.from(this.filterRegOptions))if(t.addr===this.registerAddr&&t.type===this.registerType)return this.selectedValue=t.value,void(this.inputValue=Object(a.h)(t.addr,t.type));this.selectedValue=this.filterRegOptions[0].value,this.regType>0?this.inputValue=Object(a.h)(this.registerAddr,this.regType):(this.regType=this.regTypeOpts[0].value,this.inputValue=0)},getSelectedOpt(){for(let t of Array.from(this.filterRegOptions))if(t.value===this.selectedValue)return t;return null}}},n=i("2877"),o=i("ddd8"),r=i("27f9"),l=i("eebe"),c=i.n(l),d=Object(n.a)(s,function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"col-2 text_main_light_grey div_align_vcenter"},[t._v("\n      "+t._s(t.$t("label.register"))+"\n    ")]),e("q-select",{staticClass:"col-9",staticStyle:{"margin-left":"10px"},attrs:{"autofocus-filter":"","emit-value":"","map-options":"",outlined:"",dense:"","use-input":"","hide-selected":"","fill-input":"",autofocus:"",options:t.filterRegOptions},on:{filter:t.filterFn,input:t.onInput},model:{value:t.selectedValue,callback:function(e){t.selectedValue=e},expression:"selectedValue"}})],1),t.isInputEditable?e("div",{staticClass:"row full-width q-mt-sm"},[e("div",{staticClass:"col-2 text_main_light_grey div_align_vcenter"},[t._v("\n      "+t._s(t.$t("registers.registerType"))+"\n    ")]),e("q-select",{staticClass:"col-9",staticStyle:{"margin-left":"10px"},attrs:{"emit-value":"","map-options":"",outlined:"",dense:"",options:t.regTypeOpts},on:{input:t.onSelectRegType},model:{value:t.regType,callback:function(e){t.regType=e},expression:"regType"}})],1):t._e(),e("div",{staticClass:"row full-width q-mt-sm"},[e("div",{staticClass:"col-2 text_main_light_grey div_align_vcenter"},[t._v("\n      "+t._s(t.$t("label.address"))+"\n    ")]),e("q-input",{staticClass:"col-9",staticStyle:{"margin-left":"10px"},attrs:{type:"number",outlined:"",dense:"",disable:!t.isInputEditable},on:{input:t.onChanged},model:{value:t.inputValue,callback:function(e){t.inputValue=t._n(e)},expression:"inputValue"}})],1)])},[],!1,null,"1a9f8ea2",null);e.a=d.exports;c()(d,"components",{QSelect:o.a,QInput:r.a})},"59d9":function(t,e,i){"use strict";i.r(e);var a=i("adb7"),s=i("b69e"),n=i("f2b3"),o=i("2222"),r={name:"NoteAreaEditor",data:()=>({opened:!1,model:Object(n.a)(a.l)}),computed:{background:{get(){return`rgba(${this.model.style.backgroundColor.replace("rgb(","").replace(")","")}, ${this.model.style.opacity})`}},areaSize(){return{width:this.model["pc.x"]-this.model["pa.x"],height:this.model["pa.y"]-this.model["pc.y"]}},posX:{get(){return Object(s.x)(this.model["pa.x"])},set(t){Object(n.h)(t)&&this.updatePoses(t,this.model["pa.y"],this.areaSize.width,this.areaSize.height)}},posY:{get(){return Object(s.x)(this.model["pc.y"])},set(t){Object(n.h)(t)&&this.updatePoses(this.model["pa.x"],this.areaSize.height+t,this.areaSize.width,this.areaSize.height)}},areaWidth:{get(){return Object(s.x)(this.areaSize.width)},set(t){Object(n.h)(t)&&t>0&&this.updatePoses(this.model["pa.x"],this.model["pa.y"],t,this.areaSize.height)}},areaHeight:{get(){return Object(s.x)(this.areaSize.height)},set(t){Object(n.h)(t)&&t>0&&this.updatePoses(this.model["pa.x"],this.model["pa.y"],this.areaSize.width,t)}}},methods:{setData(t){this.model=t,this.opened=!0},onClose(){this.opened=!1},onSave(){this.$emit("updateModel",this.model),this.onClose()},updatePoses:function(t,e,i,a){const s=new o.Rectangle(t,e,i,-a);this.model["pd.x"]=s.bottomLeft.x,this.model["pd.y"]=s.bottomLeft.y,this.model["pb.x"]=s.topRight.x,this.model["pb.y"]=s.topRight.y,this.model["pa.x"]=s.topLeft.x,this.model["pa.y"]=s.topLeft.y,this.model["pc.x"]=s.bottomRight.x,this.model["pc.y"]=s.bottomRight.y}}},l=i("2877"),c=i("24e8"),d=i("f09f"),h=i("a370"),u=i("65c6"),p=i("6ac5"),m=i("9c40"),f=i("1c1c"),g=i("66e5"),_=i("4074"),y=i("27f9"),v=i("e7a9"),b=i("7cbe"),E=i("b498"),A=i("c1d0"),w=i("eebe"),S=i.n(w),C=Object(l.a)(r,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"transition-show":"fade","transition-hide":"flip-up","no-backdrop-dismiss":""},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"box-dialog-card column no-wrap"},[e("q-card-section",{staticClass:"no-padding"},[e("q-toolbar",{staticClass:"bg-primary text-white shadow-2",attrs:{dense:""}},[e("q-toolbar-title",[t._v(t._s(t.$t("label.noteArea")))]),e("q-btn",{attrs:{flat:"",dense:"",icon:"save"},on:{click:t.onSave}}),e("q-btn",{attrs:{flat:"",dense:"",icon:"close"},on:{click:t.onClose}})],1)],1),e("q-card-section",{staticClass:"q-px-none q-pt-none column overflow-auto no-wrap full-width"},[e("q-list",{attrs:{separator:"",dense:""}},[e("q-item",[e("q-item-section",{staticClass:"text_main_grey_style"},[t._v("\n            "+t._s(t.$t("label.ID"))+"\n          ")]),e("q-item-section",[e("q-input",{attrs:{disable:"",dense:"","hide-bottom-space":"",outlined:""},model:{value:t.model.id,callback:function(e){t.$set(t.model,"id","string"==typeof e?e.trim():e)},expression:"model.id"}})],1)],1),e("q-item",[e("q-item-section",{staticClass:"text_main_grey_style"},[t._v("\n            "+t._s(t.$t("label.name"))+"\n          ")]),e("q-item-section",[e("q-input",{attrs:{dense:"","hide-bottom-space":"",outlined:""},model:{value:t.model.name,callback:function(e){t.$set(t.model,"name","string"==typeof e?e.trim():e)},expression:"model.name"}})],1)],1),e("q-item",[e("q-item-section",{staticClass:"text_main_grey_style"},[t._v("\n            "+t._s(t.$t("label.fontSize"))+"\n          ")]),e("q-item-section",[e("q-input",{attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number"},model:{value:t.model.style.fontSize,callback:function(e){t.$set(t.model.style,"fontSize",t._n(e))},expression:"model.style.fontSize"}})],1)],1),e("q-item",[e("q-item-section",{staticClass:"text_main_grey_style"},[t._v("\n            "+t._s(t.$t("label.align"))+"\n          ")]),e("q-item-section",[e("div",[e("q-btn-group",{attrs:{outline:""}},[e("q-btn",{attrs:{dense:"",outline:"",icon:"mdi-align-vertical-top",color:"top"===t.model.style.alignItems?"primary":"gray"},on:{click:function(e){t.model.style.alignItems="top"}}}),e("q-btn",{attrs:{dense:"",outline:"",icon:"mdi-align-vertical-center",color:"center"===t.model.style.alignItems?"primary":"gray"},on:{click:function(e){t.model.style.alignItems="center"}}}),e("q-btn",{attrs:{dense:"",outline:"",icon:"mdi-align-vertical-bottom",color:"bottom"===t.model.style.alignItems?"primary":"gray"},on:{click:function(e){t.model.style.alignItems="bottom"}}})],1),e("q-btn-group",{staticClass:"q-ml-md",attrs:{outline:""}},[e("q-btn",{attrs:{dense:"",outline:"",icon:"mdi-align-horizontal-left",color:"left"===t.model.style.justifyContent?"primary":"gray"},on:{click:function(e){t.model.style.justifyContent="left"}}}),e("q-btn",{attrs:{dense:"",outline:"",icon:"mdi-align-horizontal-center",color:"center"===t.model.style.justifyContent?"primary":"gray"},on:{click:function(e){t.model.style.justifyContent="center"}}}),e("q-btn",{attrs:{dense:"",outline:"",icon:"mdi-align-horizontal-right",color:"right"===t.model.style.justifyContent?"primary":"gray"},on:{click:function(e){t.model.style.justifyContent="right"}}})],1)],1)])],1),e("q-item",[e("q-item-section",{staticClass:"text_main_grey_style"},[t._v("\n            "+t._s(t.$t("label.fontColor"))+"\n          ")]),e("q-item-section",[e("q-btn",{staticClass:"width-auto",style:`color: ${t.model.style.color};`,attrs:{flat:"",label:t.model.style.color}},[e("q-popup-proxy",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[e("q-color",{attrs:{"default-view":"palette","format-model":"rgb","no-header-tabs":""},model:{value:t.model.style.color,callback:function(e){t.$set(t.model.style,"color",e)},expression:"model.style.color"}})],1)],1)],1)],1),e("q-item",[e("q-item-section",{staticClass:"text_main_grey_style"},[t._v("\n            "+t._s(t.$t("label.backgroundColor"))+"\n          ")]),e("q-item-section",[e("q-btn",{staticClass:"width-auto",style:`color: ${t.model.style.color}; backgroundColor: ${t.background};`,attrs:{flat:"",label:t.model.style.backgroundColor}},[e("q-popup-proxy",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[e("q-color",{attrs:{"default-view":"palette","format-model":"rgb","no-header-tabs":""},model:{value:t.model.style.backgroundColor,callback:function(e){t.$set(t.model.style,"backgroundColor",e)},expression:"model.style.backgroundColor"}})],1)],1)],1)],1),e("q-item",[e("q-item-section",{staticClass:"text_main_grey_style"},[t._v("\n            "+t._s(t.$t("label.opacity"))+"\n          ")]),e("q-item-section",[e("q-slider",{attrs:{min:0,max:1,step:.01,label:"","switch-label-side":""},model:{value:t.model.style.opacity,callback:function(e){t.$set(t.model.style,"opacity",e)},expression:"model.style.opacity"}})],1)],1),e("q-item",[e("q-item-section",{staticClass:"text_main_grey_style"},[t._v("\n            "+t._s(t.$t("label.layer"))+"\n          ")]),e("q-item-section",[e("q-input",{attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number"},model:{value:t.model.style.z,callback:function(e){t.$set(t.model.style,"z",t._n(e))},expression:"model.style.z"}})],1)],1),e("q-item",[e("q-item-section",{staticClass:"text_main_grey_style"},[t._v("\n            "+t._s(t.$t("label.coordinate")+"x(cm)")+"\n          ")]),e("q-item-section",[e("q-input",{attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number"},model:{value:t.posX,callback:function(e){t.posX=t._n(e)},expression:"posX"}})],1)],1),e("q-item",[e("q-item-section",{staticClass:"text_main_grey_style"},[t._v("\n            "+t._s(t.$t("label.coordinate")+"y(cm)")+"\n          ")]),e("q-item-section",[e("q-input",{attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number"},model:{value:t.posY,callback:function(e){t.posY=t._n(e)},expression:"posY"}})],1)],1),e("q-item",[e("q-item-section",{staticClass:"text_main_grey_style"},[t._v("\n            "+t._s(t.$t("label.width")+"(cm)")+"\n          ")]),e("q-item-section",[e("q-input",{attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",min:0},model:{value:t.areaWidth,callback:function(e){t.areaWidth=t._n(e)},expression:"areaWidth"}})],1)],1),e("q-item",[e("q-item-section",{staticClass:"text_main_grey_style"},[t._v("\n            "+t._s(t.$t("label.height")+"(cm)")+"\n          ")]),e("q-item-section",[e("q-input",{attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",min:0},model:{value:t.areaHeight,callback:function(e){t.areaHeight=t._n(e)},expression:"areaHeight"}})],1)],1),e("q-item",[e("q-item-section",{staticClass:"text_main_grey_style"},[t._v("\n            "+t._s(t.$t("label.desc"))+"\n          ")]),e("q-item-section",[e("q-input",{staticClass:"col-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"textarea",rows:"2"},model:{value:t.model.desc,callback:function(e){t.$set(t.model,"desc",e)},expression:"model.desc"}})],1)],1)],1)],1)],1)],1)},[],!1,null,null,null);e.default=C.exports;S()(C,"components",{QDialog:c.a,QCard:d.a,QCardSection:h.a,QToolbar:u.a,QToolbarTitle:p.a,QBtn:m.a,QList:f.a,QItem:g.a,QItemSection:_.a,QInput:y.a,QBtnGroup:v.a,QPopupProxy:b.a,QColor:E.a,QSlider:A.a})},"5d33":function(t,e,i){},6825:function(t,e,i){"use strict";var a={name:"ContextMenu",props:{isContextMenu:{type:Boolean,default:!0}},data:()=>({menuList:[],callbackResolve:null,callbackReject:null}),mounted(){this.removeTouchMoveEventListener()},methods:{openContextMenu(t){return this.menuList=t,new Promise((t,e)=>{this.callbackReject=e,this.callbackResolve=t})},removeTouchMoveEventListener(){this.$parent.$el.removeEventListener("touchmove",this.__mobileCleanup)},onMenuClick(t){this.callbackResolve&&(this.callbackResolve(t),this.callbackReject=null,this.callbackResolve=null)},onEscPressed(){this.callbackReject&&(this.callbackReject("Esc"),this.callbackReject=null,this.callbackResolve=null)},onHide(t){this.callbackReject&&(this.callbackReject("Close"),this.callbackReject=null,this.callbackResolve=null)},hasIcon:t=>!!t.hasOwnProperty("icon")}},s=(i("e9fa"),i("2877")),n=i("4e73"),o=i("1c1c"),r=i("66e5"),l=i("4074"),c=i("0016"),d=i("7f67"),h=i("eebe"),u=i.n(h),p=Object(s.a)(a,function(){var t=this,e=t._self._c;return e("q-menu",{ref:"ctxMenu",attrs:{"context-menu":t.isContextMenu,anchor:"bottom left",self:"top middle",offset:[0,4]},on:{"escape-key":t.onEscPressed,hide:t.onHide}},[e("div",{staticClass:"background_black"},[e("q-list",t._l(t.menuList,function(i){return e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:`menu-${i.name}`,staticClass:"q-ma-none q-pa-none",staticStyle:{height:"32px"},attrs:{dense:"",clickable:""},on:{mouseover:function(t){i.isActive=!0},mouseout:function(t){i.isActive=!1}},nativeOn:{click:function(e){return t.onMenuClick(i)}}},[e("q-item-section",{class:i.isActive?"hover_style":"background_black"},[e("div",{staticClass:"row justify-center"},[t.hasIcon(i)?e("q-icon",{staticClass:"q-mr-sm",attrs:{size:"16px"}}):t._e(),e("div",{staticClass:"q-px-md",class:i.isActive?"text_small_blue_style":"text_small_white_style"},[t._v("\n              "+t._s(i.name)+"\n            ")])],1)])],1)}),1)],1)])},[],!1,null,"987d81e0",null);e.a=p.exports;u()(p,"components",{QMenu:n.a,QList:o.a,QItem:r.a,QItemSection:l.a,QIcon:c.a}),u()(p,"directives",{ClosePopup:d.a})},"6c2a":function(t,e,i){"use strict";i.d(e,"a",function(){return n});var a=i("8847"),s=i("b710");function n(t=1e5){var e,i;const n={[s.a.UPGRADE_RESULT_SUCCESS]:()=>"",[s.a.UPGRADE_RESULT_UNFINISHED_STEP1]:()=>a.b.t("text.appModeToBootloaderMode"),[s.a.UPGRADE_RESULT_UNFINISHED_STEP2]:()=>a.b.t("text.bootloaderModeToAppMode"),[s.a.UPGRADE_RESULT_FAILED_NOT_ONLINE_IGNORED]:()=>a.b.t("text.deviceOfflineNoUpgrade"),[s.a.UPGRADE_RESULT_FAILED_VERSION_MATCHED]:()=>a.b.t("text.sameVersionNoUpgrade"),[s.a.UPGRADE_RESULT_FAILED_VERSION_NOT_SUPPORT]:()=>a.b.t("text.unsupportedVersion"),[s.a.UPGRADE_RESULT_FAILED_FILE_NONE]:()=>a.b.t("text.firmwareFileNotFound"),[s.a.UPGRADE_RESULT_FAILED_FILE_ERROR]:()=>a.b.t("text.firmwareFileError"),[s.a.UPGRADE_RESULT_FAILED_MD5_CHECK]:()=>a.b.t("text.md5CheckError"),[s.a.UPGRADE_RESULT_FAILED_ENTER_IAP_MODE]:()=>a.b.t("text.requestUpgradeModeFailed"),[s.a.UPGRADE_RESULT_FAILED_TRANSFER_FILE]:()=>a.b.t("text.firmwareFileTransferFailed"),[s.a.UPGRADE_RESULT_FAILED_START_NEW_APP]:()=>a.b.t("text.newAppModeStartFailed"),[s.a.UPGRADE_RESULT_FAILED_VERSION_NOT_UPDATED]:()=>a.b.t("text.newVersionNotUpdated"),[s.a.UPGRADE_RESULT_FAILED_CAN_HARDWARE_ERROR]:()=>a.b.t("text.canHardwareError"),[s.a.UPGRADE_RESULT_FAILED_UART_HARDWARE_ERROR]:()=>a.b.t("text.uartHardwareError"),[s.a.UPGRADE_RESULT_FAILED_PMU_BOOTLOADER_NOT_SUPPORTED]:()=>a.b.t("text.pmuBootloaderNotSupported"),[s.a.UPGRADE_RESULT_FAILED_UNKNOWN]:()=>a.b.t("text.unknownErrorText")};return null!==(e=null===(i=n[t])||void 0===i?void 0:i.call(n))&&void 0!==e?e:a.b.t("text.unknownInfo")}},"6e49":function(t,e,i){"use strict";var a=i("2f62"),s=i("de9c"),n=i("32e0"),o=i("e4ef"),r=i("69a0"),l=i.n(r);var c=t=>{let e=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,i=2097152,a=Math.ceil(t.size/i),s=0,n=new l.a.ArrayBuffer,o=new FileReader,r=new Promise((t,e)=>{o.onload=function(e){if(n.append(e.target.result),s++,s<a)c();else{let e=n.end();n=null,t(e)}},o.onerror=function(){n=null,e(Error("failed to calculate md5"))}});function c(){let a=s*i,n=a+i>=t.size?t.size:a+i;o.readAsArrayBuffer(e.call(t,a,n))}return c(),r},d=i("d5bc"),h=i("08c8");const u=".update",p=".src_update",m=".map_export",f=".task_export",g=".tpl_export",_=".db_export",y=".config_export";var v={name:"UploadFileDialog",components:{ProgressDialog:h.a,MessageDialog:d.a,HeaderItem:n.a,ChoiceButtons:s.a},data:()=>({opened:!1,fileType:o.z.FILE_NONE,uploadUrl:"",title:"",desc:"",labTxt:"",fileFilter:"",okTxt:"",filePrepared:!1,uploadProgress:0,fileObj:null,fileUploadParam:[],callbackResolve:null,callbackReject:null}),computed:{...Object(a.d)(["uiServerDomain"]),...Object(a.d)("srp",["isSystemIdle","hasRunningState"]),fileInfo(){return null==this.fileObj?"":this.fileObj.name+`(${this.getFileSizeStr(this.fileObj.size)})`}},mounted(){},methods:{doUploadFile(t){switch(this.fileType=t,t){case o.z.FILE_SROS_UPGRADE:case o.z.FILE_SRC_UPGRADE:this.title=this.$t("label.firmwareUpgrade"),this.desc=this.$t("label.system")+this.$t("label.firmwareUpgrade"),this.okTxt=this.$t("button.startUpgrade"),t===o.z.FILE_SROS_UPGRADE?(this.labTxt=this.$t("button.upgradeSysFirmware"),this.fileFilter=u,this.uploadUrl=this.uiServerDomain+"/api/v0/update/import"):(this.labTxt=this.$t("button.upgradeControlFirmware"),this.uploadUrl=this.uiServerDomain+"/api/v0/src/import",this.fileFilter=p);break;case o.z.FILE_MAP_PKG:this.title=this.$t("label.importMap"),this.desc=this.$t("label.importMap"),this.okTxt=this.$t("button.import"),this.labTxt=this.$t("label.importMap")+this.$t("label.file"),this.fileFilter=m,this.uploadUrl=this.uiServerDomain+"/api/v0/map/import";break;case o.z.FILE_MISSION:this.title=this.$t("label.importTask"),this.desc=this.$t("label.importTask"),this.okTxt=this.$t("button.import"),this.labTxt=this.$t("label.importTask")+this.$t("label.file"),this.fileFilter=f,this.uploadUrl=this.uiServerDomain+"/api/v0/mission/import";break;case o.z.FILE_MISSION_TEMPLATE:this.title=this.$t("button.importTemplate"),this.desc=this.$t("button.importTemplate"),this.okTxt=this.$t("button.import"),this.labTxt=this.$t("button.importTemplate")+this.$t("label.file"),this.fileFilter=g,this.uploadUrl=this.uiServerDomain+"/api/v0/mission_template/import";break;case o.z.FILE_SROS_DATABASE:this.title=this.$t("button.importDatabase"),this.desc=this.$t("text.systemWillRestart"),this.okTxt=this.$t("button.import"),this.labTxt=this.$t("button.importDatabase")+this.$t("label.file"),this.fileFilter=_,this.uploadUrl=this.uiServerDomain+"/api/v0/db";break;case o.z.FILE_CONFIG_INFO:case o.z.FILE_CONFIGURES:this.title=this.$t("button.importConfiguration"),this.desc=this.$t("button.importConfiguration"),this.okTxt=this.$t("button.import"),this.labTxt=this.$t("button.importConfiguration")+this.$t("label.file"),this.fileFilter=y,this.uploadUrl=this.uiServerDomain+(t===o.z.FILE_CONFIGURES?"/api/v0/configs/import":"/api/v0/config_info/import");break;case o.z.FILE_TOTAL_LOG:this.title=this.$t("button.import")+this.$t("label.log"),this.desc=this.$t("button.import")+this.$t("label.log"),this.okTxt=this.$t("button.import"),this.labTxt=this.$t("button.import")+this.$t("label.log")+this.$t("label.file")+"(total_log.json)",this.fileFilter=".json",this.uploadUrl="";break;case o.z.FILE_COMPANY_INFORMATION:this.title=this.$t("button.import")+this.$t("label.companyInformation"),this.desc=this.$t("button.import")+this.$t("label.companyInformation"),this.okTxt=this.$t("button.import"),this.labTxt=this.$t("label.file")+"(companyInformation.tar.gz)",this.fileFilter=".tar.gz",this.uploadUrl=this.uiServerDomain+"/api/v0/logo_customize";break;case o.z.FILE_ROBOT_ICON_INFO:this.title=this.$t("button.import")+this.$t("label.robotIconInfo"),this.desc=this.$t("button.import")+this.$t("label.robotIconInfo"),this.okTxt=this.$t("button.import"),this.labTxt=this.$t("label.file")+"(robot_icon_config.zip)",this.fileFilter=".zip",this.uploadUrl=this.uiServerDomain+"/api/v0/vehicle/resource/import";break;case o.z.FILE_ROBOT_3D_MODEL:this.title=this.$t("button.import")+this.$t("label.robotThreeModel"),this.desc=this.$t("button.import")+this.$t("label.robotThreeModel"),this.okTxt=this.$t("button.import"),this.labTxt=this.$t("label.file")+"(*.glb)",this.fileFilter=".glb",this.uploadUrl=this.uiServerDomain+"/api/v0/vehicle/resource/import"}return this.opened=!0,this.fileObj=null,new Promise((t,e)=>{this.callbackResolve=t,this.callbackReject=e})},addUploadParam(t,e){this.fileUploadParam.push({name:t,value:e})},chooseFile(){this.$refs.uploadFile.pickFiles()},onReselctFile(){this.resetFile(),this.$nextTick(()=>{this.chooseFile()})},onOkay(){this.callbackResolve&&(this.callbackResolve(!0),this.callbackResolve=null,this.callbackReject=null),this.opened=!1},onClosed(){this.callbackReject&&(this.callbackReject(!0),this.callbackResolve=null,this.callbackReject=null),this.resetFile(),this.opened=!1},async onAddUpdateFile(t){this.filePrepared=!1,this.fileObj=t[0];let e=t[0].name,i=this.getFileExtension(e),a=!0;switch(this.fileType){case o.z.FILE_SROS_UPGRADE:i!==u&&(a=!1);break;case o.z.FILE_SRC_UPGRADE:this.isSrcUpdateBin?".bin"!==i&&(a=!1):i!==p&&(a=!1);break;case o.z.FILE_MAP_PKG:i!==m&&(a=!1);break;case o.z.FILE_MISSION:i!==f&&(a=!1);break;case o.z.FILE_MISSION_TEMPLATE:i!==g&&(a=!1);break;case o.z.FILE_SROS_DATABASE:i!==_&&(a=!1);break;case o.z.FILE_CONFIG_INFO:case o.z.FILE_CONFIGURES:i!==y&&(a=!1);break;case o.z.FILE_TOTAL_LOG:~e.search("total_log")||(a=!1)}if(!a)return void this.$notify({message:this.$t("text.illegalFile"),timeout:3e3,type:"negative",position:"top"});if(this.fileObj.size<=0)return void this.$notify({message:this.$t("text.illegalFileSize"),timeout:3e3,type:"negative",position:"top"});let s="";try{s=await c(t[0])}catch(t){}this.fileUploadParam=[],this.addUploadParam("md5",s),this.fileType===o.z.FILE_CONFIG_INFO?this.addUploadParam("override",1):this.fileType===o.z.FILE_CONFIGURES?(this.addUploadParam("override",0),this.addUploadParam("check",1)):this.fileType===o.z.FILE_ROBOT_ICON_INFO?this.addUploadParam("type","robot_icon_config"):this.fileType===o.z.FILE_ROBOT_3D_MODEL&&this.addUploadParam("type","3d_model"),this.$emit("addFile",this.fileObj,s),this.filePrepared=!0},async onUploadFile(t=!1){switch(this.fileType){case o.z.FILE_SROS_UPGRADE:case o.z.FILE_SRC_UPGRADE:case o.z.FILE_SROS_DATABASE:case o.z.FILE_CONFIG_INFO:case o.z.FILE_CONFIGURES:if(!([o.z.FILE_SROS_UPGRADE,o.z.FILE_SRC_UPGRADE].includes(this.fileType)&&!this.hasRunningState||this.isSystemIdle))return void this.$notify({message:this.$t("text.unableToImportSystemWhenSysNotIdle"),timeout:3e3,type:"negative",position:"top"});if(this.fileType===o.z.FILE_SROS_UPGRADE&&t){if(!await this.$parent.$parent.recodeSrosUpgradePreviousId())return void this.$notify({message:this.$t("text.httpNetworkCommunicationFailed"),type:"navigate",timeout:3e3})}break;case o.z.FILE_TOTAL_LOG:return void await this.getImportFileData(this.fileObj).then(t=>{this.$emit("handleImportLog",t),this.onUploadFinished()}).catch(t=>{this.$notify({message:this.$t("text.illegalFile")+","+t.message,timeout:3e3,type:"negative",position:"top"})})}this.uploadProgress=0,this.$refs.uploadFile.upload()},getImportFileData:async(t,e="json")=>new Promise(function(e,i){const a=new FileReader;a.readAsText(t),a.onload=t=>{try{const i=JSON.parse(t.target.result||"[]");e(i)}catch(t){i(t)}},a.onerror=t=>{i(t)}}),uploadFieldName:t=>"file",resetFile(){this.fileObj=null,this.$refs.uploadFile.reset()},onStartUploadFile(){this.fileType!==o.z.FILE_SRC_UPGRADE&&this.fileType!==o.z.FILE_SROS_UPGRADE||this.$notify({message:this.$t("text.noTurnOffWhenUpgrade"),timeout:3e3,type:"info",position:"top"}),this.$refs.progressDlg.showProgress(this.getUploadFileTitle())},onUploadingFile(t){t.xhr.upload.onprogress=t=>{this.uploadProgress=parseInt((t.loaded/t.total*100).toFixed(0))}},onUploadFinished(t){if(this.fileType===o.z.FILE_CONFIGURES){var e;let a=null;try{var i;a=JSON.parse(null==t||null===(i=t.xhr)||void 0===i?void 0:i.response)}catch(t){}if(null===(e=a)||void 0===e||!e.state)return void this.onUploadFailed(t)}this.$refs.progressDlg.hideProgress(),this.onOkay(),this.$emit("success",t)},async onUploadFailed(t){var e;this.$emit("error",t.xhr.status),this.$refs.progressDlg.hideProgress();let i=(null==t||null===(e=t.xhr)||void 0===e?void 0:e.responseText)||"";const a=this.fileType===o.z.FILE_MAP_PKG,s=this.fileType===o.z.FILE_CONFIGURES;if(a||s){let e=null;try{var n;e=JSON.parse(null==t||null===(n=t.xhr)||void 0===n?void 0:n.response)}catch(t){}if(a){var r;const t=Object(o.J)((null===(r=e)||void 0===r?void 0:r.error_code)||0);i=`${t.desc};${t.how}`}else if(s){var l,c;if(null!==(l=e)&&void 0!==l&&l.message)i=null===(c=e)||void 0===c?void 0:c.message;this.$refs.uploadFile.reset(),this.$refs.uploadFile.addFiles([this.fileObj])}}this.$notify({message:this.$t("text.failUploadFile")+"!"+i,timeout:3e3,type:"negative",position:"top"});try{if(!await this.$refs.msgDlg.doShowMessage({title:this.$t("text.failUploadFile"),message:this.$t("text.failUploadAndRetry"),chooseButton:!0,okayTxt:this.$t("button.retry")}))return;this.onUploadFile(!1)}catch(t){this.callbackReject&&(this.callbackReject(!1),this.callbackResolve=null,this.callbackReject=null),this.resetFile(),this.opened=!1}},getFileSizeStr:t=>t<1024?t+"B":t<1048576?(t/1024).toFixed(2)+"KB":(t/1048576).toFixed(2)+"MB",getUploadFileTitle(){let t="";switch(this.fileType){case o.z.FILE_SROS_UPGRADE:case o.z.FILE_SRC_UPGRADE:t=this.$t("label.firmware");break;case o.z.FILE_MAP_PKG:t=this.$t("label.mapPage")}return t+this.$t("label.uploading")},getFileExtension(t){let e=t.lastIndexOf(".");return e<0?"":t.substr(e)}}},b=i("2877"),E=i("24e8"),A=i("f09f"),w=i("eb85"),S=i("2c91"),C=i("ee89"),I=i("9c40"),x=i("0016"),T=i("8380"),M=i("eebe"),P=i.n(M),O=Object(b.a)(v,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},on:{"escape-key":t.onClosed},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"default_dialog_style"},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.title},on:{close:t.onClosed}}),e("div",{staticClass:"text_small_light_grey q-mt-md"},[t._v(t._s(t.desc))]),e("q-separator",{staticClass:"text_small_light_grey q-mt-xs"}),e("div",{staticClass:"row q-mt-md"},[e("div",{staticClass:"text_main_grey_style div_align_vcenter"},[t._v(t._s(t.labTxt))]),e("q-space"),e("q-uploader",{ref:"uploadFile",staticClass:"hidden",attrs:{url:t.uploadUrl,accept:t.fileFilter,"form-fields":t.fileUploadParam,"field-name":t.uploadFieldName},on:{added:t.onAddUpdateFile,start:t.onStartUploadFile,uploading:t.onUploadingFile,uploaded:t.onUploadFinished,failed:t.onUploadFailed}}),null===t.fileObj?e("q-btn",{staticClass:"border_passive_style",staticStyle:{width:"240px",height:"36px"},attrs:{outline:"",dense:"",unelevated:"","no-caps":"",color:"transparent"},on:{click:t.chooseFile}},[e("q-icon",{staticClass:"std_file_grey q-mr-sm"}),e("div",{staticClass:"text_main_grey_style"},[t._v(t._s(t.$t("button.chooseFile")))])],1):e("div",{staticClass:"text_main_grey_style"},[t._v(t._s(t.fileInfo))])],1),e("div",{staticClass:"row q-my-md"},[e("q-space"),null!==t.fileObj?e("q-btn",{staticClass:"border_passive_style",staticStyle:{width:"140px",height:"28px"},attrs:{color:"transparent",size:"sm",outline:"",unelevated:"","no-caps":""},on:{click:t.onReselctFile}},[e("div",{staticClass:"text_small_grey_style"},[t._v(t._s(t.$t("button.rechooseFile")))])]):t._e(),e("q-btn",{staticClass:"border_passive_style q-ml-sm",staticStyle:{width:"140px",height:"28px"},attrs:{color:"transparent",size:"sm",outline:"","no-caps":""},on:{click:t.onClosed}},[e("div",{staticClass:"text_small_grey_style"},[t._v(t._s(t.$t("button.cancel")))])]),e("q-btn",{staticClass:"q-ml-sm text_small_white_style no-shadow",staticStyle:{width:"140px",height:"28px"},attrs:{size:"sm","no-caps":"",color:"primary",disable:null==t.fileObj||t.fileObj.size<=0||!t.filePrepared},on:{click:function(e){return t.onUploadFile(!0)}}},[t._v("\n          "+t._s(t.okTxt)+"\n          "),t.fileObj&&!t.filePrepared?[t._v("\n            Â "),e("q-spinner-dots",{attrs:{color:"white"}})]:t._e()],2)],1)],1)]),e("message-dialog",{ref:"msgDlg"}),e("progress-dialog",{ref:"progressDlg",attrs:{progress:t.uploadProgress}})],1)},[],!1,null,"7b97a7de",null);e.a=O.exports;P()(O,"components",{QDialog:E.a,QCard:A.a,QSeparator:w.a,QSpace:S.a,QUploader:C.a,QBtn:I.a,QIcon:x.a,QSpinnerDots:T.a})},"713c":function(t,e,i){"use strict";i.d(e,"a",function(){return a});let a="(ae6b09b2)[v2.36.18] 2025-10-15 03:18:16"},"750b":function(t,e,i){"use strict";i.d(e,"b",function(){return s}),i.d(e,"a",function(){return n}),i.d(e,"c",function(){return r}),i.d(e,"e",function(){return l}),i.d(e,"d",function(){return c});var a=i("b69e");const s=[a.e.AREA_TYPE_SPEED_LEVEL_20,a.e.AREA_TYPE_SPEED_LEVEL_40,a.e.AREA_TYPE_SPEED_LEVEL_60,a.e.AREA_TYPE_SPEED_LEVEL_80],n=[a.e.AREA_TYPE_NO_ENTER,a.e.AREA_TYPE_LIMIT_SPEEDS,...s,a.e.AREA_TYPE_DISABLE_OBA,a.e.AREA_TYPE_LOCAL_REPLAN,a.e.AREA_TYPE_DISABLE_ROTATE,a.e.AREA_TYPE_DISABLE_RACK_AUTO_CORRECT,a.e.AREA_TYPE_WORKSPACE_OBA,a.e.AREA_TYPE_LANE_LINE_AUXILIARY_LOCATE,a.e.AREA_TYPE_IO_OBA,a.e.AREA_TYPE_LIGHT_CTRL,a.e.AREA_TYPE_LIMIT_STOP,a.e.AREA_TYPE_CAMERA_CONTROL];var o=i("8847");const r=(t=0)=>{var e;return null!==(e={[a.e.AREA_TYPE_NO_ENTER]:o.b.t("label.regionTypeForbidden"),[a.e.AREA_TYPE_LIMIT_SPEEDS]:o.b.t("label.regionTypeLimitSpeeds"),[a.e.AREA_TYPE_SPEED_LEVEL_20]:o.b.t("label.slowDownTo",{level:20}),[a.e.AREA_TYPE_SPEED_LEVEL_40]:o.b.t("label.slowDownTo",{level:40}),[a.e.AREA_TYPE_SPEED_LEVEL_60]:o.b.t("label.slowDownTo",{level:60}),[a.e.AREA_TYPE_SPEED_LEVEL_80]:o.b.t("label.slowDownTo",{level:80}),[a.e.AREA_TYPE_DISABLE_OBA]:o.b.t("label.regionTypeDisableOba"),[a.e.AREA_TYPE_LOCAL_REPLAN]:o.b.t("label.regionTypeLocalReplan"),[a.e.AREA_TYPE_DISABLE_ROTATE]:o.b.t("label.regionTypeLimitRotate"),[a.e.AREA_TYPE_DISABLE_RACK_AUTO_CORRECT]:o.b.t("label.disableRackAutoCorrectRegion"),[a.e.AREA_TYPE_WORKSPACE_OBA]:o.b.t("label.workspaceAvoidRegion"),[a.e.AREA_TYPE_LANE_LINE_AUXILIARY_LOCATE]:o.b.t("label.laneLineAuxiliaryLocateRegion"),[a.e.AREA_TYPE_IO_OBA]:o.b.t("label.ioAvoidRegion"),[a.e.AREA_TYPE_LIGHT_CTRL]:o.b.t("label.lightControlRegion"),[a.e.AREA_TYPE_LIMIT_STOP]:o.b.t("label.limitStopRegion"),[a.e.AREA_TYPE_CAMERA_CONTROL]:o.b.t("label.cameraControlRegion"),[a.e.AREA_TYPE_USER_DEFINE]:o.b.t("label.regionTypeUserDefined")}[t])&&void 0!==e?e:""},l=(t=0)=>{var e;return null!==(e={[a.e.AREA_TYPE_NO_ENTER]:[],[a.e.AREA_TYPE_SPEED_LEVEL_20]:[a.e.AREA_TYPE_NO_ENTER,a.e.AREA_TYPE_LIMIT_SPEEDS],[a.e.AREA_TYPE_SPEED_LEVEL_40]:[a.e.AREA_TYPE_NO_ENTER,a.e.AREA_TYPE_LIMIT_SPEEDS],[a.e.AREA_TYPE_SPEED_LEVEL_60]:[a.e.AREA_TYPE_NO_ENTER,a.e.AREA_TYPE_LIMIT_SPEEDS],[a.e.AREA_TYPE_SPEED_LEVEL_80]:[a.e.AREA_TYPE_NO_ENTER,a.e.AREA_TYPE_LIMIT_SPEEDS],[a.e.AREA_TYPE_DISABLE_OBA]:[a.e.AREA_TYPE_NO_ENTER,a.e.AREA_TYPE_LOCAL_REPLAN,a.e.AREA_TYPE_IO_OBA,a.e.AREA_TYPE_WORKSPACE_OBA,a.e.AREA_TYPE_LANE_LINE_AUXILIARY_LOCATE],[a.e.AREA_TYPE_WORKSPACE_OBA]:[a.e.AREA_TYPE_NO_ENTER,a.e.AREA_TYPE_DISABLE_OBA],[a.e.AREA_TYPE_IO_OBA]:[a.e.AREA_TYPE_NO_ENTER,a.e.AREA_TYPE_DISABLE_OBA],[a.e.AREA_TYPE_LIMIT_SPEEDS]:[a.e.AREA_TYPE_NO_ENTER,...s],[a.e.AREA_TYPE_DISABLE_ROTATE]:[a.e.AREA_TYPE_NO_ENTER],[a.e.AREA_TYPE_LOCAL_REPLAN]:[a.e.AREA_TYPE_NO_ENTER,a.e.AREA_TYPE_DISABLE_OBA],[a.e.AREA_TYPE_LIGHT_CTRL]:[a.e.AREA_TYPE_NO_ENTER],[a.e.AREA_TYPE_LIMIT_STOP]:[a.e.AREA_TYPE_NO_ENTER],[a.e.AREA_TYPE_LANE_LINE_AUXILIARY_LOCATE]:[a.e.AREA_TYPE_NO_ENTER],[a.e.AREA_TYPE_DISABLE_RACK_AUTO_CORRECT]:[a.e.AREA_TYPE_NO_ENTER],[a.e.AREA_TYPE_CAMERA_CONTROL]:[a.e.AREA_TYPE_NO_ENTER]}[t])&&void 0!==e?e:[]},c=(t=0)=>{var e;return null!==(e={[a.e.AREA_TYPE_DISABLE_OBA]:[o.b.t("label.specialAvoidanceArea")]}[t])&&void 0!==e?e:[]}},"7a6b":function(t,e,i){"use strict";var a=i("adb7"),s={name:"checkboxList",props:{checkboxItems:Array},methods:{getClass:t=>t.type===a.h||117===t.key?"q-pl-lg":"",onInput(t){this.$emit("change",t)}}},n=i("2877"),o=i("1c1c"),r=i("66e5"),l=i("4074"),c=i("8f8e"),d=i("0170"),h=i("eebe"),u=i.n(h),p=Object(n.a)(s,function(){var t=this,e=t._self._c;return e("q-list",{staticStyle:{width:"238px"}},t._l(t.checkboxItems,function(i){return e("q-item",{key:i.id,staticClass:"row",staticStyle:{height:"36px"},attrs:{clickable:""}},[e("q-item-section",{class:["col-3",t.getClass(i)]},[e("q-checkbox",{attrs:{color:i.state?"primary":"grey"},nativeOn:{click:function(e){return t.onInput(i)}},model:{value:i.state,callback:function(e){t.$set(i,"state",e)},expression:"item.state"}})],1),e("q-item-section",{staticClass:"col=7"},[e("q-item-label",{staticClass:"text_main_grey_style text-right"},[t._v(t._s(i.name))])],1)],1)}),1)},[],!1,null,"3714b520",null);e.a=p.exports;u()(p,"components",{QList:o.a,QItem:r.a,QItemSection:l.a,QCheckbox:c.a,QItemLabel:d.a})},8163:function(t,e,i){"use strict";i("f665"),i("ab43");var a=i("f226"),s=i("2f62"),n=i("dde5"),o=i("af60"),r=i("436b"),l=(i("910d"),i("7d54"),i("8847")),c=i("73cf"),d=i("b965"),h=i("1d79"),u=i("5609");class p extends h.a{constructor(t,e){super(t,e),this.runningVehicleObaInfo=u.d,this.obaBaseModelBox=null,this.obaCarSimulatePosesDebugPolygonsGroup=null}renderRunningObaInfo(t=u.d,e=[]){this.setRunningObaInfoData(t),this.renderRunningObaBaseModel(),this.renderRunningObaFuncArea(e)}setRunningObaInfoData(t=u.d){const{navStopDistance:e,navSlowDistance:i,navBackwardStopDistance:a,navBackwardSlowDistance:s,navStopLeftWidthOffset:n,navStopRightWidthOffset:o,navSlowWidthOffset:r,navStopForwardOffset:l,baseModelInfo:c,baseModelPose:h}=t,{length:p,width:m,upHeight:f,downHeight:g}=c,{x:_,y:y,z:v}=h;this.runningVehicleObaInfo={navStopDistance:Object(d.y)(e),navSlowDistance:Object(d.y)(i),navBackwardStopDistance:Object(d.y)(a),navBackwardSlowDistance:Object(d.y)(s),navStopLeftWidthOffset:Object(d.y)(n),navStopRightWidthOffset:Object(d.y)(o),navSlowWidthOffset:Object(d.y)(r),navStopForwardOffset:Object(d.y)(l),baseModelInfo:{length:Object(d.y)(p),width:Object(d.y)(m),upHeight:Object(d.y)(f),downHeight:Object(d.y)(g)},baseModelPose:{x:Object(d.y)(_),y:Object(d.y)(y),z:Object(d.y)(v)}}}renderRunningObaBaseModel(){var t;null===(t=this.obaBaseModelBox)||void 0===t||t.mesh.removeFromParent();const{baseModelInfo:e,baseModelPose:i}=this.runningVehicleObaInfo,{length:a,width:s,upHeight:n,downHeight:o}=e,{x:r,y:l,z:c}=i,h={width:a,height:s,depth:n-o,color:"rgb(141, 110, 99)",opacity:.7};window.obaBaseModelBox=this.obaBaseModelBox=Object(d.A)(h,[r,l,c]),this.addMeshes([this.obaBaseModelBox.mesh])}renderRunningObaFuncArea(t=[]){const e={"nav.stop_distance":t=>{this.renderFrontwardStop(t)},"nav.slow_distance":t=>{this.renderFrontwardSlow(t)},"nav.backward_stop_distance":t=>{this.renderBackwardStop(t)},"nav.backward_slow_distance":t=>{this.renderBackwardSlow(t)},"nav.stop_left_width_offset":t=>{this.renderLeftwardStop(t)},"nav.stop_right_width_offset":t=>{this.renderRightwardStop(t)},"nav.slow_width_offset":t=>{this.renderDoubleSideSlow(t)},"nav.stop_forward_offset":t=>{this.renderRotationStop(t)}};t.forEach(({key:t="",visible:i=!1,disable:a=!1})=>{var s;!a&&(null===(s=e[t])||void 0===s||s.call(e,i))})}renderFrontwardStop(t){var e;if(null===(e=this.frontwardStop)||void 0===e||e.mesh.removeFromParent(),!t)return;const{navStopDistance:i}=this.runningVehicleObaInfo,a={width:i,height:this.obaBaseModelBoxWidth,depth:this.obaBaseModelBoxHeight,color:"rgb(201, 28, 0)",opacity:Object(d.N)(.2,i>0?0:.5)};this.frontwardStop=Object(d.z)(a,this.obaBaseModelBox,"x");const s=this.frontwardStop.getPosition();this.frontwardStop.setPosition(s.x,s.y,this.obaBaseModelBoxPosition.z),this.addMeshes([this.frontwardStop.mesh])}renderFrontwardSlow(t){var e;if(null===(e=this.frontwardSlow)||void 0===e||e.mesh.removeFromParent(),!t)return;const{navSlowDistance:i}=this.runningVehicleObaInfo,a={width:i,height:this.obaBaseModelBoxWidth,depth:this.obaBaseModelBoxHeight,color:"#CCCA8C",opacity:Object(d.N)(.5,i>0?0:.5)};this.frontwardSlow=Object(d.z)(a,this.obaBaseModelBox,"x");const s=this.frontwardSlow.getPosition();this.frontwardSlow.setPosition(s.x,s.y,this.obaBaseModelBoxPosition.z),this.addMeshes([this.frontwardSlow.mesh])}renderBackwardStop(t){var e;if(null===(e=this.backwardStop)||void 0===e||e.mesh.removeFromParent(),!t)return;const{navBackwardStopDistance:i}=this.runningVehicleObaInfo,a={width:i,height:this.obaBaseModelBoxWidth,depth:this.obaBaseModelBoxHeight,color:"rgb(201, 28, 0)",opacity:Object(d.N)(.2,i>0?0:.5)};this.backwardStop=Object(d.z)(a,this.obaBaseModelBox,"-x");const s=this.backwardStop.getPosition();this.backwardStop.setPosition(s.x,s.y,this.obaBaseModelBoxPosition.z),this.addMeshes([this.backwardStop.mesh])}renderBackwardSlow(t){var e;if(null===(e=this.backwardSlow)||void 0===e||e.mesh.removeFromParent(),!t)return;const{navBackwardSlowDistance:i}=this.runningVehicleObaInfo,a={width:i,height:this.obaBaseModelBoxWidth,depth:this.obaBaseModelBoxHeight,color:"#CCCA8C",opacity:Object(d.N)(.5,i>0?0:.5)};this.backwardSlow=Object(d.z)(a,this.obaBaseModelBox,"-x");const s=this.backwardSlow.getPosition();this.backwardSlow.setPosition(s.x,s.y,this.obaBaseModelBoxPosition.z),this.addMeshes([this.backwardSlow.mesh])}renderLeftwardStop(t){var e;if(null===(e=this.leftwardStop)||void 0===e||e.mesh.removeFromParent(),!t)return;const{navStopLeftWidthOffset:i,navStopDistance:a,navBackwardStopDistance:s}=this.runningVehicleObaInfo,n={width:this.obaBaseModelBoxLength+a+s,height:i,depth:this.obaBaseModelBoxHeight,color:"rgb(201, 28, 0)",opacity:Object(d.N)(.2,i>0?0:.5)};this.leftwardStop=Object(d.z)(n,this.obaBaseModelBox,"y");const o=this.leftwardStop.getPosition();this.leftwardStop.setPosition(o.x+(a-s)/2,o.y,this.obaBaseModelBoxPosition.z),this.addMeshes([this.leftwardStop.mesh])}renderRightwardStop(t){var e;if(null===(e=this.rightwardStop)||void 0===e||e.mesh.removeFromParent(),!t)return;const{navStopRightWidthOffset:i,navStopDistance:a,navBackwardStopDistance:s}=this.runningVehicleObaInfo,n={width:this.obaBaseModelBoxLength+a+s,height:i,depth:this.obaBaseModelBoxHeight,color:"rgb(201, 28, 0)",opacity:Object(d.N)(.2,i>0?0:.5)};this.rightwardStop=Object(d.z)(n,this.obaBaseModelBox,"-y");const o=this.rightwardStop.getPosition();this.rightwardStop.setPosition(o.x+(a-s)/2,o.y,this.obaBaseModelBoxPosition.z),this.addMeshes([this.rightwardStop.mesh])}renderDoubleSideSlow(t){if(this.doubleSideSlowList.forEach(t=>t.mesh.removeFromParent()),this.doubleSideSlowList=[],!t)return;const{navSlowWidthOffset:e,navStopDistance:i,navBackwardStopDistance:a}=this.runningVehicleObaInfo,s={width:this.obaBaseModelBoxLength+i+a,height:e,depth:this.obaBaseModelBoxHeight,color:"#CCCA8C",opacity:Object(d.N)(.5,e>0?0:.5)},n=Object(d.z)(s,this.obaBaseModelBox,"y"),o=Object(d.z)(s,this.obaBaseModelBox,"-y"),r=(i-a)/2,l=n.getPosition(),c=o.getPosition();n.setPosition(l.x+r,l.y,this.obaBaseModelBoxPosition.z),o.setPosition(c.x+r,c.y,this.obaBaseModelBoxPosition.z),this.doubleSideSlowList.push(n,o),this.addMeshes([n.mesh,o.mesh])}renderRotationStop(t){var e;if(null===(e=this.rotationStop)||void 0===e||e.mesh.removeFromParent(),!t)return;const{navStopForwardOffset:i}=this.runningVehicleObaInfo,a=Math.sqrt((this.obaBaseModelBoxLength/2)**2+(this.obaBaseModelBoxWidth/2)**2),s={innerRadius:a,outerRadius:a+i,height:this.obaBaseModelBoxHeight,color:"red",opacity:Object(d.N)(.5,i>0?0:.5),outline:{color:"rgb(240,161,0)",width:.2,visible:!0}},{x:n,y:o,z:r}=this.obaBaseModelBox.getPosition();this.rotationStop=Object(d.C)(s,[n,o,r-this.obaBaseModelBoxHeight/2]),this.addMeshes([this.rotationStop.mesh])}renderCarSimulatePosesDebugPolygons(t={},e=[]){var i;if(null===(i=this.obaCarSimulatePosesDebugPolygonsGroup)||void 0===i||i.clear(),0===e.length)return;this.obaCarSimulatePosesDebugPolygonsGroup||(this.obaCarSimulatePosesDebugPolygonsGroup=this.obaScene.addGroup());const a=Object(c.k)(t,e);this.obaCarSimulatePosesDebugPolygonsGroup.add(...a)}get obaBaseModelBoxLength(){var t,e;return null!==(t=null===(e=this.obaBaseModelBox)||void 0===e?void 0:e.getGeometrySize().width)&&void 0!==t?t:0}get obaBaseModelBoxWidth(){var t,e;return null!==(t=null===(e=this.obaBaseModelBox)||void 0===e?void 0:e.getGeometrySize().height)&&void 0!==t?t:0}get obaBaseModelBoxHeight(){var t,e;return null!==(t=null===(e=this.obaBaseModelBox)||void 0===e?void 0:e.getGeometrySize().depth)&&void 0!==t?t:0}get obaBaseModelBoxPosition(){var t,e;return null!==(t=null===(e=this.obaBaseModelBox)||void 0===e?void 0:e.getPosition())&&void 0!==t?t:{x:0,y:0,z:0}}}var m=i("adb7"),f=i("abc6"),g=i("f2b3"),_={name:"VehicleObaInfoDialog",computed:{...Object(s.f)(["curLang","sensorColorDisplayMap"]),...Object(s.f)("srp",["laserPoint","avoidPolygonInfo"]),...Object(s.d)(["uiServerDomain"]),...Object(s.d)("srp",["pose","laserPointNo","isObstacleAppearing"]),obstacleModelInfo(){return this.$store.state.srp.systemState.obstacleModelInfo},obaLaserPoints(){if(!this.isObstacleAppearing)return[];const t=Object(m.r)(this.pose);return Object.freeze(Object(m.u)(this.laserPoint.obaLaserPoints,!0).map(e=>({...e,points:e.points.map(({x:e,y:i,z:a})=>Object(c.j)(t,{x:Object(g.b)(e,"mm"),y:Object(g.b)(i,"mm"),z:Object(g.b)(a,"mm")}))})))},isCarSimulatePosesDebugShow(){var t;return null===(t=this.obaDebugList.find(t=>"carSimulatePosesDebug"===t.key))||void 0===t?void 0:t.visible},isObaFeaturePointShow(){var t;return null===(t=this.obaFeaturePointsList.find(t=>t.key===d.k.OBA_POINT))||void 0===t?void 0:t.visible},isActive(){return this.obaManager&&this.dialogOpened}},data(){return{dialogOpened:!1,isMobile:this.$q.platform.is.mobile,loading:!1,dbObaConfigs:d.f,runningObaFuncAreaList:[{key:"nav.stop_distance",valueKey:"navStopDistance",name:l.b.t("label.forwardObstacleStopDistance"),value:0,visible:!0,disable:!1},{key:"nav.slow_distance",valueKey:"navSlowDistance",name:l.b.t("label.forwardObstacleDecelerateDistance"),value:0,visible:!0,disable:!1},{key:"nav.backward_stop_distance",valueKey:"navBackwardStopDistance",name:l.b.t("label.backwardObstacleStopDistance"),value:0,visible:!1,disable:!1},{key:"nav.backward_slow_distance",valueKey:"navBackwardSlowDistance",name:l.b.t("label.backwardObstacleDecelerateDistance"),value:0,visible:!1,disable:!1},{key:"nav.stop_left_width_offset",valueKey:"navStopLeftWidthOffset",name:l.b.t("label.leftStopWidthIncrement"),value:0,visible:!0,disable:!1},{key:"nav.stop_right_width_offset",valueKey:"navStopRightWidthOffset",name:l.b.t("label.rightStopWidthIncrement"),value:0,visible:!0,disable:!1},{key:"nav.slow_width_offset",valueKey:"navSlowWidthOffset",name:l.b.t("label.sideDecelerateWidthIncrement"),value:0,visible:!0,disable:!1},{key:"nav.stop_forward_offset",valueKey:"navStopForwardOffset",name:l.b.t("label.rotationStopDistanceIncrement"),value:0,visible:!1,disable:!1},{key:"obstacle.detect_min_height",valueKey:"baseModelInfo.downHeight",name:l.b.t("label.obstacleMinHeight"),value:0,visible:!0,disable:!0},{key:"obstacle.detect_max_height",valueKey:"baseModelInfo.upHeight",name:l.b.t("label.obstacleMaxHeight"),value:0,visible:!0,disable:!0}],obaDebugList:[{key:"carSimulatePosesDebug",name:this.$t("label.showAvoidRectangle"),visible:!1}],obaFeaturePointsList:[{key:d.k.OBA_POINT,name:l.b.t("label.obstaclePointCloud"),visible:!0}],isShowAllLaser:!0,sensorOriginPointCloudList:[],sensorOriginObaPointsList:[],sensorDisplayList:[],obaScene:null,obaManager:null}},methods:{...Object(s.c)("srp",["setAutoUploadLaserPoint","setAutoUploadAvoidRectangleList"]),async init(){this.dialogOpened=!0,await this.setAutoUploadLaserPoint(!0),await this.initAllData(),this.$nextTick(()=>{this.initRender()})},closeDialog(){this.dialogOpened=!1,this.$emit("update:componentId","")},async initRender(){this.createObaScene(),this.initCamera(this.laserPoint.vehicleObaInfo.baseModelInfo.upHeight/100),this.obaScene.render(),await this.renderStdOba()},async initAllData(){this.dbObaConfigs=await Object(d.M)(this.curLang),this.initSensorDisplayList(this.dbObaConfigs.device_info)},async renderStdOba(){var t;null===(t=this.obaManager)||void 0===t||t.removeElementGroup(),this.obaManager=new p([],this.dbObaConfigs.device_info),this.obaManager.setObaScene(this.obaScene),this.obaManager.setElementGroup(this.obaScene.addGroup()),this.obaManager.renderVehicleBody(this.uiServerDomain,!0),this.obaManager.initDeviceSensorList()},createObaScene(){const{width:t=0,height:e=0}=Object(d.G)("#vehicle-oba-running");this.obaScene=new c.f({width:Math.floor(t),height:Math.floor(e),element:"#vehicle-oba-running"})},initCamera(t){let e=t;e<=0?e=5:e>10&&(e/=2),this.obaScene.setCameraPosition(-.001,e,e)},updateRunningObaFuncAreaList(t){this.runningObaFuncAreaList.forEach(e=>{e.value=Object(f.a)(t,e.valueKey,0)}),this.isActive&&this.obaManager.renderRunningObaInfo(t,this.runningObaFuncAreaList)},setObaDebugItemVisible(t){var e;const{key:i,visible:a}=t,s={carSimulatePosesDebug:async()=>{a&&(await this.setAutoUploadAvoidRectangleList(a),await Object(n.O)(100),this.renderCarSimulatePosesDebugPolygons(this.avoidPolygonInfo,this.pose))}};null===(e=s[i])||void 0===e||e.call(s)},renderCarSimulatePosesDebugPolygons(t,e){if(!this.isActive||!this.isCarSimulatePosesDebugShow)return;const{type:i}=t;if(1!==i)return;let{carSimulatePoses:a=[]}=this.avoidPolygonInfo;this.obaManager.renderCarSimulatePosesDebugPolygons(Object(m.r)(e),a)},updatePointCloudsList(t={},e={}){const i={isActive:this.isActive,sensorColorDisplayMap:this.sensorColorDisplayMap,isShowAllLaser:this.isShowAllLaser,isMobile:this.isMobile,colorType:"sensorColor",colorDefault:"#70f3ff",visibleDefault:!1},{locLaserPoints:a=[],extLaser_3dPoints:s=[],obaPointInfos:n=[]}=t,o=Object(m.A)(a,this.sensorOriginPointCloudList,i),r=Object(m.A)(s,this.sensorOriginPointCloudList,{...i,colorDefault:"#ffd600"});this.isActive&&(this.obaManager.renderPointCloudList(Object(m.r)(e),[...o,...r]),this.obaManager.renderObaPointeInfoList(this.obaScene,this.isObaFeaturePointShow?n:[]))},initSensorDisplayList(t=[]){this.sensorDisplayList=[{key:d.k.VEHICLE_BODY,name:this.$t("label.vehicleModel"),device_type:d.j.CHASSIS,visible:!0},...t.filter(({device_type:t})=>[d.j.LIDAR,d.j.CAMERA].includes(t)).map(({device_id:t,device_name:e,device_type:i})=>({key:t,name:e,type:d.k.VEHICLE_BODY,color:Object(m.x)(this.sensorColorDisplayMap,"sensorColor",t,"#70f3ff"),device_type:i,visible:!1}))]},toggleSensorDisplayVisible(t){const{key:e,visible:i}=t,a={[d.k.VEHICLE_BODY]:()=>{this.obaManager.setVehicleBodyVisible(i)}};a[e]?a[e]():this.obaManager.setDeviceSensorVisible(t)}},watch:{laserPointNo(){this.isActive&&(this.updateRunningObaFuncAreaList(this.laserPoint.vehicleObaInfo),this.updatePointCloudsList(this.laserPoint,this.pose))},avoidPolygonInfo(){this.isActive&&this.renderCarSimulatePosesDebugPolygons(this.avoidPolygonInfo,this.pose)}},mounted(){this.init()},beforeDestroy(){var t;this.obaManager=null,null===(t=this.obaScene)||void 0===t||t.dispose()}},y=i("2877"),v=i("24e8"),b=i("f09f"),E=i("a370"),A=i("65c6"),w=i("6ac5"),S=i("9c40"),C=i("1c1c"),I=i("0170"),x=i("66e5"),T=i("4074"),M=i("8f8e"),P=i("eebe"),O=i.n(P),L=Object(y.a)(_,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{persistent:"","transition-show":"flip-down","transition-hide":"flip-up"},model:{value:t.dialogOpened,callback:function(e){t.dialogOpened=e},expression:"dialogOpened"}},[e("q-card",{staticClass:"large_card_style column no-wrap"},[e("q-card-section",{staticClass:"no-padding"},[e("q-toolbar",{staticClass:"bg-primary text-white shadow-2",attrs:{dense:""}},[e("q-toolbar-title",[t._v(t._s(t.$t("label.obstacleInformation")))]),e("q-btn",{attrs:{flat:"",dense:"",icon:"close"},on:{click:t.closeDialog}})],1)],1),e("q-card-section",{staticClass:"no-padding row no-wrap overflow-auto"},[e("div",{staticClass:"relative-position col-10",attrs:{id:"vehicle-oba-running"}}),e("div",{staticClass:"col-2 column no-wrap overflow-auto",staticStyle:{"max-height":"90vh"}},[e("q-list",{staticClass:"q-my-xs",attrs:{dense:"","no-border":""}},[e("q-item-label",{staticClass:"q-py-sm q-px-none",attrs:{header:""}},[t._v("\n            "+t._s(t.$t("label.obstacleModelDiagram"))+"\n          ")]),t._l(t.runningObaFuncAreaList,function(i){return e("q-item",{key:i.key,staticClass:"no-padding"},[e("q-item-section",{attrs:{side:""}},[e("q-checkbox",{attrs:{dense:"","checked-icon":"mdi-eye-outline","unchecked-icon":"mdi-eye-off-outline",disable:i.disable},model:{value:i.visible,callback:function(e){t.$set(i,"visible",e)},expression:"item.visible"}})],1),e("q-item-section",[t._v(t._s(i.name))]),e("q-item-section",[t._v(t._s(i.value)+" mm")])],1)}),e("q-item-label",{staticClass:"q-py-sm q-px-none",attrs:{header:""}},[t._v("\n            "+t._s(t.$t("label.showAvoidRectangle"))+"\n          ")]),t._l(t.obaDebugList,function(i){return e("q-item",{key:i.key,staticClass:"no-padding"},[e("q-item-section",{attrs:{side:""}},[e("q-checkbox",{attrs:{dense:"","checked-icon":"mdi-eye-outline","unchecked-icon":"mdi-eye-off-outline"},on:{input:function(e){return t.setObaDebugItemVisible(i)}},model:{value:i.visible,callback:function(e){t.$set(i,"visible",e)},expression:"item.visible"}})],1),e("q-item-section",[t._v(t._s(i.name))])],1)}),e("q-item-label",{staticClass:"q-py-sm q-px-none",attrs:{header:""}},[t._v("\n            "+t._s(t.$t("label.obstaclePointCloud"))+"\n          ")]),t._l(t.obaFeaturePointsList,function(i){return e("q-item",{key:i.key,staticClass:"no-padding"},[e("q-item-section",{attrs:{side:""}},[e("q-checkbox",{attrs:{dense:"","checked-icon":"mdi-eye-outline","unchecked-icon":"mdi-eye-off-outline"},model:{value:i.visible,callback:function(e){t.$set(i,"visible",e)},expression:"item.visible"}})],1),e("q-item-section",[t._v(t._s(i.name))])],1)}),e("q-item-label",{staticClass:"q-py-sm q-px-none",attrs:{header:""}},[t._v("\n            "+t._s(t.$t("label.sensorPointCloud"))+"\n          ")]),e("q-item",{staticClass:"no-padding"},[t.sensorOriginPointCloudList.length?e("q-item-section",[e("div",{staticClass:"q-gutter-sm"},t._l(t.sensorOriginPointCloudList,function(i){return e("q-checkbox",{key:i.sensorUuid,attrs:{dense:"","checked-icon":"mdi-eye-outline","unchecked-icon":"mdi-eye-off-outline",label:i.sensorName},model:{value:i.visible,callback:function(e){t.$set(i,"visible",e)},expression:"item.visible"}})}),1)]):e("q-checkbox",{attrs:{dense:"",value:!0,color:"orange","checked-icon":"mdi-flask-empty-outline",label:t.$q.lang.table.noData,disable:""}})],1),e("q-item-label",{staticClass:"q-py-sm q-px-none",attrs:{header:""}},[t._v("\n            "+t._s(t.$t("label.sensorDiagram"))+"\n          ")]),e("q-item",{staticClass:"no-padding"},[e("q-item-section",[e("div",{staticClass:"q-gutter-sm"},t._l(t.sensorDisplayList,function(i){return e("q-checkbox",{key:i.key,attrs:{dense:"","checked-icon":"mdi-eye-outline","unchecked-icon":"mdi-eye-off-outline",label:i.name},on:{input:function(e){return t.toggleSensorDisplayVisible(i)}},model:{value:i.visible,callback:function(e){t.$set(i,"visible",e)},expression:"item.visible"}})}),1)])],1),e("q-item-label",{staticClass:"q-py-sm q-px-none",attrs:{header:""}},[t._v("\n            "+t._s(t.$t("label.obstacleInformation"))+"\n          ")]),e("q-item",{staticClass:"no-padding"},[e("q-item-section",[e("div",{staticClass:"q-gutter-sm q-ml-md"},[e("span",[t._v(t._s(t.$t("label.lengthWord"))+"ï¼"+t._s(t.obstacleModelInfo.length)+" mm")]),e("br"),e("span",[t._v(t._s(t.$t("label.widthWord"))+"ï¼"+t._s(t.obstacleModelInfo.width)+" mm")]),e("br"),e("span",[t._v(t._s(t.$t("label.suspend"))+"ï¼"+t._s(t.obstacleModelInfo.upHeight)+" mm")]),e("br"),e("span",[t._v(t._s(t.$t("label.low"))+"ï¼"+t._s(t.obstacleModelInfo.downHeight)+" mm")])])])],1),e("q-item-label",{staticClass:"q-py-sm q-px-none",attrs:{header:""}},[t._v("\n            "+t._s(t.$t("label.obstacleAvoidanceSource"))+"\n          ")]),t.isObstacleAppearing&&t.obaLaserPoints.length?t._e():e("q-item",{staticClass:"no-padding"},[t.sensorOriginObaPointsList.length?t._e():e("q-checkbox",{attrs:{dense:"",value:!0,color:"orange","checked-icon":"mdi-flask-empty-outline",label:t.$q.lang.table.noData,disable:""}})],1),t._l(t.obaLaserPoints,function(i){return e("q-item",{key:i.sensorUuid,staticClass:"no-padding"},[e("q-item-section",[e("q-item-label",[t._v(t._s(i.sensorName)+":")]),e("q-item-label",{staticClass:"no-padding",attrs:{caption:""}},[t._v(t._s(i.points))])],1)],1)})],2)],1)])],1)],1)},[],!1,null,null,null),R=L.exports;O()(L,"components",{QDialog:v.a,QCard:b.a,QCardSection:E.a,QToolbar:A.a,QToolbarTitle:w.a,QBtn:S.a,QList:C.a,QItemLabel:I.a,QItem:x.a,QItemSection:T.a,QCheckbox:M.a});var D={name:"SystemStatus",components:{VehicleObaInfoDialog:R},data:()=>({currentMapStations:[],isSystemStateExpand:!0,componentId:""}),props:{isCanToggleMap:{type:Boolean,default:!0}},computed:{...Object(s.f)(["sensorColorDisplayMap","pgvInfoState"]),...Object(s.d)("srp",["mapName","stationNo","forkliftState","displayedMapNameIsEqualSrosCurMapName","isNotForkLiftRobot","isObstacleAppearing"]),locationSucceed(){return this.$store.getters["srp/isLocationSucceed"]},isCanClickToggleMap(){return this.isCanToggleMap&&!this.displayedMapNameIsEqualSrosCurMapName},systemStateList(){var t,e,i,a;return[{name:this.$t("label.systemState"),key:"systemState",value:this.sysState,isCollapse:!1,showRule:!0,clickable:!1},{name:this.$t("label.currentStation"),key:"currentStation",tips:this.$t("button.goLocationMap"),value:this.stationState,isCollapse:!1,showRule:!0,clickable:this.isCanClickToggleMap},{name:this.$t("label.localState"),key:"localState",value:this.locationState,isCollapse:!1,showRule:!0,clickable:!1},{name:this.$t("label.currentPose"),key:"currentPose",value:this.locationPose,isCollapse:!1,showRule:!0,clickable:!1},{name:this.$t("label.moveState"),key:"moveState",value:this.labMoveState,isCollapse:!0,showRule:!0,clickable:!1},{name:this.$t("label.actionState"),key:"actionState",value:this.curActionStateData.message,isCollapse:!0,showRule:!0,tips:this.curActionStateData.errorCode,clickable:this.curActionStateData.failed},{name:this.$t("label.emergencyState"),key:"emergencyState",value:this.emergencyState,isCollapse:!0,showRule:!0,clickable:!1},{name:this.$t("label.exclusiveState"),key:"exclusiveState",value:this.lockedState,isCollapse:!0,showRule:!1,clickable:!1},{name:this.$t("label.currentPGV"),key:"currentPGV",value:this.currentPGV,isCollapse:!0,showRule:this.pgvInfoState.state,clickable:!1},{name:this.$t("label.pgvStation"),key:"pgvStation",value:this.stationPGV,isCollapse:!0,showRule:this.pgvInfoState.state,clickable:!1},{name:this.$t("label.qrCodeGlobalPosition"),key:"qrCodeGlobalPosition",value:this.qrCodeGlobalPosition,isCollapse:!0,showRule:this.pgvInfoState.state,clickable:!1},{name:this.$t("label.currentSpeed"),key:"currentSpeed",value:this.curSpeed,isCollapse:!0,showRule:!0,clickable:!1},{name:this.$t("label.moveProgress"),key:"moveProgress",value:this.moveDistance,isCollapse:!0,showRule:!0,clickable:!1},{name:this.$t("label.forkliftArmHeight"),key:"forkliftArmHeight",value:((null===(t=this.forkliftState)||void 0===t?void 0:t.armHeight)||0).toFixed(3)+"m",isCollapse:!0,showRule:!this.isNotForkLiftRobot,clickable:!1},{name:this.$t("label.steeringAngle"),key:"steeringAngle",value:((null===(e=this.forkliftState)||void 0===e?void 0:e.steeringAngle)||0).toFixed(2)+"Â°",isCollapse:!0,showRule:!this.isNotForkLiftRobot,clickable:!1},{name:this.$t("label.forwardMoveDistance"),key:"forwardMoveDistance",value:(1e3*((null===(i=this.forkliftState)||void 0===i?void 0:i.forkLeftRightEncoderValue)||0)).toFixed(3)+" mm",isCollapse:!0,showRule:!this.isNotForkLiftRobot,clickable:!1},{name:this.$t("label.sideMoveDistance"),key:"sideMoveDistance",value:(1e3*((null===(a=this.forkliftState)||void 0===a?void 0:a.forkFrontBackEncoderValue)||0)).toFixed(3)+" mm",isCollapse:!0,showRule:!this.isNotForkLiftRobot,clickable:!1},{name:this.$t("label.rackInfoState"),key:"rackInfoState",value:`${this.rackInfoState.rackName},${this.rackInfoState.loadType},${this.rackInfoState.rackLength.toFixed(0)} mm,${this.rackInfoState.rackWidth.toFixed(0)} mm,${this.getRackInfoStateSource()}`,isCollapse:!1,showRule:!0,clickable:!1,tips:this.$t("label.rackInfoState")},{name:this.$t("label.obstacleInformation"),key:"obstacleModelInfo",value:`${this.$t("label.lengthWord")},${this.$t("label.widthWord")},${this.$t("label.suspend")},${this.$t("label.low")}: ${this.obstacleModelInfo.length.toFixed(0)}, ${this.obstacleModelInfo.width.toFixed(0)},\n          ${this.obstacleModelInfo.upHeight.toFixed(0)}, ${this.obstacleModelInfo.downHeight.toFixed(0)} (mm) ${this.obaSensorNames}`,isCollapse:!1,showRule:!0,clickable:!0,tips:this.$t("label.obstacleInformation")},{name:this.$t("label.goodsPose"),key:"goodsPose",value:this.curGoodsPose,isCollapse:!0,showRule:!0,clickable:!1}].filter(t=>t.showRule&&(!!this.isSystemStateExpand||!t.isCollapse))},stationState:function(){var t;if(this.isUnconnected())return"";const e=this.stationNo,i=0!==e&&(null===(t=this.currentMapStations.find(t=>t.id===this.stationNo))||void 0===t?void 0:t.name)||"";return i?`#${e} (${i}) @${this.mapName}`:`#${e} @${this.mapName}`},...Object(s.f)({sysState:function(t){return a.d.systemStateString(t.srp.systemState)},obaSensorNames(t){if(!this.isObstacleAppearing)return"";const e=t.srp.laserPoint.obaLaserPoints.map(({sensorUuid:t,sensorName:e=i18n.t("label.others")})=>{var i;return null!==(i=this.sensorColorDisplayMap.sensorNameMapping[t])&&void 0!==i?i:e}).join(", ");return this.$t("label.obstacleAvoidanceSource")+": "+e},locationState:function(t){return`${a.d.locationStateString(t.srp.systemState.locationState)}${this.locationTypeStr}(${this.locationConfidence}%)`},locationTypeStr(t){const e={0:"",1:this.$t("label.laserLocation"),2:this.$t("label.qrCodeLocation"),3:this.$t("label.lmkLocation"),4:this.$t("label.actionOdometryLocation"),5:this.$t("label.odometryLocation"),6:this.$t("label.disableMapLocation")}[t.srp.systemState.locationType];return e?`@${e}`:""},locationPose:function(t){if(this.isUnconnected())return"";if(null==t.srp.systemState.locationPose)return"";let e=t.srp.systemState.locationPose.x,i=t.srp.systemState.locationPose.y,a=t.srp.systemState.locationPose.z,s=t.srp.systemState.locationPose.pitch,n=t.srp.systemState.locationPose.roll,o=t.srp.systemState.locationPose.yaw;return e=(e?(e/100).toFixed(3):0)+" m, ",i=(i?(i/100).toFixed(3):0)+" m, ",a=(a?(a/100).toFixed(3):0)+" m, ",n=(n?n.toFixed(1):0)+" Â°, ",s=(s?s.toFixed(1):0)+" Â°, ",o=(o?o.toFixed(1):0)+" Â°","("+e+i+a+n+s+o+")"},curGoodsPose(){var t;let e=0,i=0,a=0,s=0;var o,r,l,c;null!==(t=this.forkliftState)&&void 0!==t&&t.goodsPose&&(e=((null===(o=this.forkliftState)||void 0===o?void 0:o.goodsPose.x)/1e3).toFixed(3),i=((null===(r=this.forkliftState)||void 0===r?void 0:r.goodsPose.y)/1e3).toFixed(3),a=((null===(l=this.forkliftState)||void 0===l?void 0:l.goodsPose.z)/1e3).toFixed(3),s=Object(n.e)((null===(c=this.forkliftState)||void 0===c?void 0:c.goodsPose.yaw)/1e3).toFixed(2));return`(${e}m,${i}m,${a}m,${s}Â°)`},locationConfidence:t=>t.srp.systemState.locationPose.confidence,curSpeed:function(t){return this.isUnconnected()||null==t.srp.systemState.mcState?"":`${String((t.srp.systemState.mcState.vX/100).toFixed(3))}m/s ,${String(t.srp.systemState.mcState.w.toFixed(1))}Â°/s (${t.srp.systemState.speedLevel}%)`},stationPGV(t){let e="";if(this.isUnconnected())return e;let i=t.srp.systemState.stationPGVInfo;return e+=`(${Math.round(10*i.x)/10}cm, ${Math.round(10*i.y)/10}cm, ${Math.round(10*i.angle)/10}Â°, ${i.pgvId})`,e},currentPGV(t){let e="";if(this.isUnconnected())return e;let i=t.srp.systemState.curPgvInfo;return e+=`(${Math.round(10*i.x)/10}cm, ${Math.round(10*i.y)/10}cm, ${Math.round(10*i.angle)/10}Â°, ${i.pgvId})`,e},qrCodeGlobalPosition(t){if(this.isUnconnected())return"";const{x:e=0,y:i=0,yaw:a=0}=t.srp.systemState.globalPoseByQrCode;return`${Math.round(e,3)}mm, ${Math.round(i,3)}mm, ${Math.round(Object(n.e)(a/1e3))}Â°`},labMoveState:function(t){let e="";if(this.isUnconnected())return e;let i=t.srp.systemState.movementState;return null==i||(e+=` #${i.no}(${i.stations}) ${a.d.taskStateString(i.state)}(${i.resultCode})`),e},curActionStateData:function(t){const e={message:"",errorCode:0,failed:!1};if(this.isUnconnected())return e;let i=t.srp.systemState.actionState;return null==i||(e.message=`#${i.no}(${i.id},${i.param0},${i.param1}) ${a.d.taskStateString(i.state)}(${i.resultCode})`,e.errorCode=i.resultCode||0,e.failed=i.result===o.q.TASK_RESULT_FAILED),e},emergencyState:function(t){return this.isUnconnected()?"":a.d.emergencyStateString(t.srp.systemState.emergencyState)+this.emergencySource},emergencySource:function(t){let e=a.d.emergencySourceStr(t.srp.systemState.emergencySource);return""===e?e:"("+e+")"},obaState:function(t){let e="";return this.isUnconnected()||(e=t.srp.systemState.obaEnableState===o.l.OBA_DISABLED?a.d.obsAvoidPolicyStr(o.c.OBSTACLE_AVOID_NONE):a.d.obsAvoidPolicyStr(t.srp.avoidingPolicy)),e},obstacleModelInfo:function(t){return t.srp.systemState.obstacleModelInfo},rackInfoState:function(t){return t.srp.systemState.rackInfoState},moveDistance:function(t){let e="";if(this.isUnconnected())return e;if(null==t.srp.systemState.movementState)return e;let i="â";return t.srp.systemState.movementState.remainTime>=0&&(i=String(t.srp.systemState.movementState.remainTime)+"s"),e=`${i}, ${(t.srp.systemState.movementState.remainDistance/100).toFixed(3)}m/${(t.srp.systemState.movementState.totalDistance/100).toFixed(3)}m, #${t.srp.systemState.mcState.pathNo}`,e},isLockedState(){return this.$store.getters["srp/isLockedState"]},lockedState:function(t){let e="";if(this.isUnconnected())return e;if(this.isLockedState){let t=this.$store.getters["srp/lockerDesc"];e=`${t.nickname}-`,this.$store.getters["srp/isLockedByMyself"]?e+=this.$t("label.myself"):e+=`${t.ipAddress}`}else e=this.$t("label.unexclusive");return e}})},methods:{clickOnItem(t){switch(t.key){case"currentStation":this.$store.commit("srp/setDisplayMapName",this.mapName);break;case"actionState":const t=a.d.actionTaskFailedStr(this.curActionStateData.errorCode,!0);t&&r.a.create({title:this.$t("label.actionState"),message:`\n               <div>\n                <div>\n                  <h5 class="q-my-none text_large_grey_style">${this.$t("label.errorCode")}</h5>\n                  <p class="text-main_red_style">${this.curActionStateData.errorCode}</p>\n                </div>\n                <div>\n                  <h5 class="q-my-none text_large_grey_style">${this.$t("label.desc")}</h5>\n                  <p class="white-space-pre-line">${t.desc}</p>\n                </div>\n                <div>\n                  <h5 class="q-my-none text_large_grey_style">${this.$t("label.resolve")}</h5>\n                  <p class="white-space-pre-line">${t.how}</p>\n                </div>\n              </div>\n              `,html:!0,style:"min-width: 600px"});break;case"obstacleModelInfo":this.setComponentId("VehicleObaInfoDialog")}},isUnconnected(){return this.$store.state.srp.systemState.sysState===o.o.SYS_STATE_ZERO},getRackInfoStateSource(){return{0:this.$t("label.none"),1:"SROS",2:"RIOT"}[this.rackInfoState.rackSource]},styleClass(t){var e;const{key:i=""}=t,a={exclusiveState:()=>this.isLockedState?"text-negative":"",localState:()=>this.locationSucceed?"":"text-negative",obstacleModelInfo:()=>this.isObstacleAppearing?"text-negative":"text_small_blue_style",actionState:()=>this.curActionStateData.failed?"text-negative":"",currentStation:()=>this.isCanClickToggleMap?"text_small_blue_style text-bold":""};return(null===(e=a[i])||void 0===e?void 0:e.call(a))||"text_small_light_grey"},async getCurrentMapStations(){this.mapName&&"NO_MAP"!==this.mapName?this.currentMapStations=Object.freeze(await Object(n.C)(this.mapName,!1)||[]):this.currentMapStations=[]},setComponentId(t=""){this.componentId=t}},watch:{isObstacleAppearing:{handler:async function(t){if(t)try{await a.d.enableUploadLaserPoint(!0)}catch(t){}},immediate:!0},mapName:{handler:async function(t,e){await this.getCurrentMapStations()},immediate:!0}},created(){n.a.on(n.b.UpdateSrosMap,async()=>{await this.getCurrentMapStations()})},beforeDestroy(){n.a.off(n.b.UpdateSrosMap)}},N=(i("ccc9"),i("eb85")),k=i("2c91"),F=i("0016"),$=i("05c0"),q=Object(y.a)(D,function(){var t=this,e=t._self._c;return e("div",[e("q-separator",{staticClass:"q-mb-sm",attrs:{inset:"",color:"grey-3"}}),e("q-list",{attrs:{dense:""}},[e("q-item",[e("q-item-section",[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_small_light_grey q-mt-sm"},[t._v(t._s(t.$t("label.systemInfo")))]),e("q-space"),e("q-btn",{staticClass:"no-shadow",attrs:{round:"","no-caps":"",unelevated:"",outline:"",color:"transparent"},on:{click:function(e){t.isSystemStateExpand=!t.isSystemStateExpand}}},[e("q-icon",{class:t.isSystemStateExpand?"std_expand":"std_collapse",attrs:{size:"10px"}})],1)],1)])],1),t._l(t.systemStateList,function(i){return e("q-item",{key:i.name},[e("q-item-section",[e("q-item-label",{staticClass:"text_small_grey_style",attrs:{"label-lines":"1"}},[t._v(t._s(i.name)+"\n          "),i.clickable?e("a",{class:["q-ml-md","float-right",t.styleClass(i)],attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.clickOnItem(i)}}},[t._v("\n            "+t._s(i.value)+"\n            "),e("q-tooltip",[t._v(t._s(i.tips))])],1):e("span",{class:["q-ml-md","float-right",t.styleClass(i)]},[t._v("\n            "+t._s(i.value)+"\n          ")])])],1)],1)})],2),t.componentId?e(t.componentId,{tag:"component",on:{"update:componentId":t.setComponentId}}):t._e()],1)},[],!1,null,"19a1e1fe",null);e.a=q.exports;O()(q,"components",{QSeparator:N.a,QList:C.a,QItem:x.a,QItemSection:T.a,QSpace:k.a,QBtn:S.a,QIcon:F.a,QItemLabel:I.a,QTooltip:$.a})},"881e":function(t,e,i){"use strict";var a=i("b5ae"),s=i("32e0"),n={name:"StationBatchCopyEditor",components:{ChoiceButtons:i("de9c").a,HeaderItem:s.a},data:()=>({opened:!1,optionAxisList:[{label:"X",value:!0},{label:"Y",value:!1}],isFollowAxisX:!0,startId:1,prefixName:"",rowCount:1,rowDistance:0,columnCount:1,columnDistance:0,isGenerateDiscerns:!0,discernsIDDiff:1e4,discernsOffsetX:0,discernsOffsetY:0,isGenerateRoadMap:!0}),computed:{},watch:{opened(t,e){t?document.addEventListener("keydown",this.onKeyDown):document.removeEventListener("keydown",this.onKeyDown)}},validations:{startId:{required:a.required,integer:a.integer,minValue:Object(a.minValue)(1)},rowCount:{required:a.required,integer:a.integer,minValue:Object(a.minValue)(1)},columnCount:{required:a.required,integer:a.integer,minValue:Object(a.minValue)(1)},discernsIDDiff:{integer:a.integer}},methods:{initData(t=1){this.startId=t,this.opened=!0},checkNameFormat(){let t=!0;return(this.startId<1||this.rowCount<1||this.columnCount<1||""===this.rowDistance||""===this.columnDistance||1===this.rowCount&&1===this.columnCount||this.rowCount>1&&0===this.rowDistance||this.columnCount>1&&0===this.columnDistance||(this.isFollowAxisX?this.columnCount<2:this.rowCount<2)||this.isGenerateDiscerns&&(!this.discernsIDDiff||this.isFollowAxisX&&!this.discernsOffsetX||!this.isFollowAxisX&&!this.discernsOffsetY))&&(t=!1,this.$notify({message:this.$t("text.inputParams"),timeout:3e3,type:"negative",position:"top"})),t},reset(){this.startId=1},onClosed:function(){this.reset(),this.opened=!1},onKeyDown(t){"s"===t.key&&t.ctrlKey&&(t.stopPropagation(),t.preventDefault(),this.onSaved())},onSaved:function(){this.checkNameFormat()&&(this.$emit("updateModel",{isFollowAxisX:this.isFollowAxisX,startId:this.startId,prefixName:this.prefixName,rowCount:this.rowCount,rowDistance:this.rowDistance,columnCount:this.columnCount,columnDistance:this.columnDistance,isGenerateDiscerns:this.isGenerateDiscerns,discernsIDDiff:this.discernsIDDiff,discernsOffsetX:this.discernsOffsetX,discernsOffsetY:this.discernsOffsetY,isGenerateRoadMap:this.isGenerateRoadMap}),this.onClosed())}}},o=(i("ab69"),i("2877")),r=i("24e8"),l=i("f09f"),c=i("1c1c"),d=i("66e5"),h=i("4074"),u=i("27f9"),p=i("ddd8"),m=i("9564"),f=i("eebe"),g=i.n(f),_=Object(o.a)(n,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"wrapper-station-copy"},[e("div",{staticClass:"full-width q-px-md q-pt-md"},[e("header-item",{attrs:{title:t.$t("button.bulkCopySite")},on:{close:t.onClosed}})],1),e("div",{staticClass:"container-station-copy full-width"},[e("div",{staticClass:"q-pa-xs station-copy-content full-width"},[e("q-list",{staticClass:"station-copy-main",attrs:{"no-border":""}},[e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width items-center"},[e("div",{staticClass:"text_main_grey_style col-sm-6 col-md-6 col-lg-6"},[t._v("\n                  "+t._s(t.$t("text.startStationId"))+"\n                ")]),e("q-input",{staticClass:"map_property_input col-sm-6 col-md-6 col-lg-6",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",min:"1",error:t.$v.rowCount.$error},on:{blur:t.$v.rowCount.$touch},model:{value:t.startId,callback:function(e){t.startId=t._n(e)},expression:"startId"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width items-center"},[e("div",{staticClass:"text_main_grey_style col-sm-6 col-md-6 col-lg-6"},[t._v("\n                  "+t._s(t.$t("text.stationNamePrefix"))+"\n                ")]),e("q-input",{staticClass:"map_property_input col-sm-6 col-md-6 col-lg-6",attrs:{dense:"","hide-bottom-space":"",outlined:""},model:{value:t.prefixName,callback:function(e){t.prefixName="string"==typeof e?e.trim():e},expression:"prefixName"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width items-center"},[e("div",{staticClass:"text_main_grey_style col-sm-6 col-md-6 col-lg-6"},[t._v("\n                  "+t._s(t.$t("text.stationStartDirection"))+"\n                ")]),e("q-select",{staticClass:"map_property_input text-right col-sm-6 col-md-6 col-lg-6",attrs:{options:t.optionAxisList,outlined:"",dense:"","emit-value":"","map-options":"","use-input":"","hide-selected":"","fill-input":""},model:{value:t.isFollowAxisX,callback:function(e){t.isFollowAxisX=e},expression:"isFollowAxisX"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width items-center"},[e("div",{staticClass:"text_main_grey_style col-sm-6 col-md-6 col-lg-6"},[t._v("\n                  "+t._s(t.$t("label.totalNumberOfRowsYAxisDirection"))+"\n                ")]),e("q-input",{staticClass:"map_property_input col-sm-6 col-md-6 col-lg-6",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",min:"1",error:t.$v.rowCount.$error},on:{blur:t.$v.rowCount.$touch},model:{value:t.rowCount,callback:function(e){t.rowCount=t._n(e)},expression:"rowCount"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width items-center"},[e("div",{staticClass:"text_main_grey_style col-sm-6 col-md-6 col-lg-6"},[t._v("\n                  "+t._s(t.$t("label.rowsSpacing"))+"(cm)\n                ")]),e("q-input",{staticClass:"map_property_input col-sm-6 col-md-6 col-lg-6",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number"},model:{value:t.rowDistance,callback:function(e){t.rowDistance=t._n(e)},expression:"rowDistance"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width items-center"},[e("div",{staticClass:"text_main_grey_style col-sm-6 col-md-6 col-lg-6"},[t._v("\n                  "+t._s(t.$t("label.totalNumberOfColumnsXAxisDirection"))+"\n                ")]),e("q-input",{staticClass:"map_property_input col-sm-6 col-md-6 col-lg-6",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",min:"1",error:t.$v.columnCount.$error},on:{blur:t.$v.columnCount.$touch},model:{value:t.columnCount,callback:function(e){t.columnCount=t._n(e)},expression:"columnCount"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width items-center"},[e("div",{staticClass:"text_main_grey_style col-sm-6 col-md-6 col-lg-6"},[t._v("\n                  "+t._s(t.$t("label.columnsSpacing"))+"(cm)\n                ")]),e("q-input",{staticClass:"map_property_input col-sm-6 col-md-6 col-lg-6",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number"},model:{value:t.columnDistance,callback:function(e){t.columnDistance=t._n(e)},expression:"columnDistance"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width items-center"},[e("div",{staticClass:"text_main_grey_style col-sm-6 col-md-6 col-lg-6"},[t._v("\n                  "+t._s(t.$t("text.generateIdentifyStation"))+"\n                ")]),e("q-toggle",{staticClass:"item-center",model:{value:t.isGenerateDiscerns,callback:function(e){t.isGenerateDiscerns=e},expression:"isGenerateDiscerns"}})],1)])],1),t.isGenerateDiscerns?[e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width items-center"},[e("div",{staticClass:"text_main_grey_style col-sm-6 col-md-6 col-lg-6"},[t._v("\n                    "+t._s(t.$t("text.identifyStationIDDifference"))+"\n                  ")]),e("q-input",{staticClass:"map_property_input col-sm-6 col-md-6 col-lg-6",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",error:t.$v.discernsIDDiff.$error},on:{blur:t.$v.discernsIDDiff.$touch},model:{value:t.discernsIDDiff,callback:function(e){t.discernsIDDiff=t._n(e)},expression:"discernsIDDiff"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width items-center"},[e("div",{staticClass:"text_main_grey_style col-sm-6 col-md-6 col-lg-6"},[t._v("\n                    "+t._s(t.$t("text.identifyStationOffset"))+"X(cm)\n                  ")]),e("q-input",{staticClass:"map_property_input col-sm-6 col-md-6 col-lg-6",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number"},model:{value:t.discernsOffsetX,callback:function(e){t.discernsOffsetX=t._n(e)},expression:"discernsOffsetX"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width items-center"},[e("div",{staticClass:"text_main_grey_style col-sm-6 col-md-6 col-lg-6"},[t._v("\n                    "+t._s(t.$t("text.identifyStationOffset"))+"Y(cm)\n                  ")]),e("q-input",{staticClass:"map_property_input col-sm-6 col-md-6 col-lg-6",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number"},model:{value:t.discernsOffsetY,callback:function(e){t.discernsOffsetY=t._n(e)},expression:"discernsOffsetY"}})],1)])],1)]:t._e(),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width items-center"},[e("div",{staticClass:"text_main_grey_style col-sm-6 col-md-6 col-lg-6"},[t._v("\n                  "+t._s(t.$t("text.quickNetworkGeneration"))+"\n                ")]),e("q-toggle",{staticClass:"item-center",model:{value:t.isGenerateRoadMap,callback:function(e){t.isGenerateRoadMap=e},expression:"isGenerateRoadMap"}})],1)])],1)],2)],1)]),e("div",{staticClass:"q-my-md q-mr-md"},[e("choice-buttons",{attrs:{"label-okay":t.$t("button.save")},on:{okay:t.onSaved,cancel:t.onClosed}})],1)])],1)},[],!1,null,"69385986",null);e.a=_.exports;g()(_,"components",{QDialog:r.a,QCard:l.a,QList:c.a,QItem:d.a,QItemSection:h.a,QInput:u.a,QSelect:p.a,QToggle:m.a})},"8a1b":function(t,e,i){"use strict";var a=i("2f62"),s=i("f226"),n=i("33aa"),o=i("dde5");var r={name:"SpeedControl",props:{isCanManualControl:Boolean},inject:["doAsk"],data(){return{isMobile:this.$q.platform.is.mobile,manualControlSpeed:n.a.getSpeed()}},computed:{...Object(a.f)(["appBranchInfo","isLimitCloseRemoteControlObaByUser"]),...Object(a.f)("srp",["maxSpeed"]),...Object(a.d)(["isMainSecurityUnitTypeCE"]),...Object(a.d)("srp",["isWorker","isDeploy","isManualCtrlState","isManualControlObaState","isNewMapDrawingState"]),connectedState(){return this.$store.getters.isConnected},robotMaxSpeed(){return!this.isManualControlObaState||this.isNewMapDrawingState?Math.min(.5,this.maxSpeed):this.maxSpeed},isManualCtrl:{get:function(){return this.isManualCtrlState},set:function(t){}},isManualControlObaStatePage:{get(){return this.isManualControlObaState},async set(t){await this.setManualCtrlOba(!0,t)}},disableManualControlObaBtn(){return this.isManualControlObaState&&!this.isDeploy&&this.isLimitCloseRemoteControlObaByUser},disableManualCtrlBtn(){return this.isMainSecurityUnitTypeCE||!this.isCanManualControl}},watch:{connectedState:{handler:async function(t,e){t?await this.handleRobotMaxSpeed():n.a.stopSendCmd()},immediate:!0},robotMaxSpeed(t,e){this.manualControlSpeed>t&&this.setManualControlSpeed(t)}},activated(){this.manualControlSpeed=n.a.getSpeed()},methods:{changeManualControlSpeed(t){this.$emit("focus:speed"),this.setManualControlSpeed(t)},async setManualCtrl(t){this.isCanManualControl&&(await this.$emit("onChangeManualCtrl",t),await this.setManualCtrlOba(!1,t))},async setManualCtrlOba(t,e){if(t&&!e){const t=Math.min(.5,this.maxSpeed);if(!await this.doAsk({title:this.$t("label.warning"),question:this.$t("text.manualObstacleTip",{speed:t})}))return;this.manualControlSpeed>this.limitSpeed&&this.setManualControlSpeed(this.limitSpeed)}try{await s.d.enableManualControlOba(e)}catch(t){}},setManualControlSpeed(t){n.a.setSpeed(t),this.manualControlSpeed=t},async handleRobotMaxSpeed(){const t=await Object(o.s)("mc.joy_max_linear_speed","200");this.$store.commit("srp/setRobotMaxSpeed",+t.value/1e3),this.connectedState&&this.manualControlSpeed>this.robotMaxSpeed&&this.setManualControlSpeed(this.robotMaxSpeed)}}},l=i("2877"),c=i("de5e"),d=i("1c1c"),h=i("66e5"),u=i("4074"),p=i("9564"),m=i("c1d0"),f=i("eebe"),g=i.n(f),_=Object(l.a)(r,function(){var t=this,e=t._self._c;return t.isWorker?t._e():e("q-page-sticky",{attrs:{position:"bottom-left"}},[e("q-list",{staticClass:"background_white q-ml-md q-mb-sm",staticStyle:{"border-radius":"12px"},attrs:{dense:""}},[t.isManualCtrl?e("q-item",[e("q-item-section",{attrs:{side:""}},[t._v(t._s(t.$t("button.manualObstacle")))]),e("q-item-section",{staticClass:"q-pr-none",attrs:{side:""}},[e("q-toggle",{attrs:{dense:"",disable:t.disableManualControlObaBtn},model:{value:t.isManualControlObaStatePage,callback:function(e){t.isManualControlObaStatePage=e},expression:"isManualControlObaStatePage"}})],1)],1):t._e(),e("q-item",[e("q-item-section",{attrs:{side:""}},[t._v(t._s(t.$t("button.manualControl")))]),e("q-item-section",{attrs:{side:""}},[e("q-toggle",{attrs:{dense:"",disable:t.disableManualCtrlBtn},on:{input:t.setManualCtrl},model:{value:t.isManualCtrl,callback:function(e){t.isManualCtrl=e},expression:"isManualCtrl"}})],1),t.isManualCtrl?e("q-item-section",{attrs:{side:""}},[e("q-slider",{staticStyle:{width:"120px"},attrs:{dense:"",min:.01,max:t.robotMaxSpeed,step:.01,"label-value":t.manualControlSpeed+"m/s","label-always":"",snap:"",color:"primary"},on:{change:t.changeManualControlSpeed},model:{value:t.manualControlSpeed,callback:function(e){t.manualControlSpeed=e},expression:"manualControlSpeed"}})],1):t._e()],1)],1)],1)},[],!1,null,"4957a457",null);e.a=_.exports;g()(_,"components",{QPageSticky:c.a,QList:d.a,QItem:h.a,QItemSection:u.a,QToggle:p.a,QSlider:m.a})},"8b52":function(t,e,i){"use strict";i("a732");var a=i("de9c"),s=i("32e0"),n=i("b69e"),o={name:"CheckMapList",components:{HeaderItem:s.a,ChoiceButtons:a.a},props:{checkList:Array},data(){return{opened:!1,pagination:{rowsPerPage:0},columns:[{name:"ID",label:"ID",field:"id",required:!0,align:"center",sortable:!0},{name:"type",label:this.$t("label.type"),field:"type",required:!0,align:"center",sortable:!0},{name:"desc",label:this.$t("label.desc"),field:"desc",required:!0,align:"center",sortable:!1}]}},computed:{hasError(){return this.checkList.some(({type:t})=>t===n.g.MSG_ERROR)}},mounted(){},methods:{onOkay(){this.$emit("close",!0),this.opened=!1},onCancel(){this.opened=!1},typeInfo(t){let e="";switch(parseInt(t)){case n.g.MSG_WARNING:e=this.$t("label.warning");break;case n.g.MSG_ERROR:e=this.$t("label.error")}return e}}},r=i("2877"),l=i("24e8"),c=i("f09f"),d=i("eaac"),h=i("bd08"),u=i("db86"),p=i("eebe"),m=i.n(p),f=Object(r.a)(o,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},on:{"escape-key":t.onCancel},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticStyle:{width:"636px"}},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.$t("label.checkMap")},on:{close:t.onCancel}}),e("div",{staticClass:"text_small_grey_style q-mt-md"},[t._v(t._s(t.$t("text.checkMapDesc")))]),e("div",{staticClass:"no-scroll q-mt-md"},[e("q-table",{staticClass:"scroll",attrs:{"hide-bottom":"","virtual-scroll":"",columns:t.columns,data:t.checkList,"row-key":"id","rows-per-page-options":[10,15,30,0],"table-header-class":"text_small_grey_style background_light_grey","table-header-style":"height: 28px;","table-style":"max-height: 600px","rows-per-page-label":t.$t("label.rowPerPage"),pagination:t.pagination},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"body",fn:function(i){return e("q-tr",{class:parseInt(i.row.type)>=2?"text-main_red_style":"text_main_grey_style",staticStyle:{height:"36px"},attrs:{props:i}},[e("q-td",{key:"ID",attrs:{props:i}},[e("div",[t._v(t._s(i.row.id))])]),e("q-td",{key:"type",attrs:{props:i}},[e("div",[t._v(t._s(t.typeInfo(i.row.type)))])]),e("q-td",{key:"desc",attrs:{props:i}},[e("div",[t._v(t._s(i.row.desc))])])],1)}}])})],1),e("div",{staticClass:"float-right q-my-md"},[e("choice-buttons",{attrs:{"enable-okay":!t.hasError},on:{okay:t.onOkay,cancel:t.onCancel}})],1)],1)])],1)},[],!1,null,"0233a8f7",null);e.a=f.exports;m()(f,"components",{QDialog:l.a,QCard:c.a,QTable:d.a,QTr:h.a,QTd:u.a})},9477:function(t,e,i){"use strict";i.d(e,"a",function(){return s});i("f665"),i("7d54");var a=i("9dad");i("f2b3");class s extends a.m{constructor(t,e){super(e),this.rackInfo=t,this.rackBody=null,this.rackLegs=[],this.rackBeams=[]}renderNormalRack(){this.renderRackBody(),this.renderRackLegs(),this.renderRackBeams()}renderForkLiftRack(){var t;null===(t=this.rackBody)||void 0===t||t.mesh.removeFromParent();const e=this.findConfigValueByKey("rack.max_contour_length"),i=this.findConfigValueByKey("rack.max_contour_width"),s=this.findConfigValueByKey("rack.max_contour_height"),n={width:e,height:i,depth:s,color:"rgb(85, 139, 47)",opacity:.9},o=Object(a.s)(n,[0,0,s/2+a.c]);this.addMeshes([o.mesh]),this.rackBody=o}setForkLiftRackLoadedPosition(){var t;const e=this.findConfigValueByKey("rack.max_contour_length"),i=this.findChassisValueByKey("chassis.fork_arm.arm_length"),a=this.findChassisValueByKey("chassis.fork_arm.fork_arm_tail_distance");null===(t=this.rackBody)||void 0===t||t.setPosition(i-a-e/2,0,this.rackBody.getPosition().z)}renderRackBody(){var t;null===(t=this.rackBody)||void 0===t||t.mesh.removeFromParent();const e=this.findConfigValueByKey("rack.max_contour_length"),i=this.findConfigValueByKey("rack.max_contour_width"),s=this.findConfigValueByKey("rack.max_contour_height"),n=this.hasRackLegs?this.findConfigValueByKey("rack.leg_length"):0,o={width:e,height:i,depth:s-n,color:"rgb(85, 139, 47)",opacity:.9},r=Object(a.s)(o,[0,0,(s-n)/2+n]);this.addMeshes([r.mesh]),this.rackBody=r}renderRackLegs(){if(this.rackLegs.forEach(t=>t.mesh.removeFromParent()),this.rackLegs=[],!this.hasRackLegs)return;const t=this.findConfigValueByKey("rack.max_contour_length"),e=this.findConfigValueByKey("rack.max_contour_width"),i=this.findConfigValueByKey("rack.leg_length"),s=this.findConfigValueByKey("ui.rack_leg_cross_sectional_shape",!1),n=this.findConfigValueByKey("rack.rack_leg_diameter"),o=this.findConfigValueByKey("ui.rack_leg_long_side_distance"),r=this.findConfigValueByKey("ui.rack_leg_short_side_distance"),l=t/2-n/2-r,c=e/2-n/2-o;[{x:-l,y:-c},{x:l,y:-c},{x:l,y:c},{x:-l,y:c}].forEach(t=>{let e=null;if("rectangle"===s){const t={width:n,height:n,depth:i,color:"rgb(249, 168, 37)",opacity:.9};e=Object(a.q)(t,this.rackBody,"-z")}else if("circle"===s){const t={radius:n/2,height:i,color:"rgb(249, 168, 37)",opacity:.9};e=Object(a.u)(t,this.rackBody,"-z"),this.rackLegs.push(e)}e&&(e.setPosition(t.x,t.y,e.getPosition().z),this.addMeshes([e.mesh]),this.rackLegs.push(e))})}renderRackBeams(){var t;if(this.rackBeams.forEach(t=>t.mesh.removeFromParent()),this.rackBeams=[],!this.hasRackBeams)return;const e=this.findConfigValueByKey("rack.max_contour_length"),i=this.findConfigValueByKey("rack.max_contour_width"),s=(this.findConfigValueByKey("rack.max_contour_height"),this.findConfigValueByKey("rack.leg_length"),this.findConfigValueByKey("rack.rack_leg_diameter")),n=this.findConfigValueByKey("rack.short_side_beam_thickness"),o=this.findConfigValueByKey("rack.short_side_beam_height"),r=this.findConfigValueByKey("ui.rack_leg_long_side_distance"),l=this.findConfigValueByKey("ui.rack_leg_short_side_distance"),c=this.findConfigValueByKey("ui.rack_leg_cross_sectional_shape",!1),d={short:()=>{const t=e/2-s/2-l,d=o+n/2;return[{x:t,y:0,z:d},{x:-t,y:0,z:d}].map(t=>{let e=null;if("rectangle"===c){const o={width:n,height:i-2*r-s,depth:n,color:"rgb(84, 110, 122)",opacity:.9};e=Object(a.s)(o,[t.x,t.y,t.z])}else if("circle"===c){const o={radius:n/2,height:i-2*r-s,color:"rgb(84, 110, 122)",opacity:.9};e=Object(a.t)(o),e.setRotation(0,0,0),e.setPosition(t.x,t.y,t.z)}return e})},long:()=>{const t=this.findConfigValueByKey("rack.long_side_beam_thickness"),n=this.findConfigValueByKey("rack.long_side_beam_height"),o=i/2-s/2-r,d=n+t/2;return[{x:0,y:o,z:d},{x:0,y:-o,z:d}].map(i=>{let n=null;if("rectangle"===c){const o={width:e-2*l-s,height:t,depth:t,color:"orange",opacity:.9};n=Object(a.s)(o,[i.x,i.y,i.z])}else if("circle"===c){const o={radius:t/2,height:e-2*l-s,color:"orange",opacity:.9};n=Object(a.t)(o),n.setRotation(0,0,Math.PI/2),n.setPosition(i.x,i.y,i.z)}return n})}},h=null===(t=d[this.findConfigValueByKey("ui.rack_beam_belong_side",!1)])||void 0===t?void 0:t.call(d);null==h||h.forEach(t=>{this.addMeshes([t.mesh]),this.rackBeams.push(t)})}get hasRackLegs(){const t=this.findConfigValueByKey("ui.rack_type",!1);return["leg_under_corner","leg_not_under_corner"].includes(t)}get hasRackLegsNotUnderCorner(){const t=this.findConfigValueByKey("ui.rack_type",!1);return["leg_not_under_corner"].includes(t)}get hasRackBeams(){return this.hasRackLegs&&["short","long"].includes(this.findConfigValueByKey("ui.rack_beam_belong_side",!1))}get rackLegLengthByInfo(){return this.findConfigValueByKey("rack.leg_length")}get rackMaxContourLengthByInfo(){return this.findConfigValueByKey("rack.max_contour_length")}get rackMaxContourWidthByInfo(){return this.findConfigValueByKey("rack.max_contour_width")}get rackMaxContourHeightByInfo(){return this.findConfigValueByKey("rack.max_contour_height")}findConfigValueByKey(t="",e=!0){var i;const s=(null===(i=this.rackInfo.find(e=>e.key===t))||void 0===i?void 0:i.hmiValue)||"";return e?Object(a.p)(s):s}get rackLegCenterSize(){const t=this.findConfigValueByKey("rack.max_contour_length"),e=this.findConfigValueByKey("rack.max_contour_width"),i=this.hasRackLegs?this.findConfigValueByKey("rack.rack_leg_diameter"):0,a=this.hasRackLegsNotUnderCorner?this.findConfigValueByKey("ui.rack_leg_long_side_distance"):0;return{length:t/2-i/2-(this.hasRackLegsNotUnderCorner?this.findConfigValueByKey("ui.rack_leg_short_side_distance"):0),width:e/2-i/2-a}}}},"9ab1":function(t,e,i){"use strict";var a={name:"NoListComponent",props:{btnTxt:String,importTxt:{type:String,default:""},desc:String},data(){return{isUserAccount:this.$store.getters["srp/isUser"]}},methods:{onCreateTask(){this.$emit("create",!0)},onImport(){this.$emit("import",!0)}}},s=(i("384c"),i("2877")),n=i("9c40"),o=i("0016"),r=i("eebe"),l=i.n(r),c=Object(s.a)(a,function(){var t=this,e=t._self._c;return e("div",{staticClass:"absolute-center"},[e("q-btn",{staticClass:"no-border no-pointer-events",attrs:{"no-caps":"",unelevated:""}},[e("q-icon",{staticClass:"std_no_map",staticStyle:{width:"240px",height:"240px"}})],1),e("div",{staticClass:"text_large_dark text-center q-mt-lg"},[t._v(t._s(t.desc))]),t.isUserAccount?t._e():e("div",{staticClass:"row justify-center q-mt-sm q-gutter-md"},[e("q-btn",{staticClass:"button_style no-shadow",attrs:{dense:"","no-caps":"",unelevated:"",color:"primary"},on:{click:t.onCreateTask}},[e("q-icon",{staticClass:"std_add_white"}),e("div",{staticClass:"text_small_white_style q-ml-sm"},[t._v(t._s(t.btnTxt))])],1),""!==t.importTxt?e("q-btn",{staticClass:"button_style no-shadow",attrs:{"no-caps":"",unelevated:"",color:"primary"},on:{click:t.onImport}},[e("q-icon",{staticClass:"std_upload_white"}),e("div",{staticClass:"text_small_white_style q-ml-sm"},[t._v(t._s(t.importTxt))])],1):t._e()],1)],1)},[],!1,null,"8d1a6e2c",null);e.a=c.exports;l()(c,"components",{QBtn:n.a,QIcon:o.a})},"9d4f":function(t,e,i){},"9e68":function(t,e,i){"use strict";i("f665"),i("7d54"),i("ab43"),i("a732");var a=i("ec26"),s=i("2b0e"),n=i("2f62"),o=i("b69e"),r=i("a39b"),l=i("adb7"),c=i("f226"),d=i("ae4a"),h=(i("1712"),i("8a60")),u=i.n(h),p=i("7a6b"),m=i("eb21"),f=i("c4c4"),g=i("20ff"),_=i("6825"),y=i("d5bc"),v=i("2cd7"),b=i("c3a9"),E=i("d6c6"),A=i("14b2"),w=i("1e4b"),S=i("09c3"),C=i("8b52"),I=i("149c"),x=i("e9ef"),T=i("d7f1"),M=i("fbec"),P=i("a574"),O=i("dcfa"),L=i("cc0f"),R=i("5044"),D=i("881e"),N=i("2d22"),k=i("8847"),F=i("de9c"),$=i("32e0"),q={name:"EdgeBatchGeneratorEditor",components:{MessageDialog:y.a,HeaderItem:$.a,ChoiceButtons:F.a},data(){return{opened:!1,optionAxisList:[{label:"X",value:!0},{label:"Y",value:!1}],optionDirectionList:[{label:k.b.t("label.positive"),value:!0},{label:k.b.t("label.negative"),value:!1}],robotDirectionOptions:[{label:this.$t("label.forward"),value:o.e.EDGE_DIR_FORWARD},{label:this.$t("label.backward"),value:o.e.EDGE_DIR_BACKWARD},{label:this.$t("label.dirLeft"),value:o.e.EDGE_DIR_LEFT},{label:this.$t("label.dirRight"),value:o.e.EDGE_DIR_RIGHT}],isFollowAxisX:!0,isDirectionPassive:!0,isBidirectionalEdge:!1,robotDirection:o.e.EDGE_DIR_FORWARD,robotDirectionSecond:o.e.EDGE_DIR_FORWARD,stationCopyInfo:null,callbackReject:null,callbackResolve:null}},methods:{initDat(t){return this.opened=!0,t&&(this.isFollowAxisX=t.isFollowAxisX),this.stationCopyInfo=t,new Promise((t,e)=>{this.callbackResolve=t,this.callbackReject=e})},async onOkay(){this.callbackResolve&&this.callbackResolve({isBidirectionalEdge:this.isBidirectionalEdge,isFollowAxisX:this.isFollowAxisX,isDirectionPassive:this.isDirectionPassive,robotDirection:this.robotDirection,robotDirectionSecond:this.robotDirectionSecond}),this.opened=!1},onClosed(){this.callbackReject&&this.callbackReject("cancel"),this.opened=!1}}},G=i("2877"),B=i("24e8"),j=i("f09f"),U=i("9564"),Y=i("ddd8"),z=i("eebe"),V=i.n(z),W=Object(G.a)(q,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},on:{"escape-key":t.onClosed},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"popup_style",staticStyle:{width:"400px"}},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.$t("text.pathBatchGenerationTitle")},on:{close:t.onClosed}}),e("div",{staticClass:"no-scroll q-mt-md"},[e("div",{staticClass:"row items-center q-mb-sm"},[e("div",{staticClass:"text_main_grey_style col-5"},[t._v(t._s(t.$t("text.setBidirectionalPath")))]),e("q-toggle",{staticClass:"col-7",model:{value:t.isBidirectionalEdge,callback:function(e){t.isBidirectionalEdge=e},expression:"isBidirectionalEdge"}})],1),e("div",{staticClass:"row items-center q-mb-sm"},[e("div",{staticClass:"text_main_grey_style col-5"},[t._v(t._s(t.$t("text.pathDirection")))]),e("q-select",{staticClass:"col-7",attrs:{options:t.optionAxisList,disable:!!t.stationCopyInfo,outlined:"",dense:"","emit-value":"","map-options":"","use-input":"","hide-selected":"","fill-input":""},model:{value:t.isFollowAxisX,callback:function(e){t.isFollowAxisX=e},expression:"isFollowAxisX"}})],1),e("div",{staticClass:"row items-center q-mb-sm"},[e("div",{staticClass:"text_main_grey_style col-5"},[t._v("\n            "+t._s(t.$t("text.axisPositiveNegativeDirection"))+"\n          ")]),e("q-select",{staticClass:"col-7",attrs:{options:t.optionDirectionList,outlined:"",dense:"","emit-value":"","map-options":"","use-input":"","hide-selected":"","fill-input":""},model:{value:t.isDirectionPassive,callback:function(e){t.isDirectionPassive=e},expression:"isDirectionPassive"}})],1),e("div",{staticClass:"row items-center q-mb-sm"},[e("div",{staticClass:"text_main_grey_style col-5"},[t._v(t._s(t.$t("label.moveDirection"))+" 1")]),e("q-select",{staticClass:"col-7",attrs:{options:t.robotDirectionOptions,outlined:"",dense:"","emit-value":"","map-options":"","use-input":"","hide-selected":"","fill-input":""},model:{value:t.robotDirection,callback:function(e){t.robotDirection=e},expression:"robotDirection"}})],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isBidirectionalEdge,expression:"isBidirectionalEdge"}],staticClass:"row items-center q-mb-sm"},[e("div",{staticClass:"text_main_grey_style col-5"},[t._v(t._s(t.$t("label.moveDirection"))+" 2")]),e("q-select",{staticClass:"col-7",attrs:{options:t.robotDirectionOptions,outlined:"",dense:"","emit-value":"","map-options":"","use-input":"","hide-selected":"","fill-input":""},model:{value:t.robotDirectionSecond,callback:function(e){t.robotDirectionSecond=e},expression:"robotDirectionSecond"}})],1),e("choice-buttons",{staticClass:"q-mt-md q-mb-md",attrs:{"enable-okay":!0},on:{okay:t.onOkay,cancel:t.onClosed}})],1)],1)]),e("message-dialog",{ref:"message"})],1)},[],!1,null,null,null),H=W.exports;V()(W,"components",{QDialog:B.a,QCard:j.a,QToggle:U.a,QSelect:Y.a});var K={name:"NodesLinearMoveEditor",components:{MessageDialog:y.a,HeaderItem:$.a,ChoiceButtons:F.a},data:()=>({opened:!1,optionAxisList:[{label:"X",value:!0},{label:"Y",value:!1}],optionDirectionList:[{label:k.b.t("label.positive"),value:!0},{label:k.b.t("label.negative"),value:!1}],isFollowAxisX:!0,isDirectionPassive:!0,x1:0,x2:0,y1:0,y2:0,callbackReject:null,callbackResolve:null}),methods:{initDat(){return this.opened=!0,new Promise((t,e)=>{this.callbackResolve=t,this.callbackReject=e})},async onOkay(){const t=[this.x1,this.x2,this.y1,this.y2];t.every(t=>!Number.isNaN(t)&&"number"==typeof t)&&t.some(t=>0!==t)?(this.callbackResolve&&this.callbackResolve({isFollowAxisX:this.isFollowAxisX,isDirectionPassive:this.isDirectionPassive,x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2}),this.opened=!1):this.$notify({message:this.$t("text.inputParams"),timeout:3e3,type:"negative",position:"top"})},onClosed(){this.callbackReject&&this.callbackReject("cancel"),this.opened=!1}}},Q=i("27f9"),X=Object(G.a)(K,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},on:{"escape-key":t.onClosed},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"popup_style",staticStyle:{width:"400px"}},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.$t("text.linearNodeTitle")},on:{close:t.onClosed}}),e("div",{staticClass:"no-scroll q-mt-md"},[e("div",{staticClass:"row items-center q-mb-sm"},[e("div",{staticClass:"text_main_grey_style col-5"},[t._v(t._s(t.$t("text.nodeSortRule")))]),e("q-select",{staticClass:"col-7",attrs:{options:t.optionAxisList,outlined:"",dense:"","emit-value":"","map-options":"","use-input":"","hide-selected":"","fill-input":""},model:{value:t.isFollowAxisX,callback:function(e){t.isFollowAxisX=e},expression:"isFollowAxisX"}})],1),e("div",{staticClass:"row items-center q-mb-sm"},[e("div",{staticClass:"text_main_grey_style col-5"},[t._v("\n            "+t._s(t.$t("text.axisPositiveNegativeDirection"))+"\n          ")]),e("q-select",{staticClass:"col-7",attrs:{options:t.optionDirectionList,outlined:"",dense:"","emit-value":"","map-options":"","use-input":"","hide-selected":"","fill-input":""},model:{value:t.isDirectionPassive,callback:function(e){t.isDirectionPassive=e},expression:"isDirectionPassive"}})],1),e("div",{staticClass:"row items-center q-mb-sm"},[e("div",{staticClass:"text_main_grey_style col-5"},[t._v("\n            "+t._s(t.$t("text.startNode"))+t._s(t.$t("label.coordinateOffset",{type:"x"})+"/cm")+"\n          ")]),e("q-input",{staticClass:"col-7",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number"},model:{value:t.x1,callback:function(e){t.x1=t._n(e)},expression:"x1"}})],1),e("div",{staticClass:"row items-center q-mb-sm"},[e("div",{staticClass:"text_main_grey_style col-5"},[t._v("\n            "+t._s(t.$t("text.startNode"))+t._s(t.$t("label.coordinateOffset",{type:"y"})+"/cm")+"\n          ")]),e("q-input",{staticClass:"col-7",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number"},model:{value:t.y1,callback:function(e){t.y1=t._n(e)},expression:"y1"}})],1),e("div",{staticClass:"row items-center q-mb-sm"},[e("div",{staticClass:"text_main_grey_style col-5"},[t._v("\n            "+t._s(t.$t("text.endNode"))+t._s(t.$t("label.coordinateOffset",{type:"x"})+"/cm")+"\n          ")]),e("q-input",{staticClass:"col-7",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number"},model:{value:t.x2,callback:function(e){t.x2=t._n(e)},expression:"x2"}})],1),e("div",{staticClass:"row items-center q-mb-sm"},[e("div",{staticClass:"text_main_grey_style col-5"},[t._v("\n            "+t._s(t.$t("text.endNode"))+t._s(t.$t("label.coordinateOffset",{type:"y"})+"/cm")+"\n          ")]),e("q-input",{staticClass:"col-7",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number"},model:{value:t.y2,callback:function(e){t.y2=t._n(e)},expression:"y2"}})],1),e("choice-buttons",{staticClass:"q-mt-md q-mb-md",attrs:{"enable-okay":!0},on:{okay:t.onOkay,cancel:t.onClosed}})],1)],1)]),e("message-dialog",{ref:"message"})],1)},[],!1,null,null,null),J=X.exports;V()(X,"components",{QDialog:B.a,QCard:j.a,QSelect:Y.a,QInput:Q.a});var Z={name:"EdgeBatchSetMaxSpeedEditor",components:{MessageDialog:y.a,HeaderItem:$.a,ChoiceButtons:F.a},data:()=>({opened:!1,edgeForwardLineSpeedMax:-1,edgeForwardAngularVelocityMax:-1,edgeNotForwardLineSpeedMax:-1,edgeNotForwardAngularVelocityMax:-1,callbackReject:null,callbackResolve:null}),methods:{initDat(){return this.opened=!0,new Promise((t,e)=>{this.callbackResolve=t,this.callbackReject=e})},async onOkay(){let t=!0;(Number.isNaN(this.edgeForwardLineSpeedMax)||"number"!=typeof this.edgeForwardLineSpeedMax)&&(t=!1),(Number.isNaN(this.edgeForwardAngularVelocityMax)||"number"!=typeof this.edgeForwardAngularVelocityMax)&&(t=!1),(Number.isNaN(this.edgeNotForwardLineSpeedMax)||"number"!=typeof this.edgeNotForwardLineSpeedMax)&&(t=!1),(Number.isNaN(this.edgeNotForwardAngularVelocityMax)||"number"!=typeof this.edgeNotForwardAngularVelocityMax)&&(t=!1),t?this.edgeForwardLineSpeedMax<0&&this.edgeForwardAngularVelocityMax<0&&this.edgeNotForwardLineSpeedMax<0&&this.edgeNotForwardAngularVelocityMax<0?this.onClosed():(this.callbackResolve&&this.callbackResolve({edgeForwardLineSpeedMax:this.edgeForwardLineSpeedMax,edgeForwardAngularVelocityMax:this.edgeForwardAngularVelocityMax,edgeNotForwardLineSpeedMax:this.edgeNotForwardLineSpeedMax,edgeNotForwardAngularVelocityMax:this.edgeNotForwardAngularVelocityMax}),this.opened=!1):this.$notify({message:this.$t("text.inputParams"),timeout:3e3,type:"negative",position:"top"})},onClosed(){this.callbackReject&&this.callbackReject("cancel"),this.opened=!1}}},tt=Object(G.a)(Z,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},on:{"escape-key":t.onClosed},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"popup_style",staticStyle:{width:"400px"}},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.$t("text.pathMaxSpeedBatchSettingTitle")},on:{close:t.onClosed}}),e("div",{staticClass:"no-scroll q-mt-md"},[e("div",{staticClass:"row items-center q-mb-sm"},[e("div",[t._v(t._s(t.$t("text.frontPathMaxSpeed")))])]),e("div",{staticClass:"row items-center q-mb-sm"},[e("div",{staticClass:"text_main_grey_style col-5 q-pl-md"},[t._v("\n            "+t._s(t.$t("label.maxLineSpeed"))+"(m/s)\n          ")]),e("q-input",{staticClass:"col-7",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number"},model:{value:t.edgeForwardLineSpeedMax,callback:function(e){t.edgeForwardLineSpeedMax=t._n(e)},expression:"edgeForwardLineSpeedMax"}})],1),e("div",{staticClass:"row items-center q-mb-sm"},[e("div",{staticClass:"text_main_grey_style col-5 q-pl-md"},[t._v(t._s(t.$t("label.maxRadSpeed"))+"(Â°/s)")]),e("q-input",{staticClass:"col-7",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number"},model:{value:t.edgeForwardAngularVelocityMax,callback:function(e){t.edgeForwardAngularVelocityMax=t._n(e)},expression:"edgeForwardAngularVelocityMax"}})],1),e("div",{staticClass:"row items-center q-mb-sm"},[e("div",[t._v(t._s(t.$t("text.rearPathMaxSpeed")))])]),e("div",{staticClass:"row items-center q-mb-sm"},[e("div",{staticClass:"text_main_grey_style col-5 q-pl-md"},[t._v("\n            "+t._s(t.$t("label.maxLineSpeed"))+"(m/s)\n          ")]),e("q-input",{staticClass:"col-7",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",append:456},model:{value:t.edgeNotForwardLineSpeedMax,callback:function(e){t.edgeNotForwardLineSpeedMax=t._n(e)},expression:"edgeNotForwardLineSpeedMax"}})],1),e("div",{staticClass:"row items-center q-mb-sm"},[e("div",{staticClass:"text_main_grey_style col-5 q-pl-md"},[t._v(t._s(t.$t("label.maxRadSpeed"))+"(Â°/s)")]),e("q-input",{staticClass:"col-7",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number"},model:{value:t.edgeNotForwardAngularVelocityMax,callback:function(e){t.edgeNotForwardAngularVelocityMax=t._n(e)},expression:"edgeNotForwardAngularVelocityMax"}})],1),e("div",{staticClass:"row items-center q-mb-sm text-red"},[e("div",[t._v(t._s(t.$t("text.noteForNegativeValue")))])]),e("choice-buttons",{staticClass:"q-mt-md q-mb-md",attrs:{"enable-okay":!0},on:{okay:t.onOkay,cancel:t.onClosed}})],1)],1)]),e("message-dialog",{ref:"message"})],1)},[],!1,null,null,null),et=tt.exports;V()(tt,"components",{QDialog:B.a,QCard:j.a,QInput:Q.a});var it=i("abc6");const at=1,st=2,nt=3,ot=4,rt=5,lt=6,ct=8,dt=9,ht=10,ut=11,pt=12,mt=13,ft=14;var gt={name:"mapViewer",components:{MapSearchTool:()=>Promise.all([i.e(0),i.e(2)]).then(i.bind(null,"0a96")),CheckboxList:p.a,OtherFeatureItems:m.a,ControlButtons:f.a,ScaleItem:g.a,ContextMenu:_.a,MessageDialog:y.a,SelectDialog:v.a,InputDialog:b.a,QuestionDialog:E.a,EditMapToolBar:A.a,SelectEdgeGroup:w.a,EdgeGroupEditor:S.a,CheckMapList:C.a,BarcodeEditor:I.a,StationDMCodeCreator:x.a,SetCoordinate:T.a,EdgeEditor:M.a,AreaEditor:P.a,NoteAreaEditor:()=>Promise.all([i.e(0),i.e(1)]).then(i.bind(null,"59d9")),LocationAreaEditor:()=>i.e(4).then(i.bind(null,"44f9")),NodeEditor:O.a,StationEditor:L.a,WareroomAreaAndWareroomRegionEditor:R.a,StationBatchCopyEditor:D.a,StationRotateEditor:N.a,EdgeBatchGeneratorEditor:H,NodesLinearMoveEditor:J,EdgeBatchSetMaxSpeedEditor:et},computed:{...Object(n.f)(["sensorColorDisplayMap","allowMaxStationId"]),...Object(n.f)("srp",["laserPoint","avoidPolygonInfo","robotInfo"]),...Object(n.d)(["uiServerDomain"]),...Object(n.d)("srp",["isSystemIdle","isEmergencyNone","isNotForkLiftRobot","pose","laserPointNo","isLocationSucceed","navPaths","lmkList","featureInfos","displayedMapName","displayedMapNameIsEqualSrosCurMapName","isLockedByOthers","isManualCtrlState","hasRunningState","stationNo"]),isEditMapState(){return this.$store.getters.isEditMap},robotPoseAndState(){let t=1;this.isEmergencyNone?this.isSystemIdle||(t=2):t=3;const e=["idle","busy","error"][t-1];return{...this.pose,state:t,...this.robotIconSize,status:e,img:"",isShowRobotIcon:this.isShowRobotIcon,isFollowRobotIcon:this.isFollowRobotIcon}},isShowRobotIcon(){return this.getMapSwitchItem(o.e.KEY_ROBOT_STATE).state},isFollowRobotIcon(){return this.getMapSwitchItem(o.e.KEY_FOLLOW_ROBOT).state},isShowLaser(){return this.getMapSwitchItem(o.e.KEY_LASER_POINT_STATE).state},isShowAllLaser(){return this.getMapSwitchItem(o.e.KEY_ALL_LASER_POINT_STATE).state},isShowAvoidRect(){return this.getMapSwitchItem(o.e.KEY_AVOID_RECTANGLE).state},isShowRuntimeFeatureGroup(){return this.otherSwitchItems.some(t=>t.state&&t.key===o.e.KEY_RECOGNITION_LIDAR)},isShowNavPath(){return this.getMapSwitchItem(o.e.KEY_NAV_PATH_STATE).state},isHomePage(){return"/homePage"===this.$route.path},edgeGroupList(){return[{label:this.$t("button.create")+this.$t("label.edgeGroup")+"...",value:-1},...this.edgeGroups]},transAction(){return Object(l.y)(this.action)},isNotCanMapSave(){return this.displayedMapNameIsEqualSrosCurMapName&&(this.isLockedByOthers||this.hasRunningState)}},data(){return{mapName:"",robotIconSize:{width:95,height:62},loading:!1,parseFrequentlyDataState:!0,parseState:0,initRenderEndState:!1,worldMouse:{x:0,y:0,mousePos:"(0 m, 0 m)",zoom:1},isContextMenuOpen:!1,isEscDialogOnly:!1,promiseCallback:{},mapSwitchItems:Object(l.t)(),otherSwitchItems:Object(l.v)(),laserSwitchMap:new Map,isMobile:this.$q.platform.is.mobile,funcAreaPreferenceList:[],funcAreaOriginalUserDefinedParams:[],mapCheckList:[],action:l.o.NORMAL,stations:[],edges:[],areas:[],locationAreas:[],noteAreas:[],nodes:[],tags:[],dmCodes:[],edgeGroups:[],wareroomAreas:[],wareroomRegions:[],containerMapV2Id:`container-${Object(a.a)()}`}},async created(){this.myStdMap=Object(s.shallowRef)(null),this.robotIconSize=await Object(l.w)(),this.setMousetrap(),this.getCameraParamListAction()},mounted(){},watch:{robotPoseAndState:{handler:function(t,e){this.setRobotPoseAndState()},deep:!0},avoidPolygonInfo:{handler:function(t,e){this.isShowAvoidRect&&this.updateAvoidPolygons()},deep:!0},laserPointNo(){this.isShowLaser&&(this.updateLaserPoints(this.laserPoint),this.updateRuntimeLMKList(this.lmkList))},navPaths(t,e){this.isShowNavPath&&this.updateNavPath()},featureInfos(t,e){this.isShowRuntimeFeatureGroup&&this.updateRuntimeFeatureList(t)},isManualCtrlState(){var t;this.isHomePage&&this.isEditMapState&&(null===(t=this.myStdMap.value)||void 0===t||t.mapCreator.setMoveable(!this.isManualCtrlState))},async isEditMapState(t,e){this.isHomePage&&await this.changeEditMapState(t)}},destroyed(){this.resetMap()},inject:["showLoading","hideLoading","doAsk","getInput"],methods:{...Object(n.e)("srp",["onNewFeatureInfoUpload"]),...Object(n.c)(["getCameraParamListAction"]),...Object(n.c)("srp",["getMapList","requestEnableManualControl","setAutoUploadLaserPoint","setAutoUploadAvoidRectangleList"]),setMapName(t){this.mapName=t},async drawMap(t=""){if(!document.getElementById(this.containerMapV2Id))return!1;this.resetMap(),this.setMapName(t);try{var e,i;const[t,a,s]=await Promise.all([Object(r.O)(this.mapName),Object(r.M)(this.mapName),Object(r.Z)(this.mapName)]);s.forEach(t=>{t.type=o.e.QRCODE_TYPE_FUSE_LOCATE}),t.private||(t.private={}),t.private.fuseLocateQRCode=s,t.private.lmk=a;const n=Object(it.a)(t,"data.area",[]);Object(it.b)(t,"data.area",n.map(t=>Object(l.B)(t)));const c=`${this.uiServerDomain}/api/v0/map/${this.mapName}/image?scale=1`,h=!this.$debug&&((null==t||null===(e=t.data)||void 0===e||null===(i=e.edge)||void 0===i?void 0:i.length)||0)>3e3;let u=[l.f.STATION,l.f.BACKGROUND_IMG];return this.mapSwitchItems=Object(l.t)(),h?this.$q.notify({message:this.$t("text.initRenderBigMapTip"),icon:"announcement",color:"secondary",position:"top"}):(u=[...u,l.f.NODE,l.f.EDGE,l.f.FUNC_AREA,l.f.NOTE_AREA,l.f.TAG,"feature-map","feature-station-map","dmcode-map","lmk-map"],this.mapSwitchItems.forEach(t=>t.state=t.key!==o.e.KEY_MAP_LOCATION_AREA_STATE)),this.myStdMap.value=new d.a({id:this.containerMapV2Id,mapData:t,backgroundUrl:c,renderTool:!1,statTool:!1,displayItem:u,displayTools:[],callbackMap:{locateMoveFn:t=>{this.$emit("locateMovePoseFn",t)},calculateDistanceFn:async t=>{await this.$refs.refMessageDlg.doShowMessage({title:this.$t("button.calculateDistance"),message:this.$t("text.distanceBetween",{len:(t/100).toFixed(2)})})},stageAssistFn:async(t={})=>{switch(t.type){case"pointer":this.worldMouse.x=(t.x/100).toFixed(2),this.worldMouse.y=(t.y/100).toFixed(2),this.worldMouse.mousePos=`(${this.worldMouse.x} m, ${this.worldMouse.y} m)`;break;case"zoom":this.worldMouse.zoom=(1/t.zoom).toFixed(2);break;case"translation":return this.$t(t.key,t.params);case"select":return await this.selectItemWithOpts(t.key,t.params);case"notify":this.$notify({message:t.text||(t.keyData?this.$t(t.key,t.keyData):this.$t(t.key)),timeout:t.timeout,type:t.notifyType,position:t.position});break;case"graphLabel":this.modifyGraphLabel(t);break;case"doubleClicked":await this.onItemDoubleClicked(t);break;case"contextMenu":this.setContextMenuOpen(t);break;case"updateAction":this.action=t.action;break;case"getInputAxis":await this.getInputAxis(t.axisType,t.value);break;case"getCoordinateOffset":this.$refs.refSelectCoordinate.opened=!0;break;case"recodeDMCode":await this.doAction(o.e.ACTION_SET_BARCODE)}},initRenderEndFn:t=>{this.initRenderEndCallback(!0,this.parseState)}}}),this.myStdMap.value.setMapReference(),this.setRobotPoseAndState(),this.updateNavPath(),this.myStdMap.value.mapCreator.centerOnRobotIcon(),this.initRenderEndCallback(this.initRenderEndState,2),!0}catch(t){return this.initRenderEndCallback(this.initRenderEndState,1),!1}},async drawMapLMK(){var t;const e=await Object(r.M)(this.mapName);null===(t=this.myStdMap.value)||void 0===t||t.mapCreator.lmkCreator(l.f.LMK,e)},async drawFuseLocateCode(t=!0,e){var i,a;let s=(null==e||null===(i=e.private)||void 0===i?void 0:i.fuseLocateQRCode)||[];t&&(s=await Object(r.Z)(this.mapName)),s.forEach(t=>{t.type=o.e.QRCODE_TYPE_FUSE_LOCATE}),null===(a=this.myStdMap.value)||void 0===a||a.mapCreator.dmcodeCreator(s)},drawUnSavedCleanArea(t=!0){var e;!t&&(null===(e=this.myStdMap.value)||void 0===e||e.setDisplay("unsaved-clean-area-map"))},resetHomeData(){this.isContextMenuOpen=!1,this.funcAreaOriginalUserDefinedParams=[],this.mapCheckList=[],this.setInteraction(l.o.NORMAL),this.stations=[],this.edges=[],this.areas=[],this.locationAreas=[],this.noteAreas=[],this.nodes=[],this.tags=[],this.dmCodes=[],this.edgeGroups=[],this.wareroomAreas=[],this.wareroomRegions=[]},resetMap(){var t;this.resetHomeData(),null===(t=this.myStdMap.value)||void 0===t||t.reset(),this.myStdMap.value=null},async handleMapMaybeChange(){this.mapName&&this.mapName!==this.displayedMapName&&await this.toggleMap(this.displayedMapName)},async toggleMap(t){return await this.drawMap(t)},initRenderEndCallback(t,e){this.initRenderEndState=t,this.parseState=e,2===this.parseState&&this.initRenderEndState?(this.parseState=0,this.initRenderEndState=!1,this.loading=!1):1===this.parseState&&(this.parseState=0,this.initRenderEndState=!1,this.$notify({message:this.$t("text.loadMapFailed"),timeout:3e3,type:"negative",position:"top"}),this.loading=!1)},async setRobotPoseAndState(){var t;this.parseFrequentlyDataState&&(null===(t=this.myStdMap.value)||void 0===t||t.mapCreator.setRobotPoseAndState({...this.robotPoseAndState,img:(await Object(l.C)(this.robotPoseAndState.status)).image}))},setLocusState(t){var e;null===(e=this.myStdMap.value)||void 0===e||e.mapCreator.locusUpdate(t)},setInteraction(t){var e,i;null===(e=this.myStdMap)||void 0===e||null===(i=e.value)||void 0===i||i.mapCreator.setInteraction(t),this.$emit("setPageAction",t)},async cancelInteraction(){var t;null===(t=this.myStdMap.value)||void 0===t||t.mapCreator.cancelInteraction(),this.$emit("setPageAction",l.o.NORMAL)},updateLaserPoints(t={},e=this.isShowLaser){var i;const{locLaserPoints:a=[],extLaserPoints:s=[],obaLaserPoints:n=[]}=t,o={isShowLaser:this.isShowLaser,isShowAllLaser:this.isShowAllLaser,isMobile:this.isMobile,sensorColorDisplayMap:this.sensorColorDisplayMap,colorType:"sensorColor",defaultColor:"#70f3ff"};null===(i=this.myStdMap.value)||void 0===i||i.mapCreator.laserUpdate(e,Object(l.z)(a,this.laserSwitchMap,this.otherSwitchItems,o),Object(l.z)(s,this.laserSwitchMap,this.otherSwitchItems,{...o,defaultColor:"#ffd600"}),Object(l.z)(n,void 0,void 0,{...o,colorType:"obaColor",defaultColor:"#d50000"}))},updateNavPath(){var t;this.parseFrequentlyDataState&&(null===(t=this.myStdMap.value)||void 0===t||t.mapCreator.navPathUpdate(this.isShowNavPath,this.navPaths))},updateRuntimeLMKList(t){var e;null===(e=this.myStdMap.value)||void 0===e||e.mapCreator.updateRuntimeLMKList(this.isShowLaser,t.map(t=>({...t,isMatched:!!t.isMatched,x:t.x/10,y:t.y/10})))},updateRuntimeFeatureList(t=[]){var e;null===(e=this.myStdMap.value)||void 0===e||e.mapCreator.updateRuntimeFeatureList(this.isShowRuntimeFeatureGroup,t)},translateToRobotPoint(t,e,i,a={}){let s=Math.cos(i),n=Math.sin(i),o={};return o.x=a.x*s-a.y*n+t,o.y=a.x*n+a.y*s+e,o},updateAvoidPolygons(){var t;let{carSimulatePoses:e=[],type:i=1,color:a}=this.avoidPolygonInfo;null===(t=this.myStdMap.value)||void 0===t||t.mapCreator.avoidRectUpdate(this.isShowAvoidRect,e,a,1===i)},getMapSwitchItem:function(t){return[...this.mapSwitchItems,...this.otherSwitchItems].find(e=>e.key===t)},onSwitchStateChanged:function(t){let e=t.state;switch(t.key){case o.e.KEY_ROBOT_STATE:break;case o.e.KEY_MAP_EDGE:var i;null===(i=this.myStdMap.value)||void 0===i||i.setDisplay(l.f.EDGE,e);break;case o.e.KEY_MAP_STATION:var a;null===(a=this.myStdMap.value)||void 0===a||a.setDisplay(l.f.STATION,e);break;case o.e.KEY_MAP_NODE:var s;null===(s=this.myStdMap.value)||void 0===s||s.setDisplay(l.f.NODE,e);break;case o.e.KEY_MAP_FUNC_AREA:var n;null===(n=this.myStdMap.value)||void 0===n||n.setDisplay(l.f.FUNC_AREA,e);break;case o.e.KEY_MAP_NOTE_AREA_STATE:var r;null===(r=this.myStdMap.value)||void 0===r||r.setDisplay(l.f.NOTE_AREA,e);break;case o.e.KEY_MAP_LOCATION_AREA_STATE:var c;null===(c=this.myStdMap.value)||void 0===c||c.setDisplay(l.f.LOCATION_AREA,e);break;case o.e.KEY_LMK:var d,h;null===(d=this.myStdMap.value)||void 0===d||d.setDisplay(l.f.LMK_NORMAL,e),null===(h=this.myStdMap.value)||void 0===h||h.setDisplay(l.f.LMK_RUNTIME,e);break;case o.e.KEY_BACKGROUND_IMAGE_STATE:var u;null===(u=this.myStdMap.value)||void 0===u||u.setDisplay(l.f.BACKGROUND_IMG,e);break;case o.e.KEY_MAP_BARCODE:var p;null===(p=this.myStdMap.value)||void 0===p||p.setDisplay("dmcode-map",e);break;case o.e.KEY_MAP_TAG:var m;null===(m=this.myStdMap.value)||void 0===m||m.setDisplay(l.f.TAG,e);break;case o.e.KEY_MAP_FEATURE:var f,g,_;null===(f=this.myStdMap.value)||void 0===f||f.setDisplay("feature-map",e),null===(g=this.myStdMap.value)||void 0===g||g.setDisplay("feature-station-map",e),null===(_=this.myStdMap.value)||void 0===_||_.setDisplay("feature-runtime-map",e);break;case o.e.KEY_ITEM_NAMES:var y,v,b,E;if(e)null===(y=this.myStdMap.value)||void 0===y||y.mapCreator.setTextDisplayState(e),null===(v=this.myStdMap.value)||void 0===v||v.mapCreator.grade2Zoom(1);else null===(b=this.myStdMap.value)||void 0===b||b.mapCreator.grade2Zoom(.4),null===(E=this.myStdMap.value)||void 0===E||E.mapCreator.setTextDisplayState(e);break;case o.e.KEY_FOLLOW_ROBOT:break;case o.e.KEY_LASER_POINT_STATE:e||(this.getMapSwitchItem(o.e.KEY_ALL_LASER_POINT_STATE).state=!1,this.updateLaserPoints({},!0),this.updateRuntimeLMKList([])),this.setAutoUploadLaserPoint(e);break;case o.e.KEY_ALL_LASER_POINT_STATE:if(e){let t=this.getMapSwitchItem(o.e.KEY_LASER_POINT_STATE);t.state||(t.state=!0,t=null,this.setAutoUploadLaserPoint(!0))}break;case o.e.KEY_AVOID_RECTANGLE:this.setAutoUploadAvoidRectangleList(e),this.updateAvoidPolygons();break;case o.e.KEY_RECOGNITION_LIDAR:this.onRecognitionStateChanged(e,"LIDAR");break;case o.e.KEY_UPDATE_BUSY_NETWORK_DATA:this.parseFrequentlyDataState=e;break;case o.e.KEY_DISTANCE_STATE:var A;null===(A=this.myStdMap.value)||void 0===A||A.mapCreator.handleCalculateDistance(!1,e?2:1);break;case o.e.KEY_NAV_PATH_STATE:this.updateNavPath();break;case o.e.KEY_ROBOT_LOCUS_STATE:this.setLocusState(e?1:2);break;default:t.type===l.h&&this.laserSwitchMap.set(t.key,e)}},onDoMapAction(t){switch(t){case o.e.EVENT_ZOOM_IN:var e;null===(e=this.myStdMap.value)||void 0===e||e.mapCreator.setZoomInOrOut(!0);break;case o.e.EVENT_ZOOM_OUT:var i;null===(i=this.myStdMap.value)||void 0===i||i.mapCreator.setZoomInOrOut(!1);break;case o.e.EVENT_ROTATE_LEFT:var a;null===(a=this.myStdMap.value)||void 0===a||a.mapCreator.setMapRotate(o.e.ANGLE_ROTATE_BIG_STEP);break;case o.e.EVENT_ROTATE_RIGHT:var s;null===(s=this.myStdMap.value)||void 0===s||s.mapCreator.setMapRotate(-o.e.ANGLE_ROTATE_BIG_STEP);break;case o.e.EVENT_CENTER_ROBOT:var n;null===(n=this.myStdMap.value)||void 0===n||n.mapCreator.centerOnRobotIcon();break;case o.e.EVENT_CLEAR_LOCUS:this.setLocusState(3)}},async onRecognitionStateChanged(t,e){try{await c.d.enableFeatureDebug(t,e)}catch(t){}this.isShowRuntimeFeatureGroup||(this.onNewFeatureInfoUpload([]),this.updateRuntimeFeatureList([]))},setMousetrap(){u.a.bind("esc",()=>{this.isHomePage&&(this.isEscDialogOnly?this.isEscDialogOnly=!1:this.cancelInteraction())},"keyup")},setContextMenuOpen({action:t=l.o.NONE,selectedList:e=[],clipboardList:i=[]}={}){this.isContextMenuOpen=!0;const[a,s,n,o]=[[],[],[],[]];e.forEach(t=>{switch(t.type){case l.g.STATION:a.push(t);break;case l.g.EDGE:s.push(t);break;case l.g.FUNC_AREA:n.push(t);break;case l.g.NODE:o.push(t)}});let r=[];Object(l.p)(t)&&r.push({id:at,name:this.$t("button.cancel"),isActive:!1}),this.isEditMapState?(e.length&&r.push({id:st,name:this.$t("button.delete"),isActive:!1}),s.length&&(r.push({id:rt,name:this.$t("button.addToGroup"),isActive:!1}),r.push({id:ft,name:this.$t("text.pathMaxSpeedBatchSettingTitle"),isActive:!1})),a.length&&r.push({id:ut,name:this.$t("button.rotateSitesInBatches"),isActive:!1}),1===e.length?t===l.o.NORMAL&&(a.length?r.push({id:ht,name:this.$t("button.bulkCopySite"),isActive:!1}):1===n.length&&r.push({id:ct,name:this.$t("button.copy"),isActive:!1})):(a.length>1&&r.push({id:pt,name:this.$t("text.pathBatchGenerationTitle"),isActive:!1}),o.length>1&&r.push({id:mt,name:this.$t("text.linearNodeTitle"),isActive:!1})),i.length&&r.push({id:dt,name:this.$t("button.paste"),isActive:!1})):(a.forEach(t=>{r.push({id:nt,name:this.$t("label.moveTo")+" "+t.label,isActive:!1,stationID:t.id})}),r.push({id:ot,name:this.$t("button.moveToPose"),isActive:!1})),r.push({id:lt,name:this.$t("button.calculateDistance"),isActive:!1});let c=null;this.$nextTick(async()=>{try{c=await this.$refs.ctxMenu.openContextMenu(r)}catch(t){}this.isContextMenuOpen=!1,c&&await this.handleContextMenuSelected(c)})},async handleContextMenuSelected(t){switch(t.id){case at:this.cancelInteraction();break;case st:var e;await(null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.deleteAllSelectedItems());break;case nt:this.$emit("selectStation",t.stationID);break;case ot:this.$emit("moveToPos");break;case lt:this.setInteraction(l.o.CALCULATE_DISTANCE);break;case rt:this.edgeGroupList.length>1&&this.$refs.refSelectEdgeGroup.setSeletedItem(this.edgeGroupList[1].value),this.$refs.refSelectEdgeGroup.opened=!0;break;case ct:var i;null===(i=this.myStdMap.value)||void 0===i||i.mapCreator.stageModel.copy();break;case dt:var a;null===(a=this.myStdMap.value)||void 0===a||a.mapCreator.stageModel.parseClipboardList();break;case ht:var s;this.cancelInteraction(),this.$refs.refStationBatchCopyEditor.initData(null===(s=this.myStdMap.value)||void 0===s?void 0:s.mapCreator.stageModel.stationStage.getCopyStartId());break;case ut:await this.onStationRotateEditor();break;case pt:await this.onEdgeBatchGeneratorEditor();break;case mt:await this.onNodesLinearMoveEditor();break;case ft:await this.onEdgeBatchSetMaxSpeedEditor()}},async selectItemWithOpts(t,e){if(e.length<=0)return null;if(1===e.length)return e[0];try{const i=await this.$refs.refSelectDialog.doSelect({title:t,options:e});return e.find(t=>t.value===i)||!1}catch(t){return t||(this.isEscDialogOnly=!0),!1}},onSelectItem(t){null!==t?this.promiseCallback.resolve(t):this.promiseCallback.reject("Cancel select item")},async changeEditMapState(t){var e,i,a,s,n;t?(null===(e=this.myStdMap.value)||void 0===e||e.mapCreator.setEditState(t),null===(i=this.myStdMap.value)||void 0===i||i.mapCreator.setMoveable(!this.isManualCtrlState)):(null===(a=this.myStdMap.value)||void 0===a||a.mapCreator.setEditState(t),null===(s=this.myStdMap.value)||void 0===s||s.mapCreator.stageModel.updateSelectedItemList([]),null!==(n=this.myStdMap.value)&&void 0!==n&&n.mapCreator.mapModel.isMapDataChanged()&&await this.askToSaveMap(this.isNotCanMapSave))},async onSaveMap(){this.cancelInteraction(),await this.askDeleteUnusedNodes()&&(this.showLoading(this.$t("label.checkingMap")),await this.setCheckMapStatus(),this.hideLoading(),this.mapCheckList.length?this.$refs.refCheckMapList.opened=!0:this.doSaveMap())},doSaveMap(){var t,e;null===(t=this.myStdMap.value)||void 0===t||t.mapCreator.stageModel.stationStage.updateStationRecordedNodeId();let i=null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.mapModel.saveToJson();i&&this.$emit("saveMap",{mapName:this.mapName,mapJson:i})},setSaveMapState(){var t,e,i;null===(t=this.myStdMap.value)||void 0===t||t.mapCreator.stageModel.buildingAreaStage.setCleanAreaUnAccessible();let a=null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.mapModel.saveToJson();a&&(null===(i=this.myStdMap.value)||void 0===i||i.mapCreator.mapModel.updateOriginalData(a))},exitEditMap(t){this.$emit("exitEdit",t)},async askToSaveMap(t=!1){!t&&await this.doAsk({title:this.$t("label.saveMap"),question:this.$t("text.isSaveMap")})?await this.onSaveMap():await this.toggleMap(this.mapName)},async askDeleteUnusedNodes(){var t;const e=null===(t=this.myStdMap.value)||void 0===t?void 0:t.mapCreator.stageModel.nodeStage.getUnusedNodeList();if(!e.length)return!0;let i=!0;try{await this.$refs.refQuestionDlg.doAsk({title:this.$t("button.save"),question:this.$t("text.isKeepUnusedNodes"),labelCancel:this.$t("label.no"),labelOkay:this.$t("label.yes")}),i=!0}catch(t){var a;if(i=t,i)await(null===(a=this.myStdMap.value)||void 0===a?void 0:a.mapCreator.stageModel.deleteAllSelectedItems(e))}return i},async setCheckMapStatus(){var t,e,i,a,s;this.mapCheckList=(await Promise.all([null===(t=this.myStdMap.value)||void 0===t?void 0:t.mapCreator.stageModel.stationStage.checkRelation(this.allowMaxStationId),null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.nodeStage.checkRelation(),null===(i=this.myStdMap.value)||void 0===i?void 0:i.mapCreator.stageModel.lineEdgeStage.checkRelation(),null===(a=this.myStdMap.value)||void 0===a?void 0:a.mapCreator.stageModel.bezierEdgeStage.checkRelation(),null===(s=this.myStdMap.value)||void 0===s?void 0:s.mapCreator.stageModel.funcAreaStage.checkRelation()])).flat().map((t,e)=>({...t||{},id:e+1}))},setFuncAreaPreference(t=[]){this.funcAreaPreferenceList=t},modifyGraphLabel({operateType:t=l.m.NONE,graphLabelItem:e={}}){let i=null;switch(e.type){case l.g.NODE:i=this.nodes;break;case l.g.STATION:i=this.stations;break;case l.g.EDGE:i=this.edges;break;case l.g.FUNC_AREA:i=this.areas;break;case l.g.LOCATION_AREA:i=this.locationAreas;break;case l.g.NOTE_AREA:i=this.noteAreas;break;case l.g.TAG:i=this.tags;break;case l.g.EDGE_GROUP:i=this.edgeGroups;break;case l.g.DMCODE:i=this.dmCodes}if(i)switch(t){case l.m.ADD:{const{id:t=0,edgeId:a=0,level:s=1}=e;if(2===s){const e=this.edgeGroups.find(e=>e.id===t);if(!e)return;if(e.edges||(e.edges=[]),!e.edges.find(t=>t.id===a)){const i=this.edges.find(t=>t.id===a);i&&e.edges.push({...i,groupId:t})}return}!i.some(t=>t.id===e.id)&&i.push(e);break}case l.m.UPDATE:{const t=e.oldId||e.id,a=i.findIndex(e=>e.id===t);~a&&this.$set(i,a,{...i[a],id:e.id,value:e.value,key:e.key,label:e.label});break}case l.m.DELETE:{const{id:t=0,edgeId:a=0,level:s=1}=e;if(2===s){const e=this.edgeGroups.find(e=>e.id===t);if(!e.edges)return;const i=e.edges.findIndex(t=>t.id===a);return void(~i&&e.edges.splice(i,1))}const n=i.findIndex(t=>t.id===e.id);~n&&i.splice(n,1);break}case l.m.CLEAN:i=[]}},getEdgeBelongGroups(t){let e=[];for(let a of Array.from(null===(i=this.myStdMap.value)||void 0===i?void 0:i.mapCreator.mapModel._edgeGroupDataList)){var i;a.hasEdge(t)&&e.push(a)}return e},async onDBLClickItemFromMapItemList(t){let e=t.id,i=null;switch(t.type){case l.g.NODE:var a;i=null===(a=this.myStdMap.value)||void 0===a?void 0:a.mapCreator.stageModel.nodeStage.getOneItem(e);break;case l.g.STATION:var s,n;if(i=null===(s=this.myStdMap.value)||void 0===s?void 0:s.mapCreator.stageModel.stationStage.getOneItem(e),i)null===(n=this.myStdMap.value)||void 0===n||n.mapCreator.stageModel.stationStage.updateStationRecordedNodeId([i]);break;case l.g.EDGE:var o,r;i=(null===(o=this.myStdMap.value)||void 0===o?void 0:o.mapCreator.stageModel.lineEdgeStage.getOneItem(e))||(null===(r=this.myStdMap.value)||void 0===r?void 0:r.mapCreator.stageModel.bezierEdgeStage.getOneItem(e));break;case l.g.FUNC_AREA:var c;i=null===(c=this.myStdMap.value)||void 0===c?void 0:c.mapCreator.stageModel.funcAreaStage.getOneItem(e);break;case l.g.LOCATION_AREA:var d;i=null===(d=this.myStdMap.value)||void 0===d?void 0:d.mapCreator.stageModel.locationAreaStage.getOneItem(e);break;case l.g.NOTE_AREA:var h;i=null===(h=this.myStdMap.value)||void 0===h?void 0:h.mapCreator.stageModel.noteAreaStage.getOneItem(e);break;case l.g.DMCODE:var u;i=null===(u=this.myStdMap.value)||void 0===u?void 0:u.mapCreator.stageModel.dmCodeStage.getOneItem(e);break;case l.g.EDGE_GROUP:try{await this.onEditFromMapItemList(t)}catch(t){}return}i&&await this.onItemDoubleClicked({isFromCanvas:!1,dat:i.dataModel})},async onItemDoubleClicked({isFromCanvas:t=!1,dat:e={},list:i=[]}={}){if(e.isStationModel()){var a;this.$refs.refStationEditor.model=e.toJson(!1),this.$refs.refStationEditor.stationItems=[];const t=(null===(a=this.myStdMap.value)||void 0===a?void 0:a.mapCreator.stageModel.wareroomStage.getWareroomForStation())||{};this.wareroomAreas=t.wareroomAreas||[],this.wareroomRegions=t.wareroomRegions||[],this.$refs.refStationEditor.opened=!0}else if(e.isNodeModel())this.$refs.refNodeEditor.model=e.toJson(!1),this.$refs.refNodeEditor.opened=!0;else if(e.isFuncAreaModel()){var s;this.funcAreaOriginalUserDefinedParams=null===(s=this.myStdMap.value)||void 0===s?void 0:s.mapCreator.mapModel.getOriginalAreaUserDefinedParams(e.getID()),this.$refs.refAreaEditor.model=e.toJson(!1),this.$refs.refAreaEditor.opened=!0}else e.isEdgeModel()?(this.$refs.refEdgeEditor.model=e.toJson(!1),this.$refs.refEdgeEditor.setBelongEdgeGroups(this.getEdgeBelongGroups(e.getID())),this.$refs.refEdgeEditor.opened=!0):e.isDMCodeModel()?this.showDMCodeEditor(e.toJson(!1)):e.isNoteAreaModel()?this.$refs.refNoteAreaEditor.setData(e.toJson(!1)):e.isLocationAreaModel()&&this.$refs.refLocationAreaEditor.setData(e.toJson(!1));this.isContextMenuOpen=!1},async doAction(t){switch(t){case o.e.ACTION_SET_SELECTION:this.setInteraction(l.o.SELECTION);break;case o.e.ACTION_SET_TAG:this.setInteraction(l.o.TAG);break;case o.e.ACTION_SET_STATION:this.setInteraction(l.o.STATION);break;case o.e.ACTION_SET_NODE:this.setInteraction(l.o.NODE);break;case o.e.ACTION_SET_BARCODE:this.startRecordDMCode();break;case o.e.ACTION_SET_STATION_AND_FEATURE_BINDING:this.$notify({message:this.$t("text.featuresToBeReleased"),timeout:3e3,type:"negative",position:"top"});break;case o.e.ACTION_SET_LINE:this.setInteraction(l.o.LINE);break;case o.e.ACTION_SET_BEZIER:this.setInteraction(l.o.BEZIER);break;case o.e.ACTION_SET_ROUND_CORNER:this.$notify({message:this.$t("text.featuresToBeReleased"),timeout:3e3,type:"negative",position:"top"});break;case o.e.ACTION_SET_AREA:this.setInteraction(l.o.FUNC_AREA);break;case o.e.ACTION_SET_NOTE_AREA:this.setInteraction(l.o.NOTE_AREA);break;case o.e.ACTION_SET_LOCATION_AREA:this.setInteraction(l.o.LOCATION_AREA);break;case o.e.ACTION_SET_CLEAN_AREA:this.setInteraction(l.o.CLEAN_AREA);break;case o.e.ACTION_SET_UNCLEAN_AREA:var e;await(null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.buildingAreaStage.deleteLatestSomeBuildingArea(l.g.CLEAN_AREA))}},onClickItemFromMapItemList:function(t){var e,i;t.type===l.g.EDGE_GROUP?null===(e=this.myStdMap.value)||void 0===e||e.mapCreator.stageModel.edgeGroupStage.setEdgeGroupSelected(t.id):null===(i=this.myStdMap.value)||void 0===i||i.mapCreator.setElementCenterAndSelected(t)},async onDeleteItemFromMapItemList(t){let e=t.id;switch(t.type){case l.g.NODE:var i,a;if(e<0)await(null===(i=this.myStdMap.value)||void 0===i?void 0:i.mapCreator.stageModel.nodeStage.deleteAll());else await(null===(a=this.myStdMap.value)||void 0===a?void 0:a.mapCreator.stageModel.nodeStage.delete(e));break;case l.g.STATION:var s,n;if(e<0)await(null===(s=this.myStdMap.value)||void 0===s?void 0:s.mapCreator.stageModel.stationStage.deleteAll());else await(null===(n=this.myStdMap.value)||void 0===n?void 0:n.mapCreator.stageModel.stationStage.delete(e));break;case l.g.EDGE:var o,r;if(e<0)await(null===(o=this.myStdMap.value)||void 0===o?void 0:o.mapCreator.stageModel.lineEdgeStage.deleteAll()),await(null===(r=this.myStdMap.value)||void 0===r?void 0:r.mapCreator.stageModel.bezierEdgeStage.deleteAll());else if(t.groupId>0){var c;null===(c=this.myStdMap.value)||void 0===c||c.mapCreator.stageModel.edgeGroupStage.updateEdgeIds(t.groupId,e,l.m.DELETE)}else{var d,h;let t=null===(d=this.myStdMap.value)||void 0===d?void 0:d.mapCreator.stageModel.lineEdgeStage.getOneItem(e),i=!t&&(null===(h=this.myStdMap.value)||void 0===h?void 0:h.mapCreator.stageModel.bezierEdgeStage.getOneItem(e));var u;if(t)await(null===(u=this.myStdMap.value)||void 0===u?void 0:u.mapCreator.stageModel.lineEdgeStage.delete(e));else if(i){var p;await(null===(p=this.myStdMap.value)||void 0===p?void 0:p.mapCreator.stageModel.bezierEdgeStage.delete(e))}}break;case l.g.EDGE_GROUP:var m,f;if(e<0)await(null===(m=this.myStdMap.value)||void 0===m?void 0:m.mapCreator.stageModel.edgeGroupStage.deleteAll());else await(null===(f=this.myStdMap.value)||void 0===f?void 0:f.mapCreator.stageModel.edgeGroupStage.delete(e));break;case l.g.FUNC_AREA:var g,_;if(e<0)await(null===(g=this.myStdMap.value)||void 0===g?void 0:g.mapCreator.stageModel.funcAreaStage.deleteAll());else await(null===(_=this.myStdMap.value)||void 0===_?void 0:_.mapCreator.stageModel.funcAreaStage.delete(e));break;case l.g.LOCATION_AREA:var y,v;if(e<0)await(null===(y=this.myStdMap.value)||void 0===y?void 0:y.mapCreator.stageModel.locationAreaStage.deleteAll());else await(null===(v=this.myStdMap.value)||void 0===v?void 0:v.mapCreator.stageModel.locationAreaStage.delete(e));break;case l.g.NOTE_AREA:var b,E;if(e<0)await(null===(b=this.myStdMap.value)||void 0===b?void 0:b.mapCreator.stageModel.noteAreaStage.deleteAll());else await(null===(E=this.myStdMap.value)||void 0===E?void 0:E.mapCreator.stageModel.noteAreaStage.delete(e));break;case l.g.TAG:var A,w;if(e<0)await(null===(A=this.myStdMap.value)||void 0===A?void 0:A.mapCreator.stageModel.tagStage.deleteAll());else await(null===(w=this.myStdMap.value)||void 0===w?void 0:w.mapCreator.stageModel.tagStage.delete(e));break;case l.g.DMCODE:var S,C;if(e<0)await(null===(S=this.myStdMap.value)||void 0===S?void 0:S.mapCreator.stageModel.dmCodeStage.deleteAll());else await(null===(C=this.myStdMap.value)||void 0===C?void 0:C.mapCreator.stageModel.dmCodeStage.delete(e))}},async onEditFromMapItemList(t){if(t.type===l.g.EDGE_GROUP){var e;let i=null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.mapModel.edgeGroupModel(t.id);try{let t=await this.$refs.refEdgeGroupEditor.doEditEdgeGroup(i.toJson());await this.onUpdateEdgeGroup(t)}catch(t){}}},async onTag2Node(t){var e,i;null!=t&&(t<0?await(null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.tagStage.allTags2Nodes()):await(null===(i=this.myStdMap.value)||void 0===i?void 0:i.mapCreator.stageModel.tagStage.tag2Node(t)))},async onTag2Station(t){var e,i;null!=t&&(t<0?await(null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.tagStage.allTags2Stations()):await(null===(i=this.myStdMap.value)||void 0===i?void 0:i.mapCreator.stageModel.tagStage.tag2Station(t)))},checkStationForEditor(t={}){var e;return(null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.stationStage.checkStationForEditor(t))||!1},onUpdateStation:async function(t,e){var i;this.$refs.refStationEditor.stationItems=[],await(null===(i=this.myStdMap.value)||void 0===i?void 0:i.mapCreator.stageModel.stationStage.onModify(t,e))},onUpdateNode:async function(t){var e;await(null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.nodeStage.onModify(t))},onUpdateEdge:async function(t){var e;if(t.type===l.e.LINE)await(null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.lineEdgeStage.onModify(t));else if(t.type===l.e.BEZIER){var i;await(null===(i=this.myStdMap.value)||void 0===i?void 0:i.mapCreator.stageModel.bezierEdgeStage.onModify(t))}},onUpdateArea:async function(t){var e;await(null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.funcAreaStage.onModify(t))},async onUpdateNoteArea(t){var e;await(null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.noteAreaStage.onModify(t))},async onUpdateLocationArea(t){var e;await(null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.locationAreaStage.onModify(t))},onUpdateDMCode:async function(t){var e;await(null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.dmCodeStage.onModify(t))},onEditWareroomAreaAndWareroomRegion(){var t;if(this.action!==l.o.NORMAL)return;const e=(null===(t=this.myStdMap.value)||void 0===t?void 0:t.mapCreator.stageModel.wareroomStage.getWareroomForEdit())||{};this.$refs.refWareroomAreaAndWareroomRegionEditor.wareroomAreas=e.wareroomAreas||[],this.$refs.refWareroomAreaAndWareroomRegionEditor.wareroomRegions=e.wareroomRegions||[],this.$refs.refWareroomAreaAndWareroomRegionEditor.opened=!0},onUpdateWareroomAreaAndWareroomRegion(t=[],e=[]){var i;null===(i=this.myStdMap.value)||void 0===i||i.mapCreator.stageModel.wareroomStage.onModify(t,e)},async onUpdateEdgeGroup(t){if(t.id<=0){var e;const i=null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.edgeGroupStage.addEdgeGroup(t).getID();this.$nextTick(()=>{this.$refs.refSelectEdgeGroup.setSeletedItem(i),this.$refs.refSelectEdgeGroup.opened=!0})}else{var i;await(null===(i=this.myStdMap.value)||void 0===i?void 0:i.mapCreator.stageModel.edgeGroupStage.onModify(t))}},async onCreateEdgeGroup(){try{let t=await this.$refs.refEdgeGroupEditor.doEditEdgeGroup({id:0,name:"",types:[],desc:""});await this.onUpdateEdgeGroup(t)}catch(t){}},onSelectEdgeGroup(t){var e;t<0?this.onCreateEdgeGroup():null===(e=this.myStdMap.value)||void 0===e||e.mapCreator.stageModel.selectedItemList.forEach(e=>{var i;e.getBaseType()===l.g.EDGE&&(null===(i=this.myStdMap.value)||void 0===i||i.mapCreator.stageModel.edgeGroupStage.updateEdgeIds(t,e.getID(),l.m.ADD))})},async onStationRotateEditor(){this.cancelInteraction(),this.$refs.refStationRotateEditor.opened=!0;let t=null;try{t=await this.$refs.refStationRotateEditor.initDat()}catch(t){}var e;t&&(this.loading=!0,await(null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.stationStage.onRotateByEditor(t)),this.loading=!1)},onBatchCopyStation(){this.cancelInteraction(),this.$refs.refStationBatchCopyEditor.opened=!0},async onUpdateStationBatchCopy(t={}){var e;t.isGenerateRoadMap?await this.onEdgeBatchGeneratorEditor(t):(this.loading=!0,await(null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.stationStage.onBatchCopy(t)),this.loading=!1)},async onEdgeBatchGeneratorEditor(t=null){this.cancelInteraction();let e=null;try{e=await this.$refs.refEdgeBatchGeneratorEditor.initDat(t)}catch(t){}var i,a;e&&(this.loading=!0,t?await(null===(i=this.myStdMap.value)||void 0===i?void 0:i.mapCreator.stageModel.stationStage.onBatchCopy(t,e)):await(null===(a=this.myStdMap.value)||void 0===a?void 0:a.mapCreator.stageModel.lineEdgeStage.onBatchGenerator(e)),this.loading=!1)},async onNodesLinearMoveEditor(){this.cancelInteraction();let t=null;try{t=await this.$refs.refNodesLinearMoveEditor.initDat()}catch(t){}var e;t&&(this.loading=!0,await(null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.nodeStage.onNodesLinearMove(t)),this.loading=!1)},async onEdgeBatchSetMaxSpeedEditor(){this.cancelInteraction();let t=null;try{t=await this.$refs.refEdgeBatchSetMaxSpeedEditor.initDat()}catch(t){}var e;t&&(this.loading=!0,await(null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.lineEdgeStage.onEdgeBatchSetMaxSpeed(t)),this.loading=!1)},async getInputAxis(t,e){try{if("a"===t){var i;let t=await this.getInput({type:"number",title:this.$t("label.settings")+this.$t("label.station")+this.$t("label.angle"),desc:"",value:e});this.loading=!0,await(null===(i=this.myStdMap.value)||void 0===i?void 0:i.mapCreator.stageModel.stationStage.setSelectedItemsYaw(parseFloat(t))),this.loading=!1}else{var a;let i=await this.getInput({type:"number",title:this.$t("label.setCoordinate"),desc:this.$t("text.setCoordinateBatch",{axisType:t}),value:e});this.loading=!0,await(null===(a=this.myStdMap.value)||void 0===a?void 0:a.mapCreator.stageModel.moveStage.setSelectedItemsAxis(t,parseFloat(i))),this.loading=!1}}catch(t){return null}},async moveSelectedItems(t){var e;this.loading=!0,await(null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.moveStage.setSelectedItemsMoveOffset(t)),this.loading=!1},executeHistory(){this.$notify({message:this.$t("text.featuresToBeReleased"),timeout:3e3,type:"negative",position:"top"})},focusOnMap(){var t;null===(t=document.getElementById(this.containerMapV2Id))||void 0===t||t.focus()},initRobotNetworkMonitorManager(t,e){var i,a,s;null===(i=this.myStdMap.value)||void 0===i||i.mapCreator.initRobotNetworkMonitorManager(),null===(a=this.myStdMap.value)||void 0===a||a.mapCreator.robotNetworkMonitorManager.setDisplayConfigList(t),null===(s=this.myStdMap.value)||void 0===s||s.mapCreator.robotNetworkMonitorManager.setData(e)},updateNetMonitorSSIDDisplay(t){var e;null===(e=this.myStdMap.value)||void 0===e||e.mapCreator.robotNetworkMonitorManager.setDisplayConfig(t)},updateNetMonitorDisconnectedDisplay(t){var e;null===(e=this.myStdMap.value)||void 0===e||e.mapCreator.robotNetworkMonitorManager.setDisconnectVisible(t)},setCenterElement(t={id:0,type:0}){var e;null===(e=this.myStdMap.value)||void 0===e||e.mapCreator.setElementCenterAndSelected(t)},async showDMCodeEditor(t){var e;const i=(null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.stationStage.getStationListWithDMCodeId(t.dmcode_id,0))||[];this.$refs.refDMCodeEditor.init(t,i.map(t=>t.getName()))},async startRecordDMCode(){let t=this.stationNo;if(!t&&this.isLocationSucceed){var e,i;const a=null!==(e=null===(i=this.myStdMap.value)||void 0===i?void 0:i.mapCreator.stageModel.stationStage.pickedStationListByRobotPose())&&void 0!==e?e:[];a.length>0&&(t=a[0].getID())}this.$refs.refStationDMCodeCreator.init(t)},async recordDMCode(t){var e,i;let a=!1;const s=(null===(e=this.myStdMap.value)||void 0===e?void 0:e.mapCreator.stageModel.stationStage.getStationListWithDMCodeId(t.pgvId,t.stationId))||[];if(s.length){const e=s.map(t=>t.getName()).join(",");a=await this.doAsk({title:this.$t("label.notice"),question:this.$t("text.askResetStationDmcode",{dmCodeId:t.pgvId,stations:e}),labelCancel:this.$t("label.no"),labelOkay:this.$t("label.yes")})}await(null===(i=this.myStdMap.value)||void 0===i?void 0:i.mapCreator.stageModel.dmCodeStage.addDMCode({...t,type:l.b.STATION_CORRECTION,isRetainOldStationPGV:a}))}}},_t=(i("1859"),i("de5e")),yt=i("9c40"),vt=i("0016"),bt=i("4e73"),Et=i("74f7"),At=i("d9b2"),wt=Object(G.a)(gt,function(){var t=this,e=t._self._c;return e("div",{staticClass:"box-page-map"},[e("div",{staticClass:"wrap"},[e("div",{staticClass:"container",attrs:{id:t.containerMapV2Id,tabindex:"0"}})]),t.isContextMenuOpen?e("context-menu",{ref:"ctxMenu"}):t._e(),e("select-dialog",{ref:"refSelectDialog",on:{selectItem:t.onSelectItem}}),e("StationEditor",{ref:"refStationEditor",attrs:{wareroomAreas:t.wareroomAreas,wareroomRegions:t.wareroomRegions},on:{updateModel:t.onUpdateStation}}),e("NodeEditor",{ref:"refNodeEditor",on:{updateModel:t.onUpdateNode}}),e("NoteAreaEditor",{ref:"refNoteAreaEditor",on:{updateModel:t.onUpdateNoteArea}}),e("LocationAreaEditor",{ref:"refLocationAreaEditor",on:{updateModel:t.onUpdateLocationArea}}),e("EdgeEditor",{ref:"refEdgeEditor",on:{updateModel:t.onUpdateEdge}}),e("edge-group-editor",{ref:"refEdgeGroupEditor",attrs:{"edge-groups":t.edgeGroups}}),e("select-edge-group",{ref:"refSelectEdgeGroup",attrs:{options:t.edgeGroupList},on:{selectItem:t.onSelectEdgeGroup}}),e("AreaEditor",{ref:"refAreaEditor",attrs:{preference:t.funcAreaPreferenceList,orignalParams:t.funcAreaOriginalUserDefinedParams},on:{updateModel:t.onUpdateArea}}),e("StationRotateEditor",{ref:"refStationRotateEditor",attrs:{stations:t.stations}}),e("StationBatchCopyEditor",{ref:"refStationBatchCopyEditor",on:{updateModel:t.onUpdateStationBatchCopy}}),e("BarcodeEditor",{ref:"refDMCodeEditor",on:{updateModel:t.onUpdateDMCode}}),e("StationDMCodeCreator",{ref:"refStationDMCodeCreator",attrs:{stations:t.stations},on:{updateModel:t.recordDMCode}}),e("WareroomAreaAndWareroomRegionEditor",{ref:"refWareroomAreaAndWareroomRegionEditor",on:{updateModel:t.onUpdateWareroomAreaAndWareroomRegion}}),e("EdgeBatchGeneratorEditor",{ref:"refEdgeBatchGeneratorEditor"}),e("NodesLinearMoveEditor",{ref:"refNodesLinearMoveEditor"}),e("EdgeBatchSetMaxSpeedEditor",{ref:"refEdgeBatchSetMaxSpeedEditor"}),e("set-coordinate",{ref:"refSelectCoordinate",on:{setcoordinate:t.moveSelectedItems}}),e("check-map-list",{ref:"refCheckMapList",attrs:{"check-list":t.mapCheckList},on:{close:t.doSaveMap}}),t.mapName?[!t.isMobile&&t.isEditMapState?e("q-page-sticky",{staticClass:"full-height",staticStyle:{width:"280px"},attrs:{position:"top-right"}},[e("edit-map-tool-bar",{staticStyle:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%"},attrs:{"display-map":t.mapName,"cur-action":t.transAction,stations:t.stations,edges:t.edges,areas:t.areas,nodes:t.nodes,locationAreas:t.locationAreas,noteAreas:t.noteAreas,tags:t.tags,pgvs:t.dmCodes,"edge-groups":t.edgeGroups},on:{doAction:t.doAction,executeHistory:t.executeHistory,saveMap:t.onSaveMap,exitEdit:t.exitEditMap,clickItem:t.onClickItemFromMapItemList,dblClickItem:t.onDBLClickItemFromMapItemList,deleteItem:t.onDeleteItemFromMapItemList,edit:t.onEditFromMapItemList,tag2node:t.onTag2Node,tag2station:t.onTag2Station,editWareroomAreaAndWareroomRegion:t.onEditWareroomAreaAndWareroomRegion}})],1):t._e(),e("q-page-sticky",{staticClass:"sticky-control-buttons",class:t.isEditMapState?"mr288":"",attrs:{position:"bottom-right"}},[e("control-buttons",{on:{click:t.onDoMapAction}})],1),e("q-page-sticky",{staticClass:"sticky-scale-item",class:t.isEditMapState?"mr288":"",attrs:{position:"bottom-right"}},[e("scale-item",{attrs:{"mouse-pos":t.worldMouse.mousePos,scale:t.worldMouse.zoom}})],1),e("q-page-sticky",{staticClass:"q-mt-sm q-mr-sm",class:t.isEditMapState?"mr288":"",attrs:{position:"top-right"}},[e("div",{staticClass:"row justify-between"},[e("q-btn",{staticClass:"no-shadow button_width background_white",attrs:{dense:"","no-caps":"",unelevated:""}},[e("q-icon",{staticClass:"std_eye_grey icon_size_20"}),e("div",{staticClass:"text_main_grey_style q-ml-sm"},[t._v("\n            "+t._s(t.$t("label.mapPage")+t.$t("label.element"))+"\n          ")]),e("q-menu",{attrs:{anchor:"bottom left",self:"top left"}},[e("checkbox-list",{attrs:{"checkbox-items":t.mapSwitchItems},on:{change:t.onSwitchStateChanged}})],1)],1),e("q-btn",{staticClass:"background_white q-ml-sm button_width",attrs:{dense:"","no-caps":"",unelevated:""}},[e("q-icon",{staticClass:"std_eye_grey icon_size_20"}),e("div",{staticClass:"text_main_grey_style q-ml-sm"},[t._v(t._s(t.$t("label.others")))]),e("q-menu",{attrs:{anchor:"bottom right",self:"top right"}},[e("OtherFeatureItems",{attrs:{otherSwitchItems:t.otherSwitchItems},on:{change:t.onSwitchStateChanged}})],1)],1)],1),e("MapSearchTool",{attrs:{stations:t.stations,edges:t.edges,areas:t.areas,nodes:t.nodes,locationAreas:t.locationAreas,noteAreas:t.noteAreas,tags:t.tags,dmCodes:t.dmCodes,"edge-groups":t.edgeGroups},on:{"search:select":t.setCenterElement}}),t._t("network-monitor")],2),e("message-dialog",{ref:"refMessageDlg"}),e("question-dialog",{ref:"refQuestionDlg"}),e("q-inner-loading",{attrs:{showing:t.loading}},[e("q-spinner-ios",{attrs:{size:"50px",color:"primary"}})],1)]:t._e()],2)},[],!1,null,"6bea3880",null);e.a=wt.exports;V()(wt,"components",{QPageSticky:_t.a,QBtn:yt.a,QIcon:vt.a,QMenu:bt.a,QInnerLoading:Et.a,QSpinnerIos:At.a})},"9ea9":function(t,e,i){"use strict";i("c444")},a03c:function(t,e,i){"use strict";i("b5d5")},a16a:function(t,e,i){},a1ff:function(t,e,i){"use strict";var a=i("e4ef"),s={name:"DatetimePicker",props:{datetime:Number},data:()=>({datetimeInit:""}),computed:{stringDatetime:{get:function(){return Object(a.F)(this.datetime)},set:function(t){let e=new Date(t||this.datetimeInit);this.$emit("update:datetime",e.getTime())}}},mounted(){this.datetimeInit=this.datetime||Date.now()},methods:{}},n=i("2877"),o=i("27f9"),r=i("0016"),l=i("7cbe"),c=i("52ee"),d=i("ca78"),h=i("eebe"),u=i.n(h),p=Object(n.a)(s,function(){var t=this,e=t._self._c;return e("div",{staticStyle:{"max-width":"220px"}},[e("q-input",{attrs:{outlined:"",dense:""},scopedSlots:t._u([{key:"prepend",fn:function(){return[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event",color:"grey-5"}},[e("q-popup-proxy",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[e("q-date",{attrs:{mask:"YYYY-MM-DD HH:mm:ss"},model:{value:t.stringDatetime,callback:function(e){t.stringDatetime=e},expression:"stringDatetime"}})],1)],1)]},proxy:!0},{key:"append",fn:function(){return[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"access_time",color:"grey-5"}},[e("q-popup-proxy",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[e("q-time",{attrs:{mask:"YYYY-MM-DD HH:mm:ss",format24h:""},model:{value:t.stringDatetime,callback:function(e){t.stringDatetime=e},expression:"stringDatetime"}})],1)],1)]},proxy:!0}]),model:{value:t.stringDatetime,callback:function(e){t.stringDatetime=e},expression:"stringDatetime"}})],1)},[],!1,null,"5a474dfa",null);e.a=p.exports;u()(p,"components",{QInput:o.a,QIcon:r.a,QPopupProxy:l.a,QDate:c.a,QTime:d.a})},a574:function(t,e,i){"use strict";i("910d"),i("f665"),i("7d54"),i("ab43"),i("9485");var a=i("b69e"),s=i("dde5"),n=i("2222"),o=i("b5ae"),r=i("de9c"),l=i("32e0"),c=i("b965"),d={name:"ConfigEditModal",components:{HeaderItem:l.a,ChoiceButtons:r.a},data:()=>({newValue:"",options:null,vehicleTypeList:[]}),validations:{newValue:{required:o.required}},props:{opened:Boolean,config:{type:Object,default:()=>({})},vehicleTypeOptions:{type:Array,default:()=>[]},areaSpecificConfigs:{type:Object,default:()=>({disabled:!1,areaConfig:!1})}},computed:{fields(){if(!this.config||!this.opened)return;const{key:t,name:e,description:i,permission:a,value_type:n,value_range:o}=this.config;return[{name:"key",value:t},{name:this.$t("label.name"),value:e},{name:this.$t("label.desc"),key:"description",value:i},{name:this.$t("label.authority"),value:Object(s.k)(a)},{name:this.$t("label.typeOfData"),value:n},{name:this.$t("label.range"),value:o},{name:this.$t("label.defaultValue"),value:this.getDefaultValue(this.config)},{name:this.$t("label.currentValue"),value:this.getCurValue(this.config)}]},isNumberItem(){return c.q.includes(this.config.value_type)},isStrItem(){return c.p.STRING===this.config.value_type},numberStep(){return[c.p.INT].includes(this.config.value_type)?1:.001},numberRange(){const t={min:-1/0,max:1/0,minWithEqual:!1,maxWithEqual:!1};if(!this.isNumberItem)return t;const{value_range:e=""}=this.config;if(!((e.startsWith("(")||e.startsWith("["))&&(e.endsWith(")")||e.endsWith("]"))))return t;const i=e.match(/^([\(\[])(.*?)(,)(.*?)([\)\]])$/);if(!i)return t;try{const[e,a,s,n,o,r]=i,l=s.includes("â"),c=o.includes("â");t.min=l?-1/0:+s,t.max=c?1/0:+o,t.minWithEqual=!l&&"["===a,t.maxWithEqual=!c&&"]"===r}catch(t){}return t}},watch:{opened(t,e){if(t)if(this.newValue=this.config.value,this.options=null,this.vehicleTypeList=this.vehicleTypeOptions,"enum_str"===this.config.value_type){let t=this.config.value_range.split(/[;|,]+/);this.options=[],t.forEach(t=>{if(t){let[e,i]=[t,t];/\(|\)/.test(t)&&([e="",i=""]=t.split(/\(|\)/)),this.options.push({label:i,value:e})}})}else if("enum"===this.config.value_type){let t=this.config.value_range.split(";");this.options=[];for(let e of Array.from(t)){if(""===e)continue;let t={label:e.match(/\w+/)[0],value:String(parseInt(e.match(/0[xX][0-9a-fA-F]+/)[0]))};this.options.push(t)}}else this.isNumberItem&&this.areaSpecificConfigs.areaConfig&&(this.newValue=+this.newValue,this.vehicleTypeList.forEach(t=>{const{value:e}=t;if(t[e]){const i=e+"_temp";t[e]=+t[e],t[i]=+t[i]}}))}},methods:{matchBooleanValue:(t,e)=>["0","1"].includes(t)?e?"1":"0":e?"True":"False",getCurValue:t=>(void 0===t.readableValue?t.value:t.readableValue)+" "+t.value_units,getDefaultValue(t){if("enum"!==t.value_type)return t.default_value+" "+t.value_units;for(let e of Array.from(this.options))if(e.value===t.default_value)return e.label;return""},reject(){this.$emit("update:opened",!1)},async save(){if(await Object(s.O)(100),this.$v.$touch(),!this.$v.newValue.$invalid&&this.checkValue(this.config.value_type,this.newValue)){if(this.areaSpecificConfigs.areaConfig){const t=this.vehicleTypeList.filter(t=>t.state&&!this.checkValue(this.config.value_type,t[t.value+"_temp"]));if(t.length){const e=t.map(t=>t.label).join(", ");return void this.$notify({message:`${e} ${this.$t("text.invalidInput")}`,timeout:3e3,type:"negative",position:"top"})}}if(this.areaSpecificConfigs.areaConfig){let{...t}=this.config;t.value=this.newValue,delete t.readableValue,this.$emit("update:opened",!1),this.$emit("okay",{newConfig:{...t,value:`${t.value}`},vehicleTypeOptions:this.vehicleTypeList.map(t=>{const e={...t};e[e.value]=`${e[e.value]}`;const i=e.value+"_temp";return e[i]=`${e[i]}`,e})})}else{if(this.newValue===this.config.value)return;let{...t}=this.config;t.value=this.newValue,delete t.readableValue,this.$emit("update:opened",!1),this.$emit("okay",t)}}else this.$notify({message:`${this.$t("label.newValue")} ${this.newValue}; ${this.$t("text.invalidInput")}`,timeout:3e3,type:"negative",position:"top"})},checkValue(t="",e){if(!this.isNumberItem)return!0;if("hex"===t)return/^[0-9a-fA-F]+$/.test(e);if("number"!=typeof e||isNaN(e))return!1;const{min:i,max:a,minWithEqual:s,maxWithEqual:n}=this.numberRange;let[o,r]=[!1,!1];return o=s?e>=i:e>i,r=n?e<=a:e<a,!(!o||!r)&&("int"!==t||e%1==0)},checkValueRange(){let t=!0,e=this.config.value_range.replace(/\s/g,""),i=new RegExp(/^(\(-â|((\[|\()(-?\d+(\.\d+)?)))(,)(\+â\)|((-?\d+(\.\d+)?)(\]|\))))$/);if(e&&i.test(e)){let a=e.split(i),[s,n]=[!1,!1];"(-â"===a[1]?s=!0:"("===a[3]?s=this.newValue-a[4]>0:"["===a[3]&&(s=this.newValue-a[4]>=0),"+â)"===a[7]?n=!0:")"===a[11]?n=this.newValue-a[9]<0:"]"===a[11]&&(n=this.newValue-a[9]<=0),s&&n||(this.$store.getters["srp/isDeploy"]?this.$notify({message:this.$t("text.inputParams"),timeout:3e3,type:"negative",position:"top"}):t=!1)}return t}}},h=i("2877"),u=i("24e8"),p=i("f09f"),m=i("1c1c"),f=i("66e5"),g=i("4074"),_=i("0170"),y=i("eb85"),v=i("2c91"),b=i("9564"),E=i("27f9"),A=i("ddd8"),w=i("8f8e"),S=i("eebe"),C=i.n(S),I=Object(h.a)(d,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"dialog_card_normal flex column no-wrap"},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.$t("button.edit")+t.$t("label.parameter")},on:{close:t.reject}})],1),e("q-list",{attrs:{dense:""}},[e("q-item",{staticClass:"q-mt-sm"},[e("q-item-section",[e("div",[e("q-item-label",{staticClass:"text_small_light_grey q-mt-xs"},[t._v(t._s(t.$t("label.basicInfo")))]),e("q-separator",{staticClass:"text_small_light_grey q-mt-sm"})],1)])],1),t._l(t.fields,function(i){return e("q-item",{key:i.name},[e("q-item-section",[e("div",{staticClass:"row"},[e("q-item-label",{staticClass:"text_main_grey_style"},[t._v(t._s(i.name))]),e("q-space"),e("q-item-label",{staticClass:"text_main_light_grey",staticStyle:{"max-width":"300px","word-wrap":"break-word","word-break":"break-all"},style:"description"===i.key?"white-space: pre-line;":"white-space: normal;",attrs:{lines:"5"}},[t._v(t._s(i.value))])],1)])],1)}),e("q-item",[e("q-item-section",[e("div",{staticClass:"row"},[e("q-item-label",{staticClass:"text_main_grey_style"},[t._v(t._s(t.$t("label.newValue")))]),e("q-space"),"bool"===t.config.value_type?e("q-toggle",{attrs:{"true-value":t.matchBooleanValue(t.newValue,!0),"false-value":t.matchBooleanValue(t.newValue,!1)},on:{input:e=>{t.newValue={True:"1",False:"0"}[e]||e}},model:{value:t.newValue,callback:function(e){t.newValue=e},expression:"newValue"}}):t.isStrItem?e("q-input",{attrs:{type:"text",outlined:"",dense:"","input-class":"text-right",error:t.$v.newValue.$error},on:{blur:t.$v.newValue.$touch},model:{value:t.newValue,callback:function(e){t.newValue=e},expression:"newValue"}}):t.isNumberItem?e("q-input",{attrs:{type:"number",outlined:"",dense:"","input-class":"text-right",min:t.numberRange.min,max:t.numberRange.max,step:t.numberStep,error:t.$v.newValue.$error},on:{blur:t.$v.newValue.$touch},model:{value:t.newValue,callback:function(e){t.newValue=t._n(e)},expression:"newValue"}}):e("q-select",{attrs:{outlined:"",dense:"","emit-value":"","map-options":"",options:t.options},model:{value:t.newValue,callback:function(e){t.newValue=e},expression:"newValue"}})],1)])],1)],2),e("q-separator",{staticClass:"text_small_light_grey q-mx-md"}),t.areaSpecificConfigs.areaConfig?[e("q-list",{attrs:{dense:""}},[e("q-item",[e("q-item-section",[e("div",{staticClass:"row items-center text_main_grey_style"},[e("span",{staticClass:"col-2"},[t._v(t._s(t.$t("label.switch")))]),e("span",{staticClass:"col-4"},[t._v(t._s(t.$t("label.vehicleTypeIdentification")))]),e("span",{staticClass:"col-3"},[t._v(t._s(t.$t("label.currentValue")))]),e("span",{staticClass:"col"},[t._v(t._s(t.$t("label.newValue")))])])])],1)],1),t.areaSpecificConfigs.areaConfig?e("q-list",{staticClass:"scroll-content flex-1",attrs:{dense:""}},t._l(t.vehicleTypeList,function(i){return e("q-item",{key:i.label},[e("q-item-section",[e("div",{staticClass:"row items-center"},[e("q-checkbox",{staticClass:"col-2",model:{value:i.state,callback:function(e){t.$set(i,"state",e)},expression:"item.state"}}),e("q-item-label",{staticClass:"col-4"},[t._v(t._s(i.label))]),e("q-item-label",{staticClass:"col-3"},[t._v(t._s(i[i.value]))]),e("div",{staticClass:"col-3"},["bool"===t.config.value_type?e("q-toggle",{attrs:{"true-value":t.matchBooleanValue(i[i.value+"_temp"],!0),"false-value":t.matchBooleanValue(i[i.value+"_temp"],!1)},on:{input:t=>{i[i.value+"_temp"]={True:"1",False:"0"}[t]||t}},model:{value:i[i.value+"_temp"],callback:function(e){t.$set(i,i.value+"_temp",e)},expression:"item[item.value + '_temp']"}}):t.isStrItem?e("q-input",{attrs:{type:"text",outlined:"",dense:""},model:{value:i[i.value+"_temp"],callback:function(e){t.$set(i,i.value+"_temp",e)},expression:"item[item.value + '_temp']"}}):t.isNumberItem?e("q-input",{attrs:{type:"number",outlined:"",dense:"",min:t.numberRange.min,max:t.numberRange.max,step:t.numberStep},model:{value:i[i.value+"_temp"],callback:function(e){t.$set(i,i.value+"_temp",t._n(e))},expression:"item[item.value + '_temp']"}}):e("q-select",{attrs:{outlined:"",dense:"","emit-value":"","map-options":"",options:t.options},model:{value:i[i.value+"_temp"],callback:function(e){t.$set(i,i.value+"_temp",e)},expression:"item[item.value + '_temp']"}})],1)],1)])],1)}),1):t._e()]:t._e(),e("q-separator",{staticClass:"text_small_light_grey q-mx-md"}),e("div",{staticClass:"q-my-md q-mr-md float-right"},[e("choice-buttons",{staticClass:"float-right q-mr-lg q-mb-sm",attrs:{"label-okay":t.$t("button.save"),"enable-okay":!0},on:{okay:t.save,cancel:t.reject}})],1)],2)],1)},[],!1,null,null,null),x=I.exports;C()(I,"components",{QDialog:u.a,QCard:p.a,QList:m.a,QItem:f.a,QItemSection:g.a,QItemLabel:_.a,QSeparator:y.a,QSpace:v.a,QToggle:b.a,QInput:E.a,QSelect:A.a,QCheckbox:w.a});var T=i("13ad"),M=i("adb7"),P=i("750b"),O={name:"LimitSpeeds",props:{limitSpeeds:{type:Object,default:()=>({...M.a.limit_speeds})}},data:()=>({limitSpeedsList:[]}),created(){this.setLimitSpeedsSemantic()},methods:{setLimitSpeedsSemantic(){const t=t=>{var e,i;const a=["m/s"],s={unload:a,load:a,rack:a};return{label:null!==(e={load:this.$t("label.loadRack"),rack:this.$t("label.emptyRack")}[t])&&void 0!==e?e:this.$t("label."+t),unitOptions:null!==(i=s[t])&&void 0!==i?i:a}},e=["unload","load","rack"],i=[...e];this.limitSpeedsList=i.map(i=>({key:i,value:this.limitSpeeds[i],state:e.includes(i)||0!==this.limitSpeeds[i],unit:this.limitSpeeds[i+"_unit"],...t(i)}))},handleToggle(t){t.state||(t.value=0),this.updateLimitSpeeds()},handleInput(t){t.state=0!==t.value,this.updateLimitSpeeds()},handleSelect(t){this.updateLimitSpeeds()},updateLimitSpeeds(){this.$emit("updateModel","limit_speeds",this.limitSpeedsList.reduce((t,e)=>(t[e.key]=e.state&&e.value?e.value:0,t[e.key+"_unit"]=e.unit,t),{}))}}},L=Object(h.a)(O,function(){var t=this,e=t._self._c;return e("q-list",[t._l(t.limitSpeedsList,function(i){return[e("q-item",{key:i.key},[e("q-item-section",[e("q-checkbox",{attrs:{label:i.label},on:{input:function(e){return t.handleToggle(i)}},model:{value:i.state,callback:function(e){t.$set(i,"state",e)},expression:"item.state"}})],1),e("q-item-section",[e("q-input",{attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},on:{input:function(e){return t.handleInput(i)}},model:{value:i.value,callback:function(e){t.$set(i,"value",t._n(e))},expression:"item.value"}})],1),e("q-item-section",[e("q-select",{attrs:{"input-class":"col-1",options:i.unitOptions,outlined:"",dense:"","fill-input":"","emit-value":"","map-options":""},on:{input:function(e){return t.handleSelect(i)}},model:{value:i.unit,callback:function(e){t.$set(i,"unit",e)},expression:"item.unit"}})],1)],1)]}),e("q-item-label",{attrs:{header:"",caption:""}},[t._v("\n    "+t._s(t.$t("label.attention"))+":\n    "+t._s(t.$t("text.speedLimitNote"))+"\n    "+t._s(t.$t("text.meanFollowSystemSetting",{data:0}))+"\n  ")])],2)},[],!1,null,null,null),R=L.exports;C()(L,"components",{QList:m.a,QItem:f.a,QItemSection:g.a,QCheckbox:w.a,QInput:E.a,QSelect:A.a,QItemLabel:_.a});var D={name:"LimitRotate",props:{limitRotation:{type:Number,default:M.n},isOriginalLimitRotateRegion:!1},computed:{limitStationRotation:{get(){return Object(a.v)(this.limitRotation)},set(t){const e=t<0?0:t>5?5:t,i=Object(a.j)(e);this.$emit("updateModel","rotate_yaw",i),this.isOriginalLimitRotateRegion&&this.$emit("updateModel","param_int",1e3*i)}}}},N=Object(h.a)(D,function(){var t=this,e=t._self._c;return e("q-list",[e("q-item",[e("q-item-section",[t._v(t._s(t.$t("text.areaStationRotationAngleLimit")))]),e("q-item-section",[e("q-input",{staticClass:"wrapper-configure-input",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",min:0,max:5,"input-class":"text-right",prefix:"[0, 5]",suffix:"Â°"},model:{value:t.limitStationRotation,callback:function(e){t.limitStationRotation=t._n(e)},expression:"limitStationRotation"}})],1)],1),e("q-item-label",{attrs:{header:"",caption:""}},[t._v("\n    "+t._s(t.$t("label.attention"))+": "+t._s(t.$t("text.stationRotationNote"))+"\n  ")])],1)},[],!1,null,null,null),k=N.exports;C()(N,"components",{QList:m.a,QItem:f.a,QItemSection:g.a,QInput:E.a,QItemLabel:_.a});i("d866"),i("a732");var F=i("2f62"),$=i("f2b3"),q=i("73cf"),G=i("b1b8");const B={[a.a.NARROW_DOOR]:["nav.stop_left_width_offset","nav.stop_right_width_offset","nav.slow_width_offset"],[a.a.LEFT_DOCK]:["nav.stop_left_width_offset","nav.slow_width_offset"],[a.a.RIGHT_DOCK]:["nav.stop_right_width_offset","nav.slow_width_offset"],[a.a.RACK_DOCK]:["nav.stop_left_width_offset","nav.stop_right_width_offset","nav.detect_height_offset"],[a.a.CUSTOMIZE]:["nav.stop_distance","nav.slow_distance","nav.backward_stop_distance","nav.backward_slow_distance","nav.stop_left_width_offset","nav.stop_right_width_offset","nav.slow_width_offset","nav.stop_forward_offset","nav.detect_height_offset","nav.detect_low_offset"]};var j={name:"AreaObaEditor",components:{FunctionConfigTooltip:G.a},props:{obaDefineParams:{type:Object,default:()=>({})}},computed:{...Object(F.f)(["curLang","sensorColorDisplayMap"]),...Object(F.f)("srp",["laserPoint"]),...Object(F.d)("srp",["pose","laserPointNo"]),isActive(){return!!this.obaManager},isSameAreaSceneType(){return this.areaSceneType===this.obaDefineParams.area_scene_type},canSave(){return!this.isSameAreaSceneType||this.obaInfoList.some(t=>!t.disable&&t.hmiValue!==t.oldValue)}},data(){return{loading:!1,isMobile:this.$q.platform.is.mobile,dbObaConfigs:c.f,isNotForkLiftRobot:!0,areaSceneType:a.a.CUSTOMIZE,areaSceneOpt:[{label:this.$t("label.narrowDoor"),value:a.a.NARROW_DOOR},{label:this.$t("label.leftDock"),value:a.a.LEFT_DOCK},{label:this.$t("label.rightDock"),value:a.a.RIGHT_DOCK},{label:this.$t("label.rackDock"),value:a.a.RACK_DOCK},{label:this.$t("label.userDefined"),value:a.a.CUSTOMIZE}],obaInfoList:[],sensorOriginPointCloudList:[],obaScene:null,obaManager:null}},methods:{...Object(F.c)("srp",["setAutoUploadLaserPoint"]),checkItemMenuType:(t={},e="value_type")=>t[e].includes("enum"),saveData(){const t=this.obaInfoList.filter(t=>!t.disable);if(!t.every(t=>Object(c.v)(t,{valueTypeKey:"value_type",valueKey:"hmiValue",valueRangeKey:"hmiValueRange"})))return;const e={area_scene_type:this.areaSceneType};t.forEach(t=>{t.disable||(e[t.key]=t.value=Object(c.I)(t),t.oldValue=t.hmiValue)}),this.$emit("update:obaDefineParams",e),this.$notify({message:this.$t("text.succeedSaveData",{name:this.$t("label.obaParams")}),type:"positive",position:"top"})},handleSceneTypeSelected(t=a.a.CUSTOMIZE,e=!0){var i;(this.areaSceneType=t,this.setLimitObaInfoList(this.obaInfoList,this.areaSceneType),e)&&(this.setObstacleDetectInfo(),null===(i=this.obaManager)||void 0===i||i.renderObaFuncArea())},handleInput(t){Object(c.v)(t,{valueTypeKey:"value_type",valueKey:"hmiValue",valueRangeKey:"hmiValueRange"})&&(["nav.detect_height_offset","nav.detect_low_offset"].includes(t.key)&&this.setObstacleDetectInfo(),this.obaManager.renderObaFuncArea())},setLimitObaInfoList(t,e){return t.forEach(t=>{var i;const a=!(null!==(i=B[e])&&void 0!==i&&i.includes(t.key));t.disable=a;const{key:s,hmiDefaultValue:n,hmiRatio:o}=t;if(a){var r,l,c;t.oldValue=t.hmiValue=null!==(r=null!==(l=null===(c=this.dbObaConfigs.vehicle_oba_info.find(t=>t.key===s))||void 0===c?void 0:c.hmiValue)&&void 0!==l?l:t.hmiDefaultValue)&&void 0!==r?r:0}else{const e=this.isSameAreaSceneType&&this.obaDefineParams.hasOwnProperty(s);t.oldValue=e?this.obaDefineParams[s]*o:1/0,t.hmiValue=e?t.oldValue:n}}),t},setObaFuncMeshBaseBox(t=!0){const[e,i,a]=[this.obaManager.vehicleBodyBoxLength,this.obaManager.vehicleBodyBoxWidth,this.obaManager.vehicleBodyBoxHeight];this.obaManager.setObaFuncMeshBaseBox({length:e,width:i,height:a},this.isNotForkLiftRobot)},setObstacleDetectInfo(){var t,e;const i=(null===(t=this.obaInfoList.find(t=>"nav.detect_height_offset"===t.key))||void 0===t?void 0:t.visible)||!1,a=(null===(e=this.obaInfoList.find(t=>"nav.detect_low_offset"===t.key))||void 0===e?void 0:e.visible)||!1,s=this.obaManager.obaFuncMeshBaseBoxHeight,n=a?Math.min(s,this.obaManager.navDetectHeightOffsetByInfo+this.obaManager.vehicleBodyBoxHeight):s,o=i?this.obaManager.navDetectLowOffsetByInfo+c.a:0;this.obaManager.setObstacleDetectInfo({minHeight:o,maxHeight:n,hasMaxHeight:a,hasMinHeight:i})},async initAllData(){const t=await Object(c.M)(this.curLang);this.dbObaConfigs={...t,vehicle_oba_info:Object(c.H)(t.vehicle_oba_info),map_area_oba:Object(c.H)(t.map_area_oba.map(t=>{var e;return{...t,value:null!==(e=this.obaDefineParams[t.key])&&void 0!==e?e:t.default_value}}))},this.isNotForkLiftRobot=Object(c.L)(this.dbObaConfigs.vehicle_info),this.obaInfoList=Object($.a)(this.dbObaConfigs.map_area_oba),this.handleSceneTypeSelected(this.obaDefineParams.area_scene_type,!1)},createObaScene(){const{width:t=0,height:e=0}=Object(c.G)("#area-oba");this.obaScene=new q.f({width:Math.floor(t),height:Math.floor(e),element:"#area-oba"})},renderStdOba(){var t;null===(t=this.obaManager)||void 0===t||t.removeElementGroup(),this.obaManager=new c.n(this.obaInfoList,this.dbObaConfigs.device_info),this.obaManager.setObaScene(this.obaScene),this.obaManager.setElementGroup(this.obaScene.addGroup()),this.obaManager.renderMoveArrow(),this.obaManager.renderVehicleBodyBox(this.isNotForkLiftRobot),this.setObaFuncMeshBaseBox(!1),this.setObstacleDetectInfo(),this.obaManager.renderObaFuncArea()},async initRender(){await this.initAllData(),this.createObaScene(),this.obaScene.setCameraPosition(-.001,2.5,0),this.obaScene.render(),this.renderStdOba()},updatePointCloudsList(t={},e={}){const i={isActive:this.isActive,sensorColorDisplayMap:this.sensorColorDisplayMap,isShowAllLaser:this.isShowAllLaser,isMobile:this.isMobile,colorType:"sensorColor",colorDefault:"#70f3ff",visibleDefault:!1},{locLaserPoints:a=[],extLaser_3dPoints:s=[]}=t,n=Object(M.A)(a,this.sensorOriginPointCloudList,i),o=Object(M.A)(s,this.sensorOriginPointCloudList,{...i,colorDefault:"#ffd600"});this.isActive&&this.obaManager.renderPointCloudList(Object(M.r)(e),[...n,...o])}},watch:{laserPointNo(){this.updatePointCloudsList(this.laserPoint,this.pose)}},async mounted(){await this.setAutoUploadLaserPoint(!0),this.initRender()},beforeDestroy(){var t;this.obaManager=null,null===(t=this.obaScene)||void 0===t||t.dispose()}},U=i("9c40"),Y=Object(h.a)(j,function(){var t=this,e=t._self._c;return e("div",{staticClass:"full-width full-height row no-warp"},[e("div",{staticClass:"relative-position col-8 full-height",attrs:{id:"area-oba"}}),e("div",{staticClass:"full-height col-4 column no-wrap overflow-auto justify-between",staticStyle:{"max-height":"90vh"}},[e("q-list",{staticClass:"q-my-xs scroll",attrs:{dense:"","no-border":""}},[e("q-item-label",{staticClass:"q-py-sm q-px-none",attrs:{header:""}},[t._v("\n        "+t._s(t.$t("label.obstacleModelDiagram"))+"\n      ")]),e("q-item",{staticClass:"no-padding"},[e("q-item-section",[t._v(t._s(t.$t("label.scene")))]),e("q-item-section",{staticClass:"col-7",attrs:{side:""}},[e("q-select",{staticClass:"full-width",attrs:{outlined:"",dense:"","use-input":"","hide-selected":"","fill-input":"","emit-value":"","map-options":"",options:t.areaSceneOpt},on:{input:t.handleSceneTypeSelected},model:{value:t.areaSceneType,callback:function(e){t.areaSceneType=e},expression:"areaSceneType"}})],1)],1),t._l(t.obaInfoList,function(i,a){return e("q-item",{key:i.key,staticClass:"no-padding"},[e("q-item-section",{staticClass:"cursor-pointer"},[e("q-item-label",[t._v(t._s(a+1)+" "+t._s(i.name))]),e("FunctionConfigTooltip",{attrs:{"config-info":i}})],1),e("q-item-section",{staticClass:"col-7 q-my-xs",attrs:{side:""}},[i.disable?e("q-item-label",[t._v(t._s(t.$t("label.followSystem")))]):e("q-input",{staticClass:"full-width wrapper-configure-input",attrs:{dense:"",outlined:"","hide-bottom-space":"",prefix:i.hmiValueRange,suffix:i.hmiValueUnits,debounce:"500"},on:{input:function(e){return t.handleInput(i)}},model:{value:i.hmiValue,callback:function(e){t.$set(i,"hmiValue","string"==typeof e?e.trim():e)},expression:"item.hmiValue"}})],1)],1)}),e("q-item-label",{staticClass:"q-py-sm q-px-none q-mt-md",attrs:{header:""}},[t._v("\n        "+t._s(t.$t("label.sensorPointCloud"))+"\n      ")]),e("q-item",{staticClass:"no-padding"},[t.sensorOriginPointCloudList.length?e("q-item-section",[e("div",{staticClass:"q-gutter-sm"},t._l(t.sensorOriginPointCloudList,function(i){return e("q-checkbox",{key:i.sensorUuid,attrs:{dense:"","checked-icon":"mdi-eye-outline","unchecked-icon":"mdi-eye-off-outline",label:i.sensorName},model:{value:i.visible,callback:function(e){t.$set(i,"visible",e)},expression:"item.visible"}})}),1)]):e("q-checkbox",{attrs:{dense:"",value:!0,color:"orange","checked-icon":"mdi-flask-empty-outline",label:t.$q.lang.table.noData,disable:""}})],1)],2),e("q-item",{staticClass:"no-padding",attrs:{dense:""}},[e("q-item-section"),e("q-item-section",{staticClass:"col-7",attrs:{side:""}},[e("q-btn",{staticClass:"full-width",attrs:{dense:"","icon-right":"save",unelevated:"",color:"primary",disable:!t.canSave,label:t.$t("label.obaParams")},on:{click:t.saveData}})],1)],1)],1)])},[],!1,null,null,null),z=Y.exports;C()(Y,"components",{QList:m.a,QItemLabel:_.a,QItem:f.a,QItemSection:g.a,QSelect:A.a,QInput:E.a,QCheckbox:w.a,QBtn:U.a});var V={name:"LightControl",props:{lightParams:{type:Object,default:()=>({trigger_state:0})}},data:()=>({}),computed:{triggerState:{get(){return this.lightParams.trigger_state},set(t){this.$emit("updateModel","light_params",{trigger_state:t})}}}},W=Object(h.a)(V,function(){var t=this,e=t._self._c;return e("q-list",[e("q-item",[e("q-item-section",[t._v(t._s(t.$t("button.enableData",{name:t.$t("label.light")})))]),e("q-item-section",[e("q-toggle",{attrs:{color:"primary","true-value":1,"false-value":0},model:{value:t.triggerState,callback:function(e){t.triggerState=e},expression:"triggerState"}})],1)],1)],1)},[],!1,null,null,null),H=W.exports;C()(W,"components",{QList:m.a,QItem:f.a,QItemSection:g.a,QToggle:b.a});var K={name:"CameraControl",props:{cameraParams:{type:Object,default:()=>({enable_camera_down:0})}},data:()=>({}),computed:{enableCameraDown:{get(){return this.cameraParams.enable_camera_down},set(t){this.$emit("updateModel","camera_params",{enable_camera_down:t})}}}},Q=Object(h.a)(K,function(){var t=this,e=t._self._c;return e("q-list",[e("q-item",[e("q-item-section",[t._v(t._s(t.$t("button.enableData",{name:t.$t("label.cameraDown")})))]),e("q-item-section",[e("q-toggle",{attrs:{color:"primary","true-value":1,"false-value":0},model:{value:t.enableCameraDown,callback:function(e){t.enableCameraDown=e},expression:"enableCameraDown"}})],1)],1)],1)},[],!1,null,null,null),X=Q.exports;C()(Q,"components",{QList:m.a,QItem:f.a,QItemSection:g.a,QToggle:b.a});var J=i("8847"),Z={name:"IOOba",props:{ioObaParams:{type:Object,default:()=>({...M.a.io_oba_params})}},data:()=>({signalOptions:[{label:J.b.t("label.highElectricLevel"),value:1},{label:J.b.t("label.lowElectricLevel"),value:0}]}),computed:{triggerState:{get(){return this.ioObaParams.trigger_state},set(t){this.$emit("updateModel","io_oba_params",{...this.ioObaParams,trigger_state:t})}},hasUnloadTrigger:{get(){return this.ioObaParams.unload},set(t){this.$emit("updateModel","io_oba_params",{...this.ioObaParams,unload:t})}},hasLoadTrigger:{get(){return this.ioObaParams.load},set(t){this.$emit("updateModel","io_oba_params",{...this.ioObaParams,load:t})}},hasRackTrigger:{get(){return this.ioObaParams.rack},set(t){this.$emit("updateModel","io_oba_params",{...this.ioObaParams,rack:t})}},triggerAddresses:{get(){return this.ioObaParams.addresses},set(t){/^[0-7](,[0-7])*$/g.test(t)&&this.$emit("updateModel","io_oba_params",{...this.ioObaParams,addresses:t})}},triggerSignal:{get(){return this.ioObaParams.signal},set(t){this.$emit("updateModel","io_oba_params",{...this.ioObaParams,signal:t})}}}},tt=i("3786"),et=Object(h.a)(Z,function(){var t=this,e=t._self._c;return e("q-list",[e("q-item",[e("q-item-section",{staticClass:"col-4"},[t._v(t._s(t.$t("label.effect")))]),e("q-item-section",[e("div",{staticClass:"q-gutter-sm"},[e("q-radio",{attrs:{val:1,label:t.$t("button.enableData",{name:t.$t("label.obstacleAvoidance")})},model:{value:t.triggerState,callback:function(e){t.triggerState=e},expression:"triggerState"}}),e("q-radio",{attrs:{val:0,label:t.$t("button.disableData",{name:t.$t("label.obstacleAvoidance")})},model:{value:t.triggerState,callback:function(e){t.triggerState=e},expression:"triggerState"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"col-4"},[t._v(t._s(t.$t("label.CarryGoodsState")))]),e("q-item-section",[e("div",{staticClass:"q-gutter-sm"},[e("q-checkbox",{attrs:{"true-value":1,"false-value":0,label:t.$t("label.unload")},model:{value:t.hasUnloadTrigger,callback:function(e){t.hasUnloadTrigger=e},expression:"hasUnloadTrigger"}}),e("q-checkbox",{attrs:{"true-value":1,"false-value":0,label:t.$t("label.loadRack")},model:{value:t.hasLoadTrigger,callback:function(e){t.hasLoadTrigger=e},expression:"hasLoadTrigger"}}),e("q-checkbox",{attrs:{"true-value":1,"false-value":0,label:t.$t("label.emptyRack")},model:{value:t.hasRackTrigger,callback:function(e){t.hasRackTrigger=e},expression:"hasRackTrigger"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"col-4"},[t._v("bit "+t._s(t.$t("label.address")))]),e("q-item-section",[e("q-input",{staticClass:"wrapper-configure-input",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"text",prefix:"[0, 7]",placeholder:t.$t("text.multipleAddressTip")},model:{value:t.triggerAddresses,callback:function(e){t.triggerAddresses="string"==typeof e?e.trim():e},expression:"triggerAddresses"}})],1)],1),e("q-item",[e("q-item-section",{staticClass:"col-4"},[t._v(t._s(t.$t("label.signal")))]),e("q-item-section",[e("q-select",{attrs:{"input-class":"col-6",options:t.signalOptions,outlined:"",dense:"","fill-input":"","emit-value":"","map-options":""},on:{input:function(e){return t.handleSelect(t.item)}},model:{value:t.triggerSignal,callback:function(e){t.triggerSignal=e},expression:"triggerSignal"}})],1)],1)],1)},[],!1,null,null,null),it=et.exports;C()(et,"components",{QList:m.a,QItem:f.a,QItemSection:g.a,QRadio:tt.a,QCheckbox:w.a,QInput:E.a,QSelect:A.a});var at={name:"MusicControl",props:{isBroadcast:{type:Boolean,default:!1},isPlayMusic:{type:Boolean,default:!1},volume:{type:Number,default:-1}},data:()=>({}),computed:{isBroadcastShow:{get(){return this.isBroadcast},set(t){this.$emit("updateModel","is_broadcast",t)}},isPlayMusicShow:{get(){return this.isPlayMusic},set(t){this.$emit("updateModel","is_play_music",t)}},volumeShow:{get(){return this.volume},set(t){let e=Math.floor(t);e<0?e=-1:e>100&&(e=100),this.$emit("updateModel","volume",e)}}}},st=Object(h.a)(at,function(){var t=this,e=t._self._c;return e("q-list",[e("q-item",[e("q-item-section",[t._v(t._s(t.$t("label.sendBroadcast")))]),e("q-item-section",[e("q-toggle",{attrs:{disable:"",color:"primary","true-value":!0,"false-value":!1},model:{value:t.isBroadcastShow,callback:function(e){t.isBroadcastShow=e},expression:"isBroadcastShow"}})],1)],1),e("q-item",[e("q-item-section",[t._v(t._s(t.$t("label.playMusic")))]),e("q-item-section",[e("q-toggle",{attrs:{disable:"",color:"primary","true-value":!0,"false-value":!1},model:{value:t.isPlayMusicShow,callback:function(e){t.isPlayMusicShow=e},expression:"isPlayMusicShow"}})],1)],1),e("q-item",[e("q-item-section",[t._v(" "+t._s(t.$t("label.volume"))+" ")]),e("q-item-section",[e("q-input",{staticClass:"wrapper-configure-input",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",min:-1,max:100,prefix:"[-1, 100]"},model:{value:t.volumeShow,callback:function(e){t.volumeShow=t._n(e)},expression:"volumeShow"}})],1)],1)],1)},[],!1,null,null,null),nt=st.exports;C()(st,"components",{QList:m.a,QItem:f.a,QItemSection:g.a,QToggle:b.a,QInput:E.a});var ot={name:"ReservedRegion",props:{unKnowAreaTypeList:{type:Array,default:()=>[]}},data:()=>({reservedRegionType:0}),methods:{handleInput(){this.unKnowAreaTypeList.forEach(t=>{this.$emit("updateAreaGroups",t,!1)}),this.reservedRegionType&&this.$emit("updateAreaGroups",this.reservedRegionType,!0)}}},rt=Object(h.a)(ot,function(){var t=this,e=t._self._c;return e("q-list",[e("q-item-label",{attrs:{header:""}},[t._v(t._s(t.$t("label.regionTypeReserved")))]),e("q-item",[e("q-item-section",[t._v(t._s(t.$t("label.currentValue")))]),e("q-item-section",[t._v("\n      "+t._s(t.unKnowAreaTypeList.join(", "))+"\n    ")])],1),e("q-item",[e("q-item-section",[t._v(t._s(t.$t("label.newValue")))]),e("q-item-section",[e("q-input",{attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number"},on:{input:t.handleInput},model:{value:t.reservedRegionType,callback:function(e){t.reservedRegionType=t._n(e)},expression:"reservedRegionType"}})],1)],1)],1)},[],!1,null,null,null),lt=rt.exports;C()(rt,"components",{QList:m.a,QItemLabel:_.a,QItem:f.a,QItemSection:g.a,QInput:E.a});var ct={name:"AreaUserDefineProperties",data:()=>({})},dt=Object(h.a)(ct,function(){return(0,this._self._c)("div")},[],!1,null,null,null).exports,ht={name:"AreaEditor",components:{ConfigEditModal:x,ChoiceButtons:r.a,AddProperty:T.a,AreaObaEditor:z,HeaderItem:l.a,LimitSpeeds:R,LimitRotate:k,LightControl:H,CameraControl:X,IOOba:it,MusicControl:nt,ReservedRegion:lt,AreaUserDefineProperties:dt},data(){return{opened:!1,model:Object($.a)(M.a),userDefineProperties:[],selectedProperty:[],areaGroups:[],selectedTab:"tabBase",openConfig:!1,tableDataList:[],curConfig:{},columns:[{name:"name",label:this.$t("label.name"),field:"name",required:!0,align:"center",sortable:!1},{name:"value",label:this.$t("label.value"),field:"value",required:!0,align:"center",sortable:!1}],pagination:{rowsPerPage:30},vehicleTypes:[],areaSpecificConfigs:{disabled:!1,areaConfig:!0},vehicleTypeOptions:[],componentId:"",obaDefineParams:{},isOriginalLimitRotateRegion:!1,isOriginalLimitCarNumberRegion:!1}},props:{orignalParams:Array,preference:Array},computed:{cardCss(){return"tabBase"===this.selectedTab?this.componentId?"AreaObaEditor"===this.componentId?"large_card_style":"middle_dialog_card":"box-dialog-card":"dialog_card_normal"},hasForbiddenEntryRegion:{get(){return this.getHasTypeInAreaGroups(a.e.AREA_TYPE_NO_ENTER)},set(t){this.handleTypeState(a.e.AREA_TYPE_NO_ENTER,t)}},hasLimitSpeedsRegion:{get(){return this.getHasTypeInAreaGroups(a.e.AREA_TYPE_LIMIT_SPEEDS)},set(t){this.handleTypeState(a.e.AREA_TYPE_LIMIT_SPEEDS,t)}},speedLevelInfo(){const t=Object(s.p)("intersect",this.areaGroups,P.b).shift();return{exist:!!t,type:t,text:Object(P.c)(t)}},hasSpeedLevelRegion:{get(){return this.speedLevelInfo.exist},async set(t){const{type:e,text:i}=this.speedLevelInfo;if(t)this.$notify({message:this.$t("button.disableData",{name:this.$t("label.operation")}),timeout:3e3,type:"negative",position:"top"});else{await this.doAsk({title:this.$t("label.notice"),question:this.$t("text.askRemoveSpeedLevelRegion",{name:i}),labelCancel:this.$t("label.no"),labelOkay:this.$t("label.yes")})&&this.updateAreaGroups(e,!1)}}},hasLimitRotateRegion:{get(){return this.getHasTypeInAreaGroups(a.e.AREA_TYPE_DISABLE_ROTATE)},set(t){this.handleTypeState(a.e.AREA_TYPE_DISABLE_ROTATE,t)}},hasLocalReplanRegion:{get(){return this.getHasTypeInAreaGroups(a.e.AREA_TYPE_LOCAL_REPLAN)},set(t){this.handleTypeState(a.e.AREA_TYPE_LOCAL_REPLAN,t)}},hasDisableObaRegion:{get(){return this.getHasTypeInAreaGroups(a.e.AREA_TYPE_DISABLE_OBA)},set(t){this.handleTypeState(a.e.AREA_TYPE_DISABLE_OBA,t)}},hasIOObaRegion:{get(){return this.getHasTypeInAreaGroups(a.e.AREA_TYPE_IO_OBA)},set(t){this.handleTypeState(a.e.AREA_TYPE_IO_OBA,t)}},hasWorkspaceAvoidRegion:{get(){return this.getHasTypeInAreaGroups(a.e.AREA_TYPE_WORKSPACE_OBA)},set(t){this.handleTypeState(a.e.AREA_TYPE_WORKSPACE_OBA,t)}},hasLaneLineAuxiliaryLocateRegion:{get(){return this.getHasTypeInAreaGroups(a.e.AREA_TYPE_LANE_LINE_AUXILIARY_LOCATE)},set(t){this.handleTypeState(a.e.AREA_TYPE_LANE_LINE_AUXILIARY_LOCATE,t)}},hasLightControlRegion:{get(){return this.getHasTypeInAreaGroups(a.e.AREA_TYPE_LIGHT_CTRL)},set(t){this.handleTypeState(a.e.AREA_TYPE_LIGHT_CTRL,t)}},hasLimitStopRegion:{get(){return this.getHasTypeInAreaGroups(a.e.AREA_TYPE_LIMIT_STOP)},set(t){this.handleTypeState(a.e.AREA_TYPE_LIMIT_STOP,t)}},hasDisableRackCorrectRegion:{get(){return this.getHasTypeInAreaGroups(a.e.AREA_TYPE_DISABLE_RACK_AUTO_CORRECT)},set(t){this.handleTypeState(a.e.AREA_TYPE_DISABLE_RACK_AUTO_CORRECT,t)}},hasCameraControlRegion:{get(){return this.getHasTypeInAreaGroups(a.e.AREA_TYPE_CAMERA_CONTROL)},set(t){this.handleTypeState(a.e.AREA_TYPE_CAMERA_CONTROL,t)}},unKnowAreaTypeList(){return Object(s.p)("minus",this.areaGroups,P.a)},hasReservedRegion:{get(){return this.unKnowAreaTypeList.length>0},async set(t){if(t){await this.handleTypeChange(this.$t("label.regionTypeReserved"),[a.e.AREA_TYPE_NO_ENTER],[],!0)&&(this.componentId="ReservedRegion")}else this.setReservedEmpty()}},hasSpecialAvoidanceRegion:{get(){return Object.keys(this.obaDefineParams).length>1},async set(t){if(t){await this.handleTypeChange(this.$t("label.specialAvoidanceArea"),[a.e.AREA_TYPE_NO_ENTER,a.e.AREA_TYPE_DISABLE_OBA],[],!0)&&(this.componentId="AreaObaEditor")}else this.setObaDefineParamsDefault()}},hasMusicControlRegion:{get(){return-1!==this.model.volume},async set(t){if(t){await this.handleTypeChange(this.$t("label.musicControlRegion"),[a.e.AREA_TYPE_NO_ENTER],[],!0)&&(this.componentId="MusicControl")}else this.setMusicControlDefault()}},hasUserDefineProperties:{get:()=>!0,set(){}},areaSize(){return{width:this.model["pc.x"]-this.model["pa.x"],height:this.model["pa.y"]-this.model["pc.y"]}},posX:{get(){return Object(a.x)(this.model["pa.x"])},set(t){Object($.h)(t)&&this.updatePoses(t,this.model["pa.y"],this.areaSize.width,this.areaSize.height)}},posY:{get(){return Object(a.x)(this.model["pc.y"])},set(t){Object($.h)(t)&&this.updatePoses(this.model["pa.x"],this.areaSize.height+t,this.areaSize.width,this.areaSize.height)}},areaWidth:{get(){return Object(a.x)(this.areaSize.width)},set(t){Object($.h)(t)&&t>0&&this.updatePoses(this.model["pa.x"],this.model["pa.y"],t,this.areaSize.height)}},areaHeight:{get(){return Object(a.x)(this.areaSize.height)},set(t){Object($.h)(t)&&t>0&&this.updatePoses(this.model["pa.x"],this.model["pa.y"],this.areaSize.width,t)}}},watch:{async opened(t,e){this.selectedTab="tabBase",t?(await this.getVehicleTypes(),document.addEventListener("keydown",this.onKeyDown),this.isOriginalLimitRotateRegion=this.model.type===a.e.AREA_TYPE_DISABLE_ROTATE,this.isOriginalLimitCarNumberRegion=this.model.type===a.e.AREA_TYPE_LIMIT_CAR_NUMBER,this.convertToUserDefineArea(),this.userDefineProperties=Object.entries(this.model.user_define_properties).map(([t,e])=>({name:t,value:e})),this.obaDefineParams={...this.model.oba_define_params},this.loadConfigs(),this.checkConfigItemDeleted()):document.removeEventListener("keydown",this.onKeyDown)}},inject:["doAsk"],methods:{convertToUserDefineArea(){if(this.areaGroups=[...this.model.area_group],this.model.type!==a.e.AREA_TYPE_USER_DEFINE){const t=this.model.type;this.model.type=a.e.AREA_TYPE_USER_DEFINE,this.areaGroups=[t]}},updateAreaGroups(t=0,e=!1){e?this.areaGroups.push(t):this.areaGroups=Object(s.p)("minus",this.areaGroups,[t])},getHasTypeInAreaGroups(t){return this.areaGroups.includes(t)},setComponentId(t=""){this.componentId=t},updateModel(t,e){this.model[t]=e},setReservedEmpty(){this.areaGroups=Object(s.p)("minus",this.areaGroups,this.unKnowAreaTypeList),"ReservedRegion"===this.componentId&&(this.componentId="")},setObaDefineParamsDefault(){this.obaDefineParams={area_scene_type:a.a.CUSTOMIZE},this.model.oba_define_params={area_scene_type:a.a.CUSTOMIZE},"AreaObaEditor"===this.componentId&&(this.componentId="")},setMusicControlDefault(){this.model.volume=-1,"MusicControl"===this.componentId&&(this.componentId="")},handleTypeState(t,e){var i;const s=async(t=0,e=!1)=>{if(!t)return;if(!e)return void this.updateAreaGroups(t,e);const i=await this.handleTypeChange(Object(P.c)(t),Object(P.e)(t),Object(P.d)(t),!0);return i&&this.areaGroups.push(t),i},n={[a.e.AREA_TYPE_NO_ENTER]:async(t,e)=>{if(e){const e=Object(P.c)(t);await this.doAsk({title:this.$t("label.notice"),question:this.$t("text.openFunctionWillShieldOther",{name:e}),labelCancel:this.$t("label.no"),labelOkay:this.$t("label.yes")})&&(this.areaGroups=[t],this.setObaDefineParamsDefault(),this.setMusicControlDefault(),this.componentId="")}else this.updateAreaGroups(t,e)},[a.e.AREA_TYPE_DISABLE_OBA]:async(t,e)=>{const i=await s(t,e);e&&i&&(this.setObaDefineParamsDefault(),"AreaObaEditor"===this.componentId&&(this.componentId=""))},[a.e.AREA_TYPE_WORKSPACE_OBA]:s,[a.e.AREA_TYPE_IO_OBA]:s,[a.e.AREA_TYPE_LIMIT_SPEEDS]:s,[a.e.AREA_TYPE_DISABLE_ROTATE]:s,[a.e.AREA_TYPE_LOCAL_REPLAN]:s,[a.e.AREA_TYPE_LIGHT_CTRL]:s,[a.e.AREA_TYPE_LIMIT_STOP]:s,[a.e.AREA_TYPE_LANE_LINE_AUXILIARY_LOCATE]:s,[a.e.AREA_TYPE_DISABLE_RACK_AUTO_CORRECT]:s,[a.e.AREA_TYPE_CAMERA_CONTROL]:s};null===(i=n[t])||void 0===i||i.call(n,t,e)},async handleTypeChange(t="",e=[],i=[],a=!0){const n=Object(s.p)("intersect",this.areaGroups,e);let o=0===n.length;if(!o){const a=[...e.map(t=>Object(P.c)(t)),...i];o=await this.doAsk({title:this.$t("label.notice"),question:this.$t("text.openFunctionWillShieldOtherList",{name:t,list:a}),labelCancel:this.$t("label.no"),labelOkay:this.$t("label.yes")})}return o&&a&&n.length&&(this.areaGroups=Object(s.p)("minus",this.areaGroups,n)),o},onClosed:function(){this.openConfig||this.$refs.addPropertyDlg.opened||(this.opened=!1,this.componentId="")},onSaved:function(){if(this.openConfig||this.$refs.addPropertyDlg.opened)return;if(this.areaSpecificConfigs.disabled)return void this.$notify({message:this.$t("text.failSaved"),timeout:5e3,type:"negative",position:"top"});if(!Object(s.h)(this.model.name,this.$t("label.regionName")))return;this.model.area_group=[...this.areaGroups],this.model.user_defined_params=this.tableDataList.filter(t=>t.enable).map(t=>{const e={key:t.key,value:t.value};return t.vehicleTypeOptions.forEach(t=>{if(t.state)for(const i in t)if(/_value$/.test(i)){e[i]=t[i+"_temp"];break}}),e}),this.model.user_define_properties=this.userDefineProperties.reduce((t,e)=>(t[e.name]=e.value,t),{}),this.model.oba_define_params={...this.obaDefineParams};const t=this.moveReserveAreaType(this.model);this.$emit("updateModel",t),this.areaGroups=[],this.obaDefineParams={},this.onClosed()},moveReserveAreaType(t={}){const{type:e=0,area_group:i=[],...s}=t;return e===a.e.AREA_TYPE_USER_DEFINE&&1===i.length&&i[0]===a.e.AREA_TYPE_LIMIT_STOP?{...s,type:a.e.AREA_TYPE_LIMIT_STOP,area_group:[]}:t},onKeyDown(t){"s"===t.key&&t.ctrlKey&&(t.stopPropagation(),t.preventDefault(),this.onSaved())},async getVehicleTypes(){if(!this.vehicleTypes.length){this.loading=!0;const{state:t,value:e,config:i}=await Object(s.s)("main.vehicle_type","oasis;gulf");if(this.loading=!1,!t)return this.$notify({message:this.$t("text.failedToGetData",{name:this.$t("label.vehicleTypeIdentification")}),timeout:3e3,type:"negative",position:"top"}),void(this.areaSpecificConfigs.disabled=!0);this.vehicleTypes=i.value_range.split(/[;|,]+/),e&&"NA"!==e&&!this.vehicleTypes.includes(e)&&this.vehicleTypes.unshift(e)}},configEdit(t){this.vehicleTypeOptions=Object($.a)(t.vehicleTypeOptions),this.curConfig=t,this.openConfig=!0},areaSpecificConfigsSet(t={}){t.vehicleTypeOptions=this.vehicleTypes.map(t=>{const e={label:t,value:t+"_value",state:!1};return e[t+"_value"]="",e[t+"_value_temp"]="",e});let e=this.orignalParams.find(e=>e.key===t.key);if(e)for(const i in e)if(/_value$/.test(i)){let a=t.vehicleTypeOptions.find(t=>t.value===i);if(a)a[i]=e[i],a[i+"_temp"]=e[i],a.state=!0;else{let a={label:i.slice(0,-6),value:i,state:!0};a[i]=e[i],a[i+"_temp"]=e[i],t.vehicleTypeOptions.unshift(a)}}let i=this.model.user_defined_params.find(e=>e.key===t.key);if(i)for(const e in i)if(/_value_temp$/.test(e)){let a=t.vehicleTypeOptions.find(t=>t.value+"_temp"===e);a&&(a[e]=i[e],a.state=!0)}},async onUpdateConfig({newConfig:t={},vehicleTypeOptions:e={}}={}){this.curConfig.value=t.value,this.updateConfigReadableValue(this.curConfig),this.curConfig.vehicleTypeOptions=[...e]},async loadConfigs(){try{this.loading=!0,this.tableDataList=JSON.parse(JSON.stringify(this.preference));for(let t of Array.from(this.tableDataList)){this.updateConfigReadableValue(t);let e=JSON.parse(JSON.stringify(t)),i=this.getConfigValue(t.key,this.orignalParams);null!==i?(e.value=i,this.updateConfigReadableValue(e),t.curReadableValue=e.readableValue):t.curReadableValue=t.readableValue;let a=this.getConfigValue(t.key,this.model.user_defined_params);null!==a?(this.$set(t,"enable",!0),this.$set(t,"value",a)):this.$set(t,"enable",!1),this.updateConfigReadableValue(t),this.areaSpecificConfigsSet(t)}}catch(t){this.$notify({message:t.message,timeout:3e3,type:"negative",position:"top"})}},updateConfigReadableValue(t){if(null!=t)if("enum"===t.value_type){let e=t.value_range.split(";");for(let i of Array.from(e)){if(""===i)continue;let e=i.match(/0[xX][0-9a-fA-F]+/);null!=e&&(String(parseInt(e[0]))===t.value&&(t.readableValue=i.match(/\w+/)[0]))}}else t.readableValue=t.value},getConfigValue(t,e){for(let i of Array.from(e))if(i.key===t)return i.value;return null},async checkConfigItemDeleted(){for(let t of Array.from(this.model.user_defined_params))null===this.getConfigValue(t.key,this.tableDataList)&&await this.$notify({message:this.$t("text.regionParamsInvalid",{key:t.key}),timeout:3e3,type:"warning",position:"top"})},updatePoses:function(t,e,i,a){const s=new n.Rectangle(t,e,i,-a);this.model["pd.x"]=s.bottomLeft.x,this.model["pd.y"]=s.bottomLeft.y,this.model["pb.x"]=s.topRight.x,this.model["pb.y"]=s.topRight.y,this.model["pa.x"]=s.topLeft.x,this.model["pa.y"]=s.topLeft.y,this.model["pc.x"]=s.bottomRight.x,this.model["pc.y"]=s.bottomRight.y},getProperty(t){return this.userDefineProperties.find(e=>e.name===t)||null},onAddProperty(t){let e=t.name;null===this.getProperty(e)?this.doAddProperty(t):this.$notify({message:this.$t("text.userDefinedPropertyHasExist",{name:e}),timeout:3e3,type:"warning",position:"top"})},doAddProperty(t){this.userDefineProperties.push(t)},onAddUserDefinedProperty(){this.$refs.addPropertyDlg.model={name:"",value:""},this.$refs.addPropertyDlg.opened=!0},onDeleteProperty(){for(let t of Array.from(this.selectedProperty))this.doDeleteProperty(t.name);this.selectedProperty=[]},doDeleteProperty(t){let e=-1;for(let i=0;i<this.userDefineProperties.length;i++)if(t===this.userDefineProperties[i].name){e=i;break}e>=0&&this.userDefineProperties.splice(e,1)},updateObaDefineParams(t){this.obaDefineParams=t},handleSpeedLevelRegion(t){}}},ut=i("429b"),pt=i("7460"),mt=i("adad"),ft=i("823b"),gt=i("05c0"),_t=i("eaac"),yt=Object(h.a)(ht,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{class:t.cardCss},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.$t("label.editRegion")},on:{close:t.onClosed}})],1),e("q-tabs",{staticClass:"q-mx-md",attrs:{animated:"",swipeable:"",inverted:"","no-pane-border":"",dense:"",breakpoint:0,align:"justify"},model:{value:t.selectedTab,callback:function(e){t.selectedTab=e},expression:"selectedTab"}},[e("q-tab",{staticClass:"background_light_grey text_main_blue_style",attrs:{default:"",name:"tabBase"}},[t._v("\n        "+t._s(t.$t("label.basicSettings"))+"\n      ")]),e("q-tab",{staticClass:"background_light_grey text_main_blue_style",attrs:{name:"tabPreference"}},[t._v("\n        "+t._s(t.$t("label.paramConfigs"))+"\n      ")])],1),e("q-tab-panels",{model:{value:t.selectedTab,callback:function(e){t.selectedTab=e},expression:"selectedTab"}},[e("q-tab-panel",{staticClass:"row no-wrap",attrs:{name:"tabBase"}},[e("q-list",{staticClass:"q-mt-xs scroll flex-1",staticStyle:{"max-height":"75vh"},attrs:{dense:"",padding:"","no-border":""}},[e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-4"},[t._v("\n                  "+t._s(t.$t("label.regionId"))+"\n                ")]),e("q-input",{staticClass:"map_property_input col-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",disable:"",type:"number","input-class":"text-right"},model:{value:t.model.id,callback:function(e){t.$set(t.model,"id",t._n(e))},expression:"model.id"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-4"},[t._v("\n                  "+t._s(t.$t("label.regionName"))+"\n                ")]),e("q-input",{staticClass:"map_property_input col-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"text","input-class":"text-right"},model:{value:t.model.name,callback:function(e){t.$set(t.model,"name",e)},expression:"model.name"}})],1)])],1),e("q-item-label",{attrs:{header:""}},[t._v(t._s(t.$t("label.type")))]),e("q-item-label",{attrs:{header:""}},[t._v(t._s(t.$t("label.motionControl")))]),e("q-item",[e("q-item-section",[e("div",{staticClass:"row no-wrap items-center"},[e("q-checkbox",{model:{value:t.hasForbiddenEntryRegion,callback:function(e){t.hasForbiddenEntryRegion=e},expression:"hasForbiddenEntryRegion"}}),t._v("\n                "+t._s(t.$t("label.regionTypeForbidden"))+"\n              ")],1)]),e("q-item-section",[e("div",{staticClass:"row no-wrap items-center"},[e("q-checkbox",{model:{value:t.hasLimitSpeedsRegion,callback:function(e){t.hasLimitSpeedsRegion=e},expression:"hasLimitSpeedsRegion"}}),t._v("\n                "+t._s(t.$t("label.regionTypeLimitSpeeds"))+"\n                "),e("q-btn",{staticClass:"q-ml-sm",attrs:{round:"",dense:"",unelevated:"",size:"sm",icon:"settings"},on:{click:function(e){return t.setComponentId("LimitSpeeds")}}},[e("q-tooltip",[t._v(t._s(t.$t("label.settings")))])],1)],1)])],1),e("q-item",[e("q-item-section",[e("div",{staticClass:"row no-wrap items-center"},[e("q-checkbox",{model:{value:t.hasLimitRotateRegion,callback:function(e){t.hasLimitRotateRegion=e},expression:"hasLimitRotateRegion"}}),t._v("\n                "+t._s(t.$t("label.regionTypeLimitRotate"))+"\n                "),e("q-btn",{staticClass:"q-ml-sm",attrs:{round:"",dense:"",unelevated:"",size:"sm",icon:"settings"},on:{click:function(e){return t.setComponentId("LimitRotate")}}},[e("q-tooltip",[t._v(t._s(t.$t("label.settings")))])],1)],1)]),e("q-item-section",[e("div",{staticClass:"row no-wrap items-center"},[e("q-checkbox",{model:{value:t.hasLocalReplanRegion,callback:function(e){t.hasLocalReplanRegion=e},expression:"hasLocalReplanRegion"}}),t._v("\n                "+t._s(t.$t("label.regionTypeLocalReplan"))+"\n              ")],1)])],1),t.hasSpeedLevelRegion?e("q-item",[e("q-item-section",[e("div",{staticClass:"row no-wrap items-center"},[e("q-checkbox",{model:{value:t.hasSpeedLevelRegion,callback:function(e){t.hasSpeedLevelRegion=e},expression:"hasSpeedLevelRegion"}}),t._v("\n                "+t._s(t.speedLevelInfo.text)+"\n              ")],1)])],1):t._e(),e("q-item-label",{attrs:{header:""}},[t._v(t._s(t.$t("label.obstacleAvoidance")))]),e("q-item",[e("q-item-section",[e("div",{staticClass:"row no-wrap items-center"},[e("q-checkbox",{model:{value:t.hasSpecialAvoidanceRegion,callback:function(e){t.hasSpecialAvoidanceRegion=e},expression:"hasSpecialAvoidanceRegion"}}),t._v("\n                "+t._s(t.$t("label.specialAvoidanceArea"))+"\n                "),e("q-btn",{staticClass:"q-ml-sm",attrs:{round:"",dense:"",unelevated:"",size:"sm",icon:"settings"},on:{click:function(e){return t.setComponentId("AreaObaEditor")}}},[e("q-tooltip",[t._v(t._s(t.$t("label.settings")))])],1)],1)]),e("q-item-section",[e("div",{staticClass:"row no-wrap items-center"},[e("q-checkbox",{model:{value:t.hasDisableObaRegion,callback:function(e){t.hasDisableObaRegion=e},expression:"hasDisableObaRegion"}}),t._v("\n                "+t._s(t.$t("label.regionTypeDisableOba"))+"\n              ")],1)])],1),e("q-item",[e("q-item-section",[e("div",{staticClass:"row no-wrap items-center"},[e("q-checkbox",{model:{value:t.hasIOObaRegion,callback:function(e){t.hasIOObaRegion=e},expression:"hasIOObaRegion"}}),t._v("\n                "+t._s(t.$t("label.ioAvoidRegion"))+"\n                "),e("q-btn",{staticClass:"q-ml-sm",attrs:{round:"",dense:"",unelevated:"",size:"sm",icon:"settings"},on:{click:function(e){return t.setComponentId("IOOba")}}},[e("q-tooltip",[t._v(t._s(t.$t("label.settings")))])],1)],1)]),e("q-item-section",[e("div",{staticClass:"row no-wrap items-center"},[e("q-checkbox",{model:{value:t.hasWorkspaceAvoidRegion,callback:function(e){t.hasWorkspaceAvoidRegion=e},expression:"hasWorkspaceAvoidRegion"}}),t._v("\n                "+t._s(t.$t("label.workspaceAvoidRegion"))+"\n              ")],1)])],1),e("q-item-label",{attrs:{header:""}},[t._v(t._s(t.$t("label.others")))]),e("q-item",[e("q-item-section",[e("div",{staticClass:"row no-wrap items-center"},[e("q-checkbox",{model:{value:t.hasReservedRegion,callback:function(e){t.hasReservedRegion=e},expression:"hasReservedRegion"}}),t._v("\n                "+t._s(t.$t("label.regionTypeReserved"))+"\n                "),e("q-btn",{staticClass:"q-ml-sm",attrs:{round:"",dense:"",unelevated:"",size:"sm",icon:"settings",disable:t.hasForbiddenEntryRegion},on:{click:function(e){return t.setComponentId("ReservedRegion")}}},[e("q-tooltip",[t._v(t._s(t.$t("label.settings")))])],1)],1)]),e("q-item-section",[e("div",{staticClass:"row no-wrap items-center"},[e("q-checkbox",{model:{value:t.hasLightControlRegion,callback:function(e){t.hasLightControlRegion=e},expression:"hasLightControlRegion"}}),t._v("\n                "+t._s(t.$t("label.lightControlRegion"))+"\n                "),e("q-btn",{staticClass:"q-ml-sm",attrs:{round:"",dense:"",unelevated:"",size:"sm",icon:"settings"},on:{click:function(e){return t.setComponentId("LightControl")}}},[e("q-tooltip",[t._v(t._s(t.$t("label.settings")))])],1)],1)])],1),e("q-item",[e("q-item-section",[e("div",{staticClass:"row no-wrap items-center"},[e("q-checkbox",{model:{value:t.hasMusicControlRegion,callback:function(e){t.hasMusicControlRegion=e},expression:"hasMusicControlRegion"}}),t._v("\n                "+t._s(t.$t("label.musicControlRegion"))+"\n                "),e("q-btn",{staticClass:"q-ml-sm",attrs:{round:"",dense:"",unelevated:"",size:"sm",icon:"settings"},on:{click:function(e){return t.setComponentId("MusicControl")}}},[e("q-tooltip",[t._v(t._s(t.$t("label.settings")))])],1)],1)]),e("q-item-section",[e("div",{staticClass:"row no-wrap items-center"},[e("q-checkbox",{model:{value:t.hasLimitStopRegion,callback:function(e){t.hasLimitStopRegion=e},expression:"hasLimitStopRegion"}}),t._v("\n                "+t._s(t.$t("label.limitStopRegion"))+"\n              ")],1)])],1),e("q-item",[e("q-item-section",[e("div",{staticClass:"row no-wrap items-center"},[e("q-checkbox",{model:{value:t.hasLaneLineAuxiliaryLocateRegion,callback:function(e){t.hasLaneLineAuxiliaryLocateRegion=e},expression:"hasLaneLineAuxiliaryLocateRegion"}}),t._v("\n                "+t._s(t.$t("label.laneLineAuxiliaryLocateRegion"))+"\n              ")],1)]),e("q-item-section",[e("div",{staticClass:"row no-wrap items-center"},[e("q-checkbox",{model:{value:t.hasDisableRackCorrectRegion,callback:function(e){t.hasDisableRackCorrectRegion=e},expression:"hasDisableRackCorrectRegion"}}),t._v("\n                "+t._s(t.$t("label.disableRackAutoCorrectRegion"))+"\n              ")],1)])],1),e("q-item",[e("q-item-section",[e("div",{staticClass:"row no-wrap items-center"},[e("q-checkbox",{model:{value:t.hasCameraControlRegion,callback:function(e){t.hasCameraControlRegion=e},expression:"hasCameraControlRegion"}}),t._v("\n                "+t._s(t.$t("label.cameraControlRegion"))+"\n                "),e("q-btn",{staticClass:"q-ml-sm",attrs:{round:"",dense:"",unelevated:"",size:"sm",icon:"settings"},on:{click:function(e){return t.setComponentId("CameraControl")}}},[e("q-tooltip",[t._v(t._s(t.$t("label.settings")))])],1)],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-4"},[t._v("\n                  "+t._s(t.$t("label.coordinate")+"x(cm)")+"\n                ")]),e("q-input",{staticClass:"map_property_input col-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.posX,callback:function(e){t.posX=t._n(e)},expression:"posX"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-4"},[t._v("\n                  "+t._s(t.$t("label.coordinate")+"y(cm)")+"\n                ")]),e("q-input",{staticClass:"map_property_input col-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.posY,callback:function(e){t.posY=t._n(e)},expression:"posY"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-4"},[t._v("\n                  "+t._s(t.$t("label.width")+"(cm)")+"\n                ")]),e("q-input",{staticClass:"map_property_input col-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",min:0,"input-class":"text-right"},model:{value:t.areaWidth,callback:function(e){t.areaWidth=t._n(e)},expression:"areaWidth"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-4"},[t._v("\n                  "+t._s(t.$t("label.height")+"(cm)")+"\n                ")]),e("q-input",{staticClass:"map_property_input col-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",min:0,"input-class":"text-right"},model:{value:t.areaHeight,callback:function(e){t.areaHeight=t._n(e)},expression:"areaHeight"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-4"},[t._v("\n                  "+t._s(t.$t("label.enteredStation"))+"\n                ")]),e("q-input",{staticClass:"map_property_input col-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",min:0,"input-class":"text-right"},model:{value:t.model.enter_station,callback:function(e){t.$set(t.model,"enter_station",t._n(e))},expression:"model.enter_station"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-4"},[t._v("\n                  "+t._s(t.$t("label.exitedStation"))+"\n                ")]),e("q-input",{staticClass:"map_property_input col-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",min:0,"input-class":"text-right"},model:{value:t.model.exit_station,callback:function(e){t.$set(t.model,"exit_station",t._n(e))},expression:"model.exit_station"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-4"},[t._v("\n                  "+t._s(t.$t("label.layer"))+"\n                ")]),e("q-input",{staticClass:"map_property_input col-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.model.z,callback:function(e){t.$set(t.model,"z",t._n(e))},expression:"model.z"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-4"},[t._v("\n                  "+t._s(t.$t("label.remark"))+"\n                ")]),e("q-input",{staticClass:"col-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"textarea",rows:"2"},model:{value:t.model.desc,callback:function(e){t.$set(t.model,"desc",e)},expression:"model.desc"}})],1)])],1),e("q-item",[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-4"},[t._v("\n                "+t._s(t.$t("label.userDefinedProperty"))+"\n              ")]),e("div",{staticClass:"col-8 input-border-normal q-pa-xs"},[e("q-table",{staticClass:"no-shadow border_passive_style",attrs:{dense:"","hide-bottom":"",columns:t.columns,data:t.userDefineProperties,"row-key":"name",color:"primary",separator:"cell","table-class":"no-scroll text_main_grey_style",pagination:t.pagination,selection:"multiple",selected:t.selectedProperty},on:{"update:pagination":function(e){t.pagination=e},"update:selected":function(e){t.selectedProperty=e}}}),e("div",{staticClass:"flex justify-end q-mt-md"},[e("q-btn",{staticClass:"no-shadow q-ml-lg q-mt-md",staticStyle:{height:"32px"},attrs:{outline:"",unelevated:"","no-caps":"",label:t.$t("button.newAdd"),color:"primary",size:"sm"},on:{click:t.onAddUserDefinedProperty}}),e("q-btn",{staticClass:"background_red no-shadow q-ml-lg q-mt-md text_main_white_style",staticStyle:{height:"32px"},attrs:{"no-caps":"",unelevated:"",label:t.$t("button.delete"),size:"sm",disable:t.selectedProperty.length<=0},on:{click:t.onDeleteProperty}})],1)],1)])])],1),t.componentId?e("div",{class:"AreaObaEditor"===t.componentId?"col-8":"col-6"},[e(t.componentId,{tag:"component",attrs:{"limit-speeds":t.model.limit_speeds,"limit-rotation":t.model.rotate_yaw,"light-params":t.model.light_params,"camera-params":t.model.camera_params,"oba-define-params":t.obaDefineParams,"io-oba-params":t.model.io_oba_params,"is-broadcast":t.model.is_broadcast,"is-play-music":t.model.is_play_music,isOriginalLimitRotateRegion:t.isOriginalLimitRotateRegion,isOriginalLimitCarNumberRegion:t.isOriginalLimitCarNumberRegion,volume:t.model.volume,"un-know-area-type-list":t.unKnowAreaTypeList},on:{updateModel:t.updateModel,updateAreaGroups:t.updateAreaGroups,"update:obaDefineParams":t.updateObaDefineParams}})],1):t._e()],1),e("q-tab-panel",{attrs:{name:"tabPreference"}},[e("q-list",{staticClass:"q-mt-xs scroll",staticStyle:{"max-height":"75vh"},attrs:{"no-border":""}},t._l(t.tableDataList,function(i){return e("q-item",{key:i.key,attrs:{clickable:""},nativeOn:{dblclick:function(e){return t.configEdit(i)}}},[e("q-item-section",{attrs:{avatar:""}},[e("div",{staticClass:"row"},[e("q-checkbox",{model:{value:i.enable,callback:function(e){t.$set(i,"enable",e)},expression:"item.enable"}}),e("q-item-label",{class:i.enable?"text_small_blue_style":"text_small_light_grey",staticStyle:{"margin-top":"12px"}},[t._v("\n                  "+t._s(i.id)+"\n                ")])],1)]),e("q-item-section",[e("q-item-label",{class:i.enable?"text_main_blue_style":"text_main_grey_style"},[t._v(t._s(i.name))]),e("q-item-label",{staticClass:"text_small_light_grey"},[t._v(t._s(i.key))])],1),e("q-item-section",{attrs:{side:""}},[e("q-item-label",{class:i.enable?"text_small_blue_style":"text_small_light_grey"},[t._v(t._s(i.enable?i.curReadableValue+" "+i.value_units+" -> "+i.readableValue+" "+i.value_units:i.readableValue)+"\n              ")])],1)],1)}),1)],1)],1),e("div",{staticClass:"q-my-md q-mr-md float-right"},[e("choice-buttons",{attrs:{"label-okay":t.$t("button.save")},on:{okay:t.onSaved,cancel:t.onClosed}})],1)],1),e("add-property",{ref:"addPropertyDlg",on:{add:t.onAddProperty}}),e("config-edit-modal",{attrs:{opened:t.openConfig,config:t.curConfig,"area-specific-configs":t.areaSpecificConfigs,"vehicle-type-options":t.vehicleTypeOptions},on:{"update:opened":function(e){t.openConfig=e},okay:t.onUpdateConfig}})],1)},[],!1,null,"49c65400",null);e.a=yt.exports;C()(yt,"components",{QDialog:u.a,QCard:p.a,QTabs:ut.a,QTab:pt.a,QTabPanels:mt.a,QTabPanel:ft.a,QList:m.a,QItem:f.a,QItemSection:g.a,QInput:E.a,QItemLabel:_.a,QCheckbox:w.a,QBtn:U.a,QTooltip:gt.a,QTable:_t.a})},ab69:function(t,e,i){"use strict";i("9d4f")},ad5a:function(t,e,i){},ae4a:function(e,i,a){"use strict";(function(e,s){a.d(i,"a",function(){return Ip}),a.d(i,"b",function(){return $h}),a.d(i,"c",function(){return jh});a("c84f"),a("db9b"),a("d866"),a("910d"),a("f665"),a("7d54"),a("ab43"),a("9485"),a("a732"),a("1e70"),a("1e5a"),a("72c3"),a("4ea1"),a("61ae"),a("0a00"),a("b6f3"),a("4801");var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)};function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var r=function(){return r=Object.assign||function(t){for(var e,i=1,a=arguments.length;i<a;i++)for(var s in e=arguments[i])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},r.apply(this,arguments)};function l(t,e){var i={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(i[a]=t[a]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(t);s<a.length;s++)e.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(t,a[s])&&(i[a[s]]=t[a[s]])}return i}function c(t,e,i,a){return new(i||(i=Promise))(function(s,n){function o(t){try{l(a.next(t))}catch(t){n(t)}}function r(t){try{l(a.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,r)}l((a=a.apply(t,e||[])).next())})}function d(t,e){var i,a,s,n,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function r(r){return function(l){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;n&&(n=0,r[0]&&(o=0)),o;)try{if(i=1,a&&(s=2&r[0]?a.return:r[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,r[1])).done)return s;switch(a=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,a=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],a=0}finally{i=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}}function h(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],a=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&a>=t.length&&(t=void 0),{value:t&&t[a++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var a,s,n=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(t){s={error:t}}finally{try{a&&!a.done&&(i=n.return)&&i.call(n)}finally{if(s)throw s.error}}return o}function p(t,e,i){if(i||2===arguments.length)for(var a,s=0,n=e.length;s<n;s++)!a&&s in e||(a||(a=Array.prototype.slice.call(e,0,s)),a[s]=e[s]);return t.concat(a||Array.prototype.slice.call(e))}function m(t,e,i,a){if("a"===i&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?a:"a"===i?a.call(t):a?a.value:e.get(t)}function f(t,e,i,a,s){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?s.call(t,i):s?s.value=i:e.set(t,i),i}function g(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}"function"==typeof SuppressedError&&SuppressedError,"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e||"undefined"!=typeof self&&self;var _={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,i="~";function a(){}function s(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function n(t,e,a,n,o){if("function"!=typeof a)throw new TypeError("The listener must be a function");var r=new s(a,n||t,o),l=i?i+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],r]:t._events[l].push(r):(t._events[l]=r,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new a:delete t._events[e]}function r(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(i=!1)),r.prototype.eventNames=function(){var t,a,s=[];if(0===this._eventsCount)return s;for(a in t=this._events)e.call(t,a)&&s.push(i?a.slice(1):a);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(t)):s},r.prototype.listeners=function(t){var e=i?i+t:t,a=this._events[e];if(!a)return[];if(a.fn)return[a.fn];for(var s=0,n=a.length,o=new Array(n);s<n;s++)o[s]=a[s].fn;return o},r.prototype.listenerCount=function(t){var e=i?i+t:t,a=this._events[e];return a?a.fn?1:a.length:0},r.prototype.emit=function(t,e,a,s,n,o){var r=i?i+t:t;if(!this._events[r])return!1;var l,c,d=this._events[r],h=arguments.length;if(d.fn){switch(d.once&&this.removeListener(t,d.fn,void 0,!0),h){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,e),!0;case 3:return d.fn.call(d.context,e,a),!0;case 4:return d.fn.call(d.context,e,a,s),!0;case 5:return d.fn.call(d.context,e,a,s,n),!0;case 6:return d.fn.call(d.context,e,a,s,n,o),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];d.fn.apply(d.context,l)}else{var u,p=d.length;for(c=0;c<p;c++)switch(d[c].once&&this.removeListener(t,d[c].fn,void 0,!0),h){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,e);break;case 3:d[c].fn.call(d[c].context,e,a);break;case 4:d[c].fn.call(d[c].context,e,a,s);break;default:if(!l)for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];d[c].fn.apply(d[c].context,l)}}return!0},r.prototype.on=function(t,e,i){return n(this,t,e,i,!1)},r.prototype.once=function(t,e,i){return n(this,t,e,i,!0)},r.prototype.removeListener=function(t,e,a,s){var n=i?i+t:t;if(!this._events[n])return this;if(!e)return o(this,n),this;var r=this._events[n];if(r.fn)r.fn!==e||s&&!r.once||a&&r.context!==a||o(this,n);else{for(var l=0,c=[],d=r.length;l<d;l++)(r[l].fn!==e||s&&!r[l].once||a&&r[l].context!==a)&&c.push(r[l]);c.length?this._events[n]=1===c.length?c[0]:c:o(this,n)}return this},r.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&o(this,e)):(this._events=new a,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=i,r.EventEmitter=r,t.exports=r}(_);var y=g(_.exports),v=1e-6,b="undefined"!=typeof Float32Array?Float32Array:Array;function E(){var t=new b(9);return b!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function A(){var t=new b(16);return b!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function w(t){var e=new b(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function S(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function C(t,e,i,a,s,n,o,r,l,c,d,h,u,p,m,f,g){return t[0]=e,t[1]=i,t[2]=a,t[3]=s,t[4]=n,t[5]=o,t[6]=r,t[7]=l,t[8]=c,t[9]=d,t[10]=h,t[11]=u,t[12]=p,t[13]=m,t[14]=f,t[15]=g,t}function I(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function x(t,e){if(t===e){var i=e[1],a=e[2],s=e[3],n=e[6],o=e[7],r=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=a,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=r}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function T(t,e){var i=e[0],a=e[1],s=e[2],n=e[3],o=e[4],r=e[5],l=e[6],c=e[7],d=e[8],h=e[9],u=e[10],p=e[11],m=e[12],f=e[13],g=e[14],_=e[15],y=i*r-a*o,v=i*l-s*o,b=i*c-n*o,E=a*l-s*r,A=a*c-n*r,w=s*c-n*l,S=d*f-h*m,C=d*g-u*m,I=d*_-p*m,x=h*g-u*f,T=h*_-p*f,M=u*_-p*g,P=y*M-v*T+b*x+E*I-A*C+w*S;return P?(P=1/P,t[0]=(r*M-l*T+c*x)*P,t[1]=(s*T-a*M-n*x)*P,t[2]=(f*w-g*A+_*E)*P,t[3]=(u*A-h*w-p*E)*P,t[4]=(l*I-o*M-c*C)*P,t[5]=(i*M-s*I+n*C)*P,t[6]=(g*b-m*w-_*v)*P,t[7]=(d*w-u*b+p*v)*P,t[8]=(o*T-r*I+c*S)*P,t[9]=(a*I-i*T-n*S)*P,t[10]=(m*A-f*b+_*y)*P,t[11]=(h*b-d*A-p*y)*P,t[12]=(r*C-o*x-l*S)*P,t[13]=(i*x-a*C+s*S)*P,t[14]=(f*v-m*E-g*y)*P,t[15]=(d*E-h*v+u*y)*P,t):null}function M(t){var e=t[0],i=t[1],a=t[2],s=t[3],n=t[4],o=t[5],r=t[6],l=t[7],c=t[8],d=t[9],h=t[10],u=t[11],p=t[12],m=t[13],f=t[14],g=t[15];return(e*o-i*n)*(h*g-u*f)-(e*r-a*n)*(d*g-u*m)+(e*l-s*n)*(d*f-h*m)+(i*r-a*o)*(c*g-u*p)-(i*l-s*o)*(c*f-h*p)+(a*l-s*r)*(c*m-d*p)}function P(t,e,i){var a=e[0],s=e[1],n=e[2],o=e[3],r=e[4],l=e[5],c=e[6],d=e[7],h=e[8],u=e[9],p=e[10],m=e[11],f=e[12],g=e[13],_=e[14],y=e[15],v=i[0],b=i[1],E=i[2],A=i[3];return t[0]=v*a+b*r+E*h+A*f,t[1]=v*s+b*l+E*u+A*g,t[2]=v*n+b*c+E*p+A*_,t[3]=v*o+b*d+E*m+A*y,v=i[4],b=i[5],E=i[6],A=i[7],t[4]=v*a+b*r+E*h+A*f,t[5]=v*s+b*l+E*u+A*g,t[6]=v*n+b*c+E*p+A*_,t[7]=v*o+b*d+E*m+A*y,v=i[8],b=i[9],E=i[10],A=i[11],t[8]=v*a+b*r+E*h+A*f,t[9]=v*s+b*l+E*u+A*g,t[10]=v*n+b*c+E*p+A*_,t[11]=v*o+b*d+E*m+A*y,v=i[12],b=i[13],E=i[14],A=i[15],t[12]=v*a+b*r+E*h+A*f,t[13]=v*s+b*l+E*u+A*g,t[14]=v*n+b*c+E*p+A*_,t[15]=v*o+b*d+E*m+A*y,t}function O(t,e,i){var a,s,n,o,r,l,c,d,h,u,p,m,f=i[0],g=i[1],_=i[2];return e===t?(t[12]=e[0]*f+e[4]*g+e[8]*_+e[12],t[13]=e[1]*f+e[5]*g+e[9]*_+e[13],t[14]=e[2]*f+e[6]*g+e[10]*_+e[14],t[15]=e[3]*f+e[7]*g+e[11]*_+e[15]):(a=e[0],s=e[1],n=e[2],o=e[3],r=e[4],l=e[5],c=e[6],d=e[7],h=e[8],u=e[9],p=e[10],m=e[11],t[0]=a,t[1]=s,t[2]=n,t[3]=o,t[4]=r,t[5]=l,t[6]=c,t[7]=d,t[8]=h,t[9]=u,t[10]=p,t[11]=m,t[12]=a*f+r*g+h*_+e[12],t[13]=s*f+l*g+u*_+e[13],t[14]=n*f+c*g+p*_+e[14],t[15]=o*f+d*g+m*_+e[15]),t}function L(t,e,i){var a=i[0],s=i[1],n=i[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function R(t,e,i){var a=Math.sin(i),s=Math.cos(i),n=e[4],o=e[5],r=e[6],l=e[7],c=e[8],d=e[9],h=e[10],u=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*a,t[5]=o*s+d*a,t[6]=r*s+h*a,t[7]=l*s+u*a,t[8]=c*s-n*a,t[9]=d*s-o*a,t[10]=h*s-r*a,t[11]=u*s-l*a,t}function D(t,e,i){var a=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],r=e[2],l=e[3],c=e[8],d=e[9],h=e[10],u=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*a,t[1]=o*s-d*a,t[2]=r*s-h*a,t[3]=l*s-u*a,t[8]=n*a+c*s,t[9]=o*a+d*s,t[10]=r*a+h*s,t[11]=l*a+u*s,t}function N(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function k(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function F(t,e,i){var a=e[0],s=e[1],n=e[2],o=e[3],r=a+a,l=s+s,c=n+n,d=a*r,h=a*l,u=a*c,p=s*l,m=s*c,f=n*c,g=o*r,_=o*l,y=o*c;return t[0]=1-(p+f),t[1]=h+y,t[2]=u-_,t[3]=0,t[4]=h-y,t[5]=1-(d+f),t[6]=m+g,t[7]=0,t[8]=u+_,t[9]=m-g,t[10]=1-(d+p),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function $(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function q(t,e){var i=e[0],a=e[1],s=e[2],n=e[4],o=e[5],r=e[6],l=e[8],c=e[9],d=e[10];return t[0]=Math.hypot(i,a,s),t[1]=Math.hypot(n,o,r),t[2]=Math.hypot(l,c,d),t}function G(t,e){var i=new b(3);q(i,e);var a=1/i[0],s=1/i[1],n=1/i[2],o=e[0]*a,r=e[1]*s,l=e[2]*n,c=e[4]*a,d=e[5]*s,h=e[6]*n,u=e[8]*a,p=e[9]*s,m=e[10]*n,f=o+d+m,g=0;return f>0?(g=2*Math.sqrt(f+1),t[3]=.25*g,t[0]=(h-p)/g,t[1]=(u-l)/g,t[2]=(r-c)/g):o>d&&o>m?(g=2*Math.sqrt(1+o-d-m),t[3]=(h-p)/g,t[0]=.25*g,t[1]=(r+c)/g,t[2]=(u+l)/g):d>m?(g=2*Math.sqrt(1+d-o-m),t[3]=(u-l)/g,t[0]=(r+c)/g,t[1]=.25*g,t[2]=(h+p)/g):(g=2*Math.sqrt(1+m-o-d),t[3]=(r-c)/g,t[0]=(u+l)/g,t[1]=(h+p)/g,t[2]=.25*g),t}function B(t,e,i,a,s){var n=e[0],o=e[1],r=e[2],l=e[3],c=n+n,d=o+o,h=r+r,u=n*c,p=n*d,m=n*h,f=o*d,g=o*h,_=r*h,y=l*c,v=l*d,b=l*h,E=a[0],A=a[1],w=a[2],S=s[0],C=s[1],I=s[2],x=(1-(f+_))*E,T=(p+b)*E,M=(m-v)*E,P=(p-b)*A,O=(1-(u+_))*A,L=(g+y)*A,R=(m+v)*w,D=(g-y)*w,N=(1-(u+f))*w;return t[0]=x,t[1]=T,t[2]=M,t[3]=0,t[4]=P,t[5]=O,t[6]=L,t[7]=0,t[8]=R,t[9]=D,t[10]=N,t[11]=0,t[12]=i[0]+S-(x*S+P*C+R*I),t[13]=i[1]+C-(T*S+O*C+D*I),t[14]=i[2]+I-(M*S+L*C+N*I),t[15]=1,t}function j(t,e){var i=e[0],a=e[1],s=e[2],n=e[3],o=i+i,r=a+a,l=s+s,c=i*o,d=a*o,h=a*r,u=s*o,p=s*r,m=s*l,f=n*o,g=n*r,_=n*l;return t[0]=1-h-m,t[1]=d+_,t[2]=u-g,t[3]=0,t[4]=d-_,t[5]=1-c-m,t[6]=p+f,t[7]=0,t[8]=u+g,t[9]=p-f,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function U(t,e,i,a,s){var n,o=1/Math.tan(e/2);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0?(n=1/(a-s),t[10]=(s+a)*n,t[14]=2*s*a*n):(t[10]=-1,t[14]=-2*a),t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Y=U;function z(t,e,i,a,s,n,o){var r=1/(e-i),l=1/(a-s),c=1/(n-o);return t[0]=-2*r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*r,t[13]=(s+a)*l,t[14]=(o+n)*c,t[15]=1,t}var V=z;function W(t,e,i,a,s,n,o){var r=1/(e-i),l=1/(a-s),c=1/(n-o);return t[0]=-2*r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=c,t[11]=0,t[12]=(e+i)*r,t[13]=(s+a)*l,t[14]=n*c,t[15]=1,t}function H(t,e,i,a){var s,n,o,r,l,c,d,h,u,p,m=e[0],f=e[1],g=e[2],_=a[0],y=a[1],b=a[2],E=i[0],A=i[1],w=i[2];return Math.abs(m-E)<v&&Math.abs(f-A)<v&&Math.abs(g-w)<v?I(t):(d=m-E,h=f-A,u=g-w,s=y*(u*=p=1/Math.hypot(d,h,u))-b*(h*=p),n=b*(d*=p)-_*u,o=_*h-y*d,(p=Math.hypot(s,n,o))?(s*=p=1/p,n*=p,o*=p):(s=0,n=0,o=0),r=h*o-u*n,l=u*s-d*o,c=d*n-h*s,(p=Math.hypot(r,l,c))?(r*=p=1/p,l*=p,c*=p):(r=0,l=0,c=0),t[0]=s,t[1]=r,t[2]=d,t[3]=0,t[4]=n,t[5]=l,t[6]=h,t[7]=0,t[8]=o,t[9]=c,t[10]=u,t[11]=0,t[12]=-(s*m+n*f+o*g),t[13]=-(r*m+l*f+c*g),t[14]=-(d*m+h*f+u*g),t[15]=1,t)}function K(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}var Q=P,X=K,J=Object.freeze({__proto__:null,add:function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},adjoint:function(t,e){var i=e[0],a=e[1],s=e[2],n=e[3],o=e[4],r=e[5],l=e[6],c=e[7],d=e[8],h=e[9],u=e[10],p=e[11],m=e[12],f=e[13],g=e[14],_=e[15];return t[0]=r*(u*_-p*g)-h*(l*_-c*g)+f*(l*p-c*u),t[1]=-(a*(u*_-p*g)-h*(s*_-n*g)+f*(s*p-n*u)),t[2]=a*(l*_-c*g)-r*(s*_-n*g)+f*(s*c-n*l),t[3]=-(a*(l*p-c*u)-r*(s*p-n*u)+h*(s*c-n*l)),t[4]=-(o*(u*_-p*g)-d*(l*_-c*g)+m*(l*p-c*u)),t[5]=i*(u*_-p*g)-d*(s*_-n*g)+m*(s*p-n*u),t[6]=-(i*(l*_-c*g)-o*(s*_-n*g)+m*(s*c-n*l)),t[7]=i*(l*p-c*u)-o*(s*p-n*u)+d*(s*c-n*l),t[8]=o*(h*_-p*f)-d*(r*_-c*f)+m*(r*p-c*h),t[9]=-(i*(h*_-p*f)-d*(a*_-n*f)+m*(a*p-n*h)),t[10]=i*(r*_-c*f)-o*(a*_-n*f)+m*(a*c-n*r),t[11]=-(i*(r*p-c*h)-o*(a*p-n*h)+d*(a*c-n*r)),t[12]=-(o*(h*g-u*f)-d*(r*g-l*f)+m*(r*u-l*h)),t[13]=i*(h*g-u*f)-d*(a*g-s*f)+m*(a*u-s*h),t[14]=-(i*(r*g-l*f)-o*(a*g-s*f)+m*(a*l-s*r)),t[15]=i*(r*u-l*h)-o*(a*u-s*h)+d*(a*l-s*r),t},clone:w,copy:S,create:A,determinant:M,equals:function(t,e){var i=t[0],a=t[1],s=t[2],n=t[3],o=t[4],r=t[5],l=t[6],c=t[7],d=t[8],h=t[9],u=t[10],p=t[11],m=t[12],f=t[13],g=t[14],_=t[15],y=e[0],b=e[1],E=e[2],A=e[3],w=e[4],S=e[5],C=e[6],I=e[7],x=e[8],T=e[9],M=e[10],P=e[11],O=e[12],L=e[13],R=e[14],D=e[15];return Math.abs(i-y)<=v*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(a-b)<=v*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(s-E)<=v*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(n-A)<=v*Math.max(1,Math.abs(n),Math.abs(A))&&Math.abs(o-w)<=v*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(r-S)<=v*Math.max(1,Math.abs(r),Math.abs(S))&&Math.abs(l-C)<=v*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(c-I)<=v*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(d-x)<=v*Math.max(1,Math.abs(d),Math.abs(x))&&Math.abs(h-T)<=v*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(u-M)<=v*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(p-P)<=v*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(m-O)<=v*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(f-L)<=v*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(g-R)<=v*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(_-D)<=v*Math.max(1,Math.abs(_),Math.abs(D))},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},fromQuat:j,fromQuat2:function(t,e){var i=new b(3),a=-e[0],s=-e[1],n=-e[2],o=e[3],r=e[4],l=e[5],c=e[6],d=e[7],h=a*a+s*s+n*n+o*o;return h>0?(i[0]=2*(r*o+d*a+l*n-c*s)/h,i[1]=2*(l*o+d*s+c*a-r*n)/h,i[2]=2*(c*o+d*n+r*s-l*a)/h):(i[0]=2*(r*o+d*a+l*n-c*s),i[1]=2*(l*o+d*s+c*a-r*n),i[2]=2*(c*o+d*n+r*s-l*a)),F(t,e,i),t},fromRotation:function(t,e,i){var a,s,n,o=i[0],r=i[1],l=i[2],c=Math.hypot(o,r,l);return c<v?null:(o*=c=1/c,r*=c,l*=c,a=Math.sin(e),n=1-(s=Math.cos(e)),t[0]=o*o*n+s,t[1]=r*o*n+l*a,t[2]=l*o*n-r*a,t[3]=0,t[4]=o*r*n-l*a,t[5]=r*r*n+s,t[6]=l*r*n+o*a,t[7]=0,t[8]=o*l*n+r*a,t[9]=r*l*n-o*a,t[10]=l*l*n+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},fromRotationTranslation:F,fromRotationTranslationScale:function(t,e,i,a){var s=e[0],n=e[1],o=e[2],r=e[3],l=s+s,c=n+n,d=o+o,h=s*l,u=s*c,p=s*d,m=n*c,f=n*d,g=o*d,_=r*l,y=r*c,v=r*d,b=a[0],E=a[1],A=a[2];return t[0]=(1-(m+g))*b,t[1]=(u+v)*b,t[2]=(p-y)*b,t[3]=0,t[4]=(u-v)*E,t[5]=(1-(h+g))*E,t[6]=(f+_)*E,t[7]=0,t[8]=(p+y)*A,t[9]=(f-_)*A,t[10]=(1-(h+m))*A,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},fromRotationTranslationScaleOrigin:B,fromScaling:k,fromTranslation:N,fromValues:function(t,e,i,a,s,n,o,r,l,c,d,h,u,p,m,f){var g=new b(16);return g[0]=t,g[1]=e,g[2]=i,g[3]=a,g[4]=s,g[5]=n,g[6]=o,g[7]=r,g[8]=l,g[9]=c,g[10]=d,g[11]=h,g[12]=u,g[13]=p,g[14]=m,g[15]=f,g},fromXRotation:function(t,e){var i=Math.sin(e),a=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromYRotation:function(t,e){var i=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromZRotation:function(t,e){var i=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},frustum:function(t,e,i,a,s,n,o){var r=1/(i-e),l=1/(s-a),c=1/(n-o);return t[0]=2*n*r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(i+e)*r,t[9]=(s+a)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t},getRotation:G,getScaling:q,getTranslation:$,identity:I,invert:T,lookAt:H,mul:Q,multiply:P,multiplyScalar:function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},multiplyScalarAndAdd:function(t,e,i,a){return t[0]=e[0]+i[0]*a,t[1]=e[1]+i[1]*a,t[2]=e[2]+i[2]*a,t[3]=e[3]+i[3]*a,t[4]=e[4]+i[4]*a,t[5]=e[5]+i[5]*a,t[6]=e[6]+i[6]*a,t[7]=e[7]+i[7]*a,t[8]=e[8]+i[8]*a,t[9]=e[9]+i[9]*a,t[10]=e[10]+i[10]*a,t[11]=e[11]+i[11]*a,t[12]=e[12]+i[12]*a,t[13]=e[13]+i[13]*a,t[14]=e[14]+i[14]*a,t[15]=e[15]+i[15]*a,t},ortho:V,orthoNO:z,orthoZO:W,perspective:Y,perspectiveFromFieldOfView:function(t,e,i,a){var s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),r=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+r),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-r)*l*.5,t[9]=(s-n)*c*.5,t[10]=a/(i-a),t[11]=-1,t[12]=0,t[13]=0,t[14]=a*i/(i-a),t[15]=0,t},perspectiveNO:U,perspectiveZO:function(t,e,i,a,s){var n,o=1/Math.tan(e/2);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0?(n=1/(a-s),t[10]=s*n,t[14]=s*a*n):(t[10]=-1,t[14]=-a),t},rotate:function(t,e,i,a){var s,n,o,r,l,c,d,h,u,p,m,f,g,_,y,b,E,A,w,S,C,I,x,T,M=a[0],P=a[1],O=a[2],L=Math.hypot(M,P,O);return L<v?null:(M*=L=1/L,P*=L,O*=L,s=Math.sin(i),o=1-(n=Math.cos(i)),r=e[0],l=e[1],c=e[2],d=e[3],h=e[4],u=e[5],p=e[6],m=e[7],f=e[8],g=e[9],_=e[10],y=e[11],b=M*M*o+n,E=P*M*o+O*s,A=O*M*o-P*s,w=M*P*o-O*s,S=P*P*o+n,C=O*P*o+M*s,I=M*O*o+P*s,x=P*O*o-M*s,T=O*O*o+n,t[0]=r*b+h*E+f*A,t[1]=l*b+u*E+g*A,t[2]=c*b+p*E+_*A,t[3]=d*b+m*E+y*A,t[4]=r*w+h*S+f*C,t[5]=l*w+u*S+g*C,t[6]=c*w+p*S+_*C,t[7]=d*w+m*S+y*C,t[8]=r*I+h*x+f*T,t[9]=l*I+u*x+g*T,t[10]=c*I+p*x+_*T,t[11]=d*I+m*x+y*T,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},rotateX:R,rotateY:D,rotateZ:function(t,e,i){var a=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],r=e[2],l=e[3],c=e[4],d=e[5],h=e[6],u=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*a,t[1]=o*s+d*a,t[2]=r*s+h*a,t[3]=l*s+u*a,t[4]=c*s-n*a,t[5]=d*s-o*a,t[6]=h*s-r*a,t[7]=u*s-l*a,t},scale:L,set:C,str:function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},sub:X,subtract:K,targetTo:function(t,e,i,a){var s=e[0],n=e[1],o=e[2],r=a[0],l=a[1],c=a[2],d=s-i[0],h=n-i[1],u=o-i[2],p=d*d+h*h+u*u;p>0&&(d*=p=1/Math.sqrt(p),h*=p,u*=p);var m=l*u-c*h,f=c*d-r*u,g=r*h-l*d;return(p=m*m+f*f+g*g)>0&&(m*=p=1/Math.sqrt(p),f*=p,g*=p),t[0]=m,t[1]=f,t[2]=g,t[3]=0,t[4]=h*g-u*f,t[5]=u*m-d*g,t[6]=d*f-h*m,t[7]=0,t[8]=d,t[9]=h,t[10]=u,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t},translate:O,transpose:x});function Z(){var t=new b(3);return b!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function tt(t){var e=new b(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function et(t){var e=t[0],i=t[1],a=t[2];return Math.hypot(e,i,a)}function it(t,e,i){var a=new b(3);return a[0]=t,a[1]=e,a[2]=i,a}function at(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function st(t,e,i,a){return t[0]=e,t[1]=i,t[2]=a,t}function nt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function ot(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function rt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function lt(t,e){var i=e[0],a=e[1],s=e[2],n=i*i+a*a+s*s;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function ct(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function dt(t,e,i,a){var s=e[0],n=e[1],o=e[2];return t[0]=s+a*(i[0]-s),t[1]=n+a*(i[1]-n),t[2]=o+a*(i[2]-o),t}function ht(t,e,i){var a=e[0],s=e[1],n=e[2],o=i[3]*a+i[7]*s+i[11]*n+i[15];return o=o||1,t[0]=(i[0]*a+i[4]*s+i[8]*n+i[12])/o,t[1]=(i[1]*a+i[5]*s+i[9]*n+i[13])/o,t[2]=(i[2]*a+i[6]*s+i[10]*n+i[14])/o,t}function ut(t,e){var i=t[0],a=t[1],s=t[2],n=e[0],o=e[1],r=e[2];return Math.abs(i-n)<=v*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(a-o)<=v*Math.max(1,Math.abs(a),Math.abs(o))&&Math.abs(s-r)<=v*Math.max(1,Math.abs(s),Math.abs(r))}var pt=ot,mt=function(t,e){var i=e[0]-t[0],a=e[1]-t[1],s=e[2]-t[2];return Math.hypot(i,a,s)},ft=et;function gt(){var t=new b(4);return b!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function _t(t,e,i){var a=e[0],s=e[1],n=e[2],o=e[3];return t[0]=i[0]*a+i[4]*s+i[8]*n+i[12]*o,t[1]=i[1]*a+i[5]*s+i[9]*n+i[13]*o,t[2]=i[2]*a+i[6]*s+i[10]*n+i[14]*o,t[3]=i[3]*a+i[7]*s+i[11]*n+i[15]*o,t}function yt(){var t=new b(4);return b!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function vt(t,e,i){i*=.5;var a=Math.sin(i);return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=Math.cos(i),t}function bt(t,e,i){var a=e[0],s=e[1],n=e[2],o=e[3],r=i[0],l=i[1],c=i[2],d=i[3];return t[0]=a*d+o*r+s*c-n*l,t[1]=s*d+o*l+n*r-a*c,t[2]=n*d+o*c+a*l-s*r,t[3]=o*d-a*r-s*l-n*c,t}function Et(t,e){var i=e[0],a=e[1],s=e[2],n=e[3],o=i*i+a*a+s*s+n*n,r=o?1/o:0;return t[0]=-i*r,t[1]=-a*r,t[2]=-s*r,t[3]=n*r,t}function At(t,e,i,a){var s=.5*Math.PI/180;e*=s,i*=s,a*=s;var n=Math.sin(e),o=Math.cos(e),r=Math.sin(i),l=Math.cos(i),c=Math.sin(a),d=Math.cos(a);return t[0]=n*l*d-o*r*c,t[1]=o*r*d+n*l*c,t[2]=o*l*c-n*r*d,t[3]=o*l*d+n*r*c,t}Z(),gt();var wt=function(t,e,i,a){var s=new b(4);return s[0]=t,s[1]=e,s[2]=i,s[3]=a,s},St=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ct=bt,It=function(t,e){var i=e[0],a=e[1],s=e[2],n=e[3],o=i*i+a*a+s*s+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=i*o,t[1]=a*o,t[2]=s*o,t[3]=n*o,t};Z(),it(1,0,0),it(0,1,0),yt(),yt(),E(),function(){var t;t=new b(2),b!=Float32Array&&(t[0]=0,t[1]=0)}();var xt={x1:0,y1:0,x2:0,y2:0,x:0,y:0,qx:null,qy:null};function Tt(t,e,i){if(t[i].length>7){t[i].shift();for(var a=t[i],s=i;a.length;)e[i]="A",t.splice(s+=1,0,["C"].concat(a.splice(0,6)));t.splice(i,1)}}var Mt={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0};function Pt(t){return Array.isArray(t)&&t.every(function(t){var e=t[0].toLowerCase();return Mt[e]===t.length-1&&"achlmqstvz".includes(e)})}function Ot(t){return Pt(t)&&t.every(function(t){var e=t[0];return e===e.toUpperCase()})}function Lt(t){return Ot(t)&&t.every(function(t){var e=t[0];return"ACLMQZ".includes(e)})}function Rt(t){for(var e=t.pathValue[t.segmentStart],i=e.toLowerCase(),a=t.data;a.length>=Mt[i]&&("m"===i&&a.length>2?(t.segments.push([e].concat(a.splice(0,2))),i="l",e="m"===e?"l":"L"):t.segments.push([e].concat(a.splice(0,Mt[i]))),Mt[i]););}function Dt(t){var e=t.index,i=t.pathValue,a=i.charCodeAt(e);return 48===a?(t.param=0,void(t.index+=1)):49===a?(t.param=1,void(t.index+=1)):void(t.err='[path-util]: invalid Arc flag "'+i[e]+'", expecting 0 or 1 at index '+e)}function Nt(t){return t>=48&&t<=57||43===t||45===t||46===t}function kt(t){return t>=48&&t<=57}function Ft(t){var e,i=t.max,a=t.pathValue,s=t.index,n=s,o=!1,r=!1,l=!1,c=!1;if(n>=i)t.err="[path-util]: Invalid path value at index "+n+', "pathValue" is missing param';else if(43!==(e=a.charCodeAt(n))&&45!==e||(n+=1,e=a.charCodeAt(n)),kt(e)||46===e){if(46!==e){if(o=48===e,n+=1,e=a.charCodeAt(n),o&&n<i&&e&&kt(e))return void(t.err="[path-util]: Invalid path value at index "+s+', "'+a[s]+'" illegal number');for(;n<i&&kt(a.charCodeAt(n));)n+=1,r=!0;e=a.charCodeAt(n)}if(46===e){for(c=!0,n+=1;kt(a.charCodeAt(n));)n+=1,l=!0;e=a.charCodeAt(n)}if(101===e||69===e){if(c&&!r&&!l)return void(t.err="[path-util]: Invalid path value at index "+n+', "'+a[n]+'" invalid float exponent');if(n+=1,43!==(e=a.charCodeAt(n))&&45!==e||(n+=1),!(n<i&&kt(a.charCodeAt(n))))return void(t.err="[path-util]: Invalid path value at index "+n+', "'+a[n]+'" invalid integer exponent');for(;n<i&&kt(a.charCodeAt(n));)n+=1}t.index=n,t.param=+t.pathValue.slice(s,n)}else t.err="[path-util]: Invalid path value at index "+n+', "'+a[n]+'" is not a number'}function $t(t){for(var e,i=t.pathValue,a=t.max;t.index<a&&(10===(e=i.charCodeAt(t.index))||13===e||8232===e||8233===e||32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].includes(e));)t.index+=1}function qt(t){var e=t.max,i=t.pathValue,a=t.index,s=i.charCodeAt(a),n=Mt[i[a].toLowerCase()];if(t.segmentStart=a,function(t){switch(32|t){case 109:case 122:case 108:case 104:case 118:case 99:case 115:case 113:case 116:case 97:return!0;default:return!1}}(s))if(t.index+=1,$t(t),t.data=[],n){for(;;){for(var o=n;o>0;o-=1){if(97!=(32|s)||3!==o&&4!==o?Ft(t):Dt(t),t.err.length)return;t.data.push(t.param),$t(t),t.index<e&&44===i.charCodeAt(t.index)&&(t.index+=1,$t(t))}if(t.index>=t.max)break;if(!Nt(i.charCodeAt(t.index)))break}Rt(t)}else Rt(t);else t.err='[path-util]: Invalid path value "'+i[a]+'" is not a path command'}var Gt=function(t){this.pathValue=t,this.segments=[],this.max=t.length,this.index=0,this.param=0,this.segmentStart=0,this.data=[],this.err=""};function Bt(t,e){var i=t[0],a=e.x1,s=e.y1,n=e.x2,o=e.y2,r=t.slice(1).map(Number),l=t;if("TQ".includes(i)||(e.qx=null,e.qy=null),"H"===i)l=["L",t[1],s];else if("V"===i)l=["L",a,t[1]];else if("S"===i){var c=2*a-n,d=2*s-o;e.x1=c,e.y1=d,l=["C",c,d].concat(r)}else if("T"===i){var h=2*a-e.qx,u=2*s-e.qy;e.qx=h,e.qy=u,l=["Q",h,u].concat(r)}else if("Q"===i){var p=r[0],m=r[1];e.qx=p,e.qy=m}return l}function jt(t){if(Lt(t))return[].concat(t);for(var e=function(t){if(Ot(t))return[].concat(t);var e=function(t){if(Pt(t))return[].concat(t);var e=new Gt(t);for($t(e);e.index<e.max&&!e.err.length;)qt(e);return e.err?e.err:e.segments}(t),i=0,a=0,s=0,n=0;return e.map(function(t){var e,o=t.slice(1).map(Number),r=t[0],l=r.toUpperCase();if("M"===r)return i=o[0],a=o[1],s=i,n=a,["M",i,a];if(r!==l)switch(l){case"A":e=[l,o[0],o[1],o[2],o[3],o[4],o[5]+i,o[6]+a];break;case"V":e=[l,o[0]+a];break;case"H":e=[l,o[0]+i];break;default:var c=o.map(function(t,e){return t+(e%2?a:i)});e=[l].concat(c)}else e=[l].concat(o);var d=e.length;switch(l){case"Z":i=s,a=n;break;case"H":i=e[1];break;case"V":a=e[1];break;default:i=e[d-2],a=e[d-1],"M"===l&&(s=i,n=a)}return e})}(t),i=r({},xt),a=0;a<e.length;a+=1){e[a]=Bt(e[a],i);var s=e[a],n=s.length;i.x1=+s[n-2],i.y1=+s[n-1],i.x2=+s[n-4]||i.x1,i.y2=+s[n-3]||i.y1}return e}function Ut(t,e,i){return{x:t*Math.cos(i)-e*Math.sin(i),y:t*Math.sin(i)+e*Math.cos(i)}}function Yt(t,e,i,a,s,n,o,r,l,c){var d,h,u,p,m,f=t,g=e,_=i,y=a,v=r,b=l,E=120*Math.PI/180,A=Math.PI/180*(+s||0),w=[];if(c)h=c[0],u=c[1],p=c[2],m=c[3];else{f=(d=Ut(f,g,-A)).x,g=d.y;var S=(f-(v=(d=Ut(v,b,-A)).x))/2,C=(g-(b=d.y))/2,I=S*S/(_*_)+C*C/(y*y);I>1&&(_*=I=Math.sqrt(I),y*=I);var x=_*_,T=y*y,M=(n===o?-1:1)*Math.sqrt(Math.abs((x*T-x*C*C-T*S*S)/(x*C*C+T*S*S)));p=M*_*C/y+(f+v)/2,m=M*-y*S/_+(g+b)/2,h=Math.asin(((g-m)/y*Math.pow(10,9)|0)/Math.pow(10,9)),u=Math.asin(((b-m)/y*Math.pow(10,9)|0)/Math.pow(10,9)),h=f<p?Math.PI-h:h,u=v<p?Math.PI-u:u,h<0&&(h=2*Math.PI+h),u<0&&(u=2*Math.PI+u),o&&h>u&&(h-=2*Math.PI),!o&&u>h&&(u-=2*Math.PI)}var P=u-h;if(Math.abs(P)>E){var O=u,L=v,R=b;u=h+E*(o&&u>h?1:-1),w=Yt(v=p+_*Math.cos(u),b=m+y*Math.sin(u),_,y,s,0,o,L,R,[u,O,p,m])}P=u-h;var D=Math.cos(h),N=Math.sin(h),k=Math.cos(u),F=Math.sin(u),$=Math.tan(P/4),q=4/3*_*$,G=4/3*y*$,B=[f,g],j=[f+q*N,g-G*D],U=[v+q*F,b-G*k],Y=[v,b];if(j[0]=2*B[0]-j[0],j[1]=2*B[1]-j[1],c)return j.concat(U,Y,w);for(var z=[],V=0,W=(w=j.concat(U,Y,w)).length;V<W;V+=1)z[V]=V%2?Ut(w[V-1],w[V],A).y:Ut(w[V],w[V+1],A).x;return z}function zt(t,e,i){var a=t[0],s=t[1];return[a+(e[0]-a)*i,s+(e[1]-s)*i]}var Vt=function(t,e,i,a){return p(p([],zt([t,e],[i,a],.5),!0),[i,a,i,a],!1)};function Wt(t,e){var i,a,s,n,o,r,l,c,d,h=t[0],u=t.slice(1).map(Number),p=u[0],m=u[1],f=e.x1,g=e.y1,_=e.x,y=e.y;switch("TQ".includes(h)||(e.qx=null,e.qy=null),h){case"M":return e.x=p,e.y=m,t;case"A":return i=[f,g].concat(u),["C"].concat(Yt(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9]));case"Q":return e.qx=p,e.qy=m,i=[f,g].concat(u),["C"].concat((a=i[0],s=i[1],[(c=1/3)*a+(d=2/3)*(n=i[2]),c*s+d*(o=i[3]),c*(r=i[4])+d*n,c*(l=i[5])+d*o,r,l]));case"L":return["C"].concat(Vt(f,g,p,m));case"Z":return f===_&&g===y?["C",f,g,_,y,_,y]:["C"].concat(Vt(f,g,_,y))}return t}function Ht(t,e){if(void 0===e&&(e=!1),function(t){return Lt(t)&&t.every(function(t){var e=t[0];return"MC".includes(e)})}(t)){var i=[].concat(t);return e?[i,[]]:i}for(var a,s,n=jt(t),o=r({},xt),l=[],c="",d=n.length,h=[],u=0;u<d;u+=1){n[u]&&(c=n[u][0]),l[u]=c;var p=Wt(n[u],o);n[u]=p,Tt(n,l,u),d=n.length,"Z"===c&&h.push(u),s=(a=n[u]).length,o.x1=+a[s-2],o.y1=+a[s-1],o.x2=+a[s-4]||o.x1,o.y2=+a[s-3]||o.y1}return e?[n,h]:n}function Kt(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}function Qt(t,e,i,a,s){var n=Kt([t,e],[i,a]),o={x:0,y:0};if("number"==typeof s)if(s<=0)o={x:t,y:e};else if(s>=n)o={x:i,y:a};else{var r=zt([t,e],[i,a],s/n);o={x:r[0],y:r[1]}}return{length:n,point:o,min:{x:Math.min(t,i),y:Math.min(e,a)},max:{x:Math.max(t,i),y:Math.max(e,a)}}}function Xt(t,e){var i=t.x,a=t.y,s=e.x,n=e.y,o=i*s+a*n,r=Math.sqrt((Math.pow(i,2)+Math.pow(a,2))*(Math.pow(s,2)+Math.pow(n,2)));return(i*n-a*s<0?-1:1)*Math.acos(o/r)}function Jt(t,e,i,a,s,n,o,r,l,c){var d=Math.abs,h=Math.sin,u=Math.cos,p=Math.sqrt,m=Math.PI,f=d(i),g=d(a),_=(s%360+360)%360*(m/180);if(t===r&&e===l)return{x:t,y:e};if(0===f||0===g)return Qt(t,e,r,l,c).point;var y=(t-r)/2,v=(e-l)/2,b={x:u(_)*y+h(_)*v,y:-h(_)*y+u(_)*v},E=Math.pow(b.x,2)/Math.pow(f,2)+Math.pow(b.y,2)/Math.pow(g,2);E>1&&(f*=p(E),g*=p(E));var A=(Math.pow(f,2)*Math.pow(g,2)-Math.pow(f,2)*Math.pow(b.y,2)-Math.pow(g,2)*Math.pow(b.x,2))/(Math.pow(f,2)*Math.pow(b.y,2)+Math.pow(g,2)*Math.pow(b.x,2)),w=(n!==o?1:-1)*p(A=A<0?0:A),S=w*(f*b.y/g),C=w*(-g*b.x/f),I=u(_)*S-h(_)*C+(t+r)/2,x=h(_)*S+u(_)*C+(e+l)/2,T={x:(b.x-S)/f,y:(b.y-C)/g},M=Xt({x:1,y:0},T),P=Xt(T,{x:(-b.x-S)/f,y:(-b.y-C)/g});!o&&P>0?P-=2*m:o&&P<0&&(P+=2*m);var O=M+(P%=2*m)*c,L=f*u(O),R=g*h(O);return{x:u(_)*L-h(_)*R+I,y:h(_)*L+u(_)*R+x}}function Zt(t,e,i,a,s,n,o,r,l,c,d){var h,u=d.bbox,p=void 0===u||u,m=d.length,f=void 0===m||m,g=d.sampleSize,_=void 0===g?30:g,y="number"==typeof c,v=t,b=e,E=0,A=[v,b,E],w=[v,b],S={x:0,y:0},C=[{x:v,y:b}];y&&c<=0&&(S={x:v,y:b});for(var I=0;I<=_;I+=1){if(v=(h=Jt(t,e,i,a,s,n,o,r,l,I/_)).x,b=h.y,p&&C.push({x:v,y:b}),f&&(E+=Kt(w,[v,b])),w=[v,b],y&&E>=c&&c>A[2]){var x=(E-c)/(E-A[2]);S={x:w[0]*(1-x)+A[0]*x,y:w[1]*(1-x)+A[1]*x}}A=[v,b,E]}return y&&c>=E&&(S={x:r,y:l}),{length:E,point:S,min:{x:Math.min.apply(null,C.map(function(t){return t.x})),y:Math.min.apply(null,C.map(function(t){return t.y}))},max:{x:Math.max.apply(null,C.map(function(t){return t.x})),y:Math.max.apply(null,C.map(function(t){return t.y}))}}}function te(t,e,i,a,s,n,o,r,l){var c=1-l;return{x:Math.pow(c,3)*t+3*Math.pow(c,2)*l*i+3*c*Math.pow(l,2)*s+Math.pow(l,3)*o,y:Math.pow(c,3)*e+3*Math.pow(c,2)*l*a+3*c*Math.pow(l,2)*n+Math.pow(l,3)*r}}function ee(t,e,i,a,s,n,o,r,l,c){var d,h=c.bbox,u=void 0===h||h,p=c.length,m=void 0===p||p,f=c.sampleSize,g=void 0===f?10:f,_="number"==typeof l,y=t,v=e,b=0,E=[y,v,b],A=[y,v],w={x:0,y:0},S=[{x:y,y:v}];_&&l<=0&&(w={x:y,y:v});for(var C=0;C<=g;C+=1){if(y=(d=te(t,e,i,a,s,n,o,r,C/g)).x,v=d.y,u&&S.push({x:y,y:v}),m&&(b+=Kt(A,[y,v])),A=[y,v],_&&b>=l&&l>E[2]){var I=(b-l)/(b-E[2]);w={x:A[0]*(1-I)+E[0]*I,y:A[1]*(1-I)+E[1]*I}}E=[y,v,b]}return _&&l>=b&&(w={x:o,y:r}),{length:b,point:w,min:{x:Math.min.apply(null,S.map(function(t){return t.x})),y:Math.min.apply(null,S.map(function(t){return t.y}))},max:{x:Math.max.apply(null,S.map(function(t){return t.x})),y:Math.max.apply(null,S.map(function(t){return t.y}))}}}function ie(t,e,i,a,s,n,o){var r=1-o;return{x:Math.pow(r,2)*t+2*r*o*i+Math.pow(o,2)*s,y:Math.pow(r,2)*e+2*r*o*a+Math.pow(o,2)*n}}function ae(t,e,i,a,s,n,o,r){var l,c=r.bbox,d=void 0===c||c,h=r.length,u=void 0===h||h,p=r.sampleSize,m=void 0===p?10:p,f="number"==typeof o,g=t,_=e,y=0,v=[g,_,y],b=[g,_],E={x:0,y:0},A=[{x:g,y:_}];f&&o<=0&&(E={x:g,y:_});for(var w=0;w<=m;w+=1){if(g=(l=ie(t,e,i,a,s,n,w/m)).x,_=l.y,d&&A.push({x:g,y:_}),u&&(y+=Kt(b,[g,_])),b=[g,_],f&&y>=o&&o>v[2]){var S=(y-o)/(y-v[2]);E={x:b[0]*(1-S)+v[0]*S,y:b[1]*(1-S)+v[1]*S}}v=[g,_,y]}return f&&o>=y&&(E={x:s,y:n}),{length:y,point:E,min:{x:Math.min.apply(null,A.map(function(t){return t.x})),y:Math.min.apply(null,A.map(function(t){return t.y}))},max:{x:Math.max.apply(null,A.map(function(t){return t.x})),y:Math.max.apply(null,A.map(function(t){return t.y}))}}}function se(t,e,i){for(var a,s,n,o,r,l,c,d,h,u=jt(t),p="number"==typeof e,m=[],f=0,g=0,_=0,y=0,v=[],b=[],E=0,A={x:0,y:0},w=A,S=A,C=A,I=0,x=0,T=u.length;x<T;x+=1)m=(c="M"===(d=(h=u[x])[0]))?m:[f,g].concat(h.slice(1)),c?(w=A={x:_=h[1],y:y=h[2]},E=0,p&&e<.001&&(C=A)):"L"===d?(E=(a=Qt(m[0],m[1],m[2],m[3],(e||0)-I)).length,A=a.min,w=a.max,S=a.point):"A"===d?(E=(s=Zt(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8],(e||0)-I,i||{})).length,A=s.min,w=s.max,S=s.point):"C"===d?(E=(n=ee(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],(e||0)-I,i||{})).length,A=n.min,w=n.max,S=n.point):"Q"===d?(E=(o=ae(m[0],m[1],m[2],m[3],m[4],m[5],(e||0)-I,i||{})).length,A=o.min,w=o.max,S=o.point):"Z"===d&&(E=(r=Qt((m=[f,g,_,y])[0],m[1],m[2],m[3],(e||0)-I)).length,A=r.min,w=r.max,S=r.point),p&&I<e&&I+E>=e&&(C=S),b.push(w),v.push(A),I+=E,f=(l="Z"!==d?h.slice(-2):[_,y])[0],g=l[1];return p&&e>=I&&(C={x:f,y:g}),{length:I,point:C,min:{x:Math.min.apply(null,v.map(function(t){return t.x})),y:Math.min.apply(null,v.map(function(t){return t.y}))},max:{x:Math.max.apply(null,b.map(function(t){return t.x})),y:Math.max.apply(null,b.map(function(t){return t.y}))}}}function ne(t){return function(t){var e=0,i=0,a=0;return Ht(t).map(function(t){var s;if("M"===t[0])return e=t[1],i=t[2],0;var n=t.slice(1),o=n[0],r=n[1],l=n[2],c=n[3],d=n[4],h=n[5];return a=function(t,e,i,a,s,n,o,r){return 3*((r-e)*(i+s)-(o-t)*(a+n)+a*(t-s)-i*(e-n)+r*(s+t/3)-o*(n+e/3))/20}(e,i,o,r,l,c,d,h),s=t.slice(-2),e=s[0],i=s[1],a}).reduce(function(t,e){return t+e},0)}(t)>=0}function oe(t){return t.map(function(t,e,i){var a=e&&i[e-1].slice(-2).concat(t.slice(1)),s=e?ee(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],{bbox:!1}).length:0;return{s:t,ss:e?s?function(t,e){void 0===e&&(e=.5);var i=t.slice(0,2),a=t.slice(2,4),s=t.slice(4,6),n=t.slice(6,8),o=zt(i,a,e),r=zt(a,s,e),l=zt(s,n,e),c=zt(o,r,e),d=zt(r,l,e),h=zt(c,d,e);return[["C"].concat(o,c,h),["C"].concat(d,l,n)]}(a):[t,t]:[t],l:s}})}function re(t,e,i){var a=oe(t),s=oe(e),n=a.length,o=s.length,r=a.filter(function(t){return t.l}).length,l=s.filter(function(t){return t.l}).length,c=a.filter(function(t){return t.l}).reduce(function(t,e){return t+e.l},0)/r||0,d=s.filter(function(t){return t.l}).reduce(function(t,e){return t+e.l},0)/l||0,h=i||Math.max(n,o),u=[c,d],p=[h-n,h-o],m=0,f=[a,s].map(function(t,e){return t.l===h?t.map(function(t){return t.s}):t.map(function(t,i){return m=i&&p[e]&&t.l>=u[e],p[e]-=m?1:0,m?t.ss:[t.s]}).flat()});return f[0].length===f[1].length?f:re(f[0],f[1],h)}var le=function(t){return null==t},ce={}.toString,de=function(t,e){return ce.call(t)==="[object "+e+"]"},he=function(t){return Array.isArray?Array.isArray(t):de(t,"Array")},ue=function(t){var e=typeof t;return null!==t&&"object"===e||"function"===e},pe=function(t){if(he(t))return t.reduce(function(t,e){return Math.max(t,e)},t[0])},me=function(t){if(he(t))return t.reduce(function(t,e){return Math.min(t,e)},t[0])},fe=function(t){return de(t,"String")},ge=function(t,e,i){return t<e?e:t>i?i:t},_e=function(t){return de(t,"Number")};function ye(t,e,i){return void 0===i&&(i=1e-5),Math.abs(t-e)<i}var ve=function(t,e){return(t%e+e)%e},be=function(t){return de(t,"Boolean")},Ee=function(t){return void 0===t};function Ae(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function we(t,e){var i=Object.create(t.prototype);for(var a in e)i[a]=e[a];return i}function Se(){}var Ce=.7,Ie=1/Ce,xe="\\s*([+-]?\\d+)\\s*",Te="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Me="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Pe=/^#([0-9a-f]{3,8})$/,Oe=new RegExp("^rgb\\("+[xe,xe,xe]+"\\)$"),Le=new RegExp("^rgb\\("+[Me,Me,Me]+"\\)$"),Re=new RegExp("^rgba\\("+[xe,xe,xe,Te]+"\\)$"),De=new RegExp("^rgba\\("+[Me,Me,Me,Te]+"\\)$"),Ne=new RegExp("^hsl\\("+[Te,Me,Me]+"\\)$"),ke=new RegExp("^hsla\\("+[Te,Me,Me,Te]+"\\)$"),Fe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function $e(){return this.rgb().formatHex()}function qe(){return this.rgb().formatRgb()}function Ge(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=Pe.exec(t))?(i=e[1].length,e=parseInt(e[1],16),6===i?Be(e):3===i?new Ue(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===i?je(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===i?je(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Oe.exec(t))?new Ue(e[1],e[2],e[3],1):(e=Le.exec(t))?new Ue(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Re.exec(t))?je(e[1],e[2],e[3],e[4]):(e=De.exec(t))?je(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Ne.exec(t))?We(e[1],e[2]/100,e[3]/100,1):(e=ke.exec(t))?We(e[1],e[2]/100,e[3]/100,e[4]):Fe.hasOwnProperty(t)?Be(Fe[t]):"transparent"===t?new Ue(NaN,NaN,NaN,0):null}function Be(t){return new Ue(t>>16&255,t>>8&255,255&t,1)}function je(t,e,i,a){return a<=0&&(t=e=i=NaN),new Ue(t,e,i,a)}function Ue(t,e,i,a){this.r=+t,this.g=+e,this.b=+i,this.opacity=+a}function Ye(){return"#"+Ve(this.r)+Ve(this.g)+Ve(this.b)}function ze(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function Ve(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function We(t,e,i,a){return a<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new Ke(t,e,i,a)}function He(t){if(t instanceof Ke)return new Ke(t.h,t.s,t.l,t.opacity);if(t instanceof Se||(t=Ge(t)),!t)return new Ke;if(t instanceof Ke)return t;var e=(t=t.rgb()).r/255,i=t.g/255,a=t.b/255,s=Math.min(e,i,a),n=Math.max(e,i,a),o=NaN,r=n-s,l=(n+s)/2;return r?(o=e===n?(i-a)/r+6*(i<a):i===n?(a-e)/r+2:(e-i)/r+4,r/=l<.5?n+s:2-n-s,o*=60):r=l>0&&l<1?0:o,new Ke(o,r,l,t.opacity)}function Ke(t,e,i,a){this.h=+t,this.s=+e,this.l=+i,this.opacity=+a}function Qe(t,e,i){return 255*(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)}function Xe(t,e,i,a){var s=t-i,n=e-a;return Math.sqrt(s*s+n*n)}function Je(t,e){var i=Math.min.apply(Math,p([],u(t),!1)),a=Math.min.apply(Math,p([],u(e),!1));return{x:i,y:a,width:Math.max.apply(Math,p([],u(t),!1))-i,height:Math.max.apply(Math,p([],u(e),!1))-a}}function Ze(t,e,i,a,s,n){return i*Math.cos(s)*Math.cos(n)-a*Math.sin(s)*Math.sin(n)+t}function ti(t,e,i,a,s,n){return i*Math.sin(s)*Math.cos(n)+a*Math.cos(s)*Math.sin(n)+e}function ei(t,e,i,a,s,n,o){for(var r=function(t,e,i){return Math.atan(-e/t*Math.tan(i))}(i,a,s),l=1/0,c=-1/0,d=[n,o],h=2*-Math.PI;h<=2*Math.PI;h+=Math.PI){var u=r+h;n<o?n<u&&u<o&&d.push(u):o<u&&u<n&&d.push(u)}for(h=0;h<d.length;h++){var p=Ze(t,0,i,a,s,d[h]);p<l&&(l=p),p>c&&(c=p)}var m=function(t,e,i){return Math.atan(e/(t*Math.tan(i)))}(i,a,s),f=1/0,g=-1/0,_=[n,o];for(h=2*-Math.PI;h<=2*Math.PI;h+=Math.PI){var y=m+h;n<o?n<y&&y<o&&_.push(y):o<y&&y<n&&_.push(y)}for(h=0;h<_.length;h++){var v=ti(0,e,i,a,s,_[h]);v<f&&(f=v),v>g&&(g=v)}return{x:l,y:f,width:c-l,height:g-f}}Ae(Se,Ge,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:$e,formatHex:$e,formatHsl:function(){return He(this).formatHsl()},formatRgb:qe,toString:qe}),Ae(Ue,function(t,e,i,a){return 1===arguments.length?((s=t)instanceof Se||(s=Ge(s)),s?new Ue((s=s.rgb()).r,s.g,s.b,s.opacity):new Ue):new Ue(t,e,i,null==a?1:a);var s},we(Se,{brighter:function(t){return t=null==t?Ie:Math.pow(Ie,t),new Ue(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?Ce:Math.pow(Ce,t),new Ue(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ye,formatHex:Ye,formatRgb:ze,toString:ze})),Ae(Ke,function(t,e,i,a){return 1===arguments.length?He(t):new Ke(t,e,i,null==a?1:a)},we(Se,{brighter:function(t){return t=null==t?Ie:Math.pow(Ie,t),new Ke(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?Ce:Math.pow(Ce,t),new Ke(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,a=i+(i<.5?i:1-i)*e,s=2*i-a;return new Ue(Qe(t>=240?t-240:t+120,s,a),Qe(t,s,a),Qe(t<120?t+240:t-120,s,a),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));function ii(t,e,i,a,s,n){var o=-1,r=1/0,l=[i,a],c=20;n&&n>200&&(c=n/10);for(var d=1/c,h=d/10,m=0;m<=c;m++){var f=m*d,g=[s.apply(void 0,p([],u(t.concat([f])),!1)),s.apply(void 0,p([],u(e.concat([f])),!1))];(b=Xe(l[0],l[1],g[0],g[1]))<r&&(o=f,r=b)}if(0===o)return{x:t[0],y:e[0]};if(1===o){var _=t.length;return{x:t[_-1],y:e[_-1]}}for(r=1/0,m=0;m<32&&!(h<1e-4);m++){var y=o-h,v=o+h,b=(g=[s.apply(void 0,p([],u(t.concat([y])),!1)),s.apply(void 0,p([],u(e.concat([y])),!1))],Xe(l[0],l[1],g[0],g[1]));if(y>=0&&b<r)o=y,r=b;else{var E=[s.apply(void 0,p([],u(t.concat([v])),!1)),s.apply(void 0,p([],u(e.concat([v])),!1))],A=Xe(l[0],l[1],E[0],E[1]);v<=1&&A<r?(o=v,r=A):h*=.5}}return{x:s.apply(void 0,p([],u(t.concat([o])),!1)),y:s.apply(void 0,p([],u(e.concat([o])),!1))}}function ai(t,e,i,a){return Xe(t,e,i,a)}function si(t,e,i,a,s){return{x:(1-s)*t+s*i,y:(1-s)*e+s*a}}function ni(t,e,i,a,s){var n=1-s;return n*n*n*t+3*e*s*n*n+3*i*s*s*n+a*s*s*s}function oi(t,e,i,a){var s,n,o,r=-3*t+9*e-9*i+3*a,l=6*t-12*e+6*i,c=3*e-3*t,d=[];if(ye(r,0))ye(l,0)||(s=-c/l)>=0&&s<=1&&d.push(s);else{var h=l*l-4*r*c;ye(h,0)?d.push(-l/(2*r)):h>0&&(n=(-l-(o=Math.sqrt(h)))/(2*r),(s=(-l+o)/(2*r))>=0&&s<=1&&d.push(s),n>=0&&n<=1&&d.push(n))}return d}function ri(t,e,i,a,s,n,o,r){for(var l=[t,o],c=[e,r],d=oi(t,i,s,o),h=oi(e,a,n,r),u=0;u<d.length;u++)l.push(ni(t,i,s,o,d[u]));for(u=0;u<h.length;u++)c.push(ni(e,a,n,r,h[u]));return Je(l,c)}function li(t,e,i,a,s,n,o,r,l,c,d){var h=function(t,e,i,a,s,n,o,r,l,c,d){return ii([t,i,s,o],[e,a,n,r],l,c,ni,d)}(t,e,i,a,s,n,o,r,l,c,d);return Xe(h.x,h.y,l,c)}function ci(t,e,i,a){var s=1-a;return s*s*t+2*a*s*e+a*a*i}function di(t,e,i){var a=t+i-2*e;if(ye(a,0))return[.5];var s=(t-e)/a;return s<=1&&s>=0?[s]:[]}function hi(t,e,i,a,s,n){var o=di(t,i,s)[0],r=di(e,a,n)[0],l=[t,s],c=[e,n];return void 0!==o&&l.push(ci(t,i,s,o)),void 0!==r&&c.push(ci(e,a,n,r)),Je(l,c)}function ui(t,e,i,a,s,n,o,r){var l=function(t,e,i,a,s,n,o,r){return ii([t,i,s],[e,a,n],o,r,ci)}(t,e,i,a,s,n,o,r);return Xe(l.x,l.y,o,r)}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e||"undefined"!=typeof self&&self;var pi={exports:{}};pi.exports=function(){function t(t,i,s,n,o){e(t,i,s||0,n||t.length-1,o||a)}function e(t,a,s,n,o){for(;n>s;){if(n-s>600){var r=n-s+1,l=a-s+1,c=Math.log(r),d=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*d*(r-d)/r)*(l-r/2<0?-1:1);e(t,a,Math.max(s,Math.floor(a-l*d/r+h)),Math.min(n,Math.floor(a+(r-l)*d/r+h)),o)}var u=t[a],p=s,m=n;for(i(t,s,a),o(t[n],u)>0&&i(t,s,n);p<m;){for(i(t,p,m),p++,m--;o(t[p],u)<0;)p++;for(;o(t[m],u)>0;)m--}0===o(t[s],u)?i(t,s,m):i(t,++m,n),m<=a&&(s=m+1),a<=m&&(n=m-1)}}function i(t,e,i){var a=t[e];t[e]=t[i],t[i]=a}function a(t,e){return t<e?-1:t>e?1:0}var s=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(t,e,i){if(!i)return e.indexOf(t);for(var a=0;a<e.length;a++)if(i(t,e[a]))return a;return-1}function o(t,e){r(t,0,t.children.length,e,t)}function r(t,e,i,a,s){s||(s=_(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var n=e;n<i;n++){var o=t.children[n];l(s,t.leaf?a(o):o)}return s}function l(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function c(t,e){return t.minX-e.minX}function d(t,e){return t.minY-e.minY}function h(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function u(t){return t.maxX-t.minX+(t.maxY-t.minY)}function p(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function m(t,e){var i=Math.max(t.minX,e.minX),a=Math.max(t.minY,e.minY),s=Math.min(t.maxX,e.maxX),n=Math.min(t.maxY,e.maxY);return Math.max(0,s-i)*Math.max(0,n-a)}function f(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function g(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function _(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(e,i,a,s,n){for(var o=[i,a];o.length;)if(!((a=o.pop())-(i=o.pop())<=s)){var r=i+Math.ceil((a-i)/s/2)*s;t(e,r,i,a,n),o.push(i,r,r,a)}}return s.prototype.all=function(){return this._all(this.data,[])},s.prototype.search=function(t){var e=this.data,i=[];if(!g(t,e))return i;for(var a=this.toBBox,s=[];e;){for(var n=0;n<e.children.length;n++){var o=e.children[n],r=e.leaf?a(o):o;g(t,r)&&(e.leaf?i.push(o):f(t,r)?this._all(o,i):s.push(o))}e=s.pop()}return i},s.prototype.collides=function(t){var e=this.data;if(!g(t,e))return!1;for(var i=[];e;){for(var a=0;a<e.children.length;a++){var s=e.children[a],n=e.leaf?this.toBBox(s):s;if(g(t,n)){if(e.leaf||f(t,n))return!0;i.push(s)}}e=i.pop()}return!1},s.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var a=this.data;this.data=i,i=a}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},s.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},s.prototype.clear=function(){return this.data=_([]),this},s.prototype.remove=function(t,e){if(!t)return this;for(var i,a,s,o=this.data,r=this.toBBox(t),l=[],c=[];o||l.length;){if(o||(o=l.pop(),a=l[l.length-1],i=c.pop(),s=!0),o.leaf){var d=n(t,o.children,e);if(-1!==d)return o.children.splice(d,1),l.push(o),this._condense(l),this}s||o.leaf||!f(o,r)?a?(i++,o=a.children[i],s=!1):o=null:(l.push(o),c.push(i),i=0,a=o,o=o.children[0])}return this},s.prototype.toBBox=function(t){return t},s.prototype.compareMinX=function(t,e){return t.minX-e.minX},s.prototype.compareMinY=function(t,e){return t.minY-e.minY},s.prototype.toJSON=function(){return this.data},s.prototype.fromJSON=function(t){return this.data=t,this},s.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},s.prototype._build=function(t,e,i,a){var s,n=i-e+1,r=this._maxEntries;if(n<=r)return o(s=_(t.slice(e,i+1)),this.toBBox),s;a||(a=Math.ceil(Math.log(n)/Math.log(r)),r=Math.ceil(n/Math.pow(r,a-1))),(s=_([])).leaf=!1,s.height=a;var l=Math.ceil(n/r),c=l*Math.ceil(Math.sqrt(r));y(t,e,i,c,this.compareMinX);for(var d=e;d<=i;d+=c){var h=Math.min(d+c-1,i);y(t,d,h,l,this.compareMinY);for(var u=d;u<=h;u+=l){var p=Math.min(u+l-1,h);s.children.push(this._build(t,u,p,a-1))}}return o(s,this.toBBox),s},s.prototype._chooseSubtree=function(t,e,i,a){for(;a.push(e),!e.leaf&&a.length-1!==i;){for(var s=1/0,n=1/0,o=void 0,r=0;r<e.children.length;r++){var l=e.children[r],c=h(l),d=p(t,l)-c;d<n?(n=d,s=c<s?c:s,o=l):d===n&&c<s&&(s=c,o=l)}e=o||e.children[0]}return e},s.prototype._insert=function(t,e,i){var a=i?t:this.toBBox(t),s=[],n=this._chooseSubtree(a,this.data,e,s);for(n.children.push(t),l(n,a);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(a,s,e)},s.prototype._split=function(t,e){var i=t[e],a=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,a);var n=this._chooseSplitIndex(i,s,a),r=_(i.children.splice(n,i.children.length-n));r.height=i.height,r.leaf=i.leaf,o(i,this.toBBox),o(r,this.toBBox),e?t[e-1].children.push(r):this._splitRoot(i,r)},s.prototype._splitRoot=function(t,e){this.data=_([t,e]),this.data.height=t.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},s.prototype._chooseSplitIndex=function(t,e,i){for(var a,s=1/0,n=1/0,o=e;o<=i-e;o++){var l=r(t,0,o,this.toBBox),c=r(t,o,i,this.toBBox),d=m(l,c),u=h(l)+h(c);d<s?(s=d,a=o,n=u<n?u:n):d===s&&u<n&&(n=u,a=o)}return a||i-e},s.prototype._chooseSplitAxis=function(t,e,i){var a=t.leaf?this.compareMinX:c,s=t.leaf?this.compareMinY:d;this._allDistMargin(t,e,i,a)<this._allDistMargin(t,e,i,s)&&t.children.sort(a)},s.prototype._allDistMargin=function(t,e,i,a){t.children.sort(a);for(var s=this.toBBox,n=r(t,0,e,s),o=r(t,i-e,i,s),c=u(n)+u(o),d=e;d<i-e;d++){var h=t.children[d];l(n,t.leaf?s(h):h),c+=u(n)}for(var p=i-e-1;p>=e;p--){var m=t.children[p];l(o,t.leaf?s(m):m),c+=u(o)}return c},s.prototype._adjustParentBBoxes=function(t,e,i){for(var a=i;a>=0;a--)l(e[a],t)},s.prototype._condense=function(t){for(var e=t.length-1,i=void 0;e>=0;e--)0===t[e].children.length?e>0?(i=t[e-1].children).splice(i.indexOf(t[e]),1):this.clear():o(t[e],this.toBBox)},s}();var mi,fi,gi=pi.exports;!function(t){t.GROUP="g",t.CIRCLE="circle",t.ELLIPSE="ellipse",t.IMAGE="image",t.RECT="rect",t.LINE="line",t.POLYLINE="polyline",t.POLYGON="polygon",t.TEXT="text",t.PATH="path",t.HTML="html",t.MESH="mesh"}(mi||(mi={})),function(t){t[t.ZERO=0]="ZERO",t[t.NEGATIVE_ONE=1]="NEGATIVE_ONE"}(fi||(fi={}));var _i=function(){function t(){this.plugins=[]}return t.prototype.addRenderingPlugin=function(t){this.plugins.push(t),this.context.renderingPlugins.push(t)},t.prototype.removeAllRenderingPlugins=function(){var t=this;this.plugins.forEach(function(e){var i=t.context.renderingPlugins.indexOf(e);i>=0&&t.context.renderingPlugins.splice(i,1)})},t}(),yi=function(){function t(t){this.clipSpaceNearZ=fi.NEGATIVE_ONE,this.plugins=[],this.config=r({enableDirtyCheck:!0,enableCulling:!1,enableAutoRendering:!0,enableDirtyRectangleRendering:!0,enableDirtyRectangleRenderingDebug:!1,enableSizeAttenuation:!0},t)}return t.prototype.registerPlugin=function(t){-1===this.plugins.findIndex(function(e){return e===t})&&this.plugins.push(t)},t.prototype.unregisterPlugin=function(t){var e=this.plugins.findIndex(function(e){return e===t});e>-1&&this.plugins.splice(e,1)},t.prototype.getPlugins=function(){return this.plugins},t.prototype.getPlugin=function(t){return this.plugins.find(function(e){return e.name===t})},t.prototype.getConfig=function(){return this.config},t.prototype.setConfig=function(t){Object.assign(this.config,t)},t}();function vi(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function bi(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Ei(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function Ai(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function wi(t){return void 0===t?0:t>360||t<-360?t%360:t}function Si(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),Array.isArray(t)&&3===t.length?tt(t):_e(t)?it(t,e,i):it(t[0],t[1]||e,t[2]||i)}function Ci(t){return t*(Math.PI/180)}function Ii(t){return t*(180/Math.PI)}function xi(t,e){return 16===e.length?function(t,e){var i,a,s=.5*Math.PI,n=u(q(Z(),e),3),o=n[0],r=n[1],l=n[2],c=Math.asin(-e[2]/o);return c<s?c>-s?(i=Math.atan2(e[6]/r,e[10]/l),a=Math.atan2(e[1]/o,e[0]/o)):(a=0,i=-Math.atan2(e[4]/r,e[5]/r)):(a=0,i=Math.atan2(e[4]/r,e[5]/r)),t[0]=i,t[1]=c,t[2]=a,t}(t,e):function(t,e){var i=e[0],a=e[1],s=e[2],n=e[3],o=a*a,r=s*s,l=n*n,c=i*i+o+r+l,d=i*n-a*s;return d>.499995*c?(t[0]=Math.PI/2,t[1]=2*Math.atan2(a,i),t[2]=0):d<-.499995*c?(t[0]=-Math.PI/2,t[1]=2*Math.atan2(a,i),t[2]=0):(t[0]=Math.asin(2*(i*s-n*a)),t[1]=Math.atan2(2*(i*n+a*s),1-2*(r+l)),t[2]=Math.atan2(2*(i*a+s*n),1-2*(o+r))),t}(t,e)}function Ti(t){var e=t[0],i=t[1],a=t[3],s=t[4],n=Math.sqrt(e*e+i*i),o=Math.sqrt(a*a+s*s);e*s-i*a<0&&(e<s?n=-n:o=-o),n&&(e*=1/n,i*=1/n),o&&(a*=1/o,s*=1/o);var r=Ii(Math.atan2(i,e));return[t[6],t[7],n,o,r]}var Mi=A(),Pi=A(),Oi=gt(),Li=[Z(),Z(),Z()],Ri=Z();function Di(t,e,i,a,s){t[0]=e[0]*a+i[0]*s,t[1]=e[1]*a+i[1]*s,t[2]=e[2]*a+i[2]*s}var Ni,ki=function(){function t(){this.center=[0,0,0],this.halfExtents=[0,0,0],this.min=[0,0,0],this.max=[0,0,0]}return t.isEmpty=function(t){return!t||0===t.halfExtents[0]&&0===t.halfExtents[1]&&0===t.halfExtents[2]},t.prototype.update=function(t,e){vi(this.center,t),vi(this.halfExtents,e),bi(this.min,this.center,this.halfExtents),Ei(this.max,this.center,this.halfExtents)},t.prototype.setMinMax=function(t,e){Ei(this.center,e,t),Ai(this.center,this.center,.5),bi(this.halfExtents,e,t),Ai(this.halfExtents,this.halfExtents,.5),vi(this.min,t),vi(this.max,e)},t.prototype.getMin=function(){return this.min},t.prototype.getMax=function(){return this.max},t.prototype.add=function(e){if(!t.isEmpty(e))if(t.isEmpty(this))this.setMinMax(e.getMin(),e.getMax());else{var i=this.center,a=i[0],s=i[1],n=i[2],o=this.halfExtents,r=o[0],l=o[1],c=o[2],d=a-r,h=a+r,u=s-l,p=s+l,m=n-c,f=n+c,g=e.center,_=g[0],y=g[1],v=g[2],b=e.halfExtents,E=b[0],A=b[1],w=b[2],S=_-E,C=_+E,I=y-A,x=y+A,T=v-w,M=v+w;S<d&&(d=S),C>h&&(h=C),I<u&&(u=I),x>p&&(p=x),T<m&&(m=T),M>f&&(f=M),i[0]=.5*(d+h),i[1]=.5*(u+p),i[2]=.5*(m+f),o[0]=.5*(h-d),o[1]=.5*(p-u),o[2]=.5*(f-m),this.min[0]=d,this.min[1]=u,this.min[2]=m,this.max[0]=h,this.max[1]=p,this.max[2]=f}},t.prototype.setFromTransformedAABB=function(t,e){var i=this.center,a=this.halfExtents,s=t.center,n=t.halfExtents,o=e[0],r=e[4],l=e[8],c=e[1],d=e[5],h=e[9],u=e[2],p=e[6],m=e[10],f=Math.abs(o),g=Math.abs(r),_=Math.abs(l),y=Math.abs(c),v=Math.abs(d),b=Math.abs(h),E=Math.abs(u),A=Math.abs(p),w=Math.abs(m);i[0]=e[12]+o*s[0]+r*s[1]+l*s[2],i[1]=e[13]+c*s[0]+d*s[1]+h*s[2],i[2]=e[14]+u*s[0]+p*s[1]+m*s[2],a[0]=f*n[0]+g*n[1]+_*n[2],a[1]=y*n[0]+v*n[1]+b*n[2],a[2]=E*n[0]+A*n[1]+w*n[2],bi(this.min,i,a),Ei(this.max,i,a)},t.prototype.intersects=function(t){var e=this.getMax(),i=this.getMin(),a=t.getMax(),s=t.getMin();return i[0]<=a[0]&&e[0]>=s[0]&&i[1]<=a[1]&&e[1]>=s[1]&&i[2]<=a[2]&&e[2]>=s[2]},t.prototype.intersection=function(e){if(!this.intersects(e))return null;var i,a,s,n=new t,o=(i=[0,0,0],a=this.getMin(),s=e.getMin(),i[0]=Math.max(a[0],s[0]),i[1]=Math.max(a[1],s[1]),i[2]=Math.max(a[2],s[2]),i),r=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}([0,0,0],this.getMax(),e.getMax());return n.setMinMax(o,r),n},t.prototype.getNegativeFarPoint=function(t){return 273===t.pnVertexFlag?vi([0,0,0],this.min):272===t.pnVertexFlag?[this.min[0],this.min[1],this.max[2]]:257===t.pnVertexFlag?[this.min[0],this.max[1],this.min[2]]:256===t.pnVertexFlag?[this.min[0],this.max[1],this.max[2]]:17===t.pnVertexFlag?[this.max[0],this.min[1],this.min[2]]:16===t.pnVertexFlag?[this.max[0],this.min[1],this.max[2]]:1===t.pnVertexFlag?[this.max[0],this.max[1],this.min[2]]:[this.max[0],this.max[1],this.max[2]]},t.prototype.getPositiveFarPoint=function(t){return 273===t.pnVertexFlag?vi([0,0,0],this.max):272===t.pnVertexFlag?[this.max[0],this.max[1],this.min[2]]:257===t.pnVertexFlag?[this.max[0],this.min[1],this.max[2]]:256===t.pnVertexFlag?[this.max[0],this.min[1],this.min[2]]:17===t.pnVertexFlag?[this.min[0],this.max[1],this.max[2]]:16===t.pnVertexFlag?[this.min[0],this.max[1],this.min[2]]:1===t.pnVertexFlag?[this.min[0],this.min[1],this.max[2]]:[this.min[0],this.min[1],this.min[2]]},t}(),Fi=function(){function t(t,e){this.distance=t||0,this.normal=e||it(0,1,0),this.updatePNVertexFlag()}return t.prototype.updatePNVertexFlag=function(){this.pnVertexFlag=(Number(this.normal[0]>=0)<<8)+(Number(this.normal[1]>=0)<<4)+Number(this.normal[2]>=0)},t.prototype.distanceToPoint=function(t){return ct(t,this.normal)-this.distance},t.prototype.normalize=function(){var t=1/ft(this.normal);rt(this.normal,this.normal,t),this.distance*=t},t.prototype.intersectsLine=function(t,e,i){var a=this.distanceToPoint(t),s=a/(a-this.distanceToPoint(e)),n=s>=0&&s<=1;return n&&i&&dt(i,t,e,s),n},t}();!function(t){t[t.OUTSIDE=4294967295]="OUTSIDE",t[t.INSIDE=0]="INSIDE",t[t.INDETERMINATE=2147483647]="INDETERMINATE"}(Ni||(Ni={}));var $i,qi,Gi,Bi=function(){function t(t){if(this.planes=[],t)this.planes=t;else for(var e=0;e<6;e++)this.planes.push(new Fi)}return t.prototype.extractFromVPMatrix=function(t){var e=u(t,16),i=e[0],a=e[1],s=e[2],n=e[3],o=e[4],r=e[5],l=e[6],c=e[7],d=e[8],h=e[9],p=e[10],m=e[11],f=e[12],g=e[13],_=e[14],y=e[15];st(this.planes[0].normal,n-i,c-o,m-d),this.planes[0].distance=y-f,st(this.planes[1].normal,n+i,c+o,m+d),this.planes[1].distance=y+f,st(this.planes[2].normal,n+a,c+r,m+h),this.planes[2].distance=y+g,st(this.planes[3].normal,n-a,c-r,m-h),this.planes[3].distance=y-g,st(this.planes[4].normal,n-s,c-l,m-p),this.planes[4].distance=y-_,st(this.planes[5].normal,n+s,c+l,m+p),this.planes[5].distance=y+_,this.planes.forEach(function(t){t.normalize(),t.updatePNVertexFlag()})},t}(),ji=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},t}(),Ui=function(){function t(t,e,i,a){this.x=t,this.y=e,this.width=i,this.height=a,this.left=t,this.right=t+i,this.top=e,this.bottom=e+a}return t.prototype.toJSON=function(){},t}(),Yi="Method not implemented.",zi="Use document.documentElement instead.";!function(t){t[t.ORBITING=0]="ORBITING",t[t.EXPLORING=1]="EXPLORING",t[t.TRACKING=2]="TRACKING"}($i||($i={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.ROTATIONAL=1]="ROTATIONAL",t[t.TRANSLATIONAL=2]="TRANSLATIONAL",t[t.CINEMATIC=3]="CINEMATIC"}(qi||(qi={})),function(t){t[t.ORTHOGRAPHIC=0]="ORTHOGRAPHIC",t[t.PERSPECTIVE=1]="PERSPECTIVE"}(Gi||(Gi={}));var Vi,Wi,Hi,Ki,Qi,Xi="updated",Ji=2e-4,Zi=function(){function t(){this.clipSpaceNearZ=fi.NEGATIVE_ONE,this.eventEmitter=new y,this.matrix=A(),this.right=it(1,0,0),this.up=it(0,1,0),this.forward=it(0,0,1),this.position=it(0,0,1),this.focalPoint=it(0,0,0),this.distanceVector=it(0,0,-1),this.distance=1,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.dollyingStep=0,this.maxDistance=1/0,this.minDistance=-1/0,this.zoom=1,this.rotateWorld=!1,this.fov=30,this.near=.1,this.far=1e3,this.aspect=1,this.projectionMatrix=A(),this.projectionMatrixInverse=A(),this.jitteredProjectionMatrix=void 0,this.enableUpdate=!0,this.type=$i.EXPLORING,this.trackingMode=qi.DEFAULT,this.projectionMode=Gi.PERSPECTIVE,this.frustum=new Bi,this.orthoMatrix=A()}return t.prototype.isOrtho=function(){return this.projectionMode===Gi.ORTHOGRAPHIC},t.prototype.getProjectionMode=function(){return this.projectionMode},t.prototype.getPerspective=function(){return this.jitteredProjectionMatrix||this.projectionMatrix},t.prototype.getPerspectiveInverse=function(){return this.projectionMatrixInverse},t.prototype.getFrustum=function(){return this.frustum},t.prototype.getPosition=function(){return this.position},t.prototype.getFocalPoint=function(){return this.focalPoint},t.prototype.getDollyingStep=function(){return this.dollyingStep},t.prototype.getNear=function(){return this.near},t.prototype.getFar=function(){return this.far},t.prototype.getZoom=function(){return this.zoom},t.prototype.getOrthoMatrix=function(){return this.orthoMatrix},t.prototype.getView=function(){return this.view},t.prototype.setEnableUpdate=function(t){this.enableUpdate=t},t.prototype.setType=function(t,e){return this.type=t,this.type===$i.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===$i.TRACKING&&void 0!==e&&this.setTrackingMode(e),this},t.prototype.setProjectionMode=function(t){return this.projectionMode=t,this},t.prototype.setTrackingMode=function(t){if(this.type!==$i.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");return this.trackingMode=t,this},t.prototype.setWorldRotation=function(t){return this.rotateWorld=t,this._getAngles(),this},t.prototype.getViewTransform=function(){return T(A(),this.matrix)},t.prototype.getWorldTransform=function(){return this.matrix},t.prototype.jitterProjectionMatrix=function(t,e){var i=N(A(),[t,e,0]);this.jitteredProjectionMatrix=P(A(),i,this.projectionMatrix)},t.prototype.clearJitterProjectionMatrix=function(){this.jitteredProjectionMatrix=void 0},t.prototype.setMatrix=function(t){return this.matrix=t,this._update(),this},t.prototype.setFov=function(t){return this.setPerspective(this.near,this.far,t,this.aspect),this},t.prototype.setAspect=function(t){return this.setPerspective(this.near,this.far,this.fov,t),this},t.prototype.setNear=function(t){return this.projectionMode===Gi.PERSPECTIVE?this.setPerspective(t,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,t,this.far),this},t.prototype.setFar=function(t){return this.projectionMode===Gi.PERSPECTIVE?this.setPerspective(this.near,t,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,t),this},t.prototype.setViewOffset=function(t,e,i,a,s,n){return this.aspect=t/e,void 0===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=a,this.view.width=s,this.view.height=n,this.projectionMode===Gi.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this},t.prototype.clearViewOffset=function(){return void 0!==this.view&&(this.view.enabled=!1),this.projectionMode===Gi.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this},t.prototype.setZoom=function(t){return this.zoom=t,this.projectionMode===Gi.ORTHOGRAPHIC?this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far):this.projectionMode===Gi.PERSPECTIVE&&this.setPerspective(this.near,this.far,this.fov,this.aspect),this},t.prototype.setZoomByViewportPoint=function(t,e){var i=this.canvas.viewport2Canvas({x:e[0],y:e[1]}),a=i.x,s=i.y,n=this.roll;this.rotate(0,0,-n),this.setPosition(a,s),this.setFocalPoint(a,s),this.setZoom(t),this.rotate(0,0,n);var o=this.canvas.viewport2Canvas({x:e[0],y:e[1]}),r=it(o.x-a,o.y-s,0),l=ct(r,this.right)/et(this.right),c=ct(r,this.up)/et(this.up);return this.pan(-l,-c),this},t.prototype.setPerspective=function(t,e,i,a){var s;this.projectionMode=Gi.PERSPECTIVE,this.fov=i,this.near=t,this.far=e,this.aspect=a;var n=this.near*Math.tan(Ci(.5*this.fov))/this.zoom,o=2*n,r=this.aspect*o,l=-.5*r;if(null===(s=this.view)||void 0===s?void 0:s.enabled){var c=this.view.fullWidth,d=this.view.fullHeight;l+=this.view.offsetX*r/c,n-=this.view.offsetY*o/d,r*=this.view.width/c,o*=this.view.height/d}return function(t,e,i,a,s,n,o,r){void 0===r&&(r=!1);var l,c,d=2*n/(i-e),h=2*n/(a-s),u=(i+e)/(i-e),p=(a+s)/(a-s);r?(l=-o/(o-n),c=-o*n/(o-n)):(l=-(o+n)/(o-n),c=-2*o*n/(o-n)),t[0]=d,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=u,t[9]=p,t[10]=l,t[11]=-1,t[12]=0,t[13]=0,t[14]=c,t[15]=0}(this.projectionMatrix,l,l+r,n,n-o,t,this.far,this.clipSpaceNearZ===fi.ZERO),L(this.projectionMatrix,this.projectionMatrix,it(1,-1,1)),T(this.projectionMatrixInverse,this.projectionMatrix),this.triggerUpdate(),this},t.prototype.setOrthographic=function(t,e,i,a,s,n){var o;this.projectionMode=Gi.ORTHOGRAPHIC,this.rright=e,this.left=t,this.top=i,this.bottom=a,this.near=s,this.far=n;var r=(this.rright-this.left)/(2*this.zoom),l=(this.top-this.bottom)/(2*this.zoom),c=(this.rright+this.left)/2,d=(this.top+this.bottom)/2,h=c-r,u=c+r,p=d+l,m=d-l;if(null===(o=this.view)||void 0===o?void 0:o.enabled){var f=(this.rright-this.left)/this.view.fullWidth/this.zoom,g=(this.top-this.bottom)/this.view.fullHeight/this.zoom;u=(h+=f*this.view.offsetX)+f*this.view.width,m=(p-=g*this.view.offsetY)-g*this.view.height}return this.clipSpaceNearZ===fi.NEGATIVE_ONE?V(this.projectionMatrix,h,u,m,p,s,n):W(this.projectionMatrix,h,u,m,p,s,n),L(this.projectionMatrix,this.projectionMatrix,it(1,-1,1)),T(this.projectionMatrixInverse,this.projectionMatrix),this._getOrthoMatrix(),this.triggerUpdate(),this},t.prototype.setPosition=function(t,e,i){void 0===e&&(e=this.position[1]),void 0===i&&(i=this.position[2]);var a=Si(t,e,i);return this._setPosition(a),this.setFocalPoint(this.focalPoint),this.triggerUpdate(),this},t.prototype.setFocalPoint=function(t,e,i){void 0===e&&(e=this.focalPoint[1]),void 0===i&&(i=this.focalPoint[2]);var a=it(0,1,0);if(this.focalPoint=Si(t,e,i),this.trackingMode===qi.CINEMATIC){var s=ot(Z(),this.focalPoint,this.position);t=s[0],e=s[1],i=s[2];var n=et(s),o=Ii(Math.asin(e/n)),r=90+Ii(Math.atan2(i,t)),l=A();D(l,l,Ci(r)),R(l,l,Ci(o)),a=ht(Z(),[0,1,0],l)}return T(this.matrix,H(A(),this.position,this.focalPoint,a)),this._getAxes(),this._getDistance(),this._getAngles(),this.triggerUpdate(),this},t.prototype.getDistance=function(){return this.distance},t.prototype.getDistanceVector=function(){return this.distanceVector},t.prototype.setDistance=function(t){if(this.distance===t||t<0)return this;this.distance=t,this.distance<Ji&&(this.distance=Ji),this.dollyingStep=this.distance/100;var e=Z();t=this.distance;var i=this.forward,a=this.focalPoint;return e[0]=t*i[0]+a[0],e[1]=t*i[1]+a[1],e[2]=t*i[2]+a[2],this._setPosition(e),this.triggerUpdate(),this},t.prototype.setMaxDistance=function(t){return this.maxDistance=t,this},t.prototype.setMinDistance=function(t){return this.minDistance=t,this},t.prototype.setAzimuth=function(t){return this.azimuth=wi(t),this.computeMatrix(),this._getAxes(),this.type===$i.ORBITING||this.type===$i.EXPLORING?this._getPosition():this.type===$i.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this},t.prototype.getAzimuth=function(){return this.azimuth},t.prototype.setElevation=function(t){return this.elevation=wi(t),this.computeMatrix(),this._getAxes(),this.type===$i.ORBITING||this.type===$i.EXPLORING?this._getPosition():this.type===$i.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this},t.prototype.getElevation=function(){return this.elevation},t.prototype.setRoll=function(t){return this.roll=wi(t),this.computeMatrix(),this._getAxes(),this.type===$i.ORBITING||this.type===$i.EXPLORING?this._getPosition():this.type===$i.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this},t.prototype.getRoll=function(){return this.roll},t.prototype._update=function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles(),this._getOrthoMatrix(),this.triggerUpdate()},t.prototype.computeMatrix=function(){var t=vt(yt(),[0,0,1],Ci(this.roll));I(this.matrix);var e=vt(yt(),[1,0,0],Ci((this.rotateWorld&&this.type!==$i.TRACKING||this.type===$i.TRACKING?1:-1)*this.elevation)),i=vt(yt(),[0,1,0],Ci((this.rotateWorld&&this.type!==$i.TRACKING||this.type===$i.TRACKING?1:-1)*this.azimuth)),a=bt(yt(),i,e);a=bt(yt(),a,t);var s=j(A(),a);this.type===$i.ORBITING||this.type===$i.EXPLORING?(O(this.matrix,this.matrix,this.focalPoint),P(this.matrix,this.matrix,s),O(this.matrix,this.matrix,[0,0,this.distance])):this.type===$i.TRACKING&&(O(this.matrix,this.matrix,this.position),P(this.matrix,this.matrix,s))},t.prototype._setPosition=function(t,e,i){this.position=Si(t,e,i);var a=this.matrix;a[12]=this.position[0],a[13]=this.position[1],a[14]=this.position[2],a[15]=1,this._getOrthoMatrix()},t.prototype._getAxes=function(){at(this.right,Si(_t(gt(),[1,0,0,0],this.matrix))),at(this.up,Si(_t(gt(),[0,1,0,0],this.matrix))),at(this.forward,Si(_t(gt(),[0,0,1,0],this.matrix))),lt(this.right,this.right),lt(this.up,this.up),lt(this.forward,this.forward)},t.prototype._getAngles=function(){var t=this.distanceVector[0],e=this.distanceVector[1],i=this.distanceVector[2],a=et(this.distanceVector);if(0===a)return this.elevation=0,void(this.azimuth=0);this.type===$i.TRACKING||this.rotateWorld?(this.elevation=Ii(Math.asin(e/a)),this.azimuth=Ii(Math.atan2(-t,-i))):(this.elevation=-Ii(Math.asin(e/a)),this.azimuth=-Ii(Math.atan2(-t,-i)))},t.prototype._getPosition=function(){at(this.position,Si(_t(gt(),[0,0,0,1],this.matrix))),this._getDistance()},t.prototype._getFocalPoint=function(){var t,e;!function(t,e,i){var a=e[0],s=e[1],n=e[2];t[0]=a*i[0]+s*i[3]+n*i[6],t[1]=a*i[1]+s*i[4]+n*i[7],t[2]=a*i[2]+s*i[5]+n*i[8]}(this.distanceVector,[0,0,-this.distance],(t=E(),e=this.matrix,t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t)),nt(this.focalPoint,this.position,this.distanceVector),this._getDistance()},t.prototype._getDistance=function(){this.distanceVector=ot(Z(),this.focalPoint,this.position),this.distance=et(this.distanceVector),this.dollyingStep=this.distance/100},t.prototype._getOrthoMatrix=function(){if(this.projectionMode===Gi.ORTHOGRAPHIC){var t=this.position,e=vt(yt(),[0,0,1],-this.roll*Math.PI/180);B(this.orthoMatrix,e,it((this.rright-this.left)/2-t[0],(this.top-this.bottom)/2-t[1],0),it(this.zoom,this.zoom,1),t)}},t.prototype.triggerUpdate=function(){if(this.enableUpdate){var t=this.getViewTransform(),e=P(A(),this.getPerspective(),t);this.getFrustum().extractFromVPMatrix(e),this.eventEmitter.emit(Xi)}},t.prototype.rotate=function(t,e,i){throw new Error(Yi)},t.prototype.pan=function(t,e){throw new Error(Yi)},t.prototype.dolly=function(t){throw new Error(Yi)},t.prototype.createLandmark=function(t,e){throw new Error(Yi)},t.prototype.gotoLandmark=function(t,e){throw new Error(Yi)},t.prototype.cancelLandmarkAnimation=function(){throw new Error(Yi)},t}();function ta(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var i=function(){for(var a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];var n=e?e.apply(this,a):a[0],o=i.cache;if(o.has(n))return o.get(n);var r=t.apply(this,a);return i.cache=o.set(n,r)||o,r};return i.cache=new(ta.Cache||Map),i}ta.Cache=Map,function(t){t[t.kUnknown=0]="kUnknown",t[t.kNumber=1]="kNumber",t[t.kPercentage=2]="kPercentage",t[t.kEms=3]="kEms",t[t.kPixels=4]="kPixels",t[t.kRems=5]="kRems",t[t.kDegrees=6]="kDegrees",t[t.kRadians=7]="kRadians",t[t.kGradians=8]="kGradians",t[t.kTurns=9]="kTurns",t[t.kMilliseconds=10]="kMilliseconds",t[t.kSeconds=11]="kSeconds",t[t.kInteger=12]="kInteger"}(Vi||(Vi={})),function(t){t[t.kUNumber=0]="kUNumber",t[t.kUPercent=1]="kUPercent",t[t.kULength=2]="kULength",t[t.kUAngle=3]="kUAngle",t[t.kUTime=4]="kUTime",t[t.kUOther=5]="kUOther"}(Wi||(Wi={})),function(t){t[t.kAll=0]="kAll",t[t.kNonNegative=1]="kNonNegative",t[t.kInteger=2]="kInteger",t[t.kNonNegativeInteger=3]="kNonNegativeInteger",t[t.kPositiveInteger=4]="kPositiveInteger"}(Hi||(Hi={})),function(t){t[t.kYes=0]="kYes",t[t.kNo=1]="kNo"}(Ki||(Ki={})),function(t){t[t.kYes=0]="kYes",t[t.kNo=1]="kNo"}(Qi||(Qi={}));var ea,ia=[{name:"em",unit_type:Vi.kEms},{name:"px",unit_type:Vi.kPixels},{name:"deg",unit_type:Vi.kDegrees},{name:"rad",unit_type:Vi.kRadians},{name:"grad",unit_type:Vi.kGradians},{name:"ms",unit_type:Vi.kMilliseconds},{name:"s",unit_type:Vi.kSeconds},{name:"rem",unit_type:Vi.kRems},{name:"turn",unit_type:Vi.kTurns}];!function(t){t[t.kUnknownType=0]="kUnknownType",t[t.kUnparsedType=1]="kUnparsedType",t[t.kKeywordType=2]="kKeywordType",t[t.kUnitType=3]="kUnitType",t[t.kSumType=4]="kSumType",t[t.kProductType=5]="kProductType",t[t.kNegateType=6]="kNegateType",t[t.kInvertType=7]="kInvertType",t[t.kMinType=8]="kMinType",t[t.kMaxType=9]="kMaxType",t[t.kClampType=10]="kClampType",t[t.kTransformType=11]="kTransformType",t[t.kPositionType=12]="kPositionType",t[t.kURLImageType=13]="kURLImageType",t[t.kColorType=14]="kColorType",t[t.kUnsupportedColorType=15]="kUnsupportedColorType"}(ea||(ea={}));var aa,sa=function(t){var e=1;switch(t){case Vi.kPixels:case Vi.kDegrees:case Vi.kSeconds:break;case Vi.kMilliseconds:e=.001;break;case Vi.kRadians:e=180/Math.PI;break;case Vi.kGradians:e=.9;break;case Vi.kTurns:e=360}return e},na=function(t){switch(t){case Vi.kNumber:case Vi.kInteger:return"";case Vi.kPercentage:return"%";case Vi.kEms:return"em";case Vi.kRems:return"rem";case Vi.kPixels:return"px";case Vi.kDegrees:return"deg";case Vi.kRadians:return"rad";case Vi.kGradians:return"grad";case Vi.kMilliseconds:return"ms";case Vi.kSeconds:return"s";case Vi.kTurns:return"turn"}return""},oa=function(){function t(){}return t.isAngle=function(t){return t===Vi.kDegrees||t===Vi.kRadians||t===Vi.kGradians||t===Vi.kTurns},t.isLength=function(t){return t>=Vi.kEms&&t<Vi.kDegrees},t.isRelativeUnit=function(t){return t===Vi.kPercentage||t===Vi.kEms||t===Vi.kRems},t.isTime=function(t){return t===Vi.kSeconds||t===Vi.kMilliseconds},t.prototype.toString=function(){return this.buildCSSText(Ki.kNo,Qi.kNo,"")},t.prototype.isNumericValue=function(){return this.getType()>=ea.kUnitType&&this.getType()<=ea.kClampType},t}(),ra=function(t){function e(e){var i=t.call(this)||this;return i.colorSpace=e,i}return o(e,t),e.prototype.getType=function(){return ea.kColorType},e.prototype.to=function(t){return this},e}(oa);!function(t){t[t.Constant=0]="Constant",t[t.LinearGradient=1]="LinearGradient",t[t.RadialGradient=2]="RadialGradient"}(aa||(aa={}));var la=function(t){function e(e,i){var a=t.call(this)||this;return a.type=e,a.value=i,a}return o(e,t),e.prototype.clone=function(){return new e(this.type,this.value)},e.prototype.buildCSSText=function(t,e,i){return i},e.prototype.getType=function(){return ea.kColorType},e}(oa),ca=function(t){function e(e){var i=t.call(this)||this;return i.value=e,i}return o(e,t),e.prototype.clone=function(){return new e(this.value)},e.prototype.getType=function(){return ea.kKeywordType},e.prototype.buildCSSText=function(t,e,i){return i+this.value},e}(oa),da=ta(function(t){return void 0===t&&(t=""),t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})}),ha=function(t){return t.split("").map(function(t,e){return t.toUpperCase()===t?"".concat(0!==e?"-":"").concat(t.toLowerCase()):t}).join("")};function ua(t){return"function"==typeof t}var pa={d:{alias:"path"},strokeDasharray:{alias:"lineDash"},strokeWidth:{alias:"lineWidth"},textAnchor:{alias:"textAlign"},src:{alias:"img"}},ma=ta(function(t){var e=da(t),i=pa[e];return(null==i?void 0:i.alias)||e}),fa=function(t){return function(t){switch(t){case Wi.kUNumber:return Vi.kNumber;case Wi.kULength:return Vi.kPixels;case Wi.kUPercent:return Vi.kPercentage;case Wi.kUTime:return Vi.kSeconds;case Wi.kUAngle:return Vi.kDegrees;default:return Vi.kUnknown}}(function(t){switch(t){case Vi.kNumber:case Vi.kInteger:return Wi.kUNumber;case Vi.kPercentage:return Wi.kUPercent;case Vi.kPixels:return Wi.kULength;case Vi.kMilliseconds:case Vi.kSeconds:return Wi.kUTime;case Vi.kDegrees:case Vi.kRadians:case Vi.kGradians:case Vi.kTurns:return Wi.kUAngle;default:return Wi.kUOther}}(t))},ga=function(t){function e(e,i){void 0===i&&(i=Vi.kNumber);var a,s=t.call(this)||this;return a="string"==typeof i?function(t){return t?"number"===t?Vi.kNumber:"percent"===t||"%"===t?Vi.kPercentage:function(t){return ia.find(function(e){return e.name===t}).unit_type}(t):Vi.kUnknown}(i):i,s.unit=a,s.value=e,s}return o(e,t),e.prototype.clone=function(){return new e(this.value,this.unit)},e.prototype.equals=function(t){var e=t;return this.value===e.value&&this.unit===e.unit},e.prototype.getType=function(){return ea.kUnitType},e.prototype.convertTo=function(t){if(this.unit===t)return new e(this.value,this.unit);var i=fa(this.unit);if(i!==fa(t)||i===Vi.kUnknown)return null;var a=sa(this.unit)/sa(t);return new e(this.value*a,t)},e.prototype.buildCSSText=function(t,e,i){var a;switch(this.unit){case Vi.kUnknown:break;case Vi.kInteger:a=Number(this.value).toFixed(0);break;case Vi.kNumber:case Vi.kPercentage:case Vi.kEms:case Vi.kRems:case Vi.kPixels:case Vi.kDegrees:case Vi.kRadians:case Vi.kGradians:case Vi.kMilliseconds:case Vi.kSeconds:case Vi.kTurns:var s=this.value,n=na(this.unit);if(s<-999999||s>999999){var o=na(this.unit);a=!Number.isFinite(s)||Number.isNaN(s)?function(t,e){void 0===e&&(e="");var i="";return Number.isFinite(t)?(function(t){if(!t)throw new Error}(Number.isNaN(t)),i="NaN"):i=t>0?"infinity":"-infinity",i+e}(s,o):s+(o||"")}else a="".concat(s).concat(n)}return i+a},e}(oa),_a=new ga(0,"px");new ga(1,"px");var ya,va,ba=new ga(0,"deg"),Ea=function(t){function e(e,i,a,s,n){void 0===s&&(s=1),void 0===n&&(n=!1);var o=t.call(this,"rgb")||this;return o.r=e,o.g=i,o.b=a,o.alpha=s,o.isNone=n,o}return o(e,t),e.prototype.clone=function(){return new e(this.r,this.g,this.b,this.alpha)},e.prototype.buildCSSText=function(t,e,i){return i+"rgba(".concat(this.r,",").concat(this.g,",").concat(this.b,",").concat(this.alpha,")")},e}(ra),Aa=new ca("unset"),wa=new ca("initial"),Sa=new ca("inherit"),Ca={"":Aa,unset:Aa,initial:wa,inherit:Sa},Ia=function(t){return Ca[t]||(Ca[t]=new ca(t)),Ca[t]},xa=new Ea(0,0,0,0,!0),Ta=new Ea(0,0,0,0),Ma=ta(function(t,e,i,a){return new Ea(t,e,i,a)},function(t,e,i,a){return"rgba(".concat(t,",").concat(e,",").concat(i,",").concat(a,")")}),Pa=function(t,e){return void 0===e&&(e=Vi.kNumber),new ga(t,e)},Oa=new ga(50,"%");!function(t){t[t.Standard=0]="Standard"}(ya||(ya={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED",t[t.Z_INDEX_CHANGED=2]="Z_INDEX_CHANGED"}(va||(va={}));var La,Ra={absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:new Ui(0,0,0,0)};function Da(t){var e=t.type,i=t.value;return"hex"===e?"#".concat(i):"literal"===e?i:"rgb"===e?"rgb(".concat(i.join(","),")"):"rgba(".concat(i.join(","),")")}!function(t){t.COORDINATE="<coordinate>",t.COLOR="<color>",t.PAINT="<paint>",t.NUMBER="<number>",t.ANGLE="<angle>",t.OPACITY_VALUE="<opacity-value>",t.SHADOW_BLUR="<shadow-blur>",t.LENGTH="<length>",t.PERCENTAGE="<percentage>",t.LENGTH_PERCENTAGE="<length> | <percentage>",t.LENGTH_PERCENTAGE_12="[<length> | <percentage>]{1,2}",t.LENGTH_PERCENTAGE_14="[<length> | <percentage>]{1,4}",t.LIST_OF_POINTS="<list-of-points>",t.PATH="<path>",t.FILTER="<filter>",t.Z_INDEX="<z-index>",t.OFFSET_DISTANCE="<offset-distance>",t.DEFINED_PATH="<defined-path>",t.MARKER="<marker>",t.TRANSFORM="<transform>",t.TRANSFORM_ORIGIN="<transform-origin>",t.TEXT="<text>",t.TEXT_TRANSFORM="<text-transform>"}(La||(La={}));var Na=function(){var t=/^(linear\-gradient)/i,e=/^(repeating\-linear\-gradient)/i,i=/^(radial\-gradient)/i,a=/^(repeating\-radial\-gradient)/i,s=/^(conic\-gradient)/i,n=/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,o=/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,r=/^(left|center|right|top|bottom)/i,l=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,c=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,d=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,h=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,u=/^\(/,p=/^\)/,m=/^,/,f=/^\#([0-9a-fA-F]+)/,g=/^([a-zA-Z]+)/,_=/^rgb/i,y=/^rgba/i,v=/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/,b="";function E(t){throw new Error(b+": "+t)}function A(){return w("linear-gradient",t,C)||w("repeating-linear-gradient",e,C)||w("radial-gradient",i,I)||w("repeating-radial-gradient",a,I)||w("conic-gradient",s,I)}function w(t,e,i){return S(e,function(e){var a=i();return a&&(F(m)||E("Missing comma before color stops")),{type:t,orientation:a,colorStops:O(L)}})}function S(t,e){var i=F(t);if(i){F(u)||E("Missing (");var a=e(i);return F(p)||E("Missing )"),a}}function C(){return k("directional",n,1)||k("angular",h,1)}function I(){var t,e,i=x();return i&&((t=[]).push(i),e=b,F(m)&&((i=x())?t.push(i):b=e)),t}function x(){var t=function(){var t=k("shape",/^(circle)/i,0);return t&&(t.style=N()||T()),t}()||function(){var t=k("shape",/^(ellipse)/i,0);return t&&(t.style=D()||T()),t}();if(t)t.at=M();else{var e=T();if(e){t=e;var i=M();i&&(t.at=i)}else{var a=P();a&&(t={type:"default-radial",at:a})}}return t}function T(){return k("extent-keyword",o,1)}function M(){if(k("position",/^at/,0)){var t=P();return t||E("Missing positioning value"),t}}function P(){var t={x:D(),y:D()};if(t.x||t.y)return{type:"position",value:t}}function O(t){var e=t(),i=[];if(e)for(i.push(e);F(m);)(e=t())?i.push(e):E("One extra comma");return i}function L(){var t=k("hex",f,1)||S(y,function(){return{type:"rgba",value:O(R)}})||S(_,function(){return{type:"rgb",value:O(R)}})||k("literal",g,0);return t||E("Expected color definition"),t.length=D(),t}function R(){return F(v)[1]}function D(){return k("%",c,1)||k("position-keyword",r,1)||N()}function N(){return k("px",l,1)||k("em",d,1)}function k(t,e,i){var a=F(e);if(a)return{type:t,value:a[i]}}function F(t){var e=/^[\n\r\t\s]+/.exec(b);e&&$(e[0].length);var i=t.exec(b);return i&&$(i[0].length),i}function $(t){b=b.substring(t)}return function(t){return b=t,function(){var t=O(A);return b.length>0&&E("Invalid input not EOF"),t}()}}();var ka=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,Fa=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,$a=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,qa=/[\d.]+:(#[^\s]+|[^\)]+\))/gi,Ga={left:180,top:-90,bottom:90,right:0,"left top":225,"top left":225,"left bottom":135,"bottom left":135,"right top":-45,"top right":-45,"right bottom":45,"bottom right":45},Ba=ta(function(t){var e;return e="angular"===t.type?Number(t.value):Ga[t.value]||0,Pa(e,"deg")}),ja=ta(function(t){var e=50,i=50,a="%",s="%";if("position"===(null==t?void 0:t.type)){var n=t.value,o=n.x,r=n.y;"position-keyword"===(null==o?void 0:o.type)&&("left"===o.value?e=0:"center"===o.value?e=50:"right"===o.value?e=100:"top"===o.value?i=0:"bottom"===o.value&&(i=100)),"position-keyword"===(null==r?void 0:r.type)&&("left"===r.value?e=0:"center"===r.value?i=50:"right"===r.value?e=100:"top"===r.value?i=0:"bottom"===r.value&&(i=100)),"px"!==(null==o?void 0:o.type)&&"%"!==(null==o?void 0:o.type)&&"em"!==(null==o?void 0:o.type)||(a=null==o?void 0:o.type,e=Number(o.value)),"px"!==(null==r?void 0:r.type)&&"%"!==(null==r?void 0:r.type)&&"em"!==(null==r?void 0:r.type)||(s=null==r?void 0:r.type,i=Number(r.value))}return{cx:Pa(e,a),cy:Pa(i,s)}}),Ua=ta(function(t){var e;if(t.indexOf("linear")>-1||t.indexOf("radial")>-1)return Na(t).map(function(t){var e=t.type,i=t.orientation,a=t.colorStops;!function(t){var e,i,a,s=t.length;t[s-1].length=null!==(e=t[s-1].length)&&void 0!==e?e:{type:"%",value:"100"},s>1&&(t[0].length=null!==(i=t[0].length)&&void 0!==i?i:{type:"%",value:"0"});for(var n=0,o=Number(t[0].length.value),r=1;r<s;r++){var l=null===(a=t[r].length)||void 0===a?void 0:a.value;if(!le(l)&&!le(o)){for(var c=1;c<r-n;c++)t[n+c].length={type:"%",value:"".concat(o+(Number(l)-o)*c/(r-n))};n=r,o=Number(l)}}}(a);var s=a.map(function(t){return{offset:Pa(Number(t.length.value),"%"),color:Da(t)}});if("linear-gradient"===e)return new la(aa.LinearGradient,{angle:i?Ba(i):ba,steps:s});if("radial-gradient"===e&&(i||(i=[{type:"shape",value:"circle"}]),"shape"===i[0].type&&"circle"===i[0].value)){var n=ja(i[0].at),o=n.cx,r=n.cy,l=void 0;if(i[0].style){var c=i[0].style,d=c.type,h=c.value;l="extent-keyword"===d?Ia(h):Pa(h,d)}return new la(aa.RadialGradient,{cx:o,cy:r,size:l,steps:s})}});var i=t[0];if("("===t[1]||"("===t[2])if("l"===i){var a=ka.exec(t);if(a){var s=(null===(e=a[2].match(qa))||void 0===e?void 0:e.map(function(t){return t.split(":")}))||[];return[new la(aa.LinearGradient,{angle:Pa(parseFloat(a[1]),"deg"),steps:s.map(function(t){var e=u(t,2),i=e[0],a=e[1];return{offset:Pa(100*Number(i),"%"),color:a}})})]}}else if("r"===i){var n=function(t){var e,i=Fa.exec(t);if(i){var a=(null===(e=i[4].match(qa))||void 0===e?void 0:e.map(function(t){return t.split(":")}))||[];return{cx:Pa(50,"%"),cy:Pa(50,"%"),steps:a.map(function(t){var e=u(t,2),i=e[0],a=e[1];return{offset:Pa(100*Number(i),"%"),color:a}})}}return null}(t);if(n){if(!fe(n))return[new la(aa.RadialGradient,n)];t=n}}else if("p"===i)return function(t){var e=$a.exec(t);if(e){var i=e[1],a=e[2];switch(i){case"a":i="repeat";break;case"x":i="repeat-x";break;case"y":i="repeat-y";break;default:i="no-repeat"}return{image:a,repetition:i}}return null}(t)});function Ya(t){return t&&!!t.image}function za(t){return t&&!le(t.r)&&!le(t.g)&&!le(t.b)}var Va=ta(function(t){if(Ya(t))return r({repetition:"repeat"},t);if(le(t)&&(t=""),"transparent"===t)return Ta;"currentColor"===t&&(t="black");var e=Ua(t);if(e)return e;var i=Ge(t),a=[0,0,0,0];return null!==i&&(a[0]=i.r||0,a[1]=i.g||0,a[2]=i.b||0,a[3]=i.opacity),Ma.apply(void 0,p([],u(a),!1))});function Wa(t,e){if(za(t)&&za(e))return[[Number(t.r),Number(t.g),Number(t.b),Number(t.alpha)],[Number(e.r),Number(e.g),Number(e.b),Number(e.alpha)],function(t){var e=t.slice();if(e[3])for(var i=0;i<3;i++)e[i]=Math.round(ge(e[i],0,255));return e[3]=ge(e[3],0,1),"rgba(".concat(e.join(","),")")}]}function Ha(t,e){if(le(e))return Pa(0,"px");if(e="".concat(e).trim().toLowerCase(),isFinite(Number(e))){if("px".search(t)>=0)return Pa(Number(e),"px");if("deg".search(t)>=0)return Pa(Number(e),"deg")}var i=[];e=e.replace(t,function(t){return i.push(t),"U"+t});var a="U("+t.source+")";return i.map(function(t){return Pa(Number(e.replace(new RegExp("U"+t,"g"),"").replace(new RegExp(a,"g"),"*0")),t)})[0]}var Ka=function(t){return Ha(new RegExp("px","g"),t)},Qa=ta(Ka);ta(function(t){return Ha(new RegExp("%","g"),t)});var Xa=function(t){return _e(t)||isFinite(Number(t))?Pa(Number(t)||0,"px"):Ha(new RegExp("px|%|em|rem","g"),t)},Ja=ta(Xa),Za=function(t){return Ha(new RegExp("deg|rad|grad|turn","g"),t)},ts=ta(Za);function es(t,e,i,a,s){void 0===s&&(s=0);var n="",o=t.value||0,r=e.value||0,l=fa(t.unit),c=t.convertTo(l),d=e.convertTo(l);return c&&d?(o=c.value,r=d.value,n=na(t.unit)):(ga.isLength(t.unit)||ga.isLength(e.unit))&&(o=ns(t,s,i),r=ns(e,s,i),n="px"),[o,r,function(t){return a&&(t=Math.max(t,0)),t+n}]}function is(t){var e=0;return t.unit===Vi.kDegrees?e=t.value:t.unit===Vi.kRadians?e=Ii(Number(t.value)):t.unit===Vi.kTurns&&(e=function(t){return 360*t}(Number(t.value))),e}function as(t,e){var i;return Array.isArray(t)?i=t.map(function(t){return Number(t)}):fe(t)?i=t.split(" ").map(function(t){return Number(t)}):_e(t)&&(i=[t]),2===e?1===i.length?[i[0],i[0]]:[i[0],i[1]]:1===i.length?[i[0],i[0],i[0],i[0]]:2===i.length?[i[0],i[1],i[0],i[1]]:3===i.length?[i[0],i[1],i[2],i[1]]:[i[0],i[1],i[2],i[3]]}function ss(t){return fe(t)?t.split(" ").map(function(t){return Ja(t)}):t.map(function(t){return Ja(t.toString())})}function ns(t,e,i){if(0===t.value)return 0;if(t.unit===Vi.kPixels)return Number(t.value);if(t.unit===Vi.kPercentage&&i){var a=i.nodeName===mi.GROUP?i.getLocalBounds():i.geometry.contentBounds;return t.value/100*a.halfExtents[e]*2}return 0}var os=function(t){return Ha(/deg|rad|grad|turn|px|%/g,t)},rs=["blur","brightness","drop-shadow","contrast","grayscale","sepia","saturate","hue-rotate","invert"];function ls(t){if(void 0===t&&(t=""),"none"===(t=t.toLowerCase().trim()))return[];for(var e,i=/\s*([\w-]+)\(([^)]*)\)/g,a=[],s=0;e=i.exec(t);){if(e.index!==s)return[];if(s=e.index+e[0].length,rs.indexOf(e[1])>-1&&a.push({name:e[1],params:e[2].split(" ").map(function(t){return os(t)||Va(t)})}),i.lastIndex===t.length)return a}return[]}function cs(t){return t.toString()}var ds=function(t){return"number"==typeof t?Pa(t):/^\s*[-+]?(\d*\.)?\d+\s*$/.test(t)?Pa(Number(t)):Pa(0)},hs=ta(ds);function us(t,e){return[t,e,cs]}function ps(t,e){return function(i,a){return[i,a,function(i){return cs(ge(i,t,e))}]}}function ms(t,e){if(t.length===e.length)return[t,e,function(t){return t}]}function fs(t){return 0===t.parsedStyle.path.totalLength&&(t.parsedStyle.path.totalLength=se(t.parsedStyle.path.absolutePath,void 0,r(r({},undefined),{bbox:!1,length:!0})).length),t.parsedStyle.path.totalLength}function gs(t,e){return t[0]===e[0]&&t[1]===e[1]}function _s(t,e){var i=t.prePoint,a=t.currentPoint,s=t.nextPoint,n=Math.pow(a[0]-i[0],2)+Math.pow(a[1]-i[1],2),o=Math.pow(a[0]-s[0],2)+Math.pow(a[1]-s[1],2),r=Math.pow(i[0]-s[0],2)+Math.pow(i[1]-s[1],2),l=Math.acos((n+o-r)/(2*Math.sqrt(n)*Math.sqrt(o)));if(!l||0===Math.sin(l)||ye(l,0))return{xExtra:0,yExtra:0};var c=Math.abs(Math.atan2(s[1]-a[1],s[0]-a[0])),d=Math.abs(Math.atan2(s[0]-a[0],s[1]-a[1]));return c=c>Math.PI/2?Math.PI-c:c,d=d>Math.PI/2?Math.PI-d:d,{xExtra:Math.cos(l/2-c)*(e/2*(1/Math.sin(l/2)))-e/2||0,yExtra:Math.cos(d-l/2)*(e/2*(1/Math.sin(l/2)))-e/2||0}}function ys(t,e){return[e[0]+(e[0]-t[0]),e[1]+(e[1]-t[1])]}ta(function(t){return fe(t)?t.split(" ").map(hs):t.map(hs)});var vs=function(t,e){var i=t.x*e.x+t.y*e.y,a=Math.sqrt((Math.pow(t.x,2)+Math.pow(t.y,2))*(Math.pow(e.x,2)+Math.pow(e.y,2)));return(t.x*e.y-t.y*e.x<0?-1:1)*Math.acos(i/a)},bs=function(t,e,i,a,s,n,o,r){e=Math.abs(e),i=Math.abs(i);var l=Ci(a=ve(a,360));if(t.x===o.x&&t.y===o.y)return{x:t.x,y:t.y,ellipticalArcAngle:0};if(0===e||0===i)return{x:0,y:0,ellipticalArcAngle:0};var c=(t.x-o.x)/2,d=(t.y-o.y)/2,h={x:Math.cos(l)*c+Math.sin(l)*d,y:-Math.sin(l)*c+Math.cos(l)*d},u=Math.pow(h.x,2)/Math.pow(e,2)+Math.pow(h.y,2)/Math.pow(i,2);u>1&&(e=Math.sqrt(u)*e,i=Math.sqrt(u)*i);var p=(Math.pow(e,2)*Math.pow(i,2)-Math.pow(e,2)*Math.pow(h.y,2)-Math.pow(i,2)*Math.pow(h.x,2))/(Math.pow(e,2)*Math.pow(h.y,2)+Math.pow(i,2)*Math.pow(h.x,2));p=p<0?0:p;var m=(s!==n?1:-1)*Math.sqrt(p),f=m*(e*h.y/i),g=m*(-i*h.x/e),_={x:Math.cos(l)*f-Math.sin(l)*g+(t.x+o.x)/2,y:Math.sin(l)*f+Math.cos(l)*g+(t.y+o.y)/2},y={x:(h.x-f)/e,y:(h.y-g)/i},v=vs({x:1,y:0},y),b=vs(y,{x:(-h.x-f)/e,y:(-h.y-g)/i});!n&&b>0?b-=2*Math.PI:n&&b<0&&(b+=2*Math.PI);var E=v+(b%=2*Math.PI)*r,A=e*Math.cos(E),w=i*Math.sin(E);return{x:Math.cos(l)*A-Math.sin(l)*w+_.x,y:Math.sin(l)*A+Math.cos(l)*w+_.y,ellipticalArcStartAngle:v,ellipticalArcEndAngle:v+b,ellipticalArcAngle:E,ellipticalArcCenter:_,resultantRx:e,resultantRy:i}};function Es(t,e,i){void 0===i&&(i=!0);var a=t.arcParams,s=a.rx,n=void 0===s?0:s,o=a.ry,r=void 0===o?0:o,l=a.xRotation,c=a.arcFlag,d=a.sweepFlag,h=bs({x:t.prePoint[0],y:t.prePoint[1]},n,r,l,!!c,!!d,{x:t.currentPoint[0],y:t.currentPoint[1]},e),u=bs({x:t.prePoint[0],y:t.prePoint[1]},n,r,l,!!c,!!d,{x:t.currentPoint[0],y:t.currentPoint[1]},i?e+.005:e-.005),p=u.x-h.x,m=u.y-h.y,f=Math.sqrt(p*p+m*m);return{x:-p/f,y:-m/f}}function As(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function ws(t,e){return As(t)*As(e)?(t[0]*e[0]+t[1]*e[1])/(As(t)*As(e)):1}function Ss(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(ws(t,e))}function Cs(t,e){var i=e[1],a=e[2],s=ve(Ci(e[3]),2*Math.PI),n=e[4],o=e[5],r=t[0],l=t[1],c=e[6],d=e[7],h=Math.cos(s)*(r-c)/2+Math.sin(s)*(l-d)/2,u=-1*Math.sin(s)*(r-c)/2+Math.cos(s)*(l-d)/2,p=h*h/(i*i)+u*u/(a*a);p>1&&(i*=Math.sqrt(p),a*=Math.sqrt(p));var m=i*i*(u*u)+a*a*(h*h),f=m?Math.sqrt((i*i*(a*a)-m)/m):1;n===o&&(f*=-1),isNaN(f)&&(f=0);var g=a?f*i*u/a:0,_=i?f*-a*h/i:0,y=(r+c)/2+Math.cos(s)*g-Math.sin(s)*_,v=(l+d)/2+Math.sin(s)*g+Math.cos(s)*_,b=[(h-g)/i,(u-_)/a],E=[(-1*h-g)/i,(-1*u-_)/a],A=Ss([1,0],b),w=Ss(b,E);return ws(b,E)<=-1&&(w=Math.PI),ws(b,E)>=1&&(w=0),0===o&&w>0&&(w-=2*Math.PI),1===o&&w<0&&(w+=2*Math.PI),{cx:y,cy:v,rx:gs(t,[c,d])?0:i,ry:gs(t,[c,d])?0:a,startAngle:A,endAngle:A+w,xRotation:s,arcFlag:n,sweepFlag:o}}var Is=function(t){if(""===t||Array.isArray(t)&&0===t.length)return{absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:{x:0,y:0,width:0,height:0}};var e;try{e=jt(t)}catch(i){e=jt("")}!function(t){for(var e=0;e<t.length;e++){var i=t[e-1],a=t[e];if("M"===a[0]&&i){var s=i[0],n=[a[1],a[2]],o=void 0;"L"===s||"M"===s?o=[i[1],i[2]]:"C"!==s&&"A"!==s&&"Q"!==s||(o=[i[i.length-2],i[i.length-1]]),o&&gs(n,o)&&(t.splice(e,1),e--)}}}(e);var i=function(t){for(var e=!1,i=t.length,a=0;a<i;a++){var s=t[a][0];if("C"===s||"A"===s||"Q"===s){e=!0;break}}return e}(e),a=function(t){for(var e=[],i=[],a=[],s=0;s<t.length;s++){var n=t[s],o=n[0];"M"===o?(a.length&&(i.push(a),a=[]),a.push([n[1],n[2]])):"Z"===o?a.length&&(e.push(a),a=[]):a.push([n[1],n[2]])}return a.length>0&&i.push(a),{polygons:e,polylines:i}}(e),s=a.polygons,n=a.polylines,o=function(t){for(var e=[],i=null,a=null,s=null,n=0,o=t.length,r=0;r<o;r++){var l=t[r];a=t[r+1];var c=l[0],d={command:c,prePoint:i,params:l,startTangent:null,endTangent:null,currentPoint:null,nextPoint:null,arcParams:null,box:null,cubicParams:null};switch(c){case"M":s=[l[1],l[2]],n=r;break;case"A":var h=Cs(i,l);d.arcParams=h}if("Z"===c)i=s,a=t[n+1];else{var u=l.length;i=[l[u-2],l[u-1]]}a&&"Z"===a[0]&&(a=t[n],e[n]&&(e[n].prePoint=i)),d.currentPoint=i,e[n]&&gs(i,e[n].currentPoint)&&(e[n].prePoint=d.prePoint);var p=a?[a[a.length-2],a[a.length-1]]:null;d.nextPoint=p;var m=d.prePoint;if(["L","H","V"].includes(c))d.startTangent=[m[0]-i[0],m[1]-i[1]],d.endTangent=[i[0]-m[0],i[1]-m[1]];else if("Q"===c){var f=[l[1],l[2]];d.startTangent=[m[0]-f[0],m[1]-f[1]],d.endTangent=[i[0]-f[0],i[1]-f[1]]}else if("T"===c)f=ys((y=e[r-1]).currentPoint,m),"Q"===y.command?(d.command="Q",d.startTangent=[m[0]-f[0],m[1]-f[1]],d.endTangent=[i[0]-f[0],i[1]-f[1]]):(d.command="TL",d.startTangent=[m[0]-i[0],m[1]-i[1]],d.endTangent=[i[0]-m[0],i[1]-m[1]]);else if("C"===c){var g=[l[1],l[2]],_=[l[3],l[4]];d.startTangent=[m[0]-g[0],m[1]-g[1]],d.endTangent=[i[0]-_[0],i[1]-_[1]],0===d.startTangent[0]&&0===d.startTangent[1]&&(d.startTangent=[g[0]-_[0],g[1]-_[1]]),0===d.endTangent[0]&&0===d.endTangent[1]&&(d.endTangent=[_[0]-g[0],_[1]-g[1]])}else if("S"===c){var y;g=ys((y=e[r-1]).currentPoint,m),_=[l[1],l[2]],"C"===y.command?(d.command="C",d.startTangent=[m[0]-g[0],m[1]-g[1]],d.endTangent=[i[0]-_[0],i[1]-_[1]]):(d.command="SQ",d.startTangent=[m[0]-_[0],m[1]-_[1]],d.endTangent=[i[0]-_[0],i[1]-_[1]])}else if("A"===c){var v=Es(d,0),b=v.x,E=v.y,A=Es(d,1,!1),w=A.x,S=A.y;d.startTangent=[b,E],d.endTangent=[w,S]}e.push(d)}return e}(e),r=function(t){for(var e=[],i=[],a=[],s=0;s<t.length;s++){var n=(m=t[s]).currentPoint,o=m.params,r=m.prePoint,l=void 0;switch(m.command){case"Q":l=hi(r[0],r[1],o[1],o[2],o[3],o[4]);break;case"C":l=ri(r[0],r[1],o[1],o[2],o[3],o[4],o[5],o[6]);break;case"A":var c=m.arcParams;l=ei(c.cx,c.cy,c.rx,c.ry,c.xRotation,c.startAngle,c.endAngle);break;default:e.push(n[0]),i.push(n[1])}l&&(m.box=l,e.push(l.x,l.x+l.width),i.push(l.y,l.y+l.height))}e=e.filter(function(t){return!Number.isNaN(t)&&t!==1/0&&t!==-1/0}),i=i.filter(function(t){return!Number.isNaN(t)&&t!==1/0&&t!==-1/0});var d=me(e),h=me(i),u=pe(e),p=pe(i);if(0===a.length)return{x:d,y:h,width:u-d,height:p-h};for(s=0;s<a.length;s++){var m;(n=(m=a[s]).currentPoint)[0]===d?d-=_s(m,0).xExtra:n[0]===u&&(u+=_s(m,0).xExtra),n[1]===h?h-=_s(m,0).yExtra:n[1]===p&&(p+=_s(m,0).yExtra)}return{x:d,y:h,width:u-d,height:p-h}}(o),l=r.x,c=r.y,d=r.width,h=r.height;return{absolutePath:e,hasArc:i,segments:o,polygons:s,polylines:n,totalLength:0,rect:{x:Number.isFinite(l)?l:0,y:Number.isFinite(c)?c:0,width:Number.isFinite(d)?d:0,height:Number.isFinite(h)?h:0}}},xs=ta(Is);function Ts(t){return fe(t)?xs(t):Is(t)}function Ms(t,e,i){var a=t.curve,s=e.curve;a&&0!==a.length||(a=Ht(t.absolutePath,!1),t.curve=a),s&&0!==s.length||(s=Ht(e.absolutePath,!1),e.curve=s);var n=[a,s];a.length!==s.length&&(n=re(a,s));var o,r,l,c,d,h,u,p,m=ne(n[0])!==ne(n[1])?(r=(o=n[0]).slice(1).map(function(t,e,i){return e?i[e-1].slice(-2).concat(t.slice(1)):o[0].slice(1).concat(t.slice(1))}).map(function(t){return t.map(function(e,i){return t[t.length-i-2*(1-i%2)]})}).reverse(),[["M"].concat(r[0].slice(0,2))].concat(r.map(function(t){return["C"].concat(t.slice(2))}))):n[0].map(function(t){return Array.isArray(t)?[].concat(t):t});return[m,(l=n[1],c=m,d=l.length-1,h=[],u=0,p=function(t){var e=t.length,i=e-1;return t.map(function(a,s){return t.map(function(a,n){var o,r=s+n;return 0===n||t[r]&&"M"===t[r][0]?(o=t[r],["M"].concat(o.slice(-2))):(r>=e&&(r-=i),t[r])})})}(l),p.forEach(function(t,e){l.slice(1).forEach(function(t,i){u+=Kt(l[(e+i)%d].slice(-2),c[i%d].slice(-2))}),h[e]=u,u=0}),p[h.indexOf(Math.min.apply(null,h))]),function(t){return t}]}function Ps(t,e){var i;i=fe(t)?t.split(" ").map(function(t){var e=u(t.split(","),2),i=e[0],a=e[1];return[Number(i),Number(a)]}):t;var a,s,n=[],o=0,r=function(t){return function(t){if(t.length<2)return 0;for(var e=0,i=0;i<t.length-1;i++){var a=t[i],s=t[i+1];e+=Xe(a[0],a[1],s[0],s[1])}return e}(t)}(i);i.forEach(function(t,e){i[e+1]&&((a=[0,0])[0]=o/r,s=ai(t[0],t[1],i[e+1][0],i[e+1][1]),o+=s,a[1]=o/r,n.push(a))});var l=Math.min.apply(Math,p([],u(i.map(function(t){return t[0]})),!1)),c=Math.min.apply(Math,p([],u(i.map(function(t){return t[1]})),!1));return e&&(e.parsedStyle.defX=l,e.parsedStyle.defY=c),{points:i,totalLength:r,segments:n}}function Os(t,e){return[t.points,e.points,function(t){return t}]}var Ls=null;function Rs(t){return function(e){var i=0;return t.map(function(t){return t===Ls?e[i++]:t})}}function Ds(t){return t}var Ns={matrix:["NNNNNN",[Ls,Ls,0,0,Ls,Ls,0,0,0,0,1,0,Ls,Ls,0,1],Ds],matrix3d:["NNNNNNNNNNNNNNNN",Ds],rotate:["A"],rotatex:["A"],rotatey:["A"],rotatez:["A"],rotate3d:["NNNA"],perspective:["L"],scale:["Nn",Rs([Ls,Ls,new ga(1)]),Ds],scalex:["N",Rs([Ls,new ga(1),new ga(1)]),Rs([Ls,new ga(1)])],scaley:["N",Rs([new ga(1),Ls,new ga(1)]),Rs([new ga(1),Ls])],scalez:["N",Rs([new ga(1),new ga(1),Ls])],scale3d:["NNN",Ds],skew:["Aa",null,Ds],skewx:["A",null,Rs([Ls,ba])],skewy:["A",null,Rs([ba,Ls])],translate:["Tt",Rs([Ls,Ls,_a]),Ds],translatex:["T",Rs([Ls,_a,_a]),Rs([Ls,_a])],translatey:["T",Rs([_a,Ls,_a]),Rs([_a,Ls])],translatez:["L",Rs([_a,_a,Ls])],translate3d:["TTL",Ds]};function ks(t){if("none"===(t=(t||"none").toLowerCase().trim()))return[];for(var e,i=/\s*(\w+)\(([^)]*)\)/g,a=[],s=0;e=i.exec(t);){if(e.index!==s)return[];s=e.index+e[0].length;var n=e[1],o=Ns[n];if(!o)return[];var r=e[2].split(","),l=o[0];if(l.length<r.length)return[];for(var c=[],d=0;d<l.length;d++){var h,u=r[d],p=l[d];if(void 0===(h=u?{A:function(t){return"0"===t.trim()?ba:ts(t)},N:hs,T:Ja,L:Qa}[p.toUpperCase()](u):{a:ba,n:c[0],t:_a}[p]))return[];c.push(h)}if(a.push({t:n,d:c}),i.lastIndex===t.length)return a}return[]}function Fs(t){if("none"===(t=(t||"none").toLowerCase().trim()))return[];for(var e,i=/\s*(\w+)\(([^)]*)\)/g,a=[],s=0;e=i.exec(t);){if(e.index!==s)return[];s=e.index+e[0].length;var n=e[1],o=Ns[n];if(!o)return[];var r=e[2].split(","),l=o[0];if(l.length<r.length)return[];for(var c=[],d=0;d<l.length;d++){var h,u=r[d],p=l[d];if(void 0===(h=u?{A:function(t){return"0"===t.trim()?ba:Za(t)},N:ds,T:Xa,L:Ka}[p.toUpperCase()](u):{a:ba,n:c[0],t:_a}[p]))return[];c.push(h)}if(a.push({t:n,d:c}),i.lastIndex===t.length)return a}return[]}function $s(t){var e,i,a,s;switch(t.t){case"rotatex":return s=Ci(is(t.d[0])),[1,0,0,0,0,Math.cos(s),Math.sin(s),0,0,-Math.sin(s),Math.cos(s),0,0,0,0,1];case"rotatey":return s=Ci(is(t.d[0])),[Math.cos(s),0,-Math.sin(s),0,0,1,0,0,Math.sin(s),0,Math.cos(s),0,0,0,0,1];case"rotate":case"rotatez":return s=Ci(is(t.d[0])),[Math.cos(s),Math.sin(s),0,0,-Math.sin(s),Math.cos(s),0,0,0,0,1,0,0,0,0,1];case"rotate3d":e=t.d[0].value,i=t.d[1].value,a=t.d[2].value,s=Ci(is(t.d[3]));var n=e*e+i*i+a*a;if(0===n)e=1,i=0,a=0;else if(1!==n){var o=Math.sqrt(n);e/=o,i/=o,a/=o}var r=Math.sin(s/2),l=r*Math.cos(s/2),c=r*r;return[1-2*(i*i+a*a)*c,2*(e*i*c+a*l),2*(e*a*c-i*l),0,2*(e*i*c-a*l),1-2*(e*e+a*a)*c,2*(i*a*c+e*l),0,2*(e*a*c+i*l),2*(i*a*c-e*l),1-2*(e*e+i*i)*c,0,0,0,0,1];case"scale":return[t.d[0].value,0,0,0,0,t.d[1].value,0,0,0,0,1,0,0,0,0,1];case"scalex":return[t.d[0].value,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"scaley":return[1,0,0,0,0,t.d[0].value,0,0,0,0,1,0,0,0,0,1];case"scalez":return[1,0,0,0,0,1,0,0,0,0,t.d[0].value,0,0,0,0,1];case"scale3d":return[t.d[0].value,0,0,0,0,t.d[1].value,0,0,0,0,t.d[2].value,0,0,0,0,1];case"skew":var d=Ci(is(t.d[0])),h=Ci(is(t.d[1]));return[1,Math.tan(h),0,0,Math.tan(d),1,0,0,0,0,1,0,0,0,0,1];case"skewx":return s=Ci(is(t.d[0])),[1,0,0,0,Math.tan(s),1,0,0,0,0,1,0,0,0,0,1];case"skewy":return s=Ci(is(t.d[0])),[1,Math.tan(s),0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"translate":return[1,0,0,0,0,1,0,0,0,0,1,0,e=ns(t.d[0],0,null)||0,i=ns(t.d[1],0,null)||0,0,1];case"translatex":return[1,0,0,0,0,1,0,0,0,0,1,0,e=ns(t.d[0],0,null)||0,0,0,1];case"translatey":return[1,0,0,0,0,1,0,0,0,0,1,0,0,i=ns(t.d[0],0,null)||0,0,1];case"translatez":return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,a=ns(t.d[0],0,null)||0,1];case"translate3d":return[1,0,0,0,0,1,0,0,0,0,1,0,e=ns(t.d[0],0,null)||0,i=ns(t.d[1],0,null)||0,a=ns(t.d[2],0,null)||0,1];case"perspective":var u=ns(t.d[0],0,null)||0;return[1,0,0,0,0,1,0,0,0,0,1,u?-1/u:0,0,0,0,1];case"matrix":return[t.d[0].value,t.d[1].value,0,0,t.d[2].value,t.d[3].value,0,0,0,0,1,0,t.d[4].value,t.d[5].value,0,1];case"matrix3d":return t.d.map(function(t){return t.value})}}function qs(t,e){return[t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3],t[0]*e[4]+t[4]*e[5]+t[8]*e[6]+t[12]*e[7],t[1]*e[4]+t[5]*e[5]+t[9]*e[6]+t[13]*e[7],t[2]*e[4]+t[6]*e[5]+t[10]*e[6]+t[14]*e[7],t[3]*e[4]+t[7]*e[5]+t[11]*e[6]+t[15]*e[7],t[0]*e[8]+t[4]*e[9]+t[8]*e[10]+t[12]*e[11],t[1]*e[8]+t[5]*e[9]+t[9]*e[10]+t[13]*e[11],t[2]*e[8]+t[6]*e[9]+t[10]*e[10]+t[14]*e[11],t[3]*e[8]+t[7]*e[9]+t[11]*e[10]+t[15]*e[11],t[0]*e[12]+t[4]*e[13]+t[8]*e[14]+t[12]*e[15],t[1]*e[12]+t[5]*e[13]+t[9]*e[14]+t[13]*e[15],t[2]*e[12]+t[6]*e[13]+t[10]*e[14]+t[14]*e[15],t[3]*e[12]+t[7]*e[13]+t[11]*e[14]+t[15]*e[15]]}function Gs(t){var e=[0,0,0],i=[1,1,1],a=[0,0,0],s=[0,0,0,1],n=[0,0,0,1];return function(t,e,i,a,s,n){if(!function(t,e){var i=e[15];if(0===i)return!1;for(var a=1/i,s=0;s<16;s++)t[s]=e[s]*a;return!0}(Mi,t))return!1;if(S(Pi,Mi),Pi[3]=0,Pi[7]=0,Pi[11]=0,Pi[15]=1,Math.abs(M(Pi))<1e-8)return!1;var o,r,l=Mi[3],c=Mi[7],d=Mi[11],h=Mi[12],u=Mi[13],p=Mi[14],m=Mi[15];if(0!==l||0!==c||0!==d){if(Oi[0]=l,Oi[1]=c,Oi[2]=d,Oi[3]=m,!T(Pi,Pi))return!1;x(Pi,Pi),_t(s,Oi,Pi)}else s[0]=s[1]=s[2]=0,s[3]=1;if(e[0]=h,e[1]=u,e[2]=p,r=Mi,(o=Li)[0][0]=r[0],o[0][1]=r[1],o[0][2]=r[2],o[1][0]=r[4],o[1][1]=r[5],o[1][2]=r[6],o[2][0]=r[8],o[2][1]=r[9],o[2][2]=r[10],i[0]=et(Li[0]),lt(Li[0],Li[0]),a[0]=ct(Li[0],Li[1]),Di(Li[1],Li[1],Li[0],1,-a[0]),i[1]=et(Li[1]),lt(Li[1],Li[1]),a[0]/=i[1],a[1]=ct(Li[0],Li[2]),Di(Li[2],Li[2],Li[0],1,-a[1]),a[2]=ct(Li[1],Li[2]),Di(Li[2],Li[2],Li[1],1,-a[2]),i[2]=et(Li[2]),lt(Li[2],Li[2]),a[1]/=i[2],a[2]/=i[2],function(t,e,i){var a=e[0],s=e[1],n=e[2],o=i[0],r=i[1],l=i[2];t[0]=s*l-n*r,t[1]=n*o-a*l,t[2]=a*r-s*o}(Ri,Li[1],Li[2]),ct(Li[0],Ri)<0)for(var f=0;f<3;f++)i[f]*=-1,Li[f][0]*=-1,Li[f][1]*=-1,Li[f][2]*=-1;n[0]=.5*Math.sqrt(Math.max(1+Li[0][0]-Li[1][1]-Li[2][2],0)),n[1]=.5*Math.sqrt(Math.max(1-Li[0][0]+Li[1][1]-Li[2][2],0)),n[2]=.5*Math.sqrt(Math.max(1-Li[0][0]-Li[1][1]+Li[2][2],0)),n[3]=.5*Math.sqrt(Math.max(1+Li[0][0]+Li[1][1]+Li[2][2],0)),Li[2][1]>Li[1][2]&&(n[0]=-n[0]),Li[0][2]>Li[2][0]&&(n[1]=-n[1]),Li[1][0]>Li[0][1]&&(n[2]=-n[2])}(function(t){return 0===t.length?[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]:t.map($s).reduce(qs)}(t),e,i,a,s,n),[[e,i,a,n,s]]}var Bs=function(){function t(t,e){for(var i=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],a=0;a<4;a++)for(var s=0;s<4;s++)for(var n=0;n<4;n++)i[a][s]+=e[a][n]*t[n][s];return i}return function(e,i,a,s,n){for(var o=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],r=0;r<4;r++)o[r][3]=n[r];for(r=0;r<3;r++)for(var l=0;l<3;l++)o[3][r]+=e[l]*o[l][r];var c=s[0],d=s[1],h=s[2],u=s[3],p=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];p[0][0]=1-2*(d*d+h*h),p[0][1]=2*(c*d-h*u),p[0][2]=2*(c*h+d*u),p[1][0]=2*(c*d+h*u),p[1][1]=1-2*(c*c+h*h),p[1][2]=2*(d*h-c*u),p[2][0]=2*(c*h-d*u),p[2][1]=2*(d*h+c*u),p[2][2]=1-2*(c*c+d*d),o=t(o,p);var m,f=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];for(a[2]&&(f[2][1]=a[2],o=t(o,f)),a[1]&&(f[2][1]=0,f[2][0]=a[0],o=t(o,f)),a[0]&&(f[2][0]=0,f[1][0]=a[0],o=t(o,f)),r=0;r<3;r++)for(l=0;l<3;l++)o[r][l]*=i[r];return 0==(m=o)[0][2]&&0==m[0][3]&&0==m[1][2]&&0==m[1][3]&&0==m[2][0]&&0==m[2][1]&&1==m[2][2]&&0==m[2][3]&&0==m[3][2]&&1==m[3][3]?[o[0][0],o[0][1],o[1][0],o[1][1],o[3][0],o[3][1]]:o[0].concat(o[1],o[2],o[3])}}();function js(t){return t.toFixed(6).replace(".000000","")}function Us(t,e){var i,a;return t.decompositionPair!==e&&(t.decompositionPair=e,i=Gs(t)),e.decompositionPair!==t&&(e.decompositionPair=t,a=Gs(e)),null===i[0]||null===a[0]?[[!1],[!0],function(i){return i?e[0].d:t[0].d}]:(i[0].push(0),a[0].push(1),[i,a,function(t){var e=function(t,e,i){var a=function(t,e){for(var i=0,a=0;a<t.length;a++)i+=t[a]*e[a];return i}(t,e),s=[];if(1===(a=ge(a,-1,1)))s=t;else for(var n=Math.acos(a),o=1*Math.sin(i*n)/Math.sqrt(1-a*a),r=0;r<4;r++)s.push(t[r]*(Math.cos(i*n)-a*o)+e[r]*o);return s}(i[0][3],a[0][3],t[5]);return Bs(t[0],t[1],t[2],e,t[4]).map(js).join(",")}])}function Ys(t){return t.replace(/[xy]/,"")}function zs(t){return t.replace(/(x|y|z|3d)?$/,"3d")}var Vs=function(t,e){return"perspective"===t&&"perspective"===e||("matrix"===t||"matrix3d"===t)&&("matrix"===e||"matrix3d"===e)};function Ws(t,e,i){var a=!1;if(!t.length||!e.length){t.length||(a=!0,t=e,e=[]);for(var s=function(i){var a=t[i],s=a.t,n=a.d,o="scale"===s.substring(0,5)?1:0;e.push({t:s,d:n.map(function(t){return"number"==typeof t?Pa(o):Pa(o,t.unit)})})},n=0;n<t.length;n++)s(n)}var o=[],r=[],l=[];if(t.length!==e.length)o=[(g=Us(t,e))[0]],r=[g[1]],l=[["matrix",[g[2]]]];else for(n=0;n<t.length;n++){var c=t[n].t,d=e[n].t,h=t[n].d,u=e[n].d,p=Ns[c],m=Ns[d],f=void 0;if(Vs(c,d)){var g=Us([t[n]],[e[n]]);o.push(g[0]),r.push(g[1]),l.push(["matrix",[g[2]]])}else{if(c===d)f=c;else if(p[2]&&m[2]&&Ys(c)===Ys(d))f=Ys(c),h=p[2](h),u=m[2](u);else{if(!p[1]||!m[1]||zs(c)!==zs(d)){o=[(g=Us(t,e))[0]],r=[g[1]],l=[["matrix",[g[2]]]];break}f=zs(c),h=p[1](h),u=m[1](u)}for(var _=[],y=[],v=[],b=0;b<h.length;b++)g=es(h[b],u[b],i,!1,b),_[b]=g[0],y[b]=g[1],v.push(g[2]);o.push(_),r.push(y),l.push([f,v])}}if(a){var E=o;o=r,r=E}return[o,r,function(t){return t.map(function(t,e){var i=t.map(function(t,i){return l[e][1][i](t)}).join(",");return"matrix"===l[e][0]&&16===i.split(",").length&&(l[e][0]="matrix3d"),"matrix3d"===l[e][0]&&6===i.split(",").length&&(l[e][0]="matrix"),l[e][0]+"("+i+")"}).join(" ")}]}var Hs=ta(function(t){if(fe(t)){if("text-anchor"===t)return[Pa(0,"px"),Pa(0,"px")];var e=t.split(" ");return 1===e.length&&("top"===e[0]||"bottom"===e[0]?(e[1]=e[0],e[0]="center"):e[1]="center"),2!==e.length?null:[Ja(Qs(e[0])),Ja(Qs(e[1]))]}return[Pa(t[0]||0,"px"),Pa(t[1]||0,"px")]}),Ks=function(t){if(fe(t)){if("text-anchor"===t)return[Pa(0,"px"),Pa(0,"px")];var e=t.split(" ");return 1===e.length&&("top"===e[0]||"bottom"===e[0]?(e[1]=e[0],e[0]="center"):e[1]="center"),2!==e.length?null:[Xa(Qs(e[0])),Xa(Qs(e[1]))]}return[Pa(t[0]||0,"px"),Pa(t[1]||0,"px")]};function Qs(t){return"center"===t?"50%":"left"===t||"top"===t?"0":"right"===t||"bottom"===t?"100%":t}var Xs=[{n:"display",k:["none"]},{n:"opacity",int:!0,inh:!0,d:"1",syntax:La.OPACITY_VALUE},{n:"fillOpacity",int:!0,inh:!0,d:"1",syntax:La.OPACITY_VALUE},{n:"strokeOpacity",int:!0,inh:!0,d:"1",syntax:La.OPACITY_VALUE},{n:"fill",int:!0,k:["none"],d:"none",syntax:La.PAINT},{n:"fillRule",k:["nonzero","evenodd"],d:"nonzero"},{n:"stroke",int:!0,k:["none"],d:"none",syntax:La.PAINT,l:!0},{n:"shadowType",k:["inner","outer","both"],d:"outer",l:!0},{n:"shadowColor",int:!0,syntax:La.COLOR},{n:"shadowOffsetX",int:!0,l:!0,d:"0",syntax:La.LENGTH_PERCENTAGE},{n:"shadowOffsetY",int:!0,l:!0,d:"0",syntax:La.LENGTH_PERCENTAGE},{n:"shadowBlur",int:!0,l:!0,d:"0",syntax:La.SHADOW_BLUR},{n:"lineWidth",int:!0,inh:!0,d:"1",l:!0,a:["strokeWidth"],syntax:La.LENGTH_PERCENTAGE},{n:"increasedLineWidthForHitTesting",inh:!0,d:"0",l:!0,syntax:La.LENGTH_PERCENTAGE},{n:"lineJoin",inh:!0,l:!0,a:["strokeLinejoin"],k:["miter","bevel","round"],d:"miter"},{n:"lineCap",inh:!0,l:!0,a:["strokeLinecap"],k:["butt","round","square"],d:"butt"},{n:"lineDash",int:!0,inh:!0,k:["none"],a:["strokeDasharray"],syntax:La.LENGTH_PERCENTAGE_12},{n:"lineDashOffset",int:!0,inh:!0,d:"0",a:["strokeDashoffset"],syntax:La.LENGTH_PERCENTAGE},{n:"offsetPath",syntax:La.DEFINED_PATH},{n:"offsetDistance",int:!0,syntax:La.OFFSET_DISTANCE},{n:"dx",int:!0,l:!0,d:"0",syntax:La.LENGTH_PERCENTAGE},{n:"dy",int:!0,l:!0,d:"0",syntax:La.LENGTH_PERCENTAGE},{n:"zIndex",ind:!0,int:!0,d:"0",k:["auto"],syntax:La.Z_INDEX},{n:"visibility",k:["visible","hidden"],ind:!0,inh:!0,int:!0,d:"visible"},{n:"pointerEvents",inh:!0,k:["none","auto","stroke","fill","painted","visible","visiblestroke","visiblefill","visiblepainted","all"],d:"auto"},{n:"filter",ind:!0,l:!0,k:["none"],d:"none",syntax:La.FILTER},{n:"clipPath",syntax:La.DEFINED_PATH},{n:"textPath",syntax:La.DEFINED_PATH},{n:"textPathSide",k:["left","right"],d:"left"},{n:"textPathStartOffset",l:!0,d:"0",syntax:La.LENGTH_PERCENTAGE},{n:"transform",p:100,int:!0,k:["none"],d:"none",syntax:La.TRANSFORM},{n:"transformOrigin",p:100,d:function(t){return t===mi.CIRCLE||t===mi.ELLIPSE?"center":t===mi.TEXT?"text-anchor":"left top"},l:!0,syntax:La.TRANSFORM_ORIGIN},{n:"anchor",p:99,d:function(t){return t===mi.CIRCLE||t===mi.ELLIPSE?"0.5 0.5":"0 0"},l:!0,syntax:La.LENGTH_PERCENTAGE_12},{n:"cx",int:!0,d:"0",syntax:La.COORDINATE},{n:"cy",int:!0,d:"0",syntax:La.COORDINATE},{n:"cz",int:!0,d:"0",syntax:La.COORDINATE},{n:"r",int:!0,l:!0,d:"0",syntax:La.LENGTH_PERCENTAGE},{n:"rx",int:!0,l:!0,d:"0",syntax:La.LENGTH_PERCENTAGE},{n:"ry",int:!0,l:!0,d:"0",syntax:La.LENGTH_PERCENTAGE},{n:"x",int:!0,d:"0",syntax:La.COORDINATE},{n:"y",int:!0,d:"0",syntax:La.COORDINATE},{n:"z",int:!0,d:"0",syntax:La.COORDINATE},{n:"width",int:!0,l:!0,k:["auto","fit-content","min-content","max-content"],d:"0",syntax:La.LENGTH_PERCENTAGE},{n:"height",int:!0,l:!0,k:["auto","fit-content","min-content","max-content"],d:"0",syntax:La.LENGTH_PERCENTAGE},{n:"radius",int:!0,l:!0,d:"0",syntax:La.LENGTH_PERCENTAGE_14},{n:"x1",int:!0,l:!0,syntax:La.COORDINATE},{n:"y1",int:!0,l:!0,syntax:La.COORDINATE},{n:"z1",int:!0,l:!0,syntax:La.COORDINATE},{n:"x2",int:!0,l:!0,syntax:La.COORDINATE},{n:"y2",int:!0,l:!0,syntax:La.COORDINATE},{n:"z2",int:!0,l:!0,syntax:La.COORDINATE},{n:"path",int:!0,l:!0,d:"",a:["d"],syntax:La.PATH,p:50},{n:"points",int:!0,l:!0,syntax:La.LIST_OF_POINTS,p:50},{n:"text",l:!0,d:"",syntax:La.TEXT,p:50},{n:"textTransform",l:!0,inh:!0,k:["capitalize","uppercase","lowercase","none"],d:"none",syntax:La.TEXT_TRANSFORM,p:51},{n:"font",l:!0},{n:"fontSize",int:!0,inh:!0,d:"16px",l:!0,syntax:La.LENGTH_PERCENTAGE},{n:"fontFamily",l:!0,inh:!0,d:"sans-serif"},{n:"fontStyle",l:!0,inh:!0,k:["normal","italic","oblique"],d:"normal"},{n:"fontWeight",l:!0,inh:!0,k:["normal","bold","bolder","lighter"],d:"normal"},{n:"fontVariant",l:!0,inh:!0,k:["normal","small-caps"],d:"normal"},{n:"lineHeight",l:!0,syntax:La.LENGTH,int:!0,d:"0"},{n:"letterSpacing",l:!0,syntax:La.LENGTH,int:!0,d:"0"},{n:"miterLimit",l:!0,syntax:La.NUMBER,d:function(t){return t===mi.PATH||t===mi.POLYGON||t===mi.POLYLINE?"4":"10"}},{n:"wordWrap",l:!0},{n:"wordWrapWidth",l:!0},{n:"maxLines",l:!0},{n:"textOverflow",l:!0,d:"clip"},{n:"leading",l:!0},{n:"textBaseline",l:!0,inh:!0,k:["top","hanging","middle","alphabetic","ideographic","bottom"],d:"alphabetic"},{n:"textAlign",l:!0,inh:!0,k:["start","center","middle","end","left","right"],d:"start"},{n:"markerStart",syntax:La.MARKER},{n:"markerEnd",syntax:La.MARKER},{n:"markerMid",syntax:La.MARKER},{n:"markerStartOffset",syntax:La.LENGTH,l:!0,int:!0,d:"0"},{n:"markerEndOffset",syntax:La.LENGTH,l:!0,int:!0,d:"0"}],Js=Xs.filter(function(t){return!!t.l}).map(function(t){return t.n}),Zs={},tn=new WeakMap,en=function(){function t(t){var e=this;this.runtime=t,Xs.forEach(function(t){e.registerMetadata(t)})}return t.prototype.registerMetadata=function(t){p([t.n],u(t.a||[]),!1).forEach(function(e){Zs[e]=t})},t.prototype.unregisterMetadata=function(t){delete Zs[t]},t.prototype.getPropertySyntax=function(t){return this.runtime.CSSPropertySyntaxFactory[t]},t.prototype.processProperties=function(t,e,i){var a=this;if(void 0===i&&(i={skipUpdateAttribute:!1,skipParse:!1,forceUpdateGeometry:!1,usedAttributes:[],memoize:!0}),!this.runtime.enableCSSParsing){Object.assign(t.attributes,e);var s=Object.keys(e),n=t.parsedStyle.clipPath,o=t.parsedStyle.offsetPath;t.parsedStyle=Object.assign(t.parsedStyle,e);var l=!!i.forceUpdateGeometry;if(!l)for(var c=0;c<Js.length;c++)if(Js[c]in e){l=!0;break}return e.fill&&(t.parsedStyle.fill=Va(e.fill)),e.stroke&&(t.parsedStyle.stroke=Va(e.stroke)),e.shadowColor&&(t.parsedStyle.shadowColor=Va(e.shadowColor)),e.filter&&(t.parsedStyle.filter=ls(e.filter)),le(e.radius)||(t.parsedStyle.radius=as(e.radius,4)),le(e.lineDash)||(t.parsedStyle.lineDash=as(e.lineDash,2)),e.points&&(t.parsedStyle.points=Ps(e.points,t)),""===e.path&&(t.parsedStyle.path=r({},Ra)),e.path&&(t.parsedStyle.path=Ts(e.path),t.parsedStyle.defX=t.parsedStyle.path.rect.x,t.parsedStyle.defY=t.parsedStyle.path.rect.y),e.textTransform&&this.runtime.CSSPropertySyntaxFactory["<text-transform>"].calculator(null,null,{value:e.textTransform},t,null),e.clipPath&&this.runtime.CSSPropertySyntaxFactory["<defined-path>"].calculator("clipPath",n,e.clipPath,t,this.runtime),e.offsetPath&&this.runtime.CSSPropertySyntaxFactory["<defined-path>"].calculator("offsetPath",o,e.offsetPath,t,this.runtime),e.anchor&&(t.parsedStyle.anchor=as(e.anchor,2)),e.transform&&(t.parsedStyle.transform=ks(e.transform)),e.transformOrigin&&(t.parsedStyle.transformOrigin=Hs(e.transformOrigin)),e.markerStart&&(t.parsedStyle.markerStart=this.runtime.CSSPropertySyntaxFactory["<marker>"].calculator(null,e.markerStart,e.markerStart,null,null)),e.markerEnd&&(t.parsedStyle.markerEnd=this.runtime.CSSPropertySyntaxFactory["<marker>"].calculator(null,e.markerEnd,e.markerEnd,null,null)),e.markerMid&&(t.parsedStyle.markerMid=this.runtime.CSSPropertySyntaxFactory["<marker>"].calculator("",e.markerMid,e.markerMid,null,null)),(t.nodeName!==mi.CIRCLE&&t.nodeName!==mi.ELLIPSE||le(e.cx)&&le(e.cy))&&(t.nodeName!==mi.RECT&&t.nodeName!==mi.IMAGE&&t.nodeName!==mi.GROUP&&t.nodeName!==mi.HTML&&t.nodeName!==mi.TEXT&&t.nodeName!==mi.MESH||le(e.x)&&le(e.y)&&le(e.z))&&(t.nodeName!==mi.LINE||le(e.x1)&&le(e.y1)&&le(e.z1)&&le(e.x2)&&le(e.y2)&&le(e.z2))||this.runtime.CSSPropertySyntaxFactory["<coordinate>"].postProcessor(t,s),le(e.zIndex)||this.runtime.CSSPropertySyntaxFactory["<z-index>"].postProcessor(t,s),e.path&&this.runtime.CSSPropertySyntaxFactory["<path>"].postProcessor(t,s),e.points&&this.runtime.CSSPropertySyntaxFactory["<list-of-points>"].postProcessor(t,s),le(e.offsetDistance)||this.runtime.CSSPropertySyntaxFactory["<offset-distance>"].postProcessor(t,s),e.transform&&this.runtime.CSSPropertySyntaxFactory["<transform>"].postProcessor(t,s),void(l&&this.updateGeometry(t))}var d=i.skipUpdateAttribute,h=i.skipParse,u=i.forceUpdateGeometry,p=i.usedAttributes,m=i.memoize,f=u,g=Object.keys(e);g.forEach(function(i){var a;d||(t.attributes[i]=e[i]),!f&&(null===(a=Zs[i])||void 0===a?void 0:a.l)&&(f=!0)}),h||g.forEach(function(e){t.computedStyle[e]=a.parseProperty(e,t.attributes[e],t,m)}),(null==p?void 0:p.length)&&(g=Array.from(new Set(g.concat(p)))),g.forEach(function(e){e in t.computedStyle&&(t.parsedStyle[e]=a.computeProperty(e,t.computedStyle[e],t,m))}),f&&this.updateGeometry(t),g.forEach(function(e){e in t.parsedStyle&&a.postProcessProperty(e,t,g)}),this.runtime.enableCSSParsing&&t.children.length&&g.forEach(function(e){e in t.parsedStyle&&a.isPropertyInheritable(e)&&t.children.forEach(function(t){t.internalSetAttribute(e,null,{skipUpdateAttribute:!0,skipParse:!0})})})},t.prototype.parseProperty=function(t,e,i,a){var s=Zs[t],n=e;if((""===e||le(e))&&(e="unset"),"unset"===e||"initial"===e||"inherit"===e)n=Ia(e);else if(s){var o=s.k,r=s.syntax,l=r&&this.getPropertySyntax(r);o&&o.indexOf(e)>-1?n=Ia(e):l&&(!a&&l.parserUnmemoize?n=l.parserUnmemoize(e,i):l.parser&&(n=l.parser(e,i)))}return n},t.prototype.computeProperty=function(t,e,i,a){var s=Zs[t],n="g-root"===i.id,o=e;if(s){var r=s.syntax,l=s.inh,c=s.d;if(e instanceof ca){var d=e.value;if("unset"===d&&(d=l&&!n?"inherit":"initial"),"initial"===d)le(c)||(e=this.parseProperty(t,ua(c)?c(i.nodeName):c,i,a));else if("inherit"===d){var h=this.tryToResolveProperty(i,t,{inherited:!0});return le(h)?void this.addUnresolveProperty(i,t):h}}var u=r&&this.getPropertySyntax(r);if(u&&u.calculator){var p=i.parsedStyle[t];o=u.calculator(t,p,e,i,this.runtime)}else o=e instanceof ca?e.value:e}return o},t.prototype.postProcessProperty=function(t,e,i){var a=Zs[t];if(a&&a.syntax){var s=a.syntax&&this.getPropertySyntax(a.syntax);s&&s.postProcessor&&s.postProcessor(e,i)}},t.prototype.addUnresolveProperty=function(t,e){var i=tn.get(t);i||(tn.set(t,[]),i=tn.get(t)),-1===i.indexOf(e)&&i.push(e)},t.prototype.tryToResolveProperty=function(t,e,i){if(void 0===i&&(i={}),i.inherited&&t.parentElement&&function(t,e){var i=tn.get(t);return!i||0===i.length||i.includes(e)}(t.parentElement,e)){var a=t.parentElement.parsedStyle[e];if("unset"===a||"initial"===a||"inherit"===a)return;return a}},t.prototype.recalc=function(t){var e=tn.get(t);if(e&&e.length){var i={};e.forEach(function(e){i[e]=t.attributes[e]}),this.processProperties(t,i),tn.delete(t)}},t.prototype.updateGeometry=function(t){var e=t.nodeName,i=this.runtime.geometryUpdaterFactory[e];if(i){var a=t.geometry;a.contentBounds||(a.contentBounds=new ki),a.renderBounds||(a.renderBounds=new ki);var s=t.parsedStyle,n=i.update(s,t),o=n.width,r=n.height,l=n.depth,c=void 0===l?0:l,d=n.offsetX,h=void 0===d?0:d,u=n.offsetY,p=void 0===u?0:u,m=n.offsetZ,f=void 0===m?0:m,g=[Math.abs(o)/2,Math.abs(r)/2,c/2],_=s,y=_.stroke,v=_.lineWidth,b=_.increasedLineWidthForHitTesting,E=_.shadowType,A=_.shadowColor,w=_.filter,S=void 0===w?[]:w,C=_.transformOrigin,I=s.anchor;e===mi.TEXT?delete s.anchor:e===mi.MESH&&(s.anchor[2]=.5);var x=[(1-2*(I&&I[0]||0))*o/2+h,(1-2*(I&&I[1]||0))*r/2+p,(1-2*(I&&I[2]||0))*g[2]+f];a.contentBounds.update(x,g);var T=e===mi.POLYLINE||e===mi.POLYGON||e===mi.PATH?Math.SQRT2:.5;if(y&&!y.isNone){var M=((v||0)+(b||0))*T;g[0]+=M,g[1]+=M}if(a.renderBounds.update(x,g),A&&E&&"inner"!==E){var P=a.renderBounds,O=P.min,L=P.max,R=s,D=R.shadowBlur||0,N=R.shadowOffsetX||0,k=R.shadowOffsetY||0,F=O[0]-D+N,$=L[0]+D+N,q=O[1]-D+k,G=L[1]+D+k;O[0]=Math.min(O[0],F),L[0]=Math.max(L[0],$),O[1]=Math.min(O[1],q),L[1]=Math.max(L[1],G),a.renderBounds.setMinMax(O,L)}S.forEach(function(t){var e=t.name,i=t.params;if("blur"===e){var s=i[0].value;a.renderBounds.update(a.renderBounds.center,Ei(a.renderBounds.halfExtents,a.renderBounds.halfExtents,[s,s,0]))}else if("drop-shadow"===e){var n=i[0].value,o=i[1].value,r=i[2].value,l=a.renderBounds,c=l.min,d=l.max,h=c[0]-r+n,u=d[0]+r+n,p=c[1]-r+o,m=d[1]+r+o;c[0]=Math.min(c[0],h),d[0]=Math.max(d[0],u),c[1]=Math.min(c[1],p),d[1]=Math.max(d[1],m),a.renderBounds.setMinMax(c,d)}}),I=s.anchor;var B=o<0,j=r<0,U=(B?-1:1)*(C?ns(C[0],0,t):0),Y=(j?-1:1)*(C?ns(C[1],1,t):0);U-=(B?-1:1)*(I&&I[0]||0)*a.contentBounds.halfExtents[0]*2,Y-=(j?-1:1)*(I&&I[1]||0)*a.contentBounds.halfExtents[1]*2,t.setOrigin(U,Y),this.runtime.sceneGraphService.dirtifyToRoot(t)}},t.prototype.updateSizeAttenuation=function(t,e){t.style.isSizeAttenuation?(t.style.rawLineWidth||(t.style.rawLineWidth=t.style.lineWidth),t.style.lineWidth=t.style.rawLineWidth/e,t.nodeName===mi.CIRCLE&&(t.style.rawR||(t.style.rawR=t.style.r),t.style.r=t.style.rawR/e)):(t.style.rawLineWidth&&(t.style.lineWidth=t.style.rawLineWidth,delete t.style.rawLineWidth),t.nodeName===mi.CIRCLE&&t.style.rawR&&(t.style.r=t.style.rawR,delete t.style.rawR))},t.prototype.isPropertyInheritable=function(t){var e=Zs[t];return!!e&&e.inh},t}(),an=function(){function t(){this.parser=ts,this.parserUnmemoize=Za,this.parserWithCSSDisabled=null,this.mixer=us}return t.prototype.calculator=function(t,e,i,a){return is(i)},t}(),sn=function(){function t(){}return t.prototype.calculator=function(t,e,i,a,s){return i instanceof ca&&(i=null),s.sceneGraphService.updateDisplayObjectDependency(t,e,i,a),"clipPath"===t&&a.forEach(function(t){0===t.childNodes.length&&s.sceneGraphService.dirtifyToRoot(t)}),i},t}(),nn=function(){function t(){this.parser=Va,this.parserWithCSSDisabled=Va,this.mixer=Wa}return t.prototype.calculator=function(t,e,i,a){return i instanceof ca?"none"===i.value?xa:Ta:i},t}(),on=function(){function t(){this.parser=ls}return t.prototype.calculator=function(t,e,i){return i instanceof ca?[]:i},t}();function rn(t){var e=t.parsedStyle.fontSize;return le(e)?null:e}var ln=function(){function t(){this.parser=Ja,this.parserUnmemoize=Xa,this.parserWithCSSDisabled=null,this.mixer=us}return t.prototype.calculator=function(t,e,i,a,s){var n;if(_e(i))return i;if(!ga.isRelativeUnit(i.unit))return i.value;var o=s.styleValueRegistry;if(i.unit===Vi.kPercentage)return 0;if(i.unit===Vi.kEms){if(a.parentNode){if(r=rn(a.parentNode))return r*i.value;o.addUnresolveProperty(a,t)}else o.addUnresolveProperty(a,t);return 0}if(i.unit===Vi.kRems){if(null===(n=null==a?void 0:a.ownerDocument)||void 0===n?void 0:n.documentElement){var r;if(r=rn(a.ownerDocument.documentElement))return r*i.value;o.addUnresolveProperty(a,t)}else o.addUnresolveProperty(a,t);return 0}},t}(),cn=function(){function t(){this.mixer=ms}return t.prototype.parser=function(t){var e=ss(_e(t)?[t]:t);return 1===e.length?[e[0],e[0]]:[e[0],e[1]]},t.prototype.calculator=function(t,e,i){return i.map(function(t){return t.value})},t}(),dn=function(){function t(){this.mixer=ms}return t.prototype.parser=function(t){var e=ss(_e(t)?[t]:t);return 1===e.length?[e[0],e[0],e[0],e[0]]:2===e.length?[e[0],e[1],e[0],e[1]]:3===e.length?[e[0],e[1],e[2],e[1]]:[e[0],e[1],e[2],e[3]]},t.prototype.calculator=function(t,e,i){return i.map(function(t){return t.value})},t}(),hn=A();function un(t,e){var i=e.parsedStyle.defX||0,a=e.parsedStyle.defY||0;return e.resetLocalTransform(),e.setLocalPosition(i,a),t.forEach(function(t){var s=t.t,n=t.d;if("scale"===s){var o=(null==n?void 0:n.map(function(t){return t.value}))||[1,1];e.scaleLocal(o[0],o[1],1)}else if("scalex"===s)o=(null==n?void 0:n.map(function(t){return t.value}))||[1],e.scaleLocal(o[0],1,1);else if("scaley"===s)o=(null==n?void 0:n.map(function(t){return t.value}))||[1],e.scaleLocal(1,o[0],1);else if("scalez"===s)o=(null==n?void 0:n.map(function(t){return t.value}))||[1],e.scaleLocal(1,1,o[0]);else if("scale3d"===s)o=(null==n?void 0:n.map(function(t){return t.value}))||[1,1,1],e.scaleLocal(o[0],o[1],o[2]);else if("translate"===s){var r=n||[_a,_a];e.translateLocal(r[0].value,r[1].value,0)}else if("translatex"===s)r=n||[_a],e.translateLocal(r[0].value,0,0);else if("translatey"===s)r=n||[_a],e.translateLocal(0,r[0].value,0);else if("translatez"===s)r=n||[_a],e.translateLocal(0,0,r[0].value);else if("translate3d"===s)r=n||[_a,_a,_a],e.translateLocal(r[0].value,r[1].value,r[2].value);else if("rotate"===s){var l=n||[ba];e.rotateLocal(0,0,is(l[0]))}else if("rotatex"===s)l=n||[ba],e.rotateLocal(is(l[0]),0,0);else if("rotatey"===s)l=n||[ba],e.rotateLocal(0,is(l[0]),0);else if("rotatez"===s)l=n||[ba],e.rotateLocal(0,0,is(l[0]));else if("rotate3d"===s);else if("skew"===s){var c=(null==n?void 0:n.map(function(t){return t.value}))||[0,0];e.setLocalSkew(Ci(c[0]),Ci(c[1]))}else if("skewx"===s)c=(null==n?void 0:n.map(function(t){return t.value}))||[0],e.setLocalSkew(Ci(c[0]),e.getLocalSkew()[1]);else if("skewy"===s)c=(null==n?void 0:n.map(function(t){return t.value}))||[0],e.setLocalSkew(e.getLocalSkew()[0],Ci(c[0]));else if("matrix"===s){var d=u(n.map(function(t){return t.value}),6),h=d[0],m=d[1],f=d[2],g=d[3],_=d[4],y=d[5];e.setLocalTransform(C(hn,h,m,0,0,f,g,0,0,0,0,1,0,_+i,y+a,0,1))}else"matrix3d"===s&&(C.apply(J,p([hn],u(n.map(function(t){return t.value})),!1)),hn[12]+=i,hn[13]+=a,e.setLocalTransform(hn))}),e.getLocalTransform()}var pn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.postProcessor=function(t,e){var i,a,s;switch(t.nodeName){case mi.CIRCLE:case mi.ELLIPSE:var n=t.parsedStyle,o=n.cx,r=n.cy,l=n.cz;le(o)||(i=o),le(r)||(a=r),le(l)||(s=l);break;case mi.LINE:var c=t.parsedStyle,d=c.x1,h=c.x2,p=c.y1,m=c.y2;i=Math.min(d,h),a=Math.min(p,m),s=0;break;case mi.RECT:case mi.IMAGE:case mi.GROUP:case mi.HTML:case mi.TEXT:case mi.MESH:le(t.parsedStyle.x)||(i=t.parsedStyle.x),le(t.parsedStyle.y)||(a=t.parsedStyle.y),le(t.parsedStyle.z)||(s=t.parsedStyle.z)}if(t.nodeName!==mi.PATH&&t.nodeName!==mi.POLYLINE&&t.nodeName!==mi.POLYGON&&(t.parsedStyle.defX=i||0,t.parsedStyle.defY=a||0),!(le(i)&&le(a)&&le(s)||-1!==e.indexOf("transform"))){var f=t.parsedStyle.transform;if(f&&f.length)un(f,t);else{var g=u(t.getLocalPosition(),3),_=g[0],y=g[1],v=g[2];t.setLocalPosition(le(i)?_:i,le(a)?y:a,le(s)?v:s)}}},e}(ln),mn=function(){function t(){}return t.prototype.calculator=function(t,e,i,a){i instanceof ca&&(i=null);var s=null==i?void 0:i.cloneNode(!0);return s&&(s.style.isMarker=!0),s},t}(),fn=function(){function t(){this.mixer=us,this.parser=hs,this.parserUnmemoize=ds,this.parserWithCSSDisabled=null}return t.prototype.calculator=function(t,e,i){return i.value},t}(),gn=function(){function t(){this.parser=hs,this.parserUnmemoize=ds,this.parserWithCSSDisabled=null,this.mixer=ps(0,1)}return t.prototype.calculator=function(t,e,i){return i.value},t.prototype.postProcessor=function(t){var e=t.parsedStyle,i=e.offsetPath,a=e.offsetDistance;if(i){var s=i.nodeName;if(s===mi.LINE||s===mi.PATH||s===mi.POLYLINE){var n=i.getPoint(a);n&&(t.parsedStyle.defX=n.x,t.parsedStyle.defY=n.y,t.setLocalPosition(n.x,n.y))}}},t}(),_n=function(){function t(){this.parser=hs,this.parserUnmemoize=ds,this.parserWithCSSDisabled=null,this.mixer=ps(0,1)}return t.prototype.calculator=function(t,e,i){return i.value},t}(),yn=function(){function t(){this.parser=Ts,this.parserWithCSSDisabled=Ts,this.mixer=Ms}return t.prototype.calculator=function(t,e,i){return i instanceof ca&&"unset"===i.value?{absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:new Ui(0,0,0,0)}:i},t.prototype.postProcessor=function(t,e){if(t.parsedStyle.defX=t.parsedStyle.path.rect.x,t.parsedStyle.defY=t.parsedStyle.path.rect.y,t.nodeName===mi.PATH&&-1===e.indexOf("transform")){var i=t.parsedStyle,a=i.defX,s=void 0===a?0:a,n=i.defY,o=void 0===n?0:n;t.setLocalPosition(s,o)}},t}(),vn=function(){function t(){this.parser=Ps,this.mixer=Os}return t.prototype.postProcessor=function(t,e){if((t.nodeName===mi.POLYGON||t.nodeName===mi.POLYLINE)&&-1===e.indexOf("transform")){var i=t.parsedStyle,a=i.defX,s=i.defY;t.setLocalPosition(a,s)}},t}(),bn=function(t){function e(){var e=t.apply(this,p([],u(arguments),!1))||this;return e.mixer=ps(0,1/0),e}return o(e,t),e}(ln),En=function(){function t(){}return t.prototype.calculator=function(t,e,i,a){return i instanceof ca?"unset"===i.value?"":i.value:"".concat(i)},t.prototype.postProcessor=function(t){t.nodeValue="".concat(t.parsedStyle.text)||""},t}(),An=function(){function t(){}return t.prototype.calculator=function(t,e,i,a){var s=a.getAttribute("text");if(s){var n=s;"capitalize"===i.value?n=s.charAt(0).toUpperCase()+s.slice(1):"lowercase"===i.value?n=s.toLowerCase():"uppercase"===i.value&&(n=s.toUpperCase()),a.parsedStyle.text=n}return i.value},t}(),wn={},Sn=0,Cn="undefined"!=typeof window&&void 0!==window.document;function In(t){return!!t.getAttribute}function xn(t,e){var i=Number(t.parsedStyle.zIndex),a=Number(e.parsedStyle.zIndex);if(i===a){var s=t.parentNode;if(s){var n=s.childNodes||[];return n.indexOf(t)-n.indexOf(e)}}return i-a}function Tn(t){var e,i=t;do{if(null===(e=i.parsedStyle)||void 0===e?void 0:e.clipPath)return i;i=i.parentElement}while(null!==i);return null}function Mn(t,e){if(Cn)return document.defaultView.getComputedStyle(t,null).getPropertyValue(e)}var Pn={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},On="object"==typeof performance&&performance.now?performance:Date;function Ln(t,e,i){var a=!1,s=!1,n=!!e&&!e.isNone,o=!!i&&!i.isNone;return"visiblepainted"===t||"painted"===t||"auto"===t?(a=n,s=o):"visiblefill"===t||"fill"===t?a=!0:"visiblestroke"===t||"stroke"===t?s=!0:"visible"!==t&&"all"!==t||(a=!0,s=!0),[a,s]}var Rn=1,Dn="object"==typeof self&&self.self==self?self:"object"==typeof e&&e.global==e?e:{},Nn=Date.now(),kn={},Fn=Date.now(),$n=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");var e=Date.now(),i=e-Fn,a=i>16?0:16-i,s=Rn++;return kn[s]=t,Object.keys(kn).length>1||setTimeout(function(){Fn=e;var t=kn;kn={},Object.keys(t).forEach(function(e){return t[e](Dn.performance&&"function"==typeof Dn.performance.now?Dn.performance.now():Date.now()-Nn)})},a),s},qn=function(t){delete kn[t]},Gn=function(t){return"string"!=typeof t?$n:""===t?Dn.requestAnimationFrame:Dn[t+"RequestAnimationFrame"]},Bn=function(t,e){for(var i=0;void 0!==t[i];){if(e(t[i]))return t[i];i+=1}}(["","webkit","moz","ms","o"],function(t){return!!Gn(t)}),jn=Gn(Bn),Un=function(t){return"string"!=typeof t?qn:""===t?Dn.cancelAnimationFrame:Dn[t+"CancelAnimationFrame"]||Dn[t+"CancelRequestAnimationFrame"]}(Bn);Dn.requestAnimationFrame=jn,Dn.cancelAnimationFrame=Un;var Yn=function(){function t(){this.callbacks=[]}return t.prototype.getCallbacksNum=function(){return this.callbacks.length},t.prototype.tapPromise=function(t,e){this.callbacks.push(e)},t.prototype.promise=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Promise.all(this.callbacks.map(function(e){return e.apply(void 0,p([],u(t),!1))}))},t}(),zn=function(){function t(){this.callbacks=[]}return t.prototype.tapPromise=function(t,e){this.callbacks.push(e)},t.prototype.promise=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return c(this,void 0,void 0,function(){var e,i,a;return d(this,function(s){switch(s.label){case 0:return this.callbacks.length?[4,(a=this.callbacks)[0].apply(a,p([],u(t),!1))]:[3,6];case 1:e=s.sent(),i=0,s.label=2;case 2:return i<this.callbacks.length-1?[4,(0,this.callbacks[i])(e)]:[3,5];case 3:e=s.sent(),s.label=4;case 4:return i++,[3,2];case 5:return[2,e];case 6:return[2,null]}})})},t}(),Vn=function(){function t(){this.callbacks=[]}return t.prototype.tap=function(t,e){this.callbacks.push(e)},t.prototype.call=function(){var t=arguments;this.callbacks.forEach(function(e){e.apply(void 0,t)})},t}(),Wn=function(){function t(){this.callbacks=[]}return t.prototype.tap=function(t,e){this.callbacks.push(e)},t.prototype.call=function(){if(this.callbacks.length){for(var t=arguments,e=this.callbacks[0].apply(void 0,t),i=0;i<this.callbacks.length-1;i++)e=(0,this.callbacks[i])(e);return e}return null},t}(),Hn=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Kn=/([\"\'])[^\'\"]+\1/,Qn=function(){function t(){this.parser=ks,this.parserUnmemoize=Fs,this.parserWithCSSDisabled=Fs,this.mixer=Ws}return t.prototype.calculator=function(t,e,i,a){return i instanceof ca?[]:i},t.prototype.postProcessor=function(t){un(t.parsedStyle.transform,t)},t}(),Xn=function(){this.parser=Hs,this.parserUnmemoize=Ks},Jn=function(){function t(){this.parser=hs,this.parserUnmemoize=ds}return t.prototype.calculator=function(t,e,i,a){return i.value},t.prototype.postProcessor=function(t){if(t.parentNode){var e=t.parentNode,i=e.renderable,a=e.sortable;i&&(i.dirty=!0),a&&(a.dirty=!0,a.dirtyReason=va.Z_INDEX_CHANGED)}},t}(),Zn=function(){function t(){}return t.prototype.update=function(t,e){var i=t.r;return{width:2*i,height:2*i}},t}(),to=function(){function t(){}return t.prototype.update=function(t,e){return{width:2*t.rx,height:2*t.ry}},t}(),eo=function(){function t(){}return t.prototype.update=function(t){var e=t.x1,i=t.y1,a=t.x2,s=t.y2,n=Math.min(e,a),o=Math.max(e,a),r=Math.min(i,s);return{width:o-n,height:Math.max(i,s)-r}},t}(),io=function(){function t(){}return t.prototype.update=function(t){var e=t.path.rect;return{width:e.width,height:e.height}},t}(),ao=function(){function t(){}return t.prototype.update=function(t){if(t.points&&he(t.points.points)){var e=t.points.points,i=Math.min.apply(Math,p([],u(e.map(function(t){return t[0]})),!1)),a=Math.max.apply(Math,p([],u(e.map(function(t){return t[0]})),!1)),s=Math.min.apply(Math,p([],u(e.map(function(t){return t[1]})),!1));return{width:a-i,height:Math.max.apply(Math,p([],u(e.map(function(t){return t[1]})),!1))-s}}return{width:0,height:0}},t}(),so=function(){function t(){}return t.prototype.update=function(t,e){var i=t.img,a=t.width,s=void 0===a?0:a,n=t.height,o=s,r=void 0===n?0:n;return i&&!fe(i)&&(o||(o=i.width,t.width=o),r||(r=i.height,t.height=r)),{width:o,height:r}},t}(),no=function(){function t(t){this.globalRuntime=t}return t.prototype.isReadyToMeasure=function(t,e){var i=t.text,a=t.textAlign,s=t.textBaseline,n=t.fontSize,o=t.fontStyle,r=t.fontWeight,l=t.fontVariant,c=t.lineWidth;return i&&n&&o&&r&&l&&a&&s&&!le(c)},t.prototype.update=function(t,e){var i,a,s=t.text,n=t.textAlign,o=t.lineWidth,r=t.textBaseline,l=t.dx,c=t.dy;if(!this.isReadyToMeasure(t,e))return t.metrics={font:"",width:0,height:0,lines:[],lineWidths:[],lineHeight:0,maxLineWidth:0,fontProperties:{ascent:0,descent:0,fontSize:0},lineMetrics:[]},{width:0,height:0,x:0,y:0,offsetX:0,offsetY:0};var d=((null===(a=null===(i=null==e?void 0:e.ownerDocument)||void 0===i?void 0:i.defaultView)||void 0===a?void 0:a.getConfig())||{}).offscreenCanvas,h=this.globalRuntime.textService.measureText(s,t,d);t.metrics=h;var u=h.width,p=h.height,m=h.lineHeight,f=h.fontProperties,g=[u/2,p/2,0],_=[0,1],y=0;"center"===n||"middle"===n?(y=o/2,_=[.5,1]):"right"!==n&&"end"!==n||(y=o,_=[1,1]);var v=0;return"middle"===r?v=g[1]:"top"===r||"hanging"===r?v=2*g[1]:"alphabetic"===r?v=this.globalRuntime.enableCSSParsing?m-f.ascent:0:"bottom"!==r&&"ideographic"!==r||(v=0),l&&(y+=l),c&&(v+=c),t.anchor=[_[0],_[1],0],{width:2*g[0],height:2*g[1],offsetX:y,offsetY:v}},t}();var oo,ro=function(){function t(e){this.eventPhase=t.prototype.NONE,this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.defaultPrevented=!1,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new ji,this.page=new ji,this.canvas=new ji,this.viewport=new ji,this.composed=!1,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}return Object.defineProperty(t.prototype,"name",{get:function(){return this.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layerX",{get:function(){return this.layer.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layerY",{get:function(){return this.layer.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pageX",{get:function(){return this.page.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pageY",{get:function(){return this.page.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this.canvas.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.canvas.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvasX",{get:function(){return this.canvas.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvasY",{get:function(){return this.canvas.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewportX",{get:function(){return this.viewport.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewportY",{get:function(){return this.viewport.y},enumerable:!1,configurable:!0}),t.prototype.composedPath=function(){return!this.manager||this.path&&this.path[0]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path},Object.defineProperty(t.prototype,"propagationPath",{get:function(){return this.composedPath()},enumerable:!1,configurable:!0}),t.prototype.preventDefault=function(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0},t.prototype.stopImmediatePropagation=function(){this.propagationImmediatelyStopped=!0},t.prototype.stopPropagation=function(){this.propagationStopped=!0},t.prototype.initEvent=function(){},t.prototype.initUIEvent=function(){},t.prototype.clone=function(){throw new Error(Yi)},t}(),lo=function(t){function e(){var e=t.apply(this,p([],u(arguments),!1))||this;return e.client=new ji,e.movement=new ji,e.offset=new ji,e.global=new ji,e.screen=new ji,e}return o(e,t),Object.defineProperty(e.prototype,"clientX",{get:function(){return this.client.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clientY",{get:function(){return this.client.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"movementX",{get:function(){return this.movement.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"movementY",{get:function(){return this.movement.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetX",{get:function(){return this.offset.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetY",{get:function(){return this.offset.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalX",{get:function(){return this.global.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalY",{get:function(){return this.global.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"screenX",{get:function(){return this.screen.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"screenY",{get:function(){return this.screen.y},enumerable:!1,configurable:!0}),e.prototype.getModifierState=function(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)},e.prototype.initMouseEvent=function(){throw new Error(Yi)},e}(ro),co=function(t){function e(){var e=t.apply(this,p([],u(arguments),!1))||this;return e.width=0,e.height=0,e.isPrimary=!1,e}return o(e,t),e.prototype.getCoalescedEvents=function(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]},e.prototype.getPredictedEvents=function(){throw new Error("getPredictedEvents is not supported!")},e.prototype.clone=function(){return this.manager.clonePointerEvent(this)},e}(lo),ho=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.clone=function(){return this.manager.cloneWheelEvent(this)},e}(lo),uo=function(t){function e(e,i){var a=t.call(this,null)||this;return a.type=e,a.detail=i,Object.assign(a,i),a}return o(e,t),e}(ro),po=function(){function t(){this.emitter=new y}return t.prototype.on=function(t,e,i){return this.addEventListener(t,e,i),this},t.prototype.addEventListener=function(t,e,i){var a=be(i)&&i||ue(i)&&i.capture,s=ue(i)&&i.once,n=ua(e)?void 0:e,o=!1,r="";if(t.indexOf(":")>-1){var l=u(t.split(":"),2),c=l[0];t=l[1],r=c,o=!0}if(t=a?"".concat(t,"capture"):t,e=ua(e)?e:e.handleEvent,o){var d=e;e=function(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];(null===(t=e[0].target)||void 0===t?void 0:t.name)===r&&d.apply(void 0,p([],u(e),!1))}}return s?this.emitter.once(t,e,n):this.emitter.on(t,e,n),this},t.prototype.off=function(t,e,i){return t?this.removeEventListener(t,e,i):this.removeAllEventListeners(),this},t.prototype.removeAllEventListeners=function(){this.emitter.removeAllListeners()},t.prototype.removeEventListener=function(t,e,i){var a=be(i)&&i||ue(i)&&i.capture,s=ua(e)?void 0:e;return t=a?"".concat(t,"capture"):t,e=ua(e)?e:null==e?void 0:e.handleEvent,this.emitter.off(t,e,s),this},t.prototype.emit=function(t,e){this.dispatchEvent(new uo(t,e))},t.prototype.dispatchEvent=function(t,e){var i,a,s;if(void 0===e&&(e=!1),!function(t){return!!t.type}(t))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");if(s=this.document?this:this.defaultView?this.defaultView:null===(i=this.ownerDocument)||void 0===i?void 0:i.defaultView){if(t.manager=s.getEventService()||null,!t.manager)return!1;t.defaultPrevented=!1,t.path=[],e||(t.target=this),null===(a=t.manager)||void 0===a||a.dispatchEvent(t,t.type,e)}return!t.defaultPrevented},t}(),mo=function(t){function e(){var e=t.apply(this,p([],u(arguments),!1))||this;return e.shadow=!1,e.ownerDocument=null,e.isConnected=!1,e.baseURI="",e.childNodes=[],e.nodeType=0,e.nodeName="",e.nodeValue=null,e.parentNode=null,e}return o(e,t),e.isNode=function(t){return!!t.childNodes},Object.defineProperty(e.prototype,"textContent",{get:function(){var t,e,i="";this.nodeName===mi.TEXT&&(i+=this.style.text);try{for(var a=h(this.childNodes),s=a.next();!s.done;s=a.next()){var n=s.value;n.nodeName===mi.TEXT?i+=n.nodeValue:i+=n.textContent}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}return i},set:function(t){var e=this;this.childNodes.slice().forEach(function(t){e.removeChild(t)}),this.nodeName===mi.TEXT&&(this.style.text="".concat(t))},enumerable:!1,configurable:!0}),e.prototype.getRootNode=function(t){return void 0===t&&(t={}),this.parentNode?this.parentNode.getRootNode(t):t.composed&&this.host?this.host.getRootNode(t):this},e.prototype.hasChildNodes=function(){return this.childNodes.length>0},e.prototype.isDefaultNamespace=function(t){throw new Error(Yi)},e.prototype.lookupNamespaceURI=function(t){throw new Error(Yi)},e.prototype.lookupPrefix=function(t){throw new Error(Yi)},e.prototype.normalize=function(){throw new Error(Yi)},e.prototype.isEqualNode=function(t){return this===t},e.prototype.isSameNode=function(t){return this.isEqualNode(t)},Object.defineProperty(e.prototype,"parent",{get:function(){return this.parentNode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentElement",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextSibling",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousSibling",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstChild",{get:function(){return this.childNodes.length>0?this.childNodes[0]:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastChild",{get:function(){return this.childNodes.length>0?this.childNodes[this.childNodes.length-1]:null},enumerable:!1,configurable:!0}),e.prototype.compareDocumentPosition=function(t){var i;if(t===this)return 0;for(var a=t,s=this,n=[a],o=[s];null!==(i=a.parentNode)&&void 0!==i?i:s.parentNode;)a=a.parentNode?(n.push(a.parentNode),a.parentNode):a,s=s.parentNode?(o.push(s.parentNode),s.parentNode):s;if(a!==s)return e.DOCUMENT_POSITION_DISCONNECTED|e.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC|e.DOCUMENT_POSITION_PRECEDING;var r=n.length>o.length?n:o,l=r===n?o:n;if(r[r.length-l.length]===l[0])return r===n?e.DOCUMENT_POSITION_CONTAINED_BY|e.DOCUMENT_POSITION_FOLLOWING:e.DOCUMENT_POSITION_CONTAINS|e.DOCUMENT_POSITION_PRECEDING;for(var c=r.length-l.length,d=l.length-1;d>=0;d--){var h=l[d],u=r[c+d];if(u!==h){var p=h.parentNode.childNodes;return p.indexOf(h)<p.indexOf(u)?l===n?e.DOCUMENT_POSITION_PRECEDING:e.DOCUMENT_POSITION_FOLLOWING:r===n?e.DOCUMENT_POSITION_PRECEDING:e.DOCUMENT_POSITION_FOLLOWING}}return e.DOCUMENT_POSITION_FOLLOWING},e.prototype.contain=function(t){return this.contains(t)},e.prototype.contains=function(t){for(var e=t;e&&this!==e;)e=e.parentNode;return!!e},e.prototype.getAncestor=function(t){for(var e=this;t>0&&e;)e=e.parentNode,t--;return e},e.prototype.forEach=function(t,e){void 0===e&&(e=!1),t(this)||(e?this.childNodes.slice():this.childNodes).forEach(function(e){e.forEach(t)})},e.DOCUMENT_POSITION_DISCONNECTED=1,e.DOCUMENT_POSITION_PRECEDING=2,e.DOCUMENT_POSITION_FOLLOWING=4,e.DOCUMENT_POSITION_CONTAINS=8,e.DOCUMENT_POSITION_CONTAINED_BY=16,e.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC=32,e}(po),fo=function(){function t(t,e){var i=this;this.globalRuntime=t,this.context=e,this.emitter=new y,this.nativeHTMLMap=new WeakMap,this.cursor="default",this.mappingTable={},this.mappingState={trackingData:{}},this.eventPool=new Map,this.tmpMatrix=A(),this.tmpVec3=Z(),this.onPointerDown=function(t){var e=i.createPointerEvent(t);if(i.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)i.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){var a=2===e.button;i.dispatchEvent(e,a?"rightdown":"mousedown")}i.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),i.freeEvent(e)},this.onPointerUp=function(t){var e,a=On.now(),s=i.createPointerEvent(t,void 0,void 0,i.context.config.alwaysTriggerPointerEventOnCanvas?i.rootTarget:void 0);if(i.dispatchEvent(s,"pointerup"),"touch"===s.pointerType)i.dispatchEvent(s,"touchend");else if("mouse"===s.pointerType||"pen"===s.pointerType){var n=2===s.button;i.dispatchEvent(s,n?"rightup":"mouseup")}var o=i.trackingData(t.pointerId),r=i.findMountedTarget(o.pressTargetsByButton[t.button]),l=r;if(r&&!s.composedPath().includes(r)){for(var c=r;c&&!s.composedPath().includes(c);)s.currentTarget=c,i.notifyTarget(s,"pointerupoutside"),"touch"===s.pointerType?i.notifyTarget(s,"touchendoutside"):"mouse"!==s.pointerType&&"pen"!==s.pointerType||(n=2===s.button,i.notifyTarget(s,n?"rightupoutside":"mouseupoutside")),mo.isNode(c)&&(c=c.parentNode);delete o.pressTargetsByButton[t.button],l=c}if(l){var d=i.clonePointerEvent(s,"click");d.target=l,d.path=[],o.clicksByButton[t.button]||(o.clicksByButton[t.button]={clickCount:0,target:d.target,timeStamp:a});var h=o.clicksByButton[t.button];h.target===d.target&&a-h.timeStamp<200?++h.clickCount:h.clickCount=1,h.target=d.target,h.timeStamp=a,d.detail=h.clickCount,(null===(e=s.detail)||void 0===e?void 0:e.preventClick)||(i.context.config.useNativeClickEvent||"mouse"!==d.pointerType&&"touch"!==d.pointerType||i.dispatchEvent(d,"click"),i.dispatchEvent(d,"pointertap")),i.freeEvent(d)}i.freeEvent(s)},this.onPointerMove=function(t){var e=i.createPointerEvent(t,void 0,void 0,i.context.config.alwaysTriggerPointerEventOnCanvas?i.rootTarget:void 0),a="mouse"===e.pointerType||"pen"===e.pointerType,s=i.trackingData(t.pointerId),n=i.findMountedTarget(s.overTargets);if(s.overTargets&&n!==e.target){var o="mousemove"===t.type?"mouseout":"pointerout",r=i.createPointerEvent(t,o,n||void 0);if(i.dispatchEvent(r,"pointerout"),a&&i.dispatchEvent(r,"mouseout"),!e.composedPath().includes(n)){var l=i.createPointerEvent(t,"pointerleave",n||void 0);for(l.eventPhase=l.AT_TARGET;l.target&&!e.composedPath().includes(l.target);)l.currentTarget=l.target,i.notifyTarget(l),a&&i.notifyTarget(l,"mouseleave"),mo.isNode(l.target)&&(l.target=l.target.parentNode);i.freeEvent(l)}i.freeEvent(r)}if(n!==e.target){var c="mousemove"===t.type?"mouseover":"pointerover",d=i.clonePointerEvent(e,c);i.dispatchEvent(d,"pointerover"),a&&i.dispatchEvent(d,"mouseover");for(var h=n&&mo.isNode(n)&&n.parentNode;h&&h!==(mo.isNode(i.rootTarget)&&i.rootTarget.parentNode)&&h!==e.target;)h=h.parentNode;if(!h||h===(mo.isNode(i.rootTarget)&&i.rootTarget.parentNode)){var u=i.clonePointerEvent(e,"pointerenter");for(u.eventPhase=u.AT_TARGET;u.target&&u.target!==n&&u.target!==(mo.isNode(i.rootTarget)&&i.rootTarget.parentNode);)u.currentTarget=u.target,i.notifyTarget(u),a&&i.notifyTarget(u,"mouseenter"),mo.isNode(u.target)&&(u.target=u.target.parentNode);i.freeEvent(u)}i.freeEvent(d)}i.dispatchEvent(e,"pointermove"),"touch"===e.pointerType&&i.dispatchEvent(e,"touchmove"),a&&(i.dispatchEvent(e,"mousemove"),i.cursor=i.getCursor(e.target)),s.overTargets=e.composedPath(),i.freeEvent(e)},this.onPointerOut=function(t){var e=i.trackingData(t.pointerId);if(e.overTargets){var a="mouse"===t.pointerType||"pen"===t.pointerType,s=i.findMountedTarget(e.overTargets),n=i.createPointerEvent(t,"pointerout",s||void 0);i.dispatchEvent(n),a&&i.dispatchEvent(n,"mouseout");var o=i.createPointerEvent(t,"pointerleave",s||void 0);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==(mo.isNode(i.rootTarget)&&i.rootTarget.parentNode);)o.currentTarget=o.target,i.notifyTarget(o),a&&i.notifyTarget(o,"mouseleave"),mo.isNode(o.target)&&(o.target=o.target.parentNode);e.overTargets=null,i.freeEvent(n),i.freeEvent(o)}i.cursor=null},this.onPointerOver=function(t){var e=i.trackingData(t.pointerId),a=i.createPointerEvent(t),s="mouse"===a.pointerType||"pen"===a.pointerType;i.dispatchEvent(a,"pointerover"),s&&i.dispatchEvent(a,"mouseover"),"mouse"===a.pointerType&&(i.cursor=i.getCursor(a.target));var n=i.clonePointerEvent(a,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==(mo.isNode(i.rootTarget)&&i.rootTarget.parentNode);)n.currentTarget=n.target,i.notifyTarget(n),s&&i.notifyTarget(n,"mouseenter"),mo.isNode(n.target)&&(n.target=n.target.parentNode);e.overTargets=a.composedPath(),i.freeEvent(a),i.freeEvent(n)},this.onPointerUpOutside=function(t){var e=i.trackingData(t.pointerId),a=i.findMountedTarget(e.pressTargetsByButton[t.button]),s=i.createPointerEvent(t);if(a){for(var n=a;n;)s.currentTarget=n,i.notifyTarget(s,"pointerupoutside"),"touch"===s.pointerType||"mouse"!==s.pointerType&&"pen"!==s.pointerType||i.notifyTarget(s,2===s.button?"rightupoutside":"mouseupoutside"),mo.isNode(n)&&(n=n.parentNode);delete e.pressTargetsByButton[t.button]}i.freeEvent(s)},this.onWheel=function(t){var e=i.createWheelEvent(t);i.dispatchEvent(e),i.freeEvent(e)},this.onClick=function(t){if(i.context.config.useNativeClickEvent){var e=i.createPointerEvent(t);i.dispatchEvent(e),i.freeEvent(e)}},this.onPointerCancel=function(t){var e=i.createPointerEvent(t,void 0,void 0,i.context.config.alwaysTriggerPointerEventOnCanvas?i.rootTarget:void 0);i.dispatchEvent(e),i.freeEvent(e)}}return t.prototype.init=function(){this.rootTarget=this.context.renderingContext.root.parentNode,this.addEventMapping("pointerdown",this.onPointerDown),this.addEventMapping("pointerup",this.onPointerUp),this.addEventMapping("pointermove",this.onPointerMove),this.addEventMapping("pointerout",this.onPointerOut),this.addEventMapping("pointerleave",this.onPointerOut),this.addEventMapping("pointercancel",this.onPointerCancel),this.addEventMapping("pointerover",this.onPointerOver),this.addEventMapping("pointerupoutside",this.onPointerUpOutside),this.addEventMapping("wheel",this.onWheel),this.addEventMapping("click",this.onClick)},t.prototype.destroy=function(){this.emitter.removeAllListeners(),this.mappingTable={},this.mappingState={},this.eventPool.clear()},t.prototype.client2Viewport=function(t){var e=this.context.contextService.getBoundingClientRect();return new ji(t.x-((null==e?void 0:e.left)||0),t.y-((null==e?void 0:e.top)||0))},t.prototype.viewport2Client=function(t){var e=this.context.contextService.getBoundingClientRect();return new ji(t.x+((null==e?void 0:e.left)||0),t.y+((null==e?void 0:e.top)||0))},t.prototype.viewport2Canvas=function(t){var e=t.x,i=t.y,a=this.rootTarget.defaultView.getCamera(),s=this.context.config,n=s.width,o=s.height,r=a.getPerspectiveInverse(),l=a.getWorldTransform(),c=P(this.tmpMatrix,l,r),d=st(this.tmpVec3,e/n*2-1,2*(1-i/o)-1,0);return ht(d,d,c),new ji(d[0],d[1])},t.prototype.canvas2Viewport=function(t){var e=this.rootTarget.defaultView.getCamera(),i=e.getPerspective(),a=e.getViewTransform(),s=P(this.tmpMatrix,i,a),n=st(this.tmpVec3,t.x,t.y,0);ht(this.tmpVec3,this.tmpVec3,s);var o=this.context.config,r=o.width,l=o.height;return new ji((n[0]+1)/2*r,(1-(n[1]+1)/2)*l)},t.prototype.setPickHandler=function(t){this.pickHandler=t},t.prototype.addEventMapping=function(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(function(t,e){return t.priority-e.priority})},t.prototype.mapEvent=function(t){if(this.rootTarget){var e=this.mappingTable[t.type];if(e)for(var i=0,a=e.length;i<a;i++)e[i].fn(t)}},t.prototype.dispatchEvent=function(t,e,i){if(i){t.eventPhase=t.AT_TARGET;var a=this.rootTarget.defaultView||null;t.currentTarget=a,this.notifyListeners(t,e)}else t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e);this.emitter.emit(e||t.type,t)},t.prototype.propagate=function(t,e){if(t.target){var i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(var a=i.length-1;a>=1;a--)if(t.currentTarget=i[a],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){var s=i.indexOf(t.currentTarget);for(t.eventPhase=t.BUBBLING_PHASE,a=s+1;a<i.length;a++)if(t.currentTarget=i[a],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}},t.prototype.propagationPath=function(t){var e=[t],i=this.rootTarget.defaultView||null;if(i&&i===t)return e.unshift(i.document),e;for(var a=0;a<2048&&t!==this.rootTarget;a++)mo.isNode(t)&&t.parentNode&&(e.push(t.parentNode),t=t.parentNode);return i&&e.push(i),e},t.prototype.hitTest=function(t){var e=t.viewportX,i=t.viewportY,a=this.context.config,s=a.width,n=a.height,o=a.disableHitTesting;return e<0||i<0||e>s||i>n?null:!o&&this.pickHandler(t)||this.rootTarget||null},t.prototype.isNativeEventFromCanvas=function(t){var e,i=this.context.contextService.getDomElement(),a=null===(e=t.nativeEvent)||void 0===e?void 0:e.target;if(a){if(a===i)return!0;if(i&&i.contains)return i.contains(a)}return!!t.nativeEvent.composedPath&&t.nativeEvent.composedPath().indexOf(i)>-1},t.prototype.getExistedHTML=function(t){var e,i;if(t.nativeEvent.composedPath)try{for(var a=h(t.nativeEvent.composedPath()),s=a.next();!s.done;s=a.next()){var n=s.value,o=this.nativeHTMLMap.get(n);if(o)return o}}catch(t){e={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(e)throw e.error}}return null},t.prototype.pickTarget=function(t){return this.hitTest({clientX:t.clientX,clientY:t.clientY,viewportX:t.viewportX,viewportY:t.viewportY,x:t.canvasX,y:t.canvasY})},t.prototype.createPointerEvent=function(t,e,i,a){var s=this.allocateEvent(co);this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t;var n=this.getExistedHTML(s);return s.target=null!=i?i:n||this.isNativeEventFromCanvas(s)&&this.pickTarget(s)||a,"string"==typeof e&&(s.type=e),s},t.prototype.createWheelEvent=function(t){var e=this.allocateEvent(ho);this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t;var i=this.getExistedHTML(e);return e.target=i||this.isNativeEventFromCanvas(e)&&this.pickTarget(e),e},t.prototype.trackingData=function(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]},t.prototype.cloneWheelEvent=function(t){var e=this.allocateEvent(ho);return e.nativeEvent=t.nativeEvent,e.originalEvent=t.originalEvent,this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.target=t.target,e.path=t.composedPath().slice(),e.type=t.type,e},t.prototype.clonePointerEvent=function(t,e){var i=this.allocateEvent(co);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=null!=e?e:i.type,i},t.prototype.copyPointerData=function(t,e){e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist},t.prototype.copyMouseData=function(t,e){e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey,e.client.copyFrom(t.client),e.movement.copyFrom(t.movement),e.canvas.copyFrom(t.canvas),e.screen.copyFrom(t.screen),e.global.copyFrom(t.global),e.offset.copyFrom(t.offset)},t.prototype.copyWheelData=function(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ},t.prototype.copyData=function(t,e){e.isTrusted=t.isTrusted,e.timeStamp=On.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.page.copyFrom(t.page),e.viewport.copyFrom(t.viewport)},t.prototype.allocateEvent=function(t){this.eventPool.has(t)||this.eventPool.set(t,[]);var e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=[],e.target=null,e},t.prototype.freeEvent=function(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");var e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)},t.prototype.notifyTarget=function(t,e){e=null!=e?e:t.type;var i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?"".concat(e,"capture"):e;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)},t.prototype.notifyListeners=function(t,e){var i=t.currentTarget.emitter,a=i._events[e];if(a)if("fn"in a)a.once&&i.removeListener(e,a.fn,void 0,!0),a.fn.call(t.currentTarget||a.context,t);else for(var s=0;s<a.length&&!t.propagationImmediatelyStopped;s++)a[s].once&&i.removeListener(e,a[s].fn,void 0,!0),a[s].fn.call(t.currentTarget||a[s].context,t)},t.prototype.findMountedTarget=function(t){if(!t)return null;for(var e=t[t.length-1],i=t.length-2;i>=0;i--){var a=t[i];if(!(a===this.rootTarget||mo.isNode(a)&&a.parentNode===e))break;e=t[i]}return e},t.prototype.getCursor=function(t){for(var e=t;e;){var i=In(e)&&e.getAttribute("cursor");if(i)return i;e=mo.isNode(e)&&e.parentNode}},t}(),go=function(){function t(){}return t.prototype.getOrCreateCanvas=function(t,e){if(this.canvas)return this.canvas;if(t||Ro.offscreenCanvas)this.canvas=t||Ro.offscreenCanvas,this.context=this.canvas.getContext("2d",r({willReadFrequently:!0},e));else try{this.canvas=new window.OffscreenCanvas(0,0),this.context=this.canvas.getContext("2d",r({willReadFrequently:!0},e)),this.context&&this.context.measureText||(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"))}catch(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d",r({willReadFrequently:!0},e))}return this.canvas.width=10,this.canvas.height=10,this.canvas},t.prototype.getOrCreateContext=function(t,e){return this.context||this.getOrCreateCanvas(t,e),this.context},t}();!function(t){t[t.CAMERA_CHANGED=0]="CAMERA_CHANGED",t[t.DISPLAY_OBJECT_CHANGED=1]="DISPLAY_OBJECT_CHANGED",t[t.NONE=2]="NONE"}(oo||(oo={}));var _o,yo=function(){function t(t,e){this.globalRuntime=t,this.context=e,this.inited=!1,this.stats={total:0,rendered:0},this.zIndexCounter=0,this.hooks={init:new Vn,initAsync:new Yn,dirtycheck:new Wn,cull:new Wn,beginFrame:new Vn,beforeRender:new Vn,render:new Vn,afterRender:new Vn,endFrame:new Vn,destroy:new Vn,pick:new zn,pickSync:new Wn,pointerDown:new Vn,pointerUp:new Vn,pointerMove:new Vn,pointerOut:new Vn,pointerOver:new Vn,pointerWheel:new Vn,pointerCancel:new Vn,click:new Vn}}return t.prototype.init=function(t){var e=this,i=r(r({},this.globalRuntime),this.context);this.context.renderingPlugins.forEach(function(t){t.apply(i,e.globalRuntime)}),this.hooks.init.call(),0===this.hooks.initAsync.getCallbacksNum()?(this.inited=!0,t()):this.hooks.initAsync.promise().then(function(){e.inited=!0,t()})},t.prototype.getStats=function(){return this.stats},t.prototype.disableDirtyRectangleRendering=function(){return!this.context.config.renderer.getConfig().enableDirtyRectangleRendering||this.context.renderingContext.renderReasons.has(oo.CAMERA_CHANGED)},t.prototype.render=function(t,e){var i=this;this.stats.total=0,this.stats.rendered=0,this.zIndexCounter=0;var a=this.context.renderingContext;if(this.globalRuntime.sceneGraphService.syncHierarchy(a.root),this.globalRuntime.sceneGraphService.triggerPendingEvents(),a.renderReasons.size&&this.inited){a.dirtyRectangleRenderingDisabled=this.disableDirtyRectangleRendering();var s=1===a.renderReasons.size&&a.renderReasons.has(oo.CAMERA_CHANGED),n=!t.disableRenderHooks||!(t.disableRenderHooks&&s);n&&this.renderDisplayObject(a.root,t,a),this.hooks.beginFrame.call(),n&&a.renderListCurrentFrame.forEach(function(t){i.hooks.beforeRender.call(t),i.hooks.render.call(t),i.hooks.afterRender.call(t)}),this.hooks.endFrame.call(),a.renderListCurrentFrame=[],a.renderReasons.clear(),e()}},t.prototype.renderDisplayObject=function(t,e,i){var a=this,s=e.renderer.getConfig(),n=s.enableDirtyCheck,o=s.enableCulling;this.globalRuntime.enableCSSParsing&&this.globalRuntime.styleValueRegistry.recalc(t);var r=t.renderable,l=n?r.dirty||i.dirtyRectangleRenderingDisabled?t:null:t;if(l){var c=o?this.hooks.cull.call(l,this.context.camera):l;c&&(this.stats.rendered++,i.renderListCurrentFrame.push(c))}t.renderable.dirty=!1,t.sortable.renderOrder=this.zIndexCounter++,this.stats.total++;var d=t.sortable;d.dirty&&(this.sort(t,d),d.dirty=!1,d.dirtyChildren=[],d.dirtyReason=void 0),(d.sorted||t.childNodes).forEach(function(t){a.renderDisplayObject(t,e,i)})},t.prototype.sort=function(t,e){e.sorted&&e.dirtyReason!==va.Z_INDEX_CHANGED?e.dirtyChildren.forEach(function(i){if(-1===t.childNodes.indexOf(i)){var a=e.sorted.indexOf(i);a>=0&&e.sorted.splice(a,1)}else if(0===e.sorted.length)e.sorted.push(i);else{var s=function(t,e){for(var i=0,a=t.length;i<a;){var s=i+a>>>1;xn(t[s],e)<0?i=s+1:a=s}return i}(e.sorted,i);e.sorted.splice(s,0,i)}}):e.sorted=t.childNodes.slice().sort(xn)},t.prototype.destroy=function(){this.inited=!1,this.hooks.destroy.call(),this.globalRuntime.sceneGraphService.clearPendingEvents()},t.prototype.dirtify=function(){this.context.renderingContext.renderReasons.add(oo.DISPLAY_OBJECT_CHANGED)},t}(),vo=/\[\s*(.*)=(.*)\s*\]/,bo=function(){function t(){}return t.prototype.selectOne=function(t,e){var i=this;if(t.startsWith("."))return e.find(function(e){return((null==e?void 0:e.classList)||[]).indexOf(i.getIdOrClassname(t))>-1});if(t.startsWith("#"))return e.find(function(e){return e.id===i.getIdOrClassname(t)});if(t.startsWith("[")){var a=this.getAttribute(t),s=a.name,n=a.value;return s?e.find(function(t){return e!==t&&("name"===s?t.name===n:i.attributeToString(t,s)===n)}):null}return e.find(function(i){return e!==i&&i.nodeName===t})},t.prototype.selectAll=function(t,e){var i=this;if(t.startsWith("."))return e.findAll(function(a){return e!==a&&((null==a?void 0:a.classList)||[]).indexOf(i.getIdOrClassname(t))>-1});if(t.startsWith("#"))return e.findAll(function(a){return e!==a&&a.id===i.getIdOrClassname(t)});if(t.startsWith("[")){var a=this.getAttribute(t),s=a.name,n=a.value;return s?e.findAll(function(t){return e!==t&&("name"===s?t.name===n:i.attributeToString(t,s)===n)}):[]}return e.findAll(function(i){return e!==i&&i.nodeName===t})},t.prototype.is=function(t,e){if(t.startsWith("."))return e.className===this.getIdOrClassname(t);if(t.startsWith("#"))return e.id===this.getIdOrClassname(t);if(t.startsWith("[")){var i=this.getAttribute(t),a=i.name,s=i.value;return"name"===a?e.name===s:this.attributeToString(e,a)===s}return e.nodeName===t},t.prototype.getIdOrClassname=function(t){return t.substring(1)},t.prototype.getAttribute=function(t){var e=t.match(vo),i="",a="";return e&&e.length>2&&(i=e[1].replace(/"/g,""),a=e[2].replace(/"/g,"")),{name:i,value:a}},t.prototype.attributeToString=function(t,e){if(!t.getAttribute)return"";var i=t.getAttribute(e);return le(i)?"":i.toString?i.toString():""},t}(),Eo=function(t){function e(e,i,a,s,n,o,r,l){var c=t.call(this,null)||this;return c.relatedNode=i,c.prevValue=a,c.newValue=s,c.attrName=n,c.attrChange=o,c.prevParsedValue=r,c.newParsedValue=l,c.type=e,c}return o(e,t),e.ADDITION=2,e.MODIFICATION=1,e.REMOVAL=3,e}(ro);function Ao(t){var e=t.renderable;e&&(e.renderBoundsDirty=!0,e.boundsDirty=!0)}!function(t){t.REPARENT="reparent",t.DESTROY="destroy",t.ATTR_MODIFIED="DOMAttrModified",t.INSERTED="DOMNodeInserted",t.REMOVED="removed",t.MOUNTED="DOMNodeInsertedIntoDocument",t.UNMOUNTED="DOMNodeRemovedFromDocument",t.BOUNDS_CHANGED="bounds-changed",t.CULLED="culled"}(_o||(_o={}));var wo,So,Co,Io=new Eo(_o.REPARENT,null,"","","",0,"",""),xo=function(){function t(t){var e,i,a,s,n,o,r,l,c=this;this.runtime=t,this.pendingEvents=[],this.boundsChangedEvent=new uo(_o.BOUNDS_CHANGED),this.rotate=(e=yt(),function(t,i,a,s){void 0===a&&(a=0),void 0===s&&(s=0),"number"==typeof i&&(i=it(i,a,s));var n=t.transformable;if(null!==t.parentNode&&t.parentNode.transformable){var o=yt();At(o,i[0],i[1],i[2]);var r=c.getRotation(t),l=c.getRotation(t.parentNode);St(e,l),Et(e,e),bt(o,e,o),bt(n.localRotation,o,r),It(n.localRotation,n.localRotation),c.dirtifyLocal(t,n)}else c.rotateLocal(t,i)}),this.rotateLocal=(i=yt(),function(t,e,a,s){void 0===a&&(a=0),void 0===s&&(s=0),"number"==typeof e&&(e=it(e,a,s));var n=t.transformable;At(i,e[0],e[1],e[2]),Ct(n.localRotation,n.localRotation,i),c.dirtifyLocal(t,n)}),this.setEulerAngles=(a=yt(),function(t,e,i,s){void 0===i&&(i=0),void 0===s&&(s=0),"number"==typeof e&&(e=it(e,i,s));var n=t.transformable;if(null!==t.parentNode&&t.parentNode.transformable){At(n.localRotation,e[0],e[1],e[2]);var o=c.getRotation(t.parentNode);St(a,Et(yt(),o)),Ct(n.localRotation,n.localRotation,a),c.dirtifyLocal(t,n)}else c.setLocalEulerAngles(t,e)}),this.translateLocal=function(t,e,i,a){void 0===i&&(i=0),void 0===a&&(a=0),"number"==typeof e&&(e=it(e,i,a));var s=t.transformable;ut(e,Z())||(function(t,e,i){var a=i[0],s=i[1],n=i[2],o=i[3],r=e[0],l=e[1],c=e[2],d=s*c-n*l,h=n*r-a*c,u=a*l-s*r,p=s*u-n*h,m=n*d-a*u,f=a*h-s*d,g=2*o;d*=g,h*=g,u*=g,p*=2,m*=2,f*=2,t[0]=r+d+p,t[1]=l+h+m,t[2]=c+u+f}(e,e,s.localRotation),nt(s.localPosition,s.localPosition,e),c.dirtifyLocal(t,s))},this.setPosition=(s=A(),n=Z(),function(t,e){var i=t.transformable;if(n[0]=e[0],n[1]=e[1],n[2]=e[2]||0,!ut(c.getPosition(t),n)){if(at(i.position,n),null!==t.parentNode&&t.parentNode.transformable){var a=t.parentNode.transformable;S(s,a.worldTransform),T(s,s),ht(i.localPosition,n,s)}else at(i.localPosition,n);c.dirtifyLocal(t,i)}}),this.setLocalPosition=function(){var t=Z();return function(e,i){var a=e.transformable;t[0]=i[0],t[1]=i[1],t[2]=i[2]||0,ut(a.localPosition,t)||(at(a.localPosition,t),c.dirtifyLocal(e,a))}}(),this.translate=(o=Z(),r=Z(),l=Z(),function(t,e,i,a){void 0===i&&(i=0),void 0===a&&(a=0),"number"==typeof e&&(e=st(r,e,i,a)),ut(e,o)||(nt(l,c.getPosition(t),e),c.setPosition(t,l))}),this.setRotation=function(){var t=yt();return function(e,i,a,s,n){var o=e.transformable;if("number"==typeof i&&(i=wt(i,a,s,n)),null!==e.parentNode&&e.parentNode.transformable){var r=c.getRotation(e.parentNode);St(t,r),Et(t,t),bt(o.localRotation,t,i),It(o.localRotation,o.localRotation),c.dirtifyLocal(e,o)}else c.setLocalRotation(e,i)}},this.displayObjectDependencyMap=new WeakMap,this.calcLocalTransform=function(){var t=A(),e=Z(),i=wt(0,0,0,1);return function(a){if(0!==a.localSkew[0]||0!==a.localSkew[1]){if(B(a.localTransform,a.localRotation,a.localPosition,it(1,1,1),a.origin),0!==a.localSkew[0]||0!==a.localSkew[1]){var s=I(t);s[4]=Math.tan(a.localSkew[0]),s[1]=Math.tan(a.localSkew[1]),P(a.localTransform,a.localTransform,s)}var n=B(t,i,e,a.localScale,a.origin);P(a.localTransform,a.localTransform,n)}else B(a.localTransform,a.localRotation,a.localPosition,a.localScale,a.origin)}}()}return t.prototype.matches=function(t,e){return this.runtime.sceneGraphSelector.is(t,e)},t.prototype.querySelector=function(t,e){return this.runtime.sceneGraphSelector.selectOne(t,e)},t.prototype.querySelectorAll=function(t,e){return this.runtime.sceneGraphSelector.selectAll(t,e)},t.prototype.attach=function(t,e,i){var a,s,n=!1;t.parentNode&&(n=t.parentNode!==e,this.detach(t)),t.parentNode=e,le(i)?t.parentNode.childNodes.push(t):t.parentNode.childNodes.splice(i,0,t);var o=e.sortable;((null===(a=null==o?void 0:o.sorted)||void 0===a?void 0:a.length)||(null===(s=t.style)||void 0===s?void 0:s.zIndex))&&(-1===o.dirtyChildren.indexOf(t)&&o.dirtyChildren.push(t),o.dirty=!0,o.dirtyReason=va.ADDED);var r=t.transformable;r&&this.dirtifyWorld(t,r),r.frozen&&this.unfreezeParentToRoot(t),n&&t.dispatchEvent(Io)},t.prototype.detach=function(t){var e,i;if(t.parentNode){var a=t.transformable,s=t.parentNode.sortable;((null===(e=null==s?void 0:s.sorted)||void 0===e?void 0:e.length)||(null===(i=t.style)||void 0===i?void 0:i.zIndex))&&(-1===s.dirtyChildren.indexOf(t)&&s.dirtyChildren.push(t),s.dirty=!0,s.dirtyReason=va.REMOVED);var n=t.parentNode.childNodes.indexOf(t);n>-1&&t.parentNode.childNodes.splice(n,1),a&&this.dirtifyWorld(t,a),t.parentNode=null}},t.prototype.getOrigin=function(t){return t.transformable.origin},t.prototype.setOrigin=function(t,e,i,a){void 0===i&&(i=0),void 0===a&&(a=0),"number"==typeof e&&(e=[e,i,a]);var s=t.transformable;if(e[0]!==s.origin[0]||e[1]!==s.origin[1]||e[2]!==s.origin[2]){var n=s.origin;n[0]=e[0],n[1]=e[1],n[2]=e[2]||0,this.dirtifyLocal(t,s)}},t.prototype.setLocalEulerAngles=function(t,e,i,a){void 0===i&&(i=0),void 0===a&&(a=0),"number"==typeof e&&(e=it(e,i,a));var s=t.transformable;At(s.localRotation,e[0],e[1],e[2]),this.dirtifyLocal(t,s)},t.prototype.scaleLocal=function(t,e){var i,a,s,n=t.transformable;i=n.localScale,a=n.localScale,s=it(e[0],e[1],e[2]||1),i[0]=a[0]*s[0],i[1]=a[1]*s[1],i[2]=a[2]*s[2],this.dirtifyLocal(t,n)},t.prototype.setLocalScale=function(t,e){var i=t.transformable,a=it(e[0],e[1],e[2]||i.localScale[2]);ut(a,i.localScale)||(at(i.localScale,a),this.dirtifyLocal(t,i))},t.prototype.setLocalRotation=function(t,e,i,a,s){"number"==typeof e&&(e=wt(e,i,a,s));var n=t.transformable;St(n.localRotation,e),this.dirtifyLocal(t,n)},t.prototype.setLocalSkew=function(t,e,i){"number"==typeof e&&(e=function(t,e){var i=new b(2);return i[0]=t,i[1]=e,i}(e,i));var a,s,n=t.transformable;s=e,(a=n.localSkew)[0]=s[0],a[1]=s[1],this.dirtifyLocal(t,n)},t.prototype.dirtifyLocal=function(t,e){e.localDirtyFlag||(e.localDirtyFlag=!0,e.dirtyFlag||this.dirtifyWorld(t,e))},t.prototype.dirtifyWorld=function(t,e){e.dirtyFlag||this.unfreezeParentToRoot(t),this.dirtifyWorldInternal(t,e),this.dirtifyToRoot(t,!0)},t.prototype.triggerPendingEvents=function(){var t=this,e=new Set,i=function(i,a){i.isConnected&&!e.has(i.entity)&&(t.boundsChangedEvent.detail=a,t.boundsChangedEvent.target=i,i.isMutationObserved?i.dispatchEvent(t.boundsChangedEvent):i.ownerDocument.defaultView.dispatchEvent(t.boundsChangedEvent,!0),e.add(i.entity))};this.pendingEvents.forEach(function(t){var e=u(t,2),a=e[0],s=e[1];s.affectChildren?a.forEach(function(t){i(t,s)}):i(a,s)}),this.clearPendingEvents(),e.clear()},t.prototype.clearPendingEvents=function(){this.pendingEvents=[]},t.prototype.dirtifyToRoot=function(t,e){void 0===e&&(e=!1);var i=t;for(i.renderable&&(i.renderable.dirty=!0);i;)Ao(i),i=i.parentNode;e&&t.forEach(function(t){Ao(t)}),this.informDependentDisplayObjects(t),this.pendingEvents.push([t,{affectChildren:e}])},t.prototype.updateDisplayObjectDependency=function(t,e,i,a){if(e&&e!==i){var s=this.displayObjectDependencyMap.get(e);if(s&&s[t]){var n=s[t].indexOf(a);s[t].splice(n,1)}}if(i){var o=this.displayObjectDependencyMap.get(i);o||(this.displayObjectDependencyMap.set(i,{}),o=this.displayObjectDependencyMap.get(i)),o[t]||(o[t]=[]),o[t].push(a)}},t.prototype.informDependentDisplayObjects=function(t){var e=this,i=this.displayObjectDependencyMap.get(t);i&&Object.keys(i).forEach(function(t){i[t].forEach(function(i){e.dirtifyToRoot(i,!0),i.dispatchEvent(new Eo(_o.ATTR_MODIFIED,i,e,e,t,Eo.MODIFICATION,e,e)),i.isCustomElement&&i.isConnected&&i.attributeChangedCallback&&i.attributeChangedCallback(t,e,e)})})},t.prototype.getPosition=function(t){var e=t.transformable;return $(e.position,this.getWorldTransform(t,e))},t.prototype.getRotation=function(t){var e=t.transformable;return G(e.rotation,this.getWorldTransform(t,e))},t.prototype.getScale=function(t){var e=t.transformable;return q(e.scaling,this.getWorldTransform(t,e))},t.prototype.getWorldTransform=function(t,e){return void 0===e&&(e=t.transformable),e.localDirtyFlag||e.dirtyFlag?(t.parentNode&&t.parentNode.transformable&&this.getWorldTransform(t.parentNode),this.sync(t,e),e.worldTransform):e.worldTransform},t.prototype.getLocalPosition=function(t){return t.transformable.localPosition},t.prototype.getLocalRotation=function(t){return t.transformable.localRotation},t.prototype.getLocalScale=function(t){return t.transformable.localScale},t.prototype.getLocalSkew=function(t){return t.transformable.localSkew},t.prototype.getLocalTransform=function(t){var e=t.transformable;return e.localDirtyFlag&&(this.calcLocalTransform(e),e.localDirtyFlag=!1),e.localTransform},t.prototype.setLocalTransform=function(t,e){var i=$(Z(),e),a=G(yt(),e),s=q(Z(),e);this.setLocalScale(t,s),this.setLocalPosition(t,i),this.setLocalRotation(t,a)},t.prototype.resetLocalTransform=function(t){this.setLocalScale(t,[1,1,1]),this.setLocalPosition(t,[0,0,0]),this.setLocalEulerAngles(t,[0,0,0]),this.setLocalSkew(t,[0,0])},t.prototype.getTransformedGeometryBounds=function(t,e,i){void 0===e&&(e=!1);var a=this.getGeometryBounds(t,e);if(ki.isEmpty(a))return null;var s=i||new ki;return s.setFromTransformedAABB(a,this.getWorldTransform(t)),s},t.prototype.getGeometryBounds=function(t,e){void 0===e&&(e=!1);var i=t.geometry;return(e?i.renderBounds:i.contentBounds||null)||new ki},t.prototype.getBounds=function(t,e){var i=this;void 0===e&&(e=!1);var a=t.renderable;if(!a.boundsDirty&&!e&&a.bounds)return a.bounds;if(!a.renderBoundsDirty&&e&&a.renderBounds)return a.renderBounds;var s=e?a.renderBounds:a.bounds,n=this.getTransformedGeometryBounds(t,e,s);if(t.childNodes.forEach(function(t){var a=i.getBounds(t,e);a&&(n?n.add(a):(n=s||new ki).update(a.center,a.halfExtents))}),e){var o=Tn(t);if(o){var r=o.parsedStyle.clipPath.getBounds(e);n?r&&(n=r.intersection(n)):n=r}}return n||(n=new ki),n&&(e?a.renderBounds=n:a.bounds=n),e?a.renderBoundsDirty=!1:a.boundsDirty=!1,n},t.prototype.getLocalBounds=function(t){if(t.parentNode){var e=A();t.parentNode.transformable&&(e=T(A(),this.getWorldTransform(t.parentNode)));var i=this.getBounds(t);if(!ki.isEmpty(i)){var a=new ki;return a.setFromTransformedAABB(i,e),a}}return this.getBounds(t)},t.prototype.getBoundingClientRect=function(t){var e,i,a,s=this.getGeometryBounds(t);ki.isEmpty(s)||(a=new ki).setFromTransformedAABB(s,this.getWorldTransform(t));var n=null===(i=null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView)||void 0===i?void 0:i.getContextService().getBoundingClientRect();if(a){var o=u(a.getMin(),2),r=o[0],l=o[1],c=u(a.getMax(),2),d=c[0],h=c[1];return new Ui(r+((null==n?void 0:n.left)||0),l+((null==n?void 0:n.top)||0),d-r,h-l)}return new Ui((null==n?void 0:n.left)||0,(null==n?void 0:n.top)||0,0,0)},t.prototype.dirtifyWorldInternal=function(t,e){var i=this;if(!e.dirtyFlag){e.dirtyFlag=!0,e.frozen=!1,t.childNodes.forEach(function(t){var e=t.transformable;e.dirtyFlag||i.dirtifyWorldInternal(t,e)});var a=t.renderable;a&&(a.renderBoundsDirty=!0,a.boundsDirty=!0,a.dirty=!0)}},t.prototype.syncHierarchy=function(t){var e=t.transformable;if(!e.frozen){e.frozen=!0,(e.localDirtyFlag||e.dirtyFlag)&&this.sync(t,e);for(var i=t.childNodes,a=0;a<i.length;a++)this.syncHierarchy(i[a])}},t.prototype.sync=function(t,e){if(e.localDirtyFlag&&(this.calcLocalTransform(e),e.localDirtyFlag=!1),e.dirtyFlag){var i=t.parentNode,a=i&&i.transformable;null!==i&&a?P(e.worldTransform,a.worldTransform,e.localTransform):S(e.worldTransform,e.localTransform),e.dirtyFlag=!1}},t.prototype.unfreezeParentToRoot=function(t){for(var e=t.parentNode;e;){var i=e.transformable;i&&(i.frozen=!1),e=e.parentNode}},t}(),To={MetricsString:"|ÃqÃ",BaselineSymbol:"M",BaselineMultiplier:1.4,HeightMultiplier:2,Newlines:[10,13],BreakingSpaces:[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288]},Mo=/[a-zA-Z0-9\u00C0-\u00D6\u00D8-\u00f6\u00f8-\u00ff!"#$%&'()*+,-./:;]/,Po=new RegExp("".concat(/[!%),.:;?\]}Â¢Â°Â·'""â â¡âºââ¶ãããããããï¹ï¹ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼½ï½ï½]/.source,"|").concat(/[!),.:;?\]}Â¢Â·ââ'"â¢"ããããããããï¸°ï¸±ï¸²ï¸³ï¹ï¹ï¹ï¹ï¹ï¹ï¹ï¹ï¹ï¹ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¸¶ï¸¸ï¸ºï¸¼ï¸¾ï¹ï¹ï¹ï¼½ï½ï½ï½¤]/.source,"|").concat(/[)\]ï½ããããããããã'"ï½ Â»ã½ã¾ã¼ã¡ã£ã¥ã§ã©ãã£ã¥ã§ã®ãµã¶ãããããã£ããããããã°ã±ã²ã³ã´ãµã¶ã·ã¸ã¹ãºã»ã¼ã½ã¾ã¿ãã»âã âã?!â¼âââã»ã:;,ã.]/.source,"|").concat(/[!%),.:;?\]}Â¢Â°'"â â¡âããããããï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼½ï½]/.source)),Oo=new RegExp("".concat(/[$(Â£Â¥Â·'"ããããããããï¹ï¹ï¼ï¼ï¼ï¼»ï½ï¿¡ï¿¥]/.source,"|").concat(/[([{Â£Â¥'"âµããããããï¸´ï¹ï¹ï¼ï½ï¸µï¸·ï¸¹ï¸»ï¸½ï¸¿ï¹ï¹ï¹]/.source,"|").concat(/[([ï½ããããããããã'"ï½Â«â...â¥ã³ã´ãµ]/.source,"|").concat(/[$([{Â£Â¥'"ããããããï¼ï¼ï¼»ï½ï½ ï¿¥ï¿¦#]/.source)),Lo=function(){function t(t){var e=this;this.runtime=t,this.fontMetricsCache={},this.shouldBreakByKinsokuShorui=function(t,i){return!e.isBreakingSpace(i)&&!(!t||!Oo.exec(i)&&!Po.exec(t))},this.trimByKinsokuShorui=function(t){var e=p([],u(t),!1),i=e[e.length-2];if(!i)return t;var a=i[i.length-1];return e[e.length-2]=i.slice(0,-1),e[e.length-1]=a+e[e.length-1],e}}return t.prototype.measureFont=function(t,e){if(this.fontMetricsCache[t])return this.fontMetricsCache[t];var i={ascent:0,descent:0,fontSize:0},a=this.runtime.offscreenCanvasCreator.getOrCreateCanvas(e),s=this.runtime.offscreenCanvasCreator.getOrCreateContext(e,{willReadFrequently:!0});s.font=t;var n=To.MetricsString+To.BaselineSymbol,o=Math.ceil(s.measureText(n).width),r=Math.ceil(s.measureText(To.BaselineSymbol).width),l=To.HeightMultiplier*r;r=r*To.BaselineMultiplier|0,a.width=o,a.height=l,s.fillStyle="#f00",s.fillRect(0,0,o,l),s.font=t,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(n,0,r);var c=s.getImageData(0,0,o||1,l||1).data,d=c.length,h=4*o,u=0,p=0,m=!1;for(u=0;u<r;++u){for(var f=0;f<h;f+=4)if(255!==c[p+f]){m=!0;break}if(m)break;p+=h}for(i.ascent=r-u,p=d-h,m=!1,u=l;u>r;--u){for(f=0;f<h;f+=4)if(255!==c[p+f]){m=!0;break}if(m)break;p-=h}return i.descent=u-r,i.fontSize=i.ascent+i.descent,this.fontMetricsCache[t]=i,i},t.prototype.measureText=function(t,e,i){var a=e.fontSize,s=e.wordWrap,n=e.lineHeight,o=e.lineWidth,r=e.textBaseline,l=e.textAlign,c=e.letterSpacing,d=e.textPath;e.textPathSide,e.textPathStartOffset;var h=e.leading,u=void 0===h?0:h,p=function(t){for(var e=t.fontSize,i=t.fontFamily,a=t.fontStyle,s=t.fontVariant,n=t.fontWeight,o=_e(e)&&"".concat(e,"px")||"16px",r=i.split(","),l=r.length-1;l>=0;l--){var c=r[l].trim();!Kn.test(c)&&Hn.indexOf(c)<0&&(c='"'.concat(c,'"')),r[l]=c}return"".concat(a," ").concat(s," ").concat(n," ").concat(o," ").concat(r.join(","))}(e),m=this.measureFont(p,i);0===m.fontSize&&(m.fontSize=a,m.ascent=a);var f=this.runtime.offscreenCanvasCreator.getOrCreateContext(i);f.font=p,e.isOverflowing=!1;var g=(s?this.wordWrap(t,e,i):t).split(/(?:\r\n|\r|\n)/),_=new Array(g.length),y=0;if(!d){for(w=0;w<g.length;w++){var v=f.measureText(g[w]).width+(g[w].length-1)*c;_[w]=v,y=Math.max(y,v)}S=y+o;var b=n||m.fontSize+o,E=Math.max(b,m.fontSize+o)+(g.length-1)*(b+u),A=0;return"middle"===r?A=-E/2:"bottom"===r||"alphabetic"===r||"ideographic"===r?A=-E:"top"!==r&&"hanging"!==r||(A=0),{font:p,width:S,height:E,lines:g,lineWidths:_,lineHeight:b+=u,maxLineWidth:y,fontProperties:m,lineMetrics:_.map(function(t,e){var i=0;return"center"===l||"middle"===l?i-=t/2:"right"!==l&&"end"!==l||(i-=t),new Ui(i-o/2,A+e*b,t+o,b)})}}d.getTotalLength();for(var w=0;w<g.length;w++)var S=f.measureText(g[w]).width+(g[w].length-1)*c},t.prototype.setGraphemeOnPath=function(){},t.prototype.wordWrap=function(t,e,i){var a=this,s=e.wordWrapWidth,n=void 0===s?0:s,o=e.letterSpacing,r=e.maxLines,l=void 0===r?1/0:r,c=e.textOverflow,d=this.runtime.offscreenCanvasCreator.getOrCreateContext(i),h=n+o,u="";"ellipsis"===c?u="...":c&&"clip"!==c&&(u=c);for(var p=[],m=0,f=0,g={},_=function(t){return a.getFromCache(t,o,g,d)},y=Array.from(u).reduce(function(t,e){return t+_(e)},0),v=Array.from(t),b=0;b<v.length;b++){var E=v[b],A=t[b-1],w=t[b+1],S=_(E);if(this.isNewline(E)){if(++m>=l){e.isOverflowing=!0;break}f=0,p[m]=""}else{if(f>0&&f+S>h){if(m+1>=l){if(e.isOverflowing=!0,y>0&&y<=h){for(var C=p[m].length,I=0,x=C,T=0;T<C;T++){var M=_(p[m][T]);if(I+M+y>h){x=T;break}I+=M}p[m]=(p[m]||"").slice(0,x)+u}break}if(f=0,p[++m]="",this.isBreakingSpace(E))continue;this.canBreakInLastChar(E)||(p=this.trimToBreakable(p),f=this.sumTextWidthByCache(p[m]||"",g)),this.shouldBreakByKinsokuShorui(E,w)&&(p=this.trimByKinsokuShorui(p),f+=_(A||""))}f+=S,p[m]=(p[m]||"")+E}}return p.join("\n")},t.prototype.isBreakingSpace=function(t){return"string"==typeof t&&To.BreakingSpaces.indexOf(t.charCodeAt(0))>=0},t.prototype.isNewline=function(t){return"string"==typeof t&&To.Newlines.indexOf(t.charCodeAt(0))>=0},t.prototype.trimToBreakable=function(t){var e=p([],u(t),!1),i=e[e.length-2],a=this.findBreakableIndex(i);if(-1===a||!i)return e;var s=i.slice(a,a+1),n=a+1,o=a+(this.isBreakingSpace(s)?0:1);return e[e.length-1]+=i.slice(n,i.length),e[e.length-2]=i.slice(0,o),e},t.prototype.canBreakInLastChar=function(t){return!t||!Mo.test(t)},t.prototype.sumTextWidthByCache=function(t,e){return t.split("").reduce(function(t,i){if(!e[i])throw Error("cannot count the word without cache");return t+e[i]},0)},t.prototype.findBreakableIndex=function(t){for(var e=t.length-1;e>=0;e--)if(!Mo.test(t[e]))return e;return-1},t.prototype.getFromCache=function(t,e,i,a){var s=i[t];if("number"!=typeof s){var n=t.length*e;s=a.measureText(t).width+n,i[t]=s}return s},t}(),Ro={},Do=(So=new so,Co=new ao,(wo={})[mi.CIRCLE]=new Zn,wo[mi.ELLIPSE]=new to,wo[mi.RECT]=So,wo[mi.IMAGE]=So,wo[mi.GROUP]=So,wo[mi.LINE]=new eo,wo[mi.TEXT]=new no(Ro),wo[mi.POLYLINE]=Co,wo[mi.POLYGON]=Co,wo[mi.PATH]=new io,wo[mi.HTML]=null,wo[mi.MESH]=null,wo),No=function(){var t,e=new nn,i=new ln;return(t={})[La.PERCENTAGE]=null,t[La.NUMBER]=new fn,t[La.ANGLE]=new an,t[La.DEFINED_PATH]=new sn,t[La.PAINT]=e,t[La.COLOR]=e,t[La.FILTER]=new on,t[La.LENGTH]=i,t[La.LENGTH_PERCENTAGE]=i,t[La.LENGTH_PERCENTAGE_12]=new cn,t[La.LENGTH_PERCENTAGE_14]=new dn,t[La.COORDINATE]=new pn,t[La.OFFSET_DISTANCE]=new gn,t[La.OPACITY_VALUE]=new _n,t[La.PATH]=new yn,t[La.LIST_OF_POINTS]=new vn,t[La.SHADOW_BLUR]=new bn,t[La.TEXT]=new En,t[La.TEXT_TRANSFORM]=new An,t[La.TRANSFORM]=new Qn,t[La.TRANSFORM_ORIGIN]=new Xn,t[La.Z_INDEX]=new Jn,t[La.MARKER]=new mn,t}();Ro.CameraContribution=Zi,Ro.AnimationTimeline=null,Ro.EasingFunction=null,Ro.offscreenCanvasCreator=new go,Ro.sceneGraphSelector=new bo,Ro.sceneGraphService=new xo(Ro),Ro.textService=new Lo(Ro),Ro.geometryUpdaterFactory=Do,Ro.CSSPropertySyntaxFactory=No,Ro.styleValueRegistry=new en(Ro),Ro.layoutRegistry=null,Ro.globalThis="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:{},Ro.enableCSSParsing=!0,Ro.enableDataset=!1,Ro.enableStyleSyntax=!0,Ro.enableSizeAttenuation=!1;var ko=0;var Fo=new Eo(_o.INSERTED,null,"","","",0,"",""),$o=new Eo(_o.REMOVED,null,"","","",0,"",""),qo=new uo(_o.DESTROY),Go=function(t){function e(){var e=t.apply(this,p([],u(arguments),!1))||this;return e.entity=ko++,e.renderable={bounds:void 0,boundsDirty:!0,renderBounds:void 0,renderBoundsDirty:!0,dirtyRenderBounds:void 0,dirty:!1},e.cullable={strategy:ya.Standard,visibilityPlaneMask:-1,visible:!0,enable:!0},e.transformable={dirtyFlag:!1,localDirtyFlag:!1,frozen:!1,localPosition:[0,0,0],localRotation:[0,0,0,1],localScale:[1,1,1],localTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],localSkew:[0,0],position:[0,0,0],rotation:[0,0,0,1],scaling:[1,1,1],worldTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],origin:[0,0,0]},e.sortable={dirty:!1,sorted:void 0,renderOrder:0,dirtyChildren:[],dirtyReason:void 0},e.geometry={contentBounds:void 0,renderBounds:void 0},e.rBushNode={aabb:void 0},e.namespaceURI="g",e.scrollLeft=0,e.scrollTop=0,e.clientTop=0,e.clientLeft=0,e.destroyed=!1,e.style={},e.computedStyle=Ro.enableCSSParsing?{anchor:Aa,opacity:Aa,fillOpacity:Aa,strokeOpacity:Aa,fill:Aa,stroke:Aa,transform:Aa,transformOrigin:Aa,visibility:Aa,pointerEvents:Aa,lineWidth:Aa,lineCap:Aa,lineJoin:Aa,increasedLineWidthForHitTesting:Aa,fontSize:Aa,fontFamily:Aa,fontStyle:Aa,fontWeight:Aa,fontVariant:Aa,textAlign:Aa,textBaseline:Aa,textTransform:Aa,zIndex:Aa,filter:Aa,shadowType:Aa}:null,e.parsedStyle={},e.attributes={},e}return o(e,t),Object.defineProperty(e.prototype,"className",{get:function(){return this.getAttribute("class")||""},set:function(t){this.setAttribute("class",t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"classList",{get:function(){return this.className.split(" ").filter(function(t){return""!==t})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tagName",{get:function(){return this.nodeName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this.childNodes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"childElementCount",{get:function(){return this.childNodes.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstElementChild",{get:function(){return this.firstChild},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastElementChild",{get:function(){return this.lastChild},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentElement",{get:function(){return this.parentNode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextSibling",{get:function(){if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[t+1]||null}return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousSibling",{get:function(){if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[t-1]||null}return null},enumerable:!1,configurable:!0}),e.prototype.cloneNode=function(t){throw new Error(Yi)},e.prototype.appendChild=function(t,e){var i;if(t.destroyed)throw new Error("Cannot append a destroyed element.");return Ro.sceneGraphService.attach(t,this,e),(null===(i=this.ownerDocument)||void 0===i?void 0:i.defaultView)&&this.ownerDocument.defaultView.mountChildren(t),Fo.relatedNode=this,t.dispatchEvent(Fo),t},e.prototype.insertBefore=function(t,e){if(e){t.parentElement&&t.parentElement.removeChild(t);var i=this.childNodes.indexOf(e);-1===i?this.appendChild(t):this.appendChild(t,i)}else this.appendChild(t);return t},e.prototype.replaceChild=function(t,e){var i=this.childNodes.indexOf(e);return this.removeChild(e),this.appendChild(t,i),e},e.prototype.removeChild=function(t){var e;return $o.relatedNode=this,t.dispatchEvent($o),(null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView)&&t.ownerDocument.defaultView.unmountChildren(t),Ro.sceneGraphService.detach(t),t},e.prototype.removeChildren=function(){for(var t=this.childNodes.length-1;t>=0;t--){var e=this.childNodes[t];this.removeChild(e)}},e.prototype.destroyChildren=function(){for(var t=this.childNodes.length-1;t>=0;t--){var e=this.childNodes[t];e.childNodes.length&&e.destroyChildren(),e.destroy()}},e.prototype.matches=function(t){return Ro.sceneGraphService.matches(t,this)},e.prototype.getElementById=function(t){return Ro.sceneGraphService.querySelector("#".concat(t),this)},e.prototype.getElementsByName=function(t){return Ro.sceneGraphService.querySelectorAll('[name="'.concat(t,'"]'),this)},e.prototype.getElementsByClassName=function(t){return Ro.sceneGraphService.querySelectorAll(".".concat(t),this)},e.prototype.getElementsByTagName=function(t){return Ro.sceneGraphService.querySelectorAll(t,this)},e.prototype.querySelector=function(t){return Ro.sceneGraphService.querySelector(t,this)},e.prototype.querySelectorAll=function(t){return Ro.sceneGraphService.querySelectorAll(t,this)},e.prototype.closest=function(t){var e=this;do{if(Ro.sceneGraphService.matches(t,e))return e;e=e.parentElement}while(null!==e);return null},e.prototype.find=function(t){var e=this,i=null;return this.forEach(function(a){return!(a===e||!t(a)||(i=a,0))}),i},e.prototype.findAll=function(t){var e=this,i=[];return this.forEach(function(a){a!==e&&t(a)&&i.push(a)}),i},e.prototype.after=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(this.parentNode){var a=this.parentNode.childNodes.indexOf(this);e.forEach(function(e,i){var s;return null===(s=t.parentNode)||void 0===s?void 0:s.appendChild(e,a+i+1)})}},e.prototype.before=function(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(this.parentNode){var a=this.parentNode.childNodes.indexOf(this),s=u(e),n=s[0],o=s.slice(1);this.parentNode.appendChild(n,a),(t=n).after.apply(t,p([],u(o),!1))}},e.prototype.replaceWith=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.after.apply(this,p([],u(t),!1)),this.remove()},e.prototype.append=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];e.forEach(function(e){return t.appendChild(e)})},e.prototype.prepend=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];e.forEach(function(e,i){return t.appendChild(e,i)})},e.prototype.replaceChildren=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(;this.childNodes.length&&this.firstChild;)this.removeChild(this.firstChild);this.append.apply(this,p([],u(t),!1))},e.prototype.remove=function(){return this.parentNode?this.parentNode.removeChild(this):this},e.prototype.destroy=function(){this.dispatchEvent(qo),this.remove(),this.emitter.removeAllListeners(),this.destroyed=!0},e.prototype.getGeometryBounds=function(){return Ro.sceneGraphService.getGeometryBounds(this)},e.prototype.getRenderBounds=function(){return Ro.sceneGraphService.getBounds(this,!0)},e.prototype.getBounds=function(){return Ro.sceneGraphService.getBounds(this)},e.prototype.getLocalBounds=function(){return Ro.sceneGraphService.getLocalBounds(this)},e.prototype.getBoundingClientRect=function(){return Ro.sceneGraphService.getBoundingClientRect(this)},e.prototype.getClientRects=function(){return[this.getBoundingClientRect()]},e.prototype.computedStyleMap=function(){return new Map(Object.entries(this.computedStyle))},e.prototype.getAttributeNames=function(){return Object.keys(this.attributes)},e.prototype.getAttribute=function(t){if(function(t){return"symbol"==typeof t}(t))return Ro.enableCSSParsing?null:void 0;var e=this.attributes[t];if(void 0===e){var i=ma(t);return e=this.attributes[i],Ro.enableCSSParsing&&le(e)?null:e}return e},e.prototype.hasAttribute=function(t){return this.getAttributeNames().includes(t)},e.prototype.hasAttributes=function(){return!!this.getAttributeNames().length},e.prototype.removeAttribute=function(t){this.setAttribute(t,null),delete this.attributes[t]},e.prototype.setAttribute=function(t,e,i){this.attributes[t]=e},e.prototype.getAttributeNS=function(t,e){throw new Error(Yi)},e.prototype.getAttributeNode=function(t){throw new Error(Yi)},e.prototype.getAttributeNodeNS=function(t,e){throw new Error(Yi)},e.prototype.hasAttributeNS=function(t,e){throw new Error(Yi)},e.prototype.removeAttributeNS=function(t,e){throw new Error(Yi)},e.prototype.removeAttributeNode=function(t){throw new Error(Yi)},e.prototype.setAttributeNS=function(t,e,i){throw new Error(Yi)},e.prototype.setAttributeNode=function(t){throw new Error(Yi)},e.prototype.setAttributeNodeNS=function(t){throw new Error(Yi)},e.prototype.toggleAttribute=function(t,e){throw new Error(Yi)},e}(mo);function Bo(t){return!!(null==t?void 0:t.nodeName)}var jo,Uo=new Eo(_o.ATTR_MODIFIED,null,null,null,null,Eo.MODIFICATION,null,null),Yo={anchor:"",opacity:"",fillOpacity:"",strokeOpacity:"",fill:"",stroke:"",transform:"",transformOrigin:"",visibility:"",pointerEvents:"",lineWidth:"",lineCap:"",lineJoin:"",increasedLineWidthForHitTesting:"",fontSize:"",fontFamily:"",fontStyle:"",fontWeight:"",fontVariant:"",textAlign:"",textBaseline:"",textTransform:"",zIndex:"",filter:"",shadowType:""},zo={anchor:[0,0],fill:xa,stroke:xa,transform:[],zIndex:0,filter:[],shadowType:"outer",miterLimit:10},Vo=r(r({},zo),{opacity:1,fillOpacity:1,strokeOpacity:1,visibility:"visible",pointerEvents:"auto",lineWidth:1,lineCap:"butt",lineJoin:"miter",increasedLineWidthForHitTesting:0,fillRule:"nonzero"}),Wo=p(p([],u(["opacity","fillOpacity","strokeOpacity","transformOrigin","visibility","pointerEvents","lineWidth","lineCap","lineJoin","increasedLineWidthForHitTesting"]),!1),["fontSize","fontFamily","fontStyle","fontWeight","fontVariant","textAlign","textBaseline","textTransform"],!1),Ho="data-",Ko=function(t){function e(e){var i,a=t.call(this)||this;a.isCustomElement=!1,a.isMutationObserved=!1,a.activeAnimations=[],a.getClip=function(){return this.style.clipPath||null},a.config=e,a.config.interactive=null!==(i=a.config.capture)&&void 0!==i?i:a.config.interactive,a.id=a.config.id||"",a.name=a.config.name||"",(a.config.className||a.config.class)&&(a.className=a.config.className||a.config.class),a.nodeName=a.config.type||mi.GROUP,a.config.style=a.config.style||a.config.attrs||{},Object.assign(a.config.style,a.config.attrs),null!=a.config.visible&&(a.config.style.visibility=!1===a.config.visible?"hidden":"visible"),null!=a.config.interactive&&(a.config.style.pointerEvents=!1===a.config.interactive?"none":"auto"),Object.assign(a.parsedStyle,Ro.enableCSSParsing?zo:Vo,a.config.initialParsedStyle),Ro.enableCSSParsing&&Object.assign(a.attributes,Yo),a.initAttributes(a.config.style);var s=Ro.globalThis.Proxy?Ro.globalThis.Proxy:function(){};return Ro.enableDataset&&(a.dataset=new s({},{get:function(t,e){var i="".concat(Ho).concat(ha(e));return void 0!==t[i]?t[i]:a.getAttribute(i)},set:function(t,e,i){return a.setAttribute("".concat(Ho).concat(ha(e)),i),!0}})),Ro.enableStyleSyntax&&(a.style=new s({setProperty:function(t,e){a.setAttribute(t,e)},getPropertyValue:function(t){return a.getAttribute(t)},removeProperty:function(t){a.removeAttribute(t)},item:function(){return""}},{get:function(t,e){return void 0!==t[e]?t[e]:a.getAttribute(e)},set:function(t,e,i){return a.setAttribute(e,i),!0}})),a}return o(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.getAnimations().forEach(function(t){t.cancel()})},e.prototype.cloneNode=function(t,e){var i=r({},this.attributes);for(var a in i){var s=i[a];Bo(s)&&"clipPath"!==a&&"offsetPath"!==a&&"textPath"!==a&&(i[a]=s.cloneNode(t)),e&&(i[a]=e(a,s))}var n=new this.constructor({id:this.id,name:this.name,className:this.name,interactive:this.interactive,style:i});return n.setLocalTransform(this.getLocalTransform()),t&&this.children.forEach(function(e){if(!e.style.isMarker){var i=e.cloneNode(t);n.appendChild(i)}}),n},e.prototype.initAttributes=function(t){void 0===t&&(t={});var e=this.renderable,i={forceUpdateGeometry:!0};Ro.enableCSSParsing&&(i.usedAttributes=Wo);var a={};for(var s in t)a[ma(s)]=t[s];Ro.styleValueRegistry.processProperties(this,a,i),e.dirty=!0},e.prototype.setAttribute=function(e,i,a,s){void 0===a&&(a=!1),void 0===s&&(s=!0);var n=ma(e);Ee(i)||(a||i!==this.attributes[n])&&(this.internalSetAttribute(n,i,{memoize:s}),t.prototype.setAttribute.call(this,n,i))},e.prototype.internalSetAttribute=function(t,e,i){var a;void 0===i&&(i={});var s=this.renderable,n=this.attributes[t],o=this.parsedStyle[t];Ro.styleValueRegistry.processProperties(this,((a={})[t]=e,a),i),s.dirty=!0;var r=this.parsedStyle[t];this.isConnected&&(Uo.relatedNode=this,Uo.prevValue=n,Uo.newValue=e,Uo.attrName=t,Uo.prevParsedValue=o,Uo.newParsedValue=r,this.isMutationObserved?this.dispatchEvent(Uo):(Uo.target=this,this.ownerDocument.defaultView.dispatchEvent(Uo,!0))),(this.isCustomElement&&this.isConnected||!this.isCustomElement)&&this.attributeChangedCallback&&this.attributeChangedCallback(t,n,e,o,r)},e.prototype.getBBox=function(){var t=this.getBounds(),e=u(t.getMin(),2),i=e[0],a=e[1],s=u(t.getMax(),2),n=s[0],o=s[1];return new Ui(i,a,n-i,o-a)},e.prototype.setOrigin=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),Ro.sceneGraphService.setOrigin(this,Si(t,e,i)),this},e.prototype.getOrigin=function(){return Ro.sceneGraphService.getOrigin(this)},e.prototype.setPosition=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),Ro.sceneGraphService.setPosition(this,Si(t,e,i)),this},e.prototype.setLocalPosition=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),Ro.sceneGraphService.setLocalPosition(this,Si(t,e,i)),this},e.prototype.translate=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),Ro.sceneGraphService.translate(this,Si(t,e,i)),this},e.prototype.translateLocal=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),Ro.sceneGraphService.translateLocal(this,Si(t,e,i)),this},e.prototype.getPosition=function(){return Ro.sceneGraphService.getPosition(this)},e.prototype.getLocalPosition=function(){return Ro.sceneGraphService.getLocalPosition(this)},e.prototype.scale=function(t,e,i){return this.scaleLocal(t,e,i)},e.prototype.scaleLocal=function(t,e,i){return"number"==typeof t&&(t=Si(t,e=e||t,i=i||t)),Ro.sceneGraphService.scaleLocal(this,t),this},e.prototype.setLocalScale=function(t,e,i){return"number"==typeof t&&(t=Si(t,e=e||t,i=i||t)),Ro.sceneGraphService.setLocalScale(this,t),this},e.prototype.getLocalScale=function(){return Ro.sceneGraphService.getLocalScale(this)},e.prototype.getScale=function(){return Ro.sceneGraphService.getScale(this)},e.prototype.getEulerAngles=function(){return Ii(u(xi(Z(),Ro.sceneGraphService.getWorldTransform(this)),3)[2])},e.prototype.getLocalEulerAngles=function(){return Ii(u(xi(Z(),Ro.sceneGraphService.getLocalRotation(this)),3)[2])},e.prototype.setEulerAngles=function(t){return Ro.sceneGraphService.setEulerAngles(this,0,0,t),this},e.prototype.setLocalEulerAngles=function(t){return Ro.sceneGraphService.setLocalEulerAngles(this,0,0,t),this},e.prototype.rotateLocal=function(t,e,i){return le(e)&&le(i)?Ro.sceneGraphService.rotateLocal(this,0,0,t):Ro.sceneGraphService.rotateLocal(this,t,e,i),this},e.prototype.rotate=function(t,e,i){return le(e)&&le(i)?Ro.sceneGraphService.rotate(this,0,0,t):Ro.sceneGraphService.rotate(this,t,e,i),this},e.prototype.setRotation=function(t,e,i,a){return Ro.sceneGraphService.setRotation(this,t,e,i,a),this},e.prototype.setLocalRotation=function(t,e,i,a){return Ro.sceneGraphService.setLocalRotation(this,t,e,i,a),this},e.prototype.setLocalSkew=function(t,e){return Ro.sceneGraphService.setLocalSkew(this,t,e),this},e.prototype.getRotation=function(){return Ro.sceneGraphService.getRotation(this)},e.prototype.getLocalRotation=function(){return Ro.sceneGraphService.getLocalRotation(this)},e.prototype.getLocalSkew=function(){return Ro.sceneGraphService.getLocalSkew(this)},e.prototype.getLocalTransform=function(){return Ro.sceneGraphService.getLocalTransform(this)},e.prototype.getWorldTransform=function(){return Ro.sceneGraphService.getWorldTransform(this)},e.prototype.setLocalTransform=function(t){return Ro.sceneGraphService.setLocalTransform(this,t),this},e.prototype.resetLocalTransform=function(){Ro.sceneGraphService.resetLocalTransform(this)},e.prototype.getAnimations=function(){return this.activeAnimations},e.prototype.animate=function(t,e){var i,a=null===(i=this.ownerDocument)||void 0===i?void 0:i.timeline;return a?a.play(this,t,e):null},e.prototype.isVisible=function(){var t;return"visible"===(null===(t=this.parsedStyle)||void 0===t?void 0:t.visibility)},Object.defineProperty(e.prototype,"interactive",{get:function(){return this.isInteractive()},set:function(t){this.style.pointerEvents=t?"auto":"none"},enumerable:!1,configurable:!0}),e.prototype.isInteractive=function(){var t;return"none"!==(null===(t=this.parsedStyle)||void 0===t?void 0:t.pointerEvents)},e.prototype.isCulled=function(){return!(!this.cullable||!this.cullable.enable||this.cullable.visible)},e.prototype.toFront=function(){return this.parentNode&&(this.style.zIndex=Math.max.apply(Math,p([],u(this.parentNode.children.map(function(t){return Number(t.style.zIndex)})),!1))+1),this},e.prototype.toBack=function(){return this.parentNode&&(this.style.zIndex=Math.min.apply(Math,p([],u(this.parentNode.children.map(function(t){return Number(t.style.zIndex)})),!1))-1),this},e.prototype.getConfig=function(){return this.config},e.prototype.attr=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var a=u(e,2),s=a[0],n=a[1];return s?ue(s)?(Object.keys(s).forEach(function(e){t.setAttribute(e,s[e])}),this):2===e.length?(this.setAttribute(s,n),this):this.attributes[s]:this.attributes},e.prototype.getMatrix=function(t){var e=t||this.getWorldTransform(),i=u($(Z(),e),2),a=i[0],s=i[1],n=u(q(Z(),e),2),o=n[0],r=n[1],l=G(yt(),e),c=u(xi(Z(),l),3),d=c[0],h=c[2];return function(t,e,i,a,s){var n,o,r,l,c,d,h,u=Math.cos(t),p=Math.sin(t);return n=a*u,o=s*p,r=-a*p,l=s*u,c=e,d=i,(h=new b(9))[0]=n,h[1]=o,h[2]=0,h[3]=r,h[4]=l,h[5]=0,h[6]=c,h[7]=d,h[8]=1,h}(d||h,a,s,o,r)},e.prototype.getLocalMatrix=function(){return this.getMatrix(this.getLocalTransform())},e.prototype.setMatrix=function(t){var e=u(Ti(t),5),i=e[0],a=e[1],s=e[2],n=e[3],o=e[4];this.setEulerAngles(o).setPosition(i,a).setLocalScale(s,n)},e.prototype.setLocalMatrix=function(t){var e=u(Ti(t),5),i=e[0],a=e[1],s=e[2],n=e[3],o=e[4];this.setLocalEulerAngles(o).setLocalPosition(i,a).setLocalScale(s,n)},e.prototype.show=function(){Ro.enableCSSParsing?this.style.visibility="visible":this.forEach(function(t){t.style.visibility="visible"})},e.prototype.hide=function(){Ro.enableCSSParsing?this.style.visibility="hidden":this.forEach(function(t){t.style.visibility="hidden"})},e.prototype.getCount=function(){return this.childElementCount},e.prototype.getParent=function(){return this.parentElement},e.prototype.getChildren=function(){return this.children},e.prototype.getFirst=function(){return this.firstElementChild},e.prototype.getLast=function(){return this.lastElementChild},e.prototype.getChildByIndex=function(t){return this.children[t]||null},e.prototype.add=function(t,e){return this.appendChild(t,e)},e.prototype.setClip=function(t){this.style.clipPath=t},e.prototype.set=function(t,e){this.config[t]=e},e.prototype.get=function(t){return this.config[t]},e.prototype.moveTo=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),this.setPosition(t,e,i),this},e.prototype.move=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),this.setPosition(t,e,i),this},e.prototype.setZIndex=function(t){return this.style.zIndex=t,this},e}(Go),Qo=function(t){var e=t.name,i=t.inherits,a=t.interpolable,s=t.initialValue,n=t.syntax;Ro.styleValueRegistry.registerMetadata({n:e,inh:i,int:a,d:s,syntax:n})},Xo=function(t){function e(e){void 0===e&&(e={});var i=e.style,a=l(e,["style"]);return t.call(this,r({type:mi.CIRCLE,style:Ro.enableCSSParsing?r({cx:"",cy:"",r:""},i):r({},i),initialParsedStyle:{anchor:[.5,.5],transformOrigin:Ro.enableCSSParsing?null:[Oa,Oa]}},a))||this}return o(e,t),e}(Ko),Jo=function(t){function e(e){void 0===e&&(e={});var i=this,a=e.style,s=l(e,["style"]);return(i=t.call(this,r({style:Ro.enableCSSParsing?r({x:"",y:""},a):r({},a)},s))||this).isCustomElement=!0,i}return o(e,t),e}(Ko),Zo=function(t){function e(e){void 0===e&&(e={});var i=e.style,a=l(e,["style"]);return t.call(this,r({type:mi.ELLIPSE,style:Ro.enableCSSParsing?r({cx:"",cy:"",rx:"",ry:""},i):r({},i),initialParsedStyle:{anchor:[.5,.5],transformOrigin:Ro.enableCSSParsing?null:[Oa,Oa]}},a))||this}return o(e,t),e}(Ko),tr=function(t){function e(e){void 0===e&&(e={});var i=e.style,a=l(e,["style"]);return t.call(this,r({type:mi.GROUP,style:Ro.enableCSSParsing?r({x:"",y:"",width:"",height:""},i):r({},i)},a))||this}return o(e,t),e}(Ko),er=function(t){function e(e){void 0===e&&(e={});var i=this,a=e.style,s=l(e,["style"]);return(i=t.call(this,r({type:mi.HTML,style:Ro.enableCSSParsing?r({x:"",y:"",width:"auto",height:"auto",innerHTML:""},a):r({},a)},s))||this).cullable.enable=!1,i}return o(e,t),e.prototype.getDomElement=function(){return this.parsedStyle.$el},e.prototype.getBoundingClientRect=function(){if(this.parsedStyle.$el)return this.parsedStyle.$el.getBoundingClientRect();var t=this.parsedStyle,e=t.x,i=t.y,a=t.width,s=t.height;return new Ui(e,i,a,s)},e.prototype.getClientRects=function(){return[this.getBoundingClientRect()]},e.prototype.getBounds=function(){var t,e,i=this.getBoundingClientRect(),a=null===(e=null===(t=this.ownerDocument)||void 0===t?void 0:t.defaultView)||void 0===e?void 0:e.getContextService().getBoundingClientRect(),s=new ki,n=i.left-((null==a?void 0:a.left)||0),o=i.top-((null==a?void 0:a.top)||0);return s.setMinMax([n,o,0],[n+i.width,o+i.height,0]),s},e.prototype.getLocalBounds=function(){if(this.parentNode){var t=T(A(),this.parentNode.getWorldTransform()),e=this.getBounds();if(!ki.isEmpty(e)){var i=new ki;return i.setFromTransformedAABB(e,t),i}}return this.getBounds()},e}(Ko),ir=function(t){function e(e){void 0===e&&(e={});var i=e.style,a=l(e,["style"]);return t.call(this,r({type:mi.IMAGE,style:Ro.enableCSSParsing?r({x:"",y:"",img:"",width:"",height:""},i):r({},i)},a))||this}return o(e,t),e}(Ko),ar=function(t){function e(e){void 0===e&&(e={});var i=this,a=e.style,s=l(e,["style"]);(i=t.call(this,r({type:mi.LINE,style:r({x1:0,y1:0,x2:0,y2:0,z1:0,z2:0},a)},s))||this).markerStartAngle=0,i.markerEndAngle=0;var n=i.parsedStyle,o=n.markerStart,c=n.markerEnd;return o&&Bo(o)&&(i.markerStartAngle=o.getLocalEulerAngles(),i.appendChild(o)),c&&Bo(c)&&(i.markerEndAngle=c.getLocalEulerAngles(),i.appendChild(c)),i.transformMarker(!0),i.transformMarker(!1),i}return o(e,t),e.prototype.attributeChangedCallback=function(t,e,i,a,s){"x1"===t||"y1"===t||"x2"===t||"y2"===t||"markerStartOffset"===t||"markerEndOffset"===t?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===t?(a&&Bo(a)&&(this.markerStartAngle=0,a.remove()),s&&Bo(s)&&(this.markerStartAngle=s.getLocalEulerAngles(),this.appendChild(s),this.transformMarker(!0))):"markerEnd"===t&&(a&&Bo(a)&&(this.markerEndAngle=0,a.remove()),s&&Bo(s)&&(this.markerEndAngle=s.getLocalEulerAngles(),this.appendChild(s),this.transformMarker(!1)))},e.prototype.transformMarker=function(t){var e,i,a,s,n,o,r,l=this.parsedStyle,c=l.markerStart,d=l.markerEnd,h=l.markerStartOffset,u=l.markerEndOffset,p=l.x1,m=l.x2,f=l.y1,g=l.y2,_=l.defX,y=l.defY,v=t?c:d;v&&Bo(v)&&(t?(s=p-_,n=f-y,i=m-p,a=g-f,o=h||0,r=this.markerStartAngle):(s=m-_,n=g-y,i=p-m,a=f-g,o=u||0,r=this.markerEndAngle),e=Math.atan2(a,i),v.setLocalEulerAngles(180*e/Math.PI+r),v.setLocalPosition(s+Math.cos(e)*o,n+Math.sin(e)*o))},e.prototype.getPoint=function(t,e){void 0===e&&(e=!1);var i=this.parsedStyle,a=i.x1,s=i.y1,n=i.x2,o=i.y2,r=i.defX,l=i.defY,c=si(a,s,n,o,t),d=c.x,h=c.y,u=ht(Z(),it(d-r,h-l,0),e?this.getWorldTransform():this.getLocalTransform());return new ji(u[0],u[1])},e.prototype.getPointAtLength=function(t,e){return void 0===e&&(e=!1),this.getPoint(t/this.getTotalLength(),e)},e.prototype.getTotalLength=function(){var t=this.parsedStyle;return ai(t.x1,t.y1,t.x2,t.y2)},e}(Ko),sr=function(t){function e(e){void 0===e&&(e={});var i=this,a=e.style,s=l(e,["style"]);(i=t.call(this,r({type:mi.PATH,style:Ro.enableCSSParsing?r({path:"",miterLimit:""},a):r({},a),initialParsedStyle:Ro.enableCSSParsing?null:{miterLimit:4,path:r({},Ra)}},s))||this).markerStartAngle=0,i.markerEndAngle=0,i.markerMidList=[];var n=i.parsedStyle,o=n.markerStart,c=n.markerEnd,d=n.markerMid;return o&&Bo(o)&&(i.markerStartAngle=o.getLocalEulerAngles(),i.appendChild(o)),d&&Bo(d)&&i.placeMarkerMid(d),c&&Bo(c)&&(i.markerEndAngle=c.getLocalEulerAngles(),i.appendChild(c)),i.transformMarker(!0),i.transformMarker(!1),i}return o(e,t),e.prototype.attributeChangedCallback=function(t,e,i,a,s){"path"===t?(this.transformMarker(!0),this.transformMarker(!1),this.placeMarkerMid(this.parsedStyle.markerMid)):"markerStartOffset"===t||"markerEndOffset"===t?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===t?(a&&Bo(a)&&(this.markerStartAngle=0,a.remove()),s&&Bo(s)&&(this.markerStartAngle=s.getLocalEulerAngles(),this.appendChild(s),this.transformMarker(!0))):"markerEnd"===t?(a&&Bo(a)&&(this.markerEndAngle=0,a.remove()),s&&Bo(s)&&(this.markerEndAngle=s.getLocalEulerAngles(),this.appendChild(s),this.transformMarker(!1))):"markerMid"===t&&this.placeMarkerMid(s)},e.prototype.transformMarker=function(t){var e=this.parsedStyle,i=e.markerStart,a=e.markerEnd,s=e.markerStartOffset,n=e.markerEndOffset,o=e.defX,r=e.defY,l=t?i:a;if(l&&Bo(l)){var c,d,h,p,m,f,g;if(t){var _=u(this.getStartTangent(),2),y=_[0];p=(v=_[1])[0]-o,m=v[1]-r,d=y[0]-v[0],h=y[1]-v[1],f=s||0,g=this.markerStartAngle}else{var v,b=u(this.getEndTangent(),2);y=b[0],p=(v=b[1])[0]-o,m=v[1]-r,d=y[0]-v[0],h=y[1]-v[1],f=n||0,g=this.markerEndAngle}c=Math.atan2(h,d),l.setLocalEulerAngles(180*c/Math.PI+g),l.setLocalPosition(p+Math.cos(c)*f,m+Math.sin(c)*f)}},e.prototype.placeMarkerMid=function(t){var e=this.parsedStyle,i=e.path.segments,a=e.defX,s=e.defY;if(this.markerMidList.forEach(function(t){t.remove()}),t&&Bo(t))for(var n=1;n<i.length-1;n++){var o=u(i[n].currentPoint,2),r=o[0],l=o[1],c=1===n?t:t.cloneNode(!0);this.markerMidList.push(c),this.appendChild(c),c.setLocalPosition(r-a,l-s)}},e.prototype.getTotalLength=function(){return fs(this)},e.prototype.getPointAtLength=function(t,e){void 0===e&&(e=!1);var i=this.parsedStyle,a=i.defX,s=i.defY,n=function(t,e){return se(t,e,r(r({},void 0),{bbox:!1,length:!0})).point}(i.path.absolutePath,t),o=n.x,l=n.y,c=ht(Z(),it(o-a,l-s,0),e?this.getWorldTransform():this.getLocalTransform());return new ji(c[0],c[1])},e.prototype.getPoint=function(t,e){return void 0===e&&(e=!1),this.getPointAtLength(t*fs(this),e)},e.prototype.getStartTangent=function(){var t=this.parsedStyle.path.segments,e=[];if(t.length>1){var i=t[0].currentPoint,a=t[1].currentPoint,s=t[1].startTangent;e=[],s?(e.push([i[0]-s[0],i[1]-s[1]]),e.push([i[0],i[1]])):(e.push([a[0],a[1]]),e.push([i[0],i[1]]))}return e},e.prototype.getEndTangent=function(){var t=this.parsedStyle.path.segments,e=t.length,i=[];if(e>1){var a=t[e-2].currentPoint,s=t[e-1].currentPoint,n=t[e-1].endTangent;i=[],n?(i.push([s[0]-n[0],s[1]-n[1]]),i.push([s[0],s[1]])):(i.push([a[0],a[1]]),i.push([s[0],s[1]]))}return i},e}(Ko),nr=function(t){function e(e){void 0===e&&(e={});var i=this,a=e.style,s=l(e,["style"]);(i=t.call(this,r({type:mi.POLYGON,style:Ro.enableCSSParsing?r({points:"",miterLimit:"",isClosed:!0},a):r({},a),initialParsedStyle:Ro.enableCSSParsing?null:{points:{points:[],totalLength:0,segments:[]},miterLimit:4,isClosed:!0}},s))||this).markerStartAngle=0,i.markerEndAngle=0,i.markerMidList=[];var n=i.parsedStyle,o=n.markerStart,c=n.markerEnd,d=n.markerMid;return o&&Bo(o)&&(i.markerStartAngle=o.getLocalEulerAngles(),i.appendChild(o)),d&&Bo(d)&&i.placeMarkerMid(d),c&&Bo(c)&&(i.markerEndAngle=c.getLocalEulerAngles(),i.appendChild(c)),i.transformMarker(!0),i.transformMarker(!1),i}return o(e,t),e.prototype.attributeChangedCallback=function(t,e,i,a,s){"points"===t?(this.transformMarker(!0),this.transformMarker(!1),this.placeMarkerMid(this.parsedStyle.markerMid)):"markerStartOffset"===t||"markerEndOffset"===t?(this.transformMarker(!0),this.transformMarker(!1)):"markerStart"===t?(a&&Bo(a)&&(this.markerStartAngle=0,a.remove()),s&&Bo(s)&&(this.markerStartAngle=s.getLocalEulerAngles(),this.appendChild(s),this.transformMarker(!0))):"markerEnd"===t?(a&&Bo(a)&&(this.markerEndAngle=0,a.remove()),s&&Bo(s)&&(this.markerEndAngle=s.getLocalEulerAngles(),this.appendChild(s),this.transformMarker(!1))):"markerMid"===t&&this.placeMarkerMid(s)},e.prototype.transformMarker=function(t){var e=this.parsedStyle,i=e.markerStart,a=e.markerEnd,s=e.markerStartOffset,n=e.markerEndOffset,o=e.points,r=e.defX,l=e.defY,c=(o||{}).points,d=t?i:a;if(d&&Bo(d)&&c){var h,u,p,m,f,g,_;if(m=c[0][0]-r,f=c[0][1]-l,t)u=c[1][0]-c[0][0],p=c[1][1]-c[0][1],g=s||0,_=this.markerStartAngle;else{var y=c.length;this.parsedStyle.isClosed?(u=c[y-1][0]-c[0][0],p=c[y-1][1]-c[0][1]):(m=c[y-1][0]-r,f=c[y-1][1]-l,u=c[y-2][0]-c[y-1][0],p=c[y-2][1]-c[y-1][1]),g=n||0,_=this.markerEndAngle}h=Math.atan2(p,u),d.setLocalEulerAngles(180*h/Math.PI+_),d.setLocalPosition(m+Math.cos(h)*g,f+Math.sin(h)*g)}},e.prototype.placeMarkerMid=function(t){var e=this.parsedStyle,i=e.points,a=e.defX,s=e.defY,n=(i||{}).points;if(this.markerMidList.forEach(function(t){t.remove()}),this.markerMidList=[],t&&Bo(t)&&n)for(var o=1;o<(this.parsedStyle.isClosed?n.length:n.length-1);o++){var r=n[o][0]-a,l=n[o][1]-s,c=1===o?t:t.cloneNode(!0);this.markerMidList.push(c),this.appendChild(c),c.setLocalPosition(r,l)}},e}(Ko),or=function(t){function e(e){void 0===e&&(e={});var i=e.style,a=l(e,["style"]);return t.call(this,r({type:mi.POLYLINE,style:Ro.enableCSSParsing?r({points:"",miterLimit:"",isClosed:!1},i):r({},i),initialParsedStyle:Ro.enableCSSParsing?null:{points:{points:[],totalLength:0,segments:[]},miterLimit:4,isClosed:!1}},a))||this}return o(e,t),e.prototype.getTotalLength=function(){return this.parsedStyle.points.totalLength},e.prototype.getPointAtLength=function(t,e){return void 0===e&&(e=!1),this.getPoint(t/this.getTotalLength(),e)},e.prototype.getPoint=function(t,e){void 0===e&&(e=!1);var i=this.parsedStyle,a=i.defX,s=i.defY,n=i.points,o=n.points,r=n.segments,l=0,c=0;r.forEach(function(e,i){t>=e[0]&&t<=e[1]&&(l=(t-e[0])/(e[1]-e[0]),c=i)});var d=si(o[c][0],o[c][1],o[c+1][0],o[c+1][1],l),h=d.x,u=d.y,p=ht(Z(),it(h-a,u-s,0),e?this.getWorldTransform():this.getLocalTransform());return new ji(p[0],p[1])},e.prototype.getStartTangent=function(){var t=this.parsedStyle.points.points,e=[];return e.push([t[1][0],t[1][1]]),e.push([t[0][0],t[0][1]]),e},e.prototype.getEndTangent=function(){var t=this.parsedStyle.points.points,e=t.length-1,i=[];return i.push([t[e-1][0],t[e-1][1]]),i.push([t[e][0],t[e][1]]),i},e}(nr),rr=function(t){function e(e){void 0===e&&(e={});var i=e.style,a=l(e,["style"]);return t.call(this,r({type:mi.RECT,style:Ro.enableCSSParsing?r({x:"",y:"",width:"",height:"",radius:""},i):r({},i)},a))||this}return o(e,t),e}(Ko),lr=function(t){function e(e){void 0===e&&(e={});var i=e.style,a=l(e,["style"]);return t.call(this,r({type:mi.TEXT,style:Ro.enableCSSParsing?r({x:"",y:"",text:"",fontSize:"",fontFamily:"",fontStyle:"",fontWeight:"",fontVariant:"",textAlign:"",textBaseline:"",textTransform:"",fill:"black",letterSpacing:"",lineHeight:"",miterLimit:"",wordWrap:!1,wordWrapWidth:0,leading:0,dx:"",dy:""},i):r({fill:"black"},i),initialParsedStyle:Ro.enableCSSParsing?{}:{x:0,y:0,fontSize:16,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",lineHeight:0,letterSpacing:0,textBaseline:"alphabetic",textAlign:"start",wordWrap:!1,wordWrapWidth:0,leading:0,dx:0,dy:0}},a))||this}return o(e,t),e.prototype.getComputedTextLength=function(){var t;return(null===(t=this.parsedStyle.metrics)||void 0===t?void 0:t.maxLineWidth)||0},e.prototype.getLineBoundingRects=function(){var t;return(null===(t=this.parsedStyle.metrics)||void 0===t?void 0:t.lineMetrics)||[]},e.prototype.isOverflowing=function(){return!!this.parsedStyle.isOverflowing},e}(Ko),cr=function(){function t(){this.registry={},this.define(mi.CIRCLE,Xo),this.define(mi.ELLIPSE,Zo),this.define(mi.RECT,rr),this.define(mi.IMAGE,ir),this.define(mi.LINE,ar),this.define(mi.GROUP,tr),this.define(mi.PATH,sr),this.define(mi.POLYGON,nr),this.define(mi.POLYLINE,or),this.define(mi.TEXT,lr),this.define(mi.HTML,er)}return t.prototype.define=function(t,e){this.registry[t]=e},t.prototype.get=function(t){return this.registry[t]},t}(),dr=function(t){function e(){var e=t.call(this)||this;e.defaultView=null,e.ownerDocument=null,e.nodeName="document";try{e.timeline=new Ro.AnimationTimeline(e)}catch(t){}var i={};return Xs.forEach(function(t){var e=t.n,a=t.inh,s=t.d;a&&s&&(i[e]=ua(s)?s(mi.GROUP):s)}),e.documentElement=new tr({id:"g-root",style:i}),e.documentElement.ownerDocument=e,e.documentElement.parentNode=e,e.childNodes=[e.documentElement],e}return o(e,t),Object.defineProperty(e.prototype,"children",{get:function(){return this.childNodes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"childElementCount",{get:function(){return this.childNodes.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstElementChild",{get:function(){return this.firstChild},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastElementChild",{get:function(){return this.lastChild},enumerable:!1,configurable:!0}),e.prototype.createElement=function(t,e){if("svg"===t)return this.documentElement;var i=this.defaultView.customElements.get(t);i||(i="tspan"===t?lr:tr);var a=new i(e);return a.ownerDocument=this,a},e.prototype.createElementNS=function(t,e,i){return this.createElement(e,i)},e.prototype.cloneNode=function(t){throw new Error(Yi)},e.prototype.destroy=function(){try{this.documentElement.destroyChildren(),this.timeline.destroy()}catch(t){}},e.prototype.elementsFromBBox=function(t,e,i,a){var s=this.defaultView.context.rBushRoot.search({minX:t,minY:e,maxX:i,maxY:a}),n=[];return s.forEach(function(t){var e=t.displayObject,i=e.parsedStyle.pointerEvents,a=["auto","visiblepainted","visiblefill","visiblestroke","visible"].includes(i);(!a||a&&e.isVisible())&&!e.isCulled()&&e.isInteractive()&&n.push(e)}),n.sort(function(t,e){return e.sortable.renderOrder-t.sortable.renderOrder}),n},e.prototype.elementFromPointSync=function(t,e){var i=this.defaultView.canvas2Viewport({x:t,y:e}),a=i.x,s=i.y,n=this.defaultView.getConfig(),o=n.width,r=n.height;if(a<0||s<0||a>o||s>r)return null;var l=this.defaultView.viewport2Client({x:a,y:s}),c=l.x,d=l.y,h=this.defaultView.getRenderingService().hooks.pickSync.call({topmost:!0,position:{x:t,y:e,viewportX:a,viewportY:s,clientX:c,clientY:d},picked:[]}).picked;return h&&h[0]||this.documentElement},e.prototype.elementFromPoint=function(t,e){return c(this,void 0,void 0,function(){var i,a,s,n,o,r,l,c,h,u;return d(this,function(d){switch(d.label){case 0:return i=this.defaultView.canvas2Viewport({x:t,y:e}),a=i.x,s=i.y,n=this.defaultView.getConfig(),o=n.width,r=n.height,a<0||s<0||a>o||s>r?[2,null]:(l=this.defaultView.viewport2Client({x:a,y:s}),c=l.x,h=l.y,[4,this.defaultView.getRenderingService().hooks.pick.promise({topmost:!0,position:{x:t,y:e,viewportX:a,viewportY:s,clientX:c,clientY:h},picked:[]})]);case 1:return[2,(u=d.sent().picked)&&u[0]||this.documentElement]}})})},e.prototype.elementsFromPointSync=function(t,e){var i=this.defaultView.canvas2Viewport({x:t,y:e}),a=i.x,s=i.y,n=this.defaultView.getConfig(),o=n.width,r=n.height;if(a<0||s<0||a>o||s>r)return[];var l=this.defaultView.viewport2Client({x:a,y:s}),c=l.x,d=l.y,h=this.defaultView.getRenderingService().hooks.pickSync.call({topmost:!1,position:{x:t,y:e,viewportX:a,viewportY:s,clientX:c,clientY:d},picked:[]}).picked;return h[h.length-1]!==this.documentElement&&h.push(this.documentElement),h},e.prototype.elementsFromPoint=function(t,e){return c(this,void 0,void 0,function(){var i,a,s,n,o,r,l,c,h,u;return d(this,function(d){switch(d.label){case 0:return i=this.defaultView.canvas2Viewport({x:t,y:e}),a=i.x,s=i.y,n=this.defaultView.getConfig(),o=n.width,r=n.height,a<0||s<0||a>o||s>r?[2,[]]:(l=this.defaultView.viewport2Client({x:a,y:s}),c=l.x,h=l.y,[4,this.defaultView.getRenderingService().hooks.pick.promise({topmost:!1,position:{x:t,y:e,viewportX:a,viewportY:s,clientX:c,clientY:h},picked:[]})]);case 1:return(u=d.sent().picked)[u.length-1]!==this.documentElement&&u.push(this.documentElement),[2,u]}})})},e.prototype.appendChild=function(t,e){throw new Error(zi)},e.prototype.insertBefore=function(t,e){throw new Error(zi)},e.prototype.removeChild=function(t,e){throw new Error(zi)},e.prototype.replaceChild=function(t,e,i){throw new Error(zi)},e.prototype.append=function(){throw new Error(zi)},e.prototype.prepend=function(){throw new Error(zi)},e.prototype.getElementById=function(t){return this.documentElement.getElementById(t)},e.prototype.getElementsByName=function(t){return this.documentElement.getElementsByName(t)},e.prototype.getElementsByTagName=function(t){return this.documentElement.getElementsByTagName(t)},e.prototype.getElementsByClassName=function(t){return this.documentElement.getElementsByClassName(t)},e.prototype.querySelector=function(t){return this.documentElement.querySelector(t)},e.prototype.querySelectorAll=function(t){return this.documentElement.querySelectorAll(t)},e.prototype.find=function(t){return this.documentElement.find(t)},e.prototype.findAll=function(t){return this.documentElement.findAll(t)},e}(mo),hr=function(){function t(t){this.strategies=t}return t.prototype.apply=function(e){var i=e.camera,a=e.renderingService,s=e.renderingContext,n=this.strategies;a.hooks.cull.tap(t.tag,function(t){if(t){var e=t.cullable;return 0===n.length?e.visible=s.unculledEntities.indexOf(t.entity)>-1:e.visible=n.every(function(e){return e.isVisible(i,t)}),!t.isCulled()&&t.isVisible()?t:(t.dispatchEvent(new uo(_o.CULLED)),null)}return t}),a.hooks.afterRender.tap(t.tag,function(t){t.cullable.visibilityPlaneMask=-1})},t.tag="Culling",t}(),ur=function(){function t(){var t=this;this.autoPreventDefault=!1,this.rootPointerEvent=new co(null),this.rootWheelEvent=new ho(null),this.onPointerMove=function(e){var i,a,s,n,o=null===(n=null===(s=t.context.renderingContext.root)||void 0===s?void 0:s.ownerDocument)||void 0===n?void 0:n.defaultView;if(!o.supportsTouchEvents||"touch"!==e.pointerType){var r=t.normalizeToPointerEvent(e,o);try{for(var l=h(r),c=l.next();!c.done;c=l.next()){var d=c.value,u=t.bootstrapEvent(t.rootPointerEvent,d,o,e);t.context.eventService.mapEvent(u)}}catch(t){i={error:t}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(i)throw i.error}}t.setCursor(t.context.eventService.cursor)}},this.onClick=function(e){var i,a,s,n,o=null===(n=null===(s=t.context.renderingContext.root)||void 0===s?void 0:s.ownerDocument)||void 0===n?void 0:n.defaultView,r=t.normalizeToPointerEvent(e,o);try{for(var l=h(r),c=l.next();!c.done;c=l.next()){var d=c.value,u=t.bootstrapEvent(t.rootPointerEvent,d,o,e);t.context.eventService.mapEvent(u)}}catch(t){i={error:t}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(i)throw i.error}}t.setCursor(t.context.eventService.cursor)}}return t.prototype.apply=function(e){var i=this;this.context=e;var a=e.renderingService,s=this.context.renderingContext.root.ownerDocument.defaultView;this.context.eventService.setPickHandler(function(t){return i.context.renderingService.hooks.pickSync.call({position:t,picked:[],topmost:!0}).picked[0]||null}),a.hooks.pointerWheel.tap(t.tag,function(t){var e=i.normalizeWheelEvent(t);i.context.eventService.mapEvent(e)}),a.hooks.pointerDown.tap(t.tag,function(t){var e,a;if(!s.supportsTouchEvents||"touch"!==t.pointerType){var n=i.normalizeToPointerEvent(t,s);i.autoPreventDefault&&n[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();try{for(var o=h(n),r=o.next();!r.done;r=o.next()){var l=r.value,c=i.bootstrapEvent(i.rootPointerEvent,l,s,t);i.context.eventService.mapEvent(c)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(a=o.return)&&a.call(o)}finally{if(e)throw e.error}}i.setCursor(i.context.eventService.cursor)}}),a.hooks.pointerUp.tap(t.tag,function(t){var e,a;if(!s.supportsTouchEvents||"touch"!==t.pointerType){var n=i.context.contextService.getDomElement(),o="outside";try{o=n&&t.target&&t.target!==n&&n.contains&&!n.contains(t.target)?"outside":""}catch(t){}var r=i.normalizeToPointerEvent(t,s);try{for(var l=h(r),c=l.next();!c.done;c=l.next()){var d=c.value,u=i.bootstrapEvent(i.rootPointerEvent,d,s,t);u.type+=o,i.context.eventService.mapEvent(u)}}catch(t){e={error:t}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(e)throw e.error}}i.setCursor(i.context.eventService.cursor)}}),a.hooks.pointerMove.tap(t.tag,this.onPointerMove),a.hooks.pointerOver.tap(t.tag,this.onPointerMove),a.hooks.pointerOut.tap(t.tag,this.onPointerMove),a.hooks.click.tap(t.tag,this.onClick),a.hooks.pointerCancel.tap(t.tag,function(t){var e,a,n=i.normalizeToPointerEvent(t,s);try{for(var o=h(n),r=o.next();!r.done;r=o.next()){var l=r.value,c=i.bootstrapEvent(i.rootPointerEvent,l,s,t);i.context.eventService.mapEvent(c)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(a=o.return)&&a.call(o)}finally{if(e)throw e.error}}i.setCursor(i.context.eventService.cursor)})},t.prototype.getViewportXY=function(t){var e,i,a=t.offsetX,s=t.offsetY,n=t.clientX,o=t.clientY;if(!this.context.config.supportsCSSTransform||le(a)||le(s)){var r=this.context.eventService.client2Viewport(new ji(n,o));e=r.x,i=r.y}else e=a,i=s;return{x:e,y:i}},t.prototype.bootstrapEvent=function(t,e,i,a){t.view=i,t.originalEvent=null,t.nativeEvent=a,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);var s=this.getViewportXY(e),n=s.x,o=s.y;t.viewport.x=n,t.viewport.y=o;var r=this.context.eventService.viewport2Canvas(t.viewport),l=r.x,c=r.y;return t.canvas.x=l,t.canvas.y=c,t.global.copyFrom(t.canvas),t.offset.copyFrom(t.canvas),t.isTrusted=a.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=Pn[t.type]||t.type),t},t.prototype.normalizeWheelEvent=function(t){var e=this.rootWheelEvent;this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ;var i=this.getViewportXY(t),a=i.x,s=i.y;e.viewport.x=a,e.viewport.y=s;var n=this.context.eventService.viewport2Canvas(e.viewport),o=n.x,r=n.y;return e.canvas.x=o,e.canvas.y=r,e.global.copyFrom(e.canvas),e.offset.copyFrom(e.canvas),e.nativeEvent=t,e.type=t.type,e},t.prototype.transferMouseData=function(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=On.now(),t.type=e.type,t.altKey=e.altKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.ctrlKey=e.ctrlKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.screen.x=e.screenX,t.screen.y=e.screenY,t.relatedTarget=null},t.prototype.setCursor=function(t){this.context.contextService.applyCursorStyle(t||this.context.config.cursor||"default")},t.prototype.normalizeToPointerEvent=function(t,e){var i=[];if(e.isTouchEvent(t))for(var a=0;a<t.changedTouches.length;a++){var s=t.changedTouches[a];Ee(s.button)&&(s.button=0),Ee(s.buttons)&&(s.buttons=1),Ee(s.isPrimary)&&(s.isPrimary=1===t.touches.length&&"touchstart"===t.type),Ee(s.width)&&(s.width=s.radiusX||1),Ee(s.height)&&(s.height=s.radiusY||1),Ee(s.tiltX)&&(s.tiltX=0),Ee(s.tiltY)&&(s.tiltY=0),Ee(s.pointerType)&&(s.pointerType="touch"),Ee(s.pointerId)&&(s.pointerId=s.identifier||0),Ee(s.pressure)&&(s.pressure=s.force||.5),Ee(s.twist)&&(s.twist=0),Ee(s.tangentialPressure)&&(s.tangentialPressure=0),s.isNormalized=!0,s.type=t.type,i.push(s)}else if(e.isMouseEvent(t)){var n=t;Ee(n.isPrimary)&&(n.isPrimary=!0),Ee(n.width)&&(n.width=1),Ee(n.height)&&(n.height=1),Ee(n.tiltX)&&(n.tiltX=0),Ee(n.tiltY)&&(n.tiltY=0),Ee(n.pointerType)&&(n.pointerType="mouse"),Ee(n.pointerId)&&(n.pointerId=1),Ee(n.pressure)&&(n.pressure=.5),Ee(n.twist)&&(n.twist=0),Ee(n.tangentialPressure)&&(n.tangentialPressure=0),n.isNormalized=!0,i.push(n)}else i.push(t);return i},t.tag="Event",t}(),pr=[mi.CIRCLE,mi.ELLIPSE,mi.IMAGE,mi.RECT,mi.LINE,mi.POLYLINE,mi.POLYGON,mi.TEXT,mi.PATH,mi.HTML],mr=function(){function t(){}return t.prototype.isVisible=function(t,e){var i,a,s=e.cullable;if(!s.enable)return!0;var n=e.getRenderBounds();if(ki.isEmpty(n))return!1;var o=t.getFrustum(),r=null===(a=null===(i=e.parentNode)||void 0===i?void 0:i.cullable)||void 0===a?void 0:a.visibilityPlaneMask;return s.visibilityPlaneMask=this.computeVisibilityWithPlaneMask(e,n,r||Ni.INDETERMINATE,o.planes),s.visible=s.visibilityPlaneMask!==Ni.OUTSIDE,s.visible},t.prototype.computeVisibilityWithPlaneMask=function(t,e,i,a){if(i===Ni.OUTSIDE||i===Ni.INSIDE)return i;for(var s=Ni.INSIDE,n=pr.indexOf(t.nodeName)>-1,o=0,r=a.length;o<r;++o){var l=1<<o;if(0!=(i&l)&&(!n||4!==o&&5!==o)){var c=a[o],d=c.normal,h=c.distance;if(ct(d,e.getPositiveFarPoint(a[o]))+h<0)return Ni.OUTSIDE;ct(d,e.getNegativeFarPoint(a[o]))+h<0&&(s|=l)}}return s},t}(),fr=function(){function t(){this.toSync=new Set}return t.prototype.apply=function(e){var i=this,a=e.renderingService,s=e.renderingContext,n=e.rBushRoot,o=s.root.ownerDocument.defaultView;this.rBush=n;var r=function(t){t.target.renderable.dirty=!0,a.dirtify()},l=function(t){var e=t.detail.affectChildren,s=t.target;e&&s.forEach(function(t){i.toSync.add(t)});for(var n=s;n;)n.renderable&&i.toSync.add(n),n=n.parentElement;a.dirtify()},c=function(t){var e=t.target;Ro.enableSizeAttenuation&&Ro.styleValueRegistry.updateSizeAttenuation(e,o.getCamera().getZoom()),Ro.enableCSSParsing&&Ro.styleValueRegistry.recalc(e),Ro.sceneGraphService.dirtifyToRoot(e),a.dirtify()},d=function(t){var e=t.target,s=e.rBushNode;s.aabb&&i.rBush.remove(s.aabb),i.toSync.delete(e),Ro.sceneGraphService.dirtifyToRoot(e),a.dirtify()};a.hooks.init.tap(t.tag,function(){o.addEventListener(_o.MOUNTED,c),o.addEventListener(_o.UNMOUNTED,d),o.addEventListener(_o.ATTR_MODIFIED,r),o.addEventListener(_o.BOUNDS_CHANGED,l)}),a.hooks.destroy.tap(t.tag,function(){o.removeEventListener(_o.MOUNTED,c),o.removeEventListener(_o.UNMOUNTED,d),o.removeEventListener(_o.ATTR_MODIFIED,r),o.removeEventListener(_o.BOUNDS_CHANGED,l),i.toSync.clear()}),a.hooks.endFrame.tap(t.tag,function(){i.syncRTree()})},t.prototype.syncRTree=function(){var t=this,e=[];Array.from(this.toSync).filter(function(t){return t.isConnected}).forEach(function(i){var a=i.rBushNode;a&&a.aabb&&t.rBush.remove(a.aabb);var s=i.getRenderBounds();if(s){var n=u(s.getMin(),2),o=n[0],r=n[1],l=u(s.getMax(),2),c=l[0],d=l[1];a.aabb||(a.aabb={}),a.aabb.displayObject=i,a.aabb.minX=o,a.aabb.minY=r,a.aabb.maxX=c,a.aabb.maxY=d}a.aabb&&(isNaN(a.aabb.maxX)||isNaN(a.aabb.maxX)||isNaN(a.aabb.minX)||isNaN(a.aabb.minY)||e.push(a.aabb))}),this.rBush.load(e),e.length=0,this.toSync.clear()},t.tag="Prepare",t}();!function(t){t.READY="ready",t.BEFORE_RENDER="beforerender",t.RERENDER="rerender",t.AFTER_RENDER="afterrender",t.BEFORE_DESTROY="beforedestroy",t.AFTER_DESTROY="afterdestroy",t.RESIZE="resize",t.DIRTY_RECTANGLE="dirtyrectangle",t.RENDERER_CHANGED="rendererchanged"}(jo||(jo={}));var gr=new uo(_o.MOUNTED),_r=new uo(_o.UNMOUNTED),yr=new uo(jo.BEFORE_RENDER),vr=new uo(jo.RERENDER),br=new uo(jo.AFTER_RENDER),Er=function(t){function e(e){var i=t.call(this)||this;i.Element=Ko,i.inited=!1,i.context={},i.document=new dr,i.document.defaultView=i,i.customElements=new cr;var a=e.container,s=e.canvas,n=e.offscreenCanvas,o=e.width,r=e.height,l=e.devicePixelRatio,c=e.renderer,d=e.background,h=e.cursor,u=e.document,p=e.requestAnimationFrame,m=e.cancelAnimationFrame,f=e.createImage,g=e.supportsPointerEvents,_=e.supportsTouchEvents,y=e.supportsCSSTransform,v=e.supportsMutipleCanvasesInOneContainer,b=e.useNativeClickEvent,E=e.alwaysTriggerPointerEventOnCanvas,A=e.isTouchEvent,w=e.isMouseEvent;v||function(t,e){if(t){var i="string"==typeof t?t:t.id||Sn++;wn[i]&&wn[i].destroy(),wn[i]=e}}(a,i);var S=o,C=r,I=l;return s&&(I=(I=l||Cn&&window.devicePixelRatio||1)>=1?Math.ceil(I):1,S=o||function(t){var e=Mn(t,"width");return"auto"===e?t.offsetWidth:parseFloat(e)}(s)||s.width/I,C=r||function(t){var e=Mn(t,"height");return"auto"===e?t.offsetHeight:parseFloat(e)}(s)||s.height/I),n&&(Ro.offscreenCanvas=n),i.devicePixelRatio=I,i.requestAnimationFrame=null!=p?p:jn.bind(Ro.globalThis),i.cancelAnimationFrame=null!=m?m:Un.bind(Ro.globalThis),i.supportsTouchEvents=null!=_?_:"ontouchstart"in Ro.globalThis,i.supportsPointerEvents=null!=g?g:!!Ro.globalThis.PointerEvent,i.isTouchEvent=null!=A?A:function(t){return i.supportsTouchEvents&&t instanceof Ro.globalThis.TouchEvent},i.isMouseEvent=null!=w?w:function(t){return!Ro.globalThis.MouseEvent||t instanceof Ro.globalThis.MouseEvent&&(!i.supportsPointerEvents||!(t instanceof Ro.globalThis.PointerEvent))},i.initRenderingContext({container:a,canvas:s,width:S,height:C,renderer:c,offscreenCanvas:n,devicePixelRatio:I,cursor:h||"default",background:d||"transparent",createImage:f,document:u,supportsCSSTransform:y,useNativeClickEvent:b,alwaysTriggerPointerEventOnCanvas:E}),i.initDefaultCamera(S,C,c.clipSpaceNearZ),i.initRenderer(c,!0),i}return o(e,t),e.prototype.initRenderingContext=function(t){this.context.config=t,this.context.renderingContext={root:this.document.documentElement,renderListCurrentFrame:[],unculledEntities:[],renderReasons:new Set,force:!1,dirty:!1}},e.prototype.initDefaultCamera=function(t,e,i){var a=this,s=new Ro.CameraContribution;s.clipSpaceNearZ=i,s.setType($i.EXPLORING,qi.DEFAULT).setPosition(t/2,e/2,500).setFocalPoint(t/2,e/2,0).setOrthographic(t/-2,t/2,e/2,e/-2,.1,1e3),s.canvas=this,s.eventEmitter.on(Xi,function(){a.context.renderingContext.renderReasons.add(oo.CAMERA_CHANGED),Ro.enableSizeAttenuation&&a.getConfig().renderer.getConfig().enableSizeAttenuation&&a.updateSizeAttenuation()}),this.context.camera=s},e.prototype.updateSizeAttenuation=function(){var t=this.getCamera().getZoom();this.document.documentElement.forEach(function(e){Ro.styleValueRegistry.updateSizeAttenuation(e,t)})},e.prototype.getConfig=function(){return this.context.config},e.prototype.getRoot=function(){return this.document.documentElement},e.prototype.getCamera=function(){return this.context.camera},e.prototype.getContextService=function(){return this.context.contextService},e.prototype.getEventService=function(){return this.context.eventService},e.prototype.getRenderingService=function(){return this.context.renderingService},e.prototype.getRenderingContext=function(){return this.context.renderingContext},e.prototype.getStats=function(){return this.getRenderingService().getStats()},Object.defineProperty(e.prototype,"ready",{get:function(){var t=this;return this.readyPromise||(this.readyPromise=new Promise(function(e){t.resolveReadyPromise=function(){e(t)}}),this.inited&&this.resolveReadyPromise()),this.readyPromise},enumerable:!1,configurable:!0}),e.prototype.destroy=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),e||this.dispatchEvent(new uo(jo.BEFORE_DESTROY)),this.frameId&&(this.getConfig().cancelAnimationFrame||cancelAnimationFrame)(this.frameId);var i=this.getRoot();this.unmountChildren(i),t&&(this.document.destroy(),this.getEventService().destroy()),this.getRenderingService().destroy(),this.getContextService().destroy(),t&&this.context.rBushRoot&&(this.context.rBushRoot.clear(),this.context.rBushRoot=null,this.context.renderingContext.root=null),e||this.dispatchEvent(new uo(jo.AFTER_DESTROY))},e.prototype.changeSize=function(t,e){this.resize(t,e)},e.prototype.resize=function(t,e){var i=this.context.config;i.width=t,i.height=e,this.getContextService().resize(t,e);var a=this.context.camera,s=a.getProjectionMode();a.setPosition(t/2,e/2,500).setFocalPoint(t/2,e/2,0),s===Gi.ORTHOGRAPHIC?a.setOrthographic(t/-2,t/2,e/2,e/-2,a.getNear(),a.getFar()):a.setAspect(t/e),this.dispatchEvent(new uo(jo.RESIZE,{width:t,height:e}))},e.prototype.appendChild=function(t,e){return this.document.documentElement.appendChild(t,e)},e.prototype.insertBefore=function(t,e){return this.document.documentElement.insertBefore(t,e)},e.prototype.removeChild=function(t){return this.document.documentElement.removeChild(t)},e.prototype.removeChildren=function(){this.document.documentElement.removeChildren()},e.prototype.destroyChildren=function(){this.document.documentElement.destroyChildren()},e.prototype.render=function(){var t=this;this.dispatchEvent(yr),this.getRenderingService().render(this.getConfig(),function(){t.dispatchEvent(vr)}),this.dispatchEvent(br)},e.prototype.run=function(){var t=this,e=function(){t.render(),t.frameId=t.requestAnimationFrame(e)};e()},e.prototype.initRenderer=function(t,e){var i=this;if(void 0===e&&(e=!1),!t)throw new Error("Renderer is required.");this.inited=!1,this.readyPromise=void 0,this.context.rBushRoot=new gi,this.context.renderingPlugins=[],this.context.renderingPlugins.push(new ur,new fr,new hr([new mr])),this.loadRendererContainerModule(t),this.context.contextService=new this.context.ContextService(r(r({},Ro),this.context)),this.context.renderingService=new yo(Ro,this.context),this.context.eventService=new fo(Ro,this.context),this.context.eventService.init(),this.context.contextService.init?(this.context.contextService.init(),this.initRenderingService(t,e,!0)):this.context.contextService.initAsync().then(function(){i.initRenderingService(t,e)})},e.prototype.initRenderingService=function(t,e,i){var a=this;void 0===e&&(e=!1),void 0===i&&(i=!1),this.context.renderingService.init(function(){a.inited=!0,e?(i?a.requestAnimationFrame(function(){a.dispatchEvent(new uo(jo.READY))}):a.dispatchEvent(new uo(jo.READY)),a.readyPromise&&a.resolveReadyPromise()):a.dispatchEvent(new uo(jo.RENDERER_CHANGED)),e||a.getRoot().forEach(function(t){var e=t.renderable;e&&(e.renderBoundsDirty=!0,e.boundsDirty=!0,e.dirty=!0)}),a.mountChildren(a.getRoot()),t.getConfig().enableAutoRendering&&a.run()})},e.prototype.loadRendererContainerModule=function(t){var e=this;t.getPlugins().forEach(function(t){t.context=e.context,t.init(Ro)})},e.prototype.setRenderer=function(t){var e=this.getConfig();if(e.renderer!==t){var i=e.renderer;e.renderer=t,this.destroy(!1,!0),p([],u(null==i?void 0:i.getPlugins()),!1).reverse().forEach(function(t){t.destroy(Ro)}),this.initRenderer(t)}},e.prototype.setCursor=function(t){this.getConfig().cursor=t,this.getContextService().applyCursorStyle(t)},e.prototype.unmountChildren=function(t){var e=this;t.childNodes.forEach(function(t){e.unmountChildren(t)}),this.inited&&(t.isMutationObserved?t.dispatchEvent(_r):(_r.target=t,this.dispatchEvent(_r,!0)),t!==this.document.documentElement&&(t.ownerDocument=null),t.isConnected=!1),t.isCustomElement&&t.disconnectedCallback&&t.disconnectedCallback()},e.prototype.mountChildren=function(t){var e=this;this.inited&&(t.isConnected||(t.ownerDocument=this.document,t.isConnected=!0,t.isMutationObserved?t.dispatchEvent(gr):(gr.target=t,this.dispatchEvent(gr,!0)))),t.childNodes.forEach(function(t){e.mountChildren(t)}),t.isCustomElement&&t.connectedCallback&&t.connectedCallback()},e.prototype.client2Viewport=function(t){return this.getEventService().client2Viewport(t)},e.prototype.viewport2Client=function(t){return this.getEventService().viewport2Client(t)},e.prototype.viewport2Canvas=function(t){return this.getEventService().viewport2Canvas(t)},e.prototype.canvas2Viewport=function(t){return this.getEventService().canvas2Viewport(t)},e.prototype.getPointByClient=function(t,e){return this.client2Viewport({x:t,y:e})},e.prototype.getClientByPoint=function(t,e){return this.viewport2Client({x:t,y:e})},e}(po),Ar=function(t){function e(){var e=t.apply(this,p([],u(arguments),!1))||this;return e.landmarks=[],e}return o(e,t),e.prototype.rotate=function(t,e,i){if(this.relElevation=wi(e),this.relAzimuth=wi(t),this.relRoll=wi(i),this.elevation+=this.relElevation,this.azimuth+=this.relAzimuth,this.roll+=this.relRoll,this.type===$i.EXPLORING){var a=vt(yt(),[1,0,0],Ci((this.rotateWorld?1:-1)*this.relElevation)),s=vt(yt(),[0,1,0],Ci((this.rotateWorld?1:-1)*this.relAzimuth)),n=vt(yt(),[0,0,1],Ci(this.relRoll)),o=bt(yt(),s,a);o=bt(yt(),o,n);var r=j(A(),o);O(this.matrix,this.matrix,[0,0,-this.distance]),P(this.matrix,this.matrix,r),O(this.matrix,this.matrix,[0,0,this.distance])}else{if(Math.abs(this.elevation)>90)return this;this.computeMatrix()}return this._getAxes(),this.type===$i.ORBITING||this.type===$i.EXPLORING?this._getPosition():this.type===$i.TRACKING&&this._getFocalPoint(),this._update(),this},e.prototype.pan=function(t,e){var i=Si(t,e,0),a=tt(this.position);return nt(a,a,rt(Z(),this.right,i[0])),nt(a,a,rt(Z(),this.up,i[1])),this._setPosition(a),this.triggerUpdate(),this},e.prototype.dolly=function(t){var e=this.forward,i=tt(this.position),a=this.dollyingStep,s=this.distance+t*this.dollyingStep;return a=Math.max(Math.min(s,this.maxDistance),this.minDistance)-this.distance,i[0]+=a*e[0],i[1]+=a*e[1],i[2]+=a*e[2],this._setPosition(i),this.type===$i.ORBITING||this.type===$i.EXPLORING?this._getDistance():this.type===$i.TRACKING&&nt(this.focalPoint,i,this.distanceVector),this.triggerUpdate(),this},e.prototype.cancelLandmarkAnimation=function(){void 0!==this.landmarkAnimationID&&this.canvas.cancelAnimationFrame(this.landmarkAnimationID)},e.prototype.createLandmark=function(t,e){var i,a,s,n;void 0===e&&(e={});var o=e.position,r=void 0===o?this.position:o,l=e.focalPoint,c=void 0===l?this.focalPoint:l,d=e.roll,h=e.zoom,u=new Ro.CameraContribution;u.setType(this.type,void 0),u.setPosition(r[0],null!==(i=r[1])&&void 0!==i?i:this.position[1],null!==(a=r[2])&&void 0!==a?a:this.position[2]),u.setFocalPoint(c[0],null!==(s=c[1])&&void 0!==s?s:this.focalPoint[1],null!==(n=c[2])&&void 0!==n?n:this.focalPoint[2]),u.setRoll(null!=d?d:this.roll),u.setZoom(null!=h?h:this.zoom);var p={name:t,matrix:w(u.getWorldTransform()),right:tt(u.right),up:tt(u.up),forward:tt(u.forward),position:tt(u.getPosition()),focalPoint:tt(u.getFocalPoint()),distanceVector:tt(u.getDistanceVector()),distance:u.getDistance(),dollyingStep:u.getDollyingStep(),azimuth:u.getAzimuth(),elevation:u.getElevation(),roll:u.getRoll(),relAzimuth:u.relAzimuth,relElevation:u.relElevation,relRoll:u.relRoll,zoom:u.getZoom()};return this.landmarks.push(p),p},e.prototype.gotoLandmark=function(t,e){var i=this;void 0===e&&(e={});var a=fe(t)?this.landmarks.find(function(e){return e.name===t}):t;if(a){var s=_e(e)?{duration:e}:e,n=s.easing,o=void 0===n?"linear":n,r=s.duration,l=void 0===r?100:r,c=s.easingFunction,d=void 0===c?void 0:c,h=s.onfinish,u=void 0===h?void 0:h,p=s.onframe,m=void 0===p?void 0:p;if(0===l)return this.syncFromLandmark(a),void(u&&u());this.cancelLandmarkAnimation();var f,g=a.position,_=a.focalPoint,y=a.zoom,v=a.roll,b=d||Ro.EasingFunction(o),E=function(){i.setFocalPoint(_),i.setPosition(g),i.setRoll(v),i.setZoom(y),i.computeMatrix(),i.triggerUpdate(),u&&u()},A=function(t){void 0===f&&(f=t);var e=t-f;if(e>l)E();else{var a,s,n=b(e/l),o=Z(),r=Z();dt(o,i.focalPoint,_,n),dt(r,i.position,g,n),s=i.roll*(1-n)+v*n,a=i.zoom*(1-n)+y*n,i.setFocalPoint(o),i.setPosition(r),i.setRoll(s),i.setZoom(a),mt(o,_)+mt(r,g)<=.01&&null==y&&null==v?E():(i.computeMatrix(),i.triggerUpdate(),e<l&&(m&&m(n),i.landmarkAnimationID=i.canvas.requestAnimationFrame(A)))}};this.canvas.requestAnimationFrame(A)}},e.prototype.syncFromLandmark=function(t){this.matrix=S(this.matrix,t.matrix),this.right=at(this.right,t.right),this.up=at(this.up,t.up),this.forward=at(this.forward,t.forward),this.position=at(this.position,t.position),this.focalPoint=at(this.focalPoint,t.focalPoint),this.distanceVector=at(this.distanceVector,t.distanceVector),this.azimuth=t.azimuth,this.elevation=t.elevation,this.roll=t.roll,this.relAzimuth=t.relAzimuth,this.relElevation=t.relElevation,this.relRoll=t.relRoll,this.dollyingStep=t.dollyingStep,this.distance=t.distance,this.zoom=t.zoom},e}(Zi);Ro.CameraContribution=Ar;var wr,Sr,Cr=function(){function t(t,e){this.type=t,this.target=e,this.addedNodes=[],this.attributeName=null,this.attributeNamespace=null,this.nextSibling=null,this.oldValue=null,this.previousSibling=null,this.removedNodes=[]}return t.copy=function(e){var i=new t(e.type,e.target);return i.addedNodes=e.addedNodes.slice(),i.removedNodes=e.removedNodes.slice(),i.previousSibling=e.previousSibling,i.nextSibling=e.nextSibling,i.attributeName=e.attributeName,i.attributeNamespace=e.attributeNamespace,i.oldValue=e.oldValue,i},t}(),Ir=0,xr=new WeakMap,Tr=function(){function t(t,e,i){this.observer=t,this.target=e,this.options=i,this.transientObservedNodes=[]}return t.prototype.enqueue=function(t){var e,i=this.observer.records,a=i.length;if(i.length>0){var s=function(t,e){return t===e?t:Sr&&function(t){return t===Sr||t===wr}(t)?Sr:null}(i[a-1],t);if(s)return void(i[a-1]=s)}else e=this.observer,Lr.push(e),Or||(Or=!0,void 0!==Ro.globalThis?Ro.globalThis.setTimeout(Rr):Rr());i[a]=t},t.prototype.addListeners=function(){this.addListeners_(this.target)},t.prototype.addListeners_=function(t){var e=this.options;e.attributes&&t.addEventListener(_o.ATTR_MODIFIED,this,!0),e.childList&&t.addEventListener(_o.INSERTED,this,!0),(e.childList||e.subtree)&&t.addEventListener(_o.REMOVED,this,!0)},t.prototype.removeListeners=function(){this.removeListeners_(this.target)},t.prototype.removeListeners_=function(t){var e=this.options;e.attributes&&t.removeEventListener(_o.ATTR_MODIFIED,this,!0),e.childList&&t.removeEventListener(_o.INSERTED,this,!0),(e.childList||e.subtree)&&t.removeEventListener(_o.REMOVED,this,!0)},t.prototype.removeTransientObservers=function(){var t=this.transientObservedNodes;this.transientObservedNodes=[],t.forEach(function(t){this.removeListeners_(t);for(var e=xr.get(t),i=0;i<e.length;i++)if(e[i]===this){e.splice(i,1);break}},this)},t.prototype.handleEvent=function(t){var e,i;switch(t.stopImmediatePropagation(),t.type){case _o.ATTR_MODIFIED:var a=t.attrName,s=t.relatedNode.namespaceURI;i=t.target,(e=Mr("attributes",i)).attributeName=a,e.attributeNamespace=s;var n=t.attrChange===Eo.ADDITION?null:t.prevValue;Pr(i,function(t){var i;if(t.attributes&&(!t.attributeFilter||!t.attributeFilter.length||-1!==t.attributeFilter.indexOf(a)||-1!==t.attributeFilter.indexOf(s)))return t.attributeOldValue?(i=n,Sr||((Sr=Cr.copy(wr)).oldValue=i,Sr)):e});break;case _o.REMOVED:case _o.INSERTED:i=t.relatedNode;var o=t.target,r=void 0,l=void 0;t.type===_o.INSERTED?(r=[o],l=[]):(r=[],l=[o]);var c=o.previousSibling,d=o.nextSibling;(e=Mr("childList",i)).addedNodes=r,e.removedNodes=l,e.previousSibling=c,e.nextSibling=d,Pr(i,function(t){if(t.childList)return e})}wr=Sr=void 0},t}();!function(){function t(t){this.callback=t,this.nodes=[],this.records=[],this.uid=Ir++}t.prototype.observe=function(t,e){if(!e.childList&&!e.attributes&&!e.characterData||e.attributeOldValue&&!e.attributes||e.attributeFilter&&e.attributeFilter.length&&!e.attributes||e.characterDataOldValue&&!e.characterData)throw new SyntaxError;var i,a=xr.get(t);a||xr.set(t,a=[]);for(var s=0;s<a.length;s++)if(a[s].observer===this){(i=a[s]).removeListeners(),i.options=e;break}i||(i=new Tr(this,t,e),a.push(i),this.nodes.push(t)),i.addListeners()},t.prototype.disconnect=function(){var t=this;this.nodes.forEach(function(e){for(var i=xr.get(e),a=0;a<i.length;a++){var s=i[a];if(s.observer===t){s.removeListeners(),i.splice(a,1);break}}},this),this.records=[]},t.prototype.takeRecords=function(){var t=this.records;return this.records=[],t}}();function Mr(t,e){return wr=new Cr(t,e)}function Pr(t,e){for(var i=t;i;i=i.parentNode){var a=xr.get(i);if(a)for(var s=0;s<a.length;s++){var n=a[s],o=n.options;if(i===t||o.subtree){var r=e(o);r&&n.enqueue(r)}}}}var Or=!1,Lr=[];function Rr(){Or=!1;var t=Lr;Lr=[],t.sort(function(t,e){return t.uid-e.uid});var e=!1;t.forEach(function(t){var i=t.takeRecords();!function(t){t.nodes.forEach(function(e){var i=xr.get(e);i&&i.forEach(function(e){e.observer===t&&e.removeTransientObservers()})})}(t),i.length&&(t.callback(i,t),e=!0)}),e&&Rr()}var Dr=function(t){function e(e,i,a,s){var n=t.call(this,e)||this;return n.currentTime=a,n.timelineTime=s,n.target=i,n.type="finish",n.bubbles=!1,n.currentTarget=i,n.defaultPrevented=!1,n.eventPhase=n.AT_TARGET,n.timeStamp=Date.now(),n.currentTime=a,n.timelineTime=s,n}return o(e,t),e}(ro),Nr=0,kr=function(){function t(t,e){var i;this.currentTimePending=!1,this._idle=!0,this._paused=!1,this._finishedFlag=!0,this._currentTime=0,this._playbackRate=1,this._inTimeline=!0,this.effect=t,t.animation=this,this.timeline=e,this.id="".concat(Nr++),this._inEffect=!!this.effect.update(0),this._totalDuration=Number(null===(i=this.effect)||void 0===i?void 0:i.getComputedTiming().endTime),this._holdTime=0,this._paused=!1,this.oldPlayState="idle",this.updatePromises()}return Object.defineProperty(t.prototype,"pending",{get:function(){return null===this._startTime&&!this._paused&&0!==this.playbackRate||this.currentTimePending},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playState",{get:function(){return this._idle?"idle":this._isFinished?"finished":this._paused?"paused":"running"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){var t=this;return this.readyPromise||(-1===this.timeline.animationsWithPromises.indexOf(this)&&this.timeline.animationsWithPromises.push(this),this.readyPromise=new Promise(function(e,i){t.resolveReadyPromise=function(){e(t)},t.rejectReadyPromise=function(){i(new Error)}}),this.pending||this.resolveReadyPromise()),this.readyPromise},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"finished",{get:function(){var t=this;return this.finishedPromise||(-1===this.timeline.animationsWithPromises.indexOf(this)&&this.timeline.animationsWithPromises.push(this),this.finishedPromise=new Promise(function(e,i){t.resolveFinishedPromise=function(){e(t)},t.rejectFinishedPromise=function(){i(new Error)}}),"finished"===this.playState&&this.resolveFinishedPromise()),this.finishedPromise},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return this.updatePromises(),this._idle||this.currentTimePending?null:this._currentTime},set:function(t){var e;t=Number(t),isNaN(t)||(this.timeline.restart(),this._paused||null===this._startTime||(this._startTime=Number(null===(e=this.timeline)||void 0===e?void 0:e.currentTime)-t/this.playbackRate),this.currentTimePending=!1,this._currentTime!==t&&(this._idle&&(this._idle=!1,this._paused=!0),this.tickCurrentTime(t,!0),this.timeline.applyDirtiedAnimation(this)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this._startTime},set:function(t){if(null!==t){if(this.updatePromises(),t=Number(t),isNaN(t))return;if(this._paused||this._idle)return;this._startTime=t,this.tickCurrentTime((Number(this.timeline.currentTime)-this._startTime)*this.playbackRate),this.timeline.applyDirtiedAnimation(this),this.updatePromises()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){if(t!==this._playbackRate){this.updatePromises();var e=this.currentTime;this._playbackRate=t,this.startTime=null,"paused"!==this.playState&&"idle"!==this.playState&&(this._finishedFlag=!1,this._idle=!1,this.ensureAlive(),this.timeline.applyDirtiedAnimation(this)),null!==e&&(this.currentTime=e),this.updatePromises()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_isFinished",{get:function(){return!this._idle&&(this._playbackRate>0&&Number(this._currentTime)>=this._totalDuration||this._playbackRate<0&&Number(this._currentTime)<=0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"totalDuration",{get:function(){return this._totalDuration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_needsTick",{get:function(){return this.pending||"running"===this.playState||!this._finishedFlag},enumerable:!1,configurable:!0}),t.prototype.updatePromises=function(){var t=this.oldPlayState,e=this.pending?"pending":this.playState;return this.readyPromise&&e!==t&&("idle"===e?(this.rejectReadyPromise(),this.readyPromise=void 0):"pending"===t?this.resolveReadyPromise():"pending"===e&&(this.readyPromise=void 0)),this.finishedPromise&&e!==t&&("idle"===e?(this.rejectFinishedPromise(),this.finishedPromise=void 0):"finished"===e?this.resolveFinishedPromise():"finished"===t&&(this.finishedPromise=void 0)),this.oldPlayState=e,this.readyPromise||this.finishedPromise},t.prototype.play=function(){this.updatePromises(),this._paused=!1,(this._isFinished||this._idle)&&(this.rewind(),this._startTime=null),this._finishedFlag=!1,this._idle=!1,this.ensureAlive(),this.timeline.applyDirtiedAnimation(this),-1===this.timeline.animations.indexOf(this)&&this.timeline.animations.push(this),this.updatePromises()},t.prototype.pause=function(){this.updatePromises(),this.currentTime&&(this._holdTime=this.currentTime),this._isFinished||this._paused||this._idle?this._idle&&(this.rewind(),this._idle=!1):this.currentTimePending=!0,this._startTime=null,this._paused=!0,this.updatePromises()},t.prototype.finish=function(){this.updatePromises(),this._idle||(this.currentTime=this._playbackRate>0?this._totalDuration:0,this._startTime=this._totalDuration-this.currentTime,this.currentTimePending=!1,this.timeline.applyDirtiedAnimation(this),this.updatePromises())},t.prototype.cancel=function(){var t=this;if(this.updatePromises(),this._inEffect&&(this._inEffect=!1,this._idle=!0,this._paused=!1,this._finishedFlag=!0,this._currentTime=0,this._startTime=null,this.effect.update(null),this.timeline.applyDirtiedAnimation(this),this.updatePromises(),this.oncancel)){var e=new Dr(null,this,this.currentTime,null);setTimeout(function(){t.oncancel(e)})}},t.prototype.reverse=function(){this.updatePromises();var t=this.currentTime;this.playbackRate*=-1,this.play(),null!==t&&(this.currentTime=t),this.updatePromises()},t.prototype.updatePlaybackRate=function(t){this.playbackRate=t},t.prototype.targetAnimations=function(){var t;return(null===(t=this.effect)||void 0===t?void 0:t.target).getAnimations()},t.prototype.markTarget=function(){var t=this.targetAnimations();-1===t.indexOf(this)&&t.push(this)},t.prototype.unmarkTarget=function(){var t=this.targetAnimations(),e=t.indexOf(this);-1!==e&&t.splice(e,1)},t.prototype.tick=function(t,e){this._idle||this._paused||(null===this._startTime?e&&(this.startTime=t-this._currentTime/this.playbackRate):this._isFinished||this.tickCurrentTime((t-this._startTime)*this.playbackRate)),e&&(this.currentTimePending=!1,this.fireEvents(t))},t.prototype.rewind=function(){if(this.playbackRate>=0)this.currentTime=0;else{if(!(this._totalDuration<1/0))throw new Error("Unable to rewind negative playback rate animation with infinite duration");this.currentTime=this._totalDuration}},t.prototype.persist=function(){throw new Error(Yi)},t.prototype.addEventListener=function(t,e,i){throw new Error(Yi)},t.prototype.removeEventListener=function(t,e,i){throw new Error(Yi)},t.prototype.dispatchEvent=function(t){throw new Error(Yi)},t.prototype.commitStyles=function(){throw new Error(Yi)},t.prototype.ensureAlive=function(){var t,e;this.playbackRate<0&&0===this.currentTime?this._inEffect=!!(null===(t=this.effect)||void 0===t?void 0:t.update(-1)):this._inEffect=!!(null===(e=this.effect)||void 0===e?void 0:e.update(this.currentTime)),this._inTimeline||!this._inEffect&&this._finishedFlag||(this._inTimeline=!0,this.timeline.animations.push(this))},t.prototype.tickCurrentTime=function(t,e){t!==this._currentTime&&(this._currentTime=t,this._isFinished&&!e&&(this._currentTime=this._playbackRate>0?this._totalDuration:0),this.ensureAlive())},t.prototype.fireEvents=function(t){var e=this;if(this._isFinished){if(!this._finishedFlag){if(this.onfinish){var i=new Dr(null,this,this.currentTime,t);setTimeout(function(){e.onfinish&&e.onfinish(i)})}this._finishedFlag=!0}}else{if(this.onframe&&"running"===this.playState){var a=new Dr(null,this,this.currentTime,t);this.onframe(a)}this._finishedFlag=!1}},t}(),Fr=.1,$r="function"==typeof Float32Array,qr=function(t,e){return 1-3*e+3*t},Gr=function(t,e){return 3*e-6*t},Br=function(t){return 3*t},jr=function(t,e,i){return((qr(e,i)*t+Gr(e,i))*t+Br(e))*t},Ur=function(t,e,i){return 3*qr(e,i)*t*t+2*Gr(e,i)*t+Br(e)},Yr=function(t,e,i,a){if(!(0<=t&&t<=1&&0<=i&&i<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&i===a)return function(t){return t};for(var s=$r?new Float32Array(11):new Array(11),n=0;n<11;++n)s[n]=jr(n*Fr,t,i);var o=function(e){for(var a=0,n=1;10!==n&&s[n]<=e;++n)a+=Fr;--n;var o=a+(e-s[n])/(s[n+1]-s[n])*Fr,r=Ur(o,t,i);return r>=.001?function(t,e,i,a){for(var s=0;s<4;++s){var n=Ur(e,i,a);if(0===n)return e;e-=(jr(e,i,a)-t)/n}return e}(e,o,t,i):0===r?o:function(t,e,i,a,s){var n,o,r=0;do{(n=jr(o=e+(i-e)/2,a,s)-t)>0?i=o:e=o}while(Math.abs(n)>1e-7&&++r<10);return o}(e,a,a+Fr,t,i)};return function(t){return 0===t||1===t?t:jr(o(t),e,a)}},zr=function(t){return Math.pow(t,2)},Vr=function(t){return Math.pow(t,3)},Wr=function(t){return Math.pow(t,4)},Hr=function(t){return Math.pow(t,5)},Kr=function(t){return Math.pow(t,6)},Qr=function(t){return 1-Math.cos(t*Math.PI/2)},Xr=function(t){return 1-Math.sqrt(1-t*t)},Jr=function(t){return t*t*(3*t-2)},Zr=function(t){for(var e,i=4;t<((e=Math.pow(2,--i))-1)/11;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)},tl=function(t,e){void 0===e&&(e=[]);var i=u(e,2),a=i[0],s=void 0===a?1:a,n=i[1],o=void 0===n?.5:n,r=ge(Number(s),1,10),l=ge(Number(o),.1,2);return 0===t||1===t?t:-r*Math.pow(2,10*(t-1))*Math.sin((t-1-l/(2*Math.PI)*Math.asin(1/r))*(2*Math.PI)/l)},el=function(t,e,i){void 0===e&&(e=[]);var a=u(e,4),s=a[0],n=void 0===s?1:s,o=a[1],r=void 0===o?100:o,l=a[2],c=void 0===l?10:l,d=a[3],h=void 0===d?0:d;n=ge(n,.1,1e3),r=ge(r,.1,1e3),c=ge(c,.1,1e3),h=ge(h,.1,1e3);var p=Math.sqrt(r/n),m=c/(2*Math.sqrt(r*n)),f=m<1?p*Math.sqrt(1-m*m):0,g=m<1?(m*p-h)/f:-h+p,_=i?i*t/1e3:t;return _=m<1?Math.exp(-_*m*p)*(1*Math.cos(f*_)+g*Math.sin(f*_)):(1+g*_)*Math.exp(-_*p),0===t||1===t?t:1-_},il=function(t,e){void 0===e&&(e=[]);var i=u(e,2),a=i[0],s=void 0===a?10:a;return("start"==i[1]?Math.ceil:Math.floor)(ge(t,0,1)*s)/s},al=function(t,e){void 0===e&&(e=[]);var i=u(e,4),a=i[0],s=i[1],n=i[2],o=i[3];return Yr(a,s,n,o)(t)},sl=Yr(.42,0,1,1),nl=function(t){return function(e,i,a){return void 0===i&&(i=[]),1-t(1-e,i,a)}},ol=function(t){return function(e,i,a){return void 0===i&&(i=[]),e<.5?t(2*e,i,a)/2:1-t(-2*e+2,i,a)/2}},rl=function(t){return function(e,i,a){return void 0===i&&(i=[]),e<.5?(1-t(1-2*e,i,a))/2:(t(2*e-1,i,a)+1)/2}},ll={steps:il,"step-start":function(t){return il(t,[1,"start"])},"step-end":function(t){return il(t,[1,"end"])},linear:function(t){return t},"cubic-bezier":al,ease:function(t){return al(t,[.25,.1,.25,1])},in:sl,out:nl(sl),"in-out":ol(sl),"out-in":rl(sl),"in-quad":zr,"out-quad":nl(zr),"in-out-quad":ol(zr),"out-in-quad":rl(zr),"in-cubic":Vr,"out-cubic":nl(Vr),"in-out-cubic":ol(Vr),"out-in-cubic":rl(Vr),"in-quart":Wr,"out-quart":nl(Wr),"in-out-quart":ol(Wr),"out-in-quart":rl(Wr),"in-quint":Hr,"out-quint":nl(Hr),"in-out-quint":ol(Hr),"out-in-quint":rl(Hr),"in-expo":Kr,"out-expo":nl(Kr),"in-out-expo":ol(Kr),"out-in-expo":rl(Kr),"in-sine":Qr,"out-sine":nl(Qr),"in-out-sine":ol(Qr),"out-in-sine":rl(Qr),"in-circ":Xr,"out-circ":nl(Xr),"in-out-circ":ol(Xr),"out-in-circ":rl(Xr),"in-back":Jr,"out-back":nl(Jr),"in-out-back":ol(Jr),"out-in-back":rl(Jr),"in-bounce":Zr,"out-bounce":nl(Zr),"in-out-bounce":ol(Zr),"out-in-bounce":rl(Zr),"in-elastic":tl,"out-elastic":nl(tl),"in-out-elastic":ol(tl),"out-in-elastic":rl(tl),spring:el,"spring-in":el,"spring-out":nl(el),"spring-in-out":ol(el),"spring-out-in":rl(el)},cl=function(t){return t};function dl(t,e){return function(i){if(i>=1)return 1;var a=1/t;return(i+=e*a)-i%a}}var hl="\\s*(-?\\d+\\.?\\d*|-?\\.\\d+)\\s*",ul=new RegExp("cubic-bezier\\("+hl+","+hl+","+hl+","+hl+"\\)"),pl=/steps\(\s*(\d+)\s*\)/,ml=/steps\(\s*(\d+)\s*,\s*(start|middle|end)\s*\)/;function fl(t){var e=ul.exec(t);if(e)return Yr.apply(void 0,p([],u(e.slice(1).map(Number)),!1));var i=pl.exec(t);if(i)return dl(Number(i[1]),0);var a=ml.exec(t);return a?dl(Number(a[1]),{start:1,middle:.5,end:0}[a[2]]):function(t){return ll[function(t){return function(t){return"-"===(t=t.replace(/([A-Z])/g,function(t){return"-".concat(t.toLowerCase())})).charAt(0)?t.substring(1):t}(t).replace(/^ease-/,"").replace(/(\(|\s).+/,"").toLowerCase().trim()}(t)]||ll.linear}(t)}function gl(t){return"offset"!==t&&"easing"!==t&&"composite"!==t&&"computedOffset"!==t}var _l=function(t,e,i){return function(a){var s=vl(t,e,a);return!Ro.enableCSSParsing&&_e(s)?s:i(s)}};function yl(t,e,i,a){var s=Zs[t];if(s&&s.syntax&&s.int){var n=Ro.styleValueRegistry.getPropertySyntax(s.syntax);if(n){var o=void 0,r=void 0;if(Ro.enableCSSParsing){var l=Ro.styleValueRegistry.parseProperty(t,e,a,!1),c=Ro.styleValueRegistry.parseProperty(t,i,a,!1);o=Ro.styleValueRegistry.computeProperty(t,l,a,!1),r=Ro.styleValueRegistry.computeProperty(t,c,a,!1)}else{var d=n.parserWithCSSDisabled;o=d?d(e,a):e,r=d?d(i,a):i}var h=n.mixer(o,r,a);if(h){var m=_l.apply(void 0,p([],u(h),!1));return function(t){return 0===t?e:1===t?i:m(t)}}}}return _l(!1,!0,function(t){return t?i:e})}function vl(t,e,i){if("number"==typeof t&&"number"==typeof e)return t*(1-i)+e*i;if("boolean"==typeof t&&"boolean"==typeof e||"string"==typeof t&&"string"==typeof e)return i<.5?t:e;if(Array.isArray(t)&&Array.isArray(e)){for(var a=t.length,s=e.length,n=Math.max(a,s),o=[],r=0;r<n;r++)o.push(vl(t[r<a?r:a-1],e[r<s?r:s-1],i));return o}throw new Error("Mismatched interpolation arguments "+t+":"+e)}var bl=function(){function t(){this.delay=0,this.direction="normal",this.duration="auto",this._easing="linear",this.easingFunction=cl,this.endDelay=0,this.fill="auto",this.iterationStart=0,this.iterations=1,this.currentIteration=null,this.progress=null}return Object.defineProperty(t.prototype,"easing",{get:function(){return this._easing},set:function(t){this.easingFunction=fl(t),this._easing=t},enumerable:!1,configurable:!0}),t}();function El(t,e){if(null===t)return[];Array.isArray(t)||(t=function(t){var e=[];for(var i in t)if(!(i in["easing","offset","composite"])){var a=t[i];Array.isArray(a)||(a=[a]);for(var s=a.length,n=0;n<s;n++){if(!e[n]){var o={};"offset"in t&&(o.offset=Number(t.offset)),"easing"in t&&(o.easing=t.easing),"composite"in t&&(o.composite=t.composite),e[n]=o}void 0!==a[n]&&null!==a[n]&&(e[n][i]=a[n])}}return e.sort(function(t,e){return(t.computedOffset||0)-(e.computedOffset||0)}),e}(t));for(var i=t.map(function(t){var i={};for(var a in(null==e?void 0:e.composite)&&(i.composite="auto"),t){var s=t[a];if("offset"===a){if(null!==s){if(s=Number(s),!isFinite(s))throw new Error("Keyframe offsets must be numbers.");if(s<0||s>1)throw new Error("Keyframe offsets must be between 0 and 1.");i.computedOffset=s}}else if("composite"===a&&-1===["replace","add","accumulate","auto"].indexOf(s))throw new Error("".concat(s," compositing is not supported"));i[a]=s}return void 0===i.offset&&(i.offset=null),void 0===i.easing&&(i.easing=(null==e?void 0:e.easing)||"linear"),void 0===i.composite&&(i.composite="auto"),i}),a=!0,s=-1/0,n=0;n<i.length;n++){var o=i[n].offset;if(le(o))a=!1;else{if(o<s)throw new TypeError("Keyframes are not loosely sorted by offset. Sort or specify offsets.");s=o}}return i=i.filter(function(t){return Number(t.offset)>=0&&Number(t.offset)<=1}),a||function(){var t,e,a=i.length;i[a-1].computedOffset=Number(null!==(t=i[a-1].offset)&&void 0!==t?t:1),a>1&&(i[0].computedOffset=Number(null!==(e=i[0].offset)&&void 0!==e?e:0));for(var s=0,n=Number(i[0].computedOffset),o=1;o<a;o++){var r=i[o].computedOffset;if(!le(r)&&!le(n)){for(var l=1;l<o-s;l++)i[s+l].computedOffset=n+(Number(r)-n)*l/(o-s);s=o,n=Number(r)}}}(),i}var Al="backwards|forwards|both|none".split("|"),wl="reverse|alternate|alternate-reverse".split("|");function Sl(t,e){return function(t,e){var i=new bl;return e&&(i.fill="both",i.duration="auto"),"number"!=typeof t||isNaN(t)?void 0!==t&&Object.keys(t).forEach(function(e){if(void 0!==t[e]&&null!==t[e]&&"auto"!==t[e]){if(("number"==typeof i[e]||"duration"===e)&&("number"!=typeof t[e]||isNaN(t[e])))return;if("fill"===e&&-1===Al.indexOf(t[e]))return;if("direction"===e&&-1===wl.indexOf(t[e]))return;i[e]=t[e]}}):i.duration=t,i}(t=function(t){return"number"==typeof t&&(t=isNaN(t)?{duration:"auto"}:{duration:t}),t}(null!=t?t:{duration:"auto"}),e)}var Cl=function(){function t(t,e,i){var a=this;this.composite="replace",this.iterationComposite="replace",this.target=t,this.timing=Sl(i,!1),this.timing.effect=this,this.timing.activeDuration=function(t){return Math.abs(function(t){var e;return 0===t.duration||0===t.iterations?0:("auto"===t.duration?0:Number(t.duration))*(null!==(e=t.iterations)&&void 0!==e?e:1)}(t)/(t.playbackRate||1))}(this.timing),this.timing.endTime=Math.max(0,this.timing.delay+this.timing.activeDuration+this.timing.endDelay),this.normalizedKeyframes=El(e,this.timing),this.interpolations=function(t,e,i){var a=function(t,e){for(var i={},a=0;a<t.length;a++)for(var s in t[a])if(gl(s)){var n={offset:t[a].offset,computedOffset:t[a].computedOffset,easing:t[a].easing,easingFunction:fl(t[a].easing)||e.easingFunction,value:t[a][s]};i[s]=i[s]||[],i[s].push(n)}return i}(t,e),s=function(t,e){var i=[];for(var a in t)for(var s=t[a],n=0;n<s.length-1;n++){var o=n,r=n+1,l=s[o].computedOffset,c=s[r].computedOffset,d=l,h=c;0===n&&(d=-1/0,0===c&&(r=o)),n===s.length-2&&(h=1/0,1===l&&(o=r)),i.push({applyFrom:d,applyTo:h,startOffset:s[o].computedOffset,endOffset:s[r].computedOffset,easingFunction:s[o].easingFunction,property:a,interpolation:yl(a,s[o].value,s[r].value,e)})}return i.sort(function(t,e){return t.startOffset-e.startOffset}),i}(a,i);return function(t,e){if(null!==e)s.filter(function(t){return e>=t.applyFrom&&e<t.applyTo}).forEach(function(i){var a=e-i.startOffset,s=i.endOffset-i.startOffset,n=0===s?0:i.easingFunction(a/s);t.setAttribute(i.property,i.interpolation(n),!1,!1)});else for(var i in a)gl(i)&&t.setAttribute(i,null)}}(this.normalizedKeyframes,this.timing,this.target);var s=Ro.globalThis.Proxy;this.computedTiming=s?new s(this.timing,{get:function(t,e){return"duration"===e?"auto"===t.duration?0:t.duration:"fill"===e?"auto"===t.fill?"none":t.fill:"localTime"===e?a.animation&&a.animation.currentTime||null:"currentIteration"===e?a.animation&&"running"===a.animation.playState?t.currentIteration||0:null:"progress"===e?a.animation&&"running"===a.animation.playState?t.progress||0:null:t[e]},set:function(){return!0}}):this.timing}return t.prototype.applyInterpolations=function(){this.interpolations(this.target,Number(this.timeFraction))},t.prototype.update=function(t){return null!==t&&(this.timeFraction=function(t,e,i){var a=function(t,e,i){if(null===e)return 0;var a=i.endTime;return e<Math.min(i.delay,a)?1:e>=Math.min(i.delay+t+i.endDelay,a)?2:3}(t,e,i),s=function(t,e,i,a,s){switch(a){case 1:return"backwards"===e||"both"===e?0:null;case 3:return i-s;case 2:return"forwards"===e||"both"===e?t:null;case 0:return null}}(t,i.fill,e,a,i.delay);if(null===s)return null;var n="auto"===i.duration?0:i.duration,o=function(t,e,i,a,s){var n=s;return 0===t?1!==e&&(n+=i):n+=a/t,n}(n,a,i.iterations,s,i.iterationStart),r=function(t,e,i,a,s,n){var o=t===1/0?e%1:t%1;return 0!==o||2!==i||0===a||0===s&&0!==n||(o=1),o}(o,i.iterationStart,a,i.iterations,s,n),l=function(t,e,i,a){return 2===t&&e===1/0?1/0:1===i?Math.floor(a)-1:Math.floor(a)}(a,i.iterations,r,o),c=function(t,e,i){var a=t;if("normal"!==t&&"reverse"!==t){var s=e;"alternate-reverse"===t&&(s+=1),a="normal",s!==1/0&&s%2!=0&&(a="reverse")}return"normal"===a?i:1-i}(i.direction,l,r);return i.currentIteration=l,i.progress=c,i.easingFunction(c)}(this.timing.activeDuration,t,this.timing),null!==this.timeFraction)},t.prototype.getKeyframes=function(){return this.normalizedKeyframes},t.prototype.setKeyframes=function(t){this.normalizedKeyframes=El(t)},t.prototype.getComputedTiming=function(){return this.computedTiming},t.prototype.getTiming=function(){return this.timing},t.prototype.updateTiming=function(t){var e=this;Object.keys(t||{}).forEach(function(i){e.timing[i]=t[i]})},t}();function Il(t,e){return Number(t.id)-Number(e.id)}var xl=function(){function t(t){var e=this;this.document=t,this.animations=[],this.ticking=!1,this.timelineTicking=!1,this.hasRestartedThisFrame=!1,this.animationsWithPromises=[],this.inTick=!1,this.pendingEffects=[],this.currentTime=null,this.rafId=0,this.rafCallbacks=[],this.webAnimationsNextTick=function(t){e.currentTime=t,e.discardAnimations(),0===e.animations.length?e.timelineTicking=!1:e.requestAnimationFrame(e.webAnimationsNextTick)},this.processRafCallbacks=function(t){var i=e.rafCallbacks;e.rafCallbacks=[],t<Number(e.currentTime)&&(t=Number(e.currentTime)),e.animations.sort(Il),e.animations=e.tick(t,!0,e.animations)[0],i.forEach(function(e){e[1](t)}),e.applyPendingEffects()}}return t.prototype.getAnimations=function(){return this.discardAnimations(),this.animations.slice()},t.prototype.isTicking=function(){return this.inTick},t.prototype.play=function(t,e,i){var a=new Cl(t,e,i),s=new kr(a,this);return this.animations.push(s),this.restartWebAnimationsNextTick(),s.updatePromises(),s.play(),s.updatePromises(),s},t.prototype.applyDirtiedAnimation=function(t){var e=this;if(!this.inTick){t.markTarget();var i=t.targetAnimations();i.sort(Il),this.tick(Number(this.currentTime),!1,i.slice())[1].forEach(function(t){var i=e.animations.indexOf(t);-1!==i&&e.animations.splice(i,1)}),this.applyPendingEffects()}},t.prototype.restart=function(){return this.ticking||(this.ticking=!0,this.requestAnimationFrame(function(){}),this.hasRestartedThisFrame=!0),this.hasRestartedThisFrame},t.prototype.destroy=function(){this.document.defaultView.cancelAnimationFrame(this.frameId)},t.prototype.applyPendingEffects=function(){this.pendingEffects.forEach(function(t){null==t||t.applyInterpolations()}),this.pendingEffects=[]},t.prototype.updateAnimationsPromises=function(){this.animationsWithPromises=this.animationsWithPromises.filter(function(t){return t.updatePromises()})},t.prototype.discardAnimations=function(){this.updateAnimationsPromises(),this.animations=this.animations.filter(function(t){return"finished"!==t.playState&&"idle"!==t.playState})},t.prototype.restartWebAnimationsNextTick=function(){this.timelineTicking||(this.timelineTicking=!0,this.requestAnimationFrame(this.webAnimationsNextTick))},t.prototype.rAF=function(t){var e=this.rafId++;return 0===this.rafCallbacks.length&&(this.frameId=this.document.defaultView.requestAnimationFrame(this.processRafCallbacks)),this.rafCallbacks.push([e,t]),e},t.prototype.requestAnimationFrame=function(t){var e=this;return this.rAF(function(i){e.updateAnimationsPromises(),t(i),e.updateAnimationsPromises()})},t.prototype.tick=function(t,e,i){var a,s,n=this;this.inTick=!0,this.hasRestartedThisFrame=!1,this.currentTime=t,this.ticking=!1;var o=[],r=[],l=[],c=[];return i.forEach(function(i){i.tick(t,e),i._inEffect?(r.push(i.effect),i.markTarget()):(o.push(i.effect),i.unmarkTarget()),i._needsTick&&(n.ticking=!0);var a=i._inEffect||i._needsTick;i._inTimeline=a,a?l.push(i):c.push(i)}),(a=this.pendingEffects).push.apply(a,p([],u(o),!1)),(s=this.pendingEffects).push.apply(s,p([],u(r),!1)),this.ticking&&this.requestAnimationFrame(function(){}),this.inTick=!1,[l,c]},t}();function Tl(t,e){var i=e.r;t.arc(i,i,i,0,2*Math.PI,!1)}function Ml(t,e){var i=e.rx,a=e.ry;if(t.ellipse)t.ellipse(i,a,i,a,0,0,2*Math.PI,!1);else{var s=i>a?i:a,n=i>a?1:i/a,o=i>a?a/i:1;t.save(),t.scale(n,o),t.arc(s,s,s,0,2*Math.PI)}}function Pl(t,e){var i,a,s=e.x1,n=e.y1,o=e.x2,r=e.y2,l=e.defX,c=void 0===l?0:l,d=e.defY,h=void 0===d?0:d,u=e.markerStart,p=e.markerEnd,m=e.markerStartOffset,f=e.markerEndOffset,g=0,_=0,y=0,v=0,b=0;u&&Bo(u)&&m&&(i=o-s,a=r-n,b=Math.atan2(a,i),g=Math.cos(b)*(m||0),_=Math.sin(b)*(m||0)),p&&Bo(p)&&f&&(i=s-o,a=n-r,b=Math.atan2(a,i),y=Math.cos(b)*(f||0),v=Math.sin(b)*(f||0)),t.moveTo(s-c+g,n-h+_),t.lineTo(o-c+y,r-h+v)}function Ol(t,e){var i,a,s=e.defX,n=void 0===s?0:s,o=e.defY,r=void 0===o?0:o,l=e.markerStart,c=e.markerEnd,d=e.markerStartOffset,h=e.markerEndOffset,p=e.path,m=p.absolutePath,f=p.segments,g=0,_=0,y=0,v=0,b=0;if(l&&Bo(l)&&d){var E=u(l.parentNode.getStartTangent(),2),A=E[0],w=E[1];i=A[0]-w[0],a=A[1]-w[1],b=Math.atan2(a,i),g=Math.cos(b)*(d||0),_=Math.sin(b)*(d||0)}if(c&&Bo(c)&&h){var S=u(c.parentNode.getEndTangent(),2);A=S[0],w=S[1],i=A[0]-w[0],a=A[1]-w[1],b=Math.atan2(a,i),y=Math.cos(b)*(h||0),v=Math.sin(b)*(h||0)}for(var C=0;C<m.length;C++){var I=m[C],x=I[0],T=m[C+1],M=0===C&&(0!==g||0!==_),P=(C===m.length-1||T&&("M"===T[0]||"Z"===T[0]))&&0!==y&&0!==v;switch(x){case"M":M?(t.moveTo(I[1]-n+g,I[2]-r+_),t.lineTo(I[1]-n,I[2]-r)):t.moveTo(I[1]-n,I[2]-r);break;case"L":P?t.lineTo(I[1]-n+y,I[2]-r+v):t.lineTo(I[1]-n,I[2]-r);break;case"Q":t.quadraticCurveTo(I[1]-n,I[2]-r,I[3]-n,I[4]-r),P&&t.lineTo(I[3]-n+y,I[4]-r+v);break;case"C":t.bezierCurveTo(I[1]-n,I[2]-r,I[3]-n,I[4]-r,I[5]-n,I[6]-r),P&&t.lineTo(I[5]-n+y,I[6]-r+v);break;case"A":var O=f[C].arcParams,L=O.cx,R=O.cy,D=O.rx,N=O.ry,k=O.startAngle,F=O.endAngle,$=O.xRotation,q=O.sweepFlag;if(t.ellipse)t.ellipse(L-n,R-r,D,N,$,k,F,!!(1-q));else{var G=D>N?D:N,B=D>N?1:D/N,j=D>N?N/D:1;t.translate(L-n,R-r),t.rotate($),t.scale(B,j),t.arc(0,0,G,k,F,!!(1-q)),t.scale(1/B,1/j),t.rotate(-$),t.translate(-(L-n),-(R-r))}P&&t.lineTo(I[6]-n+y,I[7]-r+v);break;case"Z":t.closePath()}}}function Ll(t,e){var i,a,s=e.defX,n=void 0===s?0:s,o=e.defY,r=void 0===o?0:o,l=e.markerStart,c=e.markerEnd,d=e.markerStartOffset,h=e.markerEndOffset,u=e.points.points,p=u.length,m=u[0][0]-n,f=u[0][1]-r,g=u[p-1][0]-n,_=u[p-1][1]-r,y=0,v=0,b=0,E=0,A=0;l&&Bo(l)&&d&&(i=u[1][0]-u[0][0],a=u[1][1]-u[0][1],A=Math.atan2(a,i),y=Math.cos(A)*(d||0),v=Math.sin(A)*(d||0)),c&&Bo(c)&&h&&(i=u[p-1][0]-u[0][0],a=u[p-1][1]-u[0][1],A=Math.atan2(a,i),b=Math.cos(A)*(h||0),E=Math.sin(A)*(h||0)),t.moveTo(m+(y||b),f+(v||E));for(var w=1;w<p-1;w++){var S=u[w];t.lineTo(S[0]-n,S[1]-r)}t.lineTo(g,_)}function Rl(t,e){var i,a,s=e.defX,n=void 0===s?0:s,o=e.defY,r=void 0===o?0:o,l=e.markerStart,c=e.markerEnd,d=e.markerStartOffset,h=e.markerEndOffset,u=e.points.points,p=u.length,m=u[0][0]-n,f=u[0][1]-r,g=u[p-1][0]-n,_=u[p-1][1]-r,y=0,v=0,b=0,E=0,A=0;l&&Bo(l)&&d&&(i=u[1][0]-u[0][0],a=u[1][1]-u[0][1],A=Math.atan2(a,i),y=Math.cos(A)*(d||0),v=Math.sin(A)*(d||0)),c&&Bo(c)&&h&&(i=u[p-2][0]-u[p-1][0],a=u[p-2][1]-u[p-1][1],A=Math.atan2(a,i),b=Math.cos(A)*(h||0),E=Math.sin(A)*(h||0)),t.moveTo(m+y,f+v);for(var w=1;w<p-1;w++){var S=u[w];t.lineTo(S[0]-n,S[1]-r)}t.lineTo(g+b,_+E)}function Dl(t,e){var i=e.radius,a=e.width,s=e.height,n=a,o=s;if(i&&i.some(function(t){return 0!==t})){var r=a>0?1:-1,l=s>0?1:-1,c=r+l===0,d=u(i.map(function(t){return ge(t,0,Math.min(Math.abs(n)/2,Math.abs(o)/2))}),4),h=d[0],p=d[1],m=d[2],f=d[3];t.moveTo(r*h,0),t.lineTo(n-r*p,0),0!==p&&t.arc(n-r*p,l*p,p,-l*Math.PI/2,r>0?0:Math.PI,c),t.lineTo(n,o-l*m),0!==m&&t.arc(n-r*m,o-l*m,m,r>0?0:Math.PI,l>0?Math.PI/2:1.5*Math.PI,c),t.lineTo(r*f,o),0!==f&&t.arc(r*f,o-l*f,f,l>0?Math.PI/2:-Math.PI/2,r>0?Math.PI:0,c),t.lineTo(0,l*h),0!==h&&t.arc(r*h,l*h,h,r>0?Math.PI:0,l>0?1.5*Math.PI:Math.PI/2,c)}else t.rect(0,0,n,o)}Ro.EasingFunction=fl,Ro.AnimationTimeline=xl;var Nl=function(t){function e(){var e=t.apply(this,p([],u(arguments),!1))||this;return e.name="canvas-path-generator",e}return o(e,t),e.prototype.init=function(){var t,e=((t={})[mi.CIRCLE]=Tl,t[mi.ELLIPSE]=Ml,t[mi.RECT]=Dl,t[mi.LINE]=Pl,t[mi.POLYLINE]=Rl,t[mi.POLYGON]=Ll,t[mi.PATH]=Ol,t[mi.TEXT]=void 0,t[mi.GROUP]=void 0,t[mi.IMAGE]=void 0,t[mi.HTML]=void 0,t[mi.MESH]=void 0,t);this.context.pathGeneratorFactory=e},e.prototype.destroy=function(){delete this.context.pathGeneratorFactory},e}(_i),kl=Z(),Fl=Z(),$l=Z(),ql=A(),Gl=function(){function t(){var t=this;this.isHit=function(e,i,a,s){var n=t.context.pointInPathPickerFactory[e.nodeName];if(n){var o=T(ql,a),r=ht(Fl,st($l,i[0],i[1],0),o),l=e.getGeometryBounds().halfExtents,c=e.parsedStyle.anchor;if(r[0]+=(c&&c[0]||0)*l[0]*2,r[1]+=(c&&c[1]||0)*l[1]*2,n(e,new ji(r[0],r[1]),s,t.isPointInPath,t.context,t.runtime))return!0}return!1},this.isPointInPath=function(e,i){var a=t.runtime.offscreenCanvasCreator.getOrCreateContext(t.context.config.offscreenCanvas),s=t.context.pathGeneratorFactory[e.nodeName];return s&&(a.beginPath(),s(a,e.parsedStyle),a.closePath()),a.isPointInPath(i.x,i.y)}}return t.prototype.apply=function(e,i){var a,s=this,n=e.renderingService,o=e.renderingContext;this.context=e,this.runtime=i;var r=null===(a=o.root)||void 0===a?void 0:a.ownerDocument;n.hooks.pick.tapPromise(t.tag,function(t){return c(s,void 0,void 0,function(){return d(this,function(e){return[2,this.pick(r,t)]})})}),n.hooks.pickSync.tap(t.tag,function(t){return s.pick(r,t)})},t.prototype.pick=function(t,e){var i,a,s=e.topmost,n=e.position,o=n.x,r=n.y,l=st(kl,o,r,0),c=t.elementsFromBBox(l[0],l[1],l[0],l[1]),d=[];try{for(var u=h(c),p=u.next();!p.done;p=u.next()){var m=p.value,f=m.getWorldTransform();if(this.isHit(m,l,f,!1)){var g=Tn(m);if(g){var _=g.parsedStyle.clipPath;if(this.isHit(_,l,_.getWorldTransform(),!0)){if(s)return e.picked=[m],e;d.push(m)}}else{if(s)return e.picked=[m],e;d.push(m)}}}}catch(t){i={error:t}}finally{try{p&&!p.done&&(a=u.return)&&a.call(u)}finally{if(i)throw i.error}}return e.picked=d,e},t.tag="CanvasPicker",t}();function Bl(t,e,i){var a=t.parsedStyle,s=a.r,n=a.fill,o=a.stroke,r=a.lineWidth,l=a.increasedLineWidthForHitTesting,c=a.pointerEvents,d=((r||0)+(l||0))/2,h=Xe(s,s,e.x,e.y),p=u(Ln(c,n,o),2),m=p[0],f=p[1];return m&&f||i?h<=s+d:m?h<=s:!!f&&h>=s-d&&h<=s+d}function jl(t,e,i,a){return t/(i*i)+e/(a*a)}function Ul(t,e,i){var a=t.parsedStyle,s=a.rx,n=a.ry,o=a.fill,r=a.stroke,l=a.lineWidth,c=a.increasedLineWidthForHitTesting,d=a.pointerEvents,h=e.x,p=e.y,m=u(Ln(d,o,r),2),f=m[0],g=m[1],_=((l||0)+(c||0))/2,y=(h-s)*(h-s),v=(p-n)*(p-n);return f&&g||i?jl(y,v,s+_,n+_)<=1:f?jl(y,v,s,n)<=1:!!g&&jl(y,v,s-_,n-_)>=1&&jl(y,v,s+_,n+_)<=1}function Yl(t,e,i,a,s,n){return s>=t&&s<=t+i&&n>=e&&n<=e+a}function zl(t,e,i,a,s,n,o,r){var l=(Math.atan2(r-e,o-t)+2*Math.PI)%(2*Math.PI),c={x:t+i*Math.cos(l),y:e+i*Math.sin(l)};return Xe(c.x,c.y,o,r)<=n/2}function Vl(t,e,i,a,s,n,o){var r=Math.min(t,i),l=Math.max(t,i),c=Math.min(e,a),d=Math.max(e,a),h=s/2;return n>=r-h&&n<=l+h&&o>=c-h&&o<=d+h&&function(t,e,i,a,s,n){var o=[i-t,a-e];if(function(t,e){return t[0]===e[0]&&t[1]===e[1]}(o,[0,0]))return Math.sqrt((s-t)*(s-t)+(n-e)*(n-e));var r=[-o[1],o[0]];!function(t,e){var i=e[0],a=e[1],s=i*i+a*a;s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s}(r,r);var l=[s-t,n-e];return Math.abs(function(t,e){return t[0]*e[0]+t[1]*e[1]}(l,r))}(t,e,i,a,n,o)<=s/2}function Wl(t,e,i,a,s){var n=t.length;if(n<2)return!1;for(var o=0;o<n-1;o++)if(Vl(t[o][0],t[o][1],t[o+1][0],t[o+1][1],e,i,a))return!0;if(s){var r=t[0],l=t[n-1];if(Vl(r[0],r[1],l[0],l[1],e,i,a))return!0}return!1}function Hl(t){return Math.abs(t)<1e-6?0:t<0?-1:1}function Kl(t,e,i){return(i[0]-t[0])*(e[1]-t[1])==(e[0]-t[0])*(i[1]-t[1])&&Math.min(t[0],e[0])<=i[0]&&i[0]<=Math.max(t[0],e[0])&&Math.min(t[1],e[1])<=i[1]&&i[1]<=Math.max(t[1],e[1])}function Ql(t,e,i){var a=!1,s=t.length;if(s<=2)return!1;for(var n=0;n<s;n++){var o=t[n],r=t[(n+1)%s];if(Kl(o,r,[e,i]))return!0;Hl(o[1]-i)>0!=Hl(r[1]-i)>0&&Hl(e-(i-o[1])*(o[0]-r[0])/(o[1]-r[1])-o[0])<0&&(a=!a)}return a}function Xl(t,e,i){for(var a=!1,s=0;s<t.length&&!(a=Ql(t[s],e,i));s++);return a}function Jl(t,e,i){var a=t.parsedStyle,s=a.x1,n=a.y1,o=a.x2,r=a.y2,l=a.lineWidth,c=a.increasedLineWidthForHitTesting,d=a.defX,h=void 0===d?0:d,p=a.defY,m=void 0===p?0:p;return!(!u(Ln(a.pointerEvents,a.fill,a.stroke),2)[1]&&!i||!l)&&Vl(s,n,o,r,(l||0)+(c||0),e.x+h,e.y+m)}function Zl(t,e,i,a,s,n){var o=t.parsedStyle,r=o.lineWidth,l=o.increasedLineWidthForHitTesting,c=o.stroke,d=o.fill,h=o.defX,p=void 0===h?0:h,m=o.defY,f=void 0===m?0:m,g=o.path,_=o.pointerEvents,y=g.segments,v=g.hasArc,b=g.polylines,E=g.polygons,A=u(Ln(_,(null==E?void 0:E.length)&&d,c),2),w=A[0],S=A[1],C=fs(t),I=!1;return w||i?I=v?a(t,e):Xl(E,e.x+p,e.y+f)||Xl(b,e.x+p,e.y+f):((S||i)&&(I=function(t,e,i,a,s){for(var n=!1,o=e/2,r=0;r<t.length;r++){var l=t[r],c=l.currentPoint,d=l.params,h=l.prePoint,u=l.box;if(!u||Yl(u.x-o,u.y-o,u.width+e,u.height+e,i,a))switch(l.command){case"L":case"Z":if(n=Vl(h[0],h[1],c[0],c[1],e,i,a))return!0;break;case"Q":if(n=ui(h[0],h[1],d[1],d[2],d[3],d[4],i,a)<=e/2)return!0;break;case"C":if(n=li(h[0],h[1],d[1],d[2],d[3],d[4],d[5],d[6],i,a,s)<=e/2)return!0;break;case"A":l.cubicParams||(l.cubicParams=Yt(h[0],h[1],d[1],d[2],d[3],d[4],d[5],d[6],d[7],void 0));for(var p=l.cubicParams,m=h,f=0;f<p.length;f+=6){var g=li(m[0],m[1],p[f],p[f+1],p[f+2],p[f+3],p[f+4],p[f+5],i,a,s);if(m=[p[f+4],p[f+5]],n=g<=e/2)return!0}}}return n}(y,(r||0)+(l||0),e.x+p,e.y+f,C)),I)}function tc(t,e,i){var a=t.parsedStyle,s=a.stroke,n=a.fill,o=a.lineWidth,r=a.increasedLineWidthForHitTesting,l=a.points,c=a.defX,d=void 0===c?0:c,h=a.defY,p=void 0===h?0:h,m=u(Ln(a.pointerEvents,n,s),2),f=m[0],g=!1;return(m[1]||i)&&(g=Wl(l.points,(o||0)+(r||0),e.x+d,e.y+p,!0)),g||!f&&!i||(g=Ql(l.points,e.x+d,e.y+p)),g}function ec(t,e,i){var a=t.parsedStyle,s=a.lineWidth,n=a.increasedLineWidthForHitTesting,o=a.points,r=a.defX,l=void 0===r?0:r,c=a.defY,d=void 0===c?0:c;return!(!u(Ln(a.pointerEvents,a.fill,a.stroke),2)[1]&&!i||!s)&&Wl(o.points,(s||0)+(n||0),e.x+l,e.y+d,!1)}function ic(t,e,i,a,s){var n=t.parsedStyle,o=n.radius,r=n.fill,l=n.stroke,c=n.lineWidth,d=n.increasedLineWidthForHitTesting,h=n.width,p=n.height,m=u(Ln(n.pointerEvents,r,l),2),f=m[0],g=m[1],_=(c||0)+(d||0);if(o&&o.some(function(t){return 0!==t})){var y=!1;return(g||i)&&(y=function(t,e,i,a,s,n,o,r){var l=u(s,4),c=l[0],d=l[1],h=l[2],p=l[3];return Vl(0+c,0,0+i-d,0,n,o,r)||Vl(0+i,0+d,0+i,0+a-h,n,o,r)||Vl(0+i-h,0+a,0+p,0+a,n,o,r)||Vl(0,0+a-p,0,0+c,n,o,r)||zl(0+i-d,0+d,d,Math.PI,Math.PI,n,o,r)||zl(0+i-h,0+a-h,h,0,Math.PI,n,o,r)||zl(0+p,0+a-p,p,Math.PI,Math.PI,n,o,r)||zl(0+c,0+c,c,Math.PI,Math.PI,n,o,r)}(0,0,h,p,o.map(function(t){return ge(t,0,Math.min(Math.abs(h)/2,Math.abs(p)/2))}),_,e.x,e.y)),y||!f&&!i||(y=a(t,e)),y}var v=_/2;return f&&g||i?Yl(0-v,0-v,h+v,p+v,e.x,e.y):f?Yl(0,0,h,p,e.x,e.y):!!g&&function(t,e,i,a,s,n,o){var r=s/2;return Yl(0-r,0-r,i,s,n,o)||Yl(0+i-r,0-r,s,a,n,o)||Yl(0+r,0+a-r,i,s,n,o)||Yl(0-r,0+r,s,a,n,o)}(0,0,h,p,_,e.x,e.y)}function ac(t,e,i,a,s,n){var o=t.parsedStyle,r=o.pointerEvents,l=o.width,c=o.height;if("non-transparent-pixel"===r){var d=s.config.offscreenCanvas,h=n.offscreenCanvasCreator.getOrCreateCanvas(d),u=n.offscreenCanvasCreator.getOrCreateContext(d,{willReadFrequently:!0});return h.width=l,h.height=c,s.defaultStyleRendererFactory[mi.IMAGE].render(u,t.parsedStyle,t,void 0,void 0,void 0),u.getImageData(e.x,e.y,1,1).data.every(function(t){return 0!==t})}return!0}var sc=function(t){function e(){var e=t.apply(this,p([],u(arguments),!1))||this;return e.name="canvas-picker",e}return o(e,t),e.prototype.init=function(){var t,e=((t={})[mi.CIRCLE]=Bl,t[mi.ELLIPSE]=Ul,t[mi.RECT]=ic,t[mi.LINE]=Jl,t[mi.POLYLINE]=ec,t[mi.POLYGON]=tc,t[mi.PATH]=Zl,t[mi.TEXT]=function(){return!0},t[mi.GROUP]=null,t[mi.IMAGE]=ac,t[mi.HTML]=null,t[mi.MESH]=null,t);this.context.pointInPathPickerFactory=e,this.addRenderingPlugin(new Gl)},e.prototype.destroy=function(){delete this.context.pointInPathPickerFactory,this.removeAllRenderingPlugins()},e}(_i),nc=function(){function t(t){this.canvasRendererPluginOptions=t,this.removedRBushNodeAABBs=[],this.renderQueue=[],this.restoreStack=[],this.clearFullScreen=!1,this.vpMatrix=A(),this.dprMatrix=A(),this.tmpMat4=A(),this.vec3a=Z(),this.vec3b=Z(),this.vec3c=Z(),this.vec3d=Z()}return t.prototype.apply=function(e,i){var a=this;this.context=e;var s=e.config,n=e.camera,o=e.renderingService,r=e.renderingContext,l=e.rBushRoot,c=e.pathGeneratorFactory;this.rBush=l,this.pathGeneratorFactory=c;var d=e.contextService,h=r.root.ownerDocument.defaultView,m=function(t){var e=t.target.rBushNode;e.aabb&&a.removedRBushNodeAABBs.push(e.aabb)},f=function(t){var e=t.target.rBushNode;e.aabb&&a.removedRBushNodeAABBs.push(e.aabb)};o.hooks.init.tap(t.tag,function(){h.addEventListener(_o.UNMOUNTED,m),h.addEventListener(_o.CULLED,f);var t=d.getDPR(),e=s.width,i=s.height,n=d.getContext();a.clearRect(n,0,0,e*t,i*t,s.background)}),o.hooks.destroy.tap(t.tag,function(){h.removeEventListener(_o.UNMOUNTED,m),h.removeEventListener(_o.CULLED,f),a.renderQueue=[],a.removedRBushNodeAABBs=[],a.restoreStack=[]}),o.hooks.beginFrame.tap(t.tag,function(){var t=d.getContext(),e=d.getDPR(),i=s.width,n=s.height,r=a.canvasRendererPluginOptions,l=r.dirtyObjectNumThreshold,c=r.dirtyObjectRatioThreshold,h=o.getStats(),u=h.total,p=h.rendered,m=p/u;a.clearFullScreen=o.disableDirtyRectangleRendering()||p>l&&m>c,t&&(t.resetTransform?t.resetTransform():t.setTransform(1,0,0,1,0,0),a.clearFullScreen&&a.clearRect(t,0,0,i*e,n*e,s.background))});var g=function(t,e){t.isVisible()&&!t.isCulled()&&(a.renderDisplayObject(t,e,a.context,a.restoreStack,i),a.saveDirtyAABB(t)),(t.sortable.sorted||t.childNodes).forEach(function(t){g(t,e)})};o.hooks.endFrame.tap(t.tag,function(){var t=d.getContext(),e=d.getDPR();if(k(a.dprMatrix,[e,e,1]),P(a.vpMatrix,a.dprMatrix,n.getOrthoMatrix()),a.clearFullScreen)g(r.root,t);else{var o=a.safeMergeAABB.apply(a,p([a.mergeDirtyAABBs(a.renderQueue)],u(a.removedRBushNodeAABBs.map(function(t){var e=t.minX,i=t.minY,a=t.maxX,s=t.maxY,n=new ki;return n.setMinMax([e,i,0],[a,s,0]),n})),!1));if(a.removedRBushNodeAABBs=[],ki.isEmpty(o))return void(a.renderQueue=[]);var l=a.convertAABB2Rect(o),c=l.x,m=l.y,f=l.width,_=l.height,y=ht(a.vec3a,[c,m,0],a.vpMatrix),v=ht(a.vec3b,[c+f,m,0],a.vpMatrix),b=ht(a.vec3c,[c,m+_,0],a.vpMatrix),E=ht(a.vec3d,[c+f,m+_,0],a.vpMatrix),A=Math.min(y[0],v[0],E[0],b[0]),w=Math.min(y[1],v[1],E[1],b[1]),S=Math.max(y[0],v[0],E[0],b[0]),C=Math.max(y[1],v[1],E[1],b[1]),I=Math.floor(A),x=Math.floor(w),T=Math.ceil(S-A),M=Math.ceil(C-w);t.save(),a.clearRect(t,I,x,T,M,s.background),t.beginPath(),t.rect(I,x,T,M),t.clip(),t.setTransform(a.vpMatrix[0],a.vpMatrix[1],a.vpMatrix[4],a.vpMatrix[5],a.vpMatrix[12],a.vpMatrix[13]),s.renderer.getConfig().enableDirtyRectangleRenderingDebug&&h.dispatchEvent(new uo(jo.DIRTY_RECTANGLE,{dirtyRect:{x:I,y:x,width:T,height:M}})),a.searchDirtyObjects(o).sort(function(t,e){return t.sortable.renderOrder-e.sortable.renderOrder}).forEach(function(e){e&&e.isVisible()&&!e.isCulled()&&a.renderDisplayObject(e,t,a.context,a.restoreStack,i)}),t.restore(),a.renderQueue.forEach(function(t){a.saveDirtyAABB(t)}),a.renderQueue=[]}a.restoreStack.forEach(function(){t.restore()}),a.restoreStack=[]}),o.hooks.render.tap(t.tag,function(t){a.clearFullScreen||a.renderQueue.push(t)})},t.prototype.clearRect=function(t,e,i,a,s,n){t.clearRect(e,i,a,s),n&&(t.fillStyle=n,t.fillRect(e,i,a,s))},t.prototype.renderDisplayObject=function(t,e,i,a,s){var n=t.nodeName,o=a[a.length-1];!o||t.compareDocumentPosition(o)&mo.DOCUMENT_POSITION_CONTAINS||(e.restore(),a.pop());var r=this.context.styleRendererFactory[n],l=this.pathGeneratorFactory[n],c=t.parsedStyle.clipPath;if(c){this.applyWorldTransform(e,c);var d=this.pathGeneratorFactory[c.nodeName];d&&(e.save(),a.push(t),e.beginPath(),d(e,c.parsedStyle),e.closePath(),e.clip())}r&&(this.applyWorldTransform(e,t),e.save(),this.applyAttributesToContext(e,t)),l&&(e.beginPath(),l(e,t.parsedStyle),t.nodeName!==mi.LINE&&t.nodeName!==mi.PATH&&t.nodeName!==mi.POLYLINE&&e.closePath()),r&&(r.render(e,t.parsedStyle,t,i,this,s),e.restore()),t.renderable.dirty=!1},t.prototype.convertAABB2Rect=function(t){var e=t.getMin(),i=t.getMax(),a=Math.floor(e[0]),s=Math.floor(e[1]);return{x:a,y:s,width:Math.ceil(i[0])-a,height:Math.ceil(i[1])-s}},t.prototype.mergeDirtyAABBs=function(t){var e=new ki;return t.forEach(function(t){var i=t.getRenderBounds();e.add(i);var a=t.renderable.dirtyRenderBounds;a&&e.add(a)}),e},t.prototype.searchDirtyObjects=function(t){var e=u(t.getMin(),2),i=e[0],a=e[1],s=u(t.getMax(),2),n=s[0],o=s[1];return this.rBush.search({minX:i,minY:a,maxX:n,maxY:o}).map(function(t){return t.displayObject})},t.prototype.saveDirtyAABB=function(t){var e=t.renderable;e.dirtyRenderBounds||(e.dirtyRenderBounds=new ki);var i=t.getRenderBounds();i&&e.dirtyRenderBounds.update(i.center,i.halfExtents)},t.prototype.applyAttributesToContext=function(t,e){var i=e.parsedStyle,a=i.stroke,s=i.fill,n=i.opacity,o=i.lineDash,r=i.lineDashOffset;o&&t.setLineDash(o),le(r)||(t.lineDashOffset=r),le(n)||(t.globalAlpha*=n),le(a)||Array.isArray(a)||a.isNone||(t.strokeStyle=e.attributes.stroke),le(s)||Array.isArray(s)||s.isNone||(t.fillStyle=e.attributes.fill)},t.prototype.applyWorldTransform=function(t,e,i){var a=0,s=0,n=(e.parsedStyle||{}).anchor,o=n&&n[0]||0,r=n&&n[1]||0;if(0!==o||0!==r){var l=e.geometry.contentBounds;a=-o*(l&&2*l.halfExtents[0]||0),s=-r*(l&&2*l.halfExtents[1]||0)}i?(S(this.tmpMat4,e.getLocalTransform()),this.vec3a[0]=a,this.vec3a[1]=s,this.vec3a[2]=0,O(this.tmpMat4,this.tmpMat4,this.vec3a),P(this.tmpMat4,i,this.tmpMat4),P(this.tmpMat4,this.vpMatrix,this.tmpMat4)):(S(this.tmpMat4,e.getWorldTransform()),this.vec3a[0]=a,this.vec3a[1]=s,this.vec3a[2]=0,O(this.tmpMat4,this.tmpMat4,this.vec3a),P(this.tmpMat4,this.vpMatrix,this.tmpMat4)),t.setTransform(this.tmpMat4[0],this.tmpMat4[1],this.tmpMat4[4],this.tmpMat4[5],this.tmpMat4[12],this.tmpMat4[13])},t.prototype.safeMergeAABB=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=new ki;return t.forEach(function(t){i.add(t)}),i},t.tag="CanvasRenderer",t}(),oc=function(){function t(t){this.imagePool=t}return t.prototype.render=function(t,e,i,a,s,n){var o=e.fill,r=e.fillRule,l=e.opacity,c=e.fillOpacity,d=e.stroke,h=e.strokeOpacity,u=e.lineWidth,p=e.lineCap,m=e.lineJoin,f=e.shadowType,g=e.shadowColor,_=e.shadowBlur,y=e.filter,v=e.miterLimit,b=!le(o)&&!o.isNone,E=!le(d)&&!d.isNone&&u>0,A=0===o.alpha,w=!(!y||!y.length),S=!le(g)&&_>0,C=i.nodeName,I="inner"===f,x=E&&S&&(C===mi.PATH||C===mi.LINE||C===mi.POLYLINE||A||I);b&&(t.globalAlpha=l*c,x||rc(i,t,S),this.fill(t,i,o,r,a,s,n),x||this.clearShadowAndFilter(t,w,S)),E&&(t.globalAlpha=l*h,t.lineWidth=u,le(v)||(t.miterLimit=v),le(p)||(t.lineCap=p),le(m)||(t.lineJoin=m),x&&(I&&(t.globalCompositeOperation="source-atop"),rc(i,t,!0),I&&(this.stroke(t,i,d,a,s,n),t.globalCompositeOperation="source-over",this.clearShadowAndFilter(t,w,!0))),this.stroke(t,i,d,a,s,n))},t.prototype.clearShadowAndFilter=function(t,e,i){if(i&&(t.shadowColor="transparent",t.shadowBlur=0),e){var a=t.filter;!le(a)&&a.indexOf("drop-shadow")>-1&&(t.filter=a.replace(/drop-shadow\([^)]*\)/,"").trim()||"none")}},t.prototype.fill=function(t,e,i,a,s,n,o){var r=this;Array.isArray(i)?i.forEach(function(i){t.fillStyle=r.getColor(i,e,t),a?t.fill(a):t.fill()}):(Ya(i)&&(t.fillStyle=this.getPattern(i,e,t,s,n,o)),a?t.fill(a):t.fill())},t.prototype.stroke=function(t,e,i,a,s,n){var o=this;Array.isArray(i)?i.forEach(function(i){t.strokeStyle=o.getColor(i,e,t),t.stroke()}):(Ya(i)&&(t.strokeStyle=this.getPattern(i,e,t,a,s,n)),t.stroke())},t.prototype.getPattern=function(t,e,i,a,s,n){var o,r;if("rect"===t.image.nodeName){var l=t.image.parsedStyle,c=l.width,d=l.height;r=a.contextService.getDPR();var h=a.config.offscreenCanvas;(o=n.offscreenCanvasCreator.getOrCreateCanvas(h)).width=c*r,o.height=d*r;var u=n.offscreenCanvasCreator.getOrCreateContext(h),p=[];t.image.forEach(function(t){s.renderDisplayObject(t,u,a,p,n)}),p.forEach(function(){u.restore()})}return this.imagePool.getOrCreatePatternSync(t,i,o,r,function(){e.renderable.dirty=!0,a.renderingService.dirtify()})},t.prototype.getColor=function(t,e,i){var a;if(t.type===aa.LinearGradient||t.type===aa.RadialGradient){var s=e.getGeometryBounds(),n=s&&2*s.halfExtents[0]||1,o=s&&2*s.halfExtents[1]||1;a=this.imagePool.getOrCreateGradient(r(r({type:t.type},t.value),{width:n,height:o}),i)}return a},t}();function rc(t,e,i){var a=t.parsedStyle,s=a.filter,n=a.shadowColor,o=a.shadowBlur,r=a.shadowOffsetX,l=a.shadowOffsetY;s&&s.length&&(e.filter=t.style.filter),i&&(e.shadowColor=n.toString(),e.shadowBlur=o||0,e.shadowOffsetX=r||0,e.shadowOffsetY=l||0)}var lc=function(){function t(t){this.imagePool=t}return t.prototype.render=function(t,e,i){var a,s=e.width,n=e.height,o=e.img,r=e.shadowColor,l=e.shadowBlur,c=s,d=n;if(fe(o)?a=this.imagePool.getImageSync(o):(c||(c=o.width),d||(d=o.height),a=o),a){rc(i,t,!le(r)&&l>0);try{t.drawImage(a,0,0,c,d)}catch(t){}}},t}(),cc=function(){function t(){}return t.prototype.render=function(t,e,i,a,s,n){var o=e,r=o.lineWidth,l=o.textAlign,c=o.textBaseline,d=o.lineJoin,h=o.miterLimit,u=o.letterSpacing,p=o.stroke,m=o.fill,f=o.fillOpacity,g=o.strokeOpacity,_=o.opacity,y=o.metrics,v=o.dx,b=o.dy,E=o.shadowColor,A=o.shadowBlur,w=y.font,S=y.lines,C=y.height,I=y.lineHeight,x=y.lineMetrics;t.font=w,t.lineWidth=r,t.textAlign="middle"===l?"center":l;var T=c;n.enableCSSParsing||"alphabetic"!==T||(T="bottom"),t.lineJoin=d,le(h)||(t.miterLimit=h);var M=0;"middle"===c?M=-C/2-I/2:"bottom"===c||"alphabetic"===c||"ideographic"===c?M=-C:"top"!==c&&"hanging"!==c||(M=-I);var P=v||0;M+=b||0,1===S.length&&("bottom"===T?(T="middle",M-=.5*C):"top"===T&&(T="middle",M+=.5*C)),t.textBaseline=T,rc(i,t,!le(E)&&A>0);for(var O=0;O<S.length;O++){var L=r/2+P;M+=I,le(p)||p.isNone||!r||this.drawLetterSpacing(t,S[O],x[O],l,L,M,u,f,g,_,!0),le(m)||this.drawLetterSpacing(t,S[O],x[O],l,L,M,u,f,g,_)}},t.prototype.drawLetterSpacing=function(t,e,i,a,s,n,o,r,l,c,d){if(void 0===d&&(d=!1),0!==o){var h=t.textAlign;t.textAlign="left";var u=s;"center"===a||"middle"===a?u=s-i.width/2:"right"!==a&&"end"!==a||(u=s-i.width);for(var p=Array.from(e),m=t.measureText(e).width,f=0,g=0;g<p.length;++g){var _=p[g];d?this.strokeText(t,_,u,n,l):this.fillText(t,_,u,n,r,c),u+=m-(f=t.measureText(e.substring(g+1)).width)+o,m=f}t.textAlign=h}else d?this.strokeText(t,e,s,n,l):this.fillText(t,e,s,n,r,c)},t.prototype.fillText=function(t,e,i,a,s,n){var o,r=!le(s)&&1!==s;r&&(o=t.globalAlpha,t.globalAlpha=s*n),t.fillText(e,i,a),r&&(t.globalAlpha=o)},t.prototype.strokeText=function(t,e,i,a,s){var n,o=!le(s)&&1!==s;o&&(n=t.globalAlpha,t.globalAlpha=s),t.strokeText(e,i,a),o&&(t.globalAlpha=n)},t}();!function(t){o(function(){return null!==t&&t.apply(this,arguments)||this},t)}(oc),function(t){o(function(){return null!==t&&t.apply(this,arguments)||this},t)}(oc),function(t){o(function(){return null!==t&&t.apply(this,arguments)||this},t)}(oc),function(t){o(function(){return null!==t&&t.apply(this,arguments)||this},t)}(oc),function(t){o(function(){return null!==t&&t.apply(this,arguments)||this},t)}(oc),function(t){o(function(){return null!==t&&t.apply(this,arguments)||this},t)}(oc),function(t){o(function(){return null!==t&&t.apply(this,arguments)||this},t)}(oc);var dc,hc=function(t){function e(e){void 0===e&&(e={});var i=t.call(this)||this;return i.options=e,i.name="canvas-renderer",i}return o(e,t),e.prototype.init=function(){var t,e=r({dirtyObjectNumThreshold:500,dirtyObjectRatioThreshold:.8},this.options),i=this.context.imagePool,a=new oc(i),s=((t={})[mi.CIRCLE]=a,t[mi.ELLIPSE]=a,t[mi.RECT]=a,t[mi.IMAGE]=new lc(i),t[mi.TEXT]=new cc,t[mi.LINE]=a,t[mi.POLYLINE]=a,t[mi.POLYGON]=a,t[mi.PATH]=a,t[mi.GROUP]=void 0,t[mi.HTML]=void 0,t[mi.MESH]=void 0,t);this.context.defaultStyleRendererFactory=s,this.context.styleRendererFactory=s,this.addRenderingPlugin(new nc(e))},e.prototype.destroy=function(){this.removeAllRenderingPlugins(),delete this.context.defaultStyleRendererFactory,delete this.context.styleRendererFactory},e}(_i),uc=function(){function t(){}return t.prototype.apply=function(e,i){var a=this,s=e.renderingService,n=e.renderingContext,o=e.config;this.context=e;var r=n.root.ownerDocument.defaultView,l=function(t){s.hooks.pointerMove.call(t)},c=function(t){s.hooks.pointerUp.call(t)},d=function(t){s.hooks.pointerDown.call(t)},h=function(t){s.hooks.pointerOver.call(t)},u=function(t){s.hooks.pointerOut.call(t)},p=function(t){s.hooks.pointerCancel.call(t)},m=function(t){s.hooks.pointerWheel.call(t)},f=function(t){s.hooks.click.call(t)};s.hooks.init.tap(t.tag,function(){var t=a.context.contextService.getDomElement();i.globalThis.navigator.msPointerEnabled?(t.style.msContentZooming="none",t.style.msTouchAction="none"):r.supportsPointerEvents&&(t.style.touchAction="none"),r.supportsPointerEvents?function(t){i.globalThis.document.addEventListener("pointermove",l,!0),t.addEventListener("pointerdown",d,!0),t.addEventListener("pointerleave",u,!0),t.addEventListener("pointerover",h,!0),i.globalThis.addEventListener("pointerup",c,!0),i.globalThis.addEventListener("pointercancel",p,!0)}(t):function(t){i.globalThis.document.addEventListener("mousemove",l,!0),t.addEventListener("mousedown",d,!0),t.addEventListener("mouseout",u,!0),t.addEventListener("mouseover",h,!0),i.globalThis.addEventListener("mouseup",c,!0)}(t),r.supportsTouchEvents&&function(t){t.addEventListener("touchstart",d,!0),t.addEventListener("touchend",c,!0),t.addEventListener("touchmove",l,!0),t.addEventListener("touchcancel",p,!0)}(t),o.useNativeClickEvent&&t.addEventListener("click",f,!0),t.addEventListener("wheel",m,{passive:!0,capture:!0})}),s.hooks.destroy.tap(t.tag,function(){var t=a.context.contextService.getDomElement();i.globalThis.navigator.msPointerEnabled?(t.style.msContentZooming="",t.style.msTouchAction=""):r.supportsPointerEvents&&(t.style.touchAction=""),r.supportsPointerEvents?function(t){i.globalThis.document.removeEventListener("pointermove",l,!0),t.removeEventListener("pointerdown",d,!0),t.removeEventListener("pointerleave",u,!0),t.removeEventListener("pointerover",h,!0),i.globalThis.removeEventListener("pointerup",c,!0)}(t):function(t){i.globalThis.document.removeEventListener("mousemove",l,!0),t.removeEventListener("mousedown",d,!0),t.removeEventListener("mouseout",u,!0),t.removeEventListener("mouseover",h,!0),i.globalThis.removeEventListener("mouseup",c,!0)}(t),r.supportsTouchEvents&&function(t){t.removeEventListener("touchstart",d,!0),t.removeEventListener("touchend",c,!0),t.removeEventListener("touchmove",l,!0),t.removeEventListener("touchcancel",p,!0)}(t),o.useNativeClickEvent&&t.removeEventListener("click",f,!0),t.removeEventListener("wheel",m,!0)})},t.tag="DOMInteraction",t}(),pc=function(t){function e(){var e=t.apply(this,p([],u(arguments),!1))||this;return e.name="dom-interaction",e}return o(e,t),e.prototype.init=function(){this.addRenderingPlugin(new uc)},e.prototype.destroy=function(){this.removeAllRenderingPlugins()},e}(_i),mc=function(){function t(){this.displayObjectHTMLElementMap=new WeakMap}return t.prototype.joinTransformMatrix=function(t){return"matrix(".concat([t[0],t[1],t[4],t[5],t[12],t[13]].join(","),")")},t.prototype.apply=function(e,i){var a=this,s=e.camera,n=e.renderingContext,o=e.renderingService;this.context=e;var r=n.root.ownerDocument.defaultView,l=r.context.eventService.nativeHTMLMap,c=function(t,e){e.style.transform=a.joinTransformMatrix(t.getWorldTransform())},d=function(t){var e=t.target;if(e.nodeName===mi.HTML){a.$camera||(a.$camera=a.createCamera(s));var n=a.getOrCreateEl(e);if(a.$camera.appendChild(n),i.enableCSSParsing){var o=e.ownerDocument.documentElement.attributes;Object.keys(o).forEach(function(t){n.style[t]=o[t]})}Object.keys(e.attributes).forEach(function(t){a.updateAttribute(t,e)}),c(e,n),l.set(n,e)}},h=function(t){var e=t.target;if(e.nodeName===mi.HTML&&a.$camera){var i=a.getOrCreateEl(e);i&&(i.remove(),l.delete(i))}},u=function(t){var e=t.target;if(e.nodeName===mi.HTML){var i=t.attrName;a.updateAttribute(i,e)}},p=function(t){var e=t.target;if(e.nodeName===mi.HTML){var i=a.getOrCreateEl(e);c(e,i)}},m=function(){if(a.$camera){var t=a.context.config,e=t.width,i=t.height;a.$camera.style.width="".concat(e||0,"px"),a.$camera.style.height="".concat(i||0,"px")}};o.hooks.init.tap(t.tag,function(){r.addEventListener(jo.RESIZE,m),r.addEventListener(_o.MOUNTED,d),r.addEventListener(_o.UNMOUNTED,h),r.addEventListener(_o.ATTR_MODIFIED,u),r.addEventListener(_o.BOUNDS_CHANGED,p)}),o.hooks.endFrame.tap(t.tag,function(){a.$camera&&n.renderReasons.has(oo.CAMERA_CHANGED)&&(a.$camera.style.transform=a.joinTransformMatrix(s.getOrthoMatrix()))}),o.hooks.destroy.tap(t.tag,function(){a.$camera&&a.$camera.remove(),r.removeEventListener(jo.RESIZE,m),r.removeEventListener(_o.MOUNTED,d),r.removeEventListener(_o.UNMOUNTED,h),r.removeEventListener(_o.ATTR_MODIFIED,u),r.removeEventListener(_o.BOUNDS_CHANGED,p)})},t.prototype.createCamera=function(t){var e=this.context.config,i=e.document,a=e.width,s=e.height,n=this.context.contextService.getDomElement(),o=n.parentNode;if(o){var r="g-canvas-camera",l=o.querySelector("#"+r);if(!l){var c=(i||document).createElement("div");l=c,c.id=r,c.style.position="absolute",c.style.left="".concat(n.offsetLeft||0,"px"),c.style.top="".concat(n.offsetTop||0,"px"),c.style.transformOrigin="left top",c.style.transform=this.joinTransformMatrix(t.getOrthoMatrix()),c.style.overflow="hidden",c.style.pointerEvents="none",c.style.width="".concat(a||0,"px"),c.style.height="".concat(s||0,"px"),o.appendChild(c)}return l}return null},t.prototype.getOrCreateEl=function(t){var e=this.context.config.document,i=this.displayObjectHTMLElementMap.get(t);return i||(i=(e||document).createElement("div"),t.parsedStyle.$el=i,this.displayObjectHTMLElementMap.set(t,i),t.id&&(i.id=t.id),t.name&&i.setAttribute("name",t.name),t.className&&(i.className=t.className),i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style["will-change"]="transform",i.style.transform=this.joinTransformMatrix(t.getWorldTransform())),i},t.prototype.updateAttribute=function(t,e){var i=this.getOrCreateEl(e);switch(t){case"innerHTML":var a=e.parsedStyle.innerHTML;fe(a)?i.innerHTML=a:(i.innerHTML="",i.appendChild(a));break;case"transformOrigin":var s=e.parsedStyle.transformOrigin;i.style["transform-origin"]="".concat(s[0].value," ").concat(s[1].value);break;case"width":if(this.context.enableCSSParsing){var n=e.computedStyleMap().get("width");i.style.width=n.toString()}else n=e.parsedStyle.width,i.style.width=_e(n)?"".concat(n,"px"):n.toString();break;case"height":if(this.context.enableCSSParsing){var o=e.computedStyleMap().get("height");i.style.height=o.toString()}else o=e.parsedStyle.height,i.style.height=_e(o)?"".concat(o,"px"):o.toString();break;case"zIndex":var r=e.parsedStyle.zIndex;i.style["z-index"]="".concat(r);break;case"visibility":var l=e.parsedStyle.visibility;i.style.visibility=l;break;case"pointerEvents":var c=e.parsedStyle.pointerEvents;i.style.pointerEvents=c;break;case"opacity":var d=e.parsedStyle.opacity;i.style.opacity="".concat(d);break;case"fill":var h=e.parsedStyle.fill,u="";za(h)?u=h.isNone?"transparent":e.getAttribute("fill"):Array.isArray(h)?u=e.getAttribute("fill"):Ya(h),i.style.background=u;break;case"stroke":var p=e.parsedStyle.stroke,m="";za(p)?m=p.isNone?"transparent":e.getAttribute("stroke"):Array.isArray(p)?m=e.getAttribute("stroke"):Ya(p),i.style["border-color"]=m,i.style["border-style"]="solid";break;case"lineWidth":var f=e.parsedStyle.lineWidth;i.style["border-width"]="".concat(f||0,"px");break;case"lineDash":i.style["border-style"]="dashed";break;case"filter":var g=e.style.filter;i.style.filter=g;break;default:"x"!==t&&"y"!==t&&(le(e.style[t])||""===e.style[t]||(i.style[t]=e.style[t]))}},t.tag="HTMLRendering",t}(),fc=function(t){function e(){var e=t.apply(this,p([],u(arguments),!1))||this;return e.name="html-renderer",e}return o(e,t),e.prototype.init=function(){this.addRenderingPlugin(new mc)},e.prototype.destroy=function(){this.removeAllRenderingPlugins()},e}(_i),gc=function(){function t(t){this.canvasConfig=t,this.imageCache={},this.gradientCache={},this.patternCache={}}return t.prototype.getImageSync=function(t,e){return this.imageCache[t]?e&&e(this.imageCache[t]):this.getOrCreateImage(t).then(function(t){e&&e(t)}),this.imageCache[t]},t.prototype.getOrCreateImage=function(t){var e=this;if(this.imageCache[t])return Promise.resolve(this.imageCache[t]);var i=this.canvasConfig.createImage;return new Promise(function(a,s){var n;i?n=i(t):Cn&&(n=new window.Image),n&&(n.onload=function(){e.imageCache[t]=n,a(n)},n.onerror=function(t){s(t)},n.crossOrigin="Anonymous",n.src=t)})},t.prototype.getOrCreatePatternSync=function(t,e,i,a,s){var n=this.generatePatternKey(t);if(n&&this.patternCache[n])return this.patternCache[n];var o,r=t.image,l=t.repetition,c=t.transform,d=!1;fe(r)?o=this.getImageSync(r,s):i?(o=i,d=!0):o=r;var h=o&&e.createPattern(o,l);if(h){var u;u=c?un(ks(c),new Ko({})):I(A()),d&&L(u,u,[1/a,1/a,1]),h.setTransform({a:u[0],b:u[1],c:u[4],d:u[5],e:u[12],f:u[13]})}return n&&h&&(this.patternCache[n]=h),h},t.prototype.getOrCreateGradient=function(t,e){var i=this.generateGradientKey(t),a=t.type,s=t.steps,n=t.width,o=t.height,r=t.angle,l=t.cx,c=t.cy,d=t.size;if(this.gradientCache[i])return this.gradientCache[i];var h=null;if(a===aa.LinearGradient){var u=function(t,e,i){var a=Ci(i.value),s=0+t/2,n=0+e/2,o=Math.abs(t*Math.cos(a))+Math.abs(e*Math.sin(a));return{x1:s-Math.cos(a)*o/2,y1:n-Math.sin(a)*o/2,x2:s+Math.cos(a)*o/2,y2:n+Math.sin(a)*o/2}}(n,o,r),p=u.x1,m=u.y1,f=u.x2,g=u.y2;h=e.createLinearGradient(p,m,f,g)}else if(a===aa.RadialGradient){var _=function(t,e,i,a,s){var n=i.value,o=a.value;i.unit===Vi.kPercentage&&(n=i.value/100*t),a.unit===Vi.kPercentage&&(o=a.value/100*e);var r=Math.max(Kt([0,0],[n,o]),Kt([0,e],[n,o]),Kt([t,e],[n,o]),Kt([t,0],[n,o]));return s&&(s instanceof ga?r=s.value:s instanceof ca&&("closest-side"===s.value?r=Math.min(n,t-n,o,e-o):"farthest-side"===s.value?r=Math.max(n,t-n,o,e-o):"closest-corner"===s.value&&(r=Math.min(Kt([0,0],[n,o]),Kt([0,e],[n,o]),Kt([t,e],[n,o]),Kt([t,0],[n,o]))))),{x:n,y:o,r:r}}(n,o,l,c,d),y=_.x,v=_.y,b=_.r;h=e.createRadialGradient(y,v,0,y,v,b)}return h&&(s.forEach(function(t){var e=t.offset,i=t.color;e.unit===Vi.kPercentage&&(null==h||h.addColorStop(e.value/100,i.toString()))}),this.gradientCache[i]=h),this.gradientCache[i]},t.prototype.generateGradientKey=function(t){var e=t.type,i=t.width,a=t.height,s=t.steps,n=t.angle,o=t.cx,r=t.cy,l=t.size;return"gradient-".concat(e,"-").concat((null==n?void 0:n.toString())||0,"-").concat((null==o?void 0:o.toString())||0,"-").concat((null==r?void 0:r.toString())||0,"-").concat((null==l?void 0:l.toString())||0,"-").concat(i,"-").concat(a,"-").concat(s.map(function(t){var e=t.offset,i=t.color;return"".concat(e).concat(i)}).join("-"))},t.prototype.generatePatternKey=function(t){var e=t.image,i=t.repetition;return fe(e)?"pattern-".concat(e,"-").concat(i):"rect"===e.nodeName?"pattern-".concat(e.entity,"-").concat(i):void 0},t}(),_c=function(){function t(){}return t.prototype.apply=function(e){var i=e.renderingService,a=e.renderingContext,s=e.imagePool,n=a.root.ownerDocument.defaultView,o=function(t,e,i){var a=t.parsedStyle,s=a.width,n=a.height;s&&!n?t.setAttribute("height",i/e*s):!s&&n&&t.setAttribute("width",e/i*n)},r=function(t){var e=t.target,a=e.nodeName,n=e.attributes;if(a===mi.IMAGE){var r=n.img,l=n.keepAspectRatio;fe(r)&&s.getImageSync(r,function(t){var a=t.width,s=t.height;l&&o(e,a,s),e.renderable.dirty=!0,i.dirtify()})}},l=function(t){var e=t.target,a=t.attrName,n=t.newValue;e.nodeName===mi.IMAGE&&"img"===a&&fe(n)&&s.getOrCreateImage(n).then(function(t){var a=t.width,s=t.height;e.attributes.keepAspectRatio&&o(e,a,s),e.renderable.dirty=!0,i.dirtify()})};i.hooks.init.tap(t.tag,function(){n.addEventListener(_o.MOUNTED,r),n.addEventListener(_o.ATTR_MODIFIED,l)}),i.hooks.destroy.tap(t.tag,function(){n.removeEventListener(_o.MOUNTED,r),n.removeEventListener(_o.ATTR_MODIFIED,l)})},t.tag="LoadImage",t}(),yc=function(t){function e(){var e=t.apply(this,p([],u(arguments),!1))||this;return e.name="image-loader",e}return o(e,t),e.prototype.init=function(){this.context.imagePool=new gc(this.context.config),this.addRenderingPlugin(new _c)},e.prototype.destroy=function(){this.removeAllRenderingPlugins()},e}(_i),vc=function(){function t(t){this.renderingContext=t.renderingContext,this.canvasConfig=t.config}return t.prototype.init=function(){var t=this.canvasConfig,e=t.container,i=t.canvas;if(i)this.$canvas=i,e&&i.parentElement!==e&&e.appendChild(i),this.$container=i.parentElement,this.canvasConfig.container=this.$container;else if(e&&(this.$container=fe(e)?document.getElementById(e):e,this.$container)){var a=document.createElement("canvas");this.$container.appendChild(a),this.$container.style.position||(this.$container.style.position="relative"),this.$canvas=a}this.context=this.$canvas.getContext("2d"),this.resize(this.canvasConfig.width,this.canvasConfig.height)},t.prototype.getContext=function(){return this.context},t.prototype.getDomElement=function(){return this.$canvas},t.prototype.getDPR=function(){return this.dpr},t.prototype.getBoundingClientRect=function(){if(this.$canvas.getBoundingClientRect)return this.$canvas.getBoundingClientRect()},t.prototype.destroy=function(){this.$container&&this.$canvas&&this.$canvas.parentNode&&this.$container.removeChild(this.$canvas)},t.prototype.resize=function(t,e){var i=this.canvasConfig.devicePixelRatio||Cn&&window.devicePixelRatio||1;i=i>=1?Math.ceil(i):1,this.dpr=i,this.$canvas&&(this.$canvas.width=this.dpr*t,this.$canvas.height=this.dpr*e,function(t,e,i){Cn&&t.style&&(t.style.width=e+"px",t.style.height=i+"px")}(this.$canvas,t,e)),this.renderingContext.renderReasons.add(oo.CAMERA_CHANGED)},t.prototype.applyCursorStyle=function(t){this.$container&&this.$container.style&&(this.$container.style.cursor=t)},t.prototype.toDataURL=function(t){return void 0===t&&(t={}),c(this,void 0,void 0,function(){var e,i;return d(this,function(a){return e=t.type,i=t.encoderOptions,[2,this.context.canvas.toDataURL(e,i)]})})},t}(),bc=function(t){function e(){var e=t.apply(this,p([],u(arguments),!1))||this;return e.name="canvas-context-register",e}return o(e,t),e.prototype.init=function(){this.context.ContextService=vc},e.prototype.destroy=function(){delete this.context.ContextService},e}(_i),Ec=function(t){function e(e){var i=t.call(this,e)||this;return i.registerPlugin(new bc),i.registerPlugin(new yc),i.registerPlugin(new Nl),i.registerPlugin(new hc),i.registerPlugin(new pc),i.registerPlugin(new sc),i.registerPlugin(new fc),i}return o(e,t),e}(yi),Ac={exports:{}};dc=Ac,function(t,e){if(t){for(var i,a={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},s={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},n={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},o={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},r=1;r<20;++r)a[111+r]="f"+r;for(r=0;r<=9;++r)a[r+96]=r.toString();m.prototype.bind=function(t,e,i){var a=this;return t=t instanceof Array?t:[t],a._bindMultiple.call(a,t,e,i),a},m.prototype.unbind=function(t,e){return this.bind.call(this,t,function(){},e)},m.prototype.trigger=function(t,e){var i=this;return i._directMap[t+":"+e]&&i._directMap[t+":"+e]({},t),i},m.prototype.reset=function(){var t=this;return t._callbacks={},t._directMap={},t},m.prototype.stopCallback=function(t,e){if((" "+e.className+" ").indexOf(" mousetrap ")>-1)return!1;if(p(e,this.target))return!1;if("composedPath"in t&&"function"==typeof t.composedPath){var i=t.composedPath()[0];i!==t.target&&(e=i)}return"INPUT"==e.tagName||"SELECT"==e.tagName||"TEXTAREA"==e.tagName||e.isContentEditable},m.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},m.addKeycodes=function(t){for(var e in t)t.hasOwnProperty(e)&&(a[e]=t[e]);i=null},m.init=function(){var t=m(e);for(var i in t)"_"!==i.charAt(0)&&(m[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i))},m.init(),t.Mousetrap=m,dc.exports&&(dc.exports=m)}function l(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)}function c(t){if("keypress"==t.type){var e=String.fromCharCode(t.which);return t.shiftKey||(e=e.toLowerCase()),e}return a[t.which]?a[t.which]:s[t.which]?s[t.which]:String.fromCharCode(t.which).toLowerCase()}function d(t){return"shift"==t||"ctrl"==t||"alt"==t||"meta"==t}function h(t,e,s){return s||(s=function(){if(!i)for(var t in i={},a)t>95&&t<112||a.hasOwnProperty(t)&&(i[a[t]]=t);return i}()[t]?"keydown":"keypress"),"keypress"==s&&e.length&&(s="keydown"),s}function u(t,e){var i,a,s,r=[];for(i=function(t){return"+"===t?["+"]:(t=t.replace(/\+{2}/g,"+plus")).split("+")}(t),s=0;s<i.length;++s)a=i[s],o[a]&&(a=o[a]),e&&"keypress"!=e&&n[a]&&(a=n[a],r.push("shift")),d(a)&&r.push(a);return{key:a,modifiers:r,action:e=h(a,r,e)}}function p(t,i){return null!==t&&t!==e&&(t===i||p(t.parentNode,i))}function m(t){var i=this;if(t=t||e,!(i instanceof m))return new m(t);i.target=t,i._callbacks={},i._directMap={};var a,s={},n=!1,o=!1,r=!1;function h(t){t=t||{};var e,i=!1;for(e in s)t[e]?i=!0:s[e]=0;i||(r=!1)}function p(t,e,a,n,o,r){var l,c,h,u,p=[],m=a.type;if(!i._callbacks[t])return[];for("keyup"==m&&d(t)&&(e=[t]),l=0;l<i._callbacks[t].length;++l)if(c=i._callbacks[t][l],(n||!c.seq||s[c.seq]==c.level)&&m==c.action&&("keypress"==m&&!a.metaKey&&!a.ctrlKey||(h=e,u=c.modifiers,h.sort().join(",")===u.sort().join(",")))){var f=!n&&c.combo==o,g=n&&c.seq==n&&c.level==r;(f||g)&&i._callbacks[t].splice(l,1),p.push(c)}return p}function f(t,e,a,s){i.stopCallback(e,e.target||e.srcElement,a,s)||!1===t(e,a)&&(function(t){t.preventDefault?t.preventDefault():t.returnValue=!1}(e),function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}(e))}function g(t){"number"!=typeof t.which&&(t.which=t.keyCode);var e=c(t);e&&("keyup"!=t.type||n!==e?i.handleKey(e,function(t){var e=[];return t.shiftKey&&e.push("shift"),t.altKey&&e.push("alt"),t.ctrlKey&&e.push("ctrl"),t.metaKey&&e.push("meta"),e}(t),t):n=!1)}function _(t,e,i,o){function l(e){return function(){r=e,++s[t],clearTimeout(a),a=setTimeout(h,1e3)}}function d(e){f(i,e,t),"keyup"!==o&&(n=c(e)),setTimeout(h,10)}s[t]=0;for(var p=0;p<e.length;++p){var m=p+1===e.length?d:l(o||u(e[p+1]).action);y(e[p],m,o,t,p)}}function y(t,e,a,s,n){i._directMap[t+":"+a]=e;var o,r=(t=t.replace(/\s+/g," ")).split(" ");r.length>1?_(t,r,e,a):(o=u(t,a),i._callbacks[o.key]=i._callbacks[o.key]||[],p(o.key,o.modifiers,{type:o.action},s,t,n),i._callbacks[o.key][s?"unshift":"push"]({callback:e,modifiers:o.modifiers,action:o.action,seq:s,level:n,combo:t}))}i._handleKey=function(t,e,i){var a,s=p(t,e,i),n={},l=0,c=!1;for(a=0;a<s.length;++a)s[a].seq&&(l=Math.max(l,s[a].level));for(a=0;a<s.length;++a)if(s[a].seq){if(s[a].level!=l)continue;c=!0,n[s[a].seq]=1,f(s[a].callback,i,s[a].combo,s[a].seq)}else c||f(s[a].callback,i,s[a].combo);var u="keypress"==i.type&&o;i.type!=r||d(t)||u||h(n),o=c&&"keydown"==i.type},i._bindMultiple=function(t,e,i){for(var a=0;a<t.length;++a)y(t[a],e,i)},l(t,"keypress",g),l(t,"keydown",g),l(t,"keyup",g)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null);var wc=g(Ac.exports);const Sc=10,Cc=1e4,Ic=1e3,xc=.05,Tc={NORMAL:"#F47A88",CHARGE:"#54DEC7",DOCK:"#F4CA7A",WORK:"#F47A88",WAREROOM:"#ff8c00",AVOID:"#D0C2A4",RACK:"#FFD700",USER_DEFINE:"#9933CC",ENTER_POINT:"#0099FF",EXIT_POINT:"#F47A88",CHECK_POINT:"#FA8072"},Mc={NORMAL:"#54DEC7"},Pc={FORWARD:"#539CFF",UN_FORWARD:"#F47A88",FREE:"#009966",LOAD:"#CC3399",EDGE_POLE_NORMAL:"#53F2FF",EDGE_POLE_SELECTED:"#F47A88",ASSIST_LINE:"#5A5D74"},Oc={NORMAL:"#00CC00"},Lc={NORMAL:"#50616d",FORBID_ENTRY:"#F0B3BA",DECELERATE:"#D0C2A4",DISABLE_OBA:"#B8EAE8",DISABLE_ROTATE:"#F2C8B1",DISABLE_REROUTE:"#F7BBE5",LIMIT_CAR_NUMBER:"#FFBB83",ONEWAY_TRAFFIC:"#C0ACF7",LOCAL_REPLAN:"#7FCEC7",USER_DEFINE:"#C6B5A7",CLEAN_AREA_NORMAL:"#F0F1F5",CLEAN_AREA_DRAWING:"#BFEFFF",TEXT:"#177cb0"},Rc={LIMIT_JUMP:"#808001",LIMIT_MAP_UPDATE:"#0e0eff",LONG_CORRIDOR:"#fea21a",CRASH_BARRIER:"#ffff00",ERASE:"#fe1f1f",MOVING_OBJECT:"#36909b",ODOM:"#902190",QRCODE:"#737329"},Dc={NORMAL:"#a5d0e2",STATION_CORRECTION:"#6666ff",FUSE_LOCATE:"#D358F7",TEXTURE_LOCATE:"#b39ddc",DAMAGED:"#c37e00",AXIS_X:"#999999",AXIS_Y:"#999999"},Nc={NORMAL:"#F47A88",RUNTIME:"#827100"},kc={NORMAL:"#827100",MATCHED:"#53F2FF",UN_MATCHED:"#F47A88"},Fc={ITEM_HOVER:"#53F2FF",ITEM_SELECTED:"#53F2FF",ITEM_ERROR:"#3d3b4f",SELECT_AREA_STROKE:"#539CFF",MANUAL_CONTROL_TO_LOCATE:"#F47A88",NAVIGATE_TO_POINT:"#f00",CALC_DISTANCE:"#F47A88",AVOID_RECTANGLE_NORMAL:"#54DEC7",MAP_IMAGE_BACKGROUND:"#F0F1F5",LOCUS:"#FF7300",NAV_PATH:"#C934DD",AXIS_X:"blue",AXIS_Y:"red",ASSIST_GRID:"#CED0D8",ASSIST_LINE:"#808080",LASER_FRONT:"#70f3ff",LASER_BACK:"#FFFF00",LASER_EXT_POINT:"#ffd600",LASER_OBA_POINT_NORMAL:"#d50000"},$c={DEFAULT_STROKE_WIDTH:2,GRID_STROKE_WIDTH:1,GRID_CELL_UNIT:200,BEZIER_CONTROL_POINT_MIN_OFFSET:10,POLE_WIDTH_EDGE:20,MOVE_ITEM_DISTANCE:1},qc={NORMAL:0,LOCATE_MOVE:1200,CALCULATE_DISTANCE:1100,ROBOT_ICON:1e3,STATION:900,NAV_PATH:850,EDGE:800,NODE:700,TAG:600,DMCODE:500,LMK:500,FEATURE:400,FUNC_AREA:300,NOTE_AREA:260,LOCATION_AREA:270,BUILDING_AREA:200,ROBOT_BACKGROUND_IMG:-1e3,CLEAN_AREA:-900,GRID:-800,LASER:-700,NETWORK_MONITOR:-650,LOCUS:-600,AVOID_POLYGON:-500},Gc={RADIUS:8};var Bc,jc,Uc,Yc,zc,Vc,Wc,Hc,Kc,Qc,Xc,Jc,Zc,td,ed,id,ad,sd,nd,od,rd,ld;!function(t){t[t.NORMAL=0]="NORMAL",t[t.PAN=1]="PAN",t[t.CONTEXTMENU=2]="CONTEXTMENU",t[t.CALCULATE_DISTANCE=11]="CALCULATE_DISTANCE",t[t.MANUAL_LOCATE=12]="MANUAL_LOCATE",t[t.MOVE_POSE=13]="MOVE_POSE",t[t.LINE=21]="LINE",t[t.STRETCH=22]="STRETCH",t[t.BEZIER=24]="BEZIER",t[t.ROUND_CORNER=25]="ROUND_CORNER",t[t.STATION=31]="STATION",t[t.STATION_FEATURE_BINDING=32]="STATION_FEATURE_BINDING",t[t.DMCODE=33]="DMCODE",t[t.NODE=34]="NODE",t[t.TAG=35]="TAG",t[t.FUNC_AREA=36]="FUNC_AREA",t[t.CLEAN_AREA=41]="CLEAN_AREA",t[t.UNCLEAN_AREA=42]="UNCLEAN_AREA",t[t.NOTE_AREA=49]="NOTE_AREA",t[t.LOCATION_AREA=50]="LOCATION_AREA",t[t.SELECTION=61]="SELECTION",t[t.MOVE_ITEMS=62]="MOVE_ITEMS",t[t.EDGE_POLE=63]="EDGE_POLE",t[t.RESIZE_ITEMS=65]="RESIZE_ITEMS"}(Bc||(Bc={})),function(t){t[t.NONE=0]="NONE",t[t.NODE=1]="NODE",t[t.STATION=2]="STATION",t[t.EDGE=3]="EDGE",t[t.FUNC_AREA=6]="FUNC_AREA",t[t.CLEAN_AREA=12]="CLEAN_AREA",t[t.TAG=13]="TAG",t[t.DMCODE=14]="DMCODE",t[t.DISTANCE=15]="DISTANCE",t[t.LMK=16]="LMK",t[t.EDGE_GROUP=17]="EDGE_GROUP",t[t.FEATURE=18]="FEATURE",t[t.STATION_FEATURE_BIND=19]="STATION_FEATURE_BIND",t[t.WAREROOM_AREA=21]="WAREROOM_AREA",t[t.WAREROOM_REGION=22]="WAREROOM_REGION",t[t.REDRAW_AREA=23]="REDRAW_AREA",t[t.NOTE_AREA=24]="NOTE_AREA",t[t.LOCATION_AREA=25]="LOCATION_AREA",t[t.EDGE_POLE=61]="EDGE_POLE",t[t.SELECTION_AREA=71]="SELECTION_AREA"}(jc||(jc={})),function(t){t[t.NORMAL=1]="NORMAL",t[t.CHARGE=2]="CHARGE",t[t.DOCK=3]="DOCK",t[t.WORK=4]="WORK",t[t.WAREROOM=5]="WAREROOM",t[t.AVOID=6]="AVOID",t[t.RACK=7]="RACK",t[t.USER_DEFINE=255]="USER_DEFINE"}(Uc||(Uc={})),function(t){t[t.LINE=1]="LINE",t[t.BEZIER=3]="BEZIER"}(Yc||(Yc={})),function(t){t[t.NONE=0]="NONE",t[t.START=1]="START",t[t.END=2]="END",t[t.C=3]="C",t[t.D=4]="D"}(zc||(zc={})),function(t){t[t.NONE=0]="NONE",t[t.BEFORE=1]="BEFORE",t[t.START=2]="START",t[t.ING=3]="ING",t[t.END=4]="END",t[t.AFTER=5]="AFTER"}(Vc||(Vc={})),function(t){t[t.NONE=0]="NONE",t[t.ADD=10]="ADD",t[t.DELETE=20]="DELETE",t[t.UPDATE=30]="UPDATE",t[t.CLEAN=40]="CLEAN"}(Wc||(Wc={})),function(t){t[t.NONE=0]="NONE",t[t.STATION_CORRECTION=1]="STATION_CORRECTION",t[t.FUSE_LOCATE=2]="FUSE_LOCATE",t[t.TEXTURE_LOCATE=3]="TEXTURE_LOCATE"}(Hc||(Hc={})),function(t){t[t.FORBID_ENTRY=300]="FORBID_ENTRY",t[t.LIMIT_SPEEDS=310]="LIMIT_SPEEDS",t[t.SPEED_LEVEL_20=312]="SPEED_LEVEL_20",t[t.SPEED_LEVEL_40=314]="SPEED_LEVEL_40",t[t.SPEED_LEVEL_60=316]="SPEED_LEVEL_60",t[t.SPEED_LEVEL_80=318]="SPEED_LEVEL_80",t[t.DISABLE_OBA=350]="DISABLE_OBA",t[t.DISABLE_ROTATE=352]="DISABLE_ROTATE",t[t.DISABLE_REROUTE=354]="DISABLE_REROUTE",t[t.LIMIT_CAR_NUMBER=356]="LIMIT_CAR_NUMBER",t[t.DISABLE_RACK_AUTO_CORRECT=357]="DISABLE_RACK_AUTO_CORRECT",t[t.ONEWAY_TRAFFIC=360]="ONEWAY_TRAFFIC",t[t.LOCAL_REPLAN=362]="LOCAL_REPLAN",t[t.WORKSPACE_OBA=365]="WORKSPACE_OBA",t[t.LANE_LINE_AUXILIARY_LOCATE=367]="LANE_LINE_AUXILIARY_LOCATE",t[t.IO_OBA=373]="IO_OBA",t[t.LIGHT_CTRL=374]="LIGHT_CTRL",t[t.LIMIT_STOP=375]="LIMIT_STOP",t[t.LIGHT_DIRECT=391]="LIGHT_DIRECT",t[t.HIGH_REFLECTIVE=392]="HIGH_REFLECTIVE",t[t.DUST=393]="DUST",t[t.UNEVEN_GROUND=394]="UNEVEN_GROUND",t[t.RIDGE=395]="RIDGE",t[t.UPHILL=396]="UPHILL",t[t.DOWNHILL=397]="DOWNHILL",t[t.CAMERA_CONTROL=400]="CAMERA_CONTROL",t[t.USER_DEFINE=500]="USER_DEFINE"}(Kc||(Kc={})),function(t){t[t.FORWARD=1]="FORWARD",t[t.BACKWARD=2]="BACKWARD",t[t.LEFT=3]="LEFT",t[t.RIGHT=4]="RIGHT"}(Qc||(Qc={})),function(t){t[t.ALL=255]="ALL",t[t.FREE=1]="FREE",t[t.LOAD=2]="LOAD"}(Xc||(Xc={})),function(t){t[t.Normal=0]="Normal",t[t.DMCode=1]="DMCode"}(Jc||(Jc={})),function(t){t[t.Normal=0]="Normal",t[t.BeforeEnter=1]="BeforeEnter"}(Zc||(Zc={})),function(t){t[t.Normal=0]="Normal",t[t.Unload=1]="Unload",t[t.Load=2]="Load"}(td||(td={})),function(t){t.NONE="",t.LMK="FEATURE_LMK",t.TRI="FEATURE_TRI",t.CORNER="FEATURE_CORNER",t.ARTICORNER="FEATURE_ARTICORNER"}(ed||(ed={})),function(t){t[t.NONE=0]="NONE",t[t.DM=1]="DM",t[t.FM=2]="FM",t[t.OUTLINE=3]="OUTLINE",t[t.LMK=4]="LMK"}(id||(id={})),function(t){t[t.LIMIT_JUMP=1]="LIMIT_JUMP",t[t.LIMIT_MAP_UPDATE=2]="LIMIT_MAP_UPDATE",t[t.LONG_CORRIDOR=3]="LONG_CORRIDOR",t[t.CRASH_BARRIER=4]="CRASH_BARRIER",t[t.ERASE=5]="ERASE",t[t.MOVING_OBJECT=6]="MOVING_OBJECT",t[t.ODOM=7]="ODOM",t[t.QRCODE=8]="QRCODE"}(ad||(ad={})),function(t){t[t.NONE=0]="NONE",t[t.TYPE_FLAT=1]="TYPE_FLAT",t[t.TYPE_CYLINDER=2]="TYPE_CYLINDER"}(sd||(sd={})),function(t){t.STATION="station-map",t.TAG="tag-map",t.NODE="node-map",t.EDGE="edge-map",t.FUNC_AREA="func-area-map",t.BUILDING_AREA="building-area-map",t.NOTE_AREA="note-area-map",t.LOCATION_AREA="location-area-map",t.SELECTION_AREA="selection-area-map",t.CLEAN_AREA="clean_area-map",t.DMCODE="dmcode-map",t.FEATURE_NORMAL="feature-map",t.FEATURE_RUNTIME="feature-runtime-map",t.LMK_NORMAL="lmk-map",t.LMK_RUNTIME="lmk-runtime-map",t.CALCULATE_DISTANCE="calculate-distance-map",t.BACKGROUND_IMG="background-img-map",t.LOCATE_MOVE="locate-move-map",t.NAV_PATH="nav-path-map",t.ROBOT_ICON="robot-icon-map",t.LASER="laser-map",t.LOCUS="locus-map",t.AVOID_POLYGON="avoid-polygon-map",t.GRID="grid-map",t.AXIS_CENTER="axis-center-map"}(nd||(nd={})),function(t){t.SINGLE_TAP="singletap",t.DOUBLE_TAP="doubletap",t.PRESS="press"}(od||(od={})),function(t){t.INTERSECT="intersect",t.MINUS="minus",t.COMPLEMENT="complement",t.UNION="union"}(rd||(rd={})),function(t){t[t.NONE=1e3]="NONE",t[t.INFO=0]="INFO",t[t.WARNING=1]="WARNING",t[t.ERROR=2]="ERROR"}(ld||(ld={}));function cd(t){return t instanceof s?s.from(t):new t.constructor(t.buffer.slice(),t.byteOffset,t.length)}var dd=g(function(t){if((t=t||{}).circles)return function(t){const e=[],i=[],a=new Map;if(a.set(Date,t=>new Date(t)),a.set(Map,(t,e)=>new Map(n(Array.from(t),e))),a.set(Set,(t,e)=>new Set(n(Array.from(t),e))),t.constructorHandlers)for(const e of t.constructorHandlers)a.set(e[0],e[1]);let s=null;return t.proto?function t(o){if("object"!=typeof o||null===o)return o;if(Array.isArray(o))return n(o,t);if(o.constructor!==Object&&(s=a.get(o.constructor)))return s(o,t);const r={};e.push(o),i.push(r);for(const n in o){const l=o[n];if("object"!=typeof l||null===l)r[n]=l;else if(l.constructor!==Object&&(s=a.get(l.constructor)))r[n]=s(l,t);else if(ArrayBuffer.isView(l))r[n]=cd(l);else{const a=e.indexOf(l);r[n]=-1!==a?i[a]:t(l)}}return e.pop(),i.pop(),r}:function t(o){if("object"!=typeof o||null===o)return o;if(Array.isArray(o))return n(o,t);if(o.constructor!==Object&&(s=a.get(o.constructor)))return s(o,t);const r={};e.push(o),i.push(r);for(const n in o){if(!1===Object.hasOwnProperty.call(o,n))continue;const l=o[n];if("object"!=typeof l||null===l)r[n]=l;else if(l.constructor!==Object&&(s=a.get(l.constructor)))r[n]=s(l,t);else if(ArrayBuffer.isView(l))r[n]=cd(l);else{const a=e.indexOf(l);r[n]=-1!==a?i[a]:t(l)}}return e.pop(),i.pop(),r};function n(t,n){const o=Object.keys(t),r=new Array(o.length);for(let l=0;l<o.length;l++){const c=o[l],d=t[c];if("object"!=typeof d||null===d)r[c]=d;else if(d.constructor!==Object&&(s=a.get(d.constructor)))r[c]=s(d,n);else if(ArrayBuffer.isView(d))r[c]=cd(d);else{const t=e.indexOf(d);r[c]=-1!==t?i[t]:n(d)}}return r}}(t);const e=new Map;if(e.set(Date,t=>new Date(t)),e.set(Map,(t,e)=>new Map(a(Array.from(t),e))),e.set(Set,(t,e)=>new Set(a(Array.from(t),e))),t.constructorHandlers)for(const i of t.constructorHandlers)e.set(i[0],i[1]);let i=null;return t.proto?function t(s){if("object"!=typeof s||null===s)return s;if(Array.isArray(s))return a(s,t);if(s.constructor!==Object&&(i=e.get(s.constructor)))return i(s,t);const n={};for(const a in s){const o=s[a];"object"!=typeof o||null===o?n[a]=o:o.constructor!==Object&&(i=e.get(o.constructor))?n[a]=i(o,t):ArrayBuffer.isView(o)?n[a]=cd(o):n[a]=t(o)}return n}:function t(s){if("object"!=typeof s||null===s)return s;if(Array.isArray(s))return a(s,t);if(s.constructor!==Object&&(i=e.get(s.constructor)))return i(s,t);const n={};for(const a in s){if(!1===Object.hasOwnProperty.call(s,a))continue;const o=s[a];"object"!=typeof o||null===o?n[a]=o:o.constructor!==Object&&(i=e.get(o.constructor))?n[a]=i(o,t):ArrayBuffer.isView(o)?n[a]=cd(o):n[a]=t(o)}return n};function a(t,a){const s=Object.keys(t),n=new Array(s.length);for(let o=0;o<s.length;o++){const r=s[o],l=t[r];"object"!=typeof l||null===l?n[r]=l:l.constructor!==Object&&(i=e.get(l.constructor))?n[r]=i(l,a):ArrayBuffer.isView(l)?n[r]=cd(l):n[r]=a(l)}return n}});function hd(t,e=new Set,i=!0){if(t.forEach(t=>{t&&t.id&&"g-root"!==t.id&&!(t instanceof Document)&&(t instanceof tr&&(/^\d+(-\d+){2}$/.test(t.id)||new RegExp(`^${jc.DMCODE}-\\d+-[a-z0-9]+$`,"gi").test(t.id))||t instanceof Xo&&new RegExp(`^${jc.EDGE_POLE}(-\\d+){2}$`,"gi").test(t.id))?e.add(t.id):t.parentNode&&hd([t.parentNode],e,!1)}),i)return[...e].map(t=>{const[e,i="",a=""]=t.split("-");return{type:Number.parseInt(e),subType:Number.parseInt(i),id:`${jc.DMCODE}`===e?a:Number.parseInt(a),pickedTypesId:t}})}var ud,pd={exports:{}};pd.exports=(ud=function(){function t(t){return a.appendChild(t.dom),t}function e(t){for(var e=0;e<a.children.length;e++)a.children[e].style.display=e===t?"block":"none";i=t}var i=0,a=document.createElement("div");a.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",a.addEventListener("click",function(t){t.preventDefault(),e(++i%a.children.length)},!1);var s=(performance||Date).now(),n=s,o=0,r=t(new ud.Panel("FPS","#0ff","#002")),l=t(new ud.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new ud.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:a,addPanel:t,showPanel:e,begin:function(){s=(performance||Date).now()},end:function(){o++;var t=(performance||Date).now();if(l.update(t-s,200),t>n+1e3&&(r.update(1e3*o/(t-n),100),n=t,o=0,c)){var e=performance.memory;c.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){s=this.end()},domElement:a,setMode:e}},ud.Panel=function(t,e,i){var a=1/0,s=0,n=Math.round,o=n(window.devicePixelRatio||1),r=80*o,l=48*o,c=3*o,d=2*o,h=3*o,u=15*o,p=74*o,m=30*o,f=document.createElement("canvas");f.width=r,f.height=l,f.style.cssText="width:80px;height:48px";var g=f.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,r,l),g.fillStyle=e,g.fillText(t,c,d),g.fillRect(h,u,p,m),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(h,u,p,m),{dom:f,update:function(l,_){a=Math.min(a,l),s=Math.max(s,l),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,r,u),g.fillStyle=e,g.fillText(n(l)+" "+t+" ("+n(a)+"-"+n(s)+")",c,d),g.drawImage(f,h+o,u,p-o,m,h,u,p-o,m),g.fillRect(h+p-o,u,o,m),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(h+p-o,u,o,n((1-l/_)*m))}}},ud);var md=g(pd.exports);
/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.19.2
 * @author George Michael Brower
 * @license MIT
 */class fd{constructor(t,e,i,a,s="div"){this.parent=t,this.object=e,this.property=i,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement(s),this.domElement.classList.add("controller"),this.domElement.classList.add(a),this.$name=document.createElement("div"),this.$name.classList.add("name"),fd.nextNameID=fd.nextNameID||0,this.$name.id="lil-gui-name-"+ ++fd.nextNameID,this.$widget=document.createElement("div"),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.domElement.addEventListener("keydown",t=>t.stopPropagation()),this.domElement.addEventListener("keyup",t=>t.stopPropagation()),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(i)}name(t){return this._name=t,this.$name.textContent=t,this}onChange(t){return this._onChange=t,this}_callOnChange(){this.parent._callOnChange(this),void 0!==this._onChange&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),void 0!==this._onFinishChange&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(t=!0){return this.disable(!t)}disable(t=!0){return t===this._disabled||(this._disabled=t,this.domElement.classList.toggle("disabled",t),this.$disable.toggleAttribute("disabled",t)),this}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(t){const e=this.parent.add(this.object,this.property,t);return e.name(this._name),this.destroy(),e}min(t){return this}max(t){return this}step(t){return this}decimals(t){return this}listen(t=!0){return this._listening=t,void 0!==this._listenCallbackID&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const t=this.save();t!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=t}getValue(){return this.object[this.property]}setValue(t){return this.getValue()!==t&&(this.object[this.property]=t,this._callOnChange(),this.updateDisplay()),this}updateDisplay(){return this}load(t){return this.setValue(t),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class gd extends fd{constructor(t,e,i){super(t,e,i,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function _d(t){let e,i;return(e=t.match(/(#|0x)?([a-f0-9]{6})/i))?i=e[2]:(e=t.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?i=parseInt(e[1]).toString(16).padStart(2,0)+parseInt(e[2]).toString(16).padStart(2,0)+parseInt(e[3]).toString(16).padStart(2,0):(e=t.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(i=e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),!!i&&"#"+i}const yd={isPrimitive:!0,match:t=>"number"==typeof t,fromHexString:t=>parseInt(t.substring(1),16),toHexString:t=>"#"+t.toString(16).padStart(6,0)},vd={isPrimitive:!1,match:t=>Array.isArray(t),fromHexString(t,e,i=1){const a=yd.fromHexString(t);e[0]=(a>>16&255)/255*i,e[1]=(a>>8&255)/255*i,e[2]=(255&a)/255*i},toHexString:([t,e,i],a=1)=>yd.toHexString(t*(a=255/a)<<16^e*a<<8^i*a)},bd={isPrimitive:!1,match:t=>Object(t)===t,fromHexString(t,e,i=1){const a=yd.fromHexString(t);e.r=(a>>16&255)/255*i,e.g=(a>>8&255)/255*i,e.b=(255&a)/255*i},toHexString:({r:t,g:e,b:i},a=1)=>yd.toHexString(t*(a=255/a)<<16^e*a<<8^i*a)},Ed=[{isPrimitive:!0,match:t=>"string"==typeof t,fromHexString:_d,toHexString:_d},yd,vd,bd];class Ad extends fd{constructor(t,e,i,a){var s;super(t,e,i,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=(s=this.initialValue,Ed.find(t=>t.match(s))),this._rgbScale=a,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const t=_d(this.$text.value);t&&this._setValueFromHexString(t)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(t){if(this._format.isPrimitive){const e=this._format.fromHexString(t);this.setValue(e)}else this._format.fromHexString(t,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(t){return this._setValueFromHexString(t),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class wd extends fd{constructor(t,e,i){super(t,e,i,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",t=>{t.preventDefault(),this.getValue().call(this.object),this._callOnChange()}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class Sd extends fd{constructor(t,e,i,a,s,n){super(t,e,i,"number"),this._initInput(),this.min(a),this.max(s);const o=void 0!==n;this.step(o?n:this._getImplicitStep(),o),this.updateDisplay()}decimals(t){return this._decimals=t,this.updateDisplay(),this}min(t){return this._min=t,this._onUpdateMinMax(),this}max(t){return this._max=t,this._onUpdateMinMax(),this}step(t,e=!0){return this._step=t,this._stepExplicit=e,this}updateDisplay(){const t=this.getValue();if(this._hasSlider){let e=(t-this._min)/(this._max-this._min);e=Math.max(0,Math.min(e,1)),this.$fill.style.width=100*e+"%"}return this._inputFocused||(this.$input.value=void 0===this._decimals?t:t.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),window.matchMedia("(pointer: coarse)").matches&&(this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any")),this.$widget.appendChild(this.$input),this.$disable=this.$input;const t=t=>{const e=parseFloat(this.$input.value);isNaN(e)||(this._snapClampSetValue(e+t),this.$input.value=this.getValue())};let e,i,a,s,n,o=!1;const r=t=>{if(o){const a=t.clientX-e,s=t.clientY-i;Math.abs(s)>5?(t.preventDefault(),this.$input.blur(),o=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(a)>5&&l()}if(!o){const e=t.clientY-a;n-=e*this._step*this._arrowKeyMultiplier(t),s+n>this._max?n=this._max-s:s+n<this._min&&(n=this._min-s),this._snapClampSetValue(s+n)}a=t.clientY},l=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",l)};this.$input.addEventListener("input",()=>{let t=parseFloat(this.$input.value);isNaN(t)||(this._stepExplicit&&(t=this._snap(t)),this.setValue(this._clamp(t)))}),this.$input.addEventListener("keydown",e=>{"Enter"===e.key&&this.$input.blur(),"ArrowUp"===e.code&&(e.preventDefault(),t(this._step*this._arrowKeyMultiplier(e))),"ArrowDown"===e.code&&(e.preventDefault(),t(this._step*this._arrowKeyMultiplier(e)*-1))}),this.$input.addEventListener("wheel",e=>{this._inputFocused&&(e.preventDefault(),t(this._step*this._normalizeMouseWheel(e)))},{passive:!1}),this.$input.addEventListener("mousedown",t=>{e=t.clientX,i=a=t.clientY,o=!0,s=this.getValue(),n=0,window.addEventListener("mousemove",r),window.addEventListener("mouseup",l)}),this.$input.addEventListener("focus",()=>{this._inputFocused=!0}),this.$input.addEventListener("blur",()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()})}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const t=t=>{const e=this.$slider.getBoundingClientRect();let i=(a=t,s=e.left,n=e.right,o=this._min,(a-s)/(n-s)*(this._max-o)+o);var a,s,n,o;this._snapClampSetValue(i)},e=e=>{t(e.clientX)},i=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",i)};let a,s,n=!1;const o=e=>{e.preventDefault(),this._setDraggingStyle(!0),t(e.touches[0].clientX),n=!1},r=e=>{if(n){const t=e.touches[0].clientX-a,i=e.touches[0].clientY-s;Math.abs(t)>Math.abs(i)?o(e):(window.removeEventListener("touchmove",r),window.removeEventListener("touchend",l))}else e.preventDefault(),t(e.touches[0].clientX)},l=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",r),window.removeEventListener("touchend",l)},c=this._callOnFinishChange.bind(this);let d;this.$slider.addEventListener("mousedown",a=>{this._setDraggingStyle(!0),t(a.clientX),window.addEventListener("mousemove",e),window.addEventListener("mouseup",i)}),this.$slider.addEventListener("touchstart",t=>{t.touches.length>1||(this._hasScrollBar?(a=t.touches[0].clientX,s=t.touches[0].clientY,n=!0):o(t),window.addEventListener("touchmove",r,{passive:!1}),window.addEventListener("touchend",l))},{passive:!1}),this.$slider.addEventListener("wheel",t=>{if(Math.abs(t.deltaX)<Math.abs(t.deltaY)&&this._hasScrollBar)return;t.preventDefault();const e=this._normalizeMouseWheel(t)*this._step;this._snapClampSetValue(this.getValue()+e),this.$input.value=this.getValue(),clearTimeout(d),d=setTimeout(c,400)},{passive:!1})}_setDraggingStyle(t,e="horizontal"){this.$slider&&this.$slider.classList.toggle("active",t),document.body.classList.toggle("lil-gui-dragging",t),document.body.classList.toggle(`lil-gui-${e}`,t)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(t){let{deltaX:e,deltaY:i}=t;return Math.floor(t.deltaY)!==t.deltaY&&t.wheelDelta&&(e=0,i=-t.wheelDelta/120,i*=this._stepExplicit?1:10),e+-i}_arrowKeyMultiplier(t){let e=this._stepExplicit?1:10;return t.shiftKey?e*=10:t.altKey&&(e/=10),e}_snap(t){const e=Math.round(t/this._step)*this._step;return parseFloat(e.toPrecision(15))}_clamp(t){return t<this._min&&(t=this._min),t>this._max&&(t=this._max),t}_snapClampSetValue(t){this.setValue(this._clamp(this._snap(t)))}get _hasScrollBar(){const t=this.parent.root.$children;return t.scrollHeight>t.clientHeight}get _hasMin(){return void 0!==this._min}get _hasMax(){return void 0!==this._max}}class Cd extends fd{constructor(t,e,i,a){super(t,e,i,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.options(a)}options(t){return this._values=Array.isArray(t)?t:Object.values(t),this._names=Array.isArray(t)?t:Object.keys(t),this.$select.replaceChildren(),this._names.forEach(t=>{const e=document.createElement("option");e.textContent=t,this.$select.appendChild(e)}),this.updateDisplay(),this}updateDisplay(){const t=this.getValue(),e=this._values.indexOf(t);return this.$select.selectedIndex=e,this.$display.textContent=-1===e?t:this._names[e],this}}class Id extends fd{constructor(t,e,i){super(t,e,i,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("spellcheck","false"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",t=>{"Enter"===t.code&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}let xd=!1;class Td{constructor({parent:t,autoPlace:e=void 0===t,container:i,width:a,title:s="Controls",closeFolders:n=!1,injectStyles:o=!0,touchStyles:r=!0}={}){if(this.parent=t,this.root=t?t.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("keydown",t=>{"Enter"!==t.code&&"Space"!==t.code||(t.preventDefault(),this.$title.click())}),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(s),this.parent)return this.parent.children.push(this),this.parent.folders.push(this),void this.parent.$children.appendChild(this.domElement);this.domElement.classList.add("root"),r&&this.domElement.classList.add("allow-touch-styles"),!xd&&o&&(function(){const t=document.createElement("style");t.innerHTML='.lil-gui {\n  font-family: var(--font-family);\n  font-size: var(--font-size);\n  line-height: 1;\n  font-weight: normal;\n  font-style: normal;\n  text-align: left;\n  color: var(--text-color);\n  user-select: none;\n  -webkit-user-select: none;\n  touch-action: manipulation;\n  --background-color: #1f1f1f;\n  --text-color: #ebebeb;\n  --title-background-color: #111111;\n  --title-text-color: #ebebeb;\n  --widget-color: #424242;\n  --hover-color: #4f4f4f;\n  --focus-color: #595959;\n  --number-color: #2cc9ff;\n  --string-color: #a2db3c;\n  --font-size: 11px;\n  --input-font-size: 11px;\n  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;\n  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;\n  --padding: 4px;\n  --spacing: 4px;\n  --widget-height: 20px;\n  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);\n  --name-width: 45%;\n  --slider-knob-width: 2px;\n  --slider-input-width: 27%;\n  --color-input-width: 27%;\n  --slider-input-min-width: 45px;\n  --color-input-min-width: 45px;\n  --folder-indent: 7px;\n  --widget-padding: 0 0 0 3px;\n  --widget-border-radius: 2px;\n  --checkbox-size: calc(0.75 * var(--widget-height));\n  --scrollbar-width: 5px;\n}\n.lil-gui, .lil-gui * {\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n.lil-gui.root {\n  width: var(--width, 245px);\n  display: flex;\n  flex-direction: column;\n  background: var(--background-color);\n}\n.lil-gui.root > .title {\n  background: var(--title-background-color);\n  color: var(--title-text-color);\n}\n.lil-gui.root > .children {\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n.lil-gui.root > .children::-webkit-scrollbar {\n  width: var(--scrollbar-width);\n  height: var(--scrollbar-width);\n  background: var(--background-color);\n}\n.lil-gui.root > .children::-webkit-scrollbar-thumb {\n  border-radius: var(--scrollbar-width);\n  background: var(--focus-color);\n}\n@media (pointer: coarse) {\n  .lil-gui.allow-touch-styles, .lil-gui.allow-touch-styles .lil-gui {\n    --widget-height: 28px;\n    --padding: 6px;\n    --spacing: 6px;\n    --font-size: 13px;\n    --input-font-size: 16px;\n    --folder-indent: 10px;\n    --scrollbar-width: 7px;\n    --slider-input-min-width: 50px;\n    --color-input-min-width: 65px;\n  }\n}\n.lil-gui.force-touch-styles, .lil-gui.force-touch-styles .lil-gui {\n  --widget-height: 28px;\n  --padding: 6px;\n  --spacing: 6px;\n  --font-size: 13px;\n  --input-font-size: 16px;\n  --folder-indent: 10px;\n  --scrollbar-width: 7px;\n  --slider-input-min-width: 50px;\n  --color-input-min-width: 65px;\n}\n.lil-gui.autoPlace {\n  max-height: 100%;\n  position: fixed;\n  top: 0;\n  right: 15px;\n  z-index: 1001;\n}\n\n.lil-gui .controller {\n  display: flex;\n  align-items: center;\n  padding: 0 var(--padding);\n  margin: var(--spacing) 0;\n}\n.lil-gui .controller.disabled {\n  opacity: 0.5;\n}\n.lil-gui .controller.disabled, .lil-gui .controller.disabled * {\n  pointer-events: none !important;\n}\n.lil-gui .controller > .name {\n  min-width: var(--name-width);\n  flex-shrink: 0;\n  white-space: pre;\n  padding-right: var(--spacing);\n  line-height: var(--widget-height);\n}\n.lil-gui .controller .widget {\n  position: relative;\n  display: flex;\n  align-items: center;\n  width: 100%;\n  min-height: var(--widget-height);\n}\n.lil-gui .controller.string input {\n  color: var(--string-color);\n}\n.lil-gui .controller.boolean {\n  cursor: pointer;\n}\n.lil-gui .controller.color .display {\n  width: 100%;\n  height: var(--widget-height);\n  border-radius: var(--widget-border-radius);\n  position: relative;\n}\n@media (hover: hover) {\n  .lil-gui .controller.color .display:hover:before {\n    content: " ";\n    display: block;\n    position: absolute;\n    border-radius: var(--widget-border-radius);\n    border: 1px solid #fff9;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n  }\n}\n.lil-gui .controller.color input[type=color] {\n  opacity: 0;\n  width: 100%;\n  height: 100%;\n  cursor: pointer;\n}\n.lil-gui .controller.color input[type=text] {\n  margin-left: var(--spacing);\n  font-family: var(--font-family-mono);\n  min-width: var(--color-input-min-width);\n  width: var(--color-input-width);\n  flex-shrink: 0;\n}\n.lil-gui .controller.option select {\n  opacity: 0;\n  position: absolute;\n  width: 100%;\n  max-width: 100%;\n}\n.lil-gui .controller.option .display {\n  position: relative;\n  pointer-events: none;\n  border-radius: var(--widget-border-radius);\n  height: var(--widget-height);\n  line-height: var(--widget-height);\n  max-width: 100%;\n  overflow: hidden;\n  word-break: break-all;\n  padding-left: 0.55em;\n  padding-right: 1.75em;\n  background: var(--widget-color);\n}\n@media (hover: hover) {\n  .lil-gui .controller.option .display.focus {\n    background: var(--focus-color);\n  }\n}\n.lil-gui .controller.option .display.active {\n  background: var(--focus-color);\n}\n.lil-gui .controller.option .display:after {\n  font-family: "lil-gui";\n  content: "â";\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  padding-right: 0.375em;\n}\n.lil-gui .controller.option .widget,\n.lil-gui .controller.option select {\n  cursor: pointer;\n}\n@media (hover: hover) {\n  .lil-gui .controller.option .widget:hover .display {\n    background: var(--hover-color);\n  }\n}\n.lil-gui .controller.number input {\n  color: var(--number-color);\n}\n.lil-gui .controller.number.hasSlider input {\n  margin-left: var(--spacing);\n  width: var(--slider-input-width);\n  min-width: var(--slider-input-min-width);\n  flex-shrink: 0;\n}\n.lil-gui .controller.number .slider {\n  width: 100%;\n  height: var(--widget-height);\n  background: var(--widget-color);\n  border-radius: var(--widget-border-radius);\n  padding-right: var(--slider-knob-width);\n  overflow: hidden;\n  cursor: ew-resize;\n  touch-action: pan-y;\n}\n@media (hover: hover) {\n  .lil-gui .controller.number .slider:hover {\n    background: var(--hover-color);\n  }\n}\n.lil-gui .controller.number .slider.active {\n  background: var(--focus-color);\n}\n.lil-gui .controller.number .slider.active .fill {\n  opacity: 0.95;\n}\n.lil-gui .controller.number .fill {\n  height: 100%;\n  border-right: var(--slider-knob-width) solid var(--number-color);\n  box-sizing: content-box;\n}\n\n.lil-gui-dragging .lil-gui {\n  --hover-color: var(--widget-color);\n}\n.lil-gui-dragging * {\n  cursor: ew-resize !important;\n}\n\n.lil-gui-dragging.lil-gui-vertical * {\n  cursor: ns-resize !important;\n}\n\n.lil-gui .title {\n  height: var(--title-height);\n  line-height: calc(var(--title-height) - 4px);\n  font-weight: 600;\n  padding: 0 var(--padding);\n  -webkit-tap-highlight-color: transparent;\n  cursor: pointer;\n  outline: none;\n  text-decoration-skip: objects;\n}\n.lil-gui .title:before {\n  font-family: "lil-gui";\n  content: "â¾";\n  padding-right: 2px;\n  display: inline-block;\n}\n.lil-gui .title:active {\n  background: var(--title-background-color);\n  opacity: 0.75;\n}\n@media (hover: hover) {\n  body:not(.lil-gui-dragging) .lil-gui .title:hover {\n    background: var(--title-background-color);\n    opacity: 0.85;\n  }\n  .lil-gui .title:focus {\n    text-decoration: underline var(--focus-color);\n  }\n}\n.lil-gui.root > .title:focus {\n  text-decoration: none !important;\n}\n.lil-gui.closed > .title:before {\n  content: "â¸";\n}\n.lil-gui.closed > .children {\n  transform: translateY(-7px);\n  opacity: 0;\n}\n.lil-gui.closed:not(.transition) > .children {\n  display: none;\n}\n.lil-gui.transition > .children {\n  transition-duration: 300ms;\n  transition-property: height, opacity, transform;\n  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);\n  overflow: hidden;\n  pointer-events: none;\n}\n.lil-gui .children:empty:before {\n  content: "Empty";\n  padding: 0 var(--padding);\n  margin: var(--spacing) 0;\n  display: block;\n  height: var(--widget-height);\n  font-style: italic;\n  line-height: var(--widget-height);\n  opacity: 0.5;\n}\n.lil-gui.root > .children > .lil-gui > .title {\n  border: 0 solid var(--widget-color);\n  border-width: 1px 0;\n  transition: border-color 300ms;\n}\n.lil-gui.root > .children > .lil-gui.closed > .title {\n  border-bottom-color: transparent;\n}\n.lil-gui + .controller {\n  border-top: 1px solid var(--widget-color);\n  margin-top: 0;\n  padding-top: var(--spacing);\n}\n.lil-gui .lil-gui .lil-gui > .title {\n  border: none;\n}\n.lil-gui .lil-gui .lil-gui > .children {\n  border: none;\n  margin-left: var(--folder-indent);\n  border-left: 2px solid var(--widget-color);\n}\n.lil-gui .lil-gui .controller {\n  border: none;\n}\n\n.lil-gui label, .lil-gui input, .lil-gui button {\n  -webkit-tap-highlight-color: transparent;\n}\n.lil-gui input {\n  border: 0;\n  outline: none;\n  font-family: var(--font-family);\n  font-size: var(--input-font-size);\n  border-radius: var(--widget-border-radius);\n  height: var(--widget-height);\n  background: var(--widget-color);\n  color: var(--text-color);\n  width: 100%;\n}\n@media (hover: hover) {\n  .lil-gui input:hover {\n    background: var(--hover-color);\n  }\n  .lil-gui input:active {\n    background: var(--focus-color);\n  }\n}\n.lil-gui input:disabled {\n  opacity: 1;\n}\n.lil-gui input[type=text],\n.lil-gui input[type=number] {\n  padding: var(--widget-padding);\n  -moz-appearance: textfield;\n}\n.lil-gui input[type=text]:focus,\n.lil-gui input[type=number]:focus {\n  background: var(--focus-color);\n}\n.lil-gui input[type=checkbox] {\n  appearance: none;\n  width: var(--checkbox-size);\n  height: var(--checkbox-size);\n  border-radius: var(--widget-border-radius);\n  text-align: center;\n  cursor: pointer;\n}\n.lil-gui input[type=checkbox]:checked:before {\n  font-family: "lil-gui";\n  content: "â";\n  font-size: var(--checkbox-size);\n  line-height: var(--checkbox-size);\n}\n@media (hover: hover) {\n  .lil-gui input[type=checkbox]:focus {\n    box-shadow: inset 0 0 0 1px var(--focus-color);\n  }\n}\n.lil-gui button {\n  outline: none;\n  cursor: pointer;\n  font-family: var(--font-family);\n  font-size: var(--font-size);\n  color: var(--text-color);\n  width: 100%;\n  height: var(--widget-height);\n  text-transform: none;\n  background: var(--widget-color);\n  border-radius: var(--widget-border-radius);\n  border: none;\n}\n@media (hover: hover) {\n  .lil-gui button:hover {\n    background: var(--hover-color);\n  }\n  .lil-gui button:focus {\n    box-shadow: inset 0 0 0 1px var(--focus-color);\n  }\n}\n.lil-gui button:active {\n  background: var(--focus-color);\n}\n\n@font-face {\n  font-family: "lil-gui";\n  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");\n}';const e=document.querySelector("head link[rel=stylesheet], head style");e?document.head.insertBefore(t,e):document.head.appendChild(t)}(),xd=!0),i?i.appendChild(this.domElement):e&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),a&&this.domElement.style.setProperty("--width",a+"px"),this._closeFolders=n}add(t,e,i,a,s){if(Object(i)===i)return new Cd(this,t,e,i);switch(typeof t[e]){case"number":return new Sd(this,t,e,i,a,s);case"boolean":return new gd(this,t,e);case"string":return new Id(this,t,e);case"function":return new wd(this,t,e)}}addColor(t,e,i=1){return new Ad(this,t,e,i)}addFolder(t){const e=new Td({parent:this,title:t});return this.root._closeFolders&&e.close(),e}load(t,e=!0){return t.controllers&&this.controllers.forEach(e=>{e instanceof wd||e._name in t.controllers&&e.load(t.controllers[e._name])}),e&&t.folders&&this.folders.forEach(e=>{e._title in t.folders&&e.load(t.folders[e._title])}),this}save(t=!0){const e={controllers:{},folders:{}};return this.controllers.forEach(t=>{if(!(t instanceof wd)){if(t._name in e.controllers)throw new Error(`Cannot save GUI with duplicate property "${t._name}"`);e.controllers[t._name]=t.save()}}),t&&this.folders.forEach(t=>{if(t._title in e.folders)throw new Error(`Cannot save GUI with duplicate folder "${t._title}"`);e.folders[t._title]=t.save()}),e}open(t=!0){return this._setClosed(!t),this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}_setClosed(t){this._closed!==t&&(this._closed=t,this._callOnOpenClose(this))}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(t=!0){return this._setClosed(!t),this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const e=this.$children.clientHeight;this.$children.style.height=e+"px",this.domElement.classList.add("transition");const i=t=>{t.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",i))};this.$children.addEventListener("transitionend",i);const a=t?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!t),requestAnimationFrame(()=>{this.$children.style.height=a+"px"})}),this}title(t){return this._title=t,this.$title.textContent=t,this}reset(t=!0){return(t?this.controllersRecursive():this.controllers).forEach(t=>t.reset()),this}onChange(t){return this._onChange=t,this}_callOnChange(t){this.parent&&this.parent._callOnChange(t),void 0!==this._onChange&&this._onChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(t){this.parent&&this.parent._callOnFinishChange(t),void 0!==this._onFinishChange&&this._onFinishChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}onOpenClose(t){return this._onOpenClose=t,this}_callOnOpenClose(t){this.parent&&this.parent._callOnOpenClose(t),void 0!==this._onOpenClose&&this._onOpenClose.call(this,t)}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(t=>t.destroy())}controllersRecursive(){let t=Array.from(this.controllers);return this.folders.forEach(e=>{t=t.concat(e.controllersRecursive())}),t}foldersRecursive(){let t=Array.from(this.folders);return this.folders.forEach(e=>{t=t.concat(e.foldersRecursive())}),t}}class Md{constructor(t,e,i){Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"yaw",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.x=t,this.y=e,this.yaw=void 0===i?Math.atan2(e,t):i}getPos(){return{x:this.x,y:this.y,yaw:this.yaw}}setPos(t,e,i){this.x=t,this.y=e,void 0!==i&&this.setYaw(i)}setPoint(t){this.x=t.x,this.y=t.y}setYaw(t){this.yaw=t}getAngle(){return Zd(this.yaw)}clone(){return new Md(this.x,this.y,this.yaw)}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}setLength(t){const e=this.getLength(),i=0!==e?t/e:0;this.setPos(this.x*i,this.y*i)}normalize(t){void 0===t&&(t=1);const e=this.getLength(),i=0!==e?t/e:0;return new Md(this.x*i,this.y*i,this.yaw)}add(t){return"number"==typeof t?new Md(this.x+t,this.y+t):new Md(this.x+t.x,this.y+t.y)}subtract(t){return"number"==typeof t?new Md(this.x-t,this.y-t):new Md(this.x-t.x,this.y-t.y)}multiply(t){return"number"==typeof t?new Md(this.x*t,this.y*t):new Md(this.x*t.x,this.y*t.y)}divide(t){return"number"==typeof t?(t=t||1,new Md(this.x/t,this.y/t)):new Md(this.x/(t.x||1),this.y/(t.y||1))}rotate(t,e){if(0===t)return this.clone();t=t*Math.PI/180;let i=e?this.subtract(e):this;const a=Math.sin(t),s=Math.cos(t);return i=new Md(i.x*s-i.y*a,i.x*a+i.y*s),e?i.add(e):i}}class Pd{constructor(t){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"baseType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"desc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isDirty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=0,this.baseType=t,this.desc="",this.isDirty=!1}getID(){return this.id}setID(t){this.id=t}setDirty(t){this.isDirty=t}fromJson(t,e=!0){}toJson(t=!0){return{}}getName(){return""}isNodeModel(){return this.baseType===jc.NODE}isStationModel(){return this.baseType===jc.STATION}isEdgeModel(){return this.baseType===jc.EDGE}isFuncAreaModel(){return this.baseType===jc.FUNC_AREA}isNoteAreaModel(){return this.baseType===jc.NOTE_AREA}isLocationAreaModel(){return this.baseType===jc.LOCATION_AREA}isCleanArea(){return this.baseType===jc.CLEAN_AREA}isRectModel(){return this.isFuncAreaModel()||this.isNoteAreaModel()||this.isLocationAreaModel()||this.isCleanArea()}isDMCodeModel(){return this.baseType===jc.DMCODE}isGroupModel(){return this.baseType===jc.EDGE_GROUP}}class Od extends Pd{constructor(t){super(t),Object.defineProperty(this,"pos",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pos=new Md(0,0,0)}setPos(t){this.pos.setPoint(t)}setYaw(t){this.pos.yaw=t}getPos(){return this.pos}getYaw(){return this.pos.yaw}fromJson(t,e=!0){let i=1,a=1;e&&(i=.1,a=1/Ic),this.id=t.id,this.pos.x=ih(t.x*i),this.pos.y=ih(t.y*i),this.pos.yaw=t.yaw*a}toJson(t=!0){const e={};let i=1,a=1;return t&&(i=Sc,a=Ic),e.id=this.id,e.x=ih(this.pos.x*i),e.y=ih(this.pos.y*i),e.yaw=ih(this.pos.yaw*a,4),e}getName(){return`T${this.id}`}}class Ld extends Pd{constructor(t){super(t),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pa",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pb",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="",this.pa=new Md(0,0,0),this.pb=new Md(0,0,0),this.pc=new Md(0,0,0),this.pd=new Md(0,0,0)}fromJson(t,e=!0){let i=1;e&&(i=.1),this.id=t.id,this.name=t.name||"",this.pa.x=ih(t["pa.x"]*i),this.pa.y=ih(t["pa.y"]*i),this.pb.x=ih(t["pb.x"]*i),this.pb.y=ih(t["pb.y"]*i),this.pc.x=ih(t["pc.x"]*i),this.pc.y=ih(t["pc.y"]*i),this.pd.x=ih(t["pd.x"]*i),this.pd.y=ih(t["pd.y"]*i),t.hasOwnProperty("desc")&&(this.desc=t.desc)}toJson(t=!0){const e={};let i=1;return t&&(i=Sc),e.id=this.id,e.name=this.name,e.desc=this.desc,e["pa.x"]=ih(this.pa.x*i),e["pa.y"]=ih(this.pa.y*i),e["pb.x"]=ih(this.pb.x*i),e["pb.y"]=ih(this.pb.y*i),e["pc.x"]=ih(this.pc.x*i),e["pc.y"]=ih(this.pc.y*i),e["pd.x"]=ih(this.pd.x*i),e["pd.y"]=ih(this.pd.y*i),e}getName(){return this.name}setName(t=""){this.name=t}setPosPa(t){this.pa.setPoint(t)}setPosPb(t){this.pb.setPoint(t)}setPosPc(t){this.pc.setPoint(t)}setPosPd(t){this.pd.setPoint(t)}setPos(t,e){this.setPosPa(t),this.setPosPb(new Md(e.x,t.y,0)),this.setPosPc(e),this.setPosPd(new Md(t.x,e.y,0))}isSelectionArea(){return this.baseType===jc.SELECTION_AREA}}class Rd extends Ld{constructor(t){super(t),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"area_group",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"z",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user_defined_params",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"enter_station",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exit_station",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"is_play_music",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"is_broadcast",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"param_int",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"volume",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user_define_properties",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"oba_define_params",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"limit_speeds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rotate_yaw",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"limit_cars_number",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"light_params",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"io_oba_params",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera_params",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=Kc.USER_DEFINE,this.area_group=[],this.z=100,this.user_defined_params=[],this.enter_station=0,this.exit_station=0,this.is_play_music=!0,this.is_broadcast=!1,this.param_int=0,this.volume=-1,this.user_define_properties={},this.oba_define_params={area_scene_type:"customize"},this.rotate_yaw=Jd(3),this.limit_cars_number=0,this.limit_speeds={unload:0,load:0,rack:0,unload_unit:"m/s",load_unit:"m/s",rack_unit:"m/s"},this.light_params={trigger_state:0},this.io_oba_params={trigger_state:0,unload:0,load:0,rack:0,addresses:"",signal:0},this.camera_params={enable_camera_down:0}}fromJson(t,e=!0){let i=1;if(e&&(i=1/Ic),super.fromJson(t,e),this.type=t.type,this.enter_station=t.enter_station,this.exit_station=t.exit_station,this.is_play_music=t.is_play_music,this.is_broadcast=t.is_broadcast,this.param_int=t.param_int,t.hasOwnProperty("area_group")&&(this.area_group=[...new Set(t.area_group)]),t.hasOwnProperty("user_defined_params")&&(this.user_defined_params=t.user_defined_params),t.hasOwnProperty("z")&&(this.z=t.z),t.hasOwnProperty("desc")&&(this.desc=t.desc),this.type===Kc.DISABLE_ROTATE?(this.param_int=this.param_int*i,this.rotate_yaw=this.param_int):t.hasOwnProperty("rotate_yaw")&&(this.rotate_yaw=t.rotate_yaw),t.hasOwnProperty("volume")&&(this.volume=t.volume),t.hasOwnProperty("user_define_properties")&&(this.user_define_properties=t.user_define_properties),t.hasOwnProperty("oba_define_params")&&(this.oba_define_params={area_scene_type:"customize",...t.oba_define_params}),t.hasOwnProperty("limit_speeds")){const{unload:e=0,load:i=0,rack:a=0}=t.limit_speeds;this.limit_speeds={...this.limit_speeds,unload:e,load:i,rack:a,unload_unit:"m/s",load_unit:"m/s",rack_unit:"m/s"}}const a=t.hasOwnProperty("limit_cars_number");this.type===Kc.LIMIT_CAR_NUMBER||!a&&this.type===Kc.USER_DEFINE&&this.area_group.includes(Kc.LIMIT_CAR_NUMBER)?this.limit_cars_number=this.param_int:a&&(this.limit_cars_number=t.limit_cars_number),t.hasOwnProperty("light_params")&&(this.light_params={...t.light_params}),t.hasOwnProperty("io_oba_params")&&(this.io_oba_params={...t.io_oba_params}),t.hasOwnProperty("camera_params")&&(this.camera_params={...t.camera_params})}toJson(t=!0){const e=super.toJson(t);let i=1;t&&(i=Ic),e.type=this.type,e.enter_station=this.enter_station,e.exit_station=this.exit_station,e.is_play_music=this.is_play_music,e.is_broadcast=this.is_broadcast,e.area_group=this.area_group,e.user_defined_params=this.user_defined_params,e.z=this.z,e.param_int=this.param_int,this.type===Kc.DISABLE_ROTATE&&(e.param_int=ih(this.param_int*i,4)),e.volume=this.volume,e.user_define_properties={...this.user_define_properties},e.oba_define_params={...this.oba_define_params};const{unload:a=0,load:s=0,rack:n=0}=this.limit_speeds;return e.limit_speeds={unload:a,load:s,rack:n,unload_unit:"m/s",load_unit:"m/s",rack_unit:"m/s"},e.rotate_yaw=this.rotate_yaw,e.limit_cars_number=this.limit_cars_number,e.light_params={...this.light_params},e.io_oba_params={...this.io_oba_params},e.camera_params={...this.camera_params},e}checkPos(){return{name:this.name,id:this.id,state:this.pa.x<this.pc.x&&this.pa.y>this.pc.y}}}class Dd extends Ld{constructor(t){super(t),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.style={fontSize:24,color:"rgb(0, 0, 255)",justifyContent:"left",alignItems:"top",backgroundColor:"rgb(0, 0, 92)",opacity:.25,z:100}}fromJson(t,e=!0){super.fromJson(t,e),this.style={...this.style,...t.style}}toJson(t=!0){return{...super.toJson(t),style:{...this.style}}}get fontColor(){return this.style.color}}class Nd extends Ld{constructor(t){super(t),Object.defineProperty(this,"key_text",{enumerable:!0,configurable:!0,writable:!0,value:"REGION"}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:ad.LIMIT_JUMP})}fromJson(t,e=!0){var i;super.fromJson(t,e),this.key_text=null!==(i=t.key_text)&&void 0!==i?i:"REGION",this.type=t.type}toJson(t=!0){return{...super.toJson(t),key_text:this.key_text,type:this.type}}get isLocationAreaNormalModel(){return"REGION"===this.key_text}}class kd extends Pd{constructor(t){super(t),Object.defineProperty(this,"startPos",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"endPos",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isStartPoint",{enumerable:!0,configurable:!0,writable:!0,value:(t,e)=>Math.abs(this.startPos.x-t)<Gc.RADIUS&&Math.abs(this.startPos.y-e)<Gc.RADIUS}),Object.defineProperty(this,"isEndPoint",{enumerable:!0,configurable:!0,writable:!0,value:(t,e)=>Math.abs(this.endPos.x-t)<Gc.RADIUS&&Math.abs(this.endPos.y-e)<Gc.RADIUS}),this.startPos=new Md(0,0,0),this.endPos=new Md(0,0,0)}fromJson(t,e=!0){let i=1;e&&(i=.1),this.id=t.id,this.startPos.setPos(ih(t.sx*i),ih(t.sy*i)),this.endPos.setPos(ih(t.ex*i),ih(t.ey*i))}toJson(t=!0){const e={};let i=1;return t&&(i=Sc),e.id=this.id,e.sx=ih(this.startPos.x*i),e.sy=ih(this.startPos.y*i),e.ex=ih(this.endPos.x*i),e.ey=ih(this.endPos.y*i),e}getYaw(){return th(this.startPos,this.endPos)}setStartPos(t){this.startPos.setPoint(t),this.setDirty(!0)}setEndPos(t){this.endPos.setPoint(t),this.setDirty(!0)}}class Fd extends Pd{constructor(t){super(t),Object.defineProperty(this,"pos",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pos=new Md(0,0,0)}setPos(t){this.pos.setPoint(t),this.setDirty(!0)}fromJson(t,e=!0){let i=1,a=1;e?(i=.1,a=1/Ic):this.setDirty(!0),this.id=t.id,this.pos.x=ih(t.x*i),this.pos.y=ih(t.y*i),this.pos.yaw=t.yaw*a,t.hasOwnProperty("desc")&&(this.desc=t.desc)}toJson(t=!0){const e={};let i=1,a=1;return t&&(i=Sc,a=Ic),e.id=this.id,e.desc=this.desc,e.x=ih(this.pos.x*i),e.y=ih(this.pos.y*i),e.yaw=ih(this.pos.yaw*a,4),e}getName(){return`n${this.id}`}}const $d=-.017453292519943295;class qd extends kd{constructor(t){super(t),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"s_node",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"e_node",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cPos",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dPos",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"radius",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"limit_v",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"limit_w",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"s_facing",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"e_facing",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rotate_direction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"is_back_edge",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"direction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cost",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"param",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user_defined_properties",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"robot_direction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"desc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"orientation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"path_behavior",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setStartNodeId",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.s_node=t,this.setDirty(!0)}}),Object.defineProperty(this,"setEndNodeId",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.e_node=t,this.setDirty(!0)}}),Object.defineProperty(this,"isStartNode",{enumerable:!0,configurable:!0,writable:!0,value:t=>t===this.s_node}),Object.defineProperty(this,"isEndNode",{enumerable:!0,configurable:!0,writable:!0,value:t=>t===this.e_node}),this.type=Yc.LINE,this.s_node=0,this.e_node=0,this.desc="",this.radius=0,this.limit_v=0,this.limit_w=0,this.s_facing=0,this.e_facing=0,this.rotate_direction=1,this.is_back_edge=!1,this.direction=1,this.cost=0,this.param=255,this.user_defined_properties=[],this.robot_direction=Qc.FORWARD,this.cPos=new Md(0,0,0),this.dPos=new Md(0,0,0),this.orientation=$d,this.path_behavior={type:Jc.Normal,trigger_stage:Zc.Normal,trigger_condition:{load_state:td.Normal}}}fromJson(t,e=!0){var i;super.fromJson(t,e);let a=1,s=1;if(e?(a=.1,s=1/Ic):this.setDirty(!0),this.s_node=t.s_node,this.e_node=t.e_node,this.cost=ih(t.cost*a),this.type=t.type,this.cPos.setPos(ih(t.cx*a),ih(t.cy*a)),this.dPos.setPos(ih(t.dx*a),ih(t.dy*a)),this.s_facing=t.s_facing*s,this.e_facing=t.e_facing*s,this.radius=ih(t.radius*a),this.limit_v=t.limit_v,this.limit_w=t.limit_w,this.rotate_direction=t.rotate_direction,this.is_back_edge=t.is_back_edge,this.direction=t.direction,this.param=t.param,t.hasOwnProperty("desc")&&(this.desc=t.desc),t.hasOwnProperty("robot_direction")?(this.robot_direction=t.robot_direction,this.robot_direction===Qc.BACKWARD?this.is_back_edge=!0:this.is_back_edge=!1):this.is_back_edge&&(this.robot_direction=Qc.BACKWARD),this.user_defined_properties=[],t.hasOwnProperty("user_define_properties")){const e=t.user_define_properties;for(const t in e)this.user_defined_properties.push({name:t,value:e[t]})}this.orientation=t.hasOwnProperty("orientation")?t.orientation:$d,this.path_behavior=null!==(i=t.path_behavior)&&void 0!==i?i:Uh(this.path_behavior)}toJson(t=!0){const e=super.toJson(t);let i=1,a=1;t&&(i=Sc,a=Ic),e.s_node=this.s_node,e.e_node=this.e_node,e.cost=ih(this.cost*i),e.type=this.type,e.desc=this.desc,e.cx=ih(this.cPos.x*i),e.cy=ih(this.cPos.y*i),e.dx=ih(this.dPos.x*i),e.dy=ih(this.dPos.y*i),e.radius=ih(this.radius*i),e.limit_v=this.limit_v,e.limit_w=this.limit_w,e.s_facing=this.s_facing*a,e.e_facing=this.e_facing*a,e.rotate_direction=this.rotate_direction,e.direction=this.direction,e.robot_direction=this.robot_direction,e.param=this.param,this.robot_direction===Qc.BACKWARD?e.is_back_edge=!0:e.is_back_edge=!1;const s={};for(const t of Array.from(this.user_defined_properties))s[t.name]=t.value;return e.user_define_properties=s,e.orientation=this.orientation,e.path_behavior=Uh(this.path_behavior),e}getName(){return`e${this.id}`}setType(t){this.type=t}setCPos(t){this.cPos.setPoint(t),this.setDirty(!0)}setDPos(t){this.dPos.setPoint(t),this.setDirty(!0)}setRobotDirection(t){this.robot_direction=t}setLineSpeedMax(t){this.limit_v=t}setAngularVelocityMax(t){this.limit_w=t}isEdgeLine(){return this.type===Yc.LINE}isEdgeBezier(){return this.type===Yc.BEZIER}}class Gd extends Pd{constructor(t){super(jc.EDGE_GROUP),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"edgeIds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"types",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user_define_properties",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"desc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=t,this.name="",this.desc="",this.edgeIds=[],this.types=[],this.user_define_properties={}}fromJson(t,e=!0){this.id=t.id,this.name=t.name,t.hasOwnProperty("edgeIds")&&(this.edgeIds=t.edgeIds),this.types=t.types,t.hasOwnProperty("desc")&&(this.desc=t.desc),t.hasOwnProperty("user_define_properties")&&(this.user_define_properties=t.user_define_properties)}toJson(t=!0){const e={};return e.id=this.id,e.desc=this.desc,e.name=this.name,e.edgeIds=this.edgeIds,e.types=this.types,e.user_define_properties=this.user_define_properties,e}setName(t){this.name=t}getName(){return this.name}hasEdge(t){return this.edgeIds.includes(t)}addEdge(t){this.edgeIds.includes(t)||this.edgeIds.push(t)}edgeId(t=0){return t<0||t>=this.edgeIds.length?0:this.edgeIds[t]}getEdgeIds(){return this.edgeIds}setTypes(t){this.types=t}getTypes(){return this.types}removeEdge(t){const e=this.edgeIds.indexOf(t);e<0||this.edgeIds.splice(e,1)}clear(){this.edgeIds=[]}}class Bd extends Pd{constructor(t){super(t),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pos",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"enter_pos",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exit_pos",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"check_pos",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"edge_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"node_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"no_rotate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"enter_backward",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exit_backward",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pos_dynamic",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"station_offset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user_defined_properties",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dmcode_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pgv_offset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"param",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wareroomAreaId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wareroomRegionId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wareroomLocationRow",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wareroomLocationColumn",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wareroomLocationStorey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=Uc.NORMAL,this.name="",this.pos=new Md(0,0,0),this.enter_pos=new Md(0,0,0),this.exit_pos=new Md(0,0,0),this.check_pos=new Md(0,0,0),this.edge_id=0,this.node_id=0,this.no_rotate=!1,this.enter_backward=!1,this.exit_backward=!1,this.pos_dynamic=!1,this.station_offset=0,this.user_defined_properties=[],this.dmcode_id="",this.pgv_offset=new Md(0,0,0),this.param=0,this.wareroomAreaId=0,this.wareroomRegionId=0,this.wareroomLocationRow=0,this.wareroomLocationColumn=0,this.wareroomLocationStorey=0}fromJson(t,e=!0){let i=1,a=1;e?(i=.1,a=1/Ic):this.setDirty(!0),this.id=t.id,this.type=t.type,this.name=t.name,this.pos.x=ih(t["pos.x"]*i),this.pos.y=ih(t["pos.y"]*i);let s=ih(t["pos.yaw"]*a,4);if(s%=2*Math.PI,s<0&&(s+=2*Math.PI),this.pos.yaw=s,this.enter_pos.x=ih(t["enter_pos.x"]*i),this.enter_pos.y=ih(t["enter_pos.y"]*i),this.enter_pos.yaw=ih(t["enter_pos.yaw"]*a,4),this.exit_pos.x=ih(t["exit_pos.x"]*i),this.exit_pos.y=ih(t["exit_pos.y"]*i),this.exit_pos.yaw=ih(t["exit_pos.yaw"]*a,4),this.check_pos.x=ih(t["check_pos.x"]*i),this.check_pos.y=ih(t["check_pos.y"]*i),this.check_pos.yaw=ih(t["check_pos.yaw"]*a,4),this.no_rotate=t.no_rotate,this.enter_backward=t.enter_backward,this.exit_backward=t.exit_backward,this.pos_dynamic=t.pos_dynamic,this.station_offset=ih(t.station_offset),this.edge_id=t.edge_id,this.node_id=t.node_id||0,this.user_defined_properties=[],t.hasOwnProperty("user_define_properties")){const e=t.user_define_properties;for(const t in e)this.user_defined_properties.push({name:t,value:e[t]})}t.hasOwnProperty("dmcode_id")&&(this.dmcode_id=t.dmcode_id),t.hasOwnProperty("pgv_offset.x")&&(this.pgv_offset.x=ih(t["pgv_offset.x"]*i),this.pgv_offset.y=ih(t["pgv_offset.y"]*i),this.pgv_offset.yaw=ih(t["pgv_offset.yaw"]*a,4)),t.hasOwnProperty("desc")&&(this.desc=t.desc),this.param=t.param,this.wareroomAreaId=t.wareroomAreaId||0,this.wareroomRegionId=t.wareroomRegionId||0,this.wareroomLocationRow=t.wareroomLocationRow||0,this.wareroomLocationColumn=t.wareroomLocationColumn||0,this.wareroomLocationStorey=t.wareroomLocationStorey||0}toJson(t=!0){const e={};let i=1,a=1;t&&(i=Sc,a=Ic),e.id=this.id,e.type=this.type,e.name=this.name,e.desc=this.desc,e["pos.x"]=ih(this.pos.x*i),e["pos.y"]=ih(this.pos.y*i);let s=this.pos.yaw;s%=2*Math.PI,s<0&&(s+=2*Math.PI),e["pos.yaw"]=ih(s*a,4),e["enter_pos.x"]=ih(this.enter_pos.x*i),e["enter_pos.y"]=ih(this.enter_pos.y*i),e["enter_pos.yaw"]=ih(this.enter_pos.yaw*a,4),e["exit_pos.x"]=ih(this.exit_pos.x*i),e["exit_pos.y"]=ih(this.exit_pos.y*i),e["exit_pos.yaw"]=ih(this.exit_pos.yaw*a,4),e["check_pos.x"]=ih(this.check_pos.x*i),e["check_pos.y"]=ih(this.check_pos.y*i),e["check_pos.yaw"]=ih(this.check_pos.yaw*a,4),e.no_rotate=this.no_rotate,e.enter_backward=this.enter_backward,e.exit_backward=this.exit_backward,e.pos_dynamic=this.pos_dynamic,e.station_offset=this.station_offset,e.edge_id=this.edge_id,e.node_id=this.node_id;const n={};for(const t of Array.from(this.user_defined_properties))n[t.name]=t.value;return e.user_define_properties=n,e.dmcode_id=this.dmcode_id,e["pgv_offset.x"]=ih(this.pgv_offset.x*i),e["pgv_offset.y"]=ih(this.pgv_offset.y*i),e["pgv_offset.yaw"]=ih(this.pgv_offset.yaw*a,4),e.param=this.param,e.wareroomAreaId=this.wareroomAreaId,e.wareroomRegionId=this.wareroomRegionId,e.wareroomLocationRow=this.wareroomLocationRow,e.wareroomLocationColumn=this.wareroomLocationColumn,e.wareroomLocationStorey=this.wareroomLocationStorey,e}getName(){return this.name}setName(t){this.name=t}isEnterPosNull(){return 0===this.enter_pos.x&&0===this.enter_pos.y}isExitPosNull(){return 0===this.exit_pos.x&&0===this.exit_pos.y}isCheckPosNull(){return 0===this.check_pos.x&&0===this.check_pos.y}isChargeStation(){return this.type===Uc.CHARGE}setPos(t){this.pos.setPoint(t),this.setDirty(!0)}getPos(){return{x:this.pos.x,y:this.pos.y}}setYaw(t){this.pos.setYaw(t),this.setDirty(!0)}setEdgeId(t){this.edge_id=t}setNodeId(t){this.node_id=t}getDMCodeID(){return this.dmcode_id}setDMCodeOffset(t,e,i,a){this.dmcode_id=t,this.pgv_offset.x=e,this.pgv_offset.y=i,this.pgv_offset.yaw=a,this.setDirty(!0)}setNoRotate(t){this.no_rotate=t,this.setDirty(!0)}setPosDynamic(t){this.pos_dynamic=t,this.setDirty(!0)}isNoRotate(){return this.no_rotate}isPosDynamic(){return this.pos_dynamic}}class jd extends Pd{constructor(t){super(t),Object.defineProperty(this,"sx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ex",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.sx=0,this.sy=0,this.ex=0,this.ey=0,this.name=""}getName(){return`b${this.id}`}setStartPoint(t){this.sx=t.x,this.sy=t.y}setEndPoint(t){this.ex=t.x,this.ey=t.y}}class Ud extends Pd{constructor(t){super(t),Object.defineProperty(this,"stationId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pos",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"featureType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"featureName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sensorName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setData",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.pos=t.pos,this.featureType=t.featureType,this.featureName=t.featureName,this.sensorName=t.sensorName}}),this.stationId=0,this.pos={x:0,y:0,z:0,yaw:0,pitch:0,roll:0},this.featureType=id.NONE,this.featureName=ed.NONE,this.sensorName=""}fromJson(t,e=!0){let i=1;e?i=1/Ic:this.setDirty(!0),this.id=t.id,this.stationId=t.station_id,this.featureType=t.feature_type,this.featureName=t.feature_name,this.sensorName=t.sensor_name,this.pos.x=ih(t["pos.x"]*i),this.pos.y=ih(t["pos.y"]*i),this.pos.z=ih(t["pos.z"]*i),this.pos.yaw=1*t["pos.yaw"],this.pos.pitch=1*t["pos.pitch"],this.pos.yaw=1*t["pos.roll"]}toJson(t=!0){const e={};let i=1;return t&&(i=Ic),e.id=this.id,e.station_id=this.stationId,e.feature_type=this.featureType,e.feature_name=this.featureName,e.sensor_name=this.sensorName,e["pos.x"]=ih(this.pos.x*i),e["pos.y"]=ih(this.pos.y*i),e["pos.z"]=ih(this.pos.z*i),e["pos.yaw"]=ih(1*this.pos.yaw,4),e["pos.pitch"]=ih(1*this.pos.pitch,4),e["pos.roll"]=ih(1*this.pos.roll,4),e}getName(){return`n${this.id}`}setStationId(t){this.stationId=t}}class Yd extends Pd{constructor(t){super(t),Object.defineProperty(this,"weight",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"damaged",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pos",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"recorded",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.weight=1,this.recorded=!1,this.damaged=!1,this.pos=new Md(0,0,0),this.type=Hc.NONE}fromJson(t,e=!0){let i=1,a=1;e&&(i=.1,a=1/Ic),t.hasOwnProperty("dmcode_id")?this.id=t.dmcode_id:this.id=t.id,this.pos.x=ih(t.x*i),this.pos.y=ih(t.y*i),this.pos.yaw=ih(t.yaw*a),t.hasOwnProperty("weight")&&(this.weight=t.weight),t.hasOwnProperty("damaged")&&(this.damaged=t.damaged),t.hasOwnProperty("recorded")&&(this.recorded=t.recorded),this.type=void 0===t.type?Hc.STATION_CORRECTION:t.type}toJson(t=!0){const e={};let i=1,a=1;return t&&(i=Sc,a=Ic),e.id=0,e.dmcode_id=this.id,e.type=this.type,e.x=ih(this.pos.x*i),e.y=ih(this.pos.y*i),e.yaw=ih(this.pos.yaw*a,4),this.isQRCodeTypeFuseLocate()&&(e.damaged=this.damaged,e.weight=this.weight,e.recorded=this.recorded),e}setPos(t){this.pos.x=t.x,this.pos.y=t.y,this.pos.yaw=t.yaw}getYaw(){return this.pos.yaw}setId(t){this.id=t}setType(t){this.type=t}getName(){let t="";switch(this.type){case Hc.FUSE_LOCATE:t="FLQR";break;case Hc.TEXTURE_LOCATE:t="WLQR";break;case Hc.STATION_CORRECTION:t="SCQR";break;default:t="UKQR"}return t+this.getID()}isQRCodeTypeStationCorrect(){return this.type===Hc.STATION_CORRECTION}isQRCodeTypeFuseLocate(){return this.type===Hc.FUSE_LOCATE}}class zd extends Pd{constructor(t){super(t),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=""}fromJson(t){this.id=t.id,this.name=t.name}toJson(){const t={};return t.name=this.name,t.id=this.id,t}}class Vd extends zd{constructor(t){super(t),Object.defineProperty(this,"wareroomAreaId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.wareroomAreaId=0}fromJson(t){super.fromJson(t),this.wareroomAreaId=t.wareroomAreaId}toJson(){const t=super.toJson();return t.wareroomAreaId=this.wareroomAreaId,t}}const Wd="1.7.0";class Hd{constructor(){Object.defineProperty(this,"_mapUnitIsMM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_mapLengthUnit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_mapAngleUnit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_mapCreateTime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_mapModifyTime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_mapOffset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_mapSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_mapResolution",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_imageScale",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_mapJsonVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_edgeDataList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nodeDataList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_featureDataList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_stationFeatureBind",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tagDataList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_stationDataList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_funcAreaDataList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_noteAreaDataList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_locationAreaDataList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_cleanAreaDataList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_redrawAreaDataList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_dmCodeDataList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_edgeGroupDataList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_wareroomAreaList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_wareroomRegionList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_originalData",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"deleteNode",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.deleteModel(t,this._nodeDataList)}}),Object.defineProperty(this,"deleteFeature",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.deleteModel(t,this._featureDataList)}}),Object.defineProperty(this,"deleteTag",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.deleteModel(t,this._tagDataList)}}),Object.defineProperty(this,"deleteStation",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.deleteModel(t,this._stationDataList)}}),Object.defineProperty(this,"deleteEdge",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.deleteModel(t,this._edgeDataList)}}),Object.defineProperty(this,"deleteFuncArea",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.deleteModel(t,this._funcAreaDataList)}}),Object.defineProperty(this,"deleteNoteArea",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.deleteModel(t,this._noteAreaDataList)}}),Object.defineProperty(this,"deleteLocationArea",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.deleteModel(t,this._locationAreaDataList)}}),Object.defineProperty(this,"deleteCleanArea",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.deleteModel(t,this._cleanAreaDataList)}}),Object.defineProperty(this,"deleteDMCode",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.deleteModel(t,this._dmCodeDataList)}}),Object.defineProperty(this,"deleteModel",{enumerable:!0,configurable:!0,writable:!0,value:(t,e)=>{let i=-1;for(let a=0;a<e.length;a++)if(e[a].id===t){i=a;break}i>=0&&e.splice(i,1)}}),this._mapUnitIsMM=!0,this._mapLengthUnit="",this._mapAngleUnit="",this._mapCreateTime=0,this._mapModifyTime=0,this._mapOffset={x:3071,y:2047},this._mapSize={x:5120,y:3072},this._mapResolution=2,this._imageScale=[],this._mapJsonVersion=Wd,this._edgeDataList=[],this._nodeDataList=[],this._featureDataList=[],this._stationFeatureBind=[],this._tagDataList=[],this._stationDataList=[],this._funcAreaDataList=[],this._noteAreaDataList=[],this._locationAreaDataList=[],this._cleanAreaDataList=[],this._redrawAreaDataList=[],this._dmCodeDataList=[],this._edgeGroupDataList=[],this._wareroomAreaList=[],this._wareroomRegionList=[],this._originalData={}}resetMapModel(t=!0){this._mapUnitIsMM=!0,this._mapOffset.x=3071,this._mapOffset.y=2047,this._mapSize.x=5120,this._mapSize.y=3072,this._mapResolution=2,this._imageScale=[],this._edgeDataList=[],this._nodeDataList=[],this._featureDataList=[],this._stationFeatureBind=[],this._tagDataList=[],this._stationDataList=[],this._funcAreaDataList=[],this._noteAreaDataList=[],this._locationAreaDataList=[],this._cleanAreaDataList=[],this._redrawAreaDataList=[],this._dmCodeDataList=[],this._edgeGroupDataList=[],this._wareroomAreaList=[],this._wareroomRegionList=[],t&&this.updateOriginalData({})}updateOriginalData(t){this._originalData=JSON.parse(JSON.stringify(t))}isMapDataChanged(){return JSON.stringify(this.saveToJson())!==JSON.stringify(this._originalData)}removeCleanAreaList(){this._cleanAreaDataList=[]}restoreFromOriginDat(){this.loadFromJson(this._originalData,!0,!0)}getOriginalAreaUserDefinedParams(t){var e;return(null===(e=this._originalData.data.area.find(e=>e.id===t))||void 0===e?void 0:e.user_defined_params)||[]}loadFromJson(t,e=!1,i=!0){this.resetMapModel(i);const a=t.data,s=t.meta;if(!a||!s)return!1;this._mapOffset.x=s["zero_offset.x"],this._mapOffset.y=s["zero_offset.y"],this._mapSize.x=s["size.x"],this._mapSize.y=s["size.y"],s.hasOwnProperty("resolution")&&(this._mapResolution=s.resolution),s.hasOwnProperty("image_scale")&&(this._imageScale=s.image_scale),s.hasOwnProperty("length_unit")&&(this._mapUnitIsMM=!0,this._mapLengthUnit=s.length_unit,this._mapAngleUnit=s.angle_unit,this._mapCreateTime=s.created_timestamp,this._mapModifyTime=s.modified_timestamp),this._mapJsonVersion=s.version||Wd,this.fromJsonArray(a.area||[],jc.FUNC_AREA),this.fromJsonArray(a.noteArea||[],jc.NOTE_AREA),this.fromJsonArray(a.locationArea||[],jc.LOCATION_AREA),this.fromJsonArray(a.node||[],jc.NODE),this.fromJsonArray(a.edge||[],jc.EDGE),this.fromJsonArray(a.station||[],jc.STATION),this.fromJsonArray(a.feature||[],jc.FEATURE),this.fromJsonArray(a.tag||[],jc.TAG),this.fromJsonArray(a.dmcode||[],jc.DMCODE),this.fromJsonArray(a.edgeGroup||[],jc.EDGE_GROUP);const n={wareroomArea:[],wareroomRegion:[],...a.wareroom||{}};this.fromJsonArray(n.wareroomArea,jc.WAREROOM_AREA),this.fromJsonArray(n.wareroomRegion,jc.WAREROOM_REGION);const o={fuseLocateQRCode:[],cleanArea:[],redrawArea:[],...t.private||{}};return this.fromJsonArray(o.fuseLocateQRCode,jc.DMCODE),this.fromJsonArray(o.redrawArea,jc.REDRAW_AREA),e&&this.fromJsonArray(o.cleanArea,jc.CLEAN_AREA),i&&this.updateOriginalData(this.saveToJson()),!0}saveToJson(){const t={},e={};e["zero_offset.x"]=this._mapOffset.x,e["zero_offset.y"]=this._mapOffset.y,e["size.x"]=this._mapSize.x,e["size.y"]=this._mapSize.y,e.resolution=this._mapResolution,e.image_scale=this._imageScale,e.length_unit=this._mapLengthUnit,e.angle_unit=this._mapAngleUnit,e.created_timestamp=this._mapCreateTime,e.modified_timestamp=this._mapModifyTime,e.version="1.12.6";const i={};i.area=this.toJson(this._funcAreaDataList),i.noteArea=this.toJson(this._noteAreaDataList),i.locationArea=this.toJson(this._locationAreaDataList),i.node=this.toJson(this._nodeDataList),i.tag=this.toJson(this._tagDataList),i.edge=this.toJson(this._edgeDataList),i.station=this.toJson(this._stationDataList),i.dmcode=this.toJson(this._dmCodeDataList.filter(t=>t.isQRCodeTypeStationCorrect())),i.edgeGroup=this.toJson(this._edgeGroupDataList),i.feature=this.toJson(this._featureDataList);const a={};a.wareroomArea=this.toJson(this._wareroomAreaList),a.wareroomRegion=this.toJson(this._wareroomRegionList),i.wareroom=a;const s={};return s.cleanArea=this.toJson(this._cleanAreaDataList),s.fuseLocateQRCode=this.toJson(this._dmCodeDataList.filter(t=>t.isQRCodeTypeFuseLocate())),s.redrawArea=this.toJson(this._redrawAreaDataList),t.meta=e,t.data=i,t.private=s,t}toJson(t){return t.map(t=>t.toJson())}imageScaling(){let t=this._mapSize.x*this._mapResolution/100*(this._mapSize.y*this._mapResolution/100)/2e4;if(t<1||this._imageScale.length<=0)return 1;const e=Math.sqrt(t);t=this._imageScale[this._imageScale.length-2];for(let i=this._imageScale.length-2;i>=0;i--){const a=this._imageScale[i];e<=a&&(t=a)}return 1/t}fromJsonArray(t,e){if(!t)return null;t.forEach(t=>{const i=this.createModel(e);i&&i.fromJson(t,this._mapUnitIsMM)})}createModel(t){let e=null,i=0;switch(t){case jc.FUNC_AREA:e=new Rd(t),i=this.createId(this._funcAreaDataList),this._funcAreaDataList.push(e);break;case jc.NOTE_AREA:e=new Dd(t),i=this.createId(this._noteAreaDataList),this._noteAreaDataList.push(e);break;case jc.LOCATION_AREA:e=new Nd(t),i=this.createId(this._locationAreaDataList),this._locationAreaDataList.push(e);break;case jc.CLEAN_AREA:e=new Ld(t),i=this.createId(this._cleanAreaDataList),this._cleanAreaDataList.push(e);break;case jc.REDRAW_AREA:e=new Ld(t),i=this.createId(this._redrawAreaDataList),this._redrawAreaDataList.push(e);break;case jc.SELECTION_AREA:e=new Ld(t),i=this.createId([]);break;case jc.EDGE:i=this.createId(this._edgeDataList),e=new qd(t),this._edgeDataList.push(e);break;case jc.NODE:i=this.createId(this._nodeDataList),e=new Fd(t),this._nodeDataList.push(e);break;case jc.FEATURE:i=this.createId(this._featureDataList),e=new Ud(t),this._featureDataList.push(e);break;case jc.STATION_FEATURE_BIND:i=this.createId(this._stationFeatureBind),e=new jd(t),this._stationFeatureBind.push(e);break;case jc.TAG:i=this.createId(this._tagDataList),e=new Od(t),this._tagDataList.push(e);break;case jc.DMCODE:i=0,e=new Yd(t),this._dmCodeDataList.push(e);break;case jc.STATION:i=this.createId(this._stationDataList),e=new Bd(t),this._stationDataList.push(e);break;case jc.EDGE_GROUP:i=this.createId(this._edgeGroupDataList),e=new Gd(i),this._edgeGroupDataList.push(e);break;case jc.WAREROOM_AREA:i=this.createId(this._wareroomAreaList),e=new zd(i),this._wareroomAreaList.push(e);break;case jc.WAREROOM_REGION:i=this.createId(this._wareroomRegionList),e=new Vd(i),this._wareroomRegionList.push(e)}return e&&(e.id=i),e}createId(t){let e=0;return t.forEach(t=>{t.id>=e&&(e=t.id)}),++e}stationModel(t){return this.itemModel(t,this._stationDataList)}nodeModel(t){return this.itemModel(t,this._nodeDataList)}featureModel(t){return this.itemModel(t,this._featureDataList)}tagModel(t){return this.itemModel(t,this._tagDataList)}funcAreaModel(t){return this.itemModel(t,this._funcAreaDataList)}noteAreaModel(t){return this.itemModel(t,this._noteAreaDataList)}locationAreaModel(t){return this.itemModel(t,this._locationAreaDataList)}edgeModel(t){return this.itemModel(t,this._edgeDataList)}edgeGroupModel(t){return this.itemModel(t,this._edgeGroupDataList)}dmCodeModel(t){return this.itemModel(t,this._dmCodeDataList)}itemModel(t,e){for(let i=0;i<e.length;i++)if(e[i].getID()===t)return e[i];return null}deleteEdgeGroup(t){this.deleteModel(t,this._edgeGroupDataList)}}const Kd=new md;function Qd(t,e,i,a=0,s=50){if(a+1>e)return;const n=Math.min(e,a+s);window.requestAnimationFrame?i.push(window.requestAnimationFrame(()=>{t.call(this,a,n),Qd(t,e,i,n,s)})):t.call(this,a,e)}function Xd(t=6){return Math.random().toString(36).slice(-t)}new Td({autoPlace:!1});const Jd=t=>t*Math.PI/180,Zd=t=>180*t/Math.PI;function th(t,e){const i=e.subtract(t),a=Math.sqrt(i.x**2+i.y**2);let s=a?Math.acos(i.x/a):0;return i.y<0&&(s=2*Math.PI-s),s}function eh(t,e){return window.getTranslationStd?window.getTranslationStd(t,e):t.split(".")[1]}function ih(t,e=2){return Number.parseFloat(t.toFixed(e))}function ah(t,e){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function sh(t,e,i=1){return ah(t,e)<=i}function nh(t,e,i=1){const a=t.dataModel.pos;return sh(a,e.dataModel.startPos,i)?{poleType:zc.START,itemEdge:e}:sh(a,e.dataModel.endPos,i)?{poleType:zc.END,itemEdge:e}:e.dataModel.isEdgeLine()&&sh(a,oh(e.dataModel.startPos,e.dataModel.endPos,a),i)?{poleType:zc.C,itemEdge:e}:{poleType:zc.NONE,itemEdge:e}}function oh(t,e,i){const a=e.x-t.x,s=e.y-t.y;if(0===a&&0===s)return t;const n=((i.x-t.x)*a+(i.y-t.y)*s)/(a*a+s*s);return n<0?new Md(t.x,t.y):n>1?new Md(e.x,e.y):new Md(t.x+n*a,t.y+n*s)}function rh(t=[],e=[],i=rd.MINUS){const a=new Set(t),s=new Set(e);switch(i){case rd.INTERSECT:return t.filter(t=>s.has(t));case rd.MINUS:return t.filter(t=>!s.has(t));case rd.COMPLEMENT:return[...t.filter(t=>!s.has(t)),...e.filter(t=>!a.has(t))];case rd.UNION:return Array.from(new Set([...t,...e]));default:return[]}}function lh(t,e){return Math.abs(t-e)<Number.EPSILON}const ch=[Kc.FORBID_ENTRY,Kc.LIMIT_SPEEDS,Kc.SPEED_LEVEL_20,Kc.SPEED_LEVEL_40,Kc.SPEED_LEVEL_60,Kc.SPEED_LEVEL_80,Kc.DISABLE_OBA,Kc.LOCAL_REPLAN,Kc.DISABLE_ROTATE,Kc.DISABLE_RACK_AUTO_CORRECT,Kc.WORKSPACE_OBA,Kc.LANE_LINE_AUXILIARY_LOCATE,Kc.IO_OBA,Kc.LIGHT_CTRL,Kc.LIMIT_STOP,Kc.CAMERA_CONTROL];function dh(t=0){return{[Kc.FORBID_ENTRY]:eh("label.regionTypeForbidden"),[Kc.LIMIT_SPEEDS]:eh("label.regionTypeLimitSpeeds"),[Kc.SPEED_LEVEL_20]:eh("label.slowDownTo",{level:20}),[Kc.SPEED_LEVEL_40]:eh("label.slowDownTo",{level:40}),[Kc.SPEED_LEVEL_60]:eh("label.slowDownTo",{level:60}),[Kc.SPEED_LEVEL_80]:eh("label.slowDownTo",{level:80}),[Kc.DISABLE_OBA]:eh("label.regionTypeDisableOba"),[Kc.LOCAL_REPLAN]:eh("label.regionTypeLocalReplan"),[Kc.DISABLE_ROTATE]:eh("label.regionTypeLimitRotate"),[Kc.DISABLE_RACK_AUTO_CORRECT]:eh("label.disableRackAutoCorrectRegion"),[Kc.WORKSPACE_OBA]:eh("label.workspaceAvoidRegion"),[Kc.LANE_LINE_AUXILIARY_LOCATE]:eh("label.laneLineAuxiliaryLocateRegion"),[Kc.IO_OBA]:eh("label.ioAvoidRegion"),[Kc.LIGHT_CTRL]:eh("label.lightControlRegion"),[Kc.LIMIT_STOP]:eh("label.limitStopRegion"),[Kc.CAMERA_CONTROL]:eh("label.cameraControlRegion"),[Kc.USER_DEFINE]:eh("label.regionTypeUserDefined")}[t]||""}const{abs:hh,cos:uh,sin:ph,acos:mh,atan2:fh,sqrt:gh,pow:_h}=Math;function yh(t){return t<0?-_h(-t,1/3):_h(t,1/3)}const vh=Math.PI,bh=2*vh,Eh=vh/2,Ah=Number.MAX_SAFE_INTEGER||9007199254740991,wh=Number.MIN_SAFE_INTEGER||-9007199254740991,Sh={x:0,y:0,z:0},Ch={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,e){const i=e(t);let a=i.x*i.x+i.y*i.y;return void 0!==i.z&&(a+=i.z*i.z),gh(a)},compute:function(t,e,i){if(0===t)return e[0].t=0,e[0];const a=e.length-1;if(1===t)return e[a].t=1,e[a];const s=1-t;let n=e;if(0===a)return e[0].t=t,e[0];if(1===a){const e={x:s*n[0].x+t*n[1].x,y:s*n[0].y+t*n[1].y,t:t};return i&&(e.z=s*n[0].z+t*n[1].z),e}if(a<4){let e,o,r,l=s*s,c=t*t,d=0;2===a?(n=[n[0],n[1],n[2],Sh],e=l,o=s*t*2,r=c):3===a&&(e=l*s,o=l*t*3,r=s*c*3,d=t*c);const h={x:e*n[0].x+o*n[1].x+r*n[2].x+d*n[3].x,y:e*n[0].y+o*n[1].y+r*n[2].y+d*n[3].y,t:t};return i&&(h.z=e*n[0].z+o*n[1].z+r*n[2].z+d*n[3].z),h}const o=JSON.parse(JSON.stringify(e));for(;o.length>1;){for(let e=0;e<o.length-1;e++)o[e]={x:o[e].x+(o[e+1].x-o[e].x)*t,y:o[e].y+(o[e+1].y-o[e].y)*t},void 0!==o[e].z&&(o[e].z=o[e].z+(o[e+1].z-o[e].z)*t);o.splice(o.length-1,1)}return o[0].t=t,o[0]},computeWithRatios:function(t,e,i,a){const s=1-t,n=i,o=e;let r,l=n[0],c=n[1],d=n[2],h=n[3];return l*=s,c*=t,2===o.length?(r=l+c,{x:(l*o[0].x+c*o[1].x)/r,y:(l*o[0].y+c*o[1].y)/r,z:!!a&&(l*o[0].z+c*o[1].z)/r,t:t}):(l*=s,c*=2*s,d*=t*t,3===o.length?(r=l+c+d,{x:(l*o[0].x+c*o[1].x+d*o[2].x)/r,y:(l*o[0].y+c*o[1].y+d*o[2].y)/r,z:!!a&&(l*o[0].z+c*o[1].z+d*o[2].z)/r,t:t}):(l*=s,c*=1.5*s,d*=3*s,h*=t*t*t,4===o.length?(r=l+c+d+h,{x:(l*o[0].x+c*o[1].x+d*o[2].x+h*o[3].x)/r,y:(l*o[0].y+c*o[1].y+d*o[2].y+h*o[3].y)/r,z:!!a&&(l*o[0].z+c*o[1].z+d*o[2].z+h*o[3].z)/r,t:t}):void 0))},derive:function(t,e){const i=[];for(let a=t,s=a.length,n=s-1;s>1;s--,n--){const t=[];for(let i,s=0;s<n;s++)i={x:n*(a[s+1].x-a[s].x),y:n*(a[s+1].y-a[s].y)},e&&(i.z=n*(a[s+1].z-a[s].z)),t.push(i);i.push(t),a=t}return i},between:function(t,e,i){return e<=t&&t<=i||Ch.approximately(t,e)||Ch.approximately(t,i)},approximately:function(t,e,i){return hh(t-e)<=(i||1e-6)},length:function(t){const e=Ch.Tvalues.length;let i=0;for(let a,s=0;s<e;s++)a=.5*Ch.Tvalues[s]+.5,i+=Ch.Cvalues[s]*Ch.arcfn(a,t);return.5*i},map:function(t,e,i,a,s){return a+(t-e)/(i-e)*(s-a)},lerp:function(t,e,i){const a={x:e.x+t*(i.x-e.x),y:e.y+t*(i.y-e.y)};return void 0!==e.z&&void 0!==i.z&&(a.z=e.z+t*(i.z-e.z)),a},pointToString:function(t){let e=t.x+"/"+t.y;return void 0!==t.z&&(e+="/"+t.z),e},pointsToString:function(t){return"["+t.map(Ch.pointToString).join(", ")+"]"},copy:function(t){return JSON.parse(JSON.stringify(t))},angle:function(t,e,i){const a=e.x-t.x,s=e.y-t.y,n=i.x-t.x,o=i.y-t.y;return fh(a*o-s*n,a*n+s*o)},round:function(t,e){const i=""+t,a=i.indexOf(".");return parseFloat(i.substring(0,a+1+e))},dist:function(t,e){const i=t.x-e.x,a=t.y-e.y;return gh(i*i+a*a)},closest:function(t,e){let i,a,s=_h(2,63);return t.forEach(function(t,n){a=Ch.dist(e,t),a<s&&(s=a,i=n)}),{mdist:s,mpos:i}},abcratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const i=_h(t,e)+_h(1-t,e);return hh((i-1)/i)},projectionratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const i=_h(1-t,e);return i/(_h(t,e)+i)},lli8:function(t,e,i,a,s,n,o,r){const l=(t-i)*(n-r)-(e-a)*(s-o);return 0!=l&&{x:((t*a-e*i)*(s-o)-(t-i)*(s*r-n*o))/l,y:((t*a-e*i)*(n-r)-(e-a)*(s*r-n*o))/l}},lli4:function(t,e,i,a){const s=t.x,n=t.y,o=e.x,r=e.y,l=i.x,c=i.y,d=a.x,h=a.y;return Ch.lli8(s,n,o,r,l,c,d,h)},lli:function(t,e){return Ch.lli4(t,t.c,e,e.c)},makeline:function(t,e){return new Nh(t.x,t.y,(t.x+e.x)/2,(t.y+e.y)/2,e.x,e.y)},findbbox:function(t){let e=Ah,i=Ah,a=wh,s=wh;return t.forEach(function(t){const n=t.bbox();e>n.x.min&&(e=n.x.min),i>n.y.min&&(i=n.y.min),a<n.x.max&&(a=n.x.max),s<n.y.max&&(s=n.y.max)}),{x:{min:e,mid:(e+a)/2,max:a,size:a-e},y:{min:i,mid:(i+s)/2,max:s,size:s-i}}},shapeintersections:function(t,e,i,a,s){if(!Ch.bboxoverlap(e,a))return[];const n=[],o=[t.startcap,t.forward,t.back,t.endcap],r=[i.startcap,i.forward,i.back,i.endcap];return o.forEach(function(e){e.virtual||r.forEach(function(a){if(a.virtual)return;const o=e.intersects(a,s);o.length>0&&(o.c1=e,o.c2=a,o.s1=t,o.s2=i,n.push(o))})}),n},makeshape:function(t,e,i){const a=e.points.length,s=t.points.length,n=Ch.makeline(e.points[a-1],t.points[0]),o=Ch.makeline(t.points[s-1],e.points[0]),r={startcap:n,forward:t,back:e,endcap:o,bbox:Ch.findbbox([n,t,e,o]),intersections:function(t){return Ch.shapeintersections(r,r.bbox,t,t.bbox,i)}};return r},getminmax:function(t,e,i){if(!i)return{min:0,max:0};let a,s,n=Ah,o=wh;-1===i.indexOf(0)&&(i=[0].concat(i)),-1===i.indexOf(1)&&i.push(1);for(let r=0,l=i.length;r<l;r++)a=i[r],s=t.get(a),s[e]<n&&(n=s[e]),s[e]>o&&(o=s[e]);return{min:n,mid:(n+o)/2,max:o,size:o-n}},align:function(t,e){const i=e.p1.x,a=e.p1.y,s=-fh(e.p2.y-a,e.p2.x-i);return t.map(function(t){return{x:(t.x-i)*uh(s)-(t.y-a)*ph(s),y:(t.x-i)*ph(s)+(t.y-a)*uh(s)}})},roots:function(t,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};const i=t.length-1,a=Ch.align(t,e),s=function(t){return 0<=t&&t<=1};if(2===i){const t=a[0].y,e=a[1].y,i=a[2].y,n=t-2*e+i;if(0!==n){const a=-gh(e*e-t*i),o=-t+e;return[-(a+o)/n,-(-a+o)/n].filter(s)}return e!==i&&0===n?[(2*e-i)/(2*e-2*i)].filter(s):[]}const n=a[0].y,o=a[1].y,r=a[2].y;let l=3*o-n-3*r+a[3].y,c=3*n-6*o+3*r,d=-3*n+3*o,h=n;if(Ch.approximately(l,0)){if(Ch.approximately(c,0))return Ch.approximately(d,0)?[]:[-h/d].filter(s);const t=gh(d*d-4*c*h),e=2*c;return[(t-d)/e,(-d-t)/e].filter(s)}c/=l,d/=l,h/=l;const u=(3*d-c*c)/3,p=u/3,m=(2*c*c*c-9*c*d+27*h)/27,f=m/2,g=f*f+p*p*p;let _,y,v,b,E;if(g<0){const t=-u/3,e=gh(t*t*t),i=-m/(2*e),a=mh(i<-1?-1:i>1?1:i),n=2*yh(e);return v=n*uh(a/3)-c/3,b=n*uh((a+bh)/3)-c/3,E=n*uh((a+2*bh)/3)-c/3,[v,b,E].filter(s)}if(0===g)return _=f<0?yh(-f):-yh(f),v=2*_-c/3,b=-_-c/3,[v,b].filter(s);{const t=gh(g);return _=yh(-f+t),y=yh(f+t),[_-y-c/3].filter(s)}},droots:function(t){if(3===t.length){const e=t[0],i=t[1],a=t[2],s=e-2*i+a;if(0!==s){const t=-gh(i*i-e*a),n=-e+i;return[-(t+n)/s,-(-t+n)/s]}return i!==a&&0===s?[(2*i-a)/(2*(i-a))]:[]}if(2===t.length){const e=t[0],i=t[1];return e!==i?[e/(e-i)]:[]}return[]},curvature:function(t,e,i,a,s){let n,o,r,l,c=0,d=0;const h=Ch.compute(t,e),u=Ch.compute(t,i),p=h.x*h.x+h.y*h.y;if(a?(n=gh(_h(h.y*u.z-u.y*h.z,2)+_h(h.z*u.x-u.z*h.x,2)+_h(h.x*u.y-u.x*h.y,2)),o=_h(p+h.z*h.z,1.5)):(n=h.x*u.y-h.y*u.x,o=_h(p,1.5)),0===n||0===o)return{k:0,r:0};if(c=n/o,d=o/n,!s){const s=Ch.curvature(t-.001,e,i,a,!0).k,n=Ch.curvature(t+.001,e,i,a,!0).k;l=(n-c+(c-s))/2,r=(hh(n-c)+hh(c-s))/2}return{k:c,r:d,dk:l,adk:r}},inflections:function(t){if(t.length<4)return[];const e=Ch.align(t,{p1:t[0],p2:t.slice(-1)[0]}),i=e[2].x*e[1].y,a=e[3].x*e[1].y,s=e[1].x*e[2].y,n=18*(-3*i+2*a+3*s-e[3].x*e[2].y),o=18*(3*i-a-3*s),r=18*(s-i);if(Ch.approximately(n,0)){if(!Ch.approximately(o,0)){let t=-r/o;if(0<=t&&t<=1)return[t]}return[]}const l=2*n;if(Ch.approximately(l,0))return[];const c=o*o-4*n*r;if(c<0)return[];const d=Math.sqrt(c);return[(d-o)/l,-(o+d)/l].filter(function(t){return 0<=t&&t<=1})},bboxoverlap:function(t,e){const i=["x","y"],a=i.length;for(let s,n,o,r,l=0;l<a;l++)if(s=i[l],n=t[s].mid,o=e[s].mid,r=(t[s].size+e[s].size)/2,hh(n-o)>=r)return!1;return!0},expandbox:function(t,e){e.x.min<t.x.min&&(t.x.min=e.x.min),e.y.min<t.y.min&&(t.y.min=e.y.min),e.z&&e.z.min<t.z.min&&(t.z.min=e.z.min),e.x.max>t.x.max&&(t.x.max=e.x.max),e.y.max>t.y.max&&(t.y.max=e.y.max),e.z&&e.z.max>t.z.max&&(t.z.max=e.z.max),t.x.mid=(t.x.min+t.x.max)/2,t.y.mid=(t.y.min+t.y.max)/2,t.z&&(t.z.mid=(t.z.min+t.z.max)/2),t.x.size=t.x.max-t.x.min,t.y.size=t.y.max-t.y.min,t.z&&(t.z.size=t.z.max-t.z.min)},pairiteration:function(t,e,i){const a=t.bbox(),s=e.bbox(),n=1e5,o=i||.5;if(a.x.size+a.y.size<o&&s.x.size+s.y.size<o)return[(n*(t._t1+t._t2)/2|0)/n+"/"+(n*(e._t1+e._t2)/2|0)/n];let r=t.split(.5),l=e.split(.5),c=[{left:r.left,right:l.left},{left:r.left,right:l.right},{left:r.right,right:l.right},{left:r.right,right:l.left}];c=c.filter(function(t){return Ch.bboxoverlap(t.left.bbox(),t.right.bbox())});let d=[];return 0===c.length||(c.forEach(function(t){d=d.concat(Ch.pairiteration(t.left,t.right,o))}),d=d.filter(function(t,e){return d.indexOf(t)===e})),d},getccenter:function(t,e,i){const a=e.x-t.x,s=e.y-t.y,n=i.x-e.x,o=i.y-e.y,r=a*uh(Eh)-s*ph(Eh),l=a*ph(Eh)+s*uh(Eh),c=n*uh(Eh)-o*ph(Eh),d=n*ph(Eh)+o*uh(Eh),h=(t.x+e.x)/2,u=(t.y+e.y)/2,p=(e.x+i.x)/2,m=(e.y+i.y)/2,f=h+r,g=u+l,_=p+c,y=m+d,v=Ch.lli8(h,u,f,g,p,m,_,y),b=Ch.dist(v,t);let E,A=fh(t.y-v.y,t.x-v.x),w=fh(e.y-v.y,e.x-v.x),S=fh(i.y-v.y,i.x-v.x);return A<S?((A>w||w>S)&&(A+=bh),A>S&&(E=S,S=A,A=E)):S<w&&w<A?(E=S,S=A,A=E):S+=bh,v.s=A,v.e=S,v.r=b,v},numberSort:function(t,e){return t-e}};class Ih{constructor(t){this.curves=[],this._3d=!1,t&&(this.curves=t,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(t){return Ch.pointsToString(t.points)}).join(", ")+"]"}addCurve(t){this.curves.push(t),this._3d=this._3d||t._3d}length(){return this.curves.map(function(t){return t.length()}).reduce(function(t,e){return t+e})}curve(t){return this.curves[t]}bbox(){const t=this.curves;for(var e=t[0].bbox(),i=1;i<t.length;i++)Ch.expandbox(e,t[i].bbox());return e}offset(t){const e=[];return this.curves.forEach(function(i){e.push(...i.offset(t))}),new Ih(e)}}const{abs:xh,min:Th,max:Mh,cos:Ph,sin:Oh,acos:Lh,sqrt:Rh}=Math,Dh=Math.PI;class Nh{constructor(t){let e=t&&t.forEach?t:Array.from(arguments).slice(),i=!1;if("object"==typeof e[0]){i=e.length;const t=[];e.forEach(function(e){["x","y","z"].forEach(function(i){void 0!==e[i]&&t.push(e[i])})}),e=t}let a=!1;const s=e.length;if(i){if(i>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");a=!0}}else if(6!==s&&8!==s&&9!==s&&12!==s&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const n=this._3d=!a&&(9===s||12===s)||t&&t[0]&&void 0!==t[0].z,o=this.points=[];for(let t=0,i=n?3:2;t<s;t+=i){var r={x:e[t],y:e[t+1]};n&&(r.z=e[t+2]),o.push(r)}const l=this.order=o.length-1,c=this.dims=["x","y"];n&&c.push("z"),this.dimlen=c.length;const d=Ch.align(o,{p1:o[0],p2:o[l]}),h=Ch.dist(o[0],o[l]);this._linear=d.reduce((t,e)=>t+xh(e.y),0)<h/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(t,e,i,a){if(void 0===a&&(a=.5),0===a)return new Nh(e,e,i);if(1===a)return new Nh(t,e,e);const s=Nh.getABC(2,t,e,i,a);return new Nh(t,s.A,i)}static cubicFromPoints(t,e,i,a,s){void 0===a&&(a=.5);const n=Nh.getABC(3,t,e,i,a);void 0===s&&(s=Ch.dist(e,n.C));const o=s*(1-a)/a,r=Ch.dist(t,i),l=(i.x-t.x)/r,c=(i.y-t.y)/r,d=s*l,h=s*c,u=o*l,p=o*c,m=e.x-d,f=e.y-h,g=e.x+u,_=e.y+p,y=n.A,v=y.x+(m-y.x)/(1-a),b=y.y+(f-y.y)/(1-a),E=y.x+(g-y.x)/a,A=y.y+(_-y.y)/a,w={x:t.x+(v-t.x)/a,y:t.y+(b-t.y)/a},S={x:i.x+(E-i.x)/(1-a),y:i.y+(A-i.y)/(1-a)};return new Nh(t,w,S,i)}static getUtils(){return Ch}getUtils(){return Nh.getUtils()}static get PolyBezier(){return Ih}valueOf(){return this.toString()}toString(){return Ch.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const t=this.points,e=["M",t[0].x,t[0].y,2===this.order?"Q":"C"];for(let i=1,a=t.length;i<a;i++)e.push(t[i].x),e.push(t[i].y);return e.join(" ")}setRatios(t){if(t.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=t,this._lut=[]}verify(){const t=this.coordDigest();t!==this._print&&(this._print=t,this.update())}coordDigest(){return this.points.map(function(t,e){return""+e+t.x+t.y+(t.z?t.z:0)}).join("")}update(){this._lut=[],this.dpoints=Ch.derive(this.points,this._3d),this.computedirection()}computedirection(){const t=this.points,e=Ch.angle(t[0],t[this.order],t[1]);this.clockwise=e>0}length(){return Ch.length(this.derivative.bind(this))}static getABC(t=2,e,i,a,s=.5){const n=Ch.projectionratio(s,t),o=1-n,r={x:n*e.x+o*a.x,y:n*e.y+o*a.y},l=Ch.abcratio(s,t);return{A:{x:i.x+(i.x-r.x)/l,y:i.y+(i.y-r.y)/l},B:i,C:r,S:e,E:a}}getABC(t,e){e=e||this.get(t);let i=this.points[0],a=this.points[this.order];return Nh.getABC(this.order,i,e,a,t)}getLUT(t){if(this.verify(),t=t||100,this._lut.length===t+1)return this._lut;this._lut=[],t++,this._lut=[];for(let e,i,a=0;a<t;a++)i=a/(t-1),e=this.compute(i),e.t=i,this._lut.push(e);return this._lut}on(e,i){i=i||5;const a=this.getLUT(),s=[];for(let t,n=0,o=0;n<a.length;n++)t=a[n],Ch.dist(t,e)<i&&(s.push(t),o+=n/a.length);return!!s.length&&(t/=s.length)}project(t){const e=this.getLUT(),i=e.length-1,a=Ch.closest(e,t),s=a.mpos,n=(s-1)/i,o=(s+1)/i,r=.1/i;let l,c=a.mdist,d=n,h=d;c+=1;for(let e;d<o+r;d+=r)l=this.compute(d),e=Ch.dist(t,l),e<c&&(c=e,h=d);return h=h<0?0:h>1?1:h,l=this.compute(h),l.t=h,l.d=c,l}get(t){return this.compute(t)}point(t){return this.points[t]}compute(t){return this.ratios?Ch.computeWithRatios(t,this.points,this.ratios,this._3d):Ch.compute(t,this.points,this._3d,this.ratios)}raise(){const t=this.points,e=[t[0]],i=t.length;for(let a,s,n=1;n<i;n++)a=t[n],s=t[n-1],e[n]={x:(i-n)/i*a.x+n/i*s.x,y:(i-n)/i*a.y+n/i*s.y};return e[i]=t[i-1],new Nh(e)}derivative(t){return Ch.compute(t,this.dpoints[0],this._3d)}dderivative(t){return Ch.compute(t,this.dpoints[1],this._3d)}align(){let t=this.points;return new Nh(Ch.align(t,{p1:t[0],p2:t[t.length-1]}))}curvature(t){return Ch.curvature(t,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return Ch.inflections(this.points)}normal(t){return this._3d?this.__normal3(t):this.__normal2(t)}__normal2(t){const e=this.derivative(t),i=Rh(e.x*e.x+e.y*e.y);return{t:t,x:-e.y/i,y:e.x/i}}__normal3(t){const e=this.derivative(t),i=this.derivative(t+.01),a=Rh(e.x*e.x+e.y*e.y+e.z*e.z),s=Rh(i.x*i.x+i.y*i.y+i.z*i.z);e.x/=a,e.y/=a,e.z/=a,i.x/=s,i.y/=s,i.z/=s;const n={x:i.y*e.z-i.z*e.y,y:i.z*e.x-i.x*e.z,z:i.x*e.y-i.y*e.x},o=Rh(n.x*n.x+n.y*n.y+n.z*n.z);n.x/=o,n.y/=o,n.z/=o;const r=[n.x*n.x,n.x*n.y-n.z,n.x*n.z+n.y,n.x*n.y+n.z,n.y*n.y,n.y*n.z-n.x,n.x*n.z-n.y,n.y*n.z+n.x,n.z*n.z];return{t:t,x:r[0]*e.x+r[1]*e.y+r[2]*e.z,y:r[3]*e.x+r[4]*e.y+r[5]*e.z,z:r[6]*e.x+r[7]*e.y+r[8]*e.z}}hull(t){let e=this.points,i=[],a=[],s=0;for(a[s++]=e[0],a[s++]=e[1],a[s++]=e[2],3===this.order&&(a[s++]=e[3]);e.length>1;){i=[];for(let n,o=0,r=e.length-1;o<r;o++)n=Ch.lerp(t,e[o],e[o+1]),a[s++]=n,i.push(n);e=i}return a}split(t,e){if(0===t&&e)return this.split(e).left;if(1===e)return this.split(t).right;const i=this.hull(t),a={left:2===this.order?new Nh([i[0],i[3],i[5]]):new Nh([i[0],i[4],i[7],i[9]]),right:2===this.order?new Nh([i[5],i[4],i[2]]):new Nh([i[9],i[8],i[6],i[3]]),span:i};return a.left._t1=Ch.map(0,0,1,this._t1,this._t2),a.left._t2=Ch.map(t,0,1,this._t1,this._t2),a.right._t1=Ch.map(t,0,1,this._t1,this._t2),a.right._t2=Ch.map(1,0,1,this._t1,this._t2),e?(e=Ch.map(e,t,1,0,1),a.right.split(e).left):a}extrema(){const t={};let e=[];return this.dims.forEach(function(i){let a=function(t){return t[i]},s=this.dpoints[0].map(a);t[i]=Ch.droots(s),3===this.order&&(s=this.dpoints[1].map(a),t[i]=t[i].concat(Ch.droots(s))),t[i]=t[i].filter(function(t){return t>=0&&t<=1}),e=e.concat(t[i].sort(Ch.numberSort))}.bind(this)),t.values=e.sort(Ch.numberSort).filter(function(t,i){return e.indexOf(t)===i}),t}bbox(){const t=this.extrema(),e={};return this.dims.forEach(function(i){e[i]=Ch.getminmax(this,i,t[i])}.bind(this)),e}overlaps(t){const e=this.bbox(),i=t.bbox();return Ch.bboxoverlap(e,i)}offset(t,e){if(void 0!==e){const i=this.get(t),a=this.normal(t),s={c:i,n:a,x:i.x+a.x*e,y:i.y+a.y*e};return this._3d&&(s.z=i.z+a.z*e),s}if(this._linear){const e=this.normal(0),i=this.points.map(function(i){const a={x:i.x+t*e.x,y:i.y+t*e.y};return i.z&&e.z&&(a.z=i.z+t*e.z),a});return[new Nh(i)]}return this.reduce().map(function(e){return e._linear?e.offset(t)[0]:e.scale(t)})}simple(){if(3===this.order){const t=Ch.angle(this.points[0],this.points[3],this.points[1]),e=Ch.angle(this.points[0],this.points[3],this.points[2]);if(t>0&&e<0||t<0&&e>0)return!1}const t=this.normal(0),e=this.normal(1);let i=t.x*e.x+t.y*e.y;return this._3d&&(i+=t.z*e.z),xh(Lh(i))<Dh/3}reduce(){let t,e,i=0,a=0,s=.01,n=[],o=[],r=this.extrema().values;for(-1===r.indexOf(0)&&(r=[0].concat(r)),-1===r.indexOf(1)&&r.push(1),i=r[0],t=1;t<r.length;t++)a=r[t],e=this.split(i,a),e._t1=i,e._t2=a,n.push(e),i=a;return n.forEach(function(t){for(i=0,a=0;a<=1;)for(a=i+s;a<=1.01;a+=s)if(e=t.split(i,a),!e.simple()){if(a-=s,xh(i-a)<s)return[];e=t.split(i,a),e._t1=Ch.map(i,0,1,t._t1,t._t2),e._t2=Ch.map(a,0,1,t._t1,t._t2),o.push(e),i=a;break}i<1&&(e=t.split(i,1),e._t1=Ch.map(i,0,1,t._t1,t._t2),e._t2=t._t2,o.push(e))}),o}translate(t,e,i){i="number"==typeof i?i:e;const a=this.order;let s=this.points.map((t,s)=>(1-s/a)*e+s/a*i);return new Nh(this.points.map((e,i)=>({x:e.x+t.x*s[i],y:e.y+t.y*s[i]})))}scale(t){const e=this.order;let i=!1;if("function"==typeof t&&(i=t),i&&2===e)return this.raise().scale(i);const a=this.clockwise,s=this.points;if(this._linear)return this.translate(this.normal(0),i?i(0):t,i?i(1):t);const n=i?i(0):t,o=i?i(1):t,r=[this.offset(0,10),this.offset(1,10)],l=[],c=Ch.lli4(r[0],r[0].c,r[1],r[1].c);if(!c)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(t){const i=l[t*e]=Ch.copy(s[t*e]);i.x+=(t?o:n)*r[t].n.x,i.y+=(t?o:n)*r[t].n.y}),i?([0,1].forEach(function(n){if(2!==e||!n){var o=s[n+1],r={x:o.x-c.x,y:o.y-c.y},d=i?i((n+1)/e):t;i&&!a&&(d=-d);var h=Rh(r.x*r.x+r.y*r.y);r.x/=h,r.y/=h,l[n+1]={x:o.x+d*r.x,y:o.y+d*r.y}}}),new Nh(l)):([0,1].forEach(t=>{if(2===e&&t)return;const i=l[t*e],a=this.derivative(t),n={x:i.x+a.x,y:i.y+a.y};l[t+1]=Ch.lli4(i,n,c,s[t+1])}),new Nh(l))}outline(t,e,i,a){if(e=void 0===e?t:e,this._linear){const s=this.normal(0),n=this.points[0],o=this.points[this.points.length-1];let r,l,c;void 0===i&&(i=t,a=e),r={x:n.x+s.x*t,y:n.y+s.y*t},c={x:o.x+s.x*i,y:o.y+s.y*i},l={x:(r.x+c.x)/2,y:(r.y+c.y)/2};const d=[r,l,c];r={x:n.x-s.x*e,y:n.y-s.y*e},c={x:o.x-s.x*a,y:o.y-s.y*a},l={x:(r.x+c.x)/2,y:(r.y+c.y)/2};const h=[c,l,r],u=Ch.makeline(h[2],d[0]),p=Ch.makeline(d[2],h[0]),m=[u,new Nh(d),p,new Nh(h)];return new Ih(m)}const s=this.reduce(),n=s.length,o=[];let r,l=[],c=0,d=this.length();const h=void 0!==i&&void 0!==a;function u(t,e,i,a,s){return function(n){const o=a/i,r=(a+s)/i,l=e-t;return Ch.map(n,0,1,t+o*l,t+r*l)}}s.forEach(function(s){const n=s.length();h?(o.push(s.scale(u(t,i,d,c,n))),l.push(s.scale(u(-e,-a,d,c,n)))):(o.push(s.scale(t)),l.push(s.scale(-e))),c+=n}),l=l.map(function(t){return r=t.points,r[3]?t.points=[r[3],r[2],r[1],r[0]]:t.points=[r[2],r[1],r[0]],t}).reverse();const p=o[0].points[0],m=o[n-1].points[o[n-1].points.length-1],f=l[n-1].points[l[n-1].points.length-1],g=l[0].points[0],_=Ch.makeline(f,p),y=Ch.makeline(m,g),v=[_].concat(o).concat([y]).concat(l);return new Ih(v)}outlineshapes(t,e,i){e=e||t;const a=this.outline(t,e).curves,s=[];for(let t=1,e=a.length;t<e/2;t++){const n=Ch.makeshape(a[t],a[e-t],i);n.startcap.virtual=t>1,n.endcap.virtual=t<e/2-1,s.push(n)}return s}intersects(t,e){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof Nh&&(t=t.reduce()),this.curveintersects(this.reduce(),t,e)):this.selfintersects(e)}lineIntersects(t){const e=Th(t.p1.x,t.p2.x),i=Th(t.p1.y,t.p2.y),a=Mh(t.p1.x,t.p2.x),s=Mh(t.p1.y,t.p2.y);return Ch.roots(this.points,t).filter(t=>{var n=this.get(t);return Ch.between(n.x,e,a)&&Ch.between(n.y,i,s)})}selfintersects(t){const e=this.reduce(),i=e.length-2,a=[];for(let s,n,o,r=0;r<i;r++)n=e.slice(r,r+1),o=e.slice(r+2),s=this.curveintersects(n,o,t),a.push(...s);return a}curveintersects(t,e,i){const a=[];t.forEach(function(t){e.forEach(function(e){t.overlaps(e)&&a.push({left:t,right:e})})});let s=[];return a.forEach(function(t){const e=Ch.pairiteration(t.left,t.right,i);e.length>0&&(s=s.concat(e))}),s}arcs(t){return t=t||.5,this._iterate(t,[])}_error(t,e,i,a){const s=(a-i)/4,n=this.get(i+s),o=this.get(a-s),r=Ch.dist(t,e),l=Ch.dist(t,n),c=Ch.dist(t,o);return xh(l-r)+xh(c-r)}_iterate(t,e){let i,a=0,s=1;do{i=0,s=1;let n,o,r,l,c,d=this.get(a),h=!1,u=!1,p=s,m=1;do{if(u=h,l=r,p=(a+s)/2,n=this.get(p),o=this.get(s),r=Ch.getccenter(d,n,o),r.interval={start:a,end:s},h=this._error(r,d,a,s)<=t,c=u&&!h,c||(m=s),h){if(s>=1){if(r.interval.end=m=1,l=r,s>1){let t={x:r.x+r.r*Ph(r.e),y:r.y+r.r*Oh(r.e)};r.e+=Ch.angle({x:r.x,y:r.y},t,this.get(1))}break}s+=(s-a)/2}else s=p}while(!c&&i++<100);if(i>=100)break;l=l||r,e.push(l),a=m}while(s<1);return e}}const kh=new WeakMap;function Fh(t){let e=kh.get(t);if(!e){const[i,a,s,n]=t.points,o=6*(s.x-2*a.x+i.x),r=6*(s.y-2*a.y+i.y),l=6*(n.x-2*s.x+a.x),c=6*(n.y-2*s.y+a.y);e={points:[i,a,s,n],totalLength:t.length(),ax:o,ay:r,bx:l,by:c},kh.set(t,e)}return e}function $h(t,e,i,a,s,n,o,r){return new Nh(t,e,i,a,s,n,o,r)}function qh(t,e){if(e<0||e>1)throw new Error(`Parameter t must be between 0 and 1, got ${e}`);const i=t.derivative(e),a=i.x,s=i.y,n=a*a+s*s;if(n<Number.EPSILON*Number.EPSILON)return{curvature:0,radius:1/0};const{ax:o,ay:r,bx:l,by:c}=Fh(t),d=1-e,h=a*(d*r+e*c)-s*(d*o+e*l),u=n*Math.sqrt(n),p=Math.abs(u)<Number.EPSILON?0:h/u;return{curvature:p,radius:0===p?1/0:1/Math.abs(p)}}function Gh(t,e){if(e<=0)return 0;const i=Fh(t);if(e>=i.totalLength)return 1;let a=e/i.totalLength;for(let i=0;i<10;i++){const i=t.split(0,a).length()-e;if(Math.abs(i)<1e-6)break;const s=t.derivative(a),n=Math.sqrt(s.x*s.x+s.y*s.y);if(n<Number.EPSILON)break;a=Math.max(0,Math.min(1,a-i/n))}return a}function Bh(t,e={}){const{interval:i=1,radiusThreshold:a=10,useArcLengthSampling:s=!1}=e,n=s?function(t,e=1,i=10){if(e<=0)throw new Error(`Arc length interval must be positive, got ${e}`);const a=Fh(t),s=Math.max(2,Math.floor(a.totalLength/e)),n=Array.from({length:s+1});for(let e=0;e<=s;e++){const o=Gh(t,e/s*a.totalLength),r=t.get(o),{radius:l}=qh(t,o);n[e]={t:o,x:r.x,y:r.y,radius:l,valid:l>=i}}return n}(t,i,a):function(t,e=1,i=10){if(e<=0)throw new Error(`Interval must be positive, got ${e}`);if(i<=0)throw new Error(`Radius threshold must be positive, got ${i}`);const a=Fh(t),s=Math.max(2,Math.floor(a.totalLength/e)),n=Array.from({length:s+1});for(let e=0;e<=s;e++){const a=e/s,o=t.get(a),{radius:r}=qh(t,a);n[e]={t:a,x:o.x,y:o.y,radius:r,valid:r>=i}}return n}(t,i,a),o=function(t,e=10){const i=[];let a=0;for(const s of t)s.radius<e?i.push(s):a++;const s=t.length>0?a/t.length:1;return{isValid:0===i.length,criticalPoints:i,validityRatio:s}}(n,a),r=function(t){if(0===t.length)return null;let e=t[0],i=e.radius;for(let a=1;a<t.length;a++){const s=t[a].radius;s<i&&(i=s,e=t[a])}return e}(n);return{totalLength:Fh(t).totalLength,radiusItems:n,criticalPoints:o.criticalPoints,minRadiusPoint:r,isValid:o.isValid,validityRatio:o.validityRatio,analysisMethod:s?"arcLength":"parameter"}}function jh(t,e,i=10){let a=t,s=0,n=0,o=.9;for(let t=0;t<i;t++){s=t+1;const i=Bh(a,{radiusThreshold:e,interval:Math.max(.5,2/s)}),r=i.minRadiusPoint?i.minRadiusPoint.radius:1/0;if(i.isValid)return{ok:!0,iterations:s,minRadius:r};n=r;const l=1-i.validityRatio,c=Math.max(.7,o-.2*l),d=a.points,h={x:d[0].x+(d[1].x-d[0].x)*c,y:d[0].y+(d[1].y-d[0].y)*c},u={x:d[3].x+(d[2].x-d[3].x)*c,y:d[3].y+(d[2].y-d[3].y)*c};try{a=new Nh(d[0],h,u,d[3]),o=Math.max(.8,o-.02)}catch{break}}return{ok:!1,iterations:s,minRadius:n}}const Uh=dd();var Yh={exports:{}};
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */!function(t){!function(e,i,a,s){var n,o=["","webkit","Moz","MS","ms","o"],r=i.createElement("div"),l=Math.round,c=Math.abs,d=Date.now;function h(t,e,i){return setTimeout(y(t,i),e)}function u(t,e,i){return!!Array.isArray(t)&&(p(t,i[e],i),!0)}function p(t,e,i){var a;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==s)for(a=0;a<t.length;)e.call(i,t[a],a,t),a++;else for(a in t)t.hasOwnProperty(a)&&e.call(i,t[a],a,t)}function m(t,i,a){var s="DEPRECATED METHOD: "+i+"\n"+a+" AT \n";return function(){var i=new Error("get-stack-trace"),a=i&&i.stack?i.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",n=e.console&&(e.console.warn||e.console.log);return n&&n.call(e.console,s,a),t.apply(this,arguments)}}n="function"!=typeof Object.assign?function(t){if(t===s||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var a=arguments[i];if(a!==s&&null!==a)for(var n in a)a.hasOwnProperty(n)&&(e[n]=a[n])}return e}:Object.assign;var f=m(function(t,e,i){for(var a=Object.keys(e),n=0;n<a.length;)(!i||i&&t[a[n]]===s)&&(t[a[n]]=e[a[n]]),n++;return t},"extend","Use `assign`."),g=m(function(t,e){return f(t,e,!0)},"merge","Use `assign`.");function _(t,e,i){var a,s=e.prototype;(a=t.prototype=Object.create(s)).constructor=t,a._super=s,i&&n(a,i)}function y(t,e){return function(){return t.apply(e,arguments)}}function v(t,e){return"function"==typeof t?t.apply(e&&e[0]||s,e):t}function b(t,e){return t===s?e:t}function E(t,e,i){p(C(e),function(e){t.addEventListener(e,i,!1)})}function A(t,e,i){p(C(e),function(e){t.removeEventListener(e,i,!1)})}function w(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function S(t,e){return t.indexOf(e)>-1}function C(t){return t.trim().split(/\s+/g)}function I(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var a=0;a<t.length;){if(i&&t[a][i]==e||!i&&t[a]===e)return a;a++}return-1}function x(t){return Array.prototype.slice.call(t,0)}function T(t,e,i){for(var a=[],s=[],n=0;n<t.length;){var o=e?t[n][e]:t[n];I(s,o)<0&&a.push(t[n]),s[n]=o,n++}return i&&(a=e?a.sort(function(t,i){return t[e]>i[e]}):a.sort()),a}function M(t,e){for(var i,a,n=e[0].toUpperCase()+e.slice(1),r=0;r<o.length;){if((a=(i=o[r])?i+n:e)in t)return a;r++}return s}var P=1;function O(t){var i=t.ownerDocument||t;return i.defaultView||i.parentWindow||e}var L="ontouchstart"in e,R=M(e,"PointerEvent")!==s,D=L&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),N="touch",k="mouse",F=24,$=["x","y"],q=["clientX","clientY"];function G(t,e){var i=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){v(t.options.enable,[t])&&i.handler(e)},this.init()}function B(t,e,i){var a=i.pointers.length,n=i.changedPointers.length,o=1&e&&a-n==0,r=12&e&&a-n==0;i.isFirst=!!o,i.isFinal=!!r,o&&(t.session={}),i.eventType=e,function(t,e){var i=t.session,a=e.pointers,n=a.length;i.firstInput||(i.firstInput=j(e)),n>1&&!i.firstMultiple?i.firstMultiple=j(e):1===n&&(i.firstMultiple=!1);var o=i.firstInput,r=i.firstMultiple,l=r?r.center:o.center,h=e.center=U(a);e.timeStamp=d(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=W(l,h),e.distance=V(l,h),function(t,e){var i=e.center,a=t.offsetDelta||{},s=t.prevDelta||{},n=t.prevInput||{};1!==e.eventType&&4!==n.eventType||(s=t.prevDelta={x:n.deltaX||0,y:n.deltaY||0},a=t.offsetDelta={x:i.x,y:i.y}),e.deltaX=s.x+(i.x-a.x),e.deltaY=s.y+(i.y-a.y)}(i,e),e.offsetDirection=z(e.deltaX,e.deltaY);var u,p,m=Y(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=m.x,e.overallVelocityY=m.y,e.overallVelocity=c(m.x)>c(m.y)?m.x:m.y,e.scale=r?(u=r.pointers,V((p=a)[0],p[1],q)/V(u[0],u[1],q)):1,e.rotation=r?function(t,e){return W(e[1],e[0],q)+W(t[1],t[0],q)}(r.pointers,a):0,e.maxPointers=i.prevInput?e.pointers.length>i.prevInput.maxPointers?e.pointers.length:i.prevInput.maxPointers:e.pointers.length,function(t,e){var i,a,n,o,r=t.lastInterval||e,l=e.timeStamp-r.timeStamp;if(8!=e.eventType&&(l>25||r.velocity===s)){var d=e.deltaX-r.deltaX,h=e.deltaY-r.deltaY,u=Y(l,d,h);a=u.x,n=u.y,i=c(u.x)>c(u.y)?u.x:u.y,o=z(d,h),t.lastInterval=e}else i=r.velocity,a=r.velocityX,n=r.velocityY,o=r.direction;e.velocity=i,e.velocityX=a,e.velocityY=n,e.direction=o}(i,e);var f=t.element;w(e.srcEvent.target,f)&&(f=e.srcEvent.target),e.target=f}(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function j(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:l(t.pointers[i].clientX),clientY:l(t.pointers[i].clientY)},i++;return{timeStamp:d(),pointers:e,center:U(e),deltaX:t.deltaX,deltaY:t.deltaY}}function U(t){var e=t.length;if(1===e)return{x:l(t[0].clientX),y:l(t[0].clientY)};for(var i=0,a=0,s=0;s<e;)i+=t[s].clientX,a+=t[s].clientY,s++;return{x:l(i/e),y:l(a/e)}}function Y(t,e,i){return{x:e/t||0,y:i/t||0}}function z(t,e){return t===e?1:c(t)>=c(e)?t<0?2:4:e<0?8:16}function V(t,e,i){i||(i=$);var a=e[i[0]]-t[i[0]],s=e[i[1]]-t[i[1]];return Math.sqrt(a*a+s*s)}function W(t,e,i){i||(i=$);var a=e[i[0]]-t[i[0]],s=e[i[1]]-t[i[1]];return 180*Math.atan2(s,a)/Math.PI}G.prototype={handler:function(){},init:function(){this.evEl&&E(this.element,this.evEl,this.domHandler),this.evTarget&&E(this.target,this.evTarget,this.domHandler),this.evWin&&E(O(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(O(this.element),this.evWin,this.domHandler)}};var H={mousedown:1,mousemove:2,mouseup:4};function K(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.pressed=!1,G.apply(this,arguments)}_(K,G,{handler:function(t){var e=H[t.type];1&e&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:k,srcEvent:t}))}});var Q={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},X={2:N,3:"pen",4:k,5:"kinect"},J="pointerdown",Z="pointermove pointerup pointercancel";function tt(){this.evEl=J,this.evWin=Z,G.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}e.MSPointerEvent&&!e.PointerEvent&&(J="MSPointerDown",Z="MSPointerMove MSPointerUp MSPointerCancel"),_(tt,G,{handler:function(t){var e=this.store,i=!1,a=t.type.toLowerCase().replace("ms",""),s=Q[a],n=X[t.pointerType]||t.pointerType,o=n==N,r=I(e,t.pointerId,"pointerId");1&s&&(0===t.button||o)?r<0&&(e.push(t),r=e.length-1):12&s&&(i=!0),r<0||(e[r]=t,this.callback(this.manager,s,{pointers:e,changedPointers:[t],pointerType:n,srcEvent:t}),i&&e.splice(r,1))}});var et={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function it(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,G.apply(this,arguments)}function at(t,e){var i=x(t.touches),a=x(t.changedTouches);return 12&e&&(i=T(i.concat(a),"identifier",!0)),[i,a]}_(it,G,{handler:function(t){var e=et[t.type];if(1===e&&(this.started=!0),this.started){var i=at.call(this,t,e);12&e&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:N,srcEvent:t})}}});var st={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function nt(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},G.apply(this,arguments)}function ot(t,e){var i=x(t.touches),a=this.targetIds;if(3&e&&1===i.length)return a[i[0].identifier]=!0,[i,i];var s,n,o=x(t.changedTouches),r=[],l=this.target;if(n=i.filter(function(t){return w(t.target,l)}),1===e)for(s=0;s<n.length;)a[n[s].identifier]=!0,s++;for(s=0;s<o.length;)a[o[s].identifier]&&r.push(o[s]),12&e&&delete a[o[s].identifier],s++;return r.length?[T(n.concat(r),"identifier",!0),r]:void 0}_(nt,G,{handler:function(t){var e=st[t.type],i=ot.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:N,srcEvent:t})}});function rt(){G.apply(this,arguments);var t=y(this.handler,this);this.touch=new nt(this.manager,t),this.mouse=new K(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function lt(t,e){1&t?(this.primaryTouch=e.changedPointers[0].identifier,ct.call(this,e)):12&t&&ct.call(this,e)}function ct(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var i={x:e.clientX,y:e.clientY};this.lastTouches.push(i);var a=this.lastTouches;setTimeout(function(){var t=a.indexOf(i);t>-1&&a.splice(t,1)},2500)}}function dt(t){for(var e=t.srcEvent.clientX,i=t.srcEvent.clientY,a=0;a<this.lastTouches.length;a++){var s=this.lastTouches[a],n=Math.abs(e-s.x),o=Math.abs(i-s.y);if(n<=25&&o<=25)return!0}return!1}_(rt,G,{handler:function(t,e,i){var a=i.pointerType==N,s=i.pointerType==k;if(!(s&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(a)lt.call(this,e,i);else if(s&&dt.call(this,i))return;this.callback(t,e,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ht=M(r.style,"touchAction"),ut=ht!==s,pt="compute",mt="auto",ft="manipulation",gt="none",_t="pan-x",yt="pan-y",vt=function(){if(!ut)return!1;var t={},i=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(a){t[a]=!i||e.CSS.supports("touch-action",a)}),t}();function bt(t,e){this.manager=t,this.set(e)}bt.prototype={set:function(t){t==pt&&(t=this.compute()),ut&&this.manager.element.style&&vt[t]&&(this.manager.element.style[ht]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return p(this.manager.recognizers,function(e){v(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),function(t){if(S(t,gt))return gt;var e=S(t,_t),i=S(t,yt);return e&&i?gt:e||i?e?_t:yt:S(t,ft)?ft:mt}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var a=this.actions,s=S(a,gt)&&!vt[gt],n=S(a,yt)&&!vt[yt],o=S(a,_t)&&!vt[_t];if(s){var r=1===t.pointers.length,l=t.distance<2,c=t.deltaTime<250;if(r&&l&&c)return}if(!o||!n)return s||n&&6&i||o&&i&F?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Et=32;function At(t){this.options=n({},this.defaults,t||{}),this.id=P++,this.manager=null,this.options.enable=b(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function wt(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function St(t){return 16==t?"down":8==t?"up":2==t?"left":4==t?"right":""}function Ct(t,e){var i=e.manager;return i?i.get(t):t}function It(){At.apply(this,arguments)}function xt(){It.apply(this,arguments),this.pX=null,this.pY=null}function Tt(){It.apply(this,arguments)}function Mt(){At.apply(this,arguments),this._timer=null,this._input=null}function Pt(){It.apply(this,arguments)}function Ot(){It.apply(this,arguments)}function Lt(){At.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Rt(t,e){return(e=e||{}).recognizers=b(e.recognizers,Rt.defaults.preset),new Dt(t,e)}function Dt(t,e){this.options=n({},Rt.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new(this.options.inputClass||(R?tt:D?nt:L?rt:K))(this,B),this.touchAction=new bt(this,this.options.touchAction),Nt(this,!0),p(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function Nt(t,e){var i,a=t.element;a.style&&(p(t.options.cssProps,function(s,n){i=M(a.style,n),e?(t.oldCssProps[i]=a.style[i],a.style[i]=s):a.style[i]=t.oldCssProps[i]||""}),e||(t.oldCssProps={}))}At.prototype={defaults:{},set:function(t){return n(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(u(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Ct(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return u(t,"dropRecognizeWith",this)||(t=Ct(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(u(t,"requireFailure",this))return this;var e=this.requireFail;return-1===I(e,t=Ct(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(u(t,"dropRequireFailure",this))return this;t=Ct(t,this);var e=I(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,i=this.state;function a(i){e.manager.emit(i,t)}i<8&&a(e.options.event+wt(i)),a(e.options.event),t.additionalEvent&&a(t.additionalEvent),i>=8&&a(e.options.event+wt(i))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=Et},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){var e=n({},t);if(!v(this.options.enable,[this,e]))return this.reset(),void(this.state=Et);56&this.state&&(this.state=1),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},_(It,At,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,a=6&e,s=this.attrTest(t);return a&&(8&i||!s)?16|e:a||s?4&i?8|e:2&e?4|e:2:Et}}),_(xt,It,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var t=this.options.direction,e=[];return 6&t&&e.push(yt),t&F&&e.push(_t),e},directionTest:function(t){var e=this.options,i=!0,a=t.distance,s=t.direction,n=t.deltaX,o=t.deltaY;return s&e.direction||(6&e.direction?(s=0===n?1:n<0?2:4,i=n!=this.pX,a=Math.abs(t.deltaX)):(s=0===o?1:o<0?8:16,i=o!=this.pY,a=Math.abs(t.deltaY))),t.direction=s,i&&a>e.threshold&&s&e.direction},attrTest:function(t){return It.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=St(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),_(Tt,It,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[gt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),_(Mt,At,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[mt]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,a=t.distance<e.threshold,s=t.deltaTime>e.time;if(this._input=t,!a||!i||12&t.eventType&&!s)this.reset();else if(1&t.eventType)this.reset(),this._timer=h(function(){this.state=8,this.tryEmit()},e.time,this);else if(4&t.eventType)return 8;return Et},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&4&t.eventType?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=d(),this.manager.emit(this.options.event,this._input)))}}),_(Pt,It,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[gt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),_(Ot,It,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return xt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return 30&i?e=t.overallVelocity:6&i?e=t.overallVelocityX:i&F&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&i&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&c(e)>this.options.velocity&&4&t.eventType},emit:function(t){var e=St(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),_(Lt,At,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ft]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,a=t.distance<e.threshold,s=t.deltaTime<e.time;if(this.reset(),1&t.eventType&&0===this.count)return this.failTimeout();if(a&&s&&i){if(4!=t.eventType)return this.failTimeout();var n=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||V(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,o&&n?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=h(function(){this.state=8,this.tryEmit()},e.interval,this),2):8}return Et},failTimeout:function(){return this._timer=h(function(){this.state=Et},this.options.interval,this),Et},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Rt.VERSION="2.0.7",Rt.defaults={domEvents:!1,touchAction:pt,enable:!0,inputTarget:null,inputClass:null,preset:[[Pt,{enable:!1}],[Tt,{enable:!1},["rotate"]],[Ot,{direction:6}],[xt,{direction:6},["swipe"]],[Lt],[Lt,{event:"doubletap",taps:2},["tap"]],[Mt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Dt.prototype={set:function(t){return n(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var i;this.touchAction.preventDefaults(t);var a=this.recognizers,s=e.curRecognizer;(!s||s&&8&s.state)&&(s=e.curRecognizer=null);for(var n=0;n<a.length;)i=a[n],2===e.stopped||s&&i!=s&&!i.canRecognizeWith(s)?i.reset():i.recognize(t),!s&&14&i.state&&(s=e.curRecognizer=i),n++}},get:function(t){if(t instanceof At)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(u(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(u(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,i=I(e,t);-1!==i&&(e.splice(i,1),this.touchAction.update())}return this},on:function(t,e){if(t!==s&&e!==s){var i=this.handlers;return p(C(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this}},off:function(t,e){if(t!==s){var i=this.handlers;return p(C(t),function(t){e?i[t]&&i[t].splice(I(i[t],e),1):delete i[t]}),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var a=i.createEvent("Event");a.initEvent(t,!0,!0),a.gesture=e,e.target.dispatchEvent(a)}(t,e);var a=this.handlers[t]&&this.handlers[t].slice();if(a&&a.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var s=0;s<a.length;)a[s](e),s++}},destroy:function(){this.element&&Nt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},n(Rt,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Et,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:F,DIRECTION_ALL:30,Manager:Dt,Input:G,TouchAction:bt,TouchInput:nt,MouseInput:K,PointerEventInput:tt,TouchMouseInput:rt,SingleTouchInput:it,Recognizer:At,AttrRecognizer:It,Tap:Lt,Pan:xt,Swipe:Ot,Pinch:Tt,Rotate:Pt,Press:Mt,on:E,off:A,each:p,merge:g,extend:f,assign:n,inherit:_,bindFn:y,prefixed:M}),(void 0!==e?e:"undefined"!=typeof self?self:{}).Hammer=Rt,t.exports?t.exports=Rt:e.Hammer=Rt}(window,document)}(Yh);var zh=g(Yh.exports);class Vh{constructor(t,e){Object.defineProperty(this,"baseCreator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"action",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pointerMoveCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pointerPoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"movingPoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pointerdown",{enumerable:!0,configurable:!0,writable:!0,value:async t=>{switch(this.pointerPoint=new Md(t.x,-t.y,0),t.stopPropagation(),t.button){case 0:break;case 1:this.action===Bc.NORMAL&&(this.setAction(Bc.PAN),this.baseCreator.setGradeDisplay("mini"));break;case 2:if(!this.baseCreator.stageModel.isEditable){const t=await this.baseCreator.stageModel.pickedStationList(this.pointerPoint);this.baseCreator.stageModel.updateSelectedItemList(t)}this.baseCreator.handleContextMenu()}}}),Object.defineProperty(this,"pointermove",{enumerable:!0,configurable:!0,writable:!0,value:async t=>{if(t.preventDefault(),t.stopPropagation(),this.action!==Bc.PAN){if(this.baseCreator.handleStageAssistPointer(t),this.movingPoint=new Md(t.x,-t.y,0),this.pointerMoveCount++%11==0)switch(this.pointerMoveCount=1,this.action){case Bc.MANUAL_LOCATE:case Bc.MOVE_POSE:this.baseCreator.handleLocateMove(!0,Vc.ING,this.movingPoint);break;case Bc.CALCULATE_DISTANCE:this.baseCreator.handleCalculateDistance(!0,0,Vc.ING,this.movingPoint);break;case Bc.STATION:await this.baseCreator.stageModel.stationStage.drawing(this.movingPoint);break;case Bc.NODE:await this.baseCreator.stageModel.nodeStage.drawing(this.movingPoint);break;case Bc.FUNC_AREA:await this.baseCreator.stageModel.funcAreaStage.drawing(this.movingPoint);break;case Bc.NOTE_AREA:await this.baseCreator.stageModel.noteAreaStage.drawing(this.movingPoint);break;case Bc.LOCATION_AREA:await this.baseCreator.stageModel.locationAreaStage.drawing(this.movingPoint);break;case Bc.CLEAN_AREA:case Bc.SELECTION:this.baseCreator.stageModel.buildingAreaStage.drawing(this.movingPoint);break;case Bc.LINE:await this.baseCreator.stageModel.lineEdgeStage.drawing(this.movingPoint);break;case Bc.BEZIER:await this.baseCreator.stageModel.bezierEdgeStage.drawing(this.movingPoint)}}else this.baseCreator.handleCameraPan(t)}}),Object.defineProperty(this,"pointerup",{enumerable:!0,configurable:!0,writable:!0,value:async t=>{switch(this.pointerPoint=new Md(t.x,-t.y,0),t.preventDefault(),t.stopPropagation(),t.button){case 0:switch(this.action){case Bc.PAN:this.baseCreator.setGradeDisplay(this.baseCreator.grade),this.setAction(Bc.NORMAL);break;case Bc.MANUAL_LOCATE:case Bc.MOVE_POSE:this.baseCreator.handleLocateMove(!0,Vc.END,this.pointerPoint),this.setAction(Bc.NORMAL);break;case Bc.CALCULATE_DISTANCE:this.baseCreator.handleCalculateDistance(!0,0,Vc.END,this.pointerPoint),this.setAction(Bc.NORMAL);break;case Bc.STATION:await this.baseCreator.stageModel.stationStage.drawEnd(this.pointerPoint);break;case Bc.NODE:await this.baseCreator.stageModel.nodeStage.drawEnd(this.pointerPoint);break;case Bc.FUNC_AREA:await this.baseCreator.stageModel.funcAreaStage.drawEnd(this.pointerPoint),this.setAction(Bc.NORMAL);break;case Bc.NOTE_AREA:await this.baseCreator.stageModel.noteAreaStage.drawEnd(this.pointerPoint),this.setAction(Bc.NORMAL);break;case Bc.LOCATION_AREA:await this.baseCreator.stageModel.locationAreaStage.drawEnd(this.pointerPoint),this.setAction(Bc.NORMAL);break;case Bc.SELECTION:this.baseCreator.stageModel.buildingAreaStage.drawEnd(this.pointerPoint),this.setAction(Bc.NORMAL);break;case Bc.CLEAN_AREA:this.baseCreator.stageModel.buildingAreaStage.drawEnd(this.pointerPoint);break;case Bc.LINE:await this.baseCreator.stageModel.lineEdgeStage.drawEnd(this.pointerPoint);break;case Bc.BEZIER:await this.baseCreator.stageModel.bezierEdgeStage.drawEnd(this.pointerPoint);case Bc.NORMAL:}break;case 1:this.action===Bc.PAN&&(this.baseCreator.setGradeDisplay(this.baseCreator.grade),this.setAction(Bc.NORMAL))}}}),Object.defineProperty(this,"pointerout",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.action===Bc.PAN&&(this.baseCreator.setGradeDisplay(this.baseCreator.grade),this.setAction(Bc.NORMAL))}}),Object.defineProperty(this,"wheel",{enumerable:!0,configurable:!0,writable:!0,value:t=>{t.preventDefault(),t.stopPropagation(),this.baseCreator.handleCameraZoom(t)}}),Object.defineProperty(this,"initResizeObserver",{enumerable:!0,configurable:!0,writable:!0,value:t=>{const e=document.querySelector(`#${t}`);if(e){const t=this.baseCreator.canvas.getCamera();new ResizeObserver(function(t,e=50){let i=null;return function(...a){i&&clearTimeout(i),i=setTimeout(()=>{t.apply(this,a)},e)}}(i=>{for(const a of i)if(a.target===e){const{width:e,height:i}=a.contentRect,s=this.baseCreator.canvas.getConfig()||{};s.width=e,s.height=i,this.baseCreator.canvas.getContextService().resize(e,i);const n=null==t?void 0:t.getPosition(),o=null==t?void 0:t.getRoll();n&&(null==t||t.setPosition(n[0],n[1],500).setFocalPoint(n[0],n[1],0));const r=null==t?void 0:t.getProjectionMode();void 0!==o&&null!=t&&t.setRoll(o),r===Gi.ORTHOGRAPHIC?null==t||t.setOrthographic(e/-2,e/2,i/2,i/-2,t.getNear(),t.getFar()):null==t||t.setAspect(e/i)}},300)).observe(e)}}}),Object.defineProperty(this,"initRenderEndHandle",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const t=this.baseCreator.canvas.getStats();t&&0===t.total&&(this.baseCreator.canvas.removeEventListener(jo.AFTER_RENDER,this.initRenderEndHandle),this.baseCreator.callbackMap.initRenderEndFn&&this.baseCreator.callbackMap.initRenderEndFn({...t}))}}),this.baseCreator=e,this.action=Bc.NORMAL,this.pointerMoveCount=1,this.pointerPoint=new Md(0,0,0),this.movingPoint=new Md(0,0,0),this.initEvent(t)}initEvent(t){this.baseCreator.canvas.addEventListener("pointerdown",this.pointerdown,{passive:!1}),this.baseCreator.canvas.addEventListener("pointermove",this.pointermove,{passive:!1}),this.baseCreator.canvas.addEventListener("pointerup",this.pointerup,{passive:!1}),this.baseCreator.canvas.addEventListener("pointerout",this.pointerout,{passive:!1}),this.baseCreator.canvas.addEventListener("wheel",this.wheel,{passive:!1}),this.initResizeObserver(t),this.baseCreator.canvas.addEventListener(jo.AFTER_RENDER,this.initRenderEndHandle);const e=new zh.Manager(this.baseCreator.canvas,{inputClass:zh.PointerEventInput});e.add(new zh.Tap({event:od.DOUBLE_TAP,taps:2})),e.add(new zh.Tap({event:od.SINGLE_TAP})),e.add(new zh.Press({time:200})),e.get(od.SINGLE_TAP).requireFailure(od.DOUBLE_TAP),e.get(od.DOUBLE_TAP).recognizeWith(od.SINGLE_TAP),e.on(od.DOUBLE_TAP,async t=>{await this.pointerTap(t)}),e.on(od.SINGLE_TAP,async t=>{await this.pointerTap(t)}),e.on(od.PRESS,async t=>{await this.pointerTap(t)})}setAction(t){this.action=t,this.baseCreator.updateAction(t)}async pointerTap(t){switch(this.action){case Bc.NORMAL:{let a=[],s=Wc.UPDATE;if(this.baseCreator.stageModel.isEditable){var e,i;a=await this.baseCreator.stageModel.getItemListFromPoint({pickInfo:this.pointerPoint,type:jc.NONE});const n=a.find(t=>t.getBaseType()===jc.EDGE_POLE);if(n)return void this.baseCreator.stageModel.updateSelectedItemList([n.itemEdge],s);if(this.baseCreator.stageModel.isCtrlKey&&t.type===od.SINGLE_TAP)s=Wc.ADD;else if(a.length>1){const t=await this.baseCreator.selectItem(await this.baseCreator.getTranslation("label.select"),this.baseCreator.stageModel.getSelectItemOptions(a)),e=this.baseCreator.stageModel.getItemBySelectOption(t,a);a=e?[e]:[]}if(t.type===od.SINGLE_TAP)null===(e=a[0])||void 0===e||null===(i=e.pathGroup)||void 0===i||i.toFront();else if(t.type===od.DOUBLE_TAP)return void(1===a.length&&await this.baseCreator.doubleClickedItem(a[0].dataModel))}else a=await this.baseCreator.stageModel.pickedStationList(this.pointerPoint),this.baseCreator.stageModel.isCtrlKey;this.baseCreator.stageModel.updateSelectedItemList(a,s),this.baseCreator.stageModel.isEditable&&0!==a.length||t.type===od.PRESS&&(this.setAction(Bc.PAN),this.baseCreator.setGradeDisplay("mini"));break}case Bc.MANUAL_LOCATE:case Bc.MOVE_POSE:this.baseCreator.handleLocateMove(!0,Vc.START,this.pointerPoint);break;case Bc.CALCULATE_DISTANCE:this.baseCreator.handleCalculateDistance(!0,0,Vc.START,this.pointerPoint);break;case Bc.FUNC_AREA:await this.baseCreator.stageModel.funcAreaStage.drawBefore(this.pointerPoint);break;case Bc.NOTE_AREA:await this.baseCreator.stageModel.noteAreaStage.drawBefore(this.pointerPoint);break;case Bc.LOCATION_AREA:await this.baseCreator.stageModel.locationAreaStage.drawBefore(this.pointerPoint);break;case Bc.CLEAN_AREA:case Bc.SELECTION:this.baseCreator.stageModel.buildingAreaStage.drawBefore(this.pointerPoint);break;case Bc.LINE:await this.baseCreator.stageModel.lineEdgeStage.drawBefore(this.pointerPoint);break;case Bc.BEZIER:await this.baseCreator.stageModel.bezierEdgeStage.drawBefore(this.pointerPoint)}}}var Wh=function(t){function e(i){var a=t.call(this,r(r({},i),{type:e.tag}))||this,s=a.attributes,n=s.body,o=s.startHead,c=s.endHead;s.startHeadOffset,s.endHeadOffset;var d=l(s,["body","startHead","endHead","startHeadOffset","endHeadOffset"]);if(!n)throw new Error("Arrow's body is required");return a.body=n,a.appendChild(a.body),a.handleBodyAttributeChanged(a.body),o&&a.appendArrowHead(a.getArrowHeadType(o),!0),c&&a.appendArrowHead(a.getArrowHeadType(c),!1),a.applyArrowStyle(d,[a.body,a.startHead,a.endHead]),a}return o(e,t),e.prototype.handleBodyAttributeChanged=function(t){var e=this;t.addEventListener(_o.ATTR_MODIFIED,function(t){var i=t.attrName;"x1"===i||"y1"===i?e.startHead&&e.transformArrowHead(e.startHead,!0):"x2"!==i&&"y2"!==i||e.endHead&&e.transformArrowHead(e.endHead,!1)})},e.prototype.getBody=function(){return this.body},e.prototype.getStartHead=function(){return this.startHead},e.prototype.getEndHead=function(){return this.endHead},e.prototype.attributeChangedCallback=function(t,e,i){var a;if("opacity"===t||"strokeOpacity"===t||"stroke"===t||"lineWidth"===t||"increasedLineWidthForHitTesting"===t)this.applyArrowStyle(((a={})[t]=i,a),[this.body,this.startHead,this.endHead]);else if("startHead"===t||"endHead"===t){var s="startHead"===t;if(this.destroyArrowHead(s),i){var n=this.attributes;n.body,n.startHead,n.endHead,n.startHeadOffset,n.endHeadOffset;var o=l(n,["body","startHead","endHead","startHeadOffset","endHeadOffset"]);this.appendArrowHead(this.getArrowHeadType(i),s),this.applyArrowStyle(o,[s?this.startHead:this.endHead])}}else if("body"===t){var r=this.attributes;r.body,r.startHead,r.endHead,r.startHeadOffset,r.endHeadOffset,o=l(r,["body","startHead","endHead","startHeadOffset","endHeadOffset"]),this.body.destroy(),this.body=i,this.appendChild(this.body),this.applyArrowStyle(o,[this.body])}else"startHeadOffset"===t?this.moveArrowHeadAlongTangent(i,!0):"endHeadOffset"===t&&this.moveArrowHeadAlongTangent(i,!1)},e.prototype.getArrowHeadType=function(t){return"boolean"==typeof t?"default":"custom"},e.prototype.appendArrowHead=function(t,e){var i;i="default"===t?this.createDefaultArrowHead():e?this.attributes.startHead:this.attributes.endHead,this.transformArrowHead(i,e),i.setAttribute("zIndex",1),e?this.startHead=i:this.endHead=i,this.appendChild(i);var a=e?this.attributes.startHeadOffset:this.attributes.endHeadOffset;a&&this.moveArrowHeadAlongTangent(a,e)},e.prototype.transformArrowHead=function(t,e){var i,a=Z(),s=0,n=0,o=0,r=0,l=this.body&&this.body.nodeName;if(l===mi.LINE){var c=this.body.attributes,d=c.x1,h=c.x2,p=c.y1,m=c.y2;s=e?h:d,n=e?d:h,o=e?m:p,r=e?p:m}else if(l===mi.POLYLINE){var f=this.body.attributes.points,g=f.length;s=e?f[1][0]:f[g-2][0],o=e?f[1][1]:f[g-2][1],n=e?f[0][0]:f[g-1][0],r=e?f[0][1]:f[g-1][1]}else if(l===mi.PATH){var _=u(this.getTangent(this.body,e),2),y=_[0],v=_[1];s=y[0],o=y[1],n=v[0],r=v[1]}var b=s-n,E=o-r;i=Math.atan2(E,b),a=it(n,r,0),e?(this.startHeadPosition=a,this.startHeadRad=i):(this.endHeadPosition=a,this.endHeadRad=i),t.setLocalPosition(a),t.setLocalEulerAngles(180*i/Math.PI+t.getLocalEulerAngles())},e.prototype.moveArrowHeadAlongTangent=function(t,e){var i=e?this.startHead:this.endHead;i&&i.setLocalPosition(pt(Z(),e?this.startHeadPosition:this.endHeadPosition,it(Math.cos(e?this.startHeadRad:this.endHeadRad)*t,Math.sin(e?this.startHeadRad:this.endHeadRad)*t,0))),this.body},e.prototype.destroyArrowHead=function(t){t&&this.startHead&&(this.startHead.destroy(),this.startHead=void 0),!t&&this.endHead&&(this.endHead.destroy(),this.endHead=void 0)},e.prototype.getTangent=function(t,e){return e?t.getStartTangent():t.getEndTangent()},e.prototype.createDefaultArrowHead=function(){var t=this.attributes,e=t.stroke,i=t.lineWidth,a=Math.sin,s=Math.cos,n=Math.PI;return new sr({style:{path:"M".concat(10*s(n/6),",").concat(10*a(n/6)," L0,0 L").concat(10*s(n/6),",-").concat(10*a(n/6)),stroke:e,lineWidth:i,transformOrigin:"center",anchor:[.5,.5]}})},e.prototype.applyArrowStyle=function(t,e){var i=t.opacity,a=t.stroke,s=t.strokeOpacity,n=t.lineWidth,o=t.increasedLineWidthForHitTesting;e.forEach(function(t){t&&(le(i)||(t.style.opacity=i),le(a)||(t.style.stroke=a),le(s)||(t.style.strokeOpacity=s),le(n)||(t.style.lineWidth=n),le(o)||(t.style.increasedLineWidthForHitTesting=o))})},e.tag="arrow",e}(Jo),Hh=Math.PI,Kh=2*Hh,Qh=Math.sin,Xh=Math.cos,Jh=Math.acos,Zh=Math.atan2,tu=Math.sqrt,eu=Math.max,iu=Math.min,au=1e-4;[{name:"sr",inherits:!1,interpolable:!0,syntax:La.LENGTH_PERCENTAGE},{name:"sr0",inherits:!1,interpolable:!0,syntax:La.LENGTH_PERCENTAGE},{name:"startAngle",inherits:!1,interpolable:!0,syntax:La.ANGLE},{name:"endAngle",inherits:!1,interpolable:!0,syntax:La.ANGLE}].forEach(function(t){Qo(t)});var su=function(t,e,i,a){return{x:t+i*Math.cos(a),y:e+i*Math.sin(a)}};function nu(t,e,i,a,s,n,o){var r=t-i,l=e-a,c=(o?n:-n)/tu(r*r+l*l),d=c*l,h=-c*r,u=t+d,p=e+h,m=i+d,f=a+h,g=(u+m)/2,_=(p+f)/2,y=m-u,v=f-p,b=y*y+v*v,E=s-n,A=u*f-m*p,w=(v<0?-1:1)*tu(eu(0,E*E*b-A*A)),S=(A*v-y*w)/b,C=(-A*y-v*w)/b,I=(A*v+y*w)/b,x=(-A*y+v*w)/b,T=S-g,M=C-_,P=I-g,O=x-_;return T*T+M*M>P*P+O*O&&(S=I,C=x),{cx:S,cy:C,x0:-d,y0:-h,x1:S*(s/E-1),y1:C*(s/E-1)}}function ou(t,e){return(e=e<0&&t>=0?e+Kh:e)-t<=Hh?0:1}function ru(t){const e=function(t){switch(t){case Uc.NORMAL:return Tc.NORMAL;case Uc.CHARGE:return Tc.CHARGE;case Uc.DOCK:return Tc.DOCK;case Uc.WORK:return Tc.WORK;case Uc.WAREROOM:return Tc.WAREROOM;case Uc.AVOID:return Tc.AVOID;case Uc.RACK:return Tc.RACK;case Uc.USER_DEFINE:return Tc.USER_DEFINE;default:return Tc.NORMAL}}(t.type),i=new Xo({style:{cx:0,cy:0,r:10,fill:"transparent",stroke:e,lineWidth:2}}),a=new lr({style:{x:10,y:-4,text:`#${t.id}`,zIndex:1,fill:e},name:"grade-small"}),s=new lr({style:{x:10,y:16,text:t.name,zIndex:1,fill:e},name:"grade-small"}),n=new Wh({style:{body:new ar({style:{x1:0,y1:0,x2:24,y2:0}}),endHead:!0,stroke:e,lineWidth:2}});n.rotate(Zd(-t["pos.yaw"]/Ic));const o=new tr({id:`${jc.STATION}-${t.type}-${t.id}`});return o.setPosition(t["pos.x"]/Sc,-t["pos.y"]/Sc),o.append(n,i,a,s),o}function lu(t){const e=new tr({id:`${jc.EDGE}-${t.type}-${t.id}`});return e.append(...cu(t)),e}function cu(t){const e=function(t,e=Xc.ALL){let i=Pc.FORWARD;return t!==Qc.FORWARD?i=Pc.UN_FORWARD:e===Xc.FREE?i=Pc.FREE:e===Xc.LOAD&&(i=Pc.LOAD),i}(t.robot_direction,t.param),{sx:i,sy:a,ex:s,ey:n,id:o}=t,r=(s-i)/Sc,l=(n-a)/Sc,c=Math.sqrt(r**2+l**2),d=new Md(i/Sc,a/Sc),h=new Md(s/Sc,n/Sc).subtract(d),u=d.add(h.normalize(c<30?c:30)).getPos();return[new Wh({style:{body:new ar({style:{x1:i/Sc,y1:-a/Sc,x2:s/Sc,y2:-n/Sc,lineCap:"round"}}),endHead:!0,endHeadOffset:c<30?0:30-c,stroke:e,lineWidth:4,fillOpacity:0}}),new lr({style:{x:u.x+8,y:16-u.y,text:`e${o}`,zIndex:1,fill:e},name:"grade-small"})]}function du(t){const e=new tr({id:`${jc.EDGE}-${t.type}-${t.id}`});return e.append(...hu(t)),e}function hu(t){const{sx:e,sy:i,ex:a,ey:s,cx:n,cy:o,dx:r,dy:l}=t,c=function(t,e=Xc.ALL){let i=Pc.FORWARD;return t!==Qc.FORWARD?i=Pc.UN_FORWARD:e===Xc.FREE?i=Pc.FREE:e===Xc.LOAD&&(i=Pc.LOAD),i}(t.robot_direction,t.param),d=new sr({style:{path:[["M",e/Sc,-i/Sc],["C",n/Sc,-o/Sc,r/Sc,-l/Sc,a/Sc,-s/Sc]],stroke:c,zIndex:1,lineWidth:4,lineCap:"round"}}),h=new Md(e/Sc,i/Sc),u=new Md(a/Sc,s/Sc).subtract(h),p=h.add(u.normalize(30)).getPos();return[d,new Wh({style:{body:new ar({style:{x1:e/Sc,y1:-i/Sc,x2:p.x,y2:-p.y}}),endHead:!0,stroke:c,lineWidth:4}}),new lr({style:{x:p.x+8,y:16-p.y,text:`e${t.id}`,zIndex:2,fill:c},name:"grade-small"})]}function uu(t){const{x:e,y:i,id:a}=t,s=new Xo({style:{cx:0,cy:0,r:8,fill:"transparent",stroke:Mc.NORMAL,lineWidth:2,lineDash:[4,2]}}),n=new lr({name:"grade-small",style:{x:-12,y:-8,text:`n${a}`,fill:Mc.NORMAL,zIndex:1,textAlign:"right"}}),o=new tr({id:`${jc.NODE}-0-${a}`});return o.append(s,n),o.setPosition(e/Sc,-i/Sc),o}function pu(t,e){switch(t){case jc.FUNC_AREA:return dh(e)||eh("label.regionTypeReserved");case jc.NOTE_AREA:return eh("label.noteArea");case jc.LOCATION_AREA:return`${eh("label.locationArea")}-${function(t,e){return null!==(e={[ad.LIMIT_JUMP]:eh("label.limitJumpRegion"),[ad.LIMIT_MAP_UPDATE]:eh("label.limitMapUpdateRegion"),[ad.LONG_CORRIDOR]:eh("label.longCorridorRegion"),[ad.CRASH_BARRIER]:eh("label.antiCollisionBarRegion"),[ad.ERASE]:eh("label.eraseRegion"),[ad.MOVING_OBJECT]:eh("label.movingObjectRegion"),[ad.ODOM]:eh("label.odometryLocationRegion"),[ad.QRCODE]:eh("label.qrCodeRegion")}[t])&&void 0!==e?e:""}(e)}`}}function mu(t,e){return t.name||pu(e,t.type)+t.id}function fu(t,e){const i=e===jc.FUNC_AREA&&t.type||0,a=new tr({id:`${e}-${i}-${t.id}`});return(e===jc.CLEAN_AREA||e===jc.SELECTION_AREA)&&(a.interactive=!1),a.append(...gu(t,e)),a.setPosition(t["pa.x"]/Sc,-t["pa.y"]/Sc),a}function gu(t,e){const i=[],a=e===jc.NOTE_AREA,s=a?t.style.backgroundColor:function(t,e){switch(t){case jc.FUNC_AREA:switch(e){case Kc.FORBID_ENTRY:return Lc.FORBID_ENTRY;case Kc.SPEED_LEVEL_20:case Kc.SPEED_LEVEL_40:case Kc.SPEED_LEVEL_60:case Kc.SPEED_LEVEL_80:return Lc.DECELERATE;case Kc.DISABLE_OBA:return Lc.DISABLE_OBA;case Kc.DISABLE_ROTATE:return Lc.DISABLE_ROTATE;case Kc.DISABLE_REROUTE:return Lc.DISABLE_REROUTE;case Kc.LIMIT_CAR_NUMBER:return Lc.LIMIT_CAR_NUMBER;case Kc.ONEWAY_TRAFFIC:return Lc.ONEWAY_TRAFFIC;case Kc.LOCAL_REPLAN:return Lc.LOCAL_REPLAN;case Kc.USER_DEFINE:return Lc.USER_DEFINE;default:return Lc.NORMAL}case jc.CLEAN_AREA:return Lc.CLEAN_AREA_NORMAL;case jc.LOCATION_AREA:return[Rc.LIMIT_JUMP,Rc.LIMIT_MAP_UPDATE,Rc.LONG_CORRIDOR,Rc.CRASH_BARRIER,Rc.ERASE,Rc.MOVING_OBJECT,Rc.ODOM,Rc.QRCODE][(null!=e?e:1)-1];case jc.SELECTION_AREA:return"transparent"}}(e,t.type),n=e===jc.CLEAN_AREA||e===jc.SELECTION_AREA,o=new rr({style:{x:0,y:0,width:(t["pc.x"]-t["pa.x"])/Sc,height:(t["pa.y"]-t["pc.y"])/Sc,fill:s,stroke:s,opacity:a?t.style.opacity:n?1:.25,lineWidth:$c.DEFAULT_STROKE_WIDTH}});if(i.push(o),!n){const a=function(t,e){const i=e===jc.FUNC_AREA?mu(t,e):pu(e,t.type);return new lr({style:{x:8,y:20,text:`#${i}#`,zIndex:1,fill:Lc.TEXT},name:"grade-small"})}(t,e),s=function(t,e){const i=e===jc.FUNC_AREA,a=i&&t.type===Kc.USER_DEFINE?(t=>{const e=[],i=[...t.area_group];return Object.keys(t.oba_define_params).length>1&&e.push(eh("label.specialAvoidanceArea")),i.forEach(t=>{const i=dh(t);i&&e.push(i)}),rh(i,ch,rd.MINUS).length>0&&e.push(eh("label.regionTypeReserved")),-1!==t.volume&&e.push(eh("label.musicControlRegion")),e})(t):[pu(e,t.type)],s=[],n=Math.abs((t["pa.y"]-t["pc.y"])/Sc);if(i)for(let t=0,e=a.length;t<e;t++){const i=40+20*t,o=t+1>=e||i+20<=n,r=new lr({style:{x:8,y:i,text:`${a[t]}${o?"":"..."}`,zIndex:1,fill:Lc.TEXT},name:"grade-small"});if(s.push(r),!o)break}else{const i=e===jc.NOTE_AREA,a=Math.abs((t["pc.x"]-t["pa.x"])/Sc);let c=16,d=Lc.TEXT,h="left",[u,p]=[8,40];if(i){var o,r,l;c=t.style.fontSize,d=t.style.color,h=t.style.justifyContent;const{alignItems:e}=t.style,i={top:()=>{p=c+20},center:()=>{p=(n+c)/2},bottom:()=>{p=n-8}};null!==(o=(r={left:()=>{u=8},center:()=>{u=a/2},right:()=>{u=a-8}})[h])&&void 0!==o&&o.call(r),null===(l=i[e])||void 0===l||l.call(i)}const m=new lr({style:{x:u,y:p,text:mu(t,e),zIndex:1,fontSize:c,textAlign:h,fill:d},name:"grade-small"});s.push(m)}return s}(t,e);i.push(a,...s)}return i}function _u(t){switch(t){case Hc.NONE:return"QR";case Hc.STATION_CORRECTION:return"SCQR";case Hc.FUSE_LOCATE:return"FLQR";case Hc.TEXTURE_LOCATE:return"WLQR";default:return"QR"}}function yu(t){t.hasOwnProperty("type")||(t.type=Hc.STATION_CORRECTION);const e=function(t){switch(t){case Hc.NONE:return Dc.NORMAL;case Hc.STATION_CORRECTION:return Dc.STATION_CORRECTION;case Hc.FUSE_LOCATE:return Dc.FUSE_LOCATE;case Hc.TEXTURE_LOCATE:return Dc.TEXTURE_LOCATE;default:return Dc.NORMAL}}(t.type),i=new rr({style:{x:-15,y:-15,width:30,height:30,fill:e,stroke:e,fillOpacity:.5,lineWidth:1,transformOrigin:"center"}}),a=new lr({name:"grade-small",style:{x:0,y:35,text:_u(t.type)+t.dmcode_id,fill:e,zIndex:1,textAlign:"center"}}),s=new Wh({style:{body:new ar({style:{x1:0,y1:0,x2:30,y2:0,transformOrigin:"center"}}),endHead:!0,stroke:Fc.AXIS_X,lineWidth:1}}),n=new Wh({style:{body:new ar({style:{x1:0,y1:0,x2:0,y2:-30,transformOrigin:"center"}}),endHead:!0,stroke:Fc.AXIS_Y,lineWidth:1}}),o=-Zd(t.yaw/Ic),r=new tr({id:`${jc.DMCODE}-${t.type||Hc.STATION_CORRECTION}-${t.dmcode_id}`});return i.rotate(o),s.rotate(o),n.rotate(o),r.setPosition(t.x/Sc,-t.y/Sc),r.append(i,a,s,n),r}function vu(t,e){const i=new tr({id:`${jc.FEATURE}-0-${t.id}`}),a=function(t){switch(t){case nd.FEATURE_RUNTIME:return Nc.RUNTIME;case nd.FEATURE_NORMAL:default:return Nc.NORMAL}}(e),s=new Xo({style:{cx:0,cy:0,r:10,fill:"transparent",stroke:a,lineWidth:1}});if("FEATURE_LMK"===t.feature_name){const t=new ar({style:{x1:-10,y1:0,x2:10,y2:0,stroke:a,lineWidth:2}}),e=new ar({style:{x1:0,y1:-10,x2:0,y2:10,stroke:a,lineWidth:2}});i.append(s,t,e)}else if("FEATURE_TRI"===t.feature_name){const t=new sr({style:{path:[["M",8,-6],["L",-8,0],["L",8,7]],stroke:a,lineWidth:2}});i.append(s,t)}else if("FEATURE_CORNER"===t.feature_name){const t=new sr({style:{path:[["M",7,-7],["L",7,7],["L",-7,7]],stroke:a,lineWidth:2}});i.append(s,t)}else if("FEATURE_ARTICORNER"===t.feature_name){const t=new sr({style:{path:[["M",-4,-9],["L",-10,0],["L",-4,9]],stroke:a,lineWidth:2}});i.append(s,t)}else if(t.feature_type===id.FM){const t=new sr({style:{path:[["M",-7,-7],["L",-7,7],["L",7,7],["L",7,-7],["L",-7,-7],["M",-3,-3],["L",-3,3],["L",3,3],["L",3,-3],["L",-3,-3]],stroke:a,lineWidth:2}});i.append(s,t)}else if(t.feature_type===id.DM){const t=new sr({style:{path:[["M",-7,-7],["L",-7,7],["L",7,7],["L",7,-7],["L",-7,-7],["M",-3,-7],["L",-3,7],["M",-7,3],["L",7,3]],stroke:a,lineWidth:2}});i.append(s,t)}return i.setPosition(t["pos.x"]/Cc,-t["pos.y"]/Cc),i}function bu(t){const e=new tr({id:`${jc.STATION_FEATURE_BIND}-0-${t.id}`}),i=new ar({style:{x1:t.sx,y1:t.sy,x2:t.ex,y2:t.ey,lineWidth:2,lineDash:[10,10],stroke:Nc.NORMAL}}),a=new lr({style:{x:.3*(t.ex-t.sx)+t.sx+10,y:.3*(t.ey-t.sy)+t.sy-10,text:t.name,zIndex:1,fill:Nc.NORMAL},name:"grade-small"});return e.append(i,a),e}function Eu(t){const e=new tr({id:`${jc.TAG}-0-${t.id}`}),i=new Xo({style:{cx:0,cy:0,r:8,fill:"transparent",stroke:Oc.NORMAL,lineWidth:2}}),a=new lr({name:"grade-small",style:{x:-12,y:-8,text:`T${t.id}`,fill:Oc.NORMAL,zIndex:1,textAlign:"right"}}),s=new Wh({style:{body:new ar({style:{x1:0,y1:0,x2:24,y2:0}}),endHead:!0,stroke:Oc.NORMAL,lineWidth:2}});return s.rotate(Zd(-t.yaw/Ic)),e.append(i,a,s),e.setPosition(t.x/Sc,-t.y/Sc),e}function Au(t){const e=function(t){switch(t){case!0:return kc.MATCHED;case!1:return kc.UN_MATCHED;default:return kc.NORMAL}}(t.isMatched),i=new tr({interactive:!1}),a=t.lmkType||t.type;if(a===sd.TYPE_FLAT){const t=new rr({style:{x:-9,y:-6,width:18,height:12,fill:e}});i.append(t)}else if(a===sd.TYPE_CYLINDER){const t=new Xo({style:{cx:0,cy:0,r:10,fill:"transparent",stroke:e,lineWidth:2}}),a=new ar({style:{x1:-10,y1:0,x2:10,y2:0,stroke:e,lineWidth:2}}),s=new ar({style:{x1:0,y1:-10,x2:0,y2:10,stroke:e,lineWidth:2}});i.append(t,a,s)}const s=new lr({name:"grade-small",style:{x:0,y:30,text:`(${(t.x/100).toFixed(2)}m, ${(t.y/100).toFixed(2)}m)`,fill:e,zIndex:1,textAlign:"center"}});return i.append(s),i.setPosition(t.x,-t.y),i}function wu(t,e,i){return new sr({style:{path:[...t.vertexs.map((t,e)=>0===e?["M",t.x/Sc,-t.y/Sc]:["L",t.x/Sc,-t.y/Sc]),["Z"]],stroke:i,lineWidth:e}})}!function(t){function e(e){var i=t.call(this,e)||this;return i.updatePath(),i}o(e,t),e.prototype.setAttribute=function(e,i,a){t.prototype.setAttribute.call(this,e,i,a),["startAngle","endAngle","sr","sr0","radius"].indexOf(e)>-1&&this.updatePath()},e.prototype.updatePath=function(){var e=this.parsedStyle,i=e.x,a=e.y,s=e.startAngle,n=e.endAngle,o=e.sr,r=e.sr0,l=e.radius,c=this.createPath(i,a,s?Ci(s):0,n?Ci(n):2*Math.PI,o||0,r||0,l||[0,0,0,0]);t.prototype.setAttribute.call(this,"path",c)},e.prototype.createPath=function(t,e,i,a,s,n,o){if(!(s<=0)){var r=su(t,e,s,i),l=su(t,e,s,a),c=su(t,e,n,i),d=su(t,e,n,a);if(ye(a-i,2*Math.PI)){var h=su(t,e,s,i+Math.PI),p=su(t,e,n,i+Math.PI),m=[["M",r.x,r.y],["A",s,s,0,1,1,h.x,h.y],["A",s,s,0,1,1,l.x,l.y],["M",c.x,c.y]];return n&&(m.push(["A",n,n,0,1,0,p.x,p.y]),m.push(["A",n,n,0,1,0,d.x,d.y])),m.push(["M",r.x,r.y]),m.push(["Z"]),m}var f=a-i,g=s*Xh(i),_=s*Qh(i),y=n*Xh(a),v=n*Qh(a),b=s*Xh(a),E=s*Qh(a),A=n*Xh(i),w=n*Qh(i),S=u(o,4),C=S[0],I=S[1],x=S[2],T=S[3],M=(s-n)/2,P=iu(M,C),O=iu(M,I),L=iu(M,x),R=iu(M,T),D=eu(P,O),N=eu(L,R),k=D,F=N;if((D>au||N>au)&&f<Hh){var $=function(t,e,i,a,s,n,o,r){var l=i-t,c=a-e,d=o-s,h=r-n,u=h*l-d*c;if(!(u*u<au))return[t+(u=(d*(e-n)-h*(t-s))/u)*l,e+u*c]}(g,_,A,w,b,E,y,v);if($){var q=g-$[0],G=_-$[1],B=b-$[0],j=E-$[1],U=1/Qh(Jh((q*B+G*j)/(tu(q*q+G*G)*tu(B*B+j*j)))/2),Y=tu($[0]*$[0]+$[1]*$[1]);k=iu(D,(s-Y)/(U+1)),F=iu(N,(n-Y)/(U-1))}}var z=ou(i,a),V=!0,W=[];if(k>au){var H=iu(C,k),K=iu(I,k),Q=nu(A,w,g,_,s,H,V),X=nu(b,E,y,v,s,K,V);if(W.push(["M",t+Q.cx+Q.x0,e+Q.cy+Q.y0]),k<D&&H===K){var J=Zh(Q.y0,Q.x0),Z=Zh(X.y0,X.x0);W.push(["A",k,k,0,ou(J,Z),1,t+X.cx+X.x0,e+X.cy+X.y0])}else{if(H>0){J=Zh(Q.y0,Q.x0),Z=Zh(Q.y1,Q.x1);var tt=su(t,e,s,Z);W.push(["A",H,H,0,ou(J,Z),1,tt.x,tt.y])}var et=Zh(Q.cy+Q.y1,Q.cx+Q.x1),it=Zh(X.cy+X.y1,X.cx+X.x1),at=su(t,e,s,it);if(W.push(["A",s,s,0,ou(et,it),1,at.x,at.y]),K>0){var st=Zh(X.y1,X.x1),nt=Zh(X.y0,X.x0);W.push(["A",K,K,0,ou(st,nt),1,t+X.cx+X.x0,e+X.cy+X.y0])}}}else W.push(["M",r.x,r.y]),W.push(["A",s,s,0,z,1,l.x,l.y]);if(n<au)W.push(["L",d.x,d.y]);else if(F>au)if(H=iu(T,F),Q=nu(y,v,0,0,n-s,K=iu(x,F),V),X=nu(0,0,A,w,n-s,H,V),W.push(["L",t+Q.cx+Q.x0,e+Q.cy+Q.y0]),F<N&&H===K){var ot=Zh(Q.y0,Q.x0),rt=Zh(X.y0,X.x0),lt=su(t,e,n,rt);W.push(["A",k,k,0,ou(ot,rt),1,lt.x,lt.y])}else{K>0&&(ot=Zh(Q.y0,Q.x0),rt=Zh(Q.y1,Q.x1),lt=su(t,e,n-s,rt),W.push(["A",K,K,0,ou(ot,rt),1,lt.x,lt.y]));var ct=Zh(Q.cy+Q.y1,Q.cx+Q.x1),dt=Zh(X.cy+X.y1,X.cx+X.x1),ht=su(t,e,n,dt);if(W.push(["A",n,n,0,ou(dt,ct),0,ht.x,ht.y]),W.push(["L",ht.x,ht.y]),H>0){var ut=Zh(X.y1,X.x1),pt=Zh(X.y0,X.x0);W.push(["A",H,H,0,ou(ut,pt),1,t+X.cx+X.x0,e+X.cy+X.y0])}}else W.push(["L",d.x,d.y]),W.push(["A",n,n,0,z,0,c.x,c.y]);return W.push(["Z"]),W}}}(sr);class Su{constructor(t){Object.defineProperty(this,"itemGroup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"yaw",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.x=t.x,this.y=t.y,this.yaw=0,this.itemGroup=function(t){const e=new tr({interactive:!1,zIndex:qc.LOCATE_MOVE}),i=new Xo({style:{cx:0,cy:0,r:24,fill:"transparent",stroke:Fc.NAVIGATE_TO_POINT,lineWidth:$c.DEFAULT_STROKE_WIDTH}}),a=new ar({style:{x1:-30,y1:-30,x2:30,y2:30,stroke:Fc.NAVIGATE_TO_POINT,lineWidth:$c.DEFAULT_STROKE_WIDTH}}),s=new ar({style:{x1:-30,y1:30,x2:30,y2:-30,stroke:Fc.NAVIGATE_TO_POINT,lineWidth:$c.DEFAULT_STROKE_WIDTH}}),n=new Wh({style:{body:new ar({style:{x1:0,y1:0,x2:48,y2:0}}),endHead:!0,stroke:Fc.NAVIGATE_TO_POINT,lineWidth:$c.DEFAULT_STROKE_WIDTH}});return e.append(i,a,s,n),e.setPosition(t.x,t.y),e}(t)}setYaw(t){this.yaw=t;const e=this.itemGroup.lastChild;e&&e.setEulerAngles(Zd(t))}getTargetPose(){return{x:this.x*Sc,y:-this.y*Sc,yaw:-this.yaw*Ic}}}class Cu{constructor(){Object.defineProperty(this,"itemGroup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lineItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"textItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"assistItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dat",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.dat=[],this.itemGroup=null,this.lineItem=null,this.textItem=null,this.assistItem=null}createInitialShape(t,e){this.dat=[{x:t,y:e}],this.itemGroup=new tr({interactive:!1}),this.lineItem=new ar({style:{x1:t,y1:e,x2:t,y2:e,stroke:Fc.CALC_DISTANCE,lineWidth:$c.DEFAULT_STROKE_WIDTH}}),this.assistItem=new sr({name:"calculate-distance-assist",style:{path:[],stroke:Fc.ASSIST_LINE,lineDash:[2,2],lineWidth:$c.GRID_STROKE_WIDTH}}),this.textItem=new lr({name:"grade-small",style:{x:t,y:t,text:"",fontSize:14,fill:Fc.SELECT_AREA_STROKE,zIndex:1,textAlign:"center"}}),this.itemGroup.append(this.assistItem,this.lineItem,this.textItem)}createModifyShape(t,e){var i;this.dat.push({x:t,y:e}),this.lineItem&&(this.lineItem.setAttribute("x2",t),this.lineItem.setAttribute("y2",e));const a=this.getTargetTotalLength(),s=this.dat[0].x,n=this.dat[0].y,o=n===e&&s<=t?[]:[["M",s,n],["L",s+a,n],["A",a,a,0,0,n<=e?1:0,t,e]];null!==(i=this.assistItem)&&void 0!==i&&i.setAttribute("path",o),this.textItem&&(this.textItem.setAttribute("x",t+20),this.textItem.setAttribute("y",e-20),this.textItem.setAttribute("text",`${(a/100).toFixed(2)}m ${Zd(Math.atan2(e-n,t-s)).toFixed(2)}Â°`))}endDraw(){var t;const e=this.getTargetTotalLength();if(e){var i,a,s,n,o,r;null===(i=this.assistItem)||void 0===i||i.setAttribute("visibility","hidden");const t=null===(a=this.lineItem)||void 0===a?void 0:a.getPoint(.5);t&&(null!==(s=this.textItem)&&void 0!==s&&s.setAttribute("x",t.x),null!==(n=this.textItem)&&void 0!==n&&n.setAttribute("y",t.y),null!==(o=this.textItem)&&void 0!==o&&o.setAttribute("fill",Fc.CALC_DISTANCE),null===(r=this.textItem)||void 0===r||r.setAttribute("text",`${(e/100).toFixed(2)}m`))}else null===(t=this.itemGroup)||void 0===t||t.remove();return e}getTargetTotalLength(){var t;return(null===(t=this.lineItem)||void 0===t?void 0:t.getTotalLength())||0}}class Iu{constructor(t){Object.defineProperty(this,"baseCreator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shapeItemList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseCreator=t,this.shapeItemList=[]}async paintList(t){return await async function(t,e,i={}){const a=await async function(t){return new Promise((e,i)=>{const a=[];if("function"==typeof t&&(t=t()),!t||"function"!=typeof t.next)return e({state:!1,list:[]});!function i(){const s=performance.now();let n=null;do{var o;n=t.next()}while(!0!==n.done&&null!==(o=n.value)&&void 0!==o&&o.state&&performance.now()-s<2e3);return n.done?e({state:!0,list:a}):n.value&&(a.push(n.value),!n.value.state)?e({state:!1,list:a}):void(window.requestIdleCallback?window.requestIdleCallback(i,{timeout:0}):window.requestAnimationFrame(i))}()})}(function*(){let a=0;for(;a<e.length;){const s={index:a,data:null,state:!0};try{s.data=t.call(this,e[a],a,e,i)}catch(t){s.state=!1}yield s,a++}});return a}(t=>{this.createShapeItem(t)},t)}createShapeItem(t){}getOneItem(t=0){return this.shapeItemList.find(e=>e.getID()===t)||null}addItemToList(t){if(!t)return null;const e=t.dataModel.baseType,i=t.getID(),a=t.getName(),s={key:e+a,label:a,id:i,value:i,type:e,isSelected:!1,isActive:!1,isExpand:!1,level:1};if(e===jc.EDGE_GROUP){const e=t.dataModel.getEdgeIds().map(t=>{const e=`e${t}`,a=jc.EDGE;return{key:a+e,label:e,id:t,value:t,type:a,isSelected:!1,isActive:!1,isExpand:!1,level:2,groupId:i}});s.edges=e}return this.baseCreator.modifyGraphLabel(Wc.ADD,s),s}updateItemFromList(t,e=0){if(!t)return null;const i=t.dataModel.baseType,a=t.getID(),s=t.getName(),n={oldId:e,id:a,value:a,key:i+s,label:s,type:i,level:1};return this.baseCreator.modifyGraphLabel(Wc.UPDATE,n),n}deleteItemFromList(t){t&&this.baseCreator.modifyGraphLabel(Wc.DELETE,{id:t.getID(),type:t.getBaseType()})}deleteShapeItem(t,e=jc.NONE){const i=this.shapeItemList.findIndex(i=>i.getID()===t&&(jc.NONE===e||i.getBaseType()===e));return~i?this.shapeItemList.splice(i,1)[0]:null}drawBefore(t){}drawStart(t){}drawing(t){}drawEnd(t){}drawAfter(){}drawCancel(){}moveTo(t,e,i,a,s){}async deleteAll(){const t=[...this.shapeItemList];for(const e of t)await this.delete(e.getID())}async delete(t,e=jc.NONE){const i=this.deleteShapeItem(t,e);i&&(this.deleteItemFromList(i),this.baseCreator.stageModel.updateSelectedItemList([i],Wc.DELETE),i.delete())}}var xu={exports:{}};!function(t){t.exports=function(){function e(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,a)}return i}function i(t){for(var i=1;i<arguments.length;i++){var a=null!=arguments[i]?arguments[i]:{};i%2?e(Object(a),!0).forEach(function(e){r(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):e(Object(a)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,m(a.key),a)}}function o(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function r(t,e,i){return(e=m(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&d(t,e)}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}function d(t,e){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},d(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var i,a=c(t);if(e){var s=c(this).constructor;i=Reflect.construct(a,arguments,s)}else i=a.apply(this,arguments);return function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}(this,i)}}function p(){return p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var a=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(a){var s=Object.getOwnPropertyDescriptor(a,e);return s.get?s.get.call(arguments.length<3?t:i):s.value}},p.apply(this,arguments)}function m(t){var e=function(t){if("object"!=typeof t||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}var f=function(t){return!(!t||!t.Window)&&t instanceof t.Window},g=void 0,_=void 0;function y(t){g=t;var e=t.document.createTextNode("");e.ownerDocument!==t.document&&"function"==typeof t.wrap&&t.wrap(e)===e&&(t=t.wrap(t)),_=t}function v(t){return f(t)?t:(t.ownerDocument||t).defaultView||_.window}"undefined"!=typeof window&&window&&y(window);var b=function(t){return!!t&&"object"===a(t)},E=function(t){return"function"==typeof t},A=function(t){return t===_||f(t)},w=function(t){return b(t)&&11===t.nodeType},S=b,C=E,I=function(t){return"number"==typeof t},x=function(t){return"boolean"==typeof t},T=function(t){return"string"==typeof t},M=function(t){if(!t||"object"!==a(t))return!1;var e=v(t)||_;return/object|function/.test("undefined"==typeof Element?"undefined":a(Element))?t instanceof Element||t instanceof e.Element:1===t.nodeType&&"string"==typeof t.nodeName},P=function(t){return b(t)&&!!t.constructor&&/function Object\b/.test(t.constructor.toString())},O=function(t){return b(t)&&void 0!==t.length&&E(t.splice)};function L(t){var e=t.interaction;if("drag"===e.prepared.name){var i=e.prepared.axis;"x"===i?(e.coords.cur.page.y=e.coords.start.page.y,e.coords.cur.client.y=e.coords.start.client.y,e.coords.velocity.client.y=0,e.coords.velocity.page.y=0):"y"===i&&(e.coords.cur.page.x=e.coords.start.page.x,e.coords.cur.client.x=e.coords.start.client.x,e.coords.velocity.client.x=0,e.coords.velocity.page.x=0)}}function R(t){var e=t.iEvent,i=t.interaction;if("drag"===i.prepared.name){var a=i.prepared.axis;if("x"===a||"y"===a){var s="x"===a?"y":"x";e.page[s]=i.coords.start.page[s],e.client[s]=i.coords.start.client[s],e.delta[s]=0}}}var D={id:"actions/drag",install:function(t){var e=t.actions,i=t.Interactable,a=t.defaults;i.prototype.draggable=D.draggable,e.map.drag=D,e.methodDict.drag="draggable",a.actions.drag=D.defaults},listeners:{"interactions:before-action-move":L,"interactions:action-resume":L,"interactions:action-move":R,"auto-start:check":function(t){var e=t.interaction,i=t.interactable,a=t.buttons,s=i.options.drag;if(s&&s.enabled&&(!e.pointerIsDown||!/mouse|pointer/.test(e.pointerType)||0!=(a&i.options.drag.mouseButtons)))return t.action={name:"drag",axis:"start"===s.lockAxis?s.startAxis:s.lockAxis},!1}},draggable:function(t){return S(t)?(this.options.drag.enabled=!1!==t.enabled,this.setPerAction("drag",t),this.setOnEvents("drag",t),/^(xy|x|y|start)$/.test(t.lockAxis)&&(this.options.drag.lockAxis=t.lockAxis),/^(xy|x|y)$/.test(t.startAxis)&&(this.options.drag.startAxis=t.startAxis),this):x(t)?(this.options.drag.enabled=t,this):this.options.drag},beforeMove:L,move:R,defaults:{startAxis:"xy",lockAxis:"xy"},getCursor:function(){return"move"},filterEventType:function(t){return 0===t.search("drag")}},N=D,k={init:function(t){var e=t;k.document=e.document,k.DocumentFragment=e.DocumentFragment||F,k.SVGElement=e.SVGElement||F,k.SVGSVGElement=e.SVGSVGElement||F,k.SVGElementInstance=e.SVGElementInstance||F,k.Element=e.Element||F,k.HTMLElement=e.HTMLElement||k.Element,k.Event=e.Event,k.Touch=e.Touch||F,k.PointerEvent=e.PointerEvent||e.MSPointerEvent},document:null,DocumentFragment:null,SVGElement:null,SVGSVGElement:null,SVGElementInstance:null,Element:null,HTMLElement:null,Event:null,Touch:null,PointerEvent:null};function F(){}var $=k,q={init:function(t){var e=$.Element,i=t.navigator||{};q.supportsTouch="ontouchstart"in t||C(t.DocumentTouch)&&$.document instanceof t.DocumentTouch,q.supportsPointerEvent=!1!==i.pointerEnabled&&!!$.PointerEvent,q.isIOS=/iP(hone|od|ad)/.test(i.platform),q.isIOS7=/iP(hone|od|ad)/.test(i.platform)&&/OS 7[^\d]/.test(i.appVersion),q.isIe9=/MSIE 9/.test(i.userAgent),q.isOperaMobile="Opera"===i.appName&&q.supportsTouch&&/Presto/.test(i.userAgent),q.prefixedMatchesSelector="matches"in e.prototype?"matches":"webkitMatchesSelector"in e.prototype?"webkitMatchesSelector":"mozMatchesSelector"in e.prototype?"mozMatchesSelector":"oMatchesSelector"in e.prototype?"oMatchesSelector":"msMatchesSelector",q.pEventTypes=q.supportsPointerEvent?$.PointerEvent===t.MSPointerEvent?{up:"MSPointerUp",down:"MSPointerDown",over:"mouseover",out:"mouseout",move:"MSPointerMove",cancel:"MSPointerCancel"}:{up:"pointerup",down:"pointerdown",over:"pointerover",out:"pointerout",move:"pointermove",cancel:"pointercancel"}:null,q.wheelEvent=$.document&&"onmousewheel"in $.document?"mousewheel":"wheel"},supportsTouch:null,supportsPointerEvent:null,isIOS7:null,isIOS:null,isIe9:null,isOperaMobile:null,prefixedMatchesSelector:null,pEventTypes:null,wheelEvent:null},G=q;function B(t,e){if(t.contains)return t.contains(e);for(;e;){if(e===t)return!0;e=e.parentNode}return!1}function j(t,e){for(;M(t);){if(Y(t,e))return t;t=U(t)}return null}function U(t){var e=t.parentNode;if(w(e)){for(;(e=e.host)&&w(e););return e}return e}function Y(t,e){return _!==g&&(e=e.replace(/\/deep\//g," ")),t[G.prefixedMatchesSelector](e)}var z=function(t){return t.parentNode||t.host};function V(t,e){for(var i,a=[],s=t;(i=z(s))&&s!==e&&i!==s.ownerDocument;)a.unshift(s),s=i;return a}function W(t,e,i){for(;M(t);){if(Y(t,e))return!0;if((t=U(t))===i)return Y(t,e)}return!1}function H(t){return t.correspondingUseElement||t}function K(t){var e=t instanceof $.SVGElement?t.getBoundingClientRect():t.getClientRects()[0];return e&&{left:e.left,right:e.right,top:e.top,bottom:e.bottom,width:e.width||e.right-e.left,height:e.height||e.bottom-e.top}}function Q(t){var e,i=K(t);if(!G.isIOS7&&i){var a={x:(e=(e=v(t))||_).scrollX||e.document.documentElement.scrollLeft,y:e.scrollY||e.document.documentElement.scrollTop};i.left+=a.x,i.right+=a.x,i.top+=a.y,i.bottom+=a.y}return i}function X(t){for(var e=[];t;)e.push(t),t=U(t);return e}function J(t){return!!T(t)&&($.document.querySelector(t),!0)}function Z(t,e){for(var i in e)t[i]=e[i];return t}function tt(t,e,i){return"parent"===t?U(i):"self"===t?e.getRect(i):j(i,t)}function et(t,e,i,a){var s=t;return T(s)?s=tt(s,e,i):C(s)&&(s=s.apply(void 0,a)),M(s)&&(s=Q(s)),s}function it(t){return t&&{x:"x"in t?t.x:t.left,y:"y"in t?t.y:t.top}}function at(t){return!t||"x"in t&&"y"in t||((t=Z({},t)).x=t.left||0,t.y=t.top||0,t.width=t.width||(t.right||0)-t.x,t.height=t.height||(t.bottom||0)-t.y),t}function st(t,e,i){t.left&&(e.left+=i.x),t.right&&(e.right+=i.x),t.top&&(e.top+=i.y),t.bottom&&(e.bottom+=i.y),e.width=e.right-e.left,e.height=e.bottom-e.top}function nt(t,e,i){var a=i&&t.options[i];return it(et(a&&a.origin||t.options.origin,t,e,[t&&e]))||{x:0,y:0}}function ot(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){return!0},a=arguments.length>3?arguments[3]:void 0;if(a=a||{},T(t)&&-1!==t.search(" ")&&(t=rt(t)),O(t))return t.forEach(function(t){return ot(t,e,i,a)}),a;if(S(t)&&(e=t,t=""),C(e)&&i(t))a[t]=a[t]||[],a[t].push(e);else if(O(e))for(var s=0,n=e;s<n.length;s++){var o=n[s];ot(t,o,i,a)}else if(S(e))for(var r in e)ot(rt(r).map(function(e){return"".concat(t).concat(e)}),e[r],i,a);return a}function rt(t){return t.trim().split(/ +/)}var lt=function(t,e){return Math.sqrt(t*t+e*e)},ct=["webkit","moz"];function dt(t,e){t.__set||(t.__set={});var i=function(i){if(ct.some(function(t){return 0===i.indexOf(t)}))return 1;"function"!=typeof t[i]&&"__set"!==i&&Object.defineProperty(t,i,{get:function(){return i in t.__set?t.__set[i]:t.__set[i]=e[i]},set:function(e){t.__set[i]=e},configurable:!0})};for(var a in e)i(a);return t}function ht(t,e){t.page=t.page||{},t.page.x=e.page.x,t.page.y=e.page.y,t.client=t.client||{},t.client.x=e.client.x,t.client.y=e.client.y,t.timeStamp=e.timeStamp}function ut(t){t.page.x=0,t.page.y=0,t.client.x=0,t.client.y=0}function pt(t){return t instanceof $.Event||t instanceof $.Touch}function mt(t,e,i){return t=t||"page",(i=i||{}).x=e[t+"X"],i.y=e[t+"Y"],i}function ft(t,e){return e=e||{x:0,y:0},G.isOperaMobile&&pt(t)?(mt("screen",t,e),e.x+=window.scrollX,e.y+=window.scrollY):mt("page",t,e),e}function gt(t){return I(t.pointerId)?t.pointerId:t.identifier}function _t(t){var e=[];return O(t)?(e[0]=t[0],e[1]=t[1]):"touchend"===t.type?1===t.touches.length?(e[0]=t.touches[0],e[1]=t.changedTouches[0]):0===t.touches.length&&(e[0]=t.changedTouches[0],e[1]=t.changedTouches[1]):(e[0]=t.touches[0],e[1]=t.touches[1]),e}function yt(t){for(var e={pageX:0,pageY:0,clientX:0,clientY:0,screenX:0,screenY:0},i=0;i<t.length;i++){var a=t[i];for(var s in e)e[s]+=a[s]}for(var n in e)e[n]/=t.length;return e}function vt(t){if(!t.length)return null;var e=_t(t),i=Math.min(e[0].pageX,e[1].pageX),a=Math.min(e[0].pageY,e[1].pageY),s=Math.max(e[0].pageX,e[1].pageX),n=Math.max(e[0].pageY,e[1].pageY);return{x:i,y:a,left:i,top:a,right:s,bottom:n,width:s-i,height:n-a}}function bt(t,e){var i=e+"X",a=e+"Y",s=_t(t),n=s[0][i]-s[1][i],o=s[0][a]-s[1][a];return lt(n,o)}function Et(t,e){var i=e+"X",a=e+"Y",s=_t(t),n=s[1][i]-s[0][i],o=s[1][a]-s[0][a];return 180*Math.atan2(o,n)/Math.PI}function At(t){return T(t.pointerType)?t.pointerType:I(t.pointerType)?[void 0,void 0,"touch","pen","mouse"][t.pointerType]:/touch/.test(t.type||"")||t instanceof $.Touch?"touch":"mouse"}function wt(t){var e=C(t.composedPath)?t.composedPath():t.path;return[H(e?e[0]:t.target),H(t.currentTarget)]}var St=function(){function t(e){s(this,t),this.immediatePropagationStopped=!1,this.propagationStopped=!1,this._interaction=e}return o(t,[{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),t}();Object.defineProperty(St.prototype,"interaction",{get:function(){return this._interaction._proxy},set:function(){}});var Ct=function(t,e){for(var i=0;i<e.length;i++){var a=e[i];t.push(a)}return t},It=function(t){return Ct([],t)},xt=function(t,e){for(var i=0;i<t.length;i++)if(e(t[i],i,t))return i;return-1},Tt=function(t,e){return t[xt(t,e)]},Mt=function(t){l(i,t);var e=u(i);function i(t,a,n){var o;s(this,i),(o=e.call(this,a._interaction)).dropzone=void 0,o.dragEvent=void 0,o.relatedTarget=void 0,o.draggable=void 0,o.propagationStopped=!1,o.immediatePropagationStopped=!1;var r="dragleave"===n?t.prev:t.cur,l=r.element,c=r.dropzone;return o.type=n,o.target=l,o.currentTarget=l,o.dropzone=c,o.dragEvent=a,o.relatedTarget=a.target,o.draggable=a.interactable,o.timeStamp=a.timeStamp,o}return o(i,[{key:"reject",value:function(){var t=this,e=this._interaction.dropState;if("dropactivate"===this.type||this.dropzone&&e.cur.dropzone===this.dropzone&&e.cur.element===this.target)if(e.prev.dropzone=this.dropzone,e.prev.element=this.target,e.rejected=!0,e.events.enter=null,this.stopImmediatePropagation(),"dropactivate"===this.type){var a=e.activeDrops,s=xt(a,function(e){var i=e.dropzone,a=e.element;return i===t.dropzone&&a===t.target});e.activeDrops.splice(s,1);var n=new i(e,this.dragEvent,"dropdeactivate");n.dropzone=this.dropzone,n.target=this.target,this.dropzone.fire(n)}else this.dropzone.fire(new i(e,this.dragEvent,"dragleave"))}},{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),i}(St);function Pt(t,e){for(var i=0,a=t.slice();i<a.length;i++){var s=a[i],n=s.dropzone,o=s.element;e.dropzone=n,e.target=o,n.fire(e),e.propagationStopped=e.immediatePropagationStopped=!1}}function Ot(t,e){for(var i=function(t,e){for(var i=[],a=0,s=t.interactables.list;a<s.length;a++){var n=s[a];if(n.options.drop.enabled){var o=n.options.drop.accept;if(!(M(o)&&o!==e||T(o)&&!Y(e,o)||C(o)&&!o({dropzone:n,draggableElement:e})))for(var r=0,l=n.getAllElements();r<l.length;r++){var c=l[r];c!==e&&i.push({dropzone:n,element:c,rect:n.getRect(c)})}}}return i}(t,e),a=0;a<i.length;a++){var s=i[a];s.rect=s.dropzone.getRect(s.element)}return i}function Lt(t,e,i){for(var a=t.dropState,s=t.interactable,n=t.element,o=[],r=0,l=a.activeDrops;r<l.length;r++){var c=l[r],d=c.dropzone,h=c.element,u=c.rect,p=d.dropCheck(e,i,s,n,h,u);o.push(p?h:null)}var m=function(t){for(var e,i,a,s=[],n=0;n<t.length;n++){var o=t[n],r=t[e];if(o&&n!==e)if(r){var l=z(o),c=z(r);if(l!==o.ownerDocument)if(c!==o.ownerDocument)if(l!==c){s=s.length?s:V(r);var d=void 0;if(r instanceof $.HTMLElement&&o instanceof $.SVGElement&&!(o instanceof $.SVGSVGElement)){if(o===c)continue;d=o.ownerSVGElement}else d=o;for(var h=V(d,r.ownerDocument),u=0;h[u]&&h[u]===s[u];)u++;var p=[h[u-1],h[u],s[u]];if(p[0])for(var m=p[0].lastChild;m;){if(m===p[1]){e=n,s=h;break}if(m===p[2])break;m=m.previousSibling}}else a=r,(parseInt(v(i=o).getComputedStyle(i).zIndex,10)||0)>=(parseInt(v(a).getComputedStyle(a).zIndex,10)||0)&&(e=n);else e=n}else e=n}return e}(o);return a.activeDrops[m]||null}function Rt(t,e,i){var a=t.dropState,s={enter:null,leave:null,activate:null,deactivate:null,move:null,drop:null};return"dragstart"===i.type&&(s.activate=new Mt(a,i,"dropactivate"),s.activate.target=null,s.activate.dropzone=null),"dragend"===i.type&&(s.deactivate=new Mt(a,i,"dropdeactivate"),s.deactivate.target=null,s.deactivate.dropzone=null),a.rejected||(a.cur.element!==a.prev.element&&(a.prev.dropzone&&(s.leave=new Mt(a,i,"dragleave"),i.dragLeave=s.leave.target=a.prev.element,i.prevDropzone=s.leave.dropzone=a.prev.dropzone),a.cur.dropzone&&(s.enter=new Mt(a,i,"dragenter"),i.dragEnter=a.cur.element,i.dropzone=a.cur.dropzone)),"dragend"===i.type&&a.cur.dropzone&&(s.drop=new Mt(a,i,"drop"),i.dropzone=a.cur.dropzone,i.relatedTarget=a.cur.element),"dragmove"===i.type&&a.cur.dropzone&&(s.move=new Mt(a,i,"dropmove"),i.dropzone=a.cur.dropzone)),s}function Dt(t,e){var i=t.dropState,a=i.activeDrops,s=i.cur,n=i.prev;e.leave&&n.dropzone.fire(e.leave),e.enter&&s.dropzone.fire(e.enter),e.move&&s.dropzone.fire(e.move),e.drop&&s.dropzone.fire(e.drop),e.deactivate&&Pt(a,e.deactivate),i.prev.dropzone=s.dropzone,i.prev.element=s.element}function Nt(t,e){var i=t.interaction,a=t.iEvent,s=t.event;if("dragmove"===a.type||"dragend"===a.type){var n=i.dropState;e.dynamicDrop&&(n.activeDrops=Ot(e,i.element));var o=a,r=Lt(i,o,s);n.rejected=n.rejected&&!!r&&r.dropzone===n.cur.dropzone&&r.element===n.cur.element,n.cur.dropzone=r&&r.dropzone,n.cur.element=r&&r.element,n.events=Rt(i,0,o)}}var kt={id:"actions/drop",install:function(t){var e=t.actions,i=t.interactStatic,a=t.Interactable,s=t.defaults;t.usePlugin(N),a.prototype.dropzone=function(t){return function(t,e){if(S(e)){if(t.options.drop.enabled=!1!==e.enabled,e.listeners){var i=ot(e.listeners),a=Object.keys(i).reduce(function(t,e){return t[/^(enter|leave)/.test(e)?"drag".concat(e):/^(activate|deactivate|move)/.test(e)?"drop".concat(e):e]=i[e],t},{}),s=t.options.drop.listeners;s&&t.off(s),t.on(a),t.options.drop.listeners=a}return C(e.ondrop)&&t.on("drop",e.ondrop),C(e.ondropactivate)&&t.on("dropactivate",e.ondropactivate),C(e.ondropdeactivate)&&t.on("dropdeactivate",e.ondropdeactivate),C(e.ondragenter)&&t.on("dragenter",e.ondragenter),C(e.ondragleave)&&t.on("dragleave",e.ondragleave),C(e.ondropmove)&&t.on("dropmove",e.ondropmove),/^(pointer|center)$/.test(e.overlap)?t.options.drop.overlap=e.overlap:I(e.overlap)&&(t.options.drop.overlap=Math.max(Math.min(1,e.overlap),0)),"accept"in e&&(t.options.drop.accept=e.accept),"checker"in e&&(t.options.drop.checker=e.checker),t}return x(e)?(t.options.drop.enabled=e,t):t.options.drop}(this,t)},a.prototype.dropCheck=function(t,e,i,a,s,n){return function(t,e,i,a,s,n,o){var r=!1;if(!(o=o||t.getRect(n)))return!!t.options.drop.checker&&t.options.drop.checker(e,i,r,t,n,a,s);var l=t.options.drop.overlap;if("pointer"===l){var c=nt(a,s,"drag"),d=ft(e);d.x+=c.x,d.y+=c.y;var h=d.x>o.left&&d.x<o.right,u=d.y>o.top&&d.y<o.bottom;r=h&&u}var p=a.getRect(s);if(p&&"center"===l){var m=p.left+p.width/2,f=p.top+p.height/2;r=m>=o.left&&m<=o.right&&f>=o.top&&f<=o.bottom}return p&&I(l)&&(r=Math.max(0,Math.min(o.right,p.right)-Math.max(o.left,p.left))*Math.max(0,Math.min(o.bottom,p.bottom)-Math.max(o.top,p.top))/(p.width*p.height)>=l),t.options.drop.checker&&(r=t.options.drop.checker(e,i,r,t,n,a,s)),r}(this,t,e,i,a,s,n)},i.dynamicDrop=function(e){return x(e)?(t.dynamicDrop=e,i):t.dynamicDrop},Z(e.phaselessTypes,{dragenter:!0,dragleave:!0,dropactivate:!0,dropdeactivate:!0,dropmove:!0,drop:!0}),e.methodDict.drop="dropzone",t.dynamicDrop=!1,s.actions.drop=kt.defaults},listeners:{"interactions:before-action-start":function(t){var e=t.interaction;"drag"===e.prepared.name&&(e.dropState={cur:{dropzone:null,element:null},prev:{dropzone:null,element:null},rejected:null,events:null,activeDrops:[]})},"interactions:after-action-start":function(t,e){var i=t.interaction,a=(t.event,t.iEvent);if("drag"===i.prepared.name){var s=i.dropState;s.activeDrops=[],s.events={},s.activeDrops=Ot(e,i.element),s.events=Rt(i,0,a),s.events.activate&&(Pt(s.activeDrops,s.events.activate),e.fire("actions/drop:start",{interaction:i,dragEvent:a}))}},"interactions:action-move":Nt,"interactions:after-action-move":function(t,e){var i=t.interaction,a=t.iEvent;if("drag"===i.prepared.name){var s=i.dropState;Dt(i,s.events),e.fire("actions/drop:move",{interaction:i,dragEvent:a}),s.events={}}},"interactions:action-end":function(t,e){if("drag"===t.interaction.prepared.name){var i=t.interaction,a=t.iEvent;Nt(t,e),Dt(i,i.dropState.events),e.fire("actions/drop:end",{interaction:i,dragEvent:a})}},"interactions:stop":function(t){var e=t.interaction;if("drag"===e.prepared.name){var i=e.dropState;i&&(i.activeDrops=null,i.events=null,i.cur.dropzone=null,i.cur.element=null,i.prev.dropzone=null,i.prev.element=null,i.rejected=!1)}}},getActiveDrops:Ot,getDrop:Lt,getDropEvents:Rt,fireDropEvents:Dt,filterEventType:function(t){return 0===t.search("drag")||0===t.search("drop")},defaults:{enabled:!1,accept:null,overlap:"pointer"}},Ft=kt;function $t(t){var e=t.interaction,i=t.iEvent,a=t.phase;if("gesture"===e.prepared.name){var s=e.pointers.map(function(t){return t.pointer}),n="start"===a,o="end"===a,r=e.interactable.options.deltaSource;if(i.touches=[s[0],s[1]],n)i.distance=bt(s,r),i.box=vt(s),i.scale=1,i.ds=0,i.angle=Et(s,r),i.da=0,e.gesture.startDistance=i.distance,e.gesture.startAngle=i.angle;else if(o||e.pointers.length<2){var l=e.prevEvent;i.distance=l.distance,i.box=l.box,i.scale=l.scale,i.ds=0,i.angle=l.angle,i.da=0}else i.distance=bt(s,r),i.box=vt(s),i.scale=i.distance/e.gesture.startDistance,i.angle=Et(s,r),i.ds=i.scale-e.gesture.scale,i.da=i.angle-e.gesture.angle;e.gesture.distance=i.distance,e.gesture.angle=i.angle,I(i.scale)&&i.scale!==1/0&&!isNaN(i.scale)&&(e.gesture.scale=i.scale)}}var qt={id:"actions/gesture",before:["actions/drag","actions/resize"],install:function(t){var e=t.actions,i=t.Interactable,a=t.defaults;i.prototype.gesturable=function(t){return S(t)?(this.options.gesture.enabled=!1!==t.enabled,this.setPerAction("gesture",t),this.setOnEvents("gesture",t),this):x(t)?(this.options.gesture.enabled=t,this):this.options.gesture},e.map.gesture=qt,e.methodDict.gesture="gesturable",a.actions.gesture=qt.defaults},listeners:{"interactions:action-start":$t,"interactions:action-move":$t,"interactions:action-end":$t,"interactions:new":function(t){t.interaction.gesture={angle:0,distance:0,scale:1,startAngle:0,startDistance:0}},"auto-start:check":function(t){if(!(t.interaction.pointers.length<2)){var e=t.interactable.options.gesture;if(e&&e.enabled)return t.action={name:"gesture"},!1}}},defaults:{},getCursor:function(){return""},filterEventType:function(t){return 0===t.search("gesture")}},Gt=qt;function Bt(t,e,i,a,s,n,o){if(!e)return!1;if(!0===e){var r=I(n.width)?n.width:n.right-n.left,l=I(n.height)?n.height:n.bottom-n.top;if(o=Math.min(o,Math.abs(("left"===t||"right"===t?r:l)/2)),r<0&&("left"===t?t="right":"right"===t&&(t="left")),l<0&&("top"===t?t="bottom":"bottom"===t&&(t="top")),"left"===t){var c=r>=0?n.left:n.right;return i.x<c+o}if("top"===t){var d=l>=0?n.top:n.bottom;return i.y<d+o}if("right"===t)return i.x>(r>=0?n.right:n.left)-o;if("bottom"===t)return i.y>(l>=0?n.bottom:n.top)-o}return!!M(a)&&(M(e)?e===a:W(a,e,s))}function jt(t){var e=t.iEvent,i=t.interaction;if("resize"===i.prepared.name&&i.resizeAxes){var a=e;i.interactable.options.resize.square?("y"===i.resizeAxes?a.delta.x=a.delta.y:a.delta.y=a.delta.x,a.axes="xy"):(a.axes=i.resizeAxes,"x"===i.resizeAxes?a.delta.y=0:"y"===i.resizeAxes&&(a.delta.x=0))}}var Ut,Yt,zt={id:"actions/resize",before:["actions/drag"],install:function(t){var e=t.actions,i=t.browser,a=t.Interactable,s=t.defaults;zt.cursors=function(t){return t.isIe9?{x:"e-resize",y:"s-resize",xy:"se-resize",top:"n-resize",left:"w-resize",bottom:"s-resize",right:"e-resize",topleft:"se-resize",bottomright:"se-resize",topright:"ne-resize",bottomleft:"ne-resize"}:{x:"ew-resize",y:"ns-resize",xy:"nwse-resize",top:"ns-resize",left:"ew-resize",bottom:"ns-resize",right:"ew-resize",topleft:"nwse-resize",bottomright:"nwse-resize",topright:"nesw-resize",bottomleft:"nesw-resize"}}(i),zt.defaultMargin=i.supportsTouch||i.supportsPointerEvent?20:10,a.prototype.resizable=function(e){return function(t,e,i){return S(e)?(t.options.resize.enabled=!1!==e.enabled,t.setPerAction("resize",e),t.setOnEvents("resize",e),T(e.axis)&&/^x$|^y$|^xy$/.test(e.axis)?t.options.resize.axis=e.axis:null===e.axis&&(t.options.resize.axis=i.defaults.actions.resize.axis),x(e.preserveAspectRatio)?t.options.resize.preserveAspectRatio=e.preserveAspectRatio:x(e.square)&&(t.options.resize.square=e.square),t):x(e)?(t.options.resize.enabled=e,t):t.options.resize}(this,e,t)},e.map.resize=zt,e.methodDict.resize="resizable",s.actions.resize=zt.defaults},listeners:{"interactions:new":function(t){t.interaction.resizeAxes="xy"},"interactions:action-start":function(t){!function(t){var e=t.iEvent,i=t.interaction;if("resize"===i.prepared.name&&i.prepared.edges){var a=e,s=i.rect;i._rects={start:Z({},s),corrected:Z({},s),previous:Z({},s),delta:{left:0,right:0,width:0,top:0,bottom:0,height:0}},a.edges=i.prepared.edges,a.rect=i._rects.corrected,a.deltaRect=i._rects.delta}}(t),jt(t)},"interactions:action-move":function(t){!function(t){var e=t.iEvent,i=t.interaction;if("resize"===i.prepared.name&&i.prepared.edges){var a=e,s=i.interactable.options.resize.invert,n="reposition"===s||"negate"===s,o=i.rect,r=i._rects,l=r.start,c=r.corrected,d=r.delta,h=r.previous;if(Z(h,c),n){if(Z(c,o),"reposition"===s){if(c.top>c.bottom){var u=c.top;c.top=c.bottom,c.bottom=u}if(c.left>c.right){var p=c.left;c.left=c.right,c.right=p}}}else c.top=Math.min(o.top,l.bottom),c.bottom=Math.max(o.bottom,l.top),c.left=Math.min(o.left,l.right),c.right=Math.max(o.right,l.left);for(var m in c.width=c.right-c.left,c.height=c.bottom-c.top,c)d[m]=c[m]-h[m];a.edges=i.prepared.edges,a.rect=c,a.deltaRect=d}}(t),jt(t)},"interactions:action-end":function(t){var e=t.iEvent,i=t.interaction;if("resize"===i.prepared.name&&i.prepared.edges){var a=e;a.edges=i.prepared.edges,a.rect=i._rects.corrected,a.deltaRect=i._rects.delta}},"auto-start:check":function(t){var e=t.interaction,i=t.interactable,a=t.element,s=t.rect,n=t.buttons;if(s){var o=Z({},e.coords.cur.page),r=i.options.resize;if(r&&r.enabled&&(!e.pointerIsDown||!/mouse|pointer/.test(e.pointerType)||0!=(n&r.mouseButtons))){if(S(r.edges)){var l={left:!1,right:!1,top:!1,bottom:!1};for(var c in l)l[c]=Bt(c,r.edges[c],o,e._latestPointer.eventTarget,a,s,r.margin||zt.defaultMargin);l.left=l.left&&!l.right,l.top=l.top&&!l.bottom,(l.left||l.right||l.top||l.bottom)&&(t.action={name:"resize",edges:l})}else{var d="y"!==r.axis&&o.x>s.right-zt.defaultMargin,h="x"!==r.axis&&o.y>s.bottom-zt.defaultMargin;(d||h)&&(t.action={name:"resize",axes:(d?"x":"")+(h?"y":"")})}return!t.action&&void 0}}}},defaults:{square:!1,preserveAspectRatio:!1,axis:"xy",margin:NaN,edges:null,invert:"none"},cursors:null,getCursor:function(t){var e=t.edges,i=t.axis,a=t.name,s=zt.cursors,n=null;if(i)n=s[a+i];else if(e){for(var o="",r=0,l=["top","bottom","left","right"];r<l.length;r++){var c=l[r];e[c]&&(o+=c)}n=s[o]}return n},filterEventType:function(t){return 0===t.search("resize")},defaultMargin:null},Vt=zt,Wt={id:"actions",install:function(t){t.usePlugin(Gt),t.usePlugin(Vt),t.usePlugin(N),t.usePlugin(Ft)}},Ht=0,Kt=function(t){return Ut(t)},Qt=function(t){return Yt(t)},Xt=function(t){if(Ut=t.requestAnimationFrame,Yt=t.cancelAnimationFrame,!Ut)for(var e=["ms","moz","webkit","o"],i=0;i<e.length;i++){var a=e[i];Ut=t["".concat(a,"RequestAnimationFrame")],Yt=t["".concat(a,"CancelAnimationFrame")]||t["".concat(a,"CancelRequestAnimationFrame")]}Ut=Ut&&Ut.bind(t),Yt=Yt&&Yt.bind(t),Ut||(Ut=function(e){var i=Date.now(),a=Math.max(0,16-(i-Ht)),s=t.setTimeout(function(){e(i+a)},a);return Ht=i+a,s},Yt=function(t){return clearTimeout(t)})},Jt={defaults:{enabled:!1,margin:60,container:null,speed:300},now:Date.now,interaction:null,i:0,x:0,y:0,isScrolling:!1,prevTime:0,margin:0,speed:0,start:function(t){Jt.isScrolling=!0,Qt(Jt.i),t.autoScroll=Jt,Jt.interaction=t,Jt.prevTime=Jt.now(),Jt.i=Kt(Jt.scroll)},stop:function(){Jt.isScrolling=!1,Jt.interaction&&(Jt.interaction.autoScroll=null),Qt(Jt.i)},scroll:function(){var t=Jt.interaction,e=t.interactable,i=t.element,a=t.prepared.name,s=e.options[a].autoScroll,n=Zt(s.container,e,i),o=Jt.now(),r=(o-Jt.prevTime)/1e3,l=s.speed*r;if(l>=1){var c={x:Jt.x*l,y:Jt.y*l};if(c.x||c.y){var d=te(n);A(n)?n.scrollBy(c.x,c.y):n&&(n.scrollLeft+=c.x,n.scrollTop+=c.y);var h=te(n),u={x:h.x-d.x,y:h.y-d.y};(u.x||u.y)&&e.fire({type:"autoscroll",target:i,interactable:e,delta:u,interaction:t,container:n})}Jt.prevTime=o}Jt.isScrolling&&(Qt(Jt.i),Jt.i=Kt(Jt.scroll))},check:function(t,e){var i;return null==(i=t.options[e].autoScroll)?void 0:i.enabled},onInteractionMove:function(t){var e=t.interaction,i=t.pointer;if(e.interacting()&&Jt.check(e.interactable,e.prepared.name))if(e.simulation)Jt.x=Jt.y=0;else{var a,s,n,o,r=e.interactable,l=e.element,c=e.prepared.name,d=r.options[c].autoScroll,h=Zt(d.container,r,l);if(A(h))o=i.clientX<Jt.margin,a=i.clientY<Jt.margin,s=i.clientX>h.innerWidth-Jt.margin,n=i.clientY>h.innerHeight-Jt.margin;else{var u=K(h);o=i.clientX<u.left+Jt.margin,a=i.clientY<u.top+Jt.margin,s=i.clientX>u.right-Jt.margin,n=i.clientY>u.bottom-Jt.margin}Jt.x=s?1:o?-1:0,Jt.y=n?1:a?-1:0,Jt.isScrolling||(Jt.margin=d.margin,Jt.speed=d.speed,Jt.start(e))}}};function Zt(t,e,i){return(T(t)?tt(t,e,i):t)||v(i)}function te(t){return A(t)&&(t=window.document.body),{x:t.scrollLeft,y:t.scrollTop}}var ee={id:"auto-scroll",install:function(t){var e=t.defaults,i=t.actions;t.autoScroll=Jt,Jt.now=function(){return t.now()},i.phaselessTypes.autoscroll=!0,e.perAction.autoScroll=Jt.defaults},listeners:{"interactions:new":function(t){t.interaction.autoScroll=null},"interactions:destroy":function(t){t.interaction.autoScroll=null,Jt.stop(),Jt.interaction&&(Jt.interaction=null)},"interactions:stop":Jt.stop,"interactions:action-move":function(t){return Jt.onInteractionMove(t)}}},ie=ee;function ae(t,e){var i=!1;return function(){return i||(_.console.warn(e),i=!0),t.apply(this,arguments)}}function se(t,e){return t.name=e.name,t.axis=e.axis,t.edges=e.edges,t}function ne(t){return x(t)?(this.options.styleCursor=t,this):null===t?(delete this.options.styleCursor,this):this.options.styleCursor}function oe(t){return C(t)?(this.options.actionChecker=t,this):null===t?(delete this.options.actionChecker,this):this.options.actionChecker}var re={id:"auto-start/interactableMethods",install:function(t){var e=t.Interactable;e.prototype.getAction=function(e,i,a,s){var n=function(t,e,i,a,s){var n=t.getRect(a),o={action:null,interactable:t,interaction:i,element:a,rect:n,buttons:e.buttons||{0:1,1:4,3:8,4:16}[e.button]};return s.fire("auto-start:check",o),o.action}(this,i,a,s,t);return this.options.actionChecker?this.options.actionChecker(e,i,n,this,s,a):n},e.prototype.ignoreFrom=ae(function(t){return this._backCompatOption("ignoreFrom",t)},"Interactable.ignoreFrom() has been deprecated. Use Interactble.draggable({ignoreFrom: newValue})."),e.prototype.allowFrom=ae(function(t){return this._backCompatOption("allowFrom",t)},"Interactable.allowFrom() has been deprecated. Use Interactble.draggable({allowFrom: newValue})."),e.prototype.actionChecker=oe,e.prototype.styleCursor=ne}};function le(t,e,i,a,s){return e.testIgnoreAllow(e.options[t.name],i,a)&&e.options[t.name].enabled&&ue(e,i,t,s)?t:null}function ce(t,e,i,a,s,n,o){for(var r=0,l=a.length;r<l;r++){var c=a[r],d=s[r],h=c.getAction(e,i,t,d);if(h){var u=le(h,c,d,n,o);if(u)return{action:u,interactable:c,element:d}}}return{action:null,interactable:null,element:null}}function de(t,e,i,a,s){var n=[],o=[],r=a;function l(t){n.push(t),o.push(r)}for(;M(r);){n=[],o=[],s.interactables.forEachMatch(r,l);var c=ce(t,e,i,n,o,a,s);if(c.action&&!c.interactable.options[c.action.name].manualStart)return c;r=U(r)}return{action:null,interactable:null,element:null}}function he(t,e,i){var a=e.action,s=e.interactable,n=e.element;a=a||{name:null},t.interactable=s,t.element=n,se(t.prepared,a),t.rect=s&&a.name?s.getRect(n):null,fe(t,i),i.fire("autoStart:prepared",{interaction:t})}function ue(t,e,i,a){var s=t.options,n=s[i.name].max,o=s[i.name].maxPerElement,r=a.autoStart.maxInteractions,l=0,c=0,d=0;if(!(n&&o&&r))return!1;for(var h=0,u=a.interactions.list;h<u.length;h++){var p=u[h],m=p.prepared.name;if(p.interacting()){if(++l>=r)return!1;if(p.interactable===t){if((c+=m===i.name?1:0)>=n)return!1;if(p.element===e&&(d++,m===i.name&&d>=o))return!1}}}return r>0}function pe(t,e){return I(t)?(e.autoStart.maxInteractions=t,this):e.autoStart.maxInteractions}function me(t,e,i){var a=i.autoStart.cursorElement;a&&a!==t&&(a.style.cursor=""),t.ownerDocument.documentElement.style.cursor=e,t.style.cursor=e,i.autoStart.cursorElement=e?t:null}function fe(t,e){var i=t.interactable,a=t.element,s=t.prepared;if("mouse"===t.pointerType&&i&&i.options.styleCursor){var n="";if(s.name){var o=i.options[s.name].cursorChecker;n=C(o)?o(s,i,a,t._interacting):e.actions.map[s.name].getCursor(s)}me(t.element,n||"",e)}else e.autoStart.cursorElement&&me(e.autoStart.cursorElement,"",e)}var ge={id:"auto-start/base",before:["actions"],install:function(t){var e=t.interactStatic,i=t.defaults;t.usePlugin(re),i.base.actionChecker=null,i.base.styleCursor=!0,Z(i.perAction,{manualStart:!1,max:1/0,maxPerElement:1,allowFrom:null,ignoreFrom:null,mouseButtons:1}),e.maxInteractions=function(e){return pe(e,t)},t.autoStart={maxInteractions:1/0,withinInteractionLimit:ue,cursorElement:null}},listeners:{"interactions:down":function(t,e){var i=t.interaction,a=t.pointer,s=t.event,n=t.eventTarget;i.interacting()||he(i,de(i,a,s,n,e),e)},"interactions:move":function(t,e){!function(t,e){var i=t.interaction,a=t.pointer,s=t.event,n=t.eventTarget;"mouse"!==i.pointerType||i.pointerIsDown||i.interacting()||he(i,de(i,a,s,n,e),e)}(t,e),function(t,e){var i=t.interaction;if(i.pointerIsDown&&!i.interacting()&&i.pointerWasMoved&&i.prepared.name){e.fire("autoStart:before-start",t);var a=i.interactable,s=i.prepared.name;s&&a&&(a.options[s].manualStart||!ue(a,i.element,i.prepared,e)?i.stop():(i.start(i.prepared,a,i.element),fe(i,e)))}}(t,e)},"interactions:stop":function(t,e){var i=t.interaction,a=i.interactable;a&&a.options.styleCursor&&me(i.element,"",e)}},maxInteractions:pe,withinInteractionLimit:ue,validateAction:le},_e=ge,ye={id:"auto-start/dragAxis",listeners:{"autoStart:before-start":function(t,e){var i=t.interaction,a=t.eventTarget,s=t.dx,n=t.dy;if("drag"===i.prepared.name){var o=Math.abs(s),r=Math.abs(n),l=i.interactable.options.drag,c=l.startAxis,d=o>r?"x":o<r?"y":"xy";if(i.prepared.axis="start"===l.lockAxis?d[0]:l.lockAxis,"xy"!==d&&"xy"!==c&&c!==d){i.prepared.name=null;for(var h=a,u=function(t){if(t!==i.interactable){var s=i.interactable.options.drag;if(!s.manualStart&&t.testIgnoreAllow(s,h,a)){var n=t.getAction(i.downPointer,i.downEvent,i,h);if(n&&"drag"===n.name&&function(t,e){if(!e)return!1;var i=e.options.drag.startAxis;return"xy"===t||"xy"===i||i===t}(d,t)&&_e.validateAction(n,t,h,a,e))return t}}};M(h);){var p=e.interactables.forEachMatch(h,u);if(p){i.prepared.name="drag",i.interactable=p,i.element=h;break}h=U(h)}}}}}};function ve(t){var e=t.prepared&&t.prepared.name;if(!e)return null;var i=t.interactable.options;return i[e].hold||i[e].delay}var be={id:"auto-start/hold",install:function(t){var e=t.defaults;t.usePlugin(_e),e.perAction.hold=0,e.perAction.delay=0},listeners:{"interactions:new":function(t){t.interaction.autoStartHoldTimer=null},"autoStart:prepared":function(t){var e=t.interaction,i=ve(e);i>0&&(e.autoStartHoldTimer=setTimeout(function(){e.start(e.prepared,e.interactable,e.element)},i))},"interactions:move":function(t){var e=t.interaction,i=t.duplicate;e.autoStartHoldTimer&&e.pointerWasMoved&&!i&&(clearTimeout(e.autoStartHoldTimer),e.autoStartHoldTimer=null)},"autoStart:before-start":function(t){var e=t.interaction;ve(e)>0&&(e.prepared.name=null)}},getHoldDuration:ve},Ee=be,Ae={id:"auto-start",install:function(t){t.usePlugin(_e),t.usePlugin(Ee),t.usePlugin(ye)}},we=function(t){return/^(always|never|auto)$/.test(t)?(this.options.preventDefault=t,this):x(t)?(this.options.preventDefault=t?"always":"never",this):this.options.preventDefault};function Se(t){var e=t.interaction,i=t.event;e.interactable&&e.interactable.checkAndPreventDefault(i)}var Ce={id:"core/interactablePreventDefault",install:function(t){var e=t.Interactable;e.prototype.preventDefault=we,e.prototype.checkAndPreventDefault=function(e){return function(t,e,i){var a=t.options.preventDefault;if("never"!==a)if("always"!==a){if(e.events.supportsPassive&&/^touch(start|move)$/.test(i.type)){var s=v(i.target).document,n=e.getDocOptions(s);if(!n||!n.events||!1!==n.events.passive)return}/^(mouse|pointer|touch)*(down|start)/i.test(i.type)||M(i.target)&&Y(i.target,"input,select,textarea,[contenteditable=true],[contenteditable=true] *")||i.preventDefault()}else i.preventDefault()}(this,t,e)},t.interactions.docEvents.push({type:"dragstart",listener:function(e){for(var i=0,a=t.interactions.list;i<a.length;i++){var s=a[i];if(s.element&&(s.element===e.target||B(s.element,e.target)))return void s.interactable.checkAndPreventDefault(e)}}})},listeners:["down","move","up","cancel"].reduce(function(t,e){return t["interactions:".concat(e)]=Se,t},{})};function Ie(t,e){if(e.phaselessTypes[t])return!0;for(var i in e.map)if(0===t.indexOf(i)&&t.substr(i.length)in e.phases)return!0;return!1}function xe(t){var e={};for(var i in t){var a=t[i];P(a)?e[i]=xe(a):O(a)?e[i]=It(a):e[i]=a}return e}var Te=function(){function t(e){s(this,t),this.states=[],this.startOffset={left:0,right:0,top:0,bottom:0},this.startDelta=void 0,this.result=void 0,this.endResult=void 0,this.startEdges=void 0,this.edges=void 0,this.interaction=void 0,this.interaction=e,this.result=Me(),this.edges={left:!1,right:!1,top:!1,bottom:!1}}return o(t,[{key:"start",value:function(t,e){var i,a,s=t.phase,n=this.interaction,o=function(t){var e=t.interactable.options[t.prepared.name],i=e.modifiers;return i&&i.length?i:["snap","snapSize","snapEdges","restrict","restrictEdges","restrictSize"].map(function(t){var i=e[t];return i&&i.enabled&&{options:i,methods:i._methods}}).filter(function(t){return!!t})}(n);this.prepareStates(o),this.startEdges=Z({},n.edges),this.edges=Z({},this.startEdges),this.startOffset=(a=e,(i=n.rect)?{left:a.x-i.left,top:a.y-i.top,right:i.right-a.x,bottom:i.bottom-a.y}:{left:0,top:0,right:0,bottom:0}),this.startDelta={x:0,y:0};var r=this.fillArg({phase:s,pageCoords:e,preEnd:!1});return this.result=Me(),this.startAll(r),this.result=this.setAll(r)}},{key:"fillArg",value:function(t){var e=this.interaction;return t.interaction=e,t.interactable=e.interactable,t.element=e.element,t.rect||(t.rect=e.rect),t.edges||(t.edges=this.startEdges),t.startOffset=this.startOffset,t}},{key:"startAll",value:function(t){for(var e=0,i=this.states;e<i.length;e++){var a=i[e];a.methods.start&&(t.state=a,a.methods.start(t))}}},{key:"setAll",value:function(t){var e=t.phase,i=t.preEnd,a=t.skipModifiers,s=t.rect,n=t.edges;t.coords=Z({},t.pageCoords),t.rect=Z({},s),t.edges=Z({},n);for(var o=a?this.states.slice(a):this.states,r=Me(t.coords,t.rect),l=0;l<o.length;l++){var c,d=o[l],h=d.options,u=Z({},t.coords),p=null;null!=(c=d.methods)&&c.set&&this.shouldDo(h,i,e)&&(t.state=d,p=d.methods.set(t),st(t.edges,t.rect,{x:t.coords.x-u.x,y:t.coords.y-u.y})),r.eventProps.push(p)}Z(this.edges,t.edges),r.delta.x=t.coords.x-t.pageCoords.x,r.delta.y=t.coords.y-t.pageCoords.y,r.rectDelta.left=t.rect.left-s.left,r.rectDelta.right=t.rect.right-s.right,r.rectDelta.top=t.rect.top-s.top,r.rectDelta.bottom=t.rect.bottom-s.bottom;var m=this.result.coords,f=this.result.rect;if(m&&f){var g=r.rect.left!==f.left||r.rect.right!==f.right||r.rect.top!==f.top||r.rect.bottom!==f.bottom;r.changed=g||m.x!==r.coords.x||m.y!==r.coords.y}return r}},{key:"applyToInteraction",value:function(t){var e=this.interaction,i=t.phase,a=e.coords.cur,s=e.coords.start,n=this.result,o=this.startDelta,r=n.delta;"start"===i&&Z(this.startDelta,n.delta);for(var l=0,c=[[s,o],[a,r]];l<c.length;l++){var d=c[l],h=d[0],u=d[1];h.page.x+=u.x,h.page.y+=u.y,h.client.x+=u.x,h.client.y+=u.y}var p=this.result.rectDelta,m=t.rect||e.rect;m.left+=p.left,m.right+=p.right,m.top+=p.top,m.bottom+=p.bottom,m.width=m.right-m.left,m.height=m.bottom-m.top}},{key:"setAndApply",value:function(t){var e=this.interaction,i=t.phase,a=t.preEnd,s=t.skipModifiers,n=this.setAll(this.fillArg({preEnd:a,phase:i,pageCoords:t.modifiedCoords||e.coords.cur.page}));if(this.result=n,!n.changed&&(!s||s<this.states.length)&&e.interacting())return!1;if(t.modifiedCoords){var o=e.coords.cur.page,r={x:t.modifiedCoords.x-o.x,y:t.modifiedCoords.y-o.y};n.coords.x+=r.x,n.coords.y+=r.y,n.delta.x+=r.x,n.delta.y+=r.y}this.applyToInteraction(t)}},{key:"beforeEnd",value:function(t){var e=t.interaction,i=t.event,a=this.states;if(a&&a.length){for(var s=!1,n=0;n<a.length;n++){var o=a[n];t.state=o;var r=o.options,l=o.methods,c=l.beforeEnd&&l.beforeEnd(t);if(c)return this.endResult=c,!1;s=s||!s&&this.shouldDo(r,!0,t.phase,!0)}s&&e.move({event:i,preEnd:!0})}}},{key:"stop",value:function(t){var e=t.interaction;if(this.states&&this.states.length){var i=Z({states:this.states,interactable:e.interactable,element:e.element,rect:null},t);this.fillArg(i);for(var a=0,s=this.states;a<s.length;a++){var n=s[a];i.state=n,n.methods.stop&&n.methods.stop(i)}this.states=null,this.endResult=null}}},{key:"prepareStates",value:function(t){this.states=[];for(var e=0;e<t.length;e++){var i=t[e],a=i.options,s=i.methods,n=i.name;this.states.push({options:a,methods:s,index:e,name:n})}return this.states}},{key:"restoreInteractionCoords",value:function(t){var e=t.interaction,i=e.coords,a=e.rect,s=e.modification;if(s.result){for(var n=s.startDelta,o=s.result,r=o.delta,l=o.rectDelta,c=0,d=[[i.start,n],[i.cur,r]];c<d.length;c++){var h=d[c],u=h[0],p=h[1];u.page.x-=p.x,u.page.y-=p.y,u.client.x-=p.x,u.client.y-=p.y}a.left-=l.left,a.right-=l.right,a.top-=l.top,a.bottom-=l.bottom}}},{key:"shouldDo",value:function(t,e,i,a){return!(!t||!1===t.enabled||a&&!t.endOnly||t.endOnly&&!e||"start"===i&&!t.setStart)}},{key:"copyFrom",value:function(t){this.startOffset=t.startOffset,this.startDelta=t.startDelta,this.startEdges=t.startEdges,this.edges=t.edges,this.states=t.states.map(function(t){return xe(t)}),this.result=Me(Z({},t.result.coords),Z({},t.result.rect))}},{key:"destroy",value:function(){for(var t in this)this[t]=null}}]),t}();function Me(t,e){return{rect:e,coords:t,delta:{x:0,y:0},rectDelta:{left:0,right:0,top:0,bottom:0},eventProps:[],changed:!0}}function Pe(t,e){var i=t.defaults,a={start:t.start,set:t.set,beforeEnd:t.beforeEnd,stop:t.stop},s=function(t){var s=t||{};for(var n in s.enabled=!1!==s.enabled,i)n in s||(s[n]=i[n]);var o={options:s,methods:a,name:e,enable:function(){return s.enabled=!0,o},disable:function(){return s.enabled=!1,o}};return o};return e&&"string"==typeof e&&(s._defaults=i,s._methods=a),s}function Oe(t){var e=t.iEvent,i=t.interaction.modification.result;i&&(e.modifiers=i.eventProps)}var Le={id:"modifiers/base",before:["actions"],install:function(t){t.defaults.perAction.modifiers=[]},listeners:{"interactions:new":function(t){var e=t.interaction;e.modification=new Te(e)},"interactions:before-action-start":function(t){var e=t.interaction,i=t.interaction.modification;i.start(t,e.coords.start.page),e.edges=i.edges,i.applyToInteraction(t)},"interactions:before-action-move":function(t){var e=t.interaction,i=e.modification,a=i.setAndApply(t);return e.edges=i.edges,a},"interactions:before-action-end":function(t){var e=t.interaction,i=e.modification,a=i.beforeEnd(t);return e.edges=i.startEdges,a},"interactions:action-start":Oe,"interactions:action-move":Oe,"interactions:action-end":Oe,"interactions:after-action-start":function(t){return t.interaction.modification.restoreInteractionCoords(t)},"interactions:after-action-move":function(t){return t.interaction.modification.restoreInteractionCoords(t)},"interactions:stop":function(t){return t.interaction.modification.stop(t)}}},Re=Le,De={base:{preventDefault:"auto",deltaSource:"page"},perAction:{enabled:!1,origin:{x:0,y:0}},actions:{}},Ne=function(t){l(i,t);var e=u(i);function i(t,a,n,o,r,l,c){var d;s(this,i),(d=e.call(this,t)).relatedTarget=null,d.screenX=void 0,d.screenY=void 0,d.button=void 0,d.buttons=void 0,d.ctrlKey=void 0,d.shiftKey=void 0,d.altKey=void 0,d.metaKey=void 0,d.page=void 0,d.client=void 0,d.delta=void 0,d.rect=void 0,d.x0=void 0,d.y0=void 0,d.t0=void 0,d.dt=void 0,d.duration=void 0,d.clientX0=void 0,d.clientY0=void 0,d.velocity=void 0,d.speed=void 0,d.swipe=void 0,d.axes=void 0,d.preEnd=void 0,r=r||t.element;var u=t.interactable,p=(u&&u.options||De).deltaSource,m=nt(u,r,n),f="start"===o,g="end"===o,_=f?h(d):t.prevEvent,y=f?t.coords.start:g?{page:_.page,client:_.client,timeStamp:t.coords.cur.timeStamp}:t.coords.cur;return d.page=Z({},y.page),d.client=Z({},y.client),d.rect=Z({},t.rect),d.timeStamp=y.timeStamp,g||(d.page.x-=m.x,d.page.y-=m.y,d.client.x-=m.x,d.client.y-=m.y),d.ctrlKey=a.ctrlKey,d.altKey=a.altKey,d.shiftKey=a.shiftKey,d.metaKey=a.metaKey,d.button=a.button,d.buttons=a.buttons,d.target=r,d.currentTarget=r,d.preEnd=l,d.type=c||n+(o||""),d.interactable=u,d.t0=f?t.pointers[t.pointers.length-1].downTime:_.t0,d.x0=t.coords.start.page.x-m.x,d.y0=t.coords.start.page.y-m.y,d.clientX0=t.coords.start.client.x-m.x,d.clientY0=t.coords.start.client.y-m.y,d.delta=f||g?{x:0,y:0}:{x:d[p].x-_[p].x,y:d[p].y-_[p].y},d.dt=t.coords.delta.timeStamp,d.duration=d.timeStamp-d.t0,d.velocity=Z({},t.coords.velocity[p]),d.speed=lt(d.velocity.x,d.velocity.y),d.swipe=g||"inertiastart"===o?d.getSwipe():null,d}return o(i,[{key:"getSwipe",value:function(){var t=this._interaction;if(t.prevEvent.speed<600||this.timeStamp-t.prevEvent.timeStamp>150)return null;var e=180*Math.atan2(t.prevEvent.velocityY,t.prevEvent.velocityX)/Math.PI;e<0&&(e+=360);var i=112.5<=e&&e<247.5,a=202.5<=e&&e<337.5;return{up:a,down:!a&&22.5<=e&&e<157.5,left:i,right:!i&&(292.5<=e||e<67.5),angle:e,speed:t.prevEvent.speed,velocity:{x:t.prevEvent.velocityX,y:t.prevEvent.velocityY}}}},{key:"preventDefault",value:function(){}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}}]),i}(St);Object.defineProperties(Ne.prototype,{pageX:{get:function(){return this.page.x},set:function(t){this.page.x=t}},pageY:{get:function(){return this.page.y},set:function(t){this.page.y=t}},clientX:{get:function(){return this.client.x},set:function(t){this.client.x=t}},clientY:{get:function(){return this.client.y},set:function(t){this.client.y=t}},dx:{get:function(){return this.delta.x},set:function(t){this.delta.x=t}},dy:{get:function(){return this.delta.y},set:function(t){this.delta.y=t}},velocityX:{get:function(){return this.velocity.x},set:function(t){this.velocity.x=t}},velocityY:{get:function(){return this.velocity.y},set:function(t){this.velocity.y=t}}});var ke=o(function t(e,i,a,n,o){s(this,t),this.id=void 0,this.pointer=void 0,this.event=void 0,this.downTime=void 0,this.downTarget=void 0,this.id=e,this.pointer=i,this.event=a,this.downTime=n,this.downTarget=o}),Fe=function(t){return t.interactable="",t.element="",t.prepared="",t.pointerIsDown="",t.pointerWasMoved="",t._proxy="",t}({}),$e=function(t){return t.start="",t.move="",t.end="",t.stop="",t.interacting="",t}({}),qe=0,Ge=function(){function t(e){var i=this,a=e.pointerType,n=e.scopeFire;s(this,t),this.interactable=null,this.element=null,this.rect=null,this._rects=void 0,this.edges=null,this._scopeFire=void 0,this.prepared={name:null,axis:null,edges:null},this.pointerType=void 0,this.pointers=[],this.downEvent=null,this.downPointer={},this._latestPointer={pointer:null,event:null,eventTarget:null},this.prevEvent=null,this.pointerIsDown=!1,this.pointerWasMoved=!1,this._interacting=!1,this._ending=!1,this._stopped=!0,this._proxy=void 0,this.simulation=null,this.doMove=ae(function(t){this.move(t)},"The interaction.doMove() method has been renamed to interaction.move()"),this.coords={start:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},prev:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},cur:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},delta:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},velocity:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0}},this._id=qe++,this._scopeFire=n,this.pointerType=a;var o=this;this._proxy={};var r=function(t){Object.defineProperty(i._proxy,t,{get:function(){return o[t]}})};for(var l in Fe)r(l);var c=function(t){Object.defineProperty(i._proxy,t,{value:function(){return o[t].apply(o,arguments)}})};for(var d in $e)c(d);this._scopeFire("interactions:new",{interaction:this})}return o(t,[{key:"pointerMoveTolerance",get:function(){return 1}},{key:"pointerDown",value:function(t,e,i){var a=this.updatePointer(t,e,i,!0),s=this.pointers[a];this._scopeFire("interactions:down",{pointer:t,event:e,eventTarget:i,pointerIndex:a,pointerInfo:s,type:"down",interaction:this})}},{key:"start",value:function(t,e,i){return!(this.interacting()||!this.pointerIsDown||this.pointers.length<("gesture"===t.name?2:1)||!e.options[t.name].enabled)&&(se(this.prepared,t),this.interactable=e,this.element=i,this.rect=e.getRect(i),this.edges=this.prepared.edges?Z({},this.prepared.edges):{left:!0,right:!0,top:!0,bottom:!0},this._stopped=!1,this._interacting=this._doPhase({interaction:this,event:this.downEvent,phase:"start"})&&!this._stopped,this._interacting)}},{key:"pointerMove",value:function(t,e,i){this.simulation||this.modification&&this.modification.endResult||this.updatePointer(t,e,i,!1);var a,s,n=this.coords.cur.page.x===this.coords.prev.page.x&&this.coords.cur.page.y===this.coords.prev.page.y&&this.coords.cur.client.x===this.coords.prev.client.x&&this.coords.cur.client.y===this.coords.prev.client.y;this.pointerIsDown&&!this.pointerWasMoved&&(a=this.coords.cur.client.x-this.coords.start.client.x,s=this.coords.cur.client.y-this.coords.start.client.y,this.pointerWasMoved=lt(a,s)>this.pointerMoveTolerance);var o,r,l,c=this.getPointerIndex(t),d={pointer:t,pointerIndex:c,pointerInfo:this.pointers[c],event:e,type:"move",eventTarget:i,dx:a,dy:s,duplicate:n,interaction:this};n||(o=this.coords.velocity,r=this.coords.delta,l=Math.max(r.timeStamp/1e3,.001),o.page.x=r.page.x/l,o.page.y=r.page.y/l,o.client.x=r.client.x/l,o.client.y=r.client.y/l,o.timeStamp=l),this._scopeFire("interactions:move",d),n||this.simulation||(this.interacting()&&(d.type=null,this.move(d)),this.pointerWasMoved&&ht(this.coords.prev,this.coords.cur))}},{key:"move",value:function(t){t&&t.event||ut(this.coords.delta),(t=Z({pointer:this._latestPointer.pointer,event:this._latestPointer.event,eventTarget:this._latestPointer.eventTarget,interaction:this},t||{})).phase="move",this._doPhase(t)}},{key:"pointerUp",value:function(t,e,i,a){var s=this.getPointerIndex(t);-1===s&&(s=this.updatePointer(t,e,i,!1));var n=/cancel$/i.test(e.type)?"cancel":"up";this._scopeFire("interactions:".concat(n),{pointer:t,pointerIndex:s,pointerInfo:this.pointers[s],event:e,eventTarget:i,type:n,curEventTarget:a,interaction:this}),this.simulation||this.end(e),this.removePointer(t,e)}},{key:"documentBlur",value:function(t){this.end(t),this._scopeFire("interactions:blur",{event:t,type:"blur",interaction:this})}},{key:"end",value:function(t){var e;this._ending=!0,t=t||this._latestPointer.event,this.interacting()&&(e=this._doPhase({event:t,interaction:this,phase:"end"})),this._ending=!1,!0===e&&this.stop()}},{key:"currentAction",value:function(){return this._interacting?this.prepared.name:null}},{key:"interacting",value:function(){return this._interacting}},{key:"stop",value:function(){this._scopeFire("interactions:stop",{interaction:this}),this.interactable=this.element=null,this._interacting=!1,this._stopped=!0,this.prepared.name=this.prevEvent=null}},{key:"getPointerIndex",value:function(t){var e=gt(t);return"mouse"===this.pointerType||"pen"===this.pointerType?this.pointers.length-1:xt(this.pointers,function(t){return t.id===e})}},{key:"getPointerInfo",value:function(t){return this.pointers[this.getPointerIndex(t)]}},{key:"updatePointer",value:function(t,e,i,a){var s,n,o,r=gt(t),l=this.getPointerIndex(t),c=this.pointers[l];return a=!1!==a&&(a||/(down|start)$/i.test(e.type)),c?c.pointer=t:(c=new ke(r,t,e,null,null),l=this.pointers.length,this.pointers.push(c)),function(t,e,i){var a=e.length>1?yt(e):e[0];ft(a,t.page),function(t,e){e=e||{},G.isOperaMobile&&pt(t)?mt("screen",t,e):mt("client",t,e)}(a,t.client),t.timeStamp=i}(this.coords.cur,this.pointers.map(function(t){return t.pointer}),this._now()),s=this.coords.delta,n=this.coords.prev,o=this.coords.cur,s.page.x=o.page.x-n.page.x,s.page.y=o.page.y-n.page.y,s.client.x=o.client.x-n.client.x,s.client.y=o.client.y-n.client.y,s.timeStamp=o.timeStamp-n.timeStamp,a&&(this.pointerIsDown=!0,c.downTime=this.coords.cur.timeStamp,c.downTarget=i,dt(this.downPointer,t),this.interacting()||(ht(this.coords.start,this.coords.cur),ht(this.coords.prev,this.coords.cur),this.downEvent=e,this.pointerWasMoved=!1)),this._updateLatestPointer(t,e,i),this._scopeFire("interactions:update-pointer",{pointer:t,event:e,eventTarget:i,down:a,pointerInfo:c,pointerIndex:l,interaction:this}),l}},{key:"removePointer",value:function(t,e){var i=this.getPointerIndex(t);if(-1!==i){var a=this.pointers[i];this._scopeFire("interactions:remove-pointer",{pointer:t,event:e,eventTarget:null,pointerIndex:i,pointerInfo:a,interaction:this}),this.pointers.splice(i,1),this.pointerIsDown=!1}}},{key:"_updateLatestPointer",value:function(t,e,i){this._latestPointer.pointer=t,this._latestPointer.event=e,this._latestPointer.eventTarget=i}},{key:"destroy",value:function(){this._latestPointer.pointer=null,this._latestPointer.event=null,this._latestPointer.eventTarget=null}},{key:"_createPreparedEvent",value:function(t,e,i,a){return new Ne(this,t,this.prepared.name,e,this.element,i,a)}},{key:"_fireEvent",value:function(t){var e;null==(e=this.interactable)||e.fire(t),(!this.prevEvent||t.timeStamp>=this.prevEvent.timeStamp)&&(this.prevEvent=t)}},{key:"_doPhase",value:function(t){var e=t.event,i=t.phase,a=t.preEnd,s=t.type,n=this.rect;if(n&&"move"===i&&(st(this.edges,n,this.coords.delta[this.interactable.options.deltaSource]),n.width=n.right-n.left,n.height=n.bottom-n.top),!1===this._scopeFire("interactions:before-action-".concat(i),t))return!1;var o=t.iEvent=this._createPreparedEvent(e,i,a,s);return this._scopeFire("interactions:action-".concat(i),t),"start"===i&&(this.prevEvent=o),this._fireEvent(o),this._scopeFire("interactions:after-action-".concat(i),t),!0}},{key:"_now",value:function(){return Date.now()}}]),t}();function Be(t){je(t.interaction)}function je(t){if(!function(t){return!(!t.offset.pending.x&&!t.offset.pending.y)}(t))return!1;var e=t.offset.pending;return Ye(t.coords.cur,e),Ye(t.coords.delta,e),st(t.edges,t.rect,e),e.x=0,e.y=0,!0}function Ue(t){var e=t.x,i=t.y;this.offset.pending.x+=e,this.offset.pending.y+=i,this.offset.total.x+=e,this.offset.total.y+=i}function Ye(t,e){var i=t.page,a=t.client,s=e.x,n=e.y;i.x+=s,i.y+=n,a.x+=s,a.y+=n}$e.offsetBy="";var ze={id:"offset",before:["modifiers","pointer-events","actions","inertia"],install:function(t){t.Interaction.prototype.offsetBy=Ue},listeners:{"interactions:new":function(t){t.interaction.offset={total:{x:0,y:0},pending:{x:0,y:0}}},"interactions:update-pointer":function(t){return function(t){t.pointerIsDown&&(Ye(t.coords.cur,t.offset.total),t.offset.pending.x=0,t.offset.pending.y=0)}(t.interaction)},"interactions:before-action-start":Be,"interactions:before-action-move":Be,"interactions:before-action-end":function(t){var e=t.interaction;if(je(e))return e.move({offset:!0}),e.end(),!1},"interactions:stop":function(t){var e=t.interaction;e.offset.total.x=0,e.offset.total.y=0,e.offset.pending.x=0,e.offset.pending.y=0}}},Ve=ze,We=function(){function t(e){s(this,t),this.active=!1,this.isModified=!1,this.smoothEnd=!1,this.allowResume=!1,this.modification=void 0,this.modifierCount=0,this.modifierArg=void 0,this.startCoords=void 0,this.t0=0,this.v0=0,this.te=0,this.targetOffset=void 0,this.modifiedOffset=void 0,this.currentOffset=void 0,this.lambda_v0=0,this.one_ve_v0=0,this.timeout=void 0,this.interaction=void 0,this.interaction=e}return o(t,[{key:"start",value:function(t){var e=this.interaction,i=He(e);if(!i||!i.enabled)return!1;var a=e.coords.velocity.client,s=lt(a.x,a.y),n=this.modification||(this.modification=new Te(e));if(n.copyFrom(e.modification),this.t0=e._now(),this.allowResume=i.allowResume,this.v0=s,this.currentOffset={x:0,y:0},this.startCoords=e.coords.cur.page,this.modifierArg=n.fillArg({pageCoords:this.startCoords,preEnd:!0,phase:"inertiastart"}),this.t0-e.coords.cur.timeStamp<50&&s>i.minSpeed&&s>i.endSpeed)this.startInertia();else{if(n.result=n.setAll(this.modifierArg),!n.result.changed)return!1;this.startSmoothEnd()}return e.modification.result.rect=null,e.offsetBy(this.targetOffset),e._doPhase({interaction:e,event:t,phase:"inertiastart"}),e.offsetBy({x:-this.targetOffset.x,y:-this.targetOffset.y}),e.modification.result.rect=null,this.active=!0,e.simulation=this,!0}},{key:"startInertia",value:function(){var t=this,e=this.interaction.coords.velocity.client,i=He(this.interaction),a=i.resistance,s=-Math.log(i.endSpeed/this.v0)/a;this.targetOffset={x:(e.x-s)/a,y:(e.y-s)/a},this.te=s,this.lambda_v0=a/this.v0,this.one_ve_v0=1-i.endSpeed/this.v0;var n=this.modification,o=this.modifierArg;o.pageCoords={x:this.startCoords.x+this.targetOffset.x,y:this.startCoords.y+this.targetOffset.y},n.result=n.setAll(o),n.result.changed&&(this.isModified=!0,this.modifiedOffset={x:this.targetOffset.x+n.result.delta.x,y:this.targetOffset.y+n.result.delta.y}),this.onNextFrame(function(){return t.inertiaTick()})}},{key:"startSmoothEnd",value:function(){var t=this;this.smoothEnd=!0,this.isModified=!0,this.targetOffset={x:this.modification.result.delta.x,y:this.modification.result.delta.y},this.onNextFrame(function(){return t.smoothEndTick()})}},{key:"onNextFrame",value:function(t){var e=this;this.timeout=Kt(function(){e.active&&t()})}},{key:"inertiaTick",value:function(){var t,e,i,a,s,n=this,o=this.interaction,r=He(o).resistance,l=(o._now()-this.t0)/1e3;if(l<this.te){var c,d=1-(Math.exp(-r*l)-this.lambda_v0)/this.one_ve_v0;this.isModified?(t=this.targetOffset.x,e=this.targetOffset.y,i=this.modifiedOffset.x,a=this.modifiedOffset.y,c={x:Qe(s=d,0,t,i),y:Qe(s,0,e,a)}):c={x:this.targetOffset.x*d,y:this.targetOffset.y*d};var h={x:c.x-this.currentOffset.x,y:c.y-this.currentOffset.y};this.currentOffset.x+=h.x,this.currentOffset.y+=h.y,o.offsetBy(h),o.move(),this.onNextFrame(function(){return n.inertiaTick()})}else o.offsetBy({x:this.modifiedOffset.x-this.currentOffset.x,y:this.modifiedOffset.y-this.currentOffset.y}),this.end()}},{key:"smoothEndTick",value:function(){var t=this,e=this.interaction,i=e._now()-this.t0,a=He(e).smoothEndDuration;if(i<a){var s={x:Xe(i,0,this.targetOffset.x,a),y:Xe(i,0,this.targetOffset.y,a)},n={x:s.x-this.currentOffset.x,y:s.y-this.currentOffset.y};this.currentOffset.x+=n.x,this.currentOffset.y+=n.y,e.offsetBy(n),e.move({skipModifiers:this.modifierCount}),this.onNextFrame(function(){return t.smoothEndTick()})}else e.offsetBy({x:this.targetOffset.x-this.currentOffset.x,y:this.targetOffset.y-this.currentOffset.y}),this.end()}},{key:"resume",value:function(t){var e=t.pointer,i=t.event,a=t.eventTarget,s=this.interaction;s.offsetBy({x:-this.currentOffset.x,y:-this.currentOffset.y}),s.updatePointer(e,i,a,!0),s._doPhase({interaction:s,event:i,phase:"resume"}),ht(s.coords.prev,s.coords.cur),this.stop()}},{key:"end",value:function(){this.interaction.move(),this.interaction.end(),this.stop()}},{key:"stop",value:function(){this.active=this.smoothEnd=!1,this.interaction.simulation=null,Qt(this.timeout)}}]),t}();function He(t){var e=t.interactable,i=t.prepared;return e&&e.options&&i.name&&e.options[i.name].inertia}var Ke={id:"inertia",before:["modifiers","actions"],install:function(t){var e=t.defaults;t.usePlugin(Ve),t.usePlugin(Re),t.actions.phases.inertiastart=!0,t.actions.phases.resume=!0,e.perAction.inertia={enabled:!1,resistance:10,minSpeed:100,endSpeed:10,allowResume:!0,smoothEndDuration:300}},listeners:{"interactions:new":function(t){var e=t.interaction;e.inertia=new We(e)},"interactions:before-action-end":function(t){var e=t.interaction,i=t.event;return(!e._interacting||e.simulation||!e.inertia.start(i))&&null},"interactions:down":function(t){var e=t.interaction,i=t.eventTarget,a=e.inertia;if(a.active)for(var s=i;M(s);){if(s===e.element){a.resume(t);break}s=U(s)}},"interactions:stop":function(t){var e=t.interaction.inertia;e.active&&e.stop()},"interactions:before-action-resume":function(t){var e=t.interaction.modification;e.stop(t),e.start(t,t.interaction.coords.cur.page),e.applyToInteraction(t)},"interactions:before-action-inertiastart":function(t){return t.interaction.modification.setAndApply(t)},"interactions:action-resume":Oe,"interactions:action-inertiastart":Oe,"interactions:after-action-inertiastart":function(t){return t.interaction.modification.restoreInteractionCoords(t)},"interactions:after-action-resume":function(t){return t.interaction.modification.restoreInteractionCoords(t)}}};function Qe(t,e,i,a){var s=1-t;return s*s*e+2*s*t*i+t*t*a}function Xe(t,e,i,a){return-i*(t/=a)*(t-2)+e}var Je=Ke;function Ze(t,e){for(var i=0;i<e.length;i++){var a=e[i];if(t.immediatePropagationStopped)break;a(t)}}var ti=function(){function t(e){s(this,t),this.options=void 0,this.types={},this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.global=void 0,this.options=Z({},e||{})}return o(t,[{key:"fire",value:function(t){var e,i=this.global;(e=this.types[t.type])&&Ze(t,e),!t.propagationStopped&&i&&(e=i[t.type])&&Ze(t,e)}},{key:"on",value:function(t,e){var i=ot(t,e);for(t in i)this.types[t]=Ct(this.types[t]||[],i[t])}},{key:"off",value:function(t,e){var i=ot(t,e);for(t in i){var a=this.types[t];if(a&&a.length)for(var s=0,n=i[t];s<n.length;s++){var o=n[s],r=a.indexOf(o);-1!==r&&a.splice(r,1)}}}},{key:"getRect",value:function(t){return null}}]),t}(),ei=function(){function t(e){s(this,t),this.currentTarget=void 0,this.originalEvent=void 0,this.type=void 0,this.originalEvent=e,dt(this,e)}return o(t,[{key:"preventOriginalDefault",value:function(){this.originalEvent.preventDefault()}},{key:"stopPropagation",value:function(){this.originalEvent.stopPropagation()}},{key:"stopImmediatePropagation",value:function(){this.originalEvent.stopImmediatePropagation()}}]),t}();function ii(t){return S(t)?{capture:!!t.capture,passive:!!t.passive}:{capture:!!t,passive:!1}}function ai(t,e){return t===e||("boolean"==typeof t?!!e.capture===t&&0==!!e.passive:!!t.capture==!!e.capture&&!!t.passive==!!e.passive)}var si={id:"events",install:function(t){var e,i=[],a={},s=[],n={add:o,remove:r,addDelegate:function(t,e,i,n,r){var d=ii(r);if(!a[i]){a[i]=[];for(var h=0;h<s.length;h++){var u=s[h];o(u,i,l),o(u,i,c,!0)}}var p=a[i],m=Tt(p,function(i){return i.selector===t&&i.context===e});m||(m={selector:t,context:e,listeners:[]},p.push(m)),m.listeners.push({func:n,options:d})},removeDelegate:function(t,e,i,s,n){var o,d=ii(n),h=a[i],u=!1;if(h)for(o=h.length-1;o>=0;o--){var p=h[o];if(p.selector===t&&p.context===e){for(var m=p.listeners,f=m.length-1;f>=0;f--){var g=m[f];if(g.func===s&&ai(g.options,d)){m.splice(f,1),m.length||(h.splice(o,1),r(e,i,l),r(e,i,c,!0)),u=!0;break}}if(u)break}}},delegateListener:l,delegateUseCapture:c,delegatedEvents:a,documents:s,targets:i,supportsOptions:!1,supportsPassive:!1};function o(t,e,a,s){if(t.addEventListener){var o=ii(s),r=Tt(i,function(e){return e.eventTarget===t});r||(r={eventTarget:t,events:{}},i.push(r)),r.events[e]||(r.events[e]=[]),Tt(r.events[e],function(t){return t.func===a&&ai(t.options,o)})||(t.addEventListener(e,a,n.supportsOptions?o:o.capture),r.events[e].push({func:a,options:o}))}}function r(t,e,a,s){if(t.addEventListener&&t.removeEventListener){var o=xt(i,function(e){return e.eventTarget===t}),l=i[o];if(l&&l.events)if("all"!==e){var c=!1,d=l.events[e];if(d){if("all"===a){for(var h=d.length-1;h>=0;h--){var u=d[h];r(t,e,u.func,u.options)}return}for(var p=ii(s),m=0;m<d.length;m++){var f=d[m];if(f.func===a&&ai(f.options,p)){t.removeEventListener(e,a,n.supportsOptions?p:p.capture),d.splice(m,1),0===d.length&&(delete l.events[e],c=!0);break}}}c&&!Object.keys(l.events).length&&i.splice(o,1)}else for(e in l.events)l.events.hasOwnProperty(e)&&r(t,e,"all")}}function l(t,e){for(var i=ii(e),s=new ei(t),n=a[t.type],o=wt(t)[0],r=o;M(r);){for(var l=0;l<n.length;l++){var c=n[l],d=c.selector,h=c.context;if(Y(r,d)&&B(h,o)&&B(h,r)){var u=c.listeners;s.currentTarget=r;for(var p=0;p<u.length;p++){var m=u[p];ai(m.options,i)&&m.func(s)}}}r=U(r)}}function c(t){return l(t,!0)}return null==(e=t.document)||e.createElement("div").addEventListener("test",null,{get capture(){return n.supportsOptions=!0},get passive(){return n.supportsPassive=!0}}),t.events=n,n}},ni={methodOrder:["simulationResume","mouseOrPen","hasPointer","idle"],search:function(t){for(var e=0,i=ni.methodOrder;e<i.length;e++){var a=i[e],s=ni[a](t);if(s)return s}return null},simulationResume:function(t){var e=t.pointerType,i=t.eventType,a=t.eventTarget,s=t.scope;if(!/down|start/i.test(i))return null;for(var n=0,o=s.interactions.list;n<o.length;n++){var r=o[n],l=a;if(r.simulation&&r.simulation.allowResume&&r.pointerType===e)for(;l;){if(l===r.element)return r;l=U(l)}}return null},mouseOrPen:function(t){var e,i=t.pointerId,a=t.pointerType,s=t.eventType,n=t.scope;if("mouse"!==a&&"pen"!==a)return null;for(var o=0,r=n.interactions.list;o<r.length;o++){var l=r[o];if(l.pointerType===a){if(l.simulation&&!oi(l,i))continue;if(l.interacting())return l;e||(e=l)}}if(e)return e;for(var c=0,d=n.interactions.list;c<d.length;c++){var h=d[c];if(!(h.pointerType!==a||/down/i.test(s)&&h.simulation))return h}return null},hasPointer:function(t){for(var e=t.pointerId,i=0,a=t.scope.interactions.list;i<a.length;i++){var s=a[i];if(oi(s,e))return s}return null},idle:function(t){for(var e=t.pointerType,i=0,a=t.scope.interactions.list;i<a.length;i++){var s=a[i];if(1===s.pointers.length){var n=s.interactable;if(n&&(!n.options.gesture||!n.options.gesture.enabled))continue}else if(s.pointers.length>=2)continue;if(!s.interacting()&&e===s.pointerType)return s}return null}};function oi(t,e){return t.pointers.some(function(t){return t.id===e})}var ri=ni,li=["pointerDown","pointerMove","pointerUp","updatePointer","removePointer","windowBlur"];function ci(t,e){return function(i){var a=e.interactions.list,s=At(i),n=wt(i),o=n[0],r=n[1],l=[];if(/^touch/.test(i.type)){e.prevTouchTime=e.now();for(var c=0,d=i.changedTouches;c<d.length;c++){var h=d[c],u={pointer:h,pointerId:gt(h),pointerType:s,eventType:i.type,eventTarget:o,curEventTarget:r,scope:e},p=di(u);l.push([u.pointer,u.eventTarget,u.curEventTarget,p])}}else{var m=!1;if(!G.supportsPointerEvent&&/mouse/.test(i.type)){for(var f=0;f<a.length&&!m;f++)m="mouse"!==a[f].pointerType&&a[f].pointerIsDown;m=m||e.now()-e.prevTouchTime<500||0===i.timeStamp}if(!m){var g={pointer:i,pointerId:gt(i),pointerType:s,eventType:i.type,curEventTarget:r,eventTarget:o,scope:e},_=di(g);l.push([g.pointer,g.eventTarget,g.curEventTarget,_])}}for(var y=0;y<l.length;y++){var v=l[y],b=v[0],E=v[1],A=v[2];v[3][t](b,i,E,A)}}}function di(t){var e=t.pointerType,i=t.scope,a={interaction:ri.search(t),searchDetails:t};return i.fire("interactions:find",a),a.interaction||i.interactions.new({pointerType:e})}function hi(t,e){var i=t.doc,a=t.scope,s=t.options,n=a.interactions.docEvents,o=a.events,r=o[e];for(var l in a.browser.isIOS&&!s.events&&(s.events={passive:!1}),o.delegatedEvents)r(i,l,o.delegateListener),r(i,l,o.delegateUseCapture,!0);for(var c=s&&s.events,d=0;d<n.length;d++){var h=n[d];r(i,h.type,h.listener,c)}}var ui={id:"core/interactions",install:function(t){for(var e={},i=0;i<li.length;i++){var a=li[i];e[a]=ci(a,t)}var n,r=G.pEventTypes;function c(){for(var e=0,i=t.interactions.list;e<i.length;e++){var a=i[e];if(a.pointerIsDown&&"touch"===a.pointerType&&!a._interacting)for(var s=function(){var e=o[n];t.documents.some(function(t){return B(t.doc,e.downTarget)})||a.removePointer(e.pointer,e.event)},n=0,o=a.pointers;n<o.length;n++)s()}}(n=$.PointerEvent?[{type:r.down,listener:c},{type:r.down,listener:e.pointerDown},{type:r.move,listener:e.pointerMove},{type:r.up,listener:e.pointerUp},{type:r.cancel,listener:e.pointerUp}]:[{type:"mousedown",listener:e.pointerDown},{type:"mousemove",listener:e.pointerMove},{type:"mouseup",listener:e.pointerUp},{type:"touchstart",listener:c},{type:"touchstart",listener:e.pointerDown},{type:"touchmove",listener:e.pointerMove},{type:"touchend",listener:e.pointerUp},{type:"touchcancel",listener:e.pointerUp}]).push({type:"blur",listener:function(e){for(var i=0,a=t.interactions.list;i<a.length;i++)a[i].documentBlur(e)}}),t.prevTouchTime=0,t.Interaction=function(e){l(a,e);var i=u(a);function a(){return s(this,a),i.apply(this,arguments)}return o(a,[{key:"pointerMoveTolerance",get:function(){return t.interactions.pointerMoveTolerance},set:function(e){t.interactions.pointerMoveTolerance=e}},{key:"_now",value:function(){return t.now()}}]),a}(Ge),t.interactions={list:[],new:function(e){e.scopeFire=function(e,i){return t.fire(e,i)};var i=new t.Interaction(e);return t.interactions.list.push(i),i},listeners:e,docEvents:n,pointerMoveTolerance:1},t.usePlugin(Ce)},listeners:{"scope:add-document":function(t){return hi(t,"add")},"scope:remove-document":function(t){return hi(t,"remove")},"interactable:unset":function(t,e){for(var i=t.interactable,a=e.interactions.list.length-1;a>=0;a--){var s=e.interactions.list[a];s.interactable===i&&(s.stop(),e.fire("interactions:destroy",{interaction:s}),s.destroy(),e.interactions.list.length>2&&e.interactions.list.splice(a,1))}}},onDocSignal:hi,doOnInteractions:ci,methodNames:li},pi=ui,mi=function(t){return t[t.On=0]="On",t[t.Off=1]="Off",t}(mi||{}),fi=function(){function t(e,i,a,n){s(this,t),this.target=void 0,this.options=void 0,this._actions=void 0,this.events=new ti,this._context=void 0,this._win=void 0,this._doc=void 0,this._scopeEvents=void 0,this._actions=i.actions,this.target=e,this._context=i.context||a,this._win=v(J(e)?this._context:e),this._doc=this._win.document,this._scopeEvents=n,this.set(i)}return o(t,[{key:"_defaults",get:function(){return{base:{},perAction:{},actions:{}}}},{key:"setOnEvents",value:function(t,e){return C(e.onstart)&&this.on("".concat(t,"start"),e.onstart),C(e.onmove)&&this.on("".concat(t,"move"),e.onmove),C(e.onend)&&this.on("".concat(t,"end"),e.onend),C(e.oninertiastart)&&this.on("".concat(t,"inertiastart"),e.oninertiastart),this}},{key:"updatePerActionListeners",value:function(t,e,i){var a,s=this,n=null==(a=this._actions.map[t])?void 0:a.filterEventType,o=function(t){return(null==n||n(t))&&Ie(t,s._actions)};(O(e)||S(e))&&this._onOff(mi.Off,t,e,void 0,o),(O(i)||S(i))&&this._onOff(mi.On,t,i,void 0,o)}},{key:"setPerAction",value:function(t,e){var i=this._defaults;for(var a in e){var s=a,n=this.options[t],o=e[s];"listeners"===s&&this.updatePerActionListeners(t,n.listeners,o),O(o)?n[s]=It(o):P(o)?(n[s]=Z(n[s]||{},xe(o)),S(i.perAction[s])&&"enabled"in i.perAction[s]&&(n[s].enabled=!1!==o.enabled)):x(o)&&S(i.perAction[s])?n[s].enabled=o:n[s]=o}}},{key:"getRect",value:function(t){return t=t||(M(this.target)?this.target:null),T(this.target)&&(t=t||this._context.querySelector(this.target)),Q(t)}},{key:"rectChecker",value:function(t){var e=this;return C(t)?(this.getRect=function(i){var a=Z({},t.apply(e,i));return"width"in a||(a.width=a.right-a.left,a.height=a.bottom-a.top),a},this):null===t?(delete this.getRect,this):this.getRect}},{key:"_backCompatOption",value:function(t,e){if(J(e)||S(e)){for(var i in this.options[t]=e,this._actions.map)this.options[i][t]=e;return this}return this.options[t]}},{key:"origin",value:function(t){return this._backCompatOption("origin",t)}},{key:"deltaSource",value:function(t){return"page"===t||"client"===t?(this.options.deltaSource=t,this):this.options.deltaSource}},{key:"getAllElements",value:function(){var t=this.target;return T(t)?Array.from(this._context.querySelectorAll(t)):C(t)&&t.getAllElements?t.getAllElements():M(t)?[t]:[]}},{key:"context",value:function(){return this._context}},{key:"inContext",value:function(t){return this._context===t.ownerDocument||B(this._context,t)}},{key:"testIgnoreAllow",value:function(t,e,i){return!this.testIgnore(t.ignoreFrom,e,i)&&this.testAllow(t.allowFrom,e,i)}},{key:"testAllow",value:function(t,e,i){return!t||!!M(i)&&(T(t)?W(i,t,e):!!M(t)&&B(t,i))}},{key:"testIgnore",value:function(t,e,i){return!(!t||!M(i))&&(T(t)?W(i,t,e):!!M(t)&&B(t,i))}},{key:"fire",value:function(t){return this.events.fire(t),this}},{key:"_onOff",value:function(t,e,i,a,s){S(e)&&!O(e)&&(a=i,i=null);var n=ot(e,i,s);for(var o in n){"wheel"===o&&(o=G.wheelEvent);for(var r=0,l=n[o];r<l.length;r++){var c=l[r];Ie(o,this._actions)?this.events[t===mi.On?"on":"off"](o,c):T(this.target)?this._scopeEvents[t===mi.On?"addDelegate":"removeDelegate"](this.target,this._context,o,c,a):this._scopeEvents[t===mi.On?"add":"remove"](this.target,o,c,a)}}return this}},{key:"on",value:function(t,e,i){return this._onOff(mi.On,t,e,i)}},{key:"off",value:function(t,e,i){return this._onOff(mi.Off,t,e,i)}},{key:"set",value:function(t){var e=this._defaults;for(var i in S(t)||(t={}),this.options=xe(e.base),this._actions.methodDict){var a=i,s=this._actions.methodDict[a];this.options[a]={},this.setPerAction(a,Z(Z({},e.perAction),e.actions[a])),this[s](t[a])}for(var n in t)"getRect"!==n?C(this[n])&&this[n](t[n]):this.rectChecker(t.getRect);return this}},{key:"unset",value:function(){if(T(this.target))for(var t in this._scopeEvents.delegatedEvents)for(var e=this._scopeEvents.delegatedEvents[t],i=e.length-1;i>=0;i--){var a=e[i],s=a.selector,n=a.context,o=a.listeners;s===this.target&&n===this._context&&e.splice(i,1);for(var r=o.length-1;r>=0;r--)this._scopeEvents.removeDelegate(this.target,this._context,t,o[r][0],o[r][1])}else this._scopeEvents.remove(this.target,"all")}}]),t}(),gi=function(){function t(e){var i=this;s(this,t),this.list=[],this.selectorMap={},this.scope=void 0,this.scope=e,e.addListeners({"interactable:unset":function(t){var e=t.interactable,a=e.target,s=T(a)?i.selectorMap[a]:a[i.scope.id],n=xt(s,function(t){return t===e});s.splice(n,1)}})}return o(t,[{key:"new",value:function(t,e){e=Z(e||{},{actions:this.scope.actions});var i=new this.scope.Interactable(t,e,this.scope.document,this.scope.events);return this.scope.addDocument(i._doc),this.list.push(i),T(t)?(this.selectorMap[t]||(this.selectorMap[t]=[]),this.selectorMap[t].push(i)):(i.target[this.scope.id]||Object.defineProperty(t,this.scope.id,{value:[],configurable:!0}),t[this.scope.id].push(i)),this.scope.fire("interactable:new",{target:t,options:e,interactable:i,win:this.scope._win}),i}},{key:"getExisting",value:function(t,e){var i=e&&e.context||this.scope.document,a=T(t),s=a?this.selectorMap[t]:t[this.scope.id];if(s)return Tt(s,function(e){return e._context===i&&(a||e.inContext(t))})}},{key:"forEachMatch",value:function(t,e){for(var i=0,a=this.list;i<a.length;i++){var s=a[i],n=void 0;if((T(s.target)?M(t)&&Y(t,s.target):t===s.target)&&s.inContext(t)&&(n=e(s)),void 0!==n)return n}}}]),t}(),_i=function(){function t(){var e=this;s(this,t),this.id="__interact_scope_".concat(Math.floor(100*Math.random())),this.isInitialized=!1,this.listenerMaps=[],this.browser=G,this.defaults=xe(De),this.Eventable=ti,this.actions={map:{},phases:{start:!0,move:!0,end:!0},methodDict:{},phaselessTypes:{}},this.interactStatic=function(t){var e=function e(i,a){var s=t.interactables.getExisting(i,a);return s||((s=t.interactables.new(i,a)).events.global=e.globalEvents),s};return e.getPointerAverage=yt,e.getTouchBBox=vt,e.getTouchDistance=bt,e.getTouchAngle=Et,e.getElementRect=Q,e.getElementClientRect=K,e.matchesSelector=Y,e.closest=j,e.globalEvents={},e.version="1.10.26",e.scope=t,e.use=function(t,e){return this.scope.usePlugin(t,e),this},e.isSet=function(t,e){return!!this.scope.interactables.get(t,e&&e.context)},e.on=ae(function(t,e,i){if(T(t)&&-1!==t.search(" ")&&(t=t.trim().split(/ +/)),O(t)){for(var a=0,s=t;a<s.length;a++){var n=s[a];this.on(n,e,i)}return this}if(S(t)){for(var o in t)this.on(o,t[o],e);return this}return Ie(t,this.scope.actions)?this.globalEvents[t]?this.globalEvents[t].push(e):this.globalEvents[t]=[e]:this.scope.events.add(this.scope.document,t,e,{options:i}),this},"The interact.on() method is being deprecated"),e.off=ae(function(t,e,i){if(T(t)&&-1!==t.search(" ")&&(t=t.trim().split(/ +/)),O(t)){for(var a=0,s=t;a<s.length;a++){var n=s[a];this.off(n,e,i)}return this}if(S(t)){for(var o in t)this.off(o,t[o],e);return this}var r;return Ie(t,this.scope.actions)?t in this.globalEvents&&-1!==(r=this.globalEvents[t].indexOf(e))&&this.globalEvents[t].splice(r,1):this.scope.events.remove(this.scope.document,t,e,i),this},"The interact.off() method is being deprecated"),e.debug=function(){return this.scope},e.supportsTouch=function(){return G.supportsTouch},e.supportsPointerEvent=function(){return G.supportsPointerEvent},e.stop=function(){for(var t=0,e=this.scope.interactions.list;t<e.length;t++)e[t].stop();return this},e.pointerMoveTolerance=function(t){return I(t)?(this.scope.interactions.pointerMoveTolerance=t,this):this.scope.interactions.pointerMoveTolerance},e.addDocument=function(t,e){this.scope.addDocument(t,e)},e.removeDocument=function(t){this.scope.removeDocument(t)},e}(this),this.InteractEvent=Ne,this.Interactable=void 0,this.interactables=new gi(this),this._win=void 0,this.document=void 0,this.window=void 0,this.documents=[],this._plugins={list:[],map:{}},this.onWindowUnload=function(t){return e.removeDocument(t.target)};var i=this;this.Interactable=function(t){l(a,t);var e=u(a);function a(){return s(this,a),e.apply(this,arguments)}return o(a,[{key:"_defaults",get:function(){return i.defaults}},{key:"set",value:function(t){return p(c(a.prototype),"set",this).call(this,t),i.fire("interactable:set",{options:t,interactable:this}),this}},{key:"unset",value:function(){p(c(a.prototype),"unset",this).call(this);var t=i.interactables.list.indexOf(this);t<0||(i.interactables.list.splice(t,1),i.fire("interactable:unset",{interactable:this}))}}]),a}(fi)}return o(t,[{key:"addListeners",value:function(t,e){this.listenerMaps.push({id:e,map:t})}},{key:"fire",value:function(t,e){for(var i=0,a=this.listenerMaps;i<a.length;i++){var s=a[i].map[t];if(s&&!1===s(e,this,t))return!1}}},{key:"init",value:function(t){return this.isInitialized?this:function(t,e){return t.isInitialized=!0,A(e)&&y(e),$.init(e),G.init(e),Xt(e),t.window=e,t.document=e.document,t.usePlugin(pi),t.usePlugin(si),t}(this,t)}},{key:"pluginIsInstalled",value:function(t){var e=t.id;return e?!!this._plugins.map[e]:-1!==this._plugins.list.indexOf(t)}},{key:"usePlugin",value:function(t,e){if(!this.isInitialized)return this;if(this.pluginIsInstalled(t))return this;if(t.id&&(this._plugins.map[t.id]=t),this._plugins.list.push(t),t.install&&t.install(this,e),t.listeners&&t.before){for(var i=0,a=this.listenerMaps.length,s=t.before.reduce(function(t,e){return t[e]=!0,t[yi(e)]=!0,t},{});i<a;i++){var n=this.listenerMaps[i].id;if(n&&(s[n]||s[yi(n)]))break}this.listenerMaps.splice(i,0,{id:t.id,map:t.listeners})}else t.listeners&&this.listenerMaps.push({id:t.id,map:t.listeners});return this}},{key:"addDocument",value:function(t,e){if(-1!==this.getDocIndex(t))return!1;var i=v(t);e=e?Z({},e):{},this.documents.push({doc:t,options:e}),this.events.documents.push(t),t!==this.document&&this.events.add(i,"unload",this.onWindowUnload),this.fire("scope:add-document",{doc:t,window:i,scope:this,options:e})}},{key:"removeDocument",value:function(t){var e=this.getDocIndex(t),i=v(t),a=this.documents[e].options;this.events.remove(i,"unload",this.onWindowUnload),this.documents.splice(e,1),this.events.documents.splice(e,1),this.fire("scope:remove-document",{doc:t,window:i,scope:this,options:a})}},{key:"getDocIndex",value:function(t){for(var e=0;e<this.documents.length;e++)if(this.documents[e].doc===t)return e;return-1}},{key:"getDocOptions",value:function(t){var e=this.getDocIndex(t);return-1===e?null:this.documents[e].options}},{key:"now",value:function(){return(this.window.Date||Date).now()}}]),t}();function yi(t){return t&&t.replace(/\/.*$/,"")}var vi=new _i,bi=vi.interactStatic,Ei="undefined"!=typeof globalThis?globalThis:window;vi.init(Ei);var Ai=Object.freeze({__proto__:null,edgeTarget:function(){},elements:function(){},grid:function(t){var e=[["x","y"],["left","top"],["right","bottom"],["width","height"]].filter(function(e){var i=e[0],a=e[1];return i in t||a in t}),i=function(i,a){for(var s=t.range,n=t.limits,o=void 0===n?{left:-1/0,right:1/0,top:-1/0,bottom:1/0}:n,r=t.offset,l=void 0===r?{x:0,y:0}:r,c={range:s,grid:t,x:null,y:null},d=0;d<e.length;d++){var h=e[d],u=h[0],p=h[1],m=Math.round((i-l.x)/t[u]),f=Math.round((a-l.y)/t[p]);c[u]=Math.max(o.left,Math.min(o.right,m*t[u]+l.x)),c[p]=Math.max(o.top,Math.min(o.bottom,f*t[p]+l.y))}return c};return i.grid=t,i.coordFields=e,i}}),wi={id:"snappers",install:function(t){var e=t.interactStatic;e.snappers=Z(e.snappers||{},Ai),e.createSnapGrid=e.snappers.grid}},Si=wi,Ci={start:function(t){var e=t.state,a=t.rect,s=t.edges,n=t.pageCoords,o=e.options,r=o.ratio,l=o.enabled,c=e.options,d=c.equalDelta,h=c.modifiers;"preserve"===r&&(r=a.width/a.height),e.startCoords=Z({},n),e.startRect=Z({},a),e.ratio=r,e.equalDelta=d;var u=e.linkedEdges={top:s.top||s.left&&!s.bottom,left:s.left||s.top&&!s.right,bottom:s.bottom||s.right&&!s.top,right:s.right||s.bottom&&!s.left};if(e.xIsPrimaryAxis=!(!s.left&&!s.right),e.equalDelta){var p=(u.left?1:-1)*(u.top?1:-1);e.edgeSign={x:p,y:p}}else e.edgeSign={x:u.left?-1:1,y:u.top?-1:1};if(!1!==l&&Z(s,u),null!=h&&h.length){var m=new Te(t.interaction);m.copyFrom(t.interaction.modification),m.prepareStates(h),e.subModification=m,m.startAll(i({},t))}},set:function(t){var e=t.state,a=t.rect,s=t.coords,n=e.linkedEdges,o=Z({},s),r=e.equalDelta?Ii:xi;if(Z(t.edges,n),r(e,e.xIsPrimaryAxis,s,a),!e.subModification)return null;var l=Z({},a);st(n,l,{x:s.x-o.x,y:s.y-o.y});var c=e.subModification.setAll(i(i({},t),{},{rect:l,edges:n,pageCoords:s,prevCoords:s,prevRect:l})),d=c.delta;return c.changed&&(r(e,Math.abs(d.x)>Math.abs(d.y),c.coords,c.rect),Z(s,c.coords)),c.eventProps},defaults:{ratio:"preserve",equalDelta:!1,modifiers:[],enabled:!1}};function Ii(t,e,i){var a=t.startCoords,s=t.edgeSign;e?i.y=a.y+(i.x-a.x)*s.y:i.x=a.x+(i.y-a.y)*s.x}function xi(t,e,i,a){var s=t.startRect,n=t.startCoords,o=t.ratio,r=t.edgeSign;if(e){var l=a.width/o;i.y=n.y+(l-s.height)*r.y}else{var c=a.height*o;i.x=n.x+(c-s.width)*r.x}}var Ti=Pe(Ci,"aspectRatio"),Mi=function(){};Mi._defaults={};var Pi=Mi;function Oi(t,e,i){return C(t)?et(t,e.interactable,e.element,[i.x,i.y,e]):et(t,e.interactable,e.element)}var Li={start:function(t){var e=t.rect,i=t.startOffset,a=t.state,s=t.interaction,n=t.pageCoords,o=a.options,r=o.elementRect,l=Z({left:0,top:0,right:0,bottom:0},o.offset||{});if(e&&r){var c=Oi(o.restriction,s,n);if(c){var d=c.right-c.left-e.width,h=c.bottom-c.top-e.height;d<0&&(l.left+=d,l.right+=d),h<0&&(l.top+=h,l.bottom+=h)}l.left+=i.left-e.width*r.left,l.top+=i.top-e.height*r.top,l.right+=i.right-e.width*(1-r.right),l.bottom+=i.bottom-e.height*(1-r.bottom)}a.offset=l},set:function(t){var e=t.coords,i=t.interaction,a=t.state,s=a.options,n=a.offset,o=Oi(s.restriction,i,e);if(o){var r=function(t){return!t||"left"in t&&"top"in t||((t=Z({},t)).left=t.x||0,t.top=t.y||0,t.right=t.right||t.left+t.width,t.bottom=t.bottom||t.top+t.height),t}(o);e.x=Math.max(Math.min(r.right-n.right,e.x),r.left+n.left),e.y=Math.max(Math.min(r.bottom-n.bottom,e.y),r.top+n.top)}},defaults:{restriction:null,elementRect:null,offset:null,endOnly:!1,enabled:!1}},Ri=Pe(Li,"restrict"),Di={top:1/0,left:1/0,bottom:-1/0,right:-1/0},Ni={top:-1/0,left:-1/0,bottom:1/0,right:1/0};function ki(t,e){for(var i=0,a=["top","left","bottom","right"];i<a.length;i++){var s=a[i];s in t||(t[s]=e[s])}return t}var Fi={noInner:Di,noOuter:Ni,start:function(t){var e,i=t.interaction,a=t.startOffset,s=t.state,n=s.options;n&&(e=it(Oi(n.offset,i,i.coords.start.page))),e=e||{x:0,y:0},s.offset={top:e.y+a.top,left:e.x+a.left,bottom:e.y-a.bottom,right:e.x-a.right}},set:function(t){var e=t.coords,i=t.edges,a=t.interaction,s=t.state,n=s.offset,o=s.options;if(i){var r=Z({},e),l=Oi(o.inner,a,r)||{},c=Oi(o.outer,a,r)||{};ki(l,Di),ki(c,Ni),i.top?e.y=Math.min(Math.max(c.top+n.top,r.y),l.top+n.top):i.bottom&&(e.y=Math.max(Math.min(c.bottom+n.bottom,r.y),l.bottom+n.bottom)),i.left?e.x=Math.min(Math.max(c.left+n.left,r.x),l.left+n.left):i.right&&(e.x=Math.max(Math.min(c.right+n.right,r.x),l.right+n.right))}},defaults:{inner:null,outer:null,offset:null,endOnly:!1,enabled:!1}},$i=Pe(Fi,"restrictEdges"),qi=Z({get elementRect(){return{top:0,left:0,bottom:1,right:1}},set elementRect(t){}},Li.defaults),Gi=Pe({start:Li.start,set:Li.set,defaults:qi},"restrictRect"),Bi={width:-1/0,height:-1/0},ji={width:1/0,height:1/0},Ui=Pe({start:function(t){return Fi.start(t)},set:function(t){var e=t.interaction,i=t.state,a=t.rect,s=t.edges,n=i.options;if(s){var o=at(Oi(n.min,e,t.coords))||Bi,r=at(Oi(n.max,e,t.coords))||ji;i.options={endOnly:n.endOnly,inner:Z({},Fi.noInner),outer:Z({},Fi.noOuter)},s.top?(i.options.inner.top=a.bottom-o.height,i.options.outer.top=a.bottom-r.height):s.bottom&&(i.options.inner.bottom=a.top+o.height,i.options.outer.bottom=a.top+r.height),s.left?(i.options.inner.left=a.right-o.width,i.options.outer.left=a.right-r.width):s.right&&(i.options.inner.right=a.left+o.width,i.options.outer.right=a.left+r.width),Fi.set(t),i.options=n}},defaults:{min:null,max:null,endOnly:!1,enabled:!1}},"restrictSize"),Yi={start:function(t){var e,i=t.interaction,a=t.interactable,s=t.element,n=t.rect,o=t.state,r=t.startOffset,l=o.options,c=l.offsetWithOrigin?function(t){var e=t.interaction.element;return it(et(t.state.options.origin,null,null,[e]))||nt(t.interactable,e,t.interaction.prepared.name)}(t):{x:0,y:0};if("startCoords"===l.offset)e={x:i.coords.start.page.x,y:i.coords.start.page.y};else{var d=et(l.offset,a,s,[i]);(e=it(d)||{x:0,y:0}).x+=c.x,e.y+=c.y}var h=l.relativePoints;o.offsets=n&&h&&h.length?h.map(function(t,i){return{index:i,relativePoint:t,x:r.left-n.width*t.x+e.x,y:r.top-n.height*t.y+e.y}}):[{index:0,relativePoint:null,x:e.x,y:e.y}]},set:function(t){var e=t.interaction,i=t.coords,a=t.state,s=a.options,n=a.offsets,o=nt(e.interactable,e.element,e.prepared.name),r=Z({},i),l=[];s.offsetWithOrigin||(r.x-=o.x,r.y-=o.y);for(var c=0,d=n;c<d.length;c++)for(var h=d[c],u=r.x-h.x,p=r.y-h.y,m=0,f=s.targets.length;m<f;m++){var g,_=s.targets[m];(g=C(_)?_(u,p,e._proxy,h,m):_)&&l.push({x:(I(g.x)?g.x:u)+h.x,y:(I(g.y)?g.y:p)+h.y,range:I(g.range)?g.range:s.range,source:_,index:m,offset:h})}for(var y={target:null,inRange:!1,distance:0,range:0,delta:{x:0,y:0}},v=0;v<l.length;v++){var b=l[v],E=b.range,A=b.x-r.x,w=b.y-r.y,S=lt(A,w),x=S<=E;E===1/0&&y.inRange&&y.range!==1/0&&(x=!1),y.target&&!(x?y.inRange&&E!==1/0?S/E<y.distance/y.range:E===1/0&&y.range!==1/0||S<y.distance:!y.inRange&&S<y.distance)||(y.target=b,y.distance=S,y.range=E,y.inRange=x,y.delta.x=A,y.delta.y=w)}return y.inRange&&(i.x=y.target.x,i.y=y.target.y),a.closest=y,y},defaults:{range:1/0,targets:null,offset:null,offsetWithOrigin:!0,origin:null,relativePoints:null,endOnly:!1,enabled:!1}},zi=Pe(Yi,"snap"),Vi={start:function(t){var e=t.state,i=t.edges,a=e.options;if(!i)return null;t.state={options:{targets:null,relativePoints:[{x:i.left?0:1,y:i.top?0:1}],offset:a.offset||"self",origin:{x:0,y:0},range:a.range}},e.targetFields=e.targetFields||[["width","height"],["x","y"]],Yi.start(t),e.offsets=t.state.offsets,t.state=e},set:function(t){var e=t.interaction,i=t.state,a=t.coords,s=i.options,n=i.offsets,o={x:a.x-n[0].x,y:a.y-n[0].y};i.options=Z({},s),i.options.targets=[];for(var r=0,l=s.targets||[];r<l.length;r++){var c=l[r],d=void 0;if(d=C(c)?c(o.x,o.y,e):c){for(var h=0,u=i.targetFields;h<u.length;h++){var p=u[h],m=p[0],f=p[1];if(m in d||f in d){d.x=d[m],d.y=d[f];break}}i.options.targets.push(d)}}var g=Yi.set(t);return i.options=s,g},defaults:{range:1/0,targets:null,offset:null,endOnly:!1,enabled:!1}},Wi=Pe(Vi,"snapSize"),Hi={aspectRatio:Ti,restrictEdges:$i,restrict:Ri,restrictRect:Gi,restrictSize:Ui,snapEdges:Pe({start:function(t){var e=t.edges;return e?(t.state.targetFields=t.state.targetFields||[[e.left?"left":"right",e.top?"top":"bottom"]],Vi.start(t)):null},set:Vi.set,defaults:Z(xe(Vi.defaults),{targets:void 0,range:void 0,offset:{x:0,y:0}})},"snapEdges"),snap:zi,snapSize:Wi,spring:Pi,avoid:Pi,transform:Pi,rubberband:Pi},Ki={id:"modifiers",install:function(t){var e=t.interactStatic;for(var i in t.usePlugin(Re),t.usePlugin(Si),e.modifiers=Hi,Hi){var a=Hi[i],s=a._defaults,n=a._methods;s._methods=n,t.defaults.perAction[i]=s}}},Qi=Ki,Xi=function(t){l(i,t);var e=u(i);function i(t,a,n,o,r,l){var c;if(s(this,i),dt(h(c=e.call(this,r)),n),n!==a&&dt(h(c),a),c.timeStamp=l,c.originalEvent=n,c.type=t,c.pointerId=gt(a),c.pointerType=At(a),c.target=o,c.currentTarget=null,"tap"===t){var d=r.getPointerIndex(a);c.dt=c.timeStamp-r.pointers[d].downTime;var u=c.timeStamp-r.tapTime;c.double=!!r.prevTap&&"doubletap"!==r.prevTap.type&&r.prevTap.target===c.target&&u<500}else"doubletap"===t&&(c.dt=a.timeStamp-r.tapTime,c.double=!0);return c}return o(i,[{key:"_subtractOrigin",value:function(t){var e=t.x,i=t.y;return this.pageX-=e,this.pageY-=i,this.clientX-=e,this.clientY-=i,this}},{key:"_addOrigin",value:function(t){var e=t.x,i=t.y;return this.pageX+=e,this.pageY+=i,this.clientX+=e,this.clientY+=i,this}},{key:"preventDefault",value:function(){this.originalEvent.preventDefault()}}]),i}(St),Ji={id:"pointer-events/base",before:["inertia","modifiers","auto-start","actions"],install:function(t){t.pointerEvents=Ji,t.defaults.actions.pointerEvents=Ji.defaults,Z(t.actions.phaselessTypes,Ji.types)},listeners:{"interactions:new":function(t){var e=t.interaction;e.prevTap=null,e.tapTime=0},"interactions:update-pointer":function(t){var e=t.down,i=t.pointerInfo;!e&&i.hold||(i.hold={duration:1/0,timeout:null})},"interactions:move":function(t,e){var i=t.interaction,a=t.pointer,s=t.event,n=t.eventTarget;t.duplicate||i.pointerIsDown&&!i.pointerWasMoved||(i.pointerIsDown&&ea(t),Zi({interaction:i,pointer:a,event:s,eventTarget:n,type:"move"},e))},"interactions:down":function(t,e){!function(t,e){for(var i=t.interaction,a=t.pointer,s=t.event,n=t.eventTarget,o=t.pointerIndex,r=i.pointers[o].hold,l=X(n),c={interaction:i,pointer:a,event:s,eventTarget:n,type:"hold",targets:[],path:l,node:null},d=0;d<l.length;d++){var h=l[d];c.node=h,e.fire("pointerEvents:collect-targets",c)}if(c.targets.length){for(var u=1/0,p=0,m=c.targets;p<m.length;p++){var f=m[p].eventable.options.holdDuration;f<u&&(u=f)}r.duration=u,r.timeout=setTimeout(function(){Zi({interaction:i,eventTarget:n,pointer:a,event:s,type:"hold"},e)},u)}}(t,e),Zi(t,e)},"interactions:up":function(t,e){ea(t),Zi(t,e),function(t,e){var i=t.interaction,a=t.pointer,s=t.event,n=t.eventTarget;i.pointerWasMoved||Zi({interaction:i,eventTarget:n,pointer:a,event:s,type:"tap"},e)}(t,e)},"interactions:cancel":function(t,e){ea(t),Zi(t,e)}},PointerEvent:Xi,fire:Zi,collectEventTargets:ta,defaults:{holdDuration:600,ignoreFrom:null,allowFrom:null,origin:{x:0,y:0}},types:{down:!0,move:!0,up:!0,cancel:!0,tap:!0,doubletap:!0,hold:!0}};function Zi(t,e){var i=t.interaction,a=t.pointer,s=t.event,n=t.eventTarget,o=t.type,r=t.targets,l=void 0===r?ta(t,e):r,c=new Xi(o,a,s,n,i,e.now());e.fire("pointerEvents:new",{pointerEvent:c});for(var d={interaction:i,pointer:a,event:s,eventTarget:n,targets:l,type:o,pointerEvent:c},h=0;h<l.length;h++){var u=l[h];for(var p in u.props||{})c[p]=u.props[p];var m=nt(u.eventable,u.node);if(c._subtractOrigin(m),c.eventable=u.eventable,c.currentTarget=u.node,u.eventable.fire(c),c._addOrigin(m),c.immediatePropagationStopped||c.propagationStopped&&h+1<l.length&&l[h+1].node!==c.currentTarget)break}if(e.fire("pointerEvents:fired",d),"tap"===o){var f=c.double?Zi({interaction:i,pointer:a,event:s,eventTarget:n,type:"doubletap"},e):c;i.prevTap=f,i.tapTime=f.timeStamp}return c}function ta(t,e){var i=t.interaction,a=t.pointer,s=t.event,n=t.eventTarget,o=t.type,r=i.getPointerIndex(a),l=i.pointers[r];if("tap"===o&&(i.pointerWasMoved||!l||l.downTarget!==n))return[];for(var c=X(n),d={interaction:i,pointer:a,event:s,eventTarget:n,type:o,path:c,targets:[],node:null},h=0;h<c.length;h++){var u=c[h];d.node=u,e.fire("pointerEvents:collect-targets",d)}return"hold"===o&&(d.targets=d.targets.filter(function(t){var e,a;return t.eventable.options.holdDuration===(null==(e=i.pointers[r])||null==(a=e.hold)?void 0:a.duration)})),d.targets}function ea(t){var e=t.interaction,i=t.pointerIndex,a=e.pointers[i].hold;a&&a.timeout&&(clearTimeout(a.timeout),a.timeout=null)}var ia=Object.freeze({__proto__:null,default:Ji});function aa(t){var e=t.interaction;e.holdIntervalHandle&&(clearInterval(e.holdIntervalHandle),e.holdIntervalHandle=null)}var sa={id:"pointer-events/holdRepeat",install:function(t){t.usePlugin(Ji);var e=t.pointerEvents;e.defaults.holdRepeatInterval=0,e.types.holdrepeat=t.actions.phaselessTypes.holdrepeat=!0},listeners:["move","up","cancel","endall"].reduce(function(t,e){return t["pointerEvents:".concat(e)]=aa,t},{"pointerEvents:new":function(t){var e=t.pointerEvent;"hold"===e.type&&(e.count=(e.count||0)+1)},"pointerEvents:fired":function(t,e){var i=t.interaction,a=t.pointerEvent,s=t.eventTarget,n=t.targets;if("hold"===a.type&&n.length){var o=n[0].eventable.options.holdRepeatInterval;o<=0||(i.holdIntervalHandle=setTimeout(function(){e.pointerEvents.fire({interaction:i,eventTarget:s,type:"hold",pointer:a,event:a},e)},o))}}})},na=sa,oa={id:"pointer-events/interactableTargets",install:function(t){var e=t.Interactable;e.prototype.pointerEvents=function(t){return Z(this.events.options,t),this};var i=e.prototype._backCompatOption;e.prototype._backCompatOption=function(t,e){var a=i.call(this,t,e);return a===this&&(this.events.options[t]=e),a}},listeners:{"pointerEvents:collect-targets":function(t,e){var i=t.targets,a=t.node,s=t.type,n=t.eventTarget;e.interactables.forEachMatch(a,function(t){var e=t.events,o=e.options;e.types[s]&&e.types[s].length&&t.testIgnoreAllow(o,a,n)&&i.push({node:a,eventable:e,props:{interactable:t}})})},"interactable:new":function(t){var e=t.interactable;e.events.getRect=function(t){return e.getRect(t)}},"interactable:set":function(t,e){var i=t.interactable,a=t.options;Z(i.events.options,e.pointerEvents.defaults),Z(i.events.options,a.pointerEvents||{})}}},ra=oa,la={id:"pointer-events",install:function(t){t.usePlugin(ia),t.usePlugin(na),t.usePlugin(ra)}},ca=la,da={id:"reflow",install:function(t){var e=t.Interactable;t.actions.phases.reflow=!0,e.prototype.reflow=function(e){return function(t,e,i){for(var a=t.getAllElements(),s=i.window.Promise,n=s?[]:null,o=function(){var o=a[r],l=t.getRect(o);if(!l)return 1;var c,d=Tt(i.interactions.list,function(i){return i.interacting()&&i.interactable===t&&i.element===o&&i.prepared.name===e.name});if(d)d.move(),n&&(c=d._reflowPromise||new s(function(t){d._reflowResolve=t}));else{var h=at(l),u=function(t){return{coords:t,get page(){return this.coords.page},get client(){return this.coords.client},get timeStamp(){return this.coords.timeStamp},get pageX(){return this.coords.page.x},get pageY(){return this.coords.page.y},get clientX(){return this.coords.client.x},get clientY(){return this.coords.client.y},get pointerId(){return this.coords.pointerId},get target(){return this.coords.target},get type(){return this.coords.type},get pointerType(){return this.coords.pointerType},get buttons(){return this.coords.buttons},preventDefault:function(){}}}({page:{x:h.x,y:h.y},client:{x:h.x,y:h.y},timeStamp:i.now()});c=function(t,e,i,a,s){var n=t.interactions.new({pointerType:"reflow"}),o={interaction:n,event:s,pointer:s,eventTarget:i,phase:"reflow"};n.interactable=e,n.element=i,n.prevEvent=s,n.updatePointer(s,s,i,!0),ut(n.coords.delta),se(n.prepared,a),n._doPhase(o);var r=t.window.Promise,l=r?new r(function(t){n._reflowResolve=t}):void 0;return n._reflowPromise=l,n.start(a,e,i),n._interacting?(n.move(o),n.end(s)):(n.stop(),n._reflowResolve()),n.removePointer(s,s),l}(i,t,o,e,u)}n&&n.push(c)},r=0;r<a.length&&!o();r++);return n&&s.all(n).then(function(){return t})}(this,e,t)}},listeners:{"interactions:stop":function(t,e){var i=t.interaction;"reflow"===i.pointerType&&(i._reflowResolve&&i._reflowResolve(),function(t,e){t.splice(t.indexOf(e),1)}(e.interactions.list,i))}}},ha=da;if(bi.use(Ce),bi.use(Ve),bi.use(ca),bi.use(Je),bi.use(Qi),bi.use(Ae),bi.use(Wt),bi.use(ie),bi.use(ha),bi.default=bi,"object"===a(t)&&t)try{t.exports=bi}catch(e){}return bi.default=bi,bi}()}(xu);var Tu=g(xu.exports);class Mu{constructor(t,e,i){Object.defineProperty(this,"baseCreator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dataModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mapModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pathGroup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isMoving",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isDrawing",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isNameVisible",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isSelected",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"strokeColor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"selectedColor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.dataModel=e,this.mapModel=i,this.baseCreator=t,this.pathGroup=null,this.isMoving=!1,this.isDrawing=!1,this.isNameVisible=!0,this.isSelected=!1,this.strokeColor="black",this.selectedColor=Fc.ITEM_SELECTED}getBaseType(){return this.dataModel.baseType}getID(){return this.dataModel.id}getName(){return this.dataModel.getName()}setSelectedState(t){this.isSelected=t}setStrokeColor(t){t&&(this.strokeColor=t)}setColor(t){var e;t=t||(this.isSelected?this.selectedColor:this.strokeColor),null===(e=this.pathGroup)||void 0===e||e.children.forEach(e=>{e.setAttribute(e instanceof lr?"fill":"stroke",t)})}isDirty(){return this.dataModel.isDirty}updateShape(){this.pathGroup&&(this.setDraggable(!1),this.pathGroup.destroy())}setNameVisible(t){}setMovingState(t=!1){this.isMoving=t}setHoverAble(t){this.baseCreator.stageModel.isEditable&&(t?(this.pathGroup.addEventListener("mouseenter",()=>{!this.isSelected&&this.setColor(this.selectedColor)}),this.pathGroup.addEventListener("mouseleave",()=>{!this.isSelected&&this.setColor(this.strokeColor)})):this.pathGroup.removeAllEventListeners())}setDraggable(t=!1,e=this.pathGroup){this.baseCreator.stageModel.isEditable&&e&&(t?Tu(e,{context:this.baseCreator.canvas.document}).draggable({listeners:{start:async t=>{try{await this.baseCreator.stageModel.moveStage.drawBefore(this.baseCreator.actionManage.pointerPoint)}catch(t){}},move:async t=>{try{await this.baseCreator.stageModel.moveStage.drawing(this.baseCreator.actionManage.movingPoint)}catch(t){}},end:async t=>{try{await this.baseCreator.stageModel.moveStage.drawEnd(this.baseCreator.actionManage.movingPoint)}catch(t){}}}}):Tu(e,{context:this.baseCreator.canvas.document}).unset())}setScenePos(t){var e;null===(e=this.pathGroup)||void 0===e||e.setPosition(t.x,-t.y)}delete(){this.pathGroup&&(this.setSelectedState(!1),this.setDraggable(!1),this.pathGroup.destroy())}}class Pu extends Mu{constructor(t,e,i){super(t,e,i),Object.defineProperty(this,"dataModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.dataModel=e}updateShape(){super.updateShape(),this.pathGroup=Eu(this.dataModel.toJson()),this.baseCreator.getGroupMap(nd.TAG,qc.TAG).append(this.pathGroup)}setDraggable(){}}class Ou extends Mu{constructor(t,e,i){super(t,e,i),Object.defineProperty(this,"dataModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.dataModel=e}updateChildrenShape(t=!1){if(this.pathGroup){const e=gu(this.dataModel.toJson(),this.dataModel.baseType);if(t){const t=[];this.pathGroup.children.forEach((e,i)=>{i<=1&&t.push(e)});const i=e.splice(2);i.length&&this.pathGroup.replaceChildren(...t,...i)}else this.pathGroup.replaceChildren(...e)}else this.updateShape()}setDraggable(t=!1){this.setResizable(t,this.pathGroup.firstChild),super.setDraggable(t,this.pathGroup.children[1])}setResizable(t=!1,e=this.pathGroup.firstChild){this.baseCreator.stageModel.isEditable&&e&&(t?Tu(e,{context:this.baseCreator.canvas.document}).resizable({edges:{left:!0,right:!0,bottom:!0,top:!0},listeners:{start:async t=>{try{await this.baseCreator.stageModel.funcAreaStage.resizeBefore(this.getID())}catch(t){}},move:async t=>{try{await this.baseCreator.stageModel.funcAreaStage.resizing(t)}catch(t){}},end:async t=>{try{await this.baseCreator.stageModel.funcAreaStage.resizeEnd()}catch(t){}}},modifiers:[Tu.modifiers.restrictSize({min:{width:10,height:10},endOnly:!0})]}):Tu(e,{context:this.baseCreator.canvas.document}).unset())}setPosPc(t,e){const{pa:i,pc:a}=function(t,e){let{x:i,y:a}=t,{x:s,y:n}=e;return lh(i,s)?s=i+1:i>s&&([i,s]=[s,i]),lh(a,n)?n=a-1:a<n&&([a,n]=[n,a]),{pa:new Md(i,a,0),pc:new Md(s,n,0)}}(t,e);this.dataModel.setPos(i,a),this.pathGroup.firstChild.setAttribute("width",a.x-i.x),this.pathGroup.firstChild.setAttribute("height",i.y-a.y),this.setScenePos(i)}setColor(t){var e;t=t||(this.isSelected?this.selectedColor:this.strokeColor),null===(e=this.pathGroup)||void 0===e||e.children.forEach(e=>{e instanceof lr?e.setAttribute("fill",this.isSelected?t:Lc.TEXT):e.setAttribute("stroke",t)})}}class Lu extends Ou{constructor(t,e,i){super(t,e,i)}updateShape(){super.updateShape(),this.pathGroup=fu(this.dataModel.toJson(),this.dataModel.baseType),this.dataModel.isCleanArea()?this.baseCreator.getGroupMap(nd.CLEAN_AREA,qc.CLEAN_AREA).append(this.pathGroup):this.dataModel.isSelectionArea()?this.baseCreator.getGroupMap(nd.SELECTION_AREA,qc.CLEAN_AREA).append(this.pathGroup):this.baseCreator.getGroupMap(nd.BUILDING_AREA,qc.BUILDING_AREA).append(this.pathGroup)}setHoverAble(t){this.dataModel.isCleanArea()||this.dataModel.isSelectionArea()||super.setHoverAble(t)}setDraggable(t=!1){this.dataModel.isCleanArea()||this.dataModel.isSelectionArea()||super.setDraggable(t)}}class Ru extends Ou{constructor(t,e,i){super(t,e,i),Object.defineProperty(this,"dataModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.dataModel=e,this.setStrokeColor()}updateShape(){super.updateShape(),this.pathGroup=fu(this.dataModel.toJson(),jc.FUNC_AREA),this.baseCreator.getGroupMap(nd.FUNC_AREA,qc.FUNC_AREA).append(this.pathGroup)}setStrokeColor(){let t=Lc.NORMAL;switch(this.dataModel.type){case Kc.FORBID_ENTRY:t=Lc.FORBID_ENTRY;break;case Kc.SPEED_LEVEL_20:case Kc.SPEED_LEVEL_40:case Kc.SPEED_LEVEL_60:case Kc.SPEED_LEVEL_80:t=Lc.DECELERATE;break;case Kc.DISABLE_OBA:t=Lc.DISABLE_OBA;break;case Kc.DISABLE_ROTATE:t=Lc.DISABLE_ROTATE;break;case Kc.DISABLE_REROUTE:t=Lc.DISABLE_REROUTE;break;case Kc.LIMIT_CAR_NUMBER:t=Lc.LIMIT_CAR_NUMBER;break;case Kc.ONEWAY_TRAFFIC:t=Lc.ONEWAY_TRAFFIC;break;case Kc.LOCAL_REPLAN:t=Lc.LOCAL_REPLAN;break;case Kc.USER_DEFINE:t=Lc.USER_DEFINE}super.setStrokeColor(t)}}class Du extends Ou{constructor(t,e,i){super(t,e,i),Object.defineProperty(this,"dataModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.dataModel=e,this.setStrokeColor()}updateShape(){super.updateShape(),this.pathGroup=fu(this.dataModel.toJson(),jc.NOTE_AREA),this.baseCreator.getGroupMap(nd.NOTE_AREA,qc.NOTE_AREA).append(this.pathGroup)}setStrokeColor(){const t=Lc.TEXT;super.setStrokeColor(t)}setColor(t){var e;t=t||(this.isSelected?this.selectedColor:this.strokeColor);const i=this.dataModel.fontColor;null===(e=this.pathGroup)||void 0===e||e.children.forEach((e,a)=>{const s="text"===e.nodeName?"fill":"stroke";t=this.isSelected?t:1!==a?i:Lc.TEXT,e.setAttribute(s,t)})}}class Nu extends Ou{constructor(t,e,i){super(t,e,i),Object.defineProperty(this,"dataModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.dataModel=e,this.setStrokeColor()}updateShape(){super.updateShape(),this.pathGroup=fu(this.dataModel.toJson(),jc.LOCATION_AREA),this.baseCreator.getGroupMap(nd.LOCATION_AREA,qc.LOCATION_AREA,!1).append(this.pathGroup)}setStrokeColor(){const t=Lc.NORMAL;super.setStrokeColor(t)}}class ku extends Mu{constructor(t,e,i){super(t,e,i),Object.defineProperty(this,"dataModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.dataModel=e,this.setStrokeColor(Mc.NORMAL)}updateShape(){super.updateShape(),this.pathGroup=uu(this.dataModel.toJson());const t=this.baseCreator.getGroupMap(nd.NODE,qc.NODE);t.attr("filter","blur(10px)"),t.append(this.pathGroup)}setPos(t){super.setScenePos(t),this.dataModel.setPos(t)}}class Fu extends Mu{constructor(t,e,i){super(t,e,i),Object.defineProperty(this,"dataModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.dataModel=e,this.setStrokeColor()}updateShape(){super.updateShape(),this.pathGroup=lu(this.dataModel.toJson()),this.baseCreator.getGroupMap(nd.EDGE,qc.EDGE).append(this.pathGroup)}updateChildrenShape(){this.pathGroup?this.pathGroup.replaceChildren(...cu(this.dataModel.toJson())):this.updateShape()}setStartPos(t){this.dataModel.setStartPos(t),this.updateChildrenShape()}setEndPos(t){this.dataModel.setEndPos(t),this.updateChildrenShape()}setStrokeColor(){let t=Pc.FORWARD;this.dataModel.robot_direction!==Qc.FORWARD?t=Pc.UN_FORWARD:this.dataModel.param===Xc.FREE?t=Pc.FREE:this.dataModel.param===Xc.LOAD&&(t=Pc.LOAD),super.setStrokeColor(t)}}class $u extends Mu{constructor(t,e,i){super(t,e,i),Object.defineProperty(this,"dataModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setStartPos",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.dataModel.setStartPos(t)}}),Object.defineProperty(this,"setEndPos",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.dataModel.setEndPos(t)}}),Object.defineProperty(this,"setCPos",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.dataModel.setCPos(t)}}),Object.defineProperty(this,"setDPos",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.dataModel.setDPos(t)}}),this.dataModel=e,this.setStrokeColor()}updateShape(){super.updateShape(),this.pathGroup=du(this.dataModel.toJson()),this.baseCreator.getGroupMap(nd.EDGE,qc.EDGE).append(this.pathGroup)}updateChildrenShape(){this.pathGroup?this.pathGroup.replaceChildren(...hu(this.dataModel.toJson())):this.updateShape()}updateShapePole(){this.pathGroup.append(...function(t){const{sx:e,sy:i,cx:a,cy:s}=t;return[new Xo({style:{cx:a/Sc,cy:s/-10,r:8,fill:"red"}}),new ar({style:{x1:e/Sc,y1:i/-10,x2:a/Sc,y2:s/-10,stroke:"red",lineDash:[4,2],lineWidth:6}})]}(this.dataModel.toJson()),...function(t){const{ex:e,ey:i,dx:a,dy:s}=t;return[new Xo({style:{cx:a/Sc,cy:s/-10,r:8,fill:"green"}}),new ar({style:{x1:e/Sc,y1:i/-10,x2:a/Sc,y2:s/-10,stroke:"green",lineDash:[4,2],lineWidth:6}})]}(this.dataModel.toJson()))}setStrokeColor(){let t=Pc.FORWARD;this.dataModel.robot_direction!==Qc.FORWARD?t=Pc.UN_FORWARD:this.dataModel.param===Xc.FREE?t=Pc.FREE:this.dataModel.param===Xc.LOAD&&(t=Pc.LOAD),super.setStrokeColor(t)}}function qu(t){return[new ar({interactive:!1,style:{x1:t.dataModel.startPos.x,y1:-t.dataModel.startPos.y,x2:t.dataModel.cPos.x,y2:-t.dataModel.cPos.y,stroke:"black",lineDash:[4,2],lineWidth:2}}),new ar({interactive:!1,style:{x1:t.dataModel.dPos.x,y1:-t.dataModel.dPos.y,x2:t.dataModel.endPos.x,y2:-t.dataModel.endPos.y,stroke:"black",lineDash:[4,2],lineWidth:2}})]}class Gu extends Mu{constructor(t,e){super(t,{baseType:jc.EDGE_POLE},t.mapModel),Object.defineProperty(this,"baseCreator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"itemEdge",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pathGroup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseCreator=t,this.itemEdge=e,this.pathGroup=this.updatePoleShape(e)}updatePoleShape(t){return super.updateShape(),this.pathGroup=function(t){const e=t.getID(),i=new tr({id:`${jc.EDGE_POLE}-${zc.NONE}-${e}`});return i.append(...function(t){const e=t.getID(),i=new Xo({id:`${jc.EDGE_POLE}-${zc.START}-${e}`,style:{cx:t.dataModel.startPos.x,cy:-t.dataModel.startPos.y,r:12,fill:"white",stroke:"blue",lineWidth:6,zIndex:1}}),a=new Xo({id:`${jc.EDGE_POLE}-${zc.END}-${e}`,style:{cx:t.dataModel.endPos.x,cy:-t.dataModel.endPos.y,r:12,fill:"white",stroke:"blue",lineWidth:6,zIndex:1}});return t.dataModel.isEdgeBezier()?[i,a,new Xo({id:`${jc.EDGE_POLE}-${zc.C}-${e}`,style:{cx:t.dataModel.cPos.x,cy:-t.dataModel.cPos.y,r:12,fill:"white",stroke:"blue",lineWidth:6,zIndex:1}}),new Xo({id:`${jc.EDGE_POLE}-${zc.D}-${e}`,style:{cx:t.dataModel.dPos.x,cy:-t.dataModel.dPos.y,r:12,fill:"white",stroke:"blue",lineWidth:6,zIndex:1}}),...qu(t)]:[i,a]}(t)),i}(t),this.baseCreator.getGroupMap(nd.EDGE,qc.EDGE).append(this.pathGroup),this.pathGroup}updatePolePos(t,e,i){var a,s;if(null!==(a=this.pathGroup)&&void 0!==a&&a.children[e-1]&&(i instanceof Fu&&null!==(s=this.pathGroup)&&void 0!==s&&s.children[e-1].setPosition(t.x,-t.y),i instanceof $u)){var n,o,r,l,c,d,h,u,p,m;null!==(n=this.pathGroup)&&void 0!==n&&n.children[0].setPosition(i.dataModel.startPos.x,-i.dataModel.startPos.y),null!==(o=this.pathGroup)&&void 0!==o&&o.children[1].setPosition(i.dataModel.endPos.x,-i.dataModel.endPos.y),null!==(r=this.pathGroup)&&void 0!==r&&r.children[2].setPosition(i.dataModel.cPos.x,-i.dataModel.cPos.y),null===(l=this.pathGroup)||void 0===l||l.children[3].setPosition(i.dataModel.dPos.x,-i.dataModel.dPos.y);const t=qu(i);null!==(c=this.pathGroup)&&void 0!==c&&c.children[4]?null===(d=this.pathGroup)||void 0===d||d.children[4].replaceWith(t[0]):null===(h=this.pathGroup)||void 0===h||h.append(t[0]),null!==(u=this.pathGroup)&&void 0!==u&&u.children[5]?null===(p=this.pathGroup)||void 0===p||p.children[5].replaceWith(t[1]):null===(m=this.pathGroup)||void 0===m||m.append(t[1])}}setTargetPoleStatus(t,e){var i,a,s,n;e!==t&&(t&&(null!==(i=this.pathGroup.children[t-1])&&void 0!==i&&i.setAttribute("fill","white"),this.setDraggable(!1,null===(a=this.pathGroup)||void 0===a?void 0:a.children[t-1])),e&&(null!==(s=this.pathGroup.children[e-1])&&void 0!==s&&s.setAttribute("fill","red"),this.setDraggable(!0,null===(n=this.pathGroup)||void 0===n?void 0:n.children[e-1])))}setHoverAble(){}}class Bu extends Mu{constructor(t,e,i){super(t,e,i),Object.defineProperty(this,"dataModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isAbnormal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.dataModel=e,this.isAbnormal=!1,this.setStrokeColor()}updateShape(){super.updateShape(),this.pathGroup=ru(this.dataModel.toJson()),this.baseCreator.getGroupMap(nd.STATION,qc.STATION).append(this.pathGroup)}setPos(t){super.setScenePos(t),this.dataModel.setPos(t)}setYaw(t){var e;null!==(e=this.pathGroup)&&void 0!==e&&e.firstChild.setEulerAngles(Zd(-t)),this.dataModel.setYaw(t)}setStrokeColor(){let t=Tc.NORMAL;if(this.isAbnormal)t=Fc.ITEM_ERROR;else switch(this.dataModel.type){case Uc.CHARGE:t=Tc.CHARGE;break;case Uc.DOCK:t=Tc.DOCK;break;case Uc.WORK:t=Tc.WORK;break;case Uc.WAREROOM:t=Tc.WAREROOM;break;case Uc.AVOID:t=Tc.AVOID;break;case Uc.RACK:t=Tc.RACK;break;case Uc.USER_DEFINE:t=Tc.USER_DEFINE}super.setStrokeColor(t)}isStationTypeWareroom(){return this.dataModel.type===Uc.WAREROOM}getStationWareroom(){return{wareroomAreaId:this.dataModel.wareroomAreaId,wareroomRegionId:this.dataModel.wareroomRegionId,wareroomLocationRow:this.dataModel.wareroomLocationRow,wareroomLocationColumn:this.dataModel.wareroomLocationColumn,wareroomLocationStorey:this.dataModel.wareroomLocationStorey}}}class ju extends Mu{constructor(t,e,i){super(t,e,i),Object.defineProperty(this,"dataModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.dataModel=e}updateShape(){super.updateShape(),this.pathGroup=yu(this.dataModel.toJson()),this.baseCreator.getGroupMap(nd.DMCODE,qc.DMCODE).append(this.pathGroup)}setDraggable(){}}class Uu extends Iu{constructor(t){super(t),Object.defineProperty(this,"shapeItemList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.shapeItemList=[]}createShapeItem(t){const e=new Pu(this.baseCreator,t,this.baseCreator.mapModel);return this.shapeItemList.push(e),this.addItemToList(e),e.updateShape(),e}drawBefore(t){const e=this.baseCreator.mapModel.createModel(jc.TAG);e.setPos(t),e.setYaw(t.yaw);const i=new Pu(this.baseCreator,e,this.baseCreator.mapModel);return this.shapeItemList.push(i),this.addItemToList(i),i.updateShape(),this.baseCreator.cancelInteraction(),i}async tag2Node(t){const e=this.getOneItem(t);e&&(this.baseCreator.stageModel.nodeStage.addNode(e.dataModel.pos),await this.delete(t))}async allTags2Nodes(){for(const t of[...this.shapeItemList])await this.tag2Node(t.getID())}async tag2Station(t){const e=this.getOneItem(t);if(e){const i=e.dataModel.pos,a=await this.baseCreator.stageModel.stationStage.drawStart();a.setPos(i),a.setYaw(i.yaw),await this.delete(t)}}async allTags2Stations(){for(const t of[...this.shapeItemList])await this.tag2Station(t.getID())}async delete(t){this.baseCreator.mapModel.deleteTag(t),super.delete(t)}}class Yu extends Iu{constructor(t){super(t),Object.defineProperty(this,"curShapeItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shapeItemList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scenePosPa",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.curShapeItem=null,this.shapeItemList=[],this.scenePosPa=null}async resizeBefore(t,e=this.baseCreator.stageModel.selectedItemList[0]){var i;this.baseCreator.actionManage.action===Bc.NORMAL&&1===this.baseCreator.stageModel.selectedItemList.length&&e.dataModel.isRectModel()&&e.getID()===t&&(null===(i=e.pathGroup)||void 0===i?void 0:i.firstChild)&&this.baseCreator.setInteraction(Bc.RESIZE_ITEMS)}async resizing(t,e=this.baseCreator.stageModel.selectedItemList[0]){var i,a;this.baseCreator.actionManage.action===Bc.RESIZE_ITEMS&&e&&e.pathGroup.firstChild&&(e.pathGroup.translateLocal((null===(i=t.deltaRect)||void 0===i?void 0:i.left)||0,(null===(a=t.deltaRect)||void 0===a?void 0:a.top)||0),e.pathGroup.firstChild.style.width=t.rect.width,e.pathGroup.firstChild.style.height=t.rect.height)}async resizeEnd(t=this.baseCreator.stageModel.selectedItemList[0]){if(this.baseCreator.actionManage.action===Bc.RESIZE_ITEMS&&t&&t.pathGroup.firstChild){const e=t.pathGroup.firstChild.style,[i=0,a=0]=t.pathGroup.getPosition(),s=Number(e.width||0),n=Number(e.height||0);t.pathGroup.firstChild.style.x=0,t.pathGroup.firstChild.style.y=0,t.setPosPc(new Md(i,-a,0),new Md(i+s,-a-n,0)),t.updateChildrenShape(!0)}this.baseCreator.actionManage.setAction(Bc.NORMAL)}async resizeCancel(t=this.baseCreator.stageModel.selectedItemList[0]){this.baseCreator.actionManage.action===Bc.RESIZE_ITEMS&&t&&(t.setDraggable(!1),await this.resizeEnd())}async moveTo(t,e,i,a){return e.setScenePos(t),i===Vc.END&&e.setPosPc(t,e.dataModel.pc.subtract(e.dataModel.pa).add(t)),!0}}let zu;const Vu=new Uint8Array(16);function Wu(){if(!zu&&(zu="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!zu))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return zu(Vu)}const Hu=[];for(let t=0;t<256;++t)Hu.push((t+256).toString(16).slice(1));var Ku,Qu,Xu,Ju,Zu={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function tp(t,e,i){if(Zu.randomUUID&&!e&&!t)return Zu.randomUUID();const a=(t=t||{}).random||(t.rng||Wu)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e){i=i||0;for(let t=0;t<16;++t)e[i+t]=a[t];return e}return function(t,e=0){return Hu[t[e+0]]+Hu[t[e+1]]+Hu[t[e+2]]+Hu[t[e+3]]+"-"+Hu[t[e+4]]+Hu[t[e+5]]+"-"+Hu[t[e+6]]+Hu[t[e+7]]+"-"+Hu[t[e+8]]+Hu[t[e+9]]+"-"+Hu[t[e+10]]+Hu[t[e+11]]+Hu[t[e+12]]+Hu[t[e+13]]+Hu[t[e+14]]+Hu[t[e+15]]}(a)}class ep extends Yu{constructor(t){super(t),Object.defineProperty(this,"curShapeItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scenePosPa",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.curShapeItem=null,this.scenePosPa=null}createShapeItem(t){const e=new Lu(this.baseCreator,t,this.baseCreator.mapModel);return e.updateShape(),this.shapeItemList.push(e),e}async drawBefore(t){this.curShapeItem||(this.scenePosPa=t)}async drawStart(t){let e=jc.NONE;const i=this.baseCreator.actionManage.action;if(i===Bc.CLEAN_AREA?e=jc.CLEAN_AREA:i===Bc.SELECTION&&(e=jc.SELECTION_AREA),e){const i=this.baseCreator.mapModel.createModel(e);i.setPos(this.scenePosPa,t);const a=new Lu(this.baseCreator,i,this.baseCreator.mapModel);return a.updateShape(),(i.isCleanArea()||i.isSelectionArea())&&a.setColor(Lc.CLEAN_AREA_DRAWING),this.shapeItemList.push(a),a}return null}async drawing(t){if(this.curShapeItem)this.curShapeItem.setPosPc(this.scenePosPa,t);else if(this.scenePosPa){const e=await this.drawStart(t);e&&(this.curShapeItem=e)}}async drawEnd(t){this.curShapeItem&&(await this.drawing(t),this.curShapeItem.dataModel.isCleanArea()?this.curShapeItem.setColor(Lc.CLEAN_AREA_NORMAL):this.curShapeItem.dataModel.isSelectionArea()&&await this.handleIntersects(),this.curShapeItem=null,this.scenePosPa=null)}drawCancel(){this.curShapeItem&&this.delete(this.curShapeItem.getID(),this.curShapeItem.getBaseType()),this.curShapeItem=null,this.scenePosPa=null}async handleIntersects(t=this.curShapeItem){if(!t||!t.pathGroup)return;const e=t.pathGroup.getRenderBounds();if(!e)return;const i=this.baseCreator.stageModel.getInteractionItemList().filter(i=>{if(i!==t&&i.pathGroup){const t=i.pathGroup.getRenderBounds();if(t)return e.intersects(t)}return!1});this.baseCreator.stageModel.updateSelectedItemList(i,this.baseCreator.stageModel.isCtrlKey?Wc.ADD:Wc.UPDATE),await this.delete(t.getID(),t.getBaseType())}async deleteLatestSomeBuildingArea(t=jc.NONE){this.baseCreator.cancelInteraction();for(let e=this.shapeItemList.length-1;e>=0;e--){const i=this.shapeItemList[e];if(i.getBaseType()===t)return void await this.delete(i.getID(),i.getBaseType())}}setCleanAreaUnAccessible(){if(this.baseCreator.mapModel.removeCleanAreaList(),this.shapeItemList=this.shapeItemList.filter(t=>t.getBaseType()!==jc.CLEAN_AREA),!this.baseCreator.globalGroupMap[nd.CLEAN_AREA])return;const t=`${nd.CLEAN_AREA}-${tp()}`;this.baseCreator.globalGroupMap[nd.CLEAN_AREA].id=t,this.baseCreator.globalGroupMap[nd.CLEAN_AREA].name=t,delete this.baseCreator.globalGroupMap[nd.CLEAN_AREA]}async delete(t,e=jc.NONE){switch(e){case jc.CLEAN_AREA:this.baseCreator.mapModel.deleteCleanArea(t);case jc.SELECTION_AREA:}t&&e&&await super.delete(t,e)}}class ip extends Yu{constructor(t){super(t),Object.defineProperty(this,"curShapeItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shapeItemList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scenePosPa",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.curShapeItem=null,this.shapeItemList=[],this.scenePosPa=null}createShapeItem(t){const e=new Ru(this.baseCreator,t,this.baseCreator.mapModel);return e.updateShape(),this.shapeItemList.push(e),this.addItemToList(e),e}async drawBefore(t){this.curShapeItem||(this.scenePosPa=t)}async drawStart(t){let e=this.baseCreator.mapModel.createModel(jc.FUNC_AREA);e.setPos(this.scenePosPa,t),e.setName(await this.baseCreator.getTranslation("label.region")+e.getID());const i=new Ru(this.baseCreator,e,this.baseCreator.mapModel);return i.updateShape(),this.shapeItemList.push(i),this.addItemToList(i),e=null,i}async drawing(t){this.curShapeItem?this.curShapeItem.setPosPc(this.scenePosPa,t):this.scenePosPa&&(this.curShapeItem=await this.drawStart(t))}async drawEnd(t){this.curShapeItem&&(await this.drawing(t),this.curShapeItem=null,this.scenePosPa=null)}drawCancel(){this.curShapeItem&&this.delete(this.curShapeItem.getID()),this.curShapeItem=null,this.scenePosPa=null}async onModify(t){const e=t.id;let i=this.baseCreator.mapModel.funcAreaModel(e);if(!i)return;let a=this.getOneItem(e);a&&(i.fromJson(t,!1),this.updateItemFromList(a),a.updateShape(),i=null,a=null)}async parseFuncArea(t,e){const i=this.baseCreator.mapModel.createModel(jc.FUNC_AREA),a=i.getID(),s=await this.baseCreator.getTranslation("label.region"),{x:n,y:o}=e,r=t.dataModel.toJson(!1),{"pa.x":l,"pa.y":c,"pc.x":d,"pc.y":h}=r,[u,p]=[Math.abs(d-l),Math.abs(c-h)],m={...r,"pa.x":n,"pa.y":o,"pc.x":n+u,"pc.y":o-p,"pb.x":n+u,"pb.y":o,"pd.x":n,"pd.y":o-p,id:a,name:s+a};return i.fromJson(m,!1),this.createShapeItem(i)}async delete(t){this.baseCreator.mapModel.deleteFuncArea(t),super.delete(t)}async checkRelation(){const t=[];for(const e of this.shapeItemList){const{state:i,id:a,name:s}=e.dataModel.checkPos();!i&&t.push({type:ld.ERROR,itemType:jc.FUNC_AREA,itemId:a,desc:await this.baseCreator.getTranslation("text.areaPosErrorTip",{id:a,name:s})})}return t}}class ap extends Yu{constructor(t){super(t),Object.defineProperty(this,"curShapeItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shapeItemList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scenePosPa",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.curShapeItem=null,this.shapeItemList=[],this.scenePosPa=null}createShapeItem(t){const e=new Du(this.baseCreator,t,this.baseCreator.mapModel);return e.updateShape(),this.shapeItemList.push(e),this.addItemToList(e),e}async drawBefore(t){this.curShapeItem||(this.scenePosPa=t)}async drawStart(t){let e=this.baseCreator.mapModel.createModel(jc.NOTE_AREA);e.setPos(this.scenePosPa,t),e.setName(await this.baseCreator.getTranslation("label.noteArea")+e.getID());const i=new Du(this.baseCreator,e,this.baseCreator.mapModel);return i.updateShape(),this.shapeItemList.push(i),this.addItemToList(i),e=null,i}async drawing(t){this.curShapeItem?this.curShapeItem.setPosPc(this.scenePosPa,t):this.scenePosPa&&(this.curShapeItem=await this.drawStart(t))}async drawEnd(t){this.curShapeItem&&(await this.drawing(t),this.curShapeItem=null,this.scenePosPa=null)}drawCancel(){this.curShapeItem&&this.delete(this.curShapeItem.getID()),this.curShapeItem=null,this.scenePosPa=null}async onModify(t){const e=t.id;let i=this.baseCreator.mapModel.noteAreaModel(e);if(!i)return;let a=this.getOneItem(e);a&&(i.fromJson(t,!1),this.updateItemFromList(a),a.updateShape(),i=null,a=null)}async delete(t){this.baseCreator.mapModel.deleteNoteArea(t),super.delete(t)}}class sp extends Yu{constructor(t){super(t),Object.defineProperty(this,"curShapeItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shapeItemList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scenePosPa",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.curShapeItem=null,this.shapeItemList=[],this.scenePosPa=null}async paintList(t){return await super.paintList(t.filter(t=>t.isLocationAreaNormalModel))}createShapeItem(t){const e=new Nu(this.baseCreator,t,this.baseCreator.mapModel);return e.updateShape(),this.shapeItemList.push(e),this.addItemToList(e),e}async drawBefore(t){this.curShapeItem||(this.scenePosPa=t)}async drawStart(t){let e=this.baseCreator.mapModel.createModel(jc.LOCATION_AREA);e.setPos(this.scenePosPa,t),e.setName(await this.baseCreator.getTranslation("label.locationArea")+e.getID());const i=new Nu(this.baseCreator,e,this.baseCreator.mapModel);return i.updateShape(),this.shapeItemList.push(i),this.addItemToList(i),e=null,i}async drawing(t){this.curShapeItem?this.curShapeItem.setPosPc(this.scenePosPa,t):this.scenePosPa&&(this.curShapeItem=await this.drawStart(t))}async drawEnd(t){this.curShapeItem&&(await this.drawing(t),this.curShapeItem=null,this.scenePosPa=null)}drawCancel(){this.curShapeItem&&this.delete(this.curShapeItem.getID()),this.curShapeItem=null,this.scenePosPa=null}async onModify(t){const e=t.id;let i=this.baseCreator.mapModel.locationAreaModel(e);if(!i)return;let a=this.getOneItem(e);a&&(i.fromJson(t,!1),this.updateItemFromList(a),a.updateShape(),i=null,a=null)}async delete(t){this.baseCreator.mapModel.deleteLocationArea(t),super.delete(t)}}class np extends Iu{constructor(t){super(t),Object.defineProperty(this,"curShapeItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shapeItemList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.curShapeItem=null,this.shapeItemList=[]}createShapeItem(t){const e=new ku(this.baseCreator,t,this.baseCreator.mapModel);return e.updateShape(),this.shapeItemList.push(e),this.addItemToList(e),e}drawStart(t){let e=this.baseCreator.mapModel.createModel(jc.NODE);e.setPos(t);const i=new ku(this.baseCreator,e,this.baseCreator.mapModel);return i.updateShape(),e=null,this.shapeItemList.push(i),this.addItemToList(i),i}async drawing(t){this.curShapeItem?await this.drawAttach(t):this.curShapeItem=this.drawStart(t)}async drawEnd(t){this.curShapeItem&&(t=await this.drawAttach(t),await this.drawFinish(t)&&(this.curShapeItem=null))}drawCancel(){this.curShapeItem&&(this.delete(this.curShapeItem.getID()),this.curShapeItem=null)}async drawAttach(t,e=!0,i=this.curShapeItem){if(i){const a=await this.baseCreator.stageModel.pickedStationList(t);if(a.length)t=a[0].dataModel.pos;else if(e){const e=await this.baseCreator.stageModel.pickedLineEdgeList(t);e.length&&(t=oh(e[0].dataModel.startPos,e[0].dataModel.endPos,t))}i.setPos(t)}return t}async drawFinish(t,e=!0,i=this.curShapeItem){let a=!0;if((await this.baseCreator.stageModel.pickedNodeList(t,i.getID())).length)return a=!1,a;if(e){const e=await this.baseCreator.stageModel.pickedAllEdgeList(t);if(e.length){if(e.some(t=>!t.dataModel.isEdgeLine()))return this.baseCreator.notify({key:"text.unsupportDropNodeOnBezier"}),a=!1,a;t=oh(e[0].dataModel.startPos,e[0].dataModel.endPos,t),i.setPos(t);for(let t=0,a=e.length;t<a;t++)await this.baseCreator.stageModel.lineEdgeStage.splitLineEdge(e[t],i.dataModel)}}return a}getItemNode(t){return this.shapeItemList.find(e=>e.getID()===t)}getExactAtNodeList(t,e=1){return this.shapeItemList.filter(i=>sh(t,i.dataModel.pos,e))}getUnusedNodeList(){return this.shapeItemList.filter(t=>!(this.baseCreator.stageModel.lineEdgeStage.getLineEdgeListByNode(t.getID()).length||this.baseCreator.stageModel.bezierEdgeStage.getBezierEdgeListByNode(t.getID()).length))}addNode(t){let e=this.baseCreator.mapModel.createModel(jc.NODE);e.setPos(t);const i=new ku(this.baseCreator,e,this.baseCreator.mapModel);return i.updateShape(),this.shapeItemList.push(i),this.addItemToList(i),e=null,i}async moveTo(t,e,i,a,s){let n=!0;const o=e.getID();if(a){const a=this.baseCreator.stageModel.lineEdgeStage.getLineEdgeListByNode(o),r=this.baseCreator.stageModel.bezierEdgeStage.getBezierEdgeListByNode(o),l=0===a.length&&0===r.length;s.isUseAttach?t=await this.drawAttach(t,l,e):e.setPos(t),await this.baseCreator.stageModel.stationStage.updateStationByNode(s.stationListExactAtNode,e,Vc.ING),await this.baseCreator.stageModel.lineEdgeStage.updateEdgeByNode(e,i,a),await this.baseCreator.stageModel.bezierEdgeStage.updateEdgeByNode(e,i,r),i===Vc.END&&(s.isUseAttach&&(n=await this.drawFinish(t,l,e)),await this.baseCreator.stageModel.stationStage.updateStationByNode(s.stationListExactAtNode,e,i))}else e.setPos(t);return n}async onModify(t){const e=t.id,i=this.baseCreator.mapModel.nodeModel(e);if(!i)return;const a=this.getOneItem(e);if(!a)return;const s=this.baseCreator.stageModel.stationStage.getExactAtStationList(i.pos);i.fromJson(t,!1),a.updateShape(),await this.baseCreator.stageModel.stationStage.updateStationByNode(s,a,Vc.ING),await this.baseCreator.stageModel.lineEdgeStage.updateEdgeByNode(a,Vc.END,this.baseCreator.stageModel.lineEdgeStage.getLineEdgeListByNode(e)),await this.baseCreator.stageModel.bezierEdgeStage.updateEdgeByNode(a,Vc.END,this.baseCreator.stageModel.bezierEdgeStage.getBezierEdgeListByNode(e)),await this.baseCreator.stageModel.stationStage.updateStationByNode(s,a,Vc.END)}async onNodesLinearMove({isFollowAxisX:t=!0,isDirectionPassive:e=!0,x1:i=0,x2:a=0,y1:s=0,y2:n=0}={}){const o=this.baseCreator.stageModel.selectedItemList.filter(t=>t.dataModel.isNodeModel());if(o.length<2)return;const r=t?"x":"y";o.sort((t,i)=>{const a=t.dataModel.pos[r]-i.dataModel.pos[r];return e?a:-a});const{x:l,y:c}=o[0].dataModel.pos,{x:d,y:h}=o.at(-1).dataModel.pos,u=s||n?d-l:0,p=i||a?h-c:0,m=u?(n-s)/u:1,f=p?(a-i)/p:1,g=o.map(t=>{const{x:e,y:a}=t.dataModel.pos;let[n,o]=[0,0];return u&&(o=m*(e-l)+s),p&&(n=-f*(c-a)+i),{point:new Md(n+e,o+a,0),stationListExactAtNode:this.baseCreator.stageModel.stationStage.getExactAtStationList(t.dataModel.pos)}});await Promise.all(o.map((t,e)=>{const{point:i,stationListExactAtNode:a}=g[e];return this.moveTo(i,t,Vc.END,!0,{stationListExactAtNode:a,isUseAttach:!1})}))}async delete(t){const e=this.baseCreator.stageModel.lineEdgeStage.getLineEdgeListByNode(t),i=this.baseCreator.stageModel.bezierEdgeStage.getBezierEdgeListByNode(t);for(const t of e)this.baseCreator.stageModel.lineEdgeStage.delete(t.getID());for(const t of i)this.baseCreator.stageModel.bezierEdgeStage.delete(t.getID());this.baseCreator.mapModel.deleteNode(t),super.delete(t)}async checkRelation(){const t=[],e=[];for(const i of this.shapeItemList){const a=i.getID();if(e.includes(a))continue;if(e.push(a),a<=0){t.push({type:ld.ERROR,itemType:jc.NODE,itemId:a,desc:await this.baseCreator.getTranslation("text.nodeIdInvalid",{id:a})});continue}const s=this.getExactAtNodeList(i.dataModel.pos).filter(t=>t!==i);if(s.length){const i=s[0].getID();e.push(i),t.push({type:ld.ERROR,itemType:jc.NODE,itemId:a,desc:await this.baseCreator.getTranslation("text.nodesIsTooClosed",{id1:a,id2:i})})}else for(const s of this.shapeItemList){if(s===i||!sh(s.dataModel.pos,i.dataModel.pos,2*Gc.RADIUS))continue;const n=s.getID();this.baseCreator.stageModel.lineEdgeStage.isEdgeMatchNodes(a,n)||this.baseCreator.stageModel.bezierEdgeStage.isEdgeMatchNodes(a,n)||(e.push(n),t.push({type:ld.WARNING,itemType:jc.NODE,itemId:a,desc:await this.baseCreator.getTranslation("text.nodesIsTooClosed",{id1:a,id2:n})}))}}return t}}class op extends Iu{constructor(t){super(t),Object.defineProperty(this,"shapeItemList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.shapeItemList=[]}updateFacing(t){}getItemEdge(t=0){return this.baseCreator.stageModel.getAllItemEdge().find(e=>e.getID()===t)}getItemAllEdgeListByNode(t=0,e=0){return[...this.getLineEdgeListByNode(t,e),...this.getBezierEdgeListByNode(t,e)]}getLineEdgeListByNode(t=0,e=0){return this.baseCreator.stageModel.lineEdgeStage.shapeItemList.filter(i=>i.getID()!==e&&(i.dataModel.isStartNode(t)||i.dataModel.isEndNode(t)))}getBezierEdgeListByNode(t=0,e=0){return this.baseCreator.stageModel.bezierEdgeStage.shapeItemList.filter(i=>i.getID()!==e&&(i.dataModel.isStartNode(t)||i.dataModel.isEndNode(t)))}onEdgeBatchSetMaxSpeed(t,e){const{edgeForwardLineSpeedMax:i=-1,edgeForwardAngularVelocityMax:a=-1,edgeNotForwardLineSpeedMax:s=-1,edgeNotForwardAngularVelocityMax:n=-1}=t,o=Jd(a%360),r=Jd(n%360);e||(e=this.baseCreator.stageModel.selectedItemList.filter(t=>t.dataModel.isEdgeModel())),e.forEach(t=>{t.dataModel.robot_direction===Qc.FORWARD?(i>=0&&t.dataModel.setLineSpeedMax(i),a>=0&&t.dataModel.setAngularVelocityMax(o)):(s>=0&&t.dataModel.setLineSpeedMax(s),n>=0&&t.dataModel.setAngularVelocityMax(r))})}repairEdgeNode(t,e){let i=!0;if(!e)return i=!1,i;let a=0,s=null;if(t===zc.START)a=e.dataModel.s_node,s=e.dataModel.startPos;else{if(t!==zc.END)return i=!1,i;a=e.dataModel.e_node,s=e.dataModel.endPos}let n=a?this.baseCreator.stageModel.nodeStage.getItemNode(a):null;if(!n||!sh(s,n.dataModel.pos)){const i=this.baseCreator.stageModel.nodeStage.getExactAtNodeList(s);a=i.length?i[0].dataModel.getID():this.baseCreator.stageModel.nodeStage.addNode(s).getID(),t===zc.START?e.dataModel.setStartNodeId(a):t===zc.END&&e.dataModel.setEndNodeId(a)}return n=null,s=null,i}isEdgeMatchNodes(t,e){return this.shapeItemList.some(i=>i.dataModel.isStartNode(t)&&i.dataModel.isEndNode(e)||i.dataModel.isStartNode(e)&&i.dataModel.isEndNode(t))}async onModify(t){const e=t.id;let i=this.baseCreator.mapModel.edgeModel(e);if(!i)return;let a=this.getOneItem(e);a&&(i.fromJson(t,!1),this.updateFacing(a),a.setStrokeColor(),a.updateShape(),i=null,a=null)}async delete(t){const e=this.getOneItem(t);this.baseCreator.mapModel.deleteEdge(t),super.delete(t),await this.baseCreator.stageModel.stationStage.updateStationByEdge(e,Wc.DELETE),this.baseCreator.stageModel.edgeGroupStage.updateEdgeIds(-1,t,Wc.DELETE)}async checkRelation(){const t=[],e=new Map;for(const i of this.shapeItemList){const a=i.getID();i.dataModel.s_node===i.dataModel.e_node&&t.push({type:ld.ERROR,itemType:jc.EDGE,itemId:a,desc:await this.baseCreator.getTranslation("text.illegalEdgeNode",{id:a})});const{s_facing:s,e_facing:n,cost:o,type:r}=i.dataModel;if((Number.isNaN(o)||"number"!=typeof o||o<=0)&&t.push({type:ld.ERROR,itemType:jc.EDGE,itemId:a,desc:await this.baseCreator.getTranslation("text.edgeCostError",{id:a})}),(Number.isNaN(s)||"number"!=typeof s)&&t.push({type:ld.ERROR,itemType:jc.EDGE,itemId:a,desc:await this.baseCreator.getTranslation("text.edgeStartDirectionError",{id:a})}),(Number.isNaN(n)||"number"!=typeof n)&&t.push({type:ld.ERROR,itemType:jc.EDGE,itemId:a,desc:await this.baseCreator.getTranslation("text.edgeEndDirectionError",{id:a})}),r===Yc.BEZIER){const{startPos:e,cPos:s,dPos:n,endPos:o}=i.dataModel,r=new Nh(e,s,n,o),{ok:l}=jh(r,10,10);l||t.push({type:ld.ERROR,itemType:jc.EDGE,itemId:a,desc:await this.baseCreator.getTranslation("text.edgeMinRadiusLessThan100mm",{id:a})})}const l=`${i.dataModel.s_node}@${i.dataModel.e_node}`,c=i.getName();if(e.has(l)){const i=e.get(l);t.push({type:ld.ERROR,itemType:jc.EDGE,itemId:a,desc:await this.baseCreator.getTranslation("text.edgeStartEndNodeDuplication",{edge1:`${i.name}(${i.id})`,edge2:`${c}(${a})`})})}else e.set(l,{id:a,name:c})}return t}}class rp extends op{constructor(t){super(t),Object.defineProperty(this,"curShapeItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shapeItemList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"startUnitVector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"endUnitVector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.curShapeItem=null,this.shapeItemList=[],this.startUnitVector=new Md(0,0,0),this.endUnitVector=new Md(0,0,0)}createShapeItem(t){const e=new $u(this.baseCreator,t,this.baseCreator.mapModel);return e.updateShape(),this.shapeItemList.push(e),this.addItemToList(e),e}async drawBefore(t,e=this.curShapeItem){e||(this.curShapeItem=this.drawStart(t),t=await this.drawAttach(t,zc.START,Vc.END),this.curShapeItem.dataModel.setStartPos(t),await this.setEdgeUnitVector(t,zc.START)||this.drawCancel())}drawStart(t,e=this.curShapeItem){let i=this.baseCreator.mapModel.createModel(jc.EDGE);i.setType(Yc.BEZIER),i.setStartPos(t),i.setEndPos(t),i.setCPos(t),i.setDPos(t);const a=new $u(this.baseCreator,i,this.baseCreator.mapModel);return a.updateShape(),i=null,this.shapeItemList.push(a),this.addItemToList(a),a}async drawing(t,e=this.curShapeItem){e&&(t=await this.drawAttach(t,zc.END,Vc.ING),this.updateEdgeStaff(e.dataModel.startPos,t))}async drawEnd(t,e=this.curShapeItem){e&&(t=await this.drawAttach(t,zc.END,Vc.END),sh(e.dataModel.startPos,t,Gc.RADIUS)||(e.dataModel.setEndPos(t),await this.setEdgeUnitVector(t,zc.END)&&(this.updateEdgeStaff(e.dataModel.startPos,e.dataModel.endPos),await this.drawFinish(t),this.resetData(),await this.drawBefore(e.dataModel.endPos))))}async drawFinish(t,e=this.curShapeItem){let i=!0;return e?(this.updateEdgeSelfData(e),this.repairEdgeNode(zc.START,e),this.repairEdgeNode(zc.END,e),await this.baseCreator.stageModel.stationStage.updateStationByEdge(e,Wc.ADD),i):(i=!1,i)}drawCancel(){this.curShapeItem&&this.delete(this.curShapeItem.getID()),this.resetData()}resetData(t=!0){this.curShapeItem=null,this.startUnitVector=new Md(0,0,0),this.endUnitVector=new Md(0,0,0)}updateEdgeStaff(t,e,i=this.curShapeItem,a=!0,s=!0,n=!0,o=this.startUnitVector,r=this.endUnitVector){if(!i)return;i.dataModel.setStartPos(t),i.dataModel.setEndPos(e);const l=t.add(e).divide(2);a&&i.setCPos(this.getCtrlPos(o,t,l)),s&&i.setDPos(this.getCtrlPos(r,e,l)),n&&i.updateShape()}getCtrlPos(t,e,i){const a=i.subtract(e);return Math.abs(t.x)>Math.abs(t.y)?(Math.abs(a.x)<$c.BEZIER_CONTROL_POINT_MIN_OFFSET&&(a.x>=0?a.x=$c.BEZIER_CONTROL_POINT_MIN_OFFSET:a.x=-$c.BEZIER_CONTROL_POINT_MIN_OFFSET),0===t.x?a.y=0:a.y=a.x*t.y/t.x):(Math.abs(a.y)<$c.BEZIER_CONTROL_POINT_MIN_OFFSET&&(a.y>=0?a.y=$c.BEZIER_CONTROL_POINT_MIN_OFFSET:a.y=-$c.BEZIER_CONTROL_POINT_MIN_OFFSET),0===t.y?a.x=0:a.x=a.y*t.x/t.y),e.add(a)}async drawAttach(t,e,i,a=this.curShapeItem){if(!a)return t;const s=await this.baseCreator.stageModel.pickedNodeList(t);if(s.length)t=s[0].dataModel.pos;else{const e=await this.baseCreator.stageModel.pickedStationList(t);e.length&&(t=e[0].dataModel.pos)}return t}async setEdgeUnitVector(t,e,i=this.curShapeItem){let a=!0;if(!i)return a=!1,a;const s=await this.selectEdge(t,i.dataModel.getID(),!0);if(!1===s)return a=!1,a;if(s){const a=this.getItemEdge(s.id);if(a){const s=await this.baseCreator.stageModel.pickedNodeList(t);if(s.length){const t=s[0].getID();let n=null;a.dataModel.isEdgeLine()?n=this.baseCreator.stageModel.lineEdgeStage.getTangent(a):a.dataModel.isEdgeBezier()&&(a.dataModel.isStartNode(t)?n=this.getStartTangent(a):a.dataModel.isEndNode(t)&&(n=this.getEndTangent(a))),n&&(e===zc.START?this.startUnitVector=n:e===zc.END&&(this.endUnitVector=n)),e===zc.START?i.dataModel.setStartNodeId(t):e===zc.END&&i.dataModel.setEndNodeId(t)}}}return a}async selectEdge(t,e=0,i=!1,a=0){const s=await this.getMatchedItemEdgeList(t,e,i,a);return await this.baseCreator.selectItem(await this.baseCreator.getTranslation("label.select"),this.baseCreator.stageModel.getSelectItemOptions(s))}async getMatchedItemEdgeList(t,e=0,i=!1,a=0){if(i){const i=await this.baseCreator.stageModel.pickedNodeList(t,a);if(i.length){const t=i[0].getID();return this.getItemAllEdgeListByNode(t,e)}return[]}return await this.baseCreator.stageModel.pickedAllEdgeList(t,e)}getStartTangent(t){var e;const i=null===(e=t.pathGroup)||void 0===e?void 0:e.firstChild.getStartTangent();return new Md(-(i[1][0]-i[0][0]),i[1][1]-i[0][1],0).normalize()}getEndTangent(t){var e;const i=null===(e=t.pathGroup)||void 0===e?void 0:e.firstChild.getEndTangent();return new Md(i[1][0]-i[0][0],-(i[1][1]-i[0][1]),0).normalize()}updateEdgeSelfData(t){this.updateCost(t),this.updateFacing(t)}updateCost(t=this.curShapeItem){t&&t.pathGroup&&(t.dataModel.cost=t.pathGroup.firstChild.getTotalLength())}updateFacing(t){if(!t)return;let e=th(t.dataModel.startPos,t.dataModel.cPos),i=th(t.dataModel.dPos,t.dataModel.endPos);const a=t.dataModel.robot_direction;a===Qc.BACKWARD?(e=(e+Math.PI)%(2*Math.PI),i=(i+Math.PI)%(2*Math.PI)):a===Qc.LEFT?(e=(e+Math.PI/2)%(2*Math.PI),i=(i+Math.PI/2)%(2*Math.PI)):a===Qc.RIGHT&&(e=(e-Math.PI/2)%(2*Math.PI),i=(i-Math.PI/2)%(2*Math.PI)),t.dataModel.s_facing=e,t.dataModel.e_facing=i}async moveTo(t,e,i,a){const s=e.dataModel.endPos.subtract(e.dataModel.startPos).add(t),n=e.dataModel.cPos.subtract(e.dataModel.startPos).add(t),o=e.dataModel.dPos.subtract(e.dataModel.startPos).add(t);if(e.dataModel.setStartPos(t),e.dataModel.setEndPos(s),e.dataModel.setCPos(n),e.dataModel.setDPos(o),e.updateChildrenShape(),i===Vc.END){if(a){const a=await this.drawAttach(t,zc.START,i,e),n=await this.drawAttach(s,zc.END,i,e);this.adjustPole(a,zc.START,!1,e),this.adjustPole(n,zc.END,!1,e),e.updateChildrenShape(),await this.baseCreator.stageModel.stationStage.updateStationByEdge(e,Wc.UPDATE)}this.updateEdgeSelfData(e),this.repairEdgeNode(zc.START,e),this.repairEdgeNode(zc.END,e)}return!0}async updateEdgeByNode(t,e,i){const a=t.getID(),s=t.dataModel.pos;if(void 0===i&&(i=this.getBezierEdgeListByNode(a)),i.forEach(t=>{this.adjustPole(s,t.dataModel.isStartNode(a)?zc.START:zc.END,!0,t)}),e===Vc.END)for(const t of i)this.updateEdgeSelfData(t),await this.baseCreator.stageModel.stationStage.updateStationByEdge(t,Wc.UPDATE);return i}adjustPole(t,e,i,a){if(a)switch(e){case zc.START:{const e=t.subtract(a.dataModel.startPos);a.dataModel.setCPos(a.dataModel.cPos.add(e)),this.updateEdgeStaff(t,a.dataModel.endPos,a,!1,!0,i,void 0,this.getEndTangent(a));break}case zc.END:{const e=t.subtract(a.dataModel.endPos);a.dataModel.setDPos(a.dataModel.dPos.add(e)),this.updateEdgeStaff(a.dataModel.startPos,t,a,!0,!1,i,this.getStartTangent(a),void 0);break}case zc.C:a.setCPos(this.getCtrlPos(this.getStartTangent(a),a.dataModel.startPos,t)),a.updateChildrenShape();break;case zc.D:a.setDPos(this.getCtrlPos(this.getEndTangent(a),a.dataModel.endPos,t)),a.updateChildrenShape()}}}class lp extends op{constructor(t){super(t),Object.defineProperty(this,"curShapeItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shapeItemList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.curShapeItem=null,this.shapeItemList=[]}createShapeItem(t){const e=new Fu(this.baseCreator,t,this.baseCreator.mapModel);return e.updateShape(),this.shapeItemList.push(e),this.addItemToList(e),e}async drawBefore(t,e=this.curShapeItem){e||(this.curShapeItem=await this.drawStart(t),await this.drawAttach(t,zc.START,Vc.END))}async drawStart(t,e=this.curShapeItem){let i=this.baseCreator.mapModel.createModel(jc.EDGE);i.setStartPos(t),i.setEndPos(t);const a=new Fu(this.baseCreator,i,this.baseCreator.mapModel);return a.updateShape(),this.shapeItemList.push(a),this.addItemToList(a),i=null,a}async drawing(t){await this.drawAttach(t,zc.END,Vc.ING)}async drawEnd(t,e=this.curShapeItem){e&&(t=await this.drawAttach(t,zc.END,Vc.END),sh(e.dataModel.startPos,e.dataModel.endPos,Gc.RADIUS)||(await this.drawFinish(t),this.resetData(),await this.drawBefore(t)))}async drawFinish(t,e=this.curShapeItem){let i=!0;return e?(this.updateEdgeSelfData(e),this.repairEdgeNode(zc.START,e),this.repairEdgeNode(zc.END,e),await this.baseCreator.stageModel.stationStage.updateStationByEdge(e,Wc.ADD),i):(i=!1,i)}drawCancel(){this.curShapeItem&&this.delete(this.curShapeItem.getID()),this.resetData()}resetData(t=!0){this.curShapeItem=null}async drawAttach(t,e,i,a=this.curShapeItem){if(!a)return t;let s=0;const n=await this.baseCreator.stageModel.pickedNodeList(t);if(n.length)t=n[0].dataModel.pos,s=n[0].getID();else{const e=await this.baseCreator.stageModel.pickedStationList(t);e.length&&(t=e[0].dataModel.pos)}return e===zc.START?(a.setStartPos(t),i===Vc.END&&a.dataModel.setStartNodeId(s)):e===zc.END&&(a.setEndPos(t),i===Vc.END&&a.dataModel.setEndNodeId(s)),t}getTangent(t){return t.dataModel.endPos.subtract(t.dataModel.startPos).normalize()}updateEdgeSelfData(t){this.updateCost(t),this.updateFacing(t)}updateCost(t){t&&t.pathGroup&&(t.dataModel.cost=t.pathGroup.firstChild.firstChild.getTotalLength())}updateFacing(t){if(!t)return;let e=th(t.dataModel.startPos,t.dataModel.endPos);const i=t.dataModel.robot_direction;i===Qc.BACKWARD?e=(e+Math.PI)%(2*Math.PI):i===Qc.LEFT?e=(e+Math.PI/2)%(2*Math.PI):i===Qc.RIGHT&&(e=(e-Math.PI/2)%(2*Math.PI)),t.dataModel.s_facing=e,t.dataModel.e_facing=e}async moveTo(t,e,i,a){const s=e.dataModel.endPos.subtract(e.dataModel.startPos).add(t);return e.dataModel.setStartPos(t),e.setEndPos(s),i===Vc.END&&(a&&(await this.drawAttach(t,zc.START,i,e),await this.drawAttach(s,zc.END,i,e),await this.baseCreator.stageModel.stationStage.updateStationByEdge(e,Wc.UPDATE)),this.updateEdgeSelfData(e),this.repairEdgeNode(zc.START,e),this.repairEdgeNode(zc.END,e)),!0}async onBatchGenerator(t,e){if(e||(e=this.baseCreator.stageModel.selectedItemList.filter(t=>t.dataModel.baseType===jc.STATION)),e.length<2)return!1;const{isBidirectionalEdge:i=!0,isFollowAxisX:a=!0,isDirectionPassive:s=!0,robotDirection:n=Qc.FORWARD,robotDirectionSecond:o=Qc.FORWARD}=t,r=a?"x":"y";e.sort((t,e)=>{const i=t.dataModel.pos[r]-e.dataModel.pos[r];return s?i:-i});const l=e.map(t=>this.baseCreator.stageModel.nodeStage.addNode(t.dataModel.pos)),c=(t,e,i=Qc.FORWARD)=>{t.reduce((t,a,s)=>{const n=this.handleSplit(t.getID(),a.getID(),t.dataModel.pos,a.dataModel.pos,i);if(e.length){const t=n.getID(),i=e[s];i.dataModel.setEdgeId(t),1===s&&i.dataModel.setEdgeId(t),i.setYaw(n.dataModel.e_facing),i.updateShape()}return a})};c(l,e,n),i&&c(l.reverse(),[],o)}async splitLineEdge(t,e){const i=t.dataModel.s_node,a=t.dataModel.e_node,s=t.dataModel.startPos,n=t.dataModel.endPos,o=t.dataModel.robot_direction;this.handleSplit(i,e.id,s,e.pos,o),this.handleSplit(e.id,a,e.pos,n,o),await this.delete(t.getID())}handleSplit(t,e,i,a,s){const n=new Fu(this.baseCreator,this.baseCreator.mapModel.createModel(jc.EDGE),this.baseCreator.mapModel);return n.dataModel.setStartNodeId(t),n.dataModel.setEndNodeId(e),n.dataModel.setRobotDirection(s),n.dataModel.setStartPos(i),n.setEndPos(a),this.updateEdgeSelfData(n),this.shapeItemList.push(n),this.addItemToList(n),n}async updateEdgeByNode(t,e,i){const a=t.getID(),s=t.dataModel.pos;if(void 0===i&&(i=this.getLineEdgeListByNode(a)),i.forEach(t=>{this.adjustPole(s,t.dataModel.isStartNode(a)?zc.START:zc.END,t)}),e===Vc.END)for(const t of i)this.updateEdgeSelfData(t),await this.baseCreator.stageModel.stationStage.updateStationByEdge(t,Wc.UPDATE);return i}adjustPole(t,e,i){e===zc.START?i.setStartPos(t):e===zc.END&&i.setEndPos(t)}}class cp extends Iu{constructor(t){super(t),Object.defineProperty(this,"baseCreator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shapeItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseCreator=t,this.shapeItem=null,this.type=zc.NONE}setEdgePole(t){this.resetData(),this.shapeItem=new Gu(this.baseCreator,t)}updateEdgePole(){this.baseCreator.stageModel.isEditable&&(!this.baseCreator.stageModel.isCtrlKey&&1===this.baseCreator.stageModel.selectedItemList.length&&this.baseCreator.stageModel.selectedItemList[0].dataModel.isEdgeModel()?this.setEdgePole(this.baseCreator.stageModel.selectedItemList[0]):this.resetData())}setPoleType(t){var e;this.type!==t&&(null!==(e=this.shapeItem)&&void 0!==e&&e.setTargetPoleStatus(this.type,t),this.type=t)}setPolePos(t,e,i){var a;null===(a=this.shapeItem)||void 0===a||a.updatePolePos(t,e,i)}equalPoleType(t){return this.type===t}resetData(t=!0){this.setPoleType(zc.NONE),this.shapeItem&&this.shapeItem.delete(),this.shapeItem=null}async moveTo(t,e,i,a,s=zc.NONE){if(e instanceof Fu)t=await this.baseCreator.stageModel.getAttachNodeStationPoint(t),s===zc.START?e.dataModel.setStartPos(t):s===zc.END&&e.dataModel.setEndPos(t),e.updateChildrenShape(),this.setPolePos(t,s,e),i===Vc.END&&(this.baseCreator.stageModel.lineEdgeStage.updateEdgeSelfData(e),this.baseCreator.stageModel.lineEdgeStage.repairEdgeNode(s,e),await this.baseCreator.stageModel.stationStage.updateStationByEdge(e,Wc.UPDATE));else if(e instanceof $u)switch(s){case zc.START:case zc.END:t=await this.baseCreator.stageModel.getAttachNodeStationPoint(t),this.baseCreator.stageModel.bezierEdgeStage.adjustPole(t,s,!0,e),this.setPolePos(t,s,e),i===Vc.END&&(this.baseCreator.stageModel.bezierEdgeStage.updateEdgeSelfData(e),this.baseCreator.stageModel.bezierEdgeStage.repairEdgeNode(s,e),await this.baseCreator.stageModel.stationStage.updateStationByEdge(e,Wc.UPDATE));break;case zc.C:case zc.D:this.baseCreator.stageModel.bezierEdgeStage.adjustPole(t,s,!0,e),this.setPolePos(s===zc.C?e.dataModel.cPos:e.dataModel.dPos,s,e),i===Vc.END&&(this.baseCreator.stageModel.bezierEdgeStage.updateEdgeSelfData(e),await this.baseCreator.stageModel.stationStage.updateStationByEdge(e,Wc.UPDATE))}return!0}}class dp extends Iu{constructor(t){super(t)}createShapeItem(t){const e=new Mu(this.baseCreator,t,this.baseCreator.mapModel);return this.shapeItemList.push(e),this.addItemToList(e),e}getEdgeIdList(t){const e=this.baseCreator.mapModel.edgeGroupModel(t);return e?[...e.getEdgeIds()]:[]}setEdgeGroupSelected(t){const e=this.getEdgeIdList(t).map(t=>this.baseCreator.stageModel.lineEdgeStage.getOneItem(t)||this.baseCreator.stageModel.bezierEdgeStage.getOneItem(t)).filter(t=>!!t);e.length&&(this.baseCreator.setElementCenterAndSelected({id:e[0].getID(),type:e[0].getBaseType()}),this.baseCreator.stageModel.updateSelectedItemList(e))}updateEdgeIds(t,e,i=Wc.ADD){if(t<0)return void this.baseCreator.mapModel._edgeGroupDataList.forEach(t=>{this.updateEdgeIds(t.id,e,i)});const a=this.baseCreator.mapModel.edgeGroupModel(t);if(!a)return;let s=!0;i!==Wc.ADD||a.hasEdge(e)?i===Wc.DELETE&&a.hasEdge(e)?a.removeEdge(e):s=!1:a.addEdge(e),s&&this.baseCreator.modifyGraphLabel(i,{id:t,edgeId:e,type:a.baseType,level:2})}addEdgeGroup(t){const e=this.baseCreator.mapModel.createModel(jc.EDGE_GROUP);return t.id=e.getID(),e.fromJson(t),this.createShapeItem(e),e}async onModify(t){const e=this.baseCreator.mapModel.edgeGroupModel(t.id);if(!e)return;const i=this.getOneItem(t.id);i&&(e.fromJson(t),this.updateItemFromList(i))}async delete(t){this.baseCreator.mapModel.deleteEdgeGroup(t),super.delete(t)}}class hp extends Iu{constructor(t){super(t),Object.defineProperty(this,"curShapeItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shapeItemList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.curShapeItem=null,this.shapeItemList=[]}createShapeItem(t){const e=new Bu(this.baseCreator,t,this.baseCreator.mapModel);return this.shapeItemList.push(e),this.addItemToList(e),e.updateShape(),e}async drawStart(){let t=this.baseCreator.mapModel.createModel(jc.STATION);t.setName(await this.baseCreator.getTranslation("label.station")+t.getID());const e=new Bu(this.baseCreator,t,this.baseCreator.mapModel);return this.shapeItemList.push(e),this.addItemToList(e),e.updateShape(),t=null,e}async drawing(t){this.curShapeItem?await this.drawAttach(t):this.curShapeItem=await this.drawStart()}async drawEnd(t){this.curShapeItem&&(t=await this.drawAttach(t),await this.drawFinish(t)&&(this.curShapeItem=null))}drawCancel(){this.curShapeItem&&this.delete(this.curShapeItem.getID()),this.curShapeItem=null}async drawAttach(t,e=this.curShapeItem){if(e){const i=await this.baseCreator.stageModel.pickedNodeList(t);i.length&&(t=i[0].dataModel.pos),e.setPos(t)}return t}async drawFinish(t,e=this.curShapeItem){let i=!0;const a=await this.baseCreator.stageModel.pickedAllEdgeList(t);let s=null;if(a.length){const t=this.baseCreator.stageModel.getSelectItemOptions(a);s=await this.baseCreator.selectItem(await this.baseCreator.getTranslation("label.select"),t)}if(!1===s)return i=!1,i;if(s){const a=this.baseCreator.stageModel.bezierEdgeStage.getItemEdge(s.id);if(a){a.dataModel.isEdgeLine()&&(t=oh(a.dataModel.startPos,a.dataModel.endPos,t),e.setPos(t));const s=sh(a.dataModel.startPos,t),n=!s&&sh(a.dataModel.endPos,t);if(a.dataModel.isEdgeBezier()&&!s&&!n)return this.baseCreator.notify({key:"text.unsupportDropStationOnBezier"}),i=!1,i;e.dataModel.setEdgeId(a.getID());let o=null;s?o=a.dataModel.s_facing:n?o=a.dataModel.e_facing:a.dataModel.isEdgeLine()&&(o=a.dataModel.s_facing),null!==o&&e.setYaw(o)}}else e.dataModel.setEdgeId(0);return i}getExactAtStationList(t,e=1){return this.shapeItemList.filter(i=>sh(t,i.dataModel.pos,e))}getStationListWithDMCodeId(t,e){return this.shapeItemList.filter(i=>i.dataModel.getDMCodeID()===t&&i.dataModel.getID()!==e)}async pickedStationListByRobotPose(){const t=this.baseCreator.robotPose;if(!t)return[];const e=new Md(t.x,t.y,Jd(t.yaw));return await this.baseCreator.stageModel.pickedStationList(e)}async moveTo(t,e,i,a){return a?(t=await this.drawAttach(t,e),i===Vc.END&&await this.setStationWithEdge(e)):e.setPos(t),!0}async updateStationByNode(t,e,i){const a=e.dataModel.pos;for await(const e of t)e.setPos(a),i===Vc.END&&await this.setStationWithEdge(e)}async setStationWithEdge(t,e){const[i,a]=[t.dataModel.edge_id,t.dataModel.pos.yaw];let[s,n]=[0,0],o={poleType:zc.NONE,itemEdge:e};if(e&&(o=nh(t,e)),!o.poleType){const a=i&&i!==(null==e?void 0:e.dataModel.getID())&&this.baseCreator.stageModel.getAllItemEdge().find(t=>t.getID()===i);(a instanceof Fu||a instanceof $u)&&(o=nh(t,a))}if(!o.poleType){const a=await this.baseCreator.stageModel.pickedAllEdgeList(t.dataModel.pos);for(const s of a)if(s.getID()!==i&&s!==e&&(o=nh(t,s),o.poleType))break}o.poleType&&(s=o.itemEdge.getID(),o.itemEdge.dataModel.isEdgeLine()?n=o.itemEdge.dataModel.s_facing:o.itemEdge.dataModel.isEdgeBezier()&&(o.poleType===zc.START?n=o.itemEdge.dataModel.s_facing:o.poleType===zc.END&&(n=o.itemEdge.dataModel.e_facing))),s!==i&&t.dataModel.setEdgeId(s),0===i&&n!==a&&s&&(t.dataModel.setYaw(n),t.updateShape())}async updateStationByEdge(t,e=Wc.NONE){if(!t)return;const i=t.getID(),a=this.shapeItemList.filter(t=>0===t.dataModel.edge_id||t.dataModel.edge_id===i);for(const i of a)await this.setStationWithEdge(i,e===Wc.DELETE?void 0:t)}updateStationRecordedNodeId(t=this.shapeItemList){t.forEach(t=>{var e,i;const a=[];this.baseCreator.stageModel.nodeStage.shapeItemList.forEach(e=>{const i=ah(t.dataModel.pos,e.dataModel.pos);i<1&&a.push({id:e.getID(),distance:i})}),a.sort((t,e)=>t.distance-e.distance),t.dataModel.setNodeId(null!==(e=null===(i=a[0])||void 0===i?void 0:i.id)&&void 0!==e?e:0)})}async setSelectedItemsYaw(t){const e=this.baseCreator.stageModel.selectedItemList.filter(t=>t.dataModel.isStationModel());if(e.length)if(void 0===t)await this.baseCreator.getInputAxis("a",0);else{const i=Jd(t);for(const t of e)t.setYaw(i)}}async onModify(t,e){let i=this.baseCreator.mapModel.stationModel(t);if(!i)return;let a=this.getOneItem(t);a&&(i.fromJson(e,!1),this.updateItemFromList(a,t!==e.id?t:0),a.setStrokeColor(),a.updateShape(),await this.setStationWithEdge(a),t!==e.id&&this.baseCreator.mapModel._featureDataList.forEach(i=>{i.stationId===t&&i.setStationId(e.id)}),i=null,a=null)}async onRotateByEditor({degree:t=0,isSyncYaw:e=!1,stationId:i=0}={}){var a;let s=!1;const n=null===(a=this.getOneItem(i))||void 0===a?void 0:a.dataModel.pos;if(!n)return s;const o=this.baseCreator.stageModel.selectedItemList.filter(t=>t.dataModel.baseType===jc.STATION&&t.getID()!==i);for(const i of o)e&&i.setYaw(n.yaw),i.setPos(i.dataModel.pos.rotate(-t,n)),await this.setStationWithEdge(i);return s=!0,s}getCopyStartId(){const t=this.baseCreator.stageModel.selectedItemList;return 1===t.length&&t[0].dataModel.isStationModel()?t[0].getID()+1:this.baseCreator.mapModel.createId(this.baseCreator.mapModel._stationDataList)}async onBatchCopy({isFollowAxisX:t=!0,startId:e=1,prefixName:i="",rowCount:a=1,rowDistance:s=0,columnCount:n=1,columnDistance:o=0,isGenerateDiscerns:r=!0,discernsIDDiff:l=1e4,discernsOffsetX:c=0,discernsOffsetY:d=0,isGenerateRoadMap:h=!0}={},u){const p=this.baseCreator.stageModel.selectedItemList[0];if(1!==this.baseCreator.stageModel.selectedItemList.length||!p.dataModel.isStationModel())return this.baseCreator.notify({key:"text.PleaseReSelectTheSiteToBeCopied"}),!1;const m=p.getID(),f=e,g=a*n-1+f,_=m+l,y=f+l,v=g+l,b=this.shapeItemList.filter(t=>{const e=t.getID();return!!(f<=e&&e<=g||r&&(_===e||y<=e&&e<=v))&&(this.baseCreator.notify({key:"text.hasDuplicateStationIDs",keyData:{id:e}}),!0)});if(b.length)return;const E=i?`${i}_`:await this.baseCreator.getTranslation("label.station"),A=i?`_${await this.baseCreator.getTranslation("label.recognitionStation")}`:"",w=p.dataModel.toJson(!1);let S=f;const C=[];t||([a,n]=[n,a]);const I=p.dataModel.pos.yaw;function x(t,e=0,i=0,a=0){const s=e+l;t.push({id:s,name:`${E}${e}${A}`,"pos.x":i+c,"pos.y":a+d,"pos.yaw":I,user_define_properties:{...w.user_define_properties},desc:w.desc})}for(let e=0;e<a;e++){const i=[];for(let a=0;a<n;a++){const[n,l]=t?[e,a]:[a,e];if(0===n&&0===l){if(--S,r){const{x:t,y:e}=p.dataModel.pos;x(i,m,t,e)}}else{++S;const[t,e]=[w["pos.x"]+l*o,w["pos.y"]+n*s],a={id:S,name:`${E}${S}`,"pos.x":t,"pos.y":e,edge_id:0,dmcode_id:"","pgv_offset.x":0,"pgv_offset.y":0,"pgv_offset.yaw":0};w.type===Uc.WAREROOM&&(a.wareroomLocationRow=w.wareroomLocationRow+n,a.wareroomLocationColumn=w.wareroomLocationColumn+l),i.push({...w,...a}),r&&x(i,S,t,e)}}C.push(i)}if(w.type===Uc.WAREROOM){const t=C.flat().filter(t=>t.type===Uc.WAREROOM),e=[];if(this.shapeItemList.forEach(i=>{const a=i.getStationWareroom();i.isStationTypeWareroom()&&[...t].some((s,n)=>{const o=a.wareroomAreaId===s.wareroomAreaId&&a.wareroomRegionId===s.wareroomRegionId&&a.wareroomLocationRow===s.wareroomLocationRow&&a.wareroomLocationColumn===s.wareroomLocationColumn;return o&&(e.push({stationName:i.getName(),i:n}),t.splice(n,1)),o})}),e.length)return e.forEach(t=>{this.baseCreator.notify({key:"text.copyDuplicatesWareroomInformation",keyData:{index:t.i,stationName:t.stationName}})}),!1}const T=C.map(t=>t.map(t=>{const e=this.baseCreator.mapModel.createModel(jc.STATION),i=e.toJson(!1);return e.fromJson({...i,...t},!1),this.createShapeItem(e)}));if(h){T[0].unshift(p);for(const t of T)await this.baseCreator.stageModel.lineEdgeStage.onBatchGenerator(u,t)}return!0}async delete(t){this.baseCreator.mapModel.deleteStation(t),super.delete(t),this.baseCreator.mapModel._featureDataList.forEach(e=>{e.stationId===t&&this.baseCreator.mapModel.deleteFeature(e.getID())})}checkStationForEditor({type:t=0,oldId:e=0,newId:i=0,name:a="",wareroomObj:s={wareroomAreaId:0,wareroomRegionId:0,wareroomLocationRow:0,wareroomLocationColumn:0}}={}){return 1===t?!this.shapeItemList.some(t=>{const s=t.getID();if(s!==e){if(s===i)return this.baseCreator.notify({key:"text.stationIDHasExist"}),!0;if(t.getName()===a)return this.baseCreator.notify({key:"text.stationNameHasExist"}),!0}return!1}):2===t?!this.shapeItemList.some(t=>{const i=t.getID(),a=t.isStationTypeWareroom(),n=t.getStationWareroom();return!(i===e||!a||n.wareroomAreaId!==s.wareroomAreaId||n.wareroomRegionId!==s.wareroomRegionId||n.wareroomLocationRow!==s.wareroomLocationRow||n.wareroomLocationColumn!==s.wareroomLocationColumn||(this.baseCreator.notify({key:"text.duplicatesWareroomInformation",keyData:{id:i}}),0))}):void 0}async checkRelation(t=65535){const e=[],i=[],a=[];for(const s of this.shapeItemList){const n=s.getID(),o=s.getName();if(n>t){e.push({type:ld.ERROR,itemType:jc.STATION,itemId:n,desc:await this.baseCreator.getTranslation("text.stationIDTooLarge",{id:n,maxValue:t})});continue}if(i.includes(n)){e.push({type:ld.ERROR,itemType:jc.STATION,itemId:n,desc:await this.baseCreator.getTranslation("text.hasDuplicateStationIDs",{id:n})});continue}if(i.push(n),a.includes(o)){e.push({type:ld.ERROR,itemType:jc.STATION,itemId:n,desc:await this.baseCreator.getTranslation("text.hasDuplicateStationNames",{name:o})});continue}a.push(o);const r=s.dataModel.edge_id;if(r){const t=this.baseCreator.stageModel.lineEdgeStage.getOneItem(r)||this.baseCreator.stageModel.bezierEdgeStage.getOneItem(r);let i=!1;if(t&&(t.dataModel.isEdgeLine()?i=sh(s.dataModel.pos,oh(t.dataModel.startPos,t.dataModel.endPos,s.dataModel.pos)):t.dataModel.isEdgeBezier()&&(i=sh(s.dataModel.pos,t.dataModel.startPos)||sh(s.dataModel.pos,t.dataModel.endPos))),!i){e.push({type:ld.ERROR,itemType:jc.STATION,itemId:n,desc:await this.baseCreator.getTranslation("text.edgeOfStationNotNearby",{stationName:o,edgeId:r})});continue}}else{const t=this.baseCreator.stageModel.lineEdgeStage.shapeItemList.filter(t=>sh(s.dataModel.pos,oh(t.dataModel.startPos,t.dataModel.endPos,s.dataModel.pos),2)),i=t.length?[]:this.baseCreator.stageModel.bezierEdgeStage.shapeItemList.filter(t=>sh(s.dataModel.pos,t.dataModel.startPos,2)||sh(s.dataModel.pos,t.dataModel.endPos,2)),a=[...t,...i];e.push({type:ld.WARNING,itemType:jc.STATION,itemId:n,desc:await this.baseCreator.getTranslation("text.stationMaybeOnEdge",{stationName:o,edgeId:a.length>0?a[0].getID():"å¾é"})})}}return e}}class up extends Iu{constructor(t){super(t),Object.defineProperty(this,"shapeItemList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.shapeItemList=[]}createShapeItem(t){const e=new ju(this.baseCreator,t,this.baseCreator.mapModel);return this.shapeItemList.push(e),this.addItemToList(e),e.updateShape(),e}async addDMCode({stationId:t=0,pgvId:e="",x:i=0,y:a=0,angle:s=0,type:n=Hc.NONE,isRetainOldStationPGV:o=!1}={}){const r=this.baseCreator.robotPose;if(!r)return;o?await this.deleteDMCode(e):await this.delete(e);const l=Jd(s),c=new Md(r.x,r.y,Jd(r.yaw)),d=this.baseCreator.mapModel.createModel(jc.DMCODE),h=function(t,e){const i=0,a=0,s=0,n=t,o={x:0,y:0,yaw:0};n.yaw=t.yaw+0;const r=n.x-i,l=n.y-a;o.x=Math.cos(n.yaw)*r+Math.sin(n.yaw)*l,o.y=-Math.sin(n.yaw)*r+Math.cos(n.yaw)*l,o.yaw=n.yaw-s;const c={x:0,y:0,yaw:0};return c.x=-Math.cos(e.yaw)*o.x+Math.sin(e.yaw)*o.y+e.x,c.y=-Math.sin(e.yaw)*o.x-Math.cos(e.yaw)*o.y+e.y,c.yaw=function(t){const e=2*Math.PI;return(t%=e)>=Math.PI?t-=e:t<-Math.PI&&(t+=e),t}(e.yaw-o.yaw),c}(new Md(i,a,l),c);d.setID(e),d.setType(n),d.setPos(new Md(h.x,h.y,h.yaw)),this.createShapeItem(d);const u=this.baseCreator.stageModel.stationStage.getOneItem(t);u&&u.dataModel.setDMCodeOffset(e,i,a,l)}async onModify(t){const e=this.baseCreator.mapModel.dmCodeModel(t.dmcode_id);if(!e)return;const i=this.getOneItem(t.dmcode_id);i&&(e.fromJson(t,!1),i.updateShape())}async deleteDMCode(t){this.baseCreator.mapModel.deleteDMCode(t),super.delete(t)}async delete(t){await this.deleteDMCode(t),this.baseCreator.stageModel.stationStage.shapeItemList.forEach(e=>{e.dataModel.getDMCodeID()===t&&e.dataModel.setDMCodeOffset("",0,0,0)})}}class pp{constructor(t){Object.defineProperty(this,"baseCreator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseCreator=t}getWareroomForStation(){return{wareroomAreas:this.baseCreator.mapModel.toJson(this.baseCreator.mapModel._wareroomAreaList),wareroomRegions:this.baseCreator.mapModel.toJson(this.baseCreator.mapModel._wareroomRegionList)}}getWareroomForEdit(){const t=this.getWareroomForStation(),e=this.baseCreator.stageModel.stationStage.shapeItemList.filter(t=>t.isStationTypeWareroom());return{wareroomAreas:t.wareroomAreas.map(t=>({...t,canDelete:!e.some(e=>e.getStationWareroom().wareroomAreaId===t.id)})),wareroomRegions:t.wareroomRegions.map(t=>({...t,canDelete:!e.some(e=>e.getStationWareroom().wareroomRegionId===t.id)}))}}onModify(t=[],e=[]){this.baseCreator.mapModel._wareroomAreaList=[],this.baseCreator.mapModel._wareroomRegionList=[],this.baseCreator.mapModel.fromJsonArray(t,jc.WAREROOM_AREA),this.baseCreator.mapModel.fromJsonArray(e,jc.WAREROOM_REGION)}}class mp extends Iu{constructor(t){super(t),Object.defineProperty(this,"pointerMoveCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stationListExactAtNode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"offsetStartList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isModeKeyboard",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pointWithKeyboard",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pointerMoveCount=1,this.stationListExactAtNode=[],this.offsetStartList=[],this.isModeKeyboard=!1,this.pointWithKeyboard=new Md(0,0,0)}async drawBefore(t){this.baseCreator.actionManage.action===Bc.NORMAL&&this.baseCreator.stageModel.selectedItemList.length&&(this.baseCreator.setInteraction(Bc.MOVE_ITEMS),this.resetData(!0),this.baseCreator.stageModel.edgePoleStage.type?this.offsetStartList=[t.subtract([this.baseCreator.stageModel.selectedItemList[0].dataModel.startPos,this.baseCreator.stageModel.selectedItemList[0].dataModel.endPos,this.baseCreator.stageModel.selectedItemList[0].dataModel.cPos,this.baseCreator.stageModel.selectedItemList[0].dataModel.dPos][this.baseCreator.stageModel.edgePoleStage.type-1])]:this.baseCreator.stageModel.selectedItemList.length&&(this.offsetStartList=this.baseCreator.stageModel.selectedItemList.map(e=>this.getOffsetStart(t,1===this.baseCreator.stageModel.selectedItemList.length,e))))}async drawStart(t){}async drawing(t){this.pointerMoveCount++%11==0&&(this.resetData(!1),this.baseCreator.actionManage.action===Bc.MOVE_ITEMS&&await this.moveElementList(Vc.ING,t))}async drawEnd(t){this.baseCreator.actionManage.action===Bc.MOVE_ITEMS&&await this.moveElementList(Vc.END,t),this.resetData(!0),this.baseCreator.actionManage.setAction(Bc.NORMAL)}async drawAfter(){}async drawCancel(t){if(this.isModeKeyboard)t=this.pointWithKeyboard;else if(!t)return void this.baseCreator.actionManage.setAction(Bc.NORMAL);await this.drawEnd(t)}resetData(t=!0){this.pointerMoveCount=1,t&&(this.offsetStartList=[],this.stationListExactAtNode=[],this.isModeKeyboard=!1,this.pointWithKeyboard=new Md(0,0,0))}async moveElementList(t,e,i=this.baseCreator.stageModel.selectedItemList){let a=!0;if(this.baseCreator.stageModel.edgePoleStage.type)a=await this.baseCreator.stageModel.edgePoleStage.moveTo(e.subtract(this.offsetStartList[0]),i[0],t,!0,this.baseCreator.stageModel.edgePoleStage.type);else if(i.length){const s=1===i.length,n=await Promise.all(i.map((i,a)=>this.doMoveElement(i,e.subtract(this.offsetStartList[a]),t,s)));this.moveAfter(i,t,s),a=n.every(t=>t)}return a}async doMoveElement(t,e,i,a){let s=!0;switch(t.getBaseType()){case jc.NODE:s=await this.baseCreator.stageModel.nodeStage.moveTo(e,t,i,a,{stationListExactAtNode:this.stationListExactAtNode,isUseAttach:!0});break;case jc.STATION:s=await this.baseCreator.stageModel.stationStage.moveTo(e,t,i,a);break;case jc.EDGE:t instanceof Fu?s=await this.baseCreator.stageModel.lineEdgeStage.moveTo(e,t,i,a):t instanceof $u&&(s=await this.baseCreator.stageModel.bezierEdgeStage.moveTo(e,t,i,a)),a&&i===Vc.END&&this.baseCreator.stageModel.edgePoleStage.updateEdgePole();break;case jc.FUNC_AREA:s=await this.baseCreator.stageModel.funcAreaStage.moveTo(e,t,i,a);break;case jc.NOTE_AREA:s=await this.baseCreator.stageModel.noteAreaStage.moveTo(e,t,i,a);break;case jc.LOCATION_AREA:s=await this.baseCreator.stageModel.locationAreaStage.moveTo(e,t,i,a)}return s}getOffsetStart(t,e,i){switch(i.dataModel.baseType){case jc.NODE:t=t.subtract(i.dataModel.pos),e&&(this.stationListExactAtNode=this.baseCreator.stageModel.stationStage.getExactAtStationList(i.dataModel.pos));break;case jc.STATION:t=t.subtract(i.dataModel.pos);break;case jc.EDGE:t=t.subtract(i.dataModel.startPos),this.baseCreator.stageModel.edgePoleStage.resetData();break;case jc.FUNC_AREA:case jc.NOTE_AREA:case jc.LOCATION_AREA:t=t.subtract(i.dataModel.pa)}return t}async moveByKeyCode(t){if(this.baseCreator.stageModel.selectedItemList.length)if("keyup"===t.type)this.baseCreator.actionManage.action===Bc.MOVE_ITEMS&&this.isModeKeyboard&&await this.drawEnd(this.pointWithKeyboard);else if("keydown"===t.type){if(!this.baseCreator.stageModel.isMoveable)return;if(this.baseCreator.actionManage.action===Bc.NORMAL)await this.drawBefore(this.pointWithKeyboard),this.isModeKeyboard=!0,await this.moveByKeyCode(t);else if(this.baseCreator.actionManage.action===Bc.MOVE_ITEMS&&this.isModeKeyboard){let[e,i,a]=[0,0,$c.MOVE_ITEM_DISTANCE];switch(this.baseCreator.stageModel.isCtrlKey&&(a/=5),t.code){case"ArrowUp":i=a;break;case"ArrowDown":i=-a;break;case"ArrowLeft":e=-a;break;case"ArrowRight":e=a}this.pointWithKeyboard=this.pointWithKeyboard.add(new Md(e,i,0)),await this.drawing(this.pointWithKeyboard)}}}async setSelectedItemsAxis(t,e){const i=this.baseCreator.stageModel.selectedItemList.filter(t=>t.dataModel.isStationModel()||t.dataModel.isNodeModel());if(i.length)if(void 0===e)await this.baseCreator.getInputAxis(t,i.reduce((e,i)=>e+i.dataModel.pos[t],0)/i.length);else{for(const a of i){let i=null;i="x"===t?new Md(e,a.dataModel.pos.y,0):new Md(a.dataModel.pos.x,e,0),await this.doMoveElement(a,i,Vc.END,!0)}await this.moveAfter(this.baseCreator.stageModel.selectedItemList,Vc.END,!1)}}async setSelectedItemsMoveOffset(t){this.baseCreator.stageModel.selectedItemList.length&&(void 0===t?await this.baseCreator.getCoordinateOffset():(await this.drawBefore(this.pointWithKeyboard),this.isModeKeyboard=!0,this.pointWithKeyboard=this.pointWithKeyboard.add(new Md(t.x,-t.y,0)),await this.drawEnd(this.pointWithKeyboard)))}async moveAfter(t,e,i){if(e===Vc.END){const e=[],i=[],a=[];if(t.forEach(t=>{t.dataModel.isNodeModel()?e.push(t):t.dataModel.isStationModel()?i.push(t):t.dataModel.isEdgeModel()&&a.push(t)}),e.length){const t=new Set;e.forEach(e=>{this.baseCreator.stageModel.lineEdgeStage.getLineEdgeListByNode(e.getID()).forEach(e=>{t.add(e)}),this.baseCreator.stageModel.bezierEdgeStage.getBezierEdgeListByNode(e.getID()).forEach(e=>{t.add(e)})});for(const e of t)e.dataModel.isEdgeLine()?(this.baseCreator.stageModel.lineEdgeStage.repairEdgeNode(zc.START,e),this.baseCreator.stageModel.lineEdgeStage.repairEdgeNode(zc.END,e)):e.dataModel.isEdgeBezier()&&(this.baseCreator.stageModel.bezierEdgeStage.repairEdgeNode(zc.START,e),this.baseCreator.stageModel.bezierEdgeStage.repairEdgeNode(zc.END,e))}if(a.length)for(const t of a)await this.baseCreator.stageModel.stationStage.updateStationByEdge(t,Wc.UPDATE);if(i.length)for(const t of i)await this.baseCreator.stageModel.stationStage.setStationWithEdge(t)}}}class fp{constructor(t){Object.defineProperty(this,"baseCreator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zoom",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isTextDisplay",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"selectedItemList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clipboardItemList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"moveStage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stationStage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"nodeStage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bezierEdgeStage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lineEdgeStage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"edgePoleStage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tagStage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"funcAreaStage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"noteAreaStage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"locationAreaStage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"buildingAreaStage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dmCodeStage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"edgeGroupStage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wareroomStage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isEditable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isCtrlKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isShiftKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isMoveable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseCreator=t,this.zoom=1,this.isTextDisplay=!0,this.isEditable=!1,this.isCtrlKey=!1,this.isShiftKey=!1,this.isMoveable=!1,this.selectedItemList=[],this.clipboardItemList=[],this.moveStage=new mp(t),this.stationStage=new hp(t),this.bezierEdgeStage=new rp(t),this.lineEdgeStage=new lp(t),this.edgePoleStage=new cp(t),this.nodeStage=new np(t),this.tagStage=new Uu(t),this.funcAreaStage=new ip(t),this.noteAreaStage=new ap(t),this.locationAreaStage=new sp(t),this.buildingAreaStage=new ep(t),this.dmCodeStage=new up(t),this.edgeGroupStage=new dp(t),this.wareroomStage=new pp(t)}resetEditStageModel(){this.setEditState(!1),this.setCtrlKeyState(!1),this.setShiftKeyState(!1),this.setMoveable(!1),this.updateSelectedItemList([]),this.clipboardItemList=[]}updateZoom(t=1){this.zoom=t}setEditState(t=!1){this.isEditable=t}setMoveable(t=!1){this.isMoveable=t}setTextDisplayState(t=!1){this.isTextDisplay=t}setCtrlKeyState(t=!1){this.isCtrlKey!==t&&(this.isCtrlKey=t,this.edgePoleStage.updateEdgePole())}setShiftKeyState(t=!1){this.isShiftKey!==t&&(this.isShiftKey=t)}setElementHoverAble(t){}updateSelectedItemList(t,e=Wc.UPDATE){switch(e){case Wc.UPDATE:if(1===this.selectedItemList.length&&1===t.length&&this.selectedItemList[0]===t[0])return;this.selectedItemList.forEach(t=>{t.setSelectedState(!1),t.setColor(),t.setDraggable(!1)}),t.forEach(t=>{t.setSelectedState(!0),t.setColor(),t.setDraggable(!0)}),this.selectedItemList=t;break;case Wc.DELETE:this.selectedItemList=rh(this.selectedItemList,t,rd.MINUS);break;case Wc.ADD:{const e=[];t.forEach(t=>{const i=this.selectedItemList.findIndex(e=>e===t);~i?(t.setSelectedState(!1),this.selectedItemList.splice(i,1),t.setDraggable(!1)):(t.setSelectedState(!0),e.push(t),t.setDraggable(!0)),t.setColor()}),this.selectedItemList=[...this.selectedItemList,...e];break}}this.edgePoleStage.updateEdgePole()}getAllItemEdge(){return[...this.lineEdgeStage.shapeItemList,...this.bezierEdgeStage.shapeItemList]}getInteractionItemList(){return[...this.stationStage.shapeItemList,...this.nodeStage.shapeItemList,...this.lineEdgeStage.shapeItemList,...this.bezierEdgeStage.shapeItemList,...this.tagStage.shapeItemList,...this.funcAreaStage.shapeItemList,...this.noteAreaStage.shapeItemList,...this.dmCodeStage.shapeItemList]}findItemList(t=0,e){return e.find(e=>e.getID()===t)}async getPickedPickedTypesIdList(t){return hd(await this.baseCreator.canvas.document.elementsFromPoint(t.x,-t.y))}async getItemListFromPoint(t){const{pickInfo:e,type:i=jc.NONE,subType:a=0,ignoreTypeId:s=0}=t,n=Array.isArray(e)?e:await this.getPickedPickedTypesIdList(e),o=[],r=`${i}-${a}-${s}`;return n.forEach(t=>{if(t.pickedTypesId!==r&&(i===jc.NONE||t.type===i)){const e=t.id;let s=null;switch(t.type){case jc.STATION:i!==jc.NONE&&i!==jc.STATION||(s=this.stationStage.shapeItemList.find(t=>t.getID()===e));break;case jc.NODE:i!==jc.NONE&&i!==jc.NODE||(s=this.nodeStage.shapeItemList.find(t=>t.getID()===e));break;case jc.EDGE:if(i===jc.NONE||i===jc.EDGE){let t=[];t=a===Yc.LINE?this.lineEdgeStage.shapeItemList:a===Yc.BEZIER?this.bezierEdgeStage.shapeItemList:this.getAllItemEdge(),s=t.find(t=>t.getID()===e)}break;case jc.EDGE_POLE:i!==jc.NONE&&i!==jc.EDGE_POLE||this.edgePoleStage.shapeItem&&t.subType!==zc.NONE&&(this.edgePoleStage.setPoleType(t.subType),s=this.edgePoleStage.shapeItem);break;case jc.TAG:i!==jc.NONE&&i!==jc.TAG||(s=this.tagStage.shapeItemList.find(t=>t.getID()===e));break;case jc.FUNC_AREA:i!==jc.NONE&&i!==jc.FUNC_AREA||(s=this.funcAreaStage.shapeItemList.find(t=>t.getID()===e));break;case jc.NOTE_AREA:i!==jc.NONE&&i!==jc.NOTE_AREA||(s=this.noteAreaStage.shapeItemList.find(t=>t.getID()===e));break;case jc.LOCATION_AREA:i!==jc.NONE&&i!==jc.LOCATION_AREA||(s=this.locationAreaStage.shapeItemList.find(t=>t.getID()===e));break;case jc.DMCODE:i!==jc.NONE&&i!==jc.DMCODE||(s=this.dmCodeStage.shapeItemList.find(t=>t.getID()===e))}s&&(o.push(s),s=null)}}),o}async pickedStationList(t,e=0,i=0){return await this.getItemListFromPoint({pickInfo:t,type:jc.STATION,subType:i,ignoreTypeId:e})}async pickedNodeList(t,e=0,i=0){return await this.getItemListFromPoint({pickInfo:t,type:jc.NODE,subType:i,ignoreTypeId:e})}async pickedAllEdgeList(t,e=0,i=0){return await this.getItemListFromPoint({pickInfo:t,type:jc.EDGE,subType:i,ignoreTypeId:e})}async pickedLineEdgeList(t,e=0,i=Yc.LINE){return await this.getItemListFromPoint({pickInfo:t,type:jc.EDGE,subType:i,ignoreTypeId:e})}async pickedBezierEdgeList(t,e=0,i=Yc.BEZIER){return await this.getItemListFromPoint({pickInfo:t,type:jc.EDGE,subType:i,ignoreTypeId:e})}getSelectItemOptions(t,e){return e&&(t=t.filter(t=>t.dataModel.type===e)),t.map(t=>({label:t.getName(),type:t.dataModel.baseType,id:t.getID(),value:tp()}))}getSearchItems(t){return this.getSelectItemOptions([...this.stationStage.shapeItemList,...this.lineEdgeStage.shapeItemList,...this.bezierEdgeStage.shapeItemList,...this.funcAreaStage.shapeItemList].filter(e=>t.test(`${e.getID()}`)||t.test(e.getName())))}async getAttachNodeStationPoint(t){const e=await this.pickedNodeList(t);if(e.length)t=e[0].dataModel.pos;else{const e=await this.pickedStationList(t);e.length&&(t=e[0].dataModel.pos)}return t}getItemBySelectOption(t,e){if(!t)return null;let i=null;switch(t.type){case jc.NODE:i=(e||this.nodeStage.shapeItemList).find(e=>e.getID()===t.id);break;case jc.STATION:i=(e||this.stationStage.shapeItemList).find(e=>e.getID()===t.id);break;case jc.EDGE:i=(e||this.getAllItemEdge()).find(e=>e.getID()===t.id);break;case jc.FUNC_AREA:i=(e||this.funcAreaStage.shapeItemList).find(e=>e.getID()===t.id);break;case jc.NOTE_AREA:i=(e||this.noteAreaStage.shapeItemList).find(e=>e.getID()===t.id);break;case jc.LOCATION_AREA:i=(e||this.locationAreaStage.shapeItemList).find(e=>e.getID()===t.id);break;case jc.TAG:i=(e||this.tagStage.shapeItemList).find(e=>e.getID()===t.id);break;case jc.DMCODE:i=(e||this.dmCodeStage.shapeItemList).find(e=>e.getID()===t.id)}return i||null}async deleteAllSelectedItems(t=this.selectedItemList){for(const e of t){const t=e.getID();switch(e.getBaseType()){case jc.NODE:this.nodeStage.delete(t);break;case jc.STATION:this.stationStage.delete(t);break;case jc.EDGE:e.dataModel.isEdgeLine()?this.lineEdgeStage.delete(t):e.dataModel.isEdgeBezier()&&this.bezierEdgeStage.delete(t);break;case jc.FUNC_AREA:this.funcAreaStage.delete(t);break;case jc.NOTE_AREA:this.noteAreaStage.delete(t);break;case jc.LOCATION_AREA:this.locationAreaStage.delete(t);break;case jc.TAG:this.tagStage.delete(t);break;case jc.DMCODE:this.dmCodeStage.delete(t)}}}copy(t){const e=1===(t=t||this.selectedItemList).length&&t[0].getBaseType()===jc.FUNC_AREA;return this.clipboardItemList=e?[...t]:[],this.clipboardItemList}parseClipboardList(t){let e=1===this.clipboardItemList.length;const i=this.clipboardItemList[0];e=e&&i.dataModel.isFuncAreaModel(),e&&(t=t||this.baseCreator.actionManage.pointerPoint,this.funcAreaStage.parseFuncArea(i,t))}}class gp{constructor(t){Object.defineProperty(this,"robotItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.robotItem=function(t){return new ir({id:t.id||Xd(),name:t.name||"Robot-1",interactive:!1,style:{x:t.x,y:t.y,width:t.width,height:t.height,img:t.img,anchor:[.5,.5],transformOrigin:"center",zIndex:qc.ROBOT_ICON,opacity:.8}})}({x:t.x,y:-t.y,width:t.width,height:t.height,img:t.img}),this.robotItem.setEulerAngles(-t.yaw)}updateShape(t,e,i){if(!i.isShowRobotIcon){if(!t)return;e=i.img!==this.robotItem.style.img}this.robotItem.setAttribute("x",i.x),this.robotItem.setAttribute("y",-i.y),this.robotItem.setAttribute("width",i.width),this.robotItem.setAttribute("height",i.height),this.robotItem.setEulerAngles(-i.yaw),e&&this.robotItem.setAttribute("img",i.img),t&&this.robotItem.setAttribute("visibility",i.isShowRobotIcon?"visible":"hidden")}}class _p{constructor(){Object.defineProperty(this,"itemGroup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.itemGroup=null}updateShape(t,e,i,a){this.clear(),this.itemGroup=function(t,e,i,a){const s=new tr({interactive:!1,zIndex:qc.LASER});if(e.length){const i=e.map(e=>new nr({style:{points:[...e.points.map(t=>[t.x/Sc,-t.y/Sc]),[t.x,-t.y]],fill:e.color,fillOpacity:.3,lineWidth:1,stroke:e.color}}));s.append(...i)}if(i.length){const e=i.map(e=>new nr({style:{points:[...e.points.map(t=>[t.x/Sc,-t.y/Sc]),[t.x,-t.y]],fill:e.color,fillOpacity:.3,lineWidth:1,stroke:e.color}}));s.append(...e)}if(a.length){let t=[];a.forEach(e=>{t=t.concat(e.points.map(t=>new Xo({style:{cx:t.x/Sc,cy:-t.y/Sc,r:$c.DEFAULT_STROKE_WIDTH,fill:e.color}})))}),s.append(...t)}return s}(t,e,i,a)}clear(){this.itemGroup=null}}class yp{constructor(){Object.defineProperty(this,"itemGroup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.itemGroup=new tr({interactive:!1,zIndex:qc.NAV_PATH})}updateShape(t){this.itemGroup.replaceChildren(...t.map(t=>function(t){switch(t.type){case 4:return[new Xo({style:{cx:t.sx/Sc,cy:-t.sy/Sc,r:10,fill:"transparent",stroke:Fc.NAV_PATH,lineWidth:$c.DEFAULT_STROKE_WIDTH}}),new lr({style:{x:t.sx/Sc,y:-t.sy/Sc+25,text:`rotate(${Zd(t.rotateAngle/Ic).toFixed(1)})Â°`,fill:Fc.NAV_PATH,zIndex:1,textAlign:"center"}})];case 1:return[new Wh({style:{body:new ar({style:{x1:t.sx/Sc,y1:-t.sy/Sc,x2:t.ex/Sc,y2:-t.ey/Sc}}),endHead:!0,stroke:Fc.NAV_PATH,lineWidth:$c.DEFAULT_STROKE_WIDTH}})];case 3:return[new Wh({style:{body:new sr({style:{path:[["M",t.sx/Sc,-t.sy/Sc],["C",t.cx/Sc,-t.cy/Sc,t.dx/Sc,-t.dy/Sc,t.ex/Sc,-t.ey/Sc]]}}),startHead:!0,stroke:Fc.NAV_PATH,lineWidth:$c.DEFAULT_STROKE_WIDTH}})];default:return[]}}(t)).flat())}}class vp{constructor(){Object.defineProperty(this,"itemGroup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.itemGroup=new tr({interactive:!1})}updateShape(t,e,i=!0){if(!t.length)return void this.itemGroup.removeChildren();const a=[];for(let s=t.length-1;s>=0;s--){const n=i&&0===s,o=wu(t[s],n?2:1,e=n?"#1f4d80":e);a.push(o)}this.itemGroup.replaceChildren(...a)}}class bp{constructor(){Object.defineProperty(this,"locusItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.locusItem=new sr({interactive:!1,style:{path:[],stroke:Fc.LOCUS,lineWidth:1}})}updateShape(t){const e=[...this.locusItem.style.path];e.length>300&&(e.shift(),e[0][0]="M");const i=[[0===e.length?"M":"L",t.x,-t.y]];this.locusItem.setAttribute("path",[...e,...i])}show(){this.locusItem.setAttribute("visibility","visible")}hide(){this.locusItem.setAttribute("visibility","hidden")}clear(){this.locusItem.setAttribute("path",[])}}class Ep{constructor(){Object.defineProperty(this,"rootElementGroup",{enumerable:!0,configurable:!0,writable:!0,value:new tr({zIndex:qc.NETWORK_MONITOR})}),Object.defineProperty(this,"isShowDisconnect",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Ku.set(this,[]),Qu.set(this,"RSSI"),Xu.set(this,new Map),Ju.set(this,new Map),Object.defineProperty(this,"setDisplayConfigList",{enumerable:!0,configurable:!0,writable:!0,value:t=>{t.forEach(t=>{this.setDisplayConfig(t)})}})}setDisplayConfig(t){const{SSID:e,color:i,visible:a}=t,s=m(this,Xu,"f").has(e);m(this,Xu,"f").set(e,{color:i,visible:a}),s&&m(this,Ku,"f").forEach(t=>{t.SSID===e&&this.renderSingle(t)})}setData(t){this.setEmpty(),f(this,Ku,t,"f"),m(this,Ku,"f").forEach(t=>{this.renderSingle(t)})}setDisconnectVisible(t){this.isShowDisconnect!==t&&(this.isShowDisconnect=t,m(this,Ku,"f").forEach(t=>{this.renderSingle(t)}))}renderSingle(t){var e;const{id:i=0,SSID:a,"Connection State":s}=t,{visible:n=!0,color:o="red"}=null!==(e=m(this,Xu,"f").get(a))&&void 0!==e?e:{},r="Connected"!==s,l=n&&(!r||this.isShowDisconnect),c=m(this,Ju,"f").get(i);if(c&&!l)this.rootElementGroup.removeChild(c),m(this,Ju,"f").delete(i);else if(!c&&l){const e=this.createSingle(t,{color:o,isDisconnected:r});this.rootElementGroup.append(e),m(this,Ju,"f").set(i,e)}}createSingle(t,e){const{"Cur Pose":i}=t,{x:a,y:s}=i,{fill:n,r:o}=function(t,e){const{RSSI:i,SNR:a}=t,{color:s,isDisconnected:n,type:o}=e;let r="black",l=10;if(!n){const t=n?1:"RSSI"===o?function(t){return t<=-85?.1:t>=-60?1:(t+85)/25*.9+.1}(+i):function(t){return t<=10?.1:t>=20?1:(t-10)/10*.9+.1}(+a);r=`radial-gradient(circle , ${s.replace("rgb","rgba").replace(")",`, ${t})`)} 0%, ${s.replace("rgb","rgba").replace(")",", 0)")} 100%)`,l=20}return{fill:r,r:l}}(t,{...e,type:m(this,Qu,"f")});return new Xo({style:{cx:a/Sc,cy:-s/Sc,r:o,fill:n}})}setEmpty(){f(this,Ku,[],"f"),this.rootElementGroup.removeChildren(),m(this,Ju,"f").clear()}}Ku=new WeakMap,Qu=new WeakMap,Xu=new WeakMap,Ju=new WeakMap;const Ap=new Ec;class wp{constructor(t,e){Object.defineProperty(this,"globalGroupMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"robotMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"robotPose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"robotLocus",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"locateMove",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"calculateDistance",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"robotIcon",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"robotLaser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"robotNavPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"robotAvoidRect",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"robotNetworkMonitorManager",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"mapModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stageModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbackMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"grade",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"actionManage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"renderer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"edgeBezierCreator",{enumerable:!0,configurable:!0,writable:!0,value:t=>{Qd((e,i)=>{const a=[];for(let s=e;s<i;s++)a.push(du(t[s]));this.renderGroup("edge-bezier-map",a,"edge-bezier-map",qc.EDGE)},t.length,[],0,300)}}),Object.defineProperty(this,"stationCreator",{enumerable:!0,configurable:!0,writable:!0,value:t=>{Qd((e,i)=>{const a=[];for(let s=e;s<i;s++)a.push(ru(t[s]));this.renderGroup("station-map",a,"station-map",qc.STATION)},t.length,[],0,300)}}),Object.defineProperty(this,"areaCreator",{enumerable:!0,configurable:!0,writable:!0,value:(t,e="area-map",i)=>{Qd((a,s)=>{const n=[];for(let e=a;e<s;e++)n.push(fu(t[e],i));this.renderGroup(e,n,e,(jc.FUNC_AREA,qc.FUNC_AREA))},t.length,[],0,300)}}),Object.defineProperty(this,"dmcodeCreator",{enumerable:!0,configurable:!0,writable:!0,value:t=>{Qd((e,i)=>{const a=[];for(let s=e;s<i;s++)a.push(yu(t[s]));this.renderGroup("dmcode-map",a,"dmcode-map",qc.DMCODE)},t.length,[],0,300)}}),Object.defineProperty(this,"featureCreator",{enumerable:!0,configurable:!0,writable:!0,value:(t,e)=>{Qd((i,a)=>{const s=[];for(let n=i;n<a;n++)s.push(vu(e[n],t));this.renderGroup(t,s,t,qc.FEATURE)},e.length,[],0,300)}}),Object.defineProperty(this,"featureStationCreator",{enumerable:!0,configurable:!0,writable:!0,value:t=>{Qd((e,i)=>{const a=[];for(let s=e;s<i;s++)a.push(bu(t[s]));this.renderGroup("feature-station-map",a,"feature-station-map",qc.FEATURE)},t.length,[],0,300)}}),Object.defineProperty(this,"lmkCreator",{enumerable:!0,configurable:!0,writable:!0,value:(t,e)=>{Qd((i,a)=>{const s=[];for(let t=i;t<a;t++)s.push(Au(e[t]));this.renderGroup(t,s,t,qc.LMK)},e.length,[],0,300)}}),Object.defineProperty(this,"gridCreator",{enumerable:!0,configurable:!0,writable:!0,value:async t=>{this.getGroupMap(nd.GRID,qc.GRID).append(function(t){const e=t.height/$c.GRID_CELL_UNIT+1,i=t.width/$c.GRID_CELL_UNIT+1,a=[],s=[],n=Math.floor(i)*$c.GRID_CELL_UNIT,o=Math.floor(e)*$c.GRID_CELL_UNIT;for(let t=0;t<e;t++){const e=t*$c.GRID_CELL_UNIT,i={x1:0,y1:e,x2:n,y2:e,stroke:Fc.ASSIST_GRID,lineWidth:$c.GRID_STROKE_WIDTH};t%5==0?i.lineWidth=$c.DEFAULT_STROKE_WIDTH:i.lineDash=[1,2],a.push(i)}for(let t=0;t<i;t++){const e=t*$c.GRID_CELL_UNIT,i={x1:e,y1:0,x2:e,y2:o,stroke:Fc.ASSIST_GRID,lineWidth:$c.GRID_STROKE_WIDTH};t%5==0?i.lineWidth=$c.DEFAULT_STROKE_WIDTH:i.lineDash=[1,2],s.push(i)}const r=new tr({interactive:!1,zIndex:qc.GRID});return r.append(...a.map(t=>new ar({style:t})),...s.map(t=>new ar({style:t}))),r.setPosition(t.x,t.y),r}(t))}}),Object.defineProperty(this,"handleCameraPan",{enumerable:!0,configurable:!0,writable:!0,value:t=>{const e=this.canvas.getCamera(),i=e.getZoom()||1;"pointermove"===t.type&&e.pan(-t.movementX/i,-t.movementY/i)}}),Object.defineProperty(this,"handleCameraZoom",{enumerable:!0,configurable:!0,writable:!0,value:t=>{const e=this.canvas.getCamera();let i;i=t.deltaY<0?Math.max(xc,Math.min(3,e.getZoom()/.95)):Math.max(xc,.95*Math.min(3,e.getZoom())),this.setZoom(i),this.grade2Zoom(i),this.callbackMap.stageAssistFn({type:"zoom",zoom:i})}}),Object.defineProperty(this,"handleStageAssistPointer",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.callbackMap.stageAssistFn({type:"pointer",x:t.x,y:-t.y})}}),Object.defineProperty(this,"handleLocateMove",{enumerable:!0,configurable:!0,writable:!0,value:(t,e=Vc.NONE,i)=>{if(t){if(i)switch(e){case Vc.START:this.locateMove||(this.locateMove=new Su({x:i.x,y:-i.y}),this.canvas.appendChild(this.locateMove.itemGroup));break;case Vc.ING:this.locateMove&&this.locateMove.setYaw(Math.atan2(-i.y-this.locateMove.y,i.x-this.locateMove.x));break;case Vc.END:this.locateMove&&(this.canvas.removeChild(this.locateMove.itemGroup),this.callbackMap.locateMoveFn&&this.callbackMap.locateMoveFn(this.locateMove.getTargetPose()),this.locateMove=null)}}else this.locateMove&&(this.canvas.removeChild(this.locateMove.itemGroup),this.locateMove=null)}}),Object.defineProperty(this,"handleCalculateDistance",{enumerable:!0,configurable:!0,writable:!0,value:(t,e,i=Vc.NONE,a)=>{var s,n,o;if(2===e)this.canvas.appendChild(this.getGroupMap(nd.CALCULATE_DISTANCE,qc.CALCULATE_DISTANCE));else if(1===e)this.canvas.removeChild(this.getGroupMap(nd.CALCULATE_DISTANCE,qc.CALCULATE_DISTANCE));else if(t){if(a)switch(i){case Vc.START:this.globalGroupMap[nd.CALCULATE_DISTANCE]?this.globalGroupMap[nd.CALCULATE_DISTANCE].setAttribute("zIndex",qc.CALCULATE_DISTANCE):this.getGroupMap(nd.CALCULATE_DISTANCE,qc.CALCULATE_DISTANCE).setAttribute("interactive",!1),this.calculateDistance||(this.calculateDistance=new Cu,this.calculateDistance.createInitialShape(a.x,-a.y),this.calculateDistance.itemGroup&&this.globalGroupMap[nd.CALCULATE_DISTANCE].appendChild(this.calculateDistance.itemGroup));break;case Vc.ING:this.calculateDistance&&this.calculateDistance.createModifyShape(a.x,-a.y);break;case Vc.END:if(this.calculateDistance){var r,l;this.handleCalculateDistance(!0,0,Vc.ING,a);const t=this.calculateDistance.endDraw();null===(r=(l=this.callbackMap).calculateDistanceFn)||void 0===r||r.call(l,t)}null!==(s=this.globalGroupMap[nd.CALCULATE_DISTANCE])&&void 0!==s&&s.setAttribute("zIndex",qc.NORMAL),this.calculateDistance=null}}else this.calculateDistance&&this.calculateDistance.itemGroup&&(null!==(n=this.globalGroupMap[nd.CALCULATE_DISTANCE])&&void 0!==n&&n.removeChild(this.calculateDistance.itemGroup),null!==(o=this.globalGroupMap[nd.CALCULATE_DISTANCE])&&void 0!==o&&o.setAttribute("zIndex",qc.NORMAL),this.calculateDistance=null)}}),Object.defineProperty(this,"setInteraction",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.actionManage.action!==t&&(this.cancelInteraction(),this.actionManage.setAction(t),t===Bc.TAG)&&(this.robotPose?this.stageModel.tagStage.drawBefore(new Md(this.robotPose.x,this.robotPose.y,Jd(this.robotPose.yaw))):this.cancelInteraction())}}),Object.defineProperty(this,"cancelInteraction",{enumerable:!0,configurable:!0,writable:!0,value:()=>{switch(this.actionManage.action){case Bc.MANUAL_LOCATE:case Bc.MOVE_POSE:this.handleLocateMove(!1);break;case Bc.CALCULATE_DISTANCE:this.handleCalculateDistance(!1,0);break;case Bc.STATION:this.stageModel.stationStage.drawCancel();break;case Bc.NODE:this.stageModel.nodeStage.drawCancel();break;case Bc.FUNC_AREA:this.stageModel.funcAreaStage.drawCancel();break;case Bc.NOTE_AREA:this.stageModel.noteAreaStage.drawCancel();break;case Bc.LOCATION_AREA:this.stageModel.locationAreaStage.drawCancel();break;case Bc.TAG:this.stageModel.tagStage.drawCancel();break;case Bc.DMCODE:this.stageModel.dmCodeStage.drawCancel();break;case Bc.CLEAN_AREA:case Bc.SELECTION:this.stageModel.buildingAreaStage.drawCancel();break;case Bc.LINE:this.stageModel.lineEdgeStage.drawCancel();break;case Bc.BEZIER:this.stageModel.bezierEdgeStage.drawCancel();break;case Bc.MOVE_ITEMS:this.stageModel.moveStage.drawCancel(this.actionManage.movingPoint);break;case Bc.EDGE_POLE:this.stageModel.edgePoleStage.drawCancel();break;case Bc.RESIZE_ITEMS:this.stageModel.funcAreaStage.resizeCancel(),this.stageModel.noteAreaStage.resizeCancel(),this.stageModel.buildingAreaStage.resizeCancel(),this.stageModel.locationAreaStage.resizeCancel()}this.actionManage.setAction(Bc.NORMAL)}}),Object.defineProperty(this,"locusUpdate",{enumerable:!0,configurable:!0,writable:!0,value:async(t,e)=>{var i,a,s;switch(t){case 0:break;case 1:return void(null===(i=this.robotLocus)||void 0===i||i.show());case 2:return void(null===(a=this.robotLocus)||void 0===a||a.hide());case 3:return void(null===(s=this.robotLocus)||void 0===s||s.clear())}null===this.robotLocus&&(this.robotLocus=new bp,this.canvas.appendChild(this.robotLocus.locusItem)),this.robotLocus.updateShape(e)}}),Object.defineProperty(this,"updateRuntimeLMKList",{enumerable:!0,configurable:!0,writable:!0,value:(t,e)=>{var i;null!==(i=this.globalGroupMap[nd.LMK_RUNTIME])&&void 0!==i&&i.removeChildren(),t?this.lmkCreator(nd.LMK_RUNTIME,e):this.globalGroupMap[nd.LMK_RUNTIME]&&(this.canvas.removeChild(this.globalGroupMap[nd.LMK_RUNTIME]),this.globalGroupMap[nd.LMK_RUNTIME]=null)}}),Object.defineProperty(this,"updateRuntimeFeatureList",{enumerable:!0,configurable:!0,writable:!0,value:(t,e)=>{var i;null!==(i=this.globalGroupMap[nd.FEATURE_RUNTIME])&&void 0!==i&&i.removeChildren(),t?this.featureCreator(nd.FEATURE_RUNTIME,e):this.globalGroupMap[nd.FEATURE_RUNTIME]&&(this.canvas.removeChild(this.globalGroupMap[nd.FEATURE_RUNTIME]),this.globalGroupMap[nd.FEATURE_RUNTIME]=null)}}),this.renderer=Ap,this.canvas=new Er({container:t,width:e.width||document.body.clientWidth,height:e.height||document.body.clientHeight,renderer:this.renderer});const i=this.canvas.getCamera();i.setZoom(1),i.pan(0,0),this.globalGroupMap={},this.robotMap={},this.robotPose=null,this.robotLocus=null,this.locateMove=null,this.calculateDistance=null,this.robotIcon=null,this.robotLaser=null,this.robotNavPath=null,this.robotAvoidRect=null,this.callbackMap=(null==e?void 0:e.callbackMap)||{},this.actionManage=new Vh(t,this),this.grade="normal",this.mapModel=new Hd,this.stageModel=new fp(this),this.loadMapJson(e.mapData)}renderGroup(t,e,i=Xd(),a=qc.NORMAL,s){return this.globalGroupMap[t]?e.length&&this.globalGroupMap[t].append(...e):(this.globalGroupMap[t]=new tr({id:i,name:i,interactive:null==s||s,style:{zIndex:a}}),e.length&&this.globalGroupMap[t].append(...e),this.canvas.appendChild(this.globalGroupMap[t])),this.globalGroupMap[t]}grade2Zoom(t){t>=.5&&"normal"!==this.grade&&(this.setGradeDisplay("normal"),this.grade="normal"),t<.5&&t>.25&&"small"!==this.grade?(this.setGradeDisplay("small"),this.grade="small"):t<=.25&&t>.1&&"mini"!==this.grade?(this.setGradeDisplay("mini"),this.grade="mini"):t<=.1&&"tiny"!==this.grade&&(this.setGradeDisplay("tiny"),this.grade="tiny")}setGradeDisplay(t){if(!this.stageModel.isTextDisplay)return;const e=this.canvas.getRoot(),i=t=>(null==e?void 0:e.getElementsByName(t))||[],a={normal:()=>{[...i("grade-small"),...i("grade-mini"),...i("grade-tiny")].map(t=>t.setAttribute("visibility","visible"))},small:()=>{[...i("grade-mini"),...i("grade-tiny")].map(t=>t.setAttribute("visibility","visible")),[...i("grade-small")].map(t=>t.setAttribute("visibility","hidden"))},mini:()=>{[...i("grade-tiny")].map(t=>t.setAttribute("visibility","visible")),[...i("grade-small"),...i("grade-mini")].map(t=>t.setAttribute("visibility","hidden"))},tiny:()=>{[...i("grade-small"),...i("grade-mini"),...i("grade-tiny")].map(t=>t.setAttribute("visibility","hidden"))}};return a[t]&&a[t]()}setTextDisplayState(t){this.stageModel.setTextDisplayState(t)}nodeCreator(t){Qd((e,i)=>{const a=[];for(let s=e;s<i;s++)a.push(uu(t[s]));this.renderGroup("node-map",a,"node-map",qc.NODE)},t.length,[],0,300)}edgeCreator(t,e="edge-map"){Qd((i,a)=>{const s=[];for(let e=i;e<a;e++)s.push(lu(t[e]));this.renderGroup(e,[...s],e,qc.EDGE)},t.length,[],0,300)}tagCreator(t){Qd((e,i)=>{const a=[];for(let s=e;s<i;s++)a.push(Eu(t[s]));this.renderGroup("tag-map",a,"tag-map",qc.TAG)},t.length,[],0,300)}gImgMapBackgroundGroupCreator(t){this.getGroupMap(nd.BACKGROUND_IMG,qc.ROBOT_BACKGROUND_IMG).append(function(t){const e=new ir({style:{x:t.x,y:t.y,width:t.width,height:t.height,img:t.img,zIndex:qc.ROBOT_BACKGROUND_IMG}}),i=new Wh({style:{body:new ar({style:{x1:-50,y1:0,x2:100,y2:0}}),endHead:!0,stroke:Fc.AXIS_X,lineWidth:$c.DEFAULT_STROKE_WIDTH}}),a=new Wh({style:{body:new ar({style:{x1:0,y1:50,x2:0,y2:-100}}),endHead:!0,stroke:Fc.AXIS_Y,lineWidth:$c.DEFAULT_STROKE_WIDTH}}),s=new lr({style:{x:-25,y:25,text:"(0, 0)",fill:Fc.AXIS_X,textAlign:"center"}}),n=new lr({style:{x:80,y:20,text:"X",fill:Fc.AXIS_X,textAlign:"right"}}),o=new lr({style:{x:-15,y:-75,text:"Y",fill:Fc.AXIS_Y,textAlign:"right"}}),r=new tr({interactive:!1});return r.append(e,i,a,s,n,o),r}(t))}createMapReference(t){this.gridCreator(t)}centerOnRobotIcon(t=!1){var e,i,a,s;const n=this.canvas.getCamera();n&&n.gotoLandmark({position:[(null===(e=this.robotPose)||void 0===e?void 0:e.x)||0,-((null===(i=this.robotPose)||void 0===i?void 0:i.y)||0),n.getPosition()[2]],focalPoint:[(null===(a=this.robotPose)||void 0===a?void 0:a.x)||0,-((null===(s=this.robotPose)||void 0===s?void 0:s.y)||0),n.getFocalPoint()[2]],zoom:t?1:n.getZoom(),roll:t?0:n.getRoll()}),t&&this.setZoom()}setZoom(t){void 0===t?t=this.canvas.getCamera().getZoom():this.canvas.getCamera().setZoom(t),this.stageModel.updateZoom(t)}setRobotPoseAndState(t){var e,i,a;const s=((null===(e=this.robotPose)||void 0===e?void 0:e.isShowRobotIcon)||!1)!==t.isShowRobotIcon,n=(null===(i=this.robotPose)||void 0===i?void 0:i.state)!==t.state;this.robotPose=t,this.robotIcon?(this.robotIcon.updateShape(s,n,this.robotPose),(null===(a=this.robotPose)||void 0===a?void 0:a.isFollowRobotIcon)&&this.centerOnRobotIcon(!1)):(this.robotIcon=new gp(this.robotPose),this.canvas.appendChild(this.robotIcon.robotItem)),this.locusUpdate(0,this.robotPose)}laserUpdate(t,e,i,a){t?this.robotLaser?(this.robotLaser.itemGroup&&(this.canvas.removeChild(this.robotLaser.itemGroup),this.robotLaser.updateShape(this.robotPose,e,i,a)),this.robotLaser.itemGroup&&this.canvas.appendChild(this.robotLaser.itemGroup)):(this.robotLaser=new _p,this.robotLaser.updateShape(this.robotPose,e,i,a),this.robotLaser.itemGroup&&this.canvas.appendChild(this.robotLaser.itemGroup)):this.robotLaser&&(this.robotLaser.itemGroup&&this.canvas.removeChild(this.robotLaser.itemGroup),this.robotLaser.clear(),this.robotLaser=null)}navPathUpdate(t,e){t?this.robotNavPath?this.robotNavPath.updateShape(e):(this.robotNavPath=new yp,this.robotNavPath.updateShape(e),this.robotNavPath&&this.canvas.appendChild(this.robotNavPath.itemGroup)):this.robotNavPath&&(this.canvas.removeChild(this.robotNavPath.itemGroup),this.robotNavPath=null)}avoidRectUpdate(t,e,i,a=!0){t?this.robotAvoidRect?this.robotAvoidRect.updateShape(e,i,a):(this.robotAvoidRect=new vp,this.robotAvoidRect.updateShape(e,i,a),this.robotAvoidRect&&this.canvas.appendChild(this.robotAvoidRect.itemGroup)):this.robotAvoidRect&&(this.canvas.removeChild(this.robotAvoidRect.itemGroup),this.robotAvoidRect=null)}initRobotNetworkMonitorManager(){this.robotNetworkMonitorManager=new Ep,this.canvas.appendChild(this.robotNetworkMonitorManager.rootElementGroup)}setElementCenterAndSelected(t){let e=null,i=null;switch(t.type){case jc.NODE:e=this.stageModel.nodeStage.getOneItem(t.id),e&&(i={x:e.dataModel.pos.x,y:-e.dataModel.pos.y});break;case jc.STATION:e=this.stageModel.stationStage.getOneItem(t.id),e&&(i={x:e.dataModel.pos.x,y:-e.dataModel.pos.y});break;case jc.EDGE:if(e=this.stageModel.lineEdgeStage.getOneItem(t.id)||this.stageModel.bezierEdgeStage.getOneItem(t.id),e){const t=e.dataModel.endPos.add(e.dataModel.startPos).divide(2);i={x:t.x,y:-t.y}}break;case jc.FUNC_AREA:if(e=this.stageModel.funcAreaStage.getOneItem(t.id),e){const t=e.dataModel.pc.add(e.dataModel.pa).divide(2);i={x:t.x,y:-t.y}}break;case jc.NOTE_AREA:if(e=this.stageModel.noteAreaStage.getOneItem(t.id),e){const t=e.dataModel.pc.add(e.dataModel.pa).divide(2);i={x:t.x,y:-t.y}}break;case jc.LOCATION_AREA:if(e=this.stageModel.locationAreaStage.getOneItem(t.id),e){const t=e.dataModel.pc.add(e.dataModel.pa).divide(2);i={x:t.x,y:-t.y}}break;case jc.TAG:e=this.stageModel.tagStage.getOneItem(t.id),e&&(i={x:e.dataModel.pos.x,y:-e.dataModel.pos.y});break;case jc.DMCODE:e=this.stageModel.dmCodeStage.getOneItem(t.id),e&&(i={x:e.dataModel.pos.x,y:-e.dataModel.pos.y});break;default:return}if(e&&(this.stageModel.updateSelectedItemList([e]),e=null),i){const t=this.canvas.getCamera();t&&t.gotoLandmark({position:[i.x,i.y,t.getPosition()[2]],focalPoint:[i.x,i.y,t.getFocalPoint()[2]],zoom:t.getZoom(),roll:t.getRoll()})}}addButton(){var t;document.querySelectorAll(".div-wrapper-btn").forEach(t=>t.remove());const e=document.createElement("div");e.className="div-wrapper-btn",null!==(t=document.querySelector("body"))&&void 0!==t&&t.append(e),this.createCenterAndRotateBtn()}createCenterAndRotateBtn(){var t,e,i,a,s;this.canvas.getCamera();const n=document.createElement("button");document.createElement("button");const o=document.createElement("button"),r=document.createElement("button"),l=document.createElement("button"),c=document.createElement("button"),d=document.createElement("button"),h=document.createElement("button");n.onclick=()=>{this.setEditState(!0),this.setMoveable(!0)},o.onclick=()=>{},r.onclick=()=>{this.setEditState(!1)},l.onclick=()=>{this.setInteraction(Bc.MOVE_POSE)},d.onclick=()=>{this.setInteraction(Bc.CALCULATE_DISTANCE)},h.onclick=()=>{this.cancelInteraction()},n.textContent="ç¼è¾å°å¾",o.textContent="ä¿å­",r.textContent="éåº",l.textContent="æå¨å®ä½/å¯¼èªå°æä½ç½®",c.textContent="åæ¶å®ä½/å¯¼èª",d.textContent="è®¡ç®è·ç¦»",h.textContent="åæ¶ç»å¶/äº¤äº",null!==(t=document.querySelector(".div-wrapper-btn"))&&void 0!==t&&t.append(document.createElement("br")),null!==(e=document.querySelector(".div-wrapper-btn"))&&void 0!==e&&e.append(n),null!==(i=document.querySelector(".div-wrapper-btn"))&&void 0!==i&&i.append(document.createElement("br")),null!==(a=document.querySelector(".div-wrapper-btn"))&&void 0!==a&&a.append(o),null===(s=document.querySelector(".div-wrapper-btn"))||void 0===s||s.append(r)}setMapZoom(t){let e=1;"tiny"===t?e=.1:"mini"===t?e=.25:"small"===t?e=.5:"normal"===t&&(e=1),this.setZoom(e),this.grade2Zoom(e)}setZoomInOrOut(t){let e=this.canvas.getCamera().getZoom()||1;e=Math.max(xc,Math.min(3,t?e/.95:.95*e)),this.setZoom(e),this.grade2Zoom(e),this.callbackMap.stageAssistFn({type:"zoom",zoom:e})}setMapRotate(t){this.canvas.getCamera().rotate(0,0,t)}getGroupMap(t,e=qc.NORMAL,i){return this.globalGroupMap[t]||this.renderGroup(t,[],t,e,i)}loadMapJson(t,e=!1){this.mapModel.loadFromJson(t,e,!0)}initMousetrap(){wc.bind("ctrl",()=>{this.stageModel.setCtrlKeyState(!0)}),wc.bind("ctrl",()=>{this.stageModel.setCtrlKeyState(!1)},"keyup"),wc.bind("shift",()=>{this.stageModel.setShiftKeyState(!0)}),wc.bind("shift",()=>{this.stageModel.setShiftKeyState(!1)},"keyup"),wc.bind("s",()=>{this.setInteraction(Bc.STATION)}),wc.bind("n",()=>{this.setInteraction(Bc.NODE)}),wc.bind("r",()=>{this.setInteraction(Bc.FUNC_AREA)}),wc.bind("l",()=>{this.setInteraction(Bc.LINE)}),wc.bind("b",()=>{this.setInteraction(Bc.BEZIER)}),wc.bind("c",()=>{this.setInteraction(Bc.CLEAN_AREA)}),wc.bind("shift+c",()=>{this.stageModel.buildingAreaStage.deleteLatestSomeBuildingArea(jc.CLEAN_AREA)}),wc.bind("shift+t",()=>{this.setInteraction(Bc.TAG)}),wc.bind("space",()=>{this.setInteraction(Bc.SELECTION)}),wc.bind(["backspace","del"],()=>{this.stageModel.deleteAllSelectedItems()}),wc.bind(["up","down","left","right"],t=>{this.stageModel.moveStage.moveByKeyCode(t)}),wc.bind(["up","down","left","right"],t=>{this.stageModel.moveStage.moveByKeyCode(t)},"keyup"),wc.bind("t",()=>{}),wc.bind("q",()=>{this.callbackMap.stageAssistFn({type:"recodeDMCode"})}),wc.bind("shift+a",()=>{this.stageModel.stationStage.setSelectedItemsYaw()}),wc.bind("shift+x",()=>{this.stageModel.moveStage.setSelectedItemsAxis("x")}),wc.bind("shift+y",()=>{this.stageModel.moveStage.setSelectedItemsAxis("y")}),wc.bind("shift+m",()=>{this.stageModel.moveStage.setSelectedItemsMoveOffset()}),wc.bind("ctrl+c",()=>{this.stageModel.copy()}),wc.bind("ctrl+v",()=>{this.stageModel.parseClipboardList(this.actionManage.movingPoint)}),wc.bind("ctrl+z",()=>{}),wc.bind("ctrl+y",()=>{}),wc.bind("ctrl+s",()=>{}),window.location.href.includes("matrix")&&wc.bind("esc",()=>{this.cancelInteraction()})}saveCurrentMap(){return this.cancelInteraction(),this.stageModel.stationStage.updateStationRecordedNodeId(),this.mapModel.saveToJson()}setEditState(t){this.cancelInteraction(),t?(this.stageModel.setEditState(!0),this.initMousetrap(),this.stageModel.setElementHoverAble(t)):(this.stageModel.updateSelectedItemList([]),this.stageModel.setElementHoverAble(t),wc.reset(),this.stageModel.resetEditStageModel())}setMoveable(t){this.stageModel.setMoveable(t)}async getTranslation(t,e){return await this.callbackMap.stageAssistFn({type:"translation",key:t,params:e})||t.split(".")[1]}async selectItem(t,e){return await this.callbackMap.stageAssistFn({type:"select",key:t,params:e})}notify({key:t="",keyData:e=null,text:i="",position:a="top",notifyType:s="negative",timeout:n=3e3}={}){this.callbackMap.stageAssistFn({type:"notify",key:t,keyData:e,text:i,position:a,notifyType:s,timeout:n})}updateAction(t){this.callbackMap.stageAssistFn({type:"updateAction",action:t})}handleContextMenu(){this.callbackMap.stageAssistFn({type:"contextMenu",action:this.actionManage.action,selectedList:this.stageModel.getSelectItemOptions(this.stageModel.selectedItemList),clipboardList:this.stageModel.clipboardItemList})}modifyGraphLabel(t,e){this.callbackMap.stageAssistFn({type:"graphLabel",operateType:t,graphLabelItem:{...e}})}async doubleClickedItem(t){await this.callbackMap.stageAssistFn({type:"doubleClicked",isFromCanvas:!0,dat:t})}async getInputAxis(t,e){await this.callbackMap.stageAssistFn({type:"getInputAxis",axisType:t,value:e})}async getCoordinateOffset(){await this.callbackMap.stageAssistFn({type:"getCoordinateOffset"})}reset(){this.globalGroupMap=null,this.robotMap={},this.robotPose=null,this.robotLocus=null,this.locateMove=null,this.calculateDistance=null,this.robotIcon=null,this.robotLaser=null,this.robotNavPath=null,this.robotAvoidRect=null,wc.reset(),this.mapModel=null,this.stageModel=null,this.callbackMap={},this.grade="normal",this.canvas.removeAllEventListeners(),this.canvas.removeChildren(),this.canvas.destroy(!0),this.canvas=null}}const Sp="http://www.w3.org/2000/svg";class Cp{constructor(t,e){Object.defineProperty(this,"wrapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"baseCreator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.wrapper=document.querySelector(`#${e}`),this.baseCreator=t}zoomIn(){var t;const e=document.createElement("span");e.setAttribute("class","tools-icon"),e.setAttribute("style","position: absolute; left: 20px;bottom: 188px;font-size: 22px;cursor: pointer;fill: #6e7b91;");const i=document.createElementNS(Sp,"svg");i.setAttribute("class","tools-icon"),i.setAttribute("width","1em"),i.setAttribute("height","1em"),i.setAttribute("viewBox","0 0 1024 1024");const a=document.createElementNS(Sp,"path"),s=document.createElementNS(Sp,"path");a.setAttribute("p-id","path1"),a.setAttribute("d","M919.264 905.984l-138.912-138.912C851.808 692.32 896 591.328 896 480c0-229.376-186.624-416-416-416S64 250.624 64 480s186.624 416 416 416c95.008 0 182.432-32.384 252.544-86.208l141.44 141.44a31.904 31.904 0 0 0 45.248 0 32 32 0 0 0 0.032-45.248zM128 480C128 285.92 285.92 128 480 128s352 157.92 352 352-157.92 352-352 352S128 674.08 128 480z"),s.setAttribute("p-id","path2"),s.setAttribute("d","M625.792 448H512v-112a32 32 0 0 0-64 0V448h-112a32 32 0 0 0 0 64H448v112a32 32 0 1 0 64 0V512h113.792a32 32 0 1 0 0-64z"),i.append(a,s),e.append(i),i.onclick=()=>{this.baseCreator.setZoomInOrOut(!0)},null===(t=this.wrapper)||void 0===t||t.append(e)}zoomOut(){var t;const e=document.createElement("span");e.setAttribute("class","tools-icon"),e.setAttribute("style","position: absolute; left: 20px;bottom: 146px;font-size: 22px;cursor: pointer;fill: #6e7b91;");const i=document.createElementNS(Sp,"svg");i.setAttribute("width","1em"),i.setAttribute("height","1em"),i.setAttribute("viewBox","0 0 1024 1024");const a=document.createElementNS(Sp,"path"),s=document.createElementNS(Sp,"path");a.setAttribute("d","M919.264 905.984l-138.912-138.912C851.808 692.32 896 591.328 896 480c0-229.376-186.624-416-416-416S64 250.624 64 480s186.624 416 416 416c95.008 0 182.432-32.384 252.544-86.208l141.44 141.44a31.904 31.904 0 0 0 45.248 0 32 32 0 0 0 0.032-45.248zM128 480C128 285.92 285.92 128 480 128s352 157.92 352 352-157.92 352-352 352S128 674.08 128 480z"),s.setAttribute("d","M625.792 448H336a32 32 0 0 0 0 64h289.792a32 32 0 1 0 0-64z"),i.append(a,s),e.append(i),i.onclick=()=>{this.baseCreator.setZoomInOrOut(!1)},null===(t=this.wrapper)||void 0===t||t.append(e)}rotateLeft(){var t;const e=document.createElement("span");e.setAttribute("class","tools-icon"),e.setAttribute("style","position: absolute; left: 20px;bottom: 104px;font-size: 22px;cursor: pointer;fill: #6e7b91;");const i=document.createElementNS(Sp,"svg");i.setAttribute("width","1em"),i.setAttribute("height","1em"),i.setAttribute("viewBox","0 0 1024 1024");const a=document.createElementNS(Sp,"path");a.setAttribute("d","M479.8464 103.68a409.6 409.6 0 1 1-377.1904 394.9568 38.4 38.4 0 1 1 76.8 2.2528 332.8 332.8 0 1 0 80.5376-206.2848l-10.4448 12.7488h121.8048l5.2224 0.3584a38.4 38.4 0 0 1 0 76.1344l-5.2224 0.3072h-204.8l-5.2224-0.3072a38.4 38.4 0 0 1-32.8192-32.8704l-0.3584-5.2224v-204.8l0.3584-5.1712a38.4 38.4 0 0 1 32.8192-32.8704l5.2224-0.3072 5.2224 0.3072a38.4 38.4 0 0 1 32.8192 32.8704l0.3584 5.1712-0.0512 99.9936a408.4224 408.4224 0 0 1 274.944-137.2672z"),i.append(a),e.append(i),i.onclick=()=>{this.baseCreator.setMapRotate(5)},null===(t=this.wrapper)||void 0===t||t.append(e)}rotateRight(){var t;const e=document.createElement("span");e.setAttribute("class","tools-icon"),e.setAttribute("style","position: absolute; left: 20px;bottom: 62px;font-size: 22px;cursor: pointer;fill: #6e7b91;");const i=document.createElementNS(Sp,"svg");i.setAttribute("width","1em"),i.setAttribute("height","1em"),i.setAttribute("viewBox","0 0 1024 1024");const a=document.createElementNS(Sp,"path");a.setAttribute("d","M544.128 103.68a409.6 409.6 0 1 0 377.173333 394.922667 38.4 38.4 0 1 0-76.757333 2.304 332.8 332.8 0 1 1-80.554667-206.293334l10.453334 12.714667-121.813334 0.042667-5.205333 0.341333a38.4 38.4 0 0 0 0 76.117333l5.205333 0.341334h204.8l5.205334-0.341334a38.4 38.4 0 0 0 32.853333-32.853333l0.341333-5.205333v-204.8l-0.341333-5.205334a38.4 38.4 0 0 0-32.853333-32.853333l-5.205334-0.341333-5.205333 0.341333a38.4 38.4 0 0 0-32.853333 32.853333l-0.341334 5.205334 0.085334 99.968a408.405333 408.405333 0 0 0-274.986667-137.258667z"),i.append(a),e.append(i),i.onclick=()=>{this.baseCreator.setMapRotate(-5)},null===(t=this.wrapper)||void 0===t||t.append(e)}centerOn(t){var e;const i=document.createElement("span");i.setAttribute("class","tools-icon"),i.setAttribute("style","position: absolute; left: 20px;bottom: 20px;font-size: 22px;cursor: pointer;fill: #6e7b91;");const a=document.createElementNS(Sp,"svg");a.setAttribute("width","1em"),a.setAttribute("height","1em"),a.setAttribute("viewBox","0 0 1024 1024");const s=document.createElementNS(Sp,"path");s.setAttribute("d","M550.4 104.192V0h-76.8v104.192A409.7024 409.7024 0 0 0 104.192 473.6H0v76.8h104.192a409.7024 409.7024 0 0 0 369.408 369.408V1024h76.8v-104.192a409.7024 409.7024 0 0 0 369.408-369.408H1024v-76.8h-104.192a409.7024 409.7024 0 0 0-369.408-369.408z m-76.8 77.2096V307.2h76.8V181.4016a332.9536 332.9536 0 0 1 292.1984 292.1984H716.8v76.8h125.7984a332.9536 332.9536 0 0 1-292.1984 292.1984V716.8h-76.8v125.7984a332.9536 332.9536 0 0 1-292.1984-292.1984H307.2v-76.8H181.4016A332.9536 332.9536 0 0 1 473.6 181.4016z"),a.append(s),i.append(a),a.onclick=()=>{t&&t()},null===(e=this.wrapper)||void 0===e||e.append(i)}stats(){const t=function(){const t=document.querySelector("body");Kd.showPanel(0);const e=Kd.dom;return e.style.position="fixed",e.style.left="0px",e.style.right="auto",e.style.top="0px",e.setAttribute("class","tools-icon stats-fps-icon"),null!=t&&t.appendChild(e),Kd}();this.baseCreator.canvas.addEventListener("afterrender",()=>null==t?void 0:t.update())}renderer(){}reset(){document.querySelectorAll(".tools-icon").forEach(t=>t.remove())}}class Ip{constructor(t){Object.defineProperty(this,"mapCreator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"toolCreator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"grade",{enumerable:!0,configurable:!0,writable:!0,value:"normal"}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:{width:document.body.clientWidth,height:document.body.clientHeight,id:"std-container",mapData:{},displayItem:["node-map","edge-map","edge-bezier-map","station-map"],displayTools:["zoomIn","zoomOut","rotateLeft","rotateRight","stats"],callbackMap:{}}}),Object.defineProperty(this,"setMapCenter",{enumerable:!0,configurable:!0,writable:!0,value:()=>{let t=0,e=0;for(const i of this.data.node)t+=i.x/Sc,e+=i.y/Sc;const i=this.data.node.length,a=Math.floor(t/i),s=Math.floor(e/i),n=this.mapCreator.canvas.getCamera(),o=(null==n?void 0:n.getPosition())||[0,0,0],r=o[0]-a,l=o[1]-s;null==n||n.pan(-r,-l)}}),this.config=Object.assign(this.config,t),this.data=function(t,e,i,a,s,n,o){const{meta:r={},data:l={}}=t,c=[];null!=l&&null!==(i=l.feature)&&void 0!==i&&i.forEach(t=>{const e=l.station.find(e=>e.id===t.station_id);e&&c.push({id:t.id,name:`b${t.id}`,sx:e["pos.x"]/Sc,sy:-e["pos.y"]/Sc,ex:t["pos.x"]/Cc,ey:-t["pos.y"]/Cc})}),r.resolution=r.resolution||r["resolution:"]||2;const d={x:-r["zero_offset.x"]*r.resolution,y:-r["zero_offset.y"]*r.resolution,width:r["size.x"]*r.resolution,height:r["size.y"]*r.resolution,img:e};return{locationArea:null!==(a=l.locationArea)&&void 0!==a?a:[],feature:l.feature||[],noteArea:null!==(s=l.noteArea)&&void 0!==s?s:[],featureStation:c,unSavedCleanArea:(null===(n=t.private)||void 0===n?void 0:n.cleanArea)||[],lmk:(null==t||null===(o=t.private)||void 0===o?void 0:o.lmk)||[],background:d}}(t.mapData,t.backgroundUrl),this.config.mapData=null,this.mapCreator=new wp(t.id,t),this.toolCreator=new Cp(this.mapCreator,t.id),this.initMap(),this.initMapGrade()}initMap(){var t;this.config.displayItem.forEach(t=>this.setDisplay(t,!0)),null===(t=this.config.displayTools)||void 0===t||t.forEach(t=>this.setTools(t))}setDisplay(t,e){let i=this.mapCreator.globalGroupMap[t]||this.mapCreator.canvas.document.documentElement.getElementById(t);const a={"node-map":()=>this.mapCreator.stageModel.nodeStage.paintList(this.mapCreator.mapModel._nodeDataList),"edge-map":()=>{this.mapCreator.stageModel.lineEdgeStage.paintList(this.mapCreator.mapModel._edgeDataList.filter(t=>t.isEdgeLine())),this.mapCreator.stageModel.bezierEdgeStage.paintList(this.mapCreator.mapModel._edgeDataList.filter(t=>t.isEdgeBezier())),this.mapCreator.stageModel.edgeGroupStage.paintList(this.mapCreator.mapModel._edgeGroupDataList)},"station-map":()=>this.mapCreator.stageModel.stationStage.paintList(this.mapCreator.mapModel._stationDataList),"func-area-map":()=>this.mapCreator.stageModel.funcAreaStage.paintList(this.mapCreator.mapModel._funcAreaDataList),"note-area-map":()=>this.mapCreator.stageModel.noteAreaStage.paintList(this.mapCreator.mapModel._noteAreaDataList),"location-area-map":()=>this.mapCreator.stageModel.locationAreaStage.paintList(this.mapCreator.mapModel._locationAreaDataList),"tag-map":()=>this.mapCreator.stageModel.tagStage.paintList(this.mapCreator.mapModel._tagDataList),"background-img-map":()=>this.mapCreator.gImgMapBackgroundGroupCreator(this.data.background),"dmcode-map":()=>{this.mapCreator.stageModel.dmCodeStage.paintList(this.mapCreator.mapModel._dmCodeDataList)},"feature-map":()=>{this.mapCreator.featureCreator(nd.FEATURE_NORMAL,this.data.feature||[]),this.data.feature=[]},"feature-station-map":()=>{this.mapCreator.featureStationCreator(this.data.featureStation||[]),this.data.featureStation=[]},"unsaved-clean-area-map":()=>{this.mapCreator.areaCreator(this.data.unSavedCleanArea,"unsaved-clean-area-map",jc.CLEAN_AREA),this.data.unSavedCleanArea=[]},"lmk-map":()=>{this.mapCreator.lmkCreator(nd.LMK_NORMAL,this.data.lmk),this.data.lmk=[]}};var s;e?e&&!i?a[t]&&a[t]():e&&i&&(()=>{this.mapCreator.canvas.appendChild(i)})():null===(s=i)||void 0===s||s.remove(),i=null}setTools(t){"centerOn"===t?this.toolCreator.centerOn(this.setMapCenter):this.toolCreator[t]()}initMapGrade(){this.grade="mini"}setMapZoom(){this.mapCreator.setMapZoom(this.grade)}setMapReference(){this.data.background&&this.mapCreator.createMapReference(this.data.background)}reset(){var t,e;null!==(t=this.toolCreator)&&void 0!==t&&t.reset(),null===(e=this.mapCreator)||void 0===e||e.reset()}}}).call(this,a("c8ba"),a("1c35").Buffer)},af6a:function(t,e,i){},b1b8:function(t,e,i){"use strict";var a={name:"FunctionConfigTooltip",props:{configInfo:{type:Object,required:!0,default:()=>({})}}},s=i("2877"),n=i("7cbe"),o=i("1c1c"),r=i("66e5"),l=i("4074"),c=i("eebe"),d=i.n(c),h=Object(s.a)(a,function(){var t=this,e=t._self._c;return e("q-popup-proxy",[e("div",{staticClass:"q-pa-md bg-grey-10 text-white"},[e("q-list",{staticStyle:{width:"35vw"},attrs:{dark:"",bordered:"",dense:"",separator:""}},[e("q-item",[e("q-item-section",{staticClass:"col-4"},[t._v(t._s(t.$t("label.name")))]),e("q-item-section",{staticClass:"col-8"},[t._v(t._s(t.configInfo.name))])],1),e("q-item",[e("q-item-section",{staticClass:"col-4"},[t._v("ID")]),e("q-item-section",{staticClass:"col-8"},[t._v(t._s(t.configInfo.id))])],1),e("q-item",[e("q-item-section",{staticClass:"col-4"},[t._v("key")]),e("q-item-section",{staticClass:"col-8"},[t._v(t._s(t.configInfo.key))])],1),e("q-item",[e("q-item-section",{staticClass:"col-4"},[t._v(t._s(t.$t("label.defaultValue")))]),e("q-item-section",{staticClass:"col-8"},[t._v(t._s(t.configInfo.hmiDefaultValue)+" "+t._s(t.configInfo.hmiValueUnits))])],1),e("q-item",[e("q-item-section",{staticClass:"col-4"},[t._v(t._s(t.$t("label.type")))]),e("q-item-section",{staticClass:"col-8"},[t._v(t._s(t.configInfo.value_type))])],1),e("q-item",[e("q-item-section",{staticClass:"col-4"},[t._v(t._s(t.$t("label.desc")))]),e("q-item-section",{staticClass:"col-8 white-space-pre-line"},[t._v(t._s(t.configInfo.description))])],1),e("q-item",[e("q-item-section",{staticClass:"col-4"},[t._v(t._s(t.$t("text.minimumFirmwareVersion")))]),e("q-item-section",{staticClass:"col-8"},[t._v(t._s(t.configInfo.min_version_requirement))])],1)],1)],1)])},[],!1,null,null,null);e.a=h.exports;d()(h,"components",{QPopupProxy:n.a,QList:o.a,QItem:r.a,QItemSection:l.a})},b5d5:function(t,e,i){},b710:function(t,e,i){"use strict";i.d(e,"a",function(){return a});const a={UPGRADE_RESULT_NONE:0,UPGRADE_RESULT_SUCCESS:1,UPGRADE_RESULT_UNFINISHED_STEP1:11,UPGRADE_RESULT_UNFINISHED_STEP2:12,UPGRADE_RESULT_FAILED_NOT_ONLINE_IGNORED:101,UPGRADE_RESULT_FAILED_VERSION_MATCHED:102,UPGRADE_RESULT_FAILED_VERSION_NOT_SUPPORT:103,UPGRADE_RESULT_FAILED_FILE_NONE:104,UPGRADE_RESULT_FAILED_FILE_ERROR:105,UPGRADE_RESULT_FAILED_MD5_CHECK:106,UPGRADE_RESULT_FAILED_ENTER_IAP_MODE:107,UPGRADE_RESULT_FAILED_TRANSFER_FILE:108,UPGRADE_RESULT_FAILED_START_NEW_APP:109,UPGRADE_RESULT_FAILED_VERSION_NOT_UPDATED:110,UPGRADE_RESULT_FAILED_CAN_HARDWARE_ERROR:111,UPGRADE_RESULT_FAILED_UART_HARDWARE_ERROR:112,UPGRADE_RESULT_FAILED_PMU_BOOTLOADER_NOT_SUPPORTED:113,UPGRADE_RESULT_FAILED_UNKNOWN:201}},bf4c:function(t,e,i){"use strict";var a=i("e4ef"),s=i("b5ae"),n={name:"PinCodeInput",data:()=>({isEditable:!0,isPassword:!0,pinCode1:"",pinCode2:"",pinCode3:"",pinCode4:"",lastPin1:"",lastPin2:"",lastPin3:"",lastPin4:""}),props:{editable:Boolean},validations:{pinCode1:{required:s.required,between:Object(s.between)(0,9)},pinCode2:{required:s.required,between:Object(s.between)(0,9)},pinCode3:{required:s.required,between:Object(s.between)(0,9)},pinCode4:{required:s.required,between:Object(s.between)(0,9)}},computed:{inputType(){return this.isPassword?"password":"text"}},watch:{editable(t,e){t&&(this.pinCode1=this.pinCode2=this.pinCode3=this.pinCode4="",this.setDefaultFocus())}},mounted(){this.editable||(this.pinCode1=this.pinCode2=this.pinCode3=this.pinCode4="1")},methods:{async onPincode1Changed(t){""!==t&&(await Object(a.Q)(100),this.pinCode1=t.replace(this.lastPin1,""),this.lastPin1=this.pinCode1,this.$refs.inputPin2.focus())},async onPincode2Changed(t){""!==t&&(await Object(a.Q)(100),this.pinCode2=t.replace(this.lastPin2,""),this.lastPin2=this.pinCode2,this.$refs.inputPin3.focus())},async onPincode3Changed(t){""!==t&&(await Object(a.Q)(100),this.pinCode3=t.replace(this.lastPin3,""),this.lastPin3=this.pinCode3,this.$refs.inputPin4.focus())},async onPincode4Changed(t){""!==t&&(await Object(a.Q)(100),this.pinCode4=t.replace(this.lastPin4,""),this.lastPin4=this.pinCode4,this.onInputPinCode())},checkInput(){return this.$v.$touch(),!(this.$v.pinCode1.$error||this.$v.pinCode2.$error||this.$v.pinCode3.$error||this.$v.pinCode4.$error)},async setDefaultFocus(){await Object(a.Q)(100),this.$refs.inputPin1.focus()},getInput(){return{pin1:this.pinCode1,pin2:this.pinCode2,pin3:this.pinCode3,pin4:this.pinCode4}},onInputPinCode(){this.checkInput()&&this.$emit("finishInput",this.getInput())}}},o=i("2877"),r=i("27f9"),l=i("0016"),c=i("eebe"),d=i.n(c),h=Object(o.a)(n,function(){var t=this,e=t._self._c;return e("div",{staticClass:"row justify-around"},[e("q-input",{ref:"inputPin1",staticStyle:{width:"48px"},attrs:{"no-pass-toggle":"",type:t.inputType,align:"center",disable:!t.editable,outlined:"",dense:"",error:t.$v.pinCode1.$error},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onInputPinCode.apply(null,arguments)},input:t.onPincode1Changed,blur:t.$v.pinCode1.$touch},model:{value:t.pinCode1,callback:function(e){t.pinCode1=e},expression:"pinCode1"}}),e("q-input",{ref:"inputPin2",staticStyle:{width:"48px"},attrs:{"no-pass-toggle":"",type:t.inputType,align:"center",disable:!t.editable,outlined:"",dense:"",error:t.$v.pinCode2.$error},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onInputPinCode.apply(null,arguments)},input:t.onPincode2Changed,blur:t.$v.pinCode2.$touch},model:{value:t.pinCode2,callback:function(e){t.pinCode2=e},expression:"pinCode2"}}),e("q-input",{ref:"inputPin3",staticStyle:{width:"48px"},attrs:{"no-pass-toggle":"",type:t.inputType,align:"center",disable:!t.editable,outlined:"",dense:"",error:t.$v.pinCode3.$error},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onInputPinCode.apply(null,arguments)},input:t.onPincode3Changed,blur:t.$v.pinCode3.$touch},model:{value:t.pinCode3,callback:function(e){t.pinCode3=e},expression:"pinCode3"}}),e("q-input",{ref:"inputPin4",staticStyle:{width:"92px"},attrs:{"no-pass-toggle":"",type:t.inputType,align:"center",disable:!t.editable,outlined:"",dense:"",error:t.$v.pinCode4.$error},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onInputPinCode.apply(null,arguments)},input:t.onPincode4Changed,blur:t.$v.pinCode4.$touch},scopedSlots:t._u([{key:"after",fn:function(){return[e("q-icon",{staticClass:"cursor-pointer q-ml-md",attrs:{name:t.isPassword?"visibility_off":"visibility"},on:{click:function(e){t.isPassword=!t.isPassword}}})]},proxy:!0}]),model:{value:t.pinCode4,callback:function(e){t.pinCode4=e},expression:"pinCode4"}})],1)},[],!1,null,"6a10ebd1",null);e.a=h.exports;d()(h,"components",{QInput:r.a,QIcon:l.a})},c026:function(t,e,i){"use strict";i("e560")},c37a:function(t,e,i){"use strict";i("14a3")},c3a9:function(t,e,i){"use strict";var a=i("de9c"),s=i("32e0"),n=i("e4ef"),o={name:"InputDialog",components:{HeaderItem:s.a,ChoiceButtons:a.a},data(){return{isMobile:this.$q.platform.is.mobile,opened:!1,title:"",desc:"",type:"",classStyle:"",inputValue:"",callbackReject:null,callbackResolve:null}},methods:{doInput(t){return t.hasOwnProperty("title")?this.title=t.title:this.title="",t.hasOwnProperty("desc")?this.desc=t.desc:this.desc="",t.hasOwnProperty("value")?this.inputValue=t.value:this.inputValue="",t.hasOwnProperty("type")?this.type=t.type:this.type="text",t.hasOwnProperty("class")?this.classStyle=t.class:this.classStyle="popup_style",this.opened=!0,new Promise((t,e)=>{this.callbackResolve=t,this.callbackReject=e})},onClosed:function(){this.opened=!1,this.callbackReject&&this.callbackReject("cancel")},onOkay:function(){if(this.isTypeText()){if(!Object(n.C)(this.inputValue,""))return}else if(""===this.inputValue)return void this.$notify({message:this.$t("text.inputNameIsNull",{name:""}),timeout:3e3,type:"negative",position:"top"});this.opened=!1,this.callbackResolve&&this.callbackResolve(this.inputValue)},isTypeText(){return""===this.type||"text"===this.type}}},r=i("2877"),l=i("24e8"),c=i("f09f"),d=i("27f9"),h=i("eebe"),u=i.n(h),p=Object(r.a)(o,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},on:{"escape-key":t.onClosed},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{class:t.classStyle},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.title},on:{close:t.onClosed}}),""!=t.desc?e("div",{staticClass:"text_main_grey_style q-mt-md"},[t._v(t._s(t.desc))]):t._e(),e("div",{staticClass:"no-scroll q-mt-md"},[e("q-input",{attrs:{autofocus:"",type:t.type,outlined:"",clear:"",dense:"","clear-icon":"close"},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}})],1),e("choice-buttons",{staticClass:"q-mt-xl q-mb-md",attrs:{"enable-okay":!0},on:{okay:t.onOkay,cancel:t.onClosed}})],1)])],1)},[],!1,null,"2266164f",null);e.a=p.exports;u()(p,"components",{QDialog:l.a,QCard:c.a,QInput:d.a})},c405:function(t,e,i){"use strict";i("a16a")},c444:function(t,e,i){},c48b:function(t,e,i){"use strict";var a=i("33aa"),s={name:"ManualControl",props:{disable:Boolean},data:()=>({iconLeft:"std_left_grey",iconUp:"std_up_grey",iconRight:"std_right_grey",iconDown:"std_down_grey"}),methods:{...a.a,onLeftMouseOver(){this.iconLeft="std_left_blue"},onLeftMouseOut(){this.iconLeft="std_left_grey",a.a.onLeftTouchEnd()},onRightMouseOver(){this.iconRight="std_right_blue"},onRightMouseOut(){this.iconRight="std_right_grey",a.a.onRightTouchEnd()},onUpMouseOver(){this.iconUp="std_up_blue"},onUpMouseOut(){this.iconUp="std_up_grey",a.a.onUpTouchEnd()},onDownMouseOver(){this.iconDown="std_down_blue"},onDownMouseOut(){this.iconDown="std_down_grey",a.a.onDownTouchEnd()}}},n=(i("1278"),i("2877")),o=i("f09f"),r=i("9c40"),l=i("0016"),c=i("eebe"),d=i.n(c),h=Object(n.a)(s,function(){var t=this,e=t._self._c;return e("div",{staticClass:"row"},[e("q-card",{staticClass:"no-shadow",staticStyle:{"border-radius":"24px",width:"128px",height:"128px"}},[e("div",{staticClass:"row"},[e("div",{staticClass:"column justify-center"},[e("q-btn",{staticClass:"no-border",attrs:{outline:"",round:"","no-caps":"",unelevated:"",color:"transparent",disable:t.disable},on:{mouseover:t.onLeftMouseOver,mouseout:t.onLeftMouseOut},nativeOn:{touchstart:function(e){return t.onLeftTouchStart.apply(null,arguments)},touchend:function(e){return t.onLeftTouchEnd.apply(null,arguments)},touchcancel:function(e){return t.onLeftTouchCancel.apply(null,arguments)},mousedown:function(e){return t.onLeftTouchStart.apply(null,arguments)},mouseup:function(e){return t.onLeftTouchEnd.apply(null,arguments)}}},[e("q-icon",{class:t.iconLeft+" icon_size_20"})],1)],1),e("div",{staticClass:"column"},[e("q-btn",{staticClass:"no-border",attrs:{outline:"",round:"","no-caps":"",unelevated:"",color:"transparent",disable:t.disable},on:{mouseover:t.onUpMouseOver,mouseout:t.onUpMouseOut},nativeOn:{touchstart:function(e){return t.onUpTouchStart.apply(null,arguments)},touchend:function(e){return t.onUpTouchEnd.apply(null,arguments)},touchcancel:function(e){return t.onUpTouchCancel.apply(null,arguments)},mousedown:function(e){return t.onUpTouchStart.apply(null,arguments)},mouseup:function(e){return t.onUpTouchEnd.apply(null,arguments)}}},[e("q-icon",{class:t.iconUp+" icon_size_20x11"})],1),e("q-btn",{staticStyle:{visibility:"hidden"},attrs:{"no-caps":"",unelevated:"",id:"btn-center",round:"",color:"primary"}},[e("q-icon",{staticClass:"icon_size_20"})],1),e("q-btn",{staticClass:"no-border",attrs:{outline:"",round:"","no-caps":"",unelevated:"",color:"transparent",disable:t.disable},on:{mouseover:t.onDownMouseOver,mouseout:t.onDownMouseOut},nativeOn:{touchstart:function(e){return t.onDownTouchStart.apply(null,arguments)},touchend:function(e){return t.onDownTouchEnd.apply(null,arguments)},touchcancel:function(e){return t.onDownTouchCancel.apply(null,arguments)},mousedown:function(e){return t.onDownTouchStart.apply(null,arguments)},mouseup:function(e){return t.onDownTouchEnd.apply(null,arguments)}}},[e("q-icon",{class:t.iconDown+" icon_size_20x11"})],1)],1),e("div",{staticClass:"column justify-center"},[e("q-btn",{staticClass:"no-border",attrs:{outline:"",round:"","no-caps":"",unelevated:"",color:"transparent",disable:t.disable},on:{mouseover:t.onRightMouseOver,mouseout:t.onRightMouseOut},nativeOn:{touchstart:function(e){return t.onRightTouchStart.apply(null,arguments)},touchend:function(e){return t.onRightTouchEnd.apply(null,arguments)},touchcancel:function(e){return t.onRightTouchCancel.apply(null,arguments)},mousedown:function(e){return t.onRightTouchStart.apply(null,arguments)},mouseup:function(e){return t.onRightTouchEnd.apply(null,arguments)}}},[e("q-icon",{class:t.iconRight+" icon_size_20"})],1)],1)])])],1)},[],!1,null,"1355f693",null);e.a=h.exports;d()(h,"components",{QCard:o.a,QBtn:r.a,QIcon:l.a})},c4c4:function(t,e,i){"use strict";var a=i("b69e"),s={name:"ControlButtons",data(){return{isMobile:this.$q.platform.is.mobile,iconZoomIn:"std_zoom_in_grey",iconZoomOut:"std_zoom_out_grey",iconRotateLeft:"std_rotate_left_grey",iconRotateRight:"std_rotate_right_grey",iconCenterRobot:"std_center_robot_grey",iconClearLocus:"std_brush_grey"}},computed:{},methods:{onZoomInOver(){this.iconZoomIn="std_zoom_in_blue"},onZoomInOut(){this.iconZoomIn="std_zoom_in_grey"},onZoomIn(){this.$emit("click",a.e.EVENT_ZOOM_IN)},onZoomoutOver(){this.iconZoomOut="std_zoom_out_blue"},onZoomoutOut(){this.iconZoomOut="std_zoom_out_grey"},onZoomout(){this.$emit("click",a.e.EVENT_ZOOM_OUT)},onRotateLeftOver(){this.iconRotateLeft="std_rotate_left_blue"},onRotateLeftOut(){this.iconRotateLeft="std_rotate_left_grey"},onRotateLeft(){this.$emit("click",a.e.EVENT_ROTATE_LEFT)},onRotateRightOver(){this.iconRotateRight="std_rotate_right_blue"},onRotateRightOut(){this.iconRotateRight="std_rotate_right_grey"},onRotateRight(){this.$emit("click",a.e.EVENT_ROTATE_RIGHT)},onCenterRobotOver(){this.iconCenterRobot="std_center_robot_blue"},onCenterRobotOut(){this.iconCenterRobot="std_center_robot_grey"},onCenterRobot(){this.$emit("click",a.e.EVENT_CENTER_ROBOT)},onClearLocusOver(){this.iconClearLocus="std_brush_blue"},onClearLocusOut(){this.iconClearLocus="std_brush_grey"},clearRobotLocus(){this.$emit("click",a.e.EVENT_CLEAR_LOCUS)}}},n=(i("c37a"),i("2877")),o=i("9c40"),r=i("0016"),l=i("05c0"),c=i("eebe"),d=i.n(c),h=Object(n.a)(s,function(){var t=this,e=t._self._c;return e("div",{staticClass:"flex row justify-center",staticStyle:{background:"rgba(248, 248, 248, 0)",width:"48px"}},[e("q-btn",{attrs:{flat:"",round:"","no-caps":"",unelevated:"",color:"primary"},on:{mouseover:t.onZoomInOver,mouseout:t.onZoomInOut,click:t.onZoomIn}},[e("q-icon",{class:t.iconZoomIn+" icon_size_36"}),t.isMobile?t._e():e("q-tooltip",[t._v(t._s(t.$t("button.zoomIn")))])],1),e("q-btn",{staticClass:"q-mt-sm",attrs:{flat:"",round:"","no-caps":"",unelevated:"",color:"primary"},on:{mouseover:t.onZoomoutOver,mouseout:t.onZoomoutOut,click:t.onZoomout}},[e("q-icon",{class:t.iconZoomOut+" icon_size_36"}),t.isMobile?t._e():e("q-tooltip",[t._v(t._s(t.$t("button.zoomOut")))])],1),e("q-btn",{staticClass:"q-mt-sm",attrs:{flat:"",round:"","no-caps":"",unelevated:"",color:"primary","repeat-timeout":50},on:{mouseover:t.onRotateLeftOver,mouseout:t.onRotateLeftOut,click:t.onRotateLeft}},[e("q-icon",{class:t.iconRotateLeft+" icon_size_36"}),t.isMobile?t._e():e("q-tooltip",[t._v(t._s(t.$t("button.rotateLeft")))])],1),e("q-btn",{staticClass:"q-mt-sm",attrs:{flat:"",round:"","no-caps":"",unelevated:"",color:"primary","repeat-timeout":50},on:{mouseover:t.onRotateRightOver,mouseout:t.onRotateRightOut,click:t.onRotateRight}},[e("q-icon",{class:t.iconRotateRight+" icon_size_36"}),t.isMobile?t._e():e("q-tooltip",[t._v(t._s(t.$t("button.rotateRight")))])],1),e("q-btn",{staticClass:"q-mt-sm",attrs:{flat:"",round:"","no-caps":"",unelevated:"",color:"primary"},on:{mouseover:t.onCenterRobotOver,mouseout:t.onCenterRobotOut,click:t.onCenterRobot}},[e("q-icon",{class:t.iconCenterRobot+" icon_size_36"}),t.isMobile?t._e():e("q-tooltip",[t._v(t._s(t.$t("button.centerRobot")))])],1),e("q-btn",{staticClass:"q-mt-sm",attrs:{flat:"",round:"","no-caps":"",unelevated:"",color:"primary"},on:{mouseover:t.onClearLocusOver,mouseout:t.onClearLocusOut,click:t.clearRobotLocus}},[e("q-icon",{class:t.iconClearLocus+" icon_size_36"}),t.isMobile?t._e():e("q-tooltip",[t._v(t._s(t.$t("button.clearLocus")))])],1)],1)},[],!1,null,"62ba1bac",null);e.a=h.exports;d()(h,"components",{QBtn:o.a,QIcon:r.a,QTooltip:l.a})},c64e:function(t,e,i){"use strict";var a=i("c02f"),s=i("f226"),n=i("4360"),o=i("2b0e"),r=i("8847");e.a={start:async(t,e,i)=>{let n=await Object(a.g)(e);if(Object(a.b)()||Object(a.f)()||Object(a.c)()||Object(a.a)()||!Object(a.d)(t)||!Object(a.e)()||!n)return n;try{s.d.startMission(e,i).then(()=>{o.default.prototype.$notify({message:r.b.t("text.sendSucceed"),timeout:3e3,type:"positive",position:"top"}),n=!0}).catch(t=>{o.default.prototype.$notify({message:r.b.t("text.failStartMission")+t.message,timeout:3e3,type:"negative",position:"top"}),n=!1})}catch(t){o.default.prototype.$notify({message:r.b.t("text.sendFailed"),timeout:3e3,type:"negative",position:"top"}),n=!1}return n},pause:()=>s.d.pauseMovement(),continueMission:()=>{if(!(!Object(a.e)()||Object(a.b)()||Object(a.f)()||Object(a.a)()||Object(a.c)()))return n.a.getters["srp/isMissionPaused"]||n.a.getters["srp/isMissionRunning"]&&n.a.getters["srp/isMovementPaused"]?s.d.continueMovement():s.d.continueMission()},stop:t=>s.d.cancelMission(t),reorderMissions:async function(t){try{await s.d.reorderMission(t)}catch(t){o.default.prototype.$notify({message:r.b.t("text.failReorderMission")+t.message,timeout:3e3,type:"negative",position:"top"})}}}},ca45:function(t,e,i){"use strict";i("af6a")},cc0f:function(t,e,i){"use strict";i("910d"),i("a732");var a=i("2f62"),s=i("b69e"),n=i("e4ef"),o=i("b5ae"),r=i("32e0"),l=i("de9c"),c={name:"AddOrSelectProperty",components:{ChoiceButtons:l.a,HeaderItem:r.a},data:()=>({opened:!1,model:null,operateType:0,operateOptions:[]}),computed:{...Object(a.f)(["mapItemUserDefinedProperties"]),allOperateList(){return this.mapItemUserDefinedProperties.filter(t=>0===t.type||1===t.type)}},methods:{onClosed(){this.opened=!1},onSaved(){""!==this.model.name&&""!==this.model.value&&(this.opened=!1,this.$emit("add",this.model))},filterFn(t,e){e(""!==t?()=>{const e=t.toLowerCase();this.operateOptions=this.allOperateList.filter(t=>t.label.toLowerCase().indexOf(e)>-1),1===this.operateOptions.length&&(this.operateType=this.operateOptions[0].value)}:()=>{this.operateOptions=this.allOperateList})},setOptionIndex(t=0){this.operateType=t},setInputKeyValue(t){let e=this.operateOptions.filter(e=>e.value===t)[0];this.model.name=e.key,this.model.value=e.keyVal}},watch:{opened(t,e){t&&(this.operateOptions=[],this.$nextTick(()=>{this.operateOptions=this.allOperateList,this.setOptionIndex(0),"modify"===this.model.type&&(this.model.name=this.model.sourceProperty.name,this.model.value=this.model.sourceProperty.value)}))},operateType(t,e){this.setInputKeyValue(t)}}},d=i("2877"),h=i("24e8"),u=i("f09f"),p=i("1c1c"),m=i("66e5"),f=i("4074"),g=i("ddd8"),_=i("27f9"),y=i("eebe"),v=i.n(y),b=Object(d.a)(c,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"popup_style"},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.$t("button.newAdd")},on:{close:t.onClosed}})],1),null!=t.model?e("div",[e("q-list",{staticClass:"q-mt-xs",attrs:{"no-border":""}},[e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.select"))+"\n              ")]),e("q-select",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{outlined:"",dense:"",autofocus:"","use-input":"","hide-selected":"","fill-input":"","emit-value":"","map-options":"",options:t.operateOptions,"input-class":"text-right"},on:{filter:t.filterFn,setOptionIndex:t.setOptionIndex},model:{value:t.operateType,callback:function(e){t.operateType=e},expression:"operateType"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.name"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",disable:0!==t.operateType,"input-class":"text-right"},model:{value:t.model.name,callback:function(e){t.$set(t.model,"name","string"==typeof e?e.trim():e)},expression:"model.name"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.value"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"","input-class":"text-right"},model:{value:t.model.value,callback:function(e){t.$set(t.model,"value","string"==typeof e?e.trim():e)},expression:"model.value"}})],1)])],1)],1),e("div",{staticClass:"q-my-md q-mr-md float-right"},[e("ChoiceButtons",{attrs:{"label-okay":t.$t("button.save")},on:{okay:t.onSaved,cancel:t.onClosed}})],1)],1):t._e()])],1)},[],!1,null,"c9912eec",null),E=b.exports;v()(b,"components",{QDialog:h.a,QCard:u.a,QList:p.a,QItem:m.a,QItemSection:f.a,QSelect:g.a,QInput:_.a});var A={name:"StationEditor",components:{ChoiceButtons:l.a,HeaderItem:r.a,AddProperty:E},props:{wareroomAreas:{type:Array,default:()=>[]},wareroomRegions:{type:Array,default:()=>[]}},data(){return{opened:!1,model:{wareroomAreaId:0,wareroomRegionId:0,wareroomLocationRow:0,wareroomLocationColumn:0,wareroomLocationStorey:0},stationId:0,stationItems:null,userDefineProperties:[],selectedProperty:[],pagination:{rowsPerPage:30},stationOptions:[{label:this.$t("label.default"),value:s.e.STATION_TYPE_DEFAULT},{label:this.$t("label.chargeStation"),value:s.e.STATION_TYPE_CHARGE},{label:this.$t("label.dockStation"),value:s.e.STATION_TYPE_DOCK},{label:this.$t("label.workStation"),value:s.e.STATION_TYPE_WORK},{label:this.$t("label.wareroomStation"),value:s.e.STATION_TYPE_WAREROOM},{label:this.$t("label.avoidStation"),value:s.e.STATION_TYPE_AVOID},{label:this.$t("label.rackStation"),value:s.e.STATION_TYPE_RACK},{label:this.$t("label.userDefined"),value:s.e.STATION_TYPE_USER_DEFINE}],columns:[{name:"name",label:this.$t("label.name"),field:"name",required:!0,align:"center",sortable:!1},{name:"value",label:this.$t("label.value"),field:"value",required:!0,align:"center",sortable:!1}]}},validations:{newStationId:{required:o.required,integer:o.integer,minValue:Object(o.minValue)(1)},stationName:{required:o.required,maxLength:Object(o.maxLength)(n.k)}},computed:{...Object(a.f)(["allowMaxStationId"]),isHomePage(){return"/homePage"===this.$route.path},stationAngle:{get:function(){return null==this.model?0:parseFloat(Object(s.h)(this.model["pos.yaw"]).toFixed(2))},set:function(t){this.model["pos.yaw"]=Object(s.b)(t)}},newStationId:{get:function(){return null==this.model||void 0===this.model?0:this.model.id},set:function(t){var e;if(null==this.model||void 0===this.model)return;const i=(null===(e=this.model)||void 0===e?void 0:e.id)||0;t<1?(this.$notify({message:this.$t("text.invalidInput"),timeout:3e3,type:"negative",position:"top"}),t=i):t>this.allowMaxStationId&&(this.$notify({message:this.$t("text.stationIDTooLarge",{id:t,maxValue:this.allowMaxStationId}),timeout:3e3,type:"negative",position:"top"}),t=i),this.model.id=t}},pgvOffsetAngle:{get:function(){return null==this.model?0:parseFloat(Object(s.h)(this.model["pgv_offset.yaw"]).toFixed(2))},set:function(t){this.model["pgv_offset.yaw"]=Object(s.b)(t)}},stationName:{get:function(){return this.model.name},set:function(t){this.model.name=t}},stationPosX:{get:function(){return null==this.model?0:this.model["pos.x"]},set:function(t){let e={};e.x=t-this.model["pos.x"],e.y=0,this.updatePoints(e),this.model["pos.x"]=t,e=null}},stationPosY:{get:function(){return null==this.model?0:this.model["pos.y"]},set:function(t){let e={x:0};e.y=t-this.model["pos.y"],this.updatePoints(e),e=null,this.model["pos.y"]=t}},isStationTypeWareroom(){return this.model.type===s.e.STATION_TYPE_WAREROOM},wareroomAreaOptions:()=>[],wareroomRegionOptions:()=>[],wareroomAreaIdPage:{get:function(){return null==this.model?0:this.model.wareroomAreaId},set:function(t){this.model.wareroomAreaId=t,this.model.wareroomRegionId=0}}},watch:{opened(t,e){if(t){this.stationId=this.model.id;let t=this.model.user_define_properties;this.userDefineProperties=[];for(let e in t)this.userDefineProperties.push({name:e,value:t[e]});document.addEventListener("keydown",this.onKeyDown)}else document.removeEventListener("keydown",this.onKeyDown)}},methods:{updatePoints:function(t){0===this.model["enter_pos.x"]&&0===this.model["enter_pos.y"]||(this.model["enter_pos.x"]+=t.x,this.model["enter_pos.y"]+=t.y),0===this.model["exit_pos.x"]&&0===this.model["exit_pos.y"]||(this.model["exit_pos.x"]+=t.x,this.model["exit_pos.y"]+=t.y),0===this.model["check_pos.x"]&&0===this.model["check_pos.y"]||(this.model["check_pos.x"]+=t.x,this.model["check_pos.y"]+=t.y)},onAddProperty(t){if(!0===this.$refs.addPropertyDlg.opened)return;let e=t.name,i=t.value,a=t.sourceProperty.name,s=t.sourceProperty.value;if(e!==a||i!==s)if("add"===t.type)null===this.getProperty(e)?this.doAddProperty({name:e,value:t.value}):this.$notify({message:this.$t("text.userDefinedPropertyHasExist",{name:e}),timeout:3e3,type:"warning",position:"top"});else if("modify"===t.type)if(this.userDefineProperties.some(t=>t.name===e&&t.name!==a))this.$notify({message:this.$t("text.userDefinedPropertyHasExist",{name:e}),timeout:3e3,type:"warning",position:"top"}),this.$refs.addPropertyDlg.opened=!0;else for(let t=0,s=this.userDefineProperties.length;t<s;t++){let s=this.userDefineProperties[t];if(s.name===a){s.name=e,s.value=i;break}}},getProperty(t){for(let e of Array.from(this.userDefineProperties))if(e.name===t)return e;return null},doAddProperty(t){this.userDefineProperties.push(t)},isDefaultStationName(){return this.stationName===this.$t("label.station")+this.model.id},checkStationName(){if(this.$v.$touch(),this.$v.stationName.$invalid)this.$notify({message:this.$t("text.inputNameIsNull",{name:this.$t("label.stationName")}),timeout:3e3,type:"negative",position:"top"});else if(Object(n.C)(this.stationName,this.$t("label.stationName"))){if(this.isHomePage)return this.$parent.checkStationForEditor({type:1,oldId:this.stationId,newId:this.model.id,name:this.stationName,wareroomObj:{}});if(null==this.stationItems)return!0;for(let t of Array.from(this.stationItems))if(t.getID()!==this.stationId){if(t.getID()===this.model.id)return this.$notify({message:this.$t("text.stationIDHasExist"),timeout:3e3,type:"negative",position:"top"}),!1;if(t.getName()===this.stationName)return this.$notify({message:this.$t("text.stationNameHasExist"),timeout:3e3,type:"negative",position:"top"}),!1}return!0}},checkStationWareroom(){let t=!0;return this.isStationTypeWareroom&&(this.model.wareroomAreaId>0&&this.model.wareroomRegionId>0&&this.model.wareroomLocationRow>0&&this.model.wareroomLocationColumn>0&&this.model.wareroomLocationStorey>0?t=this.checkStationWareroomNotSame():(this.$notify({message:this.$t("text.pleaseInputWareroomInformation"),timeout:3e3,type:"negative",position:"top"}),t=!1)),t},checkStationWareroomNotSame(){if(this.isHomePage)return this.$parent.checkStationForEditor({type:2,oldId:this.stationId,newId:this.model.id,name:this.stationName,wareroomObj:{wareroomAreaId:this.model.wareroomAreaId,wareroomRegionId:this.model.wareroomRegionId,wareroomLocationRow:this.model.wareroomLocationRow,wareroomLocationColumn:this.model.wareroomLocationColumn}});for(let t of Array.from(this.stationItems)){let e=t.getID(),i=t.getStationWareroom(),a=t.isStationTypeWareroom();if(e!==this.stationId&&a&&i.wareroomAreaId===this.model.wareroomAreaId&&i.wareroomRegionId===this.model.wareroomRegionId&&i.wareroomLocationRow===this.model.wareroomLocationRow&&i.wareroomLocationColumn===this.model.wareroomLocationColumn)return this.$notify({message:this.$t("text.duplicatesWareroomInformation",{id:e}),timeout:3e3,type:"negative",position:"top"}),!1}return!0},modifyUserDefineProperty(t,e={}){this.$refs.addPropertyDlg.model={name:e.name,value:e.value,type:"modify",sourceProperty:e},this.$refs.addPropertyDlg.opened=!0},onAddUserDefinedProperty(){this.$refs.addPropertyDlg.model={name:"",value:"",type:"add",sourceProperty:{name:"",value:""}},this.$refs.addPropertyDlg.opened=!0},onDeleteProperty(){for(let t of Array.from(this.selectedProperty))this.doDeleteProperty(t.name);this.selectedProperty=[]},doDeleteProperty(t){let e=-1;for(let i=0;i<this.userDefineProperties.length;i++)if(t===this.userDefineProperties[i].name){e=i;break}e>=0&&this.userDefineProperties.splice(e,1)},onClosed:function(){!0!==this.$refs.addPropertyDlg.opened&&(this.opened=!1)},onKeyDown(t){"s"===t.key&&t.ctrlKey&&(t.stopPropagation(),t.preventDefault(),this.onSaved())},onSaved:function(){if(!Object(n.C)(this.model.id,this.$t("label.station")+this.$t("label.ID")))return;if(!this.checkStationName()||!this.checkStationWareroom())return;if(this.newStationId>this.allowMaxStationId)return void this.$notify({message:this.$t("text.stationIDTooLarge",{id:this.newStationId,maxValue:o.maxValue}),timeout:3e3,type:"negative",position:"top"});this.isDefaultStationName()||(this.model.name=this.stationName);let t={};for(let e of Array.from(this.userDefineProperties))t[e.name]=e.value;this.model.user_define_properties=t,this.$emit("updateModel",this.stationId,this.model),this.onClosed()}}},w=i("2c91"),S=i("9564"),C=i("eaac"),I=i("9c40"),x=Object(d.a)(A,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticStyle:{width:"480px"}},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.$t("label.editStation")},on:{close:t.onClosed}})],1),null!=t.model?e("div",[e("q-list",{staticClass:"q-mt-xs scroll q-mr-md",staticStyle:{"max-height":"600px"},attrs:{"no-border":""}},[e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.stationId"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right",error:t.$v.newStationId.$error},on:{blur:t.$v.newStationId.$touch},model:{value:t.newStationId,callback:function(e){t.newStationId=t._n(e)},expression:"newStationId"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.stationName"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"text","input-class":"text-right",error:t.$v.stationName.$error},on:{blur:t.$v.stationName.$touch},model:{value:t.stationName,callback:function(e){t.stationName=e},expression:"stationName"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.stationType"))+"\n              ")]),e("q-select",{staticClass:"col-sm-8 col-md-8 col-lg-8",attrs:{options:t.stationOptions,outlined:"",dense:"","emit-value":"","map-options":"",dir:"rtl"},model:{value:t.model.type,callback:function(e){t.$set(t.model,"type",e)},expression:"model.type"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.typeValue"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"",disable:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.model.type,callback:function(e){t.$set(t.model,"type",t._n(e))},expression:"model.type"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.belongToEdge"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"",disable:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.model.edge_id,callback:function(e){t.$set(t.model,"edge_id",t._n(e))},expression:"model.edge_id"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.node"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"",disable:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.model.node_id,callback:function(e){t.$set(t.model,"node_id",t._n(e))},expression:"model.node_id"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.station")+"x(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.stationPosX,callback:function(e){t.stationPosX=t._n(e)},expression:"stationPosX"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.station")+"y(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.stationPosY,callback:function(e){t.stationPosY=t._n(e)},expression:"stationPosY"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.angle")+"(Â°)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.stationAngle,callback:function(e){t.stationAngle=t._n(e)},expression:"stationAngle"}})],1)])],1),t.isStationTypeWareroom?[e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                  "+t._s(t.$t("label.wareroomStationArea"))+"\n                ")]),e("q-select",{staticClass:"col-sm-8 col-md-8 col-lg-8",attrs:{options:t.wareroomAreas,"option-value":"id","option-label":"name",outlined:"",dense:"","emit-value":"","map-options":"",dir:"rtl"},model:{value:t.wareroomAreaIdPage,callback:function(e){t.wareroomAreaIdPage=e},expression:"wareroomAreaIdPage"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                  "+t._s(t.$t("label.wareroomStationRegion"))+"\n                ")]),e("q-select",{staticClass:"col-sm-8 col-md-8 col-lg-8",attrs:{options:t.wareroomRegions.filter(e=>e.wareroomAreaId===t.model.wareroomAreaId),"option-value":"id","option-label":"name",outlined:"",dense:"","emit-value":"","map-options":"",dir:"rtl"},model:{value:t.model.wareroomRegionId,callback:function(e){t.$set(t.model,"wareroomRegionId",e)},expression:"model.wareroomRegionId"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                  "+t._s(t.$t("label.wareroomStationRow"))+"\n                ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",min:0,"input-class":"text-right"},model:{value:t.model.wareroomLocationRow,callback:function(e){t.$set(t.model,"wareroomLocationRow",t._n(e))},expression:"model.wareroomLocationRow"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                  "+t._s(t.$t("label.wareroomStationColumn"))+"\n                ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",min:1,"input-class":"text-right"},model:{value:t.model.wareroomLocationColumn,callback:function(e){t.$set(t.model,"wareroomLocationColumn",t._n(e))},expression:"model.wareroomLocationColumn"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                  "+t._s(t.$t("label.wareroomStationStorey"))+"\n                ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",min:0,"input-class":"text-right"},model:{value:t.model.wareroomLocationStorey,callback:function(e){t.$set(t.model,"wareroomLocationStorey",t._n(e))},expression:"model.wareroomLocationStorey"}})],1)])],1)]:t._e(),e("q-item",{staticClass:"hidden"},[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.bridgeStation"))+"\n              ")]),e("q-space"),e("q-toggle",{attrs:{color:"primary"},model:{value:t.model.no_rotate,callback:function(e){t.$set(t.model,"no_rotate",e)},expression:"model.no_rotate"}})],1)])],1),t.model.no_rotate?e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.enterPos")+"x(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"",disable:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.model["enter_pos.x"],callback:function(e){t.$set(t.model,"enter_pos.x",t._n(e))},expression:"model['enter_pos.x']"}})],1)])],1):t._e(),t.model.no_rotate?e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.enterPos")+"y(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"",disable:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.model["enter_pos.y"],callback:function(e){t.$set(t.model,"enter_pos.y",t._n(e))},expression:"model['enter_pos.y']"}})],1)])],1):t._e(),t.model.no_rotate?e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.exitPos")+"x(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"",disable:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.model["exit_pos.x"],callback:function(e){t.$set(t.model,"exit_pos.x",t._n(e))},expression:"model['exit_pos.x']"}})],1)])],1):t._e(),t.model.no_rotate?e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.exitPos")+"y(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"",disable:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.model["exit_pos.y"],callback:function(e){t.$set(t.model,"exit_pos.y",t._n(e))},expression:"model['exit_pos.y']"}})],1)])],1):t._e(),e("q-item",[e("q-item-section",[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.barcode"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"","input-class":"text-right"},model:{value:t.model.dmcode_id,callback:function(e){t.$set(t.model,"dmcode_id",e)},expression:"model['dmcode_id']"}})],1)])],1),t.model.dmcode_id?[e("q-item",[e("q-item-section",[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                  "+t._s(t.$t("label.pgvOffset")+"x(cm)")+"\n                ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.model["pgv_offset.x"],callback:function(e){t.$set(t.model,"pgv_offset.x",t._n(e))},expression:"model['pgv_offset.x']"}})],1)])],1),e("q-item",[e("q-item-section",[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                  "+t._s(t.$t("label.pgvOffset")+"y(cm)")+"\n                ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.model["pgv_offset.y"],callback:function(e){t.$set(t.model,"pgv_offset.y",t._n(e))},expression:"model['pgv_offset.y']"}})],1)])],1),e("q-item",[e("q-item-section",[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                  "+t._s(t.$t("label.pgvOffset")+"(Â°)")+"\n                ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.pgvOffsetAngle,callback:function(e){t.pgvOffsetAngle=t._n(e)},expression:"pgvOffsetAngle"}})],1)])],1)]:t._e(),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.remark"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",staticStyle:{"max-height":"64px"},attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"textarea"},model:{value:t.model.desc,callback:function(e){t.$set(t.model,"desc",e)},expression:"model.desc"}})],1)])],1),e("q-item",[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-4"},[t._v("\n              "+t._s(t.$t("label.userDefinedProperty"))+"\n            ")]),e("div",{staticClass:"col-6"},[e("q-table",{staticClass:"no-shadow q-mt-md border_passive_style",staticStyle:{width:"280px"},attrs:{dense:"","hide-bottom":"",columns:t.columns,data:t.userDefineProperties,"row-key":"name",color:"primary",separator:"cell","table-class":"no-scroll text_main_grey_style",pagination:t.pagination,selection:"multiple",selected:t.selectedProperty},on:{"row-dblclick":t.modifyUserDefineProperty,"update:pagination":function(e){t.pagination=e},"update:selected":function(e){t.selectedProperty=e}}}),e("div",{staticClass:"flex justify-end q-mt-md"},[e("q-btn",{staticClass:"no-shadow q-ml-lg q-mt-md",staticStyle:{height:"32px"},attrs:{outline:"",unelevated:"","no-caps":"",label:t.$t("button.newAdd"),color:"primary",size:"sm"},on:{click:t.onAddUserDefinedProperty}}),e("q-btn",{staticClass:"background_red no-shadow q-ml-lg q-mt-md text_main_white_style",staticStyle:{height:"32px"},attrs:{"no-caps":"",unelevated:"",label:t.$t("button.delete"),size:"sm",disable:t.selectedProperty.length<=0},on:{click:t.onDeleteProperty}})],1)],1)])])],2),e("div",{staticClass:"q-my-md q-mr-md float-right"},[e("choice-buttons",{attrs:{"label-okay":t.$t("button.save")},on:{okay:t.onSaved,cancel:t.onClosed}})],1)],1):t._e()]),e("add-property",{ref:"addPropertyDlg",on:{add:t.onAddProperty}})],1)},[],!1,null,"28715b12",null);e.a=x.exports;v()(x,"components",{QDialog:h.a,QCard:u.a,QList:p.a,QItem:m.a,QItemSection:f.a,QInput:_.a,QSelect:g.a,QSpace:w.a,QToggle:S.a,QTable:C.a,QBtn:I.a})},ccc9:function(t,e,i){"use strict";i("206e")},d5bc:function(t,e,i){"use strict";var a=i("32e0"),s={name:"MessageDialog",components:{ChoiceButtons:i("de9c").a,HeaderItem:a.a},data:()=>({opened:!1,title:"",desc:"",texts:[],chooseButton:!1,okayTxt:"",callbackReject:null,callbackResolve:null}),methods:{doShowMessage(t){return this.title=t.title,this.desc=t.message,this.texts=t.texts||[],this.chooseButton=!1,t.hasOwnProperty("okayTxt")&&(this.okayTxt=t.okayTxt),t.hasOwnProperty("chooseButton")&&(this.chooseButton=t.chooseButton),this.opened=!0,new Promise((t,e)=>{this.callbackResolve=t,this.callbackReject=e})},onOkay(){this.callbackResolve&&(this.callbackResolve("accept"),this.callbackResolve=null,this.callbackReject=null),this.opened=!1,this.texts=[]},onCancel(){this.callbackReject&&(this.callbackReject("cancel"),this.callbackResolve=null,this.callbackReject=null),this.opened=!1,this.texts=[]}}},n=i("2877"),o=i("24e8"),r=i("f09f"),l=i("a370"),c=i("9c40"),d=i("eebe"),h=i.n(d),u=Object(n.a)(s,function(){var t=this,e=t._self._c;return e("q-dialog",{ref:"messageDialogCurRef",attrs:{"no-backdrop-dismiss":""},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"default_dialog_style"},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.title},on:{close:t.onCancel}}),e("q-card-section",{staticClass:"scroll",staticStyle:{"max-height":"50vh"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:""!=t.desc,expression:"desc != ''"}],staticClass:"text_main_grey_style q-mt-md white-space-pre-line"},[t._v("\n          "+t._s(t.desc)+"\n        ")]),t._l(t.texts,function(i,a){return e("div",{key:a,staticClass:"text_main_grey_style"},[e("p",[t._v(t._s(i.title))]),e("p",{staticClass:"q-pl-md white-space-pre-line"},[t._v(t._s(i.description))])])})],2)],1),e("div",{staticClass:"q-mx-md q-mb-md q-mt-lg text-right"},[e("choice-buttons",{directives:[{name:"show",rawName:"v-show",value:t.chooseButton,expression:"chooseButton"}],attrs:{"label-okay":t.okayTxt},on:{okay:t.onOkay,cancel:t.onCancel}}),e("q-btn",{directives:[{name:"show",rawName:"v-show",value:!t.chooseButton,expression:"!chooseButton"}],staticClass:"no-shadow",staticStyle:{width:"120px",height:"28px"},attrs:{"no-caps":"",unelevated:"",size:"sm",color:"primary"},on:{click:t.onOkay}},[t._v("\n        "+t._s(this.$t("label.IKnown"))+"\n      ")])],1)])],1)},[],!1,null,"7c846df0",null);e.a=u.exports;h()(u,"components",{QDialog:o.a,QCard:r.a,QCardSection:l.a,QBtn:c.a})},d6b9:function(t,e,i){"use strict";i("ad5a")},d6c6:function(t,e,i){"use strict";var a=i("de9c"),s={name:"QuestionDialog",components:{HeaderItem:i("32e0").a,ChoiceButtons:a.a},data(){return{isOpened:this.opened,title:"",desc:"",labelOkay:"",labelCancel:"",callbackReject:null,callbackResolve:null}},mounted(){},methods:{doAsk(t){return this.title=t.title,this.desc=t.question,t.hasOwnProperty("labelOkay")?this.labelOkay=t.labelOkay:this.labelOkay="",t.hasOwnProperty("labelCancel")?this.labelCancel=t.labelCancel:this.labelCancel="",this.isOpened=!0,new Promise((t,e)=>{this.callbackResolve=t,this.callbackReject=e})},onOkay(){this.isOpened=!1,this.callbackResolve&&this.callbackResolve(!0)},ignore(){this.isOpened=!1,this.callbackReject&&this.callbackReject(!1)},onCancel(t){t?(this.isOpened=!1,this.callbackReject&&this.callbackReject(!0)):this.ignore()}}},n=i("2877"),o=i("24e8"),r=i("f09f"),l=i("eebe"),c=i.n(l),d=Object(n.a)(s,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},on:{"escape-key":t.ignore},model:{value:t.isOpened,callback:function(e){t.isOpened=e},expression:"isOpened"}},[e("q-card",{staticClass:"popup_style q-pb-md"},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.title},on:{close:t.ignore}}),""!=t.desc?e("div",{staticClass:"text_small_grey_style q-mt-md"},[t._v(t._s(t.desc))]):t._e(),e("choice-buttons",{staticClass:"q-mt-lg",attrs:{"enable-okay":!0,"label-okay":t.labelOkay,"label-cancel":t.labelCancel},on:{okay:t.onOkay,cancel:t.onCancel}})],1)])],1)},[],!1,null,"7032dec8",null);e.a=d.exports;c()(d,"components",{QDialog:o.a,QCard:r.a})},d7f1:function(t,e,i){"use strict";var a=i("b5ae"),s=i("de9c"),n=i("32e0"),o={name:"SetCoordinate",components:{ChoiceButtons:s.a,HeaderItem:n.a},data:()=>({opened:!1,deltaX:10,deltaY:10}),validations:{deltaX:{required:a.required},deltaY:{required:a.required}},computed:{isInputIllegal(){return this.$v.$touch(),this.$v.deltaX.$error||this.$v.deltaY.$error}},methods:{onOkay(){this.$emit("setcoordinate",{x:parseFloat(this.deltaX),y:-parseFloat(this.deltaY)}),this.opened=!1},onClosed(){this.opened=!1}}},r=i("2877"),l=i("24e8"),c=i("f09f"),d=i("27f9"),h=i("eebe"),u=i.n(h),p=Object(r.a)(o,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticStyle:{width:"480px"}},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.$t("label.setOffset")},on:{close:t.onClosed}})],1),e("div",{staticClass:"full-width q-pa-md"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n          "+t._s(t.$t("label.coordinateOffset",{type:"x"})+"/cm")+"\n        ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.deltaX,callback:function(e){t.deltaX=t._n(e)},expression:"deltaX"}})],1),e("div",{staticClass:"row full-width q-mt-sm"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n          "+t._s(t.$t("label.coordinateOffset",{type:"y"})+"/cm")+"\n        ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.deltaY,callback:function(e){t.deltaY=t._n(e)},expression:"deltaY"}})],1),e("div",{staticClass:"q-my-md float-right"},[e("choice-buttons",{attrs:{"label-okay":t.$t("button.save"),"enable-okay":!t.isInputIllegal},on:{okay:t.onOkay,cancel:t.onClosed}})],1)])])],1)},[],!1,null,"7c6599f8",null);e.a=p.exports;u()(p,"components",{QDialog:l.a,QCard:c.a,QInput:d.a})},dc96:function(t,e,i){"use strict";var a=i("2f62"),s=i("6821"),n=i.n(s),o=i("bf4c"),r=i("b5ae"),l=i("a39b"),c={name:"ReAuthDialog",data:()=>({opened:!1,userName:"",password:"",loading:!1,isPassword:!0,selectedTab:"tabAccount",callbackResolve:null}),components:{PinCodeInput:o.a},computed:{...Object(a.f)("srp",["account"]),isTabAccount(){return"tabAccount"===this.selectedTab},isDisabled(){return this.isTabAccount?!this.userName||!this.password:!this.pincode}},validations:{password:{required:r.required},userName:{required:r.required}},watch:{selectedTab(t,e){this.changedTab(t)}},methods:{async changedTab(){this.$nextTick(()=>{this.isTabAccount?this.$refs.refPassword.focus():this.$refs.inputPincode.setDefaultFocus()})},handleCheck(){this.isTabAccount?this.accountLogin():this.pincodeLogin()},accountLogin(){this.fakeLogin(this.userName,this.password)},async pincodeLogin(){if(!this.$refs.inputPincode.checkInput())return void this.$notify({message:this.$t("text.illegalPincode"),timeout:3e3,type:"negative",position:"top"});const t=this.$refs.inputPincode.getInput(),e=""+t.pin1+t.pin2+t.pin3+t.pin4;this.loading=!0;const i=await Object(l.x)("pincode",e||"");this.loading=!1,i?this.fakeLogin(i.username,i.passwd):this.$notify({message:this.$t("text.errorPincode"),timeout:3e3,type:"negative",position:"top"})},fakeLogin(t="",e=""){var i,a;t===(null===(i=this.account)||void 0===i?void 0:i.username)&&n()(e)===(null===(a=this.account)||void 0===a?void 0:a.passwd)?this.onOkay():this.$notify({message:this.isTabAccount?this.$t("text.accountPasswordError"):this.$t("text.errorPincode"),timeout:3e3,type:"negative",position:"top"})},onClosed(){var t;this.opened=!1,null===(t=this.callbackResolve)||void 0===t||t.call(this,!1)},onOkay(){var t;this.opened=!1,null===(t=this.callbackResolve)||void 0===t||t.call(this,!0)},async initData(){var t;const e=this.$q.sessionStorage.getItem("stdAccountAuthenticateTimestamp");return!!(e&&Date.now()-e<=12e5)||(this.password=this.$debug?"_sr_dev_":"",this.userName=(null===(t=this.account)||void 0===t?void 0:t.username)||"",this.opened=!0,new Promise(t=>{this.callbackResolve=t}))}}},d=(i("0103"),i("2877")),h=i("24e8"),u=i("f09f"),p=i("a370"),m=i("2c91"),f=i("9c40"),g=i("eb85"),_=i("429b"),y=i("7460"),v=i("adad"),b=i("823b"),E=i("27f9"),A=i("0016"),w=i("4b7e"),S=i("74f7"),C=i("d9b2"),I=i("7f67"),x=i("eebe"),T=i.n(x),M=Object(d.a)(c,function(){var t=this,e=t._self._c;return e("q-dialog",{on:{"escape-key":t.onClosed},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticClass:"box-dialog-card box-dialog-authenticate column"},[e("q-card-section",{staticClass:"row items-center q-pb-none"},[e("div",{staticClass:"text-h6"},[t._v("\n        "+t._s(t.$t("label.accountAuthenticate"))+"\n      ")]),e("q-space"),e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),e("q-separator"),e("q-card-section",{staticClass:"flex-1 auth-card-container q-pa-xl"},[e("q-tabs",{staticClass:"no-scroll bg-grey-1 text-grey-9",attrs:{animated:"","no-caps":"","narrow-indicator":"","active-bg-color":"white","active-color":"blue",align:"center"},model:{value:t.selectedTab,callback:function(e){t.selectedTab=e},expression:"selectedTab"}},[e("q-tab",{attrs:{"no-caps":"",default:"",name:"tabAccount"}},[e("div",{staticStyle:{"font-size":"14px"}},[t._v(t._s(t.$t("label.accountLogin")))])]),e("q-tab",{attrs:{name:"tabPincode"}},[e("div",{staticStyle:{"font-size":"14px"}},[t._v(t._s(t.$t("label.pincode")))])])],1),e("q-tab-panels",{attrs:{dense:"","indicator-color":"",animated:""},model:{value:t.selectedTab,callback:function(e){t.selectedTab=e},expression:"selectedTab"}},[e("q-tab-panel",{staticStyle:{margin:"0px",padding:"0px"},attrs:{name:"tabAccount"}},[e("div",{staticClass:"q-mt-lg q-ml-xl q-mr-xl"},[e("div",{staticClass:"group"},[e("label",{staticClass:"text-grey-5"},[t._v(t._s(t.$t("label.username")))]),e("q-input",{staticClass:"q-mt-sm",attrs:{outlined:"",dense:"","float-label":t.$t("label.username"),error:t.$v.userName.$error,placeholder:t.$t("text.inputUserName")},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.accountLogin.apply(null,arguments)},blur:t.$v.userName.$touch},scopedSlots:t._u([{key:"prepend",fn:function(){return[e("q-icon",{staticClass:"std_icon_user q-mr-sm"})]},proxy:!0}]),model:{value:t.userName,callback:function(e){t.userName="string"==typeof e?e.trim():e},expression:"userName"}})],1),e("div",{staticClass:"group q-mt-md"},[e("label",{staticClass:"text-grey-5"},[t._v(t._s(t.$t("label.password")))]),e("q-input",{ref:"refPassword",staticClass:"q-mt-sm",attrs:{outlined:"",dense:"",type:t.isPassword?"password":"text",error:t.$v.password.$error,placeholder:t.$t("text.inputPassword")},on:{blur:t.$v.password.$touch,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.accountLogin.apply(null,arguments)}},scopedSlots:t._u([{key:"prepend",fn:function(){return[e("q-icon",{staticClass:"std_icon_pwd q-mr-sm"})]},proxy:!0},{key:"append",fn:function(){return[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:t.isPassword?"visibility_off":"visibility"},on:{click:function(e){t.isPassword=!t.isPassword}}})]},proxy:!0}]),model:{value:t.password,callback:function(e){t.password="string"==typeof e?e.trim():e},expression:"password"}})],1)])]),e("q-tab-panel",{staticStyle:{margin:"0px",padding:"0px"},attrs:{name:"tabPincode"}},[e("div",{staticClass:"q-mt-xl q-ml-xl q-mr-xl"},[e("div",{staticClass:"group"},[e("pin-code-input",{ref:"inputPincode",attrs:{editable:!0},on:{finishInput:t.pincodeLogin}})],1)])])],1),e("div",{staticClass:"bg-white q-pa-xl text-caption"},[t._v(t._s(t.$t("text.accountAuthenticateTip")))])],1),e("q-separator"),e("q-card-actions",{attrs:{align:"right"}},[e("q-btn",{attrs:{flat:"",label:t.$t("label.cancel")},on:{click:t.onClosed}}),e("q-btn",{attrs:{flat:"",label:t.$t("button.ok"),color:"primary"},on:{click:t.handleCheck}})],1),e("q-inner-loading",{attrs:{showing:t.loading}},[e("q-spinner-ios",{staticClass:"fixed-center",attrs:{size:"50px",color:"primary"}})],1)],1)],1)},[],!1,null,null,null);e.a=M.exports;T()(M,"components",{QDialog:h.a,QCard:u.a,QCardSection:p.a,QSpace:m.a,QBtn:f.a,QSeparator:g.a,QTabs:_.a,QTab:y.a,QTabPanels:v.a,QTabPanel:b.a,QInput:E.a,QIcon:A.a,QCardActions:w.a,QInnerLoading:S.a,QSpinnerIos:C.a}),T()(M,"directives",{ClosePopup:I.a})},dcfa:function(t,e,i){"use strict";var a=i("32e0"),s={name:"NodeEditor",components:{ChoiceButtons:i("de9c").a,HeaderItem:a.a},data:()=>({opened:!1,model:null}),watch:{opened(t,e){t?document.addEventListener("keydown",this.onKeyDown):document.removeEventListener("keydown",this.onKeyDown)}},methods:{onClosed:function(){this.opened=!1},onKeyDown(t){"s"===t.key&&t.ctrlKey&&(t.stopPropagation(),t.preventDefault(),this.onSaved())},onSaved:function(){this.$emit("updateModel",this.model),this.onClosed()}}},n=i("2877"),o=i("24e8"),r=i("f09f"),l=i("1c1c"),c=i("66e5"),d=i("4074"),h=i("27f9"),u=i("eebe"),p=i.n(u),m=Object(n.a)(s,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticStyle:{width:"480px"}},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.$t("label.editNode")},on:{close:t.onClosed}})],1),null!=t.model?e("div",[e("q-list",{staticClass:"q-mt-xs",attrs:{"no-border":""}},[e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.nodeId"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right",disable:""},model:{value:t.model.id,callback:function(e){t.$set(t.model,"id",t._n(e))},expression:"model.id"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.coordinate")+"x(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.model.x,callback:function(e){t.$set(t.model,"x",t._n(e))},expression:"model.x"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.coordinate")+"y(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.model.y,callback:function(e){t.$set(t.model,"y",t._n(e))},expression:"model.y"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.remark"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",staticStyle:{"max-height":"64px"},attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"textarea"},model:{value:t.model.desc,callback:function(e){t.$set(t.model,"desc",e)},expression:"model.desc"}})],1)])],1)],1),e("div",{staticClass:"q-my-md q-mr-md float-right"},[e("choice-buttons",{attrs:{"label-okay":t.$t("button.save")},on:{okay:t.onSaved,cancel:t.onClosed}})],1)],1):t._e()])],1)},[],!1,null,"3acf1c3c",null);e.a=m.exports;p()(m,"components",{QDialog:o.a,QCard:r.a,QList:l.a,QItem:c.a,QItemSection:d.a,QInput:h.a})},de9c:function(t,e,i){"use strict";var a={name:"ChoiceButtons",data:()=>({}),props:{enableOkay:{type:Boolean,default:!0},labelCancel:{type:String,default:""},labelOkay:{type:String,default:""}},mounted(){document.addEventListener("keydown",this.onKeyDown)},beforeDestroy(){document.removeEventListener("keydown",this.onKeyDown)},methods:{onOkay(){this.enableOkay&&this.$emit("okay")},onCancel(){this.$emit("cancel",!0)},onKeyDown(t){t.stopPropagation();const{key:e="",ctrlKey:i=!1}=t,a="Enter"===e;a||"s"===e&&i?(a&&t.preventDefault(),this.onOkay()):"Escape"===e&&this.$emit("cancel",!1)}}},s=i("2877"),n=i("9c40"),o=i("eebe"),r=i.n(o),l=Object(s.a)(a,function(){var t=this,e=t._self._c;return e("div",{staticClass:"full-width flex justify-center"},[e("q-btn",{staticClass:"border_passive_style no-shadow",staticStyle:{width:"140px",height:"32px"},attrs:{color:"transparent",size:"10px",outline:"","no-caps":"",unelevated:""},on:{click:t.onCancel}},[e("div",{staticClass:"text_small_grey_style"},[t._v("\n      "+t._s(""===t.labelCancel?this.$t("button.cancel"):t.labelCancel)+"\n    ")])]),e("q-btn",{staticClass:"q-ml-sm text_small_grey_style no-shadow",staticStyle:{width:"140px",height:"32px"},attrs:{"no-caps":"",unelevated:"",color:"primary",disable:!t.enableOkay},on:{click:t.onOkay}},[t._v("\n    "+t._s(""===t.labelOkay?this.$t("button.ok"):t.labelOkay)+"\n  ")])],1)},[],!1,null,"7eaf55d0",null);e.a=l.exports;r()(l,"components",{QBtn:n.a})},e1c3:function(t,e,i){"use strict";i("f330")},e287:function(t,e,i){"use strict";i("1144")},e46e:function(t,e,i){},e560:function(t,e,i){},e9ef:function(t,e,i){"use strict";i("910d"),i("a732");var a=i("2f62"),s=i("1712"),n=i("f226"),o=i("32e0"),r={name:"BarcodeEditor",components:{ChoiceButtons:i("de9c").a,HeaderItem:o.a},props:{stations:{type:Array,required:!0}},data:()=>({opened:!1,currentDeviceId:"",stationListOptions:[],stationId:0}),computed:{...Object(a.f)(["isConnected","pgvInfoState","dmcodeCameraParamList"]),...Object(a.d)("srp",["curBarCodeInfo","stationNo"]),currentDmcodeId(){return this.isConnected?this.curBarCodeInfo.pgvId:""},currentDmcodePoseStr(){if(!this.isConnected)return"";const t=this.curBarCodeInfo;return`x, y, yaw: ${Math.round(10*t.x)/10}cm, ${Math.round(10*t.y)/10}cm, ${Math.round(10*t.angle)/10}Â°`},enableOkay(){return!!(this.currentDeviceId&&this.stationId&&this.currentDmcodeId)}},methods:{...Object(a.e)(["setPGVInfoState"]),init(t=0){this.stationId=t;var e,i;this.dmcodeCameraParamList.some(({device_id:t})=>t===this.currentDeviceId)&&this.currentDeviceId||(this.currentDeviceId=null!==(e=null===(i=this.dmcodeCameraParamList[0])||void 0===i?void 0:i.device_id)&&void 0!==e?e:"");!this.currentDeviceId||this.pgvInfoState.state&&this.pgvInfoState.deviceId===this.currentDeviceId||this.toggleDMCodeCamera({state:!0,deviceId:this.currentDeviceId}),this.opened=!0},onClosed:function(){this.opened=!1,this.stationId=0,this.currentDeviceId&&this.toggleDMCodeCamera({state:!1,deviceId:this.currentDeviceId})},onSaved:function(){this.$emit("updateModel",{...this.curBarCodeInfo,stationId:this.stationId}),this.onClosed()},async toggleDMCodeCamera(t){this.pgvInfoState.state&&await Object(s.a)(n.d.enableCameraDebug({...this.pgvInfoState,state:!1})),await Object(s.a)(n.d.enableCameraDebug(t)),this.setPGVInfoState(t)},filterFn(t,e){""!==t?(e(()=>{const e=t.toLowerCase();this.stationListOptions=this.stations.filter(t=>t.label.toLowerCase().indexOf(e)>-1)}),1===this.stationListOptions.length&&(this.stationId=this.stationListOptions[0].id)):e(()=>{this.stationListOptions=this.stations})}}},l=i("2877"),c=i("24e8"),d=i("f09f"),h=i("1c1c"),u=i("66e5"),p=i("4074"),m=i("ddd8"),f=i("27f9"),g=i("eebe"),_=i.n(g),y=Object(l.a)(r,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticStyle:{width:"480px"}},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.$t("label.editBarcode")},on:{close:t.onClosed}})],1),e("div",[e("q-list",{staticClass:"q-mt-xs scroll",staticStyle:{"max-height":"600px"},attrs:{"no-no-border":""}},[e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-4"},[t._v("\n                "+t._s(t.$t("label.select")+t.$t("label.dataSource"))+"\n              ")]),e("q-select",{staticClass:"col-8",attrs:{options:t.dmcodeCameraParamList,"option-value":"device_id","option-label":"device_name",outlined:"",dense:"","emit-value":"","map-options":"","use-input":"","hide-selected":"","fill-input":""},on:{input:function(e){return t.toggleDMCodeCamera({state:!0,deviceId:t.currentDeviceId})}},model:{value:t.currentDeviceId,callback:function(e){t.currentDeviceId=e},expression:"currentDeviceId"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.barcode"))+"\n              ")])])])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4 q-pl-sm"},[t._v("\n                "+t._s(t.$t("label.ID"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",disable:""},model:{value:t.currentDmcodeId,callback:function(e){t.currentDmcodeId=e},expression:"currentDmcodeId"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4 q-pl-sm"},[t._v("\n                "+t._s(t.$t("label.currentPGV"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",disable:""},model:{value:t.currentDmcodePoseStr,callback:function(e){t.currentDmcodePoseStr=e},expression:"currentDmcodePoseStr"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-4"},[t._v("\n                "+t._s(t.$t("label.associate",{name:t.$t("label.station")}))+"\n              ")]),e("q-select",{staticClass:"col-8",attrs:{options:t.stationListOptions,"option-value":"id",outlined:"",dense:"","emit-value":"","map-options":"","use-input":"","hide-selected":"","fill-input":""},on:{filter:t.filterFn},model:{value:t.stationId,callback:function(e){t.stationId=e},expression:"stationId"}})],1)])],1)],1),e("div",{staticClass:"q-my-md q-mr-md float-right"},[e("choice-buttons",{attrs:{enableOkay:t.enableOkay,"label-okay":t.$t("button.save")},on:{okay:t.onSaved,cancel:t.onClosed}})],1)],1)])],1)},[],!1,null,"5cac7663",null);e.a=y.exports;_()(y,"components",{QDialog:c.a,QCard:d.a,QList:h.a,QItem:u.a,QItemSection:p.a,QSelect:m.a,QInput:f.a})},e9fa:function(t,e,i){"use strict";i("f09c")},eb21:function(t,e,i){"use strict";i("910d"),i("ab43");var a=i("2f62"),s=i("1712"),n=i("f226"),o=i("b69e"),r={name:"BarcodeEditor",components:{CheckboxList:i("7a6b").a},props:{otherSwitchItems:{type:Array,required:!0}},data:()=>({}),computed:{...Object(a.f)(["pgvInfoState","dmcodeCameraParamList"]),otherSwitchLevelUpItems(){return this.otherSwitchItems.filter(t=>0===t.level)},otherSwitchLevelDownItems(){return this.otherSwitchItems.filter(t=>2===t.level)},dmcodeCameraParamFeatureList(){return this.dmcodeCameraParamList.map(({device_name:t,device_id:e})=>{const i=this.pgvInfoState.deviceId===e&&this.pgvInfoState.state;return{key:o.e.KEY_PGV_DEBUG,layer:"",name:t,value:e,state:i,level:1}})}},methods:{...Object(a.e)(["setPGVInfoState"]),onSwitchStateChanged(t){this.$emit("change",t)},async toggleDMCodeCamera(t){const{state:e,deviceId:i}=this.pgvInfoState;e&&await Object(s.a)(n.d.enableCameraDebug({deviceId:i,state:!1}));const a={deviceId:t.value,state:t.state};a.deviceId===i&&a.state===e||await Object(s.a)(n.d.enableCameraDebug(a)),this.setPGVInfoState(a)}}},l=i("2877"),c=i("1c1c"),d=i("66e5"),h=i("4074"),u=i("8f8e"),p=i("0170"),m=i("eebe"),f=i.n(m),g=Object(l.a)(r,function(){var t=this,e=t._self._c;return e("div",[e("CheckboxList",{attrs:{"checkbox-items":t.otherSwitchLevelUpItems},on:{change:t.onSwitchStateChanged}}),e("q-list",{staticStyle:{width:"238px"}},[e("q-item",{staticClass:"row",staticStyle:{height:"36px"}},[e("q-item-section",{staticClass:"col-3"},[e("q-checkbox",{attrs:{disable:""},model:{value:t.pgvInfoState.state,callback:function(e){t.$set(t.pgvInfoState,"state",e)},expression:"pgvInfoState.state"}})],1),e("q-item-section",{staticClass:"col-7"},[e("q-item-label",{staticClass:"text_main_grey_style text-right"},[t._v("\n          "+t._s(t.$t("label.showPGVInfo"))+"\n        ")])],1)],1)],1),e("CheckboxList",{attrs:{"checkbox-items":t.dmcodeCameraParamFeatureList},on:{change:t.toggleDMCodeCamera}}),e("CheckboxList",{attrs:{"checkbox-items":t.otherSwitchLevelDownItems},on:{change:t.onSwitchStateChanged}})],1)},[],!1,null,"202ed71f",null);e.a=g.exports;f()(g,"components",{QList:c.a,QItem:d.a,QItemSection:h.a,QCheckbox:u.a,QItemLabel:p.a})},f09c:function(t,e,i){},f1c2:function(t,e,i){"use strict";i("910d"),i("f665"),i("7d54"),i("ab43"),i("a732");var a=i("2b0e"),s=i("2222"),n=i("e2ae"),o=i.n(n);class r{constructor(){this.radius=24,this.threshold=24,this.lastPos={x:0,y:0},this.diffSumX=0,this.diffSumY=0,this.heatmapInstance=null}initialize(t){return this.heatmapInstance=o.a.create({container:t,radius:this.radius,maxOpacity:1,minOpacity:0,blur:.85,xField:"x",yField:"y",valueField:"value",gradient:{.25:"rgb(0,0,255)",.5:"rgb(0,255,0)",.7:"yellow",1:"rgb(255,0,0)"}}),this.heatmapInstance.setDataMin(0),this.heatmapInstance.setDataMax(100),this.heatmapInstance._store.setDataMax=function(t){return this},this.heatmapInstance._store.setDataMin=function(t){return this},this.heatmapInstance}addData(t){if(!this._isOutOfThreshold(t))return;let e=this._getContainedNearestData(t.x,t.y);null!==e&&this._removeData(e.x,e.y),this.lastPos=t,this.heatmapInstance.addData(t),this.repaint()}setData(t){this.heatmapInstance.setData({min:0,max:100,data:t})}getValueAt(t,e){return this.heatmapInstance.getValueAt({x:t,y:e})}getData(){return this.heatmapInstance.getData()}getStore(){return this.heatmapInstance._store}scale(t){}resetDiffSum(){this.diffSumX=0,this.diffSumY=0}move(t,e){this.updateAllDat(t,e),this.lastPos.x=this.lastPos.x+t,this.lastPos.y=this.lastPos.y+e}clear(){this.lastPos={x:0,y:0},this.setData([])}repaint(){this.heatmapInstance.repaint()}updateAllDat(t,e){let i=this.getStore()._data;var a=Object.keys(i),s=a.length;let n=[];this.diffSumX+=t-Math.round(t),this.diffSumY+=e-Math.round(e);let o=parseInt(this.diffSumX),r=parseInt(this.diffSumY);for(Math.abs(o)>=3?this.diffSumX-=o:o=0,Math.abs(r)>=3?this.diffSumY-=r:r=0;s--;)for(var l=a[s],c=Object.keys(i[l]),d=c.length;d--;){var h=c[d];let a=i[l][h];n.push({x:parseInt(l)+Math.round(t)+o,y:parseInt(h)+Math.round(e)+r,value:a})}this.setData(n)}containsAnyData(t,e){let i=this.getStore()._data;for(var a=Object.keys(i),s=a.length;s--;)for(var n=a[s],o=Object.keys(i[n]),r=o.length;r--;){var l=o[r];if(this._calculateDistance({x:t,y:e},{x:n,y:l})<=this.threshold)return!0}return!1}_getContainedNearestData(t,e){let i=this.getStore()._data;var a=Object.keys(i),s=a.length;let n=-1,o=-1,r=this.threshold+1;for(;s--;)for(var l=a[s],c=Object.keys(i[l]),d=c.length;d--;){var h=c[d];let i=this._calculateDistance({x:t,y:e},{x:l,y:h});i<=this.threshold&&i<r&&(r=i,n=l,o=h)}return r>=this.threshold+1?null:{x:n,y:o}}_removeData(t,e){delete this.getStore()._data[t][e]}_calculateDistance(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}_isOutOfThreshold(t){return this._calculateDistance(t,this.lastPos)>this.threshold+1}}var l=i("abc6"),c=i("b69e"),d=i("adb7"),h=i("ae4a"),u=i("ca95"),p=i.n(u),m=i("2f62"),f=i("e4ef"),g=i("ec26"),_=i("cc0f"),y=i("dcfa"),v=i("a574"),b=i("fbec"),E=i("9523"),A=i.n(E),w=i("f2b3");class S{constructor(t){this._id=0,this._itemType=t,this._desc="",this._isDirty=!1}getID(){return this._id}setID(t){this._id=t}itemType(){return this._itemType}setDirty(t){this._isDirty=t}isDirty(){return this._isDirty}fromJson(t,e=!0){}toJson(t=!0){return""}getName(){return""}isNodeModel(){return this._itemType===c.e.MODEL_TYPE_NODE}isStationModel(){return this._itemType===c.e.MODEL_TYPE_STATION}isEdgeModel(){return this._itemType===c.e.MODEL_TYPE_EDGE}isFuncAreaModel(){return this._itemType===c.e.MODEL_TYPE_FUNC_AREA}isRedrawAreaModel(){return this._itemType===c.e.MODEL_TYPE_REDRAW_AREA}isCleanArea(){return this._itemType===c.e.MODEL_TYPE_CLEAN_AREA}isNoteAreaModel(){return this._itemType===c.e.MODEL_TYPE_NOTE_AREA}isLocationAreaModel(){return this._itemType===c.e.MODEL_TYPE_LOCATION_AREA}isBarcodeModel(){return this._itemType===c.e.MODEL_TYPE_BARCODE}isGroupModel(){return this._itemType===c.e.MODEL_TYPE_EDGE_GROUP}}class C{constructor(t,e,i){this._x=t,this._y=e,this._yaw=i}setPos(t,e,i){this._x=t,this._y=e,this._yaw=i}}class I extends S{constructor(t){super(t),this._name="",this._pa=new C(0,0,0),this._pb=new C(0,0,0),this._pc=new C(0,0,0),this._pd=new C(0,0,0)}fromJson(t,e=!0){var i,a;const s=e?.1:1;this._id=t.id,this._name=null!==(i=t.name)&&void 0!==i?i:"",this._desc=null!==(a=t.desc)&&void 0!==a?a:"",this._pa._x=Object(c.x)(t["pa.x"]*s),this._pa._y=Object(c.x)(t["pa.y"]*s),this._pb._x=Object(c.x)(t["pb.x"]*s),this._pb._y=Object(c.x)(t["pb.y"]*s),this._pc._x=Object(c.x)(t["pc.x"]*s),this._pc._y=Object(c.x)(t["pc.y"]*s),this._pd._x=Object(c.x)(t["pd.x"]*s),this._pd._y=Object(c.x)(t["pd.y"]*s)}toJson(t=!0){const e={},i=t?10:1;return e.id=this._id,e.name=this._name,e.desc=this._desc,e["pa.x"]=Object(c.x)(this._pa._x*i),e["pa.y"]=Object(c.x)(this._pa._y*i),e["pb.x"]=Object(c.x)(this._pb._x*i),e["pb.y"]=Object(c.x)(this._pb._y*i),e["pc.x"]=Object(c.x)(this._pc._x*i),e["pc.y"]=Object(c.x)(this._pc._y*i),e["pd.x"]=Object(c.x)(this._pd._x*i),e["pd.y"]=Object(c.x)(this._pd._y*i),e}getName(){return this._name}setPa(t,e){this._pa._x=t,this._pa._y=e}setPc(t,e){this._pc._x=t,this._pc._y=e}setPb(t,e){this._pb._x=t,this._pb._y=e}setPd(t,e){this._pd._x=t,this._pd._y=e}checkPos(){return{name:this._name,id:this._id,state:this._pa._x<this._pc._x&&this._pa._y>this._pc._y}}checkRectPaKeepAwayPc(){return Math.sqrt((this._pa._x-this._pc._x)**2+(this._pa._y-this._pc._y)**2)>=10}}class x extends I{constructor(t){super(t),this._newborn=!1}fromJson(t,e=!0){var i;super.fromJson(t,e),this._newborn=null!==(i=t.newborn)&&void 0!==i&&i}toJson(t=!0){const e=super.toJson(t);return e.newborn=this._newborn,e}get isNewborn(){return this._newborn}setNewborn(t=!1){this._newborn=t}}class T extends I{constructor(t){super(t),this._style={...d.l.style}}fromJson(t,e=!0){var i;super.fromJson(t,e),this._style={...this._style,...null!==(i=t.style)&&void 0!==i?i:{}}}toJson(t=!0){const e=super.toJson(t);return e.style={...this._style},e}}class M extends I{constructor(t){super(t),this._type=d.i.type,this._key_text="REGION"}fromJson(t,e=!0){var i;super.fromJson(t,e),this._type=t.type,this._key_text=null!==(i=t.key_text)&&void 0!==i?i:"REGION"}toJson(t=!0){const e=super.toJson(t);return e.type=this._type,e.key_text=this._key_text,e}get isLocationAreaNormalModel(){return"REGION"===this._key_text}}i("1e70"),i("1e5a"),i("72c3");class P extends I{constructor(t){super(t),this._type=c.e.AREA_TYPE_USER_DEFINE,this._area_group=[],this._z=100,this._user_defined_params=[],this._enter_station=0,this._exit_station=0,this._is_play_music=!0,this._is_broadcast=!1,this._param_int=0,this._volume=-1,this._user_define_properties={},this._oba_define_params={area_scene_type:c.a.CUSTOMIZE},this._rotate_yaw=Object(c.j)(3),this._limit_cars_number=0,this._limit_speeds={unload:0,load:0,rack:0,unload_unit:"m/s",load_unit:"m/s",rack_unit:"m/s"},this._light_params={trigger_state:0},this._io_oba_params={trigger_state:0,unload:0,load:0,rack:0,addresses:"",signal:0},this._camera_params={enable_camera_down:0}}fromJson(t,e=!0){super.fromJson(t,e);const i=e?.001:1;if(this._type=t.type,this._enter_station=t.enter_station,this._exit_station=t.exit_station,this._is_play_music=t.is_play_music,this._is_broadcast=t.is_broadcast,this._param_int=t.param_int,t.hasOwnProperty("area_group")&&(this._area_group=[...new Set(t.area_group)]),t.hasOwnProperty("user_defined_params")&&(this._user_defined_params=t.user_defined_params),t.hasOwnProperty("z")&&(this._z=t.z),t.hasOwnProperty("desc")&&(this._desc=t.desc),this._type===c.e.AREA_TYPE_DISABLE_ROTATE?(this._param_int=this._param_int*i,this._rotate_yaw=this._param_int):t.hasOwnProperty("rotate_yaw")&&(this._rotate_yaw=t.rotate_yaw),t.hasOwnProperty("volume")&&(this._volume=t.volume),t.hasOwnProperty("user_define_properties")&&(this._user_define_properties=t.user_define_properties),t.hasOwnProperty("oba_define_params")&&(this._oba_define_params={area_scene_type:c.a.CUSTOMIZE,...t.oba_define_params}),t.hasOwnProperty("limit_speeds")){const{unload:e=0,load:i=0,rack:a=0}=t.limit_speeds;this._limit_speeds={...this._limit_speeds,unload:e,load:i,rack:a,unload_unit:"m/s",load_unit:"m/s",rack_unit:"m/s"}}const a=t.hasOwnProperty("limit_cars_number");this._type===c.e.AREA_TYPE_LIMIT_CAR_NUMBER||!a&&this._type===c.e.AREA_TYPE_USER_DEFINE&&this._area_group.includes(c.e.AREA_TYPE_LIMIT_CAR_NUMBER)?this._limit_cars_number=this._param_int:a&&(this._limit_cars_number=t.limit_cars_number),t.hasOwnProperty("light_params")&&(this._light_params={...t.light_params}),t.hasOwnProperty("io_oba_params")&&(this._io_oba_params={...t.io_oba_params}),t.hasOwnProperty("camera_params")&&(this._camera_params={...t.camera_params})}toJson(t=!0){const e=super.toJson(t),i=t?1e3:1;if(e.type=this._type,!this.isFuncAreaModel())return e;e.enter_station=this._enter_station,e.exit_station=this._exit_station,e.is_play_music=this._is_play_music,e.is_broadcast=this._is_broadcast,e.area_group=this._area_group,e.user_defined_params=this._user_defined_params,e.z=this._z,e.param_int=this._param_int,this._type===c.e.AREA_TYPE_DISABLE_ROTATE&&(e.param_int=this._param_int*i),e.volume=this._volume,e.user_define_properties={...this._user_define_properties},e.oba_define_params={...this._oba_define_params};const{unload:a=0,load:s=0,rack:n=0}=this._limit_speeds;return e.limit_speeds={unload:a,load:s,rack:n,unload_unit:"m/s",load_unit:"m/s",rack_unit:"m/s"},e.rotate_yaw=this._rotate_yaw,e.limit_cars_number=this._limit_cars_number,e.light_params={...this._light_params},e.io_oba_params={...this._io_oba_params},e.camera_params={...this._camera_params},e}}class O extends S{constructor(t){super(t),A()(this,"setStartPoint",(t,e)=>{this._sx=t,this._sy=e,this.setDirty(!0)}),A()(this,"setStartNodeId",t=>{this._s_node=t,this.setDirty(!0)}),A()(this,"setEndNodeId",t=>{this._e_node=t,this.setDirty(!0)}),A()(this,"isStartPoint",(t,e)=>Math.abs(this._sx-t)<c.e.NODE_RADIUS&&Math.abs(this._sy-e)<c.e.NODE_RADIUS),A()(this,"isEndPoint",(t,e)=>Math.abs(this._ex-t)<c.e.NODE_RADIUS&&Math.abs(this._ey-e)<c.e.NODE_RADIUS),A()(this,"isStartNode",t=>t===this._s_node),A()(this,"isEndNode",t=>t===this._e_node),this._type=c.e.EDGE_TYPE_LINE,this._s_node=0,this._e_node=0,this._sx=0,this._sy=0,this._ex=0,this._ey=0,this._cx=0,this._cy=0,this._dx=0,this._dy=0,this._radius=0,this._limit_v=0,this._limit_w=0,this._s_facing=0,this._e_facing=0,this._rotate_direction=1,this._is_back_edge=!1,this._direction=1,this._cost=0,this._param=255,this._user_defined_properties=[],this._robot_direction=c.e.EDGE_DIR_FORWARD,this._orientation=Object(c.j)(-1),this._path_behavior={type:0,trigger_stage:0,trigger_condition:{load_state:0}}}fromJson(t,e=!0){let i=1,a=1;if(e?(i=.1,a=.001):this.setDirty(!0),this._id=t.id,this._s_node=t.s_node,this._e_node=t.e_node,this._cost=Object(c.x)(t.cost*i),this._type=t.type,this._sx=Object(c.x)(t.sx*i),this._sy=Object(c.x)(t.sy*i),this._ex=Object(c.x)(t.ex*i),this._ey=Object(c.x)(t.ey*i),this._cx=Object(c.x)(t.cx*i),this._cy=Object(c.x)(t.cy*i),this._dx=Object(c.x)(t.dx*i),this._dy=Object(c.x)(t.dy*i),this._s_facing=t.s_facing*a,this._e_facing=t.e_facing*a,this._radius=Object(c.x)(t.radius*i),this._limit_v=t.limit_v,this._limit_w=t.limit_w,this._rotate_direction=t.rotate_direction,this._is_back_edge=t.is_back_edge,this._direction=t.direction,this._param=t.param,t.hasOwnProperty("desc")&&(this._desc=t.desc),t.hasOwnProperty("robot_direction")?(this._robot_direction=t.robot_direction,this._robot_direction===c.e.EDGE_DIR_BACKWARD?this._is_back_edge=!0:this._is_back_edge=!1):this._is_back_edge&&(this._robot_direction=c.e.EDGE_DIR_BACKWARD),this._user_defined_properties=[],t.hasOwnProperty("user_define_properties")){let e=t.user_define_properties;for(let t in e)this._user_defined_properties.push({name:t,value:e[t]})}t.hasOwnProperty("orientation")&&(this._orientation=t.orientation),t.hasOwnProperty("path_behavior")&&(this._path_behavior=Object(w.d)(t.path_behavior))}toJson(t=!0){var e={};let i=1,a=1;t&&(i=10,a=1e3),e.id=this._id,e.s_node=this._s_node,e.e_node=this._e_node,e.cost=Object(c.x)(this._cost*i),e.type=this._type,e.desc=this._desc,e.sx=Object(c.x)(this._sx*i),e.sy=Object(c.x)(this._sy*i),e.ex=Object(c.x)(this._ex*i),e.ey=Object(c.x)(this._ey*i),e.cx=Object(c.x)(this._cx*i),e.cy=Object(c.x)(this._cy*i),e.dx=Object(c.x)(this._dx*i),e.dy=Object(c.x)(this._dy*i),e.radius=Object(c.x)(this._radius*i),e.limit_v=this._limit_v,e.limit_w=this._limit_w,e.s_facing=this._s_facing*a,e.e_facing=this._e_facing*a,e.rotate_direction=this._rotate_direction,e.direction=this._direction,e.robot_direction=this._robot_direction,e.param=this._param,this._robot_direction===c.e.EDGE_DIR_BACKWARD?e.is_back_edge=!0:e.is_back_edge=!1;let s={};for(let t of Array.from(this._user_defined_properties))s[t.name]=t.value;return e.user_define_properties=s,e.orientation=this._orientation,e.path_behavior=Object(w.d)(this._path_behavior),e}getName(){return"e"+this._id}setEndPoint(t,e){this._ex=t,this._ey=e,this.setDirty(!0)}setCenterPoint(t,e){this._cx=t,this._cy=e,this.setDirty(!0)}setDPoint(t,e){this._dx=t,this._dy=e,this.setDirty(!0)}yaw(t,e){let i=Object(c.s)(t,e),a=Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2)),s=Math.acos(i.x/a);return i.y<0&&(s=2*Math.PI-s),s}}class L extends S{constructor(t){super(t),A()(this,"setPoint",t=>{this._pos.setPos(t.x,t.y,0),this.setDirty(!0)}),this._pos=new C(0,0,0)}setPos(t,e,i){this._pos.setPos(t,e,i),this.setDirty(!0)}fromJson(t,e=!0){let i=1,a=1;e?(i=.1,a=.001):this.setDirty(!0),this._id=t.id,this._pos._x=Object(c.x)(t.x*i),this._pos._y=Object(c.x)(t.y*i),this._pos._yaw=t.yaw*a,t.hasOwnProperty("desc")&&(this._desc=t.desc)}toJson(t=!0){var e={};let i=1,a=1;return t&&(i=10,a=1e3),e.id=this._id,e.desc=this._desc,e.x=Object(c.x)(this._pos._x*i),e.y=Object(c.x)(this._pos._y*i),e.yaw=Object(c.x)(this._pos._yaw*a,4),e}getName(){return"n"+this._id}}class R extends S{constructor(t){super(t),A()(this,"setData",t=>{this.pose=t.pose,this.featureType=t.featureType,this.featureName=t.featureName,this.sensorName=t.sensorName}),this.stationId=0,this.pose={x:0,y:0,z:0,yaw:0,pitch:0,roll:0},this.featureType=c.e.FEATURE_TYPE_OUTLINE,this.featureName="",this.sensorName=""}getPose(){return{x:this.pose.x,y:this.pose.y}}fromJson(t,e=!0){let i=1;e?i=1e-4:this.setDirty(!0),this._id=t.id,this.stationId=t.station_id,this.featureType=t.feature_type,this.featureName=t.feature_name,this.sensorName=t.sensor_name,this.pose.x=Object(c.x)(t["pos.x"]*i),this.pose.y=Object(c.x)(t["pos.y"]*i),this.pose.z=Object(c.x)(t["pos.z"]*i),this.pose.yaw=1*t["pos.yaw"],this.pose.pitch=1*t["pos.pitch"],this.pose.yaw=1*t["pos.roll"]}toJson(t=!0){var e={};let i=1;return t&&(i=1e4),e.id=this._id,e.station_id=this.stationId,e.feature_type=this.featureType,e.feature_name=this.featureName,e.sensor_name=this.sensorName,e["pos.x"]=Object(c.x)(this.pose.x*i),e["pos.y"]=Object(c.x)(this.pose.y*i),e["pos.z"]=Object(c.x)(this.pose.z*i),e["pos.yaw"]=Object(c.x)(1*this.pose.yaw,4),e["pos.pitch"]=Object(c.x)(1*this.pose.pitch,4),e["pos.roll"]=Object(c.x)(1*this.pose.roll,4),e}getName(){return"n"+this._id}}class D extends S{constructor(t){super(t),this._sx=0,this._sy=0,this._ex=0,this._ey=0,this._name=""}yaw(t,e){let i=Object(c.s)(t,e),a=Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2)),s=Math.acos(i.x/a);return i.y<0&&(s=2*Math.PI-s),s}getName(){return"b"+this._id}setStartPoint(t){this._sx=t.x,this._sy=t.y}setEndPoint(t){this._ex=t.x,this._ey=t.y}}class N extends S{constructor(t){super(t),A()(this,"setPoint",t=>{this._pos.setPos(t.x,t.y,0)}),this._pos=new C(0,0,0)}setPos(t,e,i){this._pos.setPos(t,e,i)}setYaw(t){this._pos._yaw=t}getPos(){return this._pos}getYaw(){return this._pos._yaw}fromJson(t,e=!0){let i=1,a=1;e&&(i=.1,a=.001),this._id=t.id,this._pos._x=Object(c.x)(t.x*i),this._pos._y=Object(c.x)(t.y*i),this._pos._yaw=t.yaw*a}toJson(t=!0){var e={};let i=1,a=1;return t&&(i=10,a=1e3),e.id=this._id,e.x=Object(c.x)(this._pos._x*i),e.y=Object(c.x)(this._pos._y*i),e.yaw=Object(c.x)(this._pos._yaw*a,4),e}getName(){return"T"+this._id}}class k extends S{constructor(t){super(t),this._type=c.e.STATION_TYPE_DEFAULT,this._name="",this._pos=new C(0,0,0),this._enter_pos=new C(0,0,0),this._exit_pos=new C(0,0,0),this._check_pos=new C(0,0,0),this._edge_id=0,this._node_id=0,this._no_rotate=!1,this._enter_backward=!1,this._exit_backward=!1,this._pos_dynamic=!1,this._station_offset=0,this._user_defined_properties=[],this._dmcode_id="",this._pgv_offset=new C(0,0,0),this._param=0,this._wareroomAreaId=0,this._wareroomRegionId=0,this._wareroomLocationRow=0,this._wareroomLocationColumn=0,this._wareroomLocationStorey=0}fromJson(t,e=!0){var i;let a=1,s=1;e?(a=.1,s=.001):this.setDirty(!0),this._id=t.id,this._type=t.type,this._name=t.name,this._pos._x=Object(c.x)(t["pos.x"]*a),this._pos._y=Object(c.x)(t["pos.y"]*a);let n=Object(c.x)(t["pos.yaw"]*s,4);if(n%=2*Math.PI,n<0&&(n+=2*Math.PI),this._pos._yaw=n,this._enter_pos._x=Object(c.x)(t["enter_pos.x"]*a),this._enter_pos._y=Object(c.x)(t["enter_pos.y"]*a),this._enter_pos._yaw=Object(c.x)(t["enter_pos.yaw"]*s,4),this._exit_pos._x=Object(c.x)(t["exit_pos.x"]*a),this._exit_pos._y=Object(c.x)(t["exit_pos.y"]*a),this._exit_pos._yaw=Object(c.x)(t["exit_pos.yaw"]*s,4),this._check_pos._x=Object(c.x)(t["check_pos.x"]*a),this._check_pos._y=Object(c.x)(t["check_pos.y"]*a),this._check_pos._yaw=Object(c.x)(t["check_pos.yaw"]*s,4),this._no_rotate=t.no_rotate,this._enter_backward=t.enter_backward,this._exit_backward=t.exit_backward,this._pos_dynamic=t.pos_dynamic,this._station_offset=Object(c.x)(t.station_offset),this._edge_id=t.edge_id,this._node_id=null!==(i=t.node_id)&&void 0!==i?i:0,this._user_defined_properties=[],t.hasOwnProperty("user_define_properties")){let e=t.user_define_properties;for(let t in e)this._user_defined_properties.push({name:t,value:e[t]})}t.hasOwnProperty("dmcode_id")&&(this._dmcode_id=t.dmcode_id),t.hasOwnProperty("pgv_offset.x")&&(this._pgv_offset._x=Object(c.x)(t["pgv_offset.x"]*a),this._pgv_offset._y=Object(c.x)(t["pgv_offset.y"]*a),this._pgv_offset._yaw=Object(c.x)(t["pgv_offset.yaw"]*s,4)),t.hasOwnProperty("desc")&&(this._desc=t.desc),this._param=t.param,this._wareroomAreaId=t.wareroomAreaId||0,this._wareroomRegionId=t.wareroomRegionId||0,this._wareroomLocationRow=t.wareroomLocationRow||0,this._wareroomLocationColumn=t.wareroomLocationColumn||0,this._wareroomLocationStorey=t.wareroomLocationStorey||0}toJson(t=!0){var e={};let i=1,a=1;t&&(i=10,a=1e3),e.id=this._id,e.type=this._type,e.name=this._name,e.desc=this._desc,e["pos.x"]=Object(c.x)(this._pos._x*i),e["pos.y"]=Object(c.x)(this._pos._y*i);let s=this._pos._yaw;s%=2*Math.PI,s<0&&(s+=2*Math.PI),e["pos.yaw"]=Object(c.x)(s*a,4),e["enter_pos.x"]=Object(c.x)(this._enter_pos._x*i),e["enter_pos.y"]=Object(c.x)(this._enter_pos._y*i),e["enter_pos.yaw"]=Object(c.x)(this._enter_pos._yaw*a,4),e["exit_pos.x"]=Object(c.x)(this._exit_pos._x*i),e["exit_pos.y"]=Object(c.x)(this._exit_pos._y*i),e["exit_pos.yaw"]=Object(c.x)(this._exit_pos._yaw*a,4),e["check_pos.x"]=Object(c.x)(this._check_pos._x*i),e["check_pos.y"]=Object(c.x)(this._check_pos._y*i),e["check_pos.yaw"]=Object(c.x)(this._check_pos._yaw*a,4),e.no_rotate=this._no_rotate,e.enter_backward=this._enter_backward,e.exit_backward=this._exit_backward,e.pos_dynamic=this._pos_dynamic,e.station_offset=this._station_offset,e.edge_id=this._edge_id,e.node_id=this._node_id;let n={};for(let t of Array.from(this._user_defined_properties))n[t.name]=t.value;return e.user_define_properties=n,e.dmcode_id=this._dmcode_id,e["pgv_offset.x"]=Object(c.x)(this._pgv_offset._x*i),e["pgv_offset.y"]=Object(c.x)(this._pgv_offset._y*i),e["pgv_offset.yaw"]=Object(c.x)(this._pgv_offset._yaw*a,4),e.param=this._param,e.wareroomAreaId=this._wareroomAreaId,e.wareroomRegionId=this._wareroomRegionId,e.wareroomLocationRow=this._wareroomLocationRow,e.wareroomLocationColumn=this._wareroomLocationColumn,e.wareroomLocationStorey=this._wareroomLocationStorey,e}getName(){return this._name}isEnterPosNull(){return 0===this._enter_pos._x&&0===this._enter_pos._y}isExitPosNull(){return 0===this._exit_pos._x&&0===this._exit_pos._y}isCheckPosNull(){return 0===this._check_pos._x&&0===this._check_pos._y}isChargeStation(){return this._type===c.e.STATION_TYPE_CHARGE}setPos(t,e){this._pos._x=t,this._pos._y=e,this.setDirty(!0)}getPos(){return{x:this._pos._x,y:this._pos._y}}setYaw(t){this._pos._yaw=t,this.setDirty(!0)}getDMCodeID(){return this._dmcode_id}setDMCodeOffset(t,e,i,a){this._dmcode_id=t,this._pgv_offset._x=e,this._pgv_offset._y=i,this._pgv_offset._yaw=a,this.setDirty(!0)}setNoRotate(t){this._no_rotate=t,this.setDirty(!0)}setPosDynamic(t){this._pos_dynamic=t,this.setDirty(!0)}isNoRotate(){return this._no_rotate}isPosDynamic(){return this._pos_dynamic}}class F extends S{constructor(t){super(t),this._sx=0,this._sy=0,this._ex=0,this._ey=0,this._name=""}fromJson(t,e=!0){let i=1;e&&(i=.1),this._id=t.id,this._name=t.name,this._sx=Object(c.x)(t.sx*i),this._sy=Object(c.x)(t.sy*i),this._ex=Object(c.x)(t.ex*i),this._ey=Object(c.x)(t.ey*i)}toJson(t=!0){let e={},i=1;return t&&(i=10),e.id=this._id,e.name=this._name,e.sx=Object(c.x)(this._sx*i),e.sy=Object(c.x)(this._sy*i),e.ex=Object(c.x)(this._ex*i),e.ey=Object(c.x)(this._ey*i),e}yaw(t,e){let i=Object(c.s)(t,e),a=Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2)),s=Math.acos(i.x/a);return i.y<0&&(s=2*Math.PI-s),s}setStartPoint(t,e){this._sx=t,this._sy=e}setEndPoint(t,e){this._ex=t,this._ey=e}}class $ extends S{constructor(t){super(t),this._weight=1,this._isDamaged=!1,this._pos=new C(0,0,0),this._type=c.e.QRCODE_TYPE_PGV}fromJson(t,e=!0){if(null==t)return;let i=1,a=1;e&&(i=.1,a=.001),t.hasOwnProperty("dmcode_id")?this._id=t.dmcode_id:this._id=t.id,this._pos._x=Object(c.x)(t.x*i),this._pos._y=Object(c.x)(t.y*i),this._pos._yaw=Object(c.x)(t.yaw*a),t.hasOwnProperty("weight")&&(this._weight=t.weight),t.hasOwnProperty("damaged")&&(this._isDamaged=t.damaged),t.hasOwnProperty("recorded")&&(this._recorded=t.recorded),t.type===c.e.QRCODE_TYPE_FUSE_LOCATE&&(this._type=t.type)}toJson(t=!0){let e={},i=1,a=1;return t&&(i=10,a=1e3),e.id=0,e.dmcode_id=this._id,e.type=this._type,e.x=Object(c.x)(this._pos._x*i),e.y=Object(c.x)(this._pos._y*i),e.yaw=Object(c.x)(this._pos._yaw*a,4),this.isQRCodeTypeFuseLocate()&&(e.damaged=this._isDamaged,e.weight=this._weight,e.recorded=this._recorded),e}getIsDamged(){return this._isDamaged}setPose(t,e,i){this._pos._x=t,this._pos._y=e,this._pos._yaw=i}getYaw(){return this._pos._yaw}isQRCodeTypeStationCorrect(){return this._type===c.e.QRCODE_TYPE_PGV}isQRCodeTypeFuseLocate(){return this._type===c.e.QRCODE_TYPE_FUSE_LOCATE}}class q extends S{constructor(t){super(c.e.MODEL_TYPE_EDGE_GROUP),this._id=t,this._name="",this._edgeIds=[],this._types=[],this.user_define_properties={}}fromJson(t,e=!0){this._id=t.id,this._name=t.name,t.hasOwnProperty("edgeIds")&&(this._edgeIds=t.edgeIds),this._types=t.types,t.hasOwnProperty("desc")&&(this._desc=t.desc),t.hasOwnProperty("user_define_properties")&&(this.user_define_properties=t.user_define_properties)}toJson(t=!0){let e={};return e.id=this._id,e.desc=this._desc,e.name=this._name,e.edgeIds=this._edgeIds,e.types=this._types,e.user_define_properties=this.user_define_properties,e}setName(t){this._name=t}getName(){return this._name}hasEdge(t){return this._edgeIds.indexOf(t)>=0}addEdge(t){this._edgeIds.indexOf(t)>=0||this._edgeIds.push(t)}edgeId(t=0){return t<0||t>=this._edgeIds.length?0:this._edgeIds[t]}getEdgeIds(){return this._edgeIds}setTypes(t){this._types=t}getTypes(){return this._types}removeEdge(t){let e=this._edgeIds.indexOf(t);e<0||this._edgeIds.splice(e,1)}clear(){this._edgeIds=[]}}const G="1.7.0";class B{constructor(){A()(this,"deleteNode",t=>{this.deleteModel(t,this._nodeDataList)}),A()(this,"deleteFeature",t=>{this.deleteModel(t,this._featureDataList)}),A()(this,"deleteTag",t=>{this.deleteModel(t,this._tagDataList)}),A()(this,"deleteStation",t=>{this.deleteModel(t,this._stationDataList)}),A()(this,"deleteEdge",t=>{this.deleteModel(t,this._edgeDataList)}),A()(this,"deleteArea",t=>{this.deleteModel(t,this._areaDataList)}),A()(this,"deleteRedrawArea",t=>{this.deleteModel(t,this._redrawAreaDataList)}),A()(this,"deleteCleanArea",t=>{this.deleteModel(t,this._cleanAreaDataList)}),A()(this,"deleteNoteArea",t=>{this.deleteModel(t,this._noteAreaDataList)}),A()(this,"deleteLocationArea",t=>{this.deleteModel(t,this._locationAreaDataList)}),A()(this,"deletePGV",t=>{this.deleteModel(t,this._barCodeDataList)}),A()(this,"deleteModel",(t,e)=>{let i=-1;for(let a=0;a<e.length;a++)if(e[a]._id===t){i=a;break}i>=0&&e.splice(i,1)}),this._mapUnitIsMM=!0,this._mapLengthUnit="",this._mapAngleUnit="",this._mapCreateTime=0,this._mapModifyTime=0,this._mapOffset={x:3071,y:2047},this._mapSize={x:5120,y:3072},this._mapResolution=2,this._imageScale=[],this._mapJsonVersion=G,this._edgeDataList=[],this._nodeDataList=[],this._featureDataList=[],this._stationAndFeatureBindDataList=[],this._tagDataList=[],this._stationDataList=[],this._areaDataList=[],this._cleanAreaDataList=[],this._redrawAreaDataList=[],this._noteAreaDataList=[],this._locationAreaDataList=[],this._barCodeDataList=[],this._edgeGroupDataList=[],this._wareroomAreaList=[],this._wareroomRegionList=[],this._originalDat=""}reset(t=!0){this._mapUnitIsMM=!0,this._mapOffset.x=3071,this._mapOffset.y=2047,this._mapSize.x=5120,this._mapSize.y=3072,this._mapResolution=2,this._imageScale=[],this._edgeDataList=[],this._nodeDataList=[],this._featureDataList=[],this._stationAndFeatureBindDataList=[],this._tagDataList=[],this._stationDataList=[],this._areaDataList=[],this._redrawAreaDataList=[],this._cleanAreaDataList=[],this._noteAreaDataList=[],this._locationAreaDataList=[],this._barCodeDataList=[],this._edgeGroupDataList=[],this._wareroomAreaList=[],this._wareroomRegionList=[],t&&(this._originalDat="")}updateOriginalDat(t){this._originalDat=t}isDatChanged(){return JSON.stringify(this.saveToJson())!==this._originalDat}removeCleanAreaList(){this._cleanAreaDataList=[]}restoreFromOriginDat(){this.loadFromJson(JSON.parse(this._originalDat),!0,!0)}getOrignalAreaUserDefinedParams(t){let e=JSON.parse(this._originalDat).data.area;for(let i of Array.from(e))if(i.id===t)return i.user_defined_params;return[]}loadFromJson(t,e=!1,i=!0){var a,s;this.reset(i);var n=t.data;if(null==n)return!1;if(!t.hasOwnProperty("meta"))return!1;var o=t.meta;this._mapOffset.x=o["zero_offset.x"],this._mapOffset.y=o["zero_offset.y"],this._mapSize.x=o["size.x"],this._mapSize.y=o["size.y"],o.hasOwnProperty("resolution")&&(this._mapResolution=o.resolution),o.hasOwnProperty("image_scale")&&(this._imageScale=o.image_scale),this._mapJsonVersion=o.version||G,o.hasOwnProperty("length_unit")&&(this._mapUnitIsMM=!0,this._mapLengthUnit=o.length_unit,this._mapAngleUnit=o.angle_unit,this._mapCreateTime=o.created_timestamp,this._mapModifyTime=o.modified_timestamp),this.fromJsonArray(n.area,c.e.MODEL_TYPE_FUNC_AREA),this.fromJsonArray(n.node,c.e.MODEL_TYPE_NODE),this.fromJsonArray(n.edge,c.e.MODEL_TYPE_EDGE),this.fromJsonArray(n.station,c.e.MODEL_TYPE_STATION),this.fromJsonArray(n.feature,c.e.MODEL_TYPE_FEATURE),n.hasOwnProperty("tag")&&this.fromJsonArray(n.tag,c.e.MODEL_TYPE_TAG),n.hasOwnProperty("dmcode")&&this.fromJsonArray(n.dmcode,c.e.MODEL_TYPE_BARCODE),n.hasOwnProperty("edgeGroup")&&this.fromJsonArray(n.edgeGroup,c.e.MODEL_TYPE_EDGE_GROUP);let r=n.wareroom;null!=r&&(this._wareroomAreaList=Object(w.a)(r.wareroomArea),this._wareroomRegionList=Object(w.a)(r.wareroomRegion)),this.fromJsonArray(null!==(a=n.noteArea)&&void 0!==a?a:[],c.e.MODEL_TYPE_NOTE_AREA),this.fromJsonArray(null!==(s=n.locationArea)&&void 0!==s?s:[],c.e.MODEL_TYPE_LOCATION_AREA);let l=t.private;return this.fromJsonArray(l.fuseLocateQRCode,c.e.MODEL_TYPE_BARCODE),this.fromJsonArray(l.redrawArea,c.e.MODEL_TYPE_REDRAW_AREA),e&&this.fromJsonArray(l.cleanArea,c.e.MODEL_TYPE_CLEAN_AREA),i&&this.updateOriginalDat(JSON.stringify(this.saveToJson())),!0}saveWareroomToMapModal(t=[],e=[]){this._wareroomAreaList=t,this._wareroomRegionList=e}saveToJson(){let t={},e={};e["zero_offset.x"]=this._mapOffset.x,e["zero_offset.y"]=this._mapOffset.y,e["size.x"]=this._mapSize.x,e["size.y"]=this._mapSize.y,e.resolution=this._mapResolution,e.image_scale=this._imageScale,e.length_unit=this._mapLengthUnit,e.angle_unit=this._mapAngleUnit,e.created_timestamp=this._mapCreateTime,e.modified_timestamp=this._mapModifyTime,e.version=d.j,t.meta=e;let i={};i.area=this.toJson(this._areaDataList),i.node=this.toJson(this._nodeDataList),i.tag=this.toJson(this._tagDataList),i.edge=this.toJson(this._edgeDataList).filter(t=>t.id>0),i.station=this.toJson(this._stationDataList),i.dmcode=this.toJson(this._barCodeDataList.filter(t=>t.isQRCodeTypeStationCorrect())),i.edgeGroup=this.toJson(this._edgeGroupDataList),i.feature=this.toJson(this._featureDataList),i.noteArea=this.toJson(this._noteAreaDataList),i.locationArea=this.toJson(this._locationAreaDataList);let a={};a.wareroomArea=Object(w.a)(this._wareroomAreaList),a.wareroomRegion=Object(w.a)(this._wareroomRegionList),i.wareroom=a;let s={};return s.cleanArea=this.toJson(this._cleanAreaDataList),s.fuseLocateQRCode=this.toJson(this._barCodeDataList.filter(t=>t.isQRCodeTypeFuseLocate())),s.redrawArea=this.toJson(this._redrawAreaDataList),t.private=s,t.data=i,t}toJson(t){return t.map(t=>t.toJson())}imageScaling(){let t=this._mapSize.x*this._mapResolution/100*(this._mapSize.y*this._mapResolution/100)/2e4;if(t<1||this._imageScale.length<=0)return 1;let e=Math.sqrt(t);t=this._imageScale[this._imageScale.length-2];for(let i=this._imageScale.length-2;i>=0;i--){let a=this._imageScale[i];e<=a&&(t=a)}return 1/t}mapToCanvas(t){var e={};return e.x=Math.round(t.x+this._mapOffset.x*this._mapResolution),e.y=Math.round(this._mapOffset.y*this._mapResolution-t.y),e}mapFromCanvas(t){let e={};return e.x=t.x-this._mapOffset.x*this._mapResolution,e.y=this._mapOffset.y*this._mapResolution-t.y,e}fromJsonArray(t,e){if(null==t||void 0===t)return null;for(var i=0;i<t.length;i++){if(null!=t[i])this.createModel(e).fromJson(t[i],this._mapUnitIsMM)}}createModel(t){let e=null,i=0;switch(t){case c.e.MODEL_TYPE_FUNC_AREA:e=new P(t),i=this.createId(this._areaDataList),this._areaDataList.push(e);break;case c.e.MODEL_TYPE_CLEAN_AREA:e=new I(t),i=this.createId(this._cleanAreaDataList),this._cleanAreaDataList.push(e);break;case c.e.MODEL_TYPE_REDRAW_AREA:e=new x(t),i=this.createId(this._redrawAreaDataList),this._redrawAreaDataList.push(e);break;case c.e.MODEL_TYPE_NOTE_AREA:e=new T(t),i=this.createId(this._noteAreaDataList),this._noteAreaDataList.push(e);break;case c.e.MODEL_TYPE_LOCATION_AREA:e=new M(t),i=this.createId(this._locationAreaDataList),this._locationAreaDataList.push(e);break;case c.e.MODEL_TYPE_EDGE:i=this.createId(this._edgeDataList),e=new O(t),this._edgeDataList.push(e);break;case c.e.MODEL_TYPE_NODE:i=this.createId(this._nodeDataList),e=new L(t),this._nodeDataList.push(e);break;case c.e.MODEL_TYPE_FEATURE:i=this.createId(this._featureDataList),e=new R(t),this._featureDataList.push(e);break;case c.e.MODEL_TYPE_STATION_AND_FEATURE_BIND:i=this.createId(this._stationAndFeatureBindDataList),e=new D(t),this._stationAndFeatureBindDataList.push(e);break;case c.e.MODEL_TYPE_TAG:i=this.createId(this._tagDataList),e=new N(t),this._tagDataList.push(e);break;case c.e.MODEL_TYPE_BARCODE:i=0,e=new $(t),this._barCodeDataList.push(e);break;case c.e.MODEL_TYPE_STATION:i=this.createId(this._stationDataList),e=new k(t),this._stationDataList.push(e);break;case c.e.MODEL_TYPE_EDGE_GROUP:i=this.createId(this._edgeGroupDataList),e=new q(i),this._edgeGroupDataList.push(e)}return e._id=i,e}createId(t){let e=0;return t.forEach(t=>{t._id>=e&&(e=t._id)}),++e}stationModel(t){return this.itemModel(t,this._stationDataList)}nodeModel(t){return this.itemModel(t,this._nodeDataList)}featureModel(t){return this.itemModel(t,this._featureDataList)}tagModel(t){return this.itemModel(t,this._tagDataList)}areaModel(t){return this.itemModel(t,this._areaDataList)}noteAreaModel(t){return this.itemModel(t,this._noteAreaDataList)}locationAreaModel(t){return this.itemModel(t,this._locationAreaDataList)}edgeModel(t){return this.itemModel(t,this._edgeDataList)}edgeGroupModel(t){return this.itemModel(t,this._edgeGroupDataList)}itemModel(t,e){for(let i=0;i<e.length;i++)if(e[i].getID()===t)return e[i];return null}deleteEdgeGroup(t){this.deleteModel(t,this._edgeGroupDataList)}}class j{constructor(t,e,i){A()(this,"isPointOn",t=>null!=this._pathGroup.hitTest(t)),A()(this,"isItemDrawing",()=>this._isDrawing),this._paper=t,this._dat=e,this._editable=!1,this._moving=!1,this._mapModel=i,this._pathGroup=new t.Group,this._isDrawing=!1,this._isNameVisible=!0,this._strokeColor="black",this._strokeWidth=c.e.DEFAULT_STROKE_WIDTH,this._lastScale=0,this._startMoveScenePos={x:0,y:0},this._totalMoveDistance={x:0,y:0}}getID(){return this._dat._id}getName(){return this._dat.getName()}getDat(){return this._dat}isDirty(){return this._dat.isDirty()}itemType(){return this._dat._itemType}updateShape(){this.removeChildren()}doAfterUpdateShape(){this.setNameVisible(this.isNameVisible())}updateDat(){}startDraw(t){this._isDrawing=!0}drawing(t){}endDraw(t){this._isDrawing=!1}startMove(){this._moving=!0,this._startMoveScenePos=this.scenePos()}moveBy(t){this._totalMoveDistance=Object(c.q)(this._totalMoveDistance,t);let e=this._pathGroup.position;this._pathGroup.position=Object(c.q)(e,t)}endMove(){this._moving=!1,this._startMoveScenePos={x:0,y:0},this._totalMoveDistance={x:0,y:0}}moveNewScenePos(){return Object(c.q)(this._startMoveScenePos,this._totalMoveDistance)}setDoubleClickCallback(t){this.isEditable()&&(this._pathGroup.onDoubleClick=e=>{t(this._dat)})}bringToFront(){this._pathGroup.bringToFront()}sendToBack(){this._pathGroup.sendToBack()}setInteractionState(t){this._pathGroup.locked=!t}intersects(t){let e=t.childPath(c.e.ITEM_PATH_NAME_MAIN_CURVE),i=this.childPath(c.e.ITEM_PATH_NAME_MAIN_CURVE);return!(!i.isInside(e.bounds)&&!e.isInside(i.bounds))||e.intersects(i)}isIntersectsRect(t){return t.intersects(this.childPath(c.e.ITEM_PATH_NAME_MAIN_CURVE).bounds)}hitTest(t){return this._pathGroup.hitTest(t)}isItemMoving(){return this._moving}setStrokeColor(t){this._strokeColor=t,this.setColor(t)}getStrokeColor(){return this._strokeColor}setStrokeWidth(t){this._strokeWidth=t}getStrokeWidth(){return this._strokeWidth*this.getItemScaling()}getFontSize(){return this.getItemScaling()*this.getDefaultFontSize()}getDefaultStrokeWidth(){return c.e.DEFAULT_STROKE_WIDTH}getDefaultFontSize(){return c.e.DEFAULT_FONT_SIZE}getItemScaling(){let t=1/this._paper.view.scaling.x,e=1,i=Math.abs(t-1);return e=i<=c.e.MAP_SCALE_01||t-1>c.e.MAP_SCALE_01?c.e.MAP_SCALE_10:i<=c.e.MAP_SCALE_02?c.e.MAP_SCALE_09:i<=c.e.MAP_SCALE_03?c.e.MAP_SCALE_08:i<=c.e.MAP_SCALE_04?c.e.MAP_SCALE_07:i<=c.e.MAP_SCALE_05?c.e.MAP_SCALE_06:i<=c.e.MAP_SCALE_06?c.e.MAP_SCALE_05:i<=c.e.MAP_SCALE_07?c.e.MAP_SCALE_04:i<=c.e.MAP_SCALE_08?c.e.MAP_SCALE_03:(c.e.MAP_SCALE_09,c.e.MAP_SCALE_02),e}doZoom(t=!0){this.isNeedUpdate()&&(t?(this._lastScale=this.getItemScaling(),this.updateShape()):this.updateStyle())}isNeedUpdate(){return this._lastScale!==this.getItemScaling()}updateStyle(){let t=this.getItemScaling(),e=this.getDefaultStrokeWidth()*t;this._pathGroup.children.forEach(i=>{i instanceof this._paper.Path?i.strokeWidth=e:i instanceof this._paper.PointText&&(i.fontSize=this.getDefaultFontSize()*t)})}setColor(t){this._pathGroup.children.forEach(e=>{e.name!==c.e.ITEM_PATH_NAME_TEXT?e.strokeColor=t:e.fillColor=t})}setBlendMode(t){this._pathGroup.blendMode=t}setEditable(t){this._editable=t,this.setInteractionState(t)}isEditable(){return this._editable}setSelectedState(t){this._pathGroup.selected=t,t?this.bringToFront():this.sendToBack()}isSelected(){return null!=this._pathGroup&&this._pathGroup.selected}setSelectedColor(t){this._pathGroup.selectedColor=t}setVisible(t,e=!0){this._pathGroup.visible=t,e&&this.setInteractionState(t)}isVisible(){return this._pathGroup.visible}setNameVisible(t){this._isNameVisible=t,t&&!this.isVisible()||this._pathGroup.children.forEach(e=>{e.name===c.e.ITEM_PATH_NAME_TEXT&&(e.visible=t)})}isNameVisible(){return this._isNameVisible}removeChildren(){this._pathGroup.removeChildren()}removePath(t){let e=-1;for(let i=0;i<this._pathGroup.children.length;i++)if(this._pathGroup.children[i].name===t){e=i;break}if(e<0)return;let i=this._pathGroup.removeChildren(e,e+1);i.length>0&&(i[0].remove(),i[0]=null),i=null}delete(){this._pathGroup.remove()}removeFromProject(){this._pathGroup.remove()}addToLayer(t){this._pathGroup.addTo(t)}addPath(t,e=!1){null!=this._pathGroup&&(t.strokeScaling=!0,this._pathGroup.addChild(t))}childPath(t){for(let e=0;e<this._pathGroup.children.length;e++)if(this._pathGroup.children[e].name===t)return this._pathGroup.children[e];return null}scenePos(){return 0}setScenePos(t,e=!0){this._pathGroup.position=t}mapPos(){return null}setMapPos(t,e=!0){}}class U{constructor(t){this._length=10,this._paper=t,this._strokeWidth=3,this._strokeColor="red",this._arrowLength=10,this._spanAngle=40,this._dashArray=[],this._pathGroup=new t.Group,this._pathGroup.name=c.e.ITEM_NAME_GROUP_ARROW,this._pathGroup.pivot=new t.Point(0,0)}setLength(t){this._length=t}setArrowLength(t){this._arrowLength=t}setStrokeWidth(t){this._strokeWidth=t}setDashArray(t){this._dashArray=t}setSpanAngle(t){this._spanAngle=t}setColor(t){this._strokeColor=t}initShape(){var t=new this._paper.Path.Line({from:[0,0],to:[this._length,0],strokeWidth:this._strokeWidth,strokeColor:this._strokeColor,dashArray:this._dashArray,strokeCap:"round"});let e=180-this._spanAngle/2;var i=new this._paper.Point(this._length,0),a=new this._paper.Path({strokeWidth:this._strokeWidth,strokeColor:this._strokeColor,strokeJoin:"miter",strokeCap:"round"});a.add(i),a.lineBy(i.normalize(this._arrowLength).rotate(-e));var s=new this._paper.Path({strokeWidth:this._strokeWidth,strokeColor:this._strokeColor,strokeJoin:"miter",strokeCap:"round"});s.add(i),s.lineBy(i.normalize(this._arrowLength).rotate(e)),this._pathGroup.addChild(t),this._pathGroup.addChild(a),this._pathGroup.addChild(s)}setPos(t){this._pathGroup.position=t}getItem(){return this._pathGroup}rotate(t){this._pathGroup.rotate(t)}setVisible(t){this._pathGroup.visible=t}delete(){this._pathGroup.remove()}updateColor(t){this._pathGroup.strokeColor=t}}class Y extends j{constructor(t,e){super(t,null,e),this.setInteractionState(!1)}updateShape(){super.updateShape();let t=this.getItemScaling(),e=this._mapModel.mapToCanvas({x:0,y:0}),i=new U(this._paper);i.setColor(c.e.AXIS_COLOR),i.setStrokeWidth(3*t),i.setLength(c.e.AXIS_LENGTH),i.setArrowLength(10*t),i.initShape(),i.setPos(e);let a=new U(this._paper);a.setColor(c.e.AXIS_COLOR),a.setStrokeWidth(3*t),a.setLength(c.e.AXIS_LENGTH),a.setArrowLength(10*t),a.initShape(),a.setPos(e),a.rotate(-90);let s=new this._paper.PointText(Object(c.q)(e,{x:4,y:15*t}));s.content="(0, 0)",s.style={fontSize:this.getFontSize(),fillColor:c.e.AXIS_COLOR,justification:"center"};let n=new this._paper.PointText(Object(c.q)(e,{x:c.e.AXIS_LENGTH-10,y:15*t}));n.content="X",n.style={fontSize:this.getFontSize(),fillColor:c.e.AXIS_COLOR,justification:"center"};let o=new this._paper.PointText(Object(c.q)(e,{x:-15*t,y:-(c.e.AXIS_LENGTH-10)}));o.content="Y",o.style={fontSize:this.getFontSize(),fillColor:c.e.AXIS_COLOR,justification:"center"},this.addPath(i.getItem()),this.addPath(a.getItem()),this.addPath(s),this.addPath(n),this.addPath(o)}setSelectedState(){}}class z extends j{constructor(t,e,i){super(t,e,i),this._isAbnormal=!1,this.setStrokeWidth(c.e.STROKE_WIDTH_2),this.setStrokeColor(c.e.NODE_COLOR_NORMAL),this.setSelectedColor(c.e.ITEM_COLOR_SELECTED),this._pathGroup.onMouseEnter=t=>{this.isEditable()&&(this.isSelected()||(this.setColor(c.e.ITEM_COLOR_HOVE),this.bringToFront()))},this._pathGroup.onMouseLeave=t=>{this.isEditable()&&(this.isSelected()||(this.setColor(this.getDisplayColor()),this.sendToBack()))}}updateShape(){if(super.updateShape(),null===this._dat||void 0===this._dat)return;let t=this.getItemScaling(),e=c.e.NODE_RADIUS*t,i=this.getStrokeColor(),a=this._mapModel.mapToCanvas({x:this._dat._pos._x,y:this._dat._pos._y});var s=new this._paper.Point(a.x,a.y),n=new this._paper.Path.Circle(s,e);n.name=c.e.ITEM_PATH_NAME_MAIN_CURVE,n.fillColor=new this._paper.Color(255,255,255,.1),this._isAbnormal&&(n.fillColor=new this._paper.Color(0,0,0,.5)),n.strokeColor=i,n.strokeWidth=this.getStrokeWidth(),n.dashArray=[4*t,2*t],this.addPath(n);var o=new this._paper.PointText(Object(c.q)(s,Object(c.t)(new this._paper.Point(-c.e.NODE_RADIUS-12,-8),t)));o.name=c.e.ITEM_PATH_NAME_TEXT,o.style={fontSize:this.getFontSize(),fillColor:i,justification:"center"},o.content=this.getName(),this.addPath(o),this.setColor(this.getDisplayColor()),this.doAfterUpdateShape()}startDraw(t){this.setInteractionState(!1)}drawing(t){let e=this._mapModel.mapFromCanvas(t);this._dat.setPoint(e),this.updateShape()}endDraw(t){this.drawing(t),this.setInteractionState(!0)}moveBy(t){super.moveBy(t),this.setScenePos(Object(c.q)(this.scenePos(),t),!1)}setSelectedState(t){super.setSelectedState(t),t?this.setColor(c.e.ITEM_COLOR_HOVE):this.setColor(c.e.NODE_COLOR_NORMAL)}isExactAt(t){return Object(c.n)(t,this.scenePos())<1}isAroundPos(t,e=2*c.e.NODE_RADIUS){return Object(c.n)(t,this.scenePos())<e}scenePos(){return this._mapModel.mapToCanvas(this.mapPos())}setScenePos(t,e=!0){let i=this._mapModel.mapFromCanvas(t);this.setMapPos(i,e)}setIsAbnormal(t){this._isAbnormal=t,this.setColor(this.getDisplayColor()),this.updateShape()}mapPos(){return{x:this._dat._pos._x,y:this._dat._pos._y}}setMapPos(t,e=!0){this._dat.setPoint(t),e&&this.updateShape()}getDisplayColor(){return this.isSelected()?c.e.ITEM_COLOR_SELECTED:this._isAbnormal?c.e.ITEM_COLOR_ERROR:c.e.NODE_COLOR_NORMAL}delete(){super.delete(),this._mapModel.deleteNode(this._dat._id)}}class V extends j{constructor(t,e,i){super(t,e,i),A()(this,"setScenePos",t=>{let e=this._mapModel.mapFromCanvas(t);this._dat.setPoint(e),this.updateShape()}),this.setSelectedColor(c.e.ITEM_COLOR_HOVE),this.setStrokeColor(c.e.TAG_COLOR_NORMAL),this.setStrokeWidth(2),this._pathGroup.onMouseEnter=t=>{this.isSelected()||(this.setColor(c.e.ITEM_COLOR_HOVE),this.bringToFront())},this._pathGroup.onMouseLeave=t=>{this.isSelected()||(this.setColor(this.getDisplayColor()),this.sendToBack())}}updateShape(){if(super.updateShape(),null===this._dat||void 0===this._dat)return;let t=this.getStrokeColor(),e=this.getItemScaling(),i=this._mapModel.mapToCanvas({x:this._dat._pos._x,y:this._dat._pos._y});var a=new this._paper.Point(i.x,i.y),s=new this._paper.Path.Circle(a,c.e.TAG_RADIUS*e);s.name=c.e.ITEM_PATH_NAME_MAIN_CURVE,s.fillColor=new this._paper.Color(255,255,255,.1),s.strokeColor=t,s.strokeWidth=this.getStrokeWidth(),s.dashArray=[4*e,2*e],this.addPath(s);var n=new U(this._paper);n.setColor(t),n.setStrokeWidth(2*e),n.setLength((c.e.TAG_RADIUS+8)*e),n.setArrowLength(6*e),n.initShape(),n.setPos(a),n.rotate(this.sceneYaw());var o=new this._paper.PointText(Object(c.q)(a,Object(c.t)(new this._paper.Point(-c.e.TAG_RADIUS-12,-8),e)));o.name=c.e.ITEM_PATH_NAME_TEXT,o.style={fontSize:this.getFontSize(),fillColor:this.getDisplayColor(),justification:"center"},o.content=this.getName(),this.addPath(o),this.addPath(n.getItem()),this.setColor(this.getDisplayColor()),this.doAfterUpdateShape()}moveBy(t){}setSelectedState(t){super.setSelectedState(t)}scenePos(){return this._mapModel.mapToCanvas({x:this._dat._pos._x,y:this._dat._pos._y})}mapPose(){return{x:this._dat._pos._x,y:this._dat._pos._y,yaw:this._dat._pos._yaw}}setSceneYaw(t){this._dat.setYaw(Object(c.b)(-t))}sceneYaw(){return Object(c.h)(-this._dat.getYaw())}getDisplayColor(){return this.isSelected()?c.e.ITEM_COLOR_HOVE:this.getStrokeColor()}delete(){super.delete(),this._mapModel.deleteTag(this._dat._id)}}class W extends j{constructor(t,e,i){super(t,e,i),A()(this,"setEditPoleCallback",t=>{this._editPoleCallback=t}),A()(this,"curveLength",()=>{let t=this.childPath(c.e.ITEM_PATH_NAME_MAIN_CURVE);return null==t?0:t.length}),A()(this,"mapUnitVector",(t=0)=>{let e=this.childPath(c.e.ITEM_PATH_NAME_MAIN_CURVE);if(null===e)return new this._paper.Point(0,0);let i=e.getTangentAt(t);return null==i?new this._paper.Point(0,0):(i.y=-i.y,i)}),this._dashArray=[],this._lengthOnEditPole=0,this._moveStartScenePos={x:0,y:0},this._moveEndScenePos={x:0,y:0},this._mapStartUnitVector=null,this._mapEndUnitVector=null,this._editPole=c.e.EDGE_POLE_NONE,this._editPoleCallback=null,this.setStrokeWidth(c.e.EDGE_STROKE_WIDTH),this.setStrokeColor(c.e.EDGE_COLOR_NORMAL),this.setSelectedColor(c.e.ITEM_COLOR_SELECTED),this._pathGroup.onMouseEnter=t=>{this.isEditable()&&(this.bringToFront(),this.isSelected()||this.isItemDrawing()||!this.isEditable()||this.setColor(c.e.ITEM_COLOR_HOVE))},this._pathGroup.onMouseLeave=t=>{this.isEditable()&&(this.isSelected()||this.isItemDrawing()||this.setColor(this.getDisplayColor()))}}updateEdge(t,e,i=!0,a=!0,s=!0){}updateShape(){super.updateShape()}updateDat(){null!=this.childPath(c.e.ITEM_PATH_NAME_MAIN_CURVE)&&(this.setCost(this.curveLength()),this.updateFacing())}updateFacing(){}doAfterUpdateShape(){super.doAfterUpdateShape(),this.getID()>0&&this.drawEdgeDirection()}setColor(t){this._pathGroup.children.forEach(e=>{e.name!==c.e.ITEM_PATH_NAME_TEXT?e.name!==c.e.ITEM_NAME_GROUP_ARROW&&(e.strokeColor=t):e.fillColor=t})}startMove(){super.startMove(),this._moveStartScenePos=this.startScenePos(),this._moveEndScenePos=this.endScenePos()}moveBy(t){super.moveBy(t);let e=Object(c.q)(this.startScenePos(),t),i=Object(c.q)(this.endScenePos(),t);if(this.edgeType()===c.e.EDGE_TYPE_BEZIER){let a=Object(c.q)(this.centerScenePos(),t),s=Object(c.q)(this.dScenePos(),t);this.setCenterPos(a),this.setDPos(s),this.updateEdge(e,i,!1,!1,!1),a=null,s=null}else this.updateEdge(e,i,!0,!0,!1);e=null,i=null}endMove(){super.endMove(),this._moveStartScenePos={x:0,y:0},this._moveEndScenePos={x:0,y:0}}moveNewStartScenePos(){return Object(c.q)(this._moveStartScenePos,this._totalMoveDistance)}moveNewEndScenePos(){return Object(c.q)(this._moveEndScenePos,this._totalMoveDistance)}scenePos(){return Object(c.r)(Object(c.q)(this.startScenePos(),this.endScenePos()),2)}nearestPosOnEdge(t){let e=this.childPath(c.e.ITEM_PATH_NAME_MAIN_CURVE);return null==e?null:e.getNearestPoint(t)}delete(){super.delete(),this._mapModel.deleteEdge(this._dat._id)}getArrowOffset(){return c.e.EDGE_ARROW_OFFSET_FROM_START*this.getItemScaling()}getArrowLineLength(){return c.e.ARROW_LINE_LENGTH*this.getItemScaling()*.8}getDisplayColor(){let t="";if(this.isSelected())return t=c.e.ITEM_COLOR_SELECTED,t;if(t=c.e.EDGE_COLOR_NORMAL,this.isItemDrawing())return t;if(this.isSameDirection())switch(this._dat._param){case 1:t=c.e.EDGE_COLOR_FREE;break;case 2:t=c.e.EDGE_COLOR_LOAD}else t=c.e.EDGE_COLOR_BACKWARD;return t}setSelectedState(t){super.setSelectedState(t),this.updateShape(),this.isSelected()?this.bringToFront():this.sendToBack()}setDashArray(t){this._dashArray=t}setEdgeNameVisible(t){let e=this._pathGroup.lastChild;e&&(e.visible=t)}adjustPole(t){switch(this._editPole){case c.e.EDGE_POLE_START:{let e=this.endScenePos();this.updateEdge(t,e);break}case c.e.EDGE_POLE_END:{let e=this.startScenePos();this.updateEdge(e,t);break}}}finishEditPole(t){this.resetPoleColor(),this._editPole=c.e.EDGE_POLE_NONE,Math.abs(this.curveLength()-this._lengthOnEditPole)>.1&&this.updateDat(),this._lengthOnEditPole=0}editPoleScenePos(){let t=null;switch(this._editPole){case c.e.EDGE_POLE_START:t=this.startScenePos();break;case c.e.EDGE_POLE_END:t=this.endScenePos();break;case c.e.EDGE_POLE_C:t=this.centerScenePos();break;case c.e.EDGE_POLE_D:t=this.dScenePos()}return t}resetPoleColor(){let t=this.childPath(this._editPole);if(null!=t)switch(this._editPole){case c.e.EDGE_POLE_C:case c.e.EDGE_POLE_D:t.fillColor="white";break;case c.e.EDGE_POLE_START:case c.e.EDGE_POLE_END:t.fillColor=c.e.EDGE_POLE_COLOR_NORAML,t.strokeColor=c.e.EDGE_POLE_COLOR_NORAML}}edgeLength(){return Math.sqrt(Math.pow(this.endScenePos().x-this.startScenePos().x,2)+Math.pow(this.endScenePos().y-this.startScenePos().y,2))}isOnEdge(t){let e=this.childPath(c.e.ITEM_PATH_NAME_MAIN_CURVE).getNearestPoint(t);return Math.abs(e.x-t.x)<=1&&Math.abs(e.y-t.y)<=1}isVerticalToXAxis(){return Math.abs(this.startScenePos().x-this.endScenePos().x)<.1}drawEdgeDirection(){let t=this.getItemScaling(),e=this.sceneUnitVector(),i=this.edgeLength(),a=this.getRobotDirection();switch(a){case c.e.EDGE_DIR_BACKWARD:case c.e.EDGE_DIR_LEFT:case c.e.EDGE_DIR_RIGHT:{let n=Object(c.q)(this.startScenePos(),{x:.3*i*t*e.x,y:.3*i*t*e.y}),o=new U(this._paper);o.setSpanAngle(90),o.setColor(c.e.EDGE_DIRECTION_COLOR),o.setStrokeWidth(2*t),o.setLength(.1),o.setArrowLength(10*t),o.initShape();let r=o.getItem();this.addPath(r);let l=Object(c.h)(Object(c.z)(this.startScenePos(),this.endScenePos()));a===c.e.EDGE_DIR_LEFT?l-=90:a===c.e.EDGE_DIR_RIGHT?l+=90:a===c.e.EDGE_DIR_BACKWARD&&(l+=180),o.rotate(l);let d=Object(c.b)(l),h=Math.cos(d),u=Math.sin(d),p=Object(c.q)(n,{x:30*t*h,y:30*t*u});o.setPos(p);let m=Object(c.q)(n,{x:10*t*h,y:15*t*u+5*t});var s=new this._paper.PointText(m);s.style={fontSize:this.getFontSize(),fillColor:c.e.EDGE_DIRECTION_COLOR,justification:"center"},s.name=c.e.ITEM_PATH_NAME_TEXT,s.content=this.getName(),this.addPath(s),o.updateColor(c.e.EDGE_DIRECTION_COLOR),s.fillColor=c.e.EDGE_DIRECTION_COLOR;break}}}drawPoleRect(t,e,i){let a=new this._paper.Path.Rectangle({name:e,point:t,size:[i,i],strokeColor:c.e.EDGE_POLE_COLOR_NORAML,fillColor:c.e.EDGE_POLE_COLOR_NORAML});return this.addPath(a),this._editPole===e&&(a.strokeColor=c.e.EDGE_POLE_COLOR_SELECTED,a.fillColor=c.e.EDGE_POLE_COLOR_SELECTED),a.onMouseEnter=t=>{this.isEditable()&&(a.strokeColor=c.e.EDGE_POLE_COLOR_SELECTED,a.fillColor=c.e.EDGE_POLE_COLOR_SELECTED)},a.onMouseLeave=t=>{this.isEditable()&&(a.strokeColor=c.e.EDGE_POLE_COLOR_NORAML,a.fillColor=c.e.EDGE_POLE_COLOR_NORAML)},a.onMouseDown=t=>{if(this.isEditable()&&null!==this._editPoleCallback){if(this._editPole!==c.e.EDGE_POLE_NONE)return;return this._editPole=e,this._editPoleCallback(this.getID()),a.strokeColor=c.e.EDGE_POLE_COLOR_SELECTED,a.fillColor=c.e.EDGE_POLE_COLOR_SELECTED,this._lengthOnEditPole=this.curveLength(),t.stopPropagation(),!1}},a}drawEdgePole(){let t=new this._paper.Point(this._dat._sx,this._dat._sy),e=new this._paper.Point(this._dat._ex,this._dat._ey),i=c.e.EDGE_POLE_WIDTH*this.getItemScaling(),a=Object(c.q)(this._mapModel.mapToCanvas(t),new this._paper.Point(-i/2,-i/2)),s=Object(c.q)(this._mapModel.mapToCanvas(e),new this._paper.Point(-i/2,-i/2));this.drawPoleRect(a,c.e.EDGE_POLE_START,i),this.drawPoleRect(s,c.e.EDGE_POLE_END,i),t=null,e=null,a=null,s=null}yaw(t,e){return this._dat.yaw(this._mapModel.mapFromCanvas(t),this._mapModel.mapFromCanvas(e))}startToEndYaw(){return this.yaw(this.startScenePos(),this.endScenePos())}isSameDirection(){return this.edgeType()===c.e.EDGE_TYPE_BEZIER?Object(c.m)(this.yaw(this.startScenePos(),this.centerScenePos()),this.startFacing(),.1):Object(c.m)(this.yaw(this.startScenePos(),this.endScenePos()),this.startFacing(),.1)}name(){return"e"+this.getID()}edgeType(){return this._dat._type}edgePole(){return this._editPole}setEdgePole(t){this._editPole=t}radToEdge(t){let e=t.sceneUnitVector(),i=this.sceneUnitVector();return Math.acos(e.x*i.x+e.y*i.y)}sceneUnitVector(){let t=Object(c.s)(this.startScenePos(),this.endScenePos());return Object(c.r)(t,this.edgeLength())}isStartScenePos(t){let e=this._mapModel.mapFromCanvas(t);return this._dat.isStartPoint(e.x,e.y)}isEndScenePos(t){let e=this._mapModel.mapFromCanvas(t);return this._dat.isEndPoint(e.x,e.y)}isEdgeNodes(t,e){return!(!this.isStartNode(t)||!this.isEndNode(e))||this.isStartNode(e)&&this.isEndNode(t)}isAroundPos(t){return this.isOnEdge(t)}startScenePos(){return this._mapModel.mapToCanvas(this.startMapPos())}endScenePos(){return this._mapModel.mapToCanvas(this.endMapPos())}centerScenePos(){return this._mapModel.mapToCanvas(this.centerMapPos())}dScenePos(){return this._mapModel.mapToCanvas(this.dMapPos())}startMapPos(){return new this._paper.Point(this._dat._sx,this._dat._sy)}endMapPos(){return new this._paper.Point(this._dat._ex,this._dat._ey)}centerMapPos(){return new this._paper.Point(this._dat._cx,this._dat._cy)}dMapPos(){return new this._paper.Point(this._dat._dx,this._dat._dy)}setStartPos(t){let e=this._mapModel.mapFromCanvas(t);this._dat.setStartPoint(Object(c.x)(e.x),Object(c.x)(e.y))}setEndPos(t){let e=this._mapModel.mapFromCanvas(t);this._dat.setEndPoint(Object(c.x)(e.x),Object(c.x)(e.y))}setCenterPos(t){let e=this._mapModel.mapFromCanvas(t);this._dat.setCenterPoint(Object(c.x)(e.x),Object(c.x)(e.y))}setDPos(t){let e=this._mapModel.mapFromCanvas(t);this._dat.setDPoint(Object(c.x)(e.x),Object(c.x)(e.y))}setRadius(t){this._dat._radius=t}setNodeId(t){switch(this.edgePole()){case c.e.EDGE_POLE_START:this.setStartNodeId(t);break;case c.e.EDGE_POLE_END:this.setEndNodeId(t)}}setStartNodeId(t){this._dat.setStartNodeId(t)}setEndNodeId(t){this._dat.setEndNodeId(t)}setMapStartUnitVector(t){this._mapStartUnitVector=t}mapStartUnitVector(){return this._mapStartUnitVector}setMapEndUnitVector(t){this._mapEndUnitVector=t}mapEndUnitVector(){return this._mapEndUnitVector}startNodeId(){return this._dat._s_node}endNodeId(){return this._dat._e_node}nodeIds(){return this.startNodeId()+"@"+this.endNodeId()}isStartNode(t){return this._dat.isStartNode(t)}isEndNode(t){return this._dat.isEndNode(t)}setCost(t){this._dat._cost=t}startFacing(){return this._dat._s_facing}setStartFacing(t){this._dat._s_facing=t}endFacing(){return this._dat._e_facing}setEndFacing(t){this._dat._e_facing=t}getRobotDirection(){return this._dat._robot_direction}setRobotDirection(t){this._dat._robot_direction=t}}class H extends j{constructor(t,e){super(t,null,e),A()(this,"reset",()=>{this._startScenePos=new this._paper.Point(0,0),this._endScenePos=new this._paper.Point(0,0),this.setVisible(!1)}),A()(this,"setStartScenePos",t=>{this._startScenePos=t}),A()(this,"setEndScenePos",t=>{this._endScenePos=t}),this._startScenePos=new this._paper.Point(0,0),this._endScenePos=new this._paper.Point(0,0),this._callbackItemScenePos=null,this.setVisible(!1),this.setInteractionState(!1)}updateShape(){super.updateShape();let t=this.length(this._startScenePos,this._endScenePos),e=this.getItemScaling(),i=new this._paper.Point(this._startScenePos.x+t,this._startScenePos.y),a=this.arcThroughPoint(this._startScenePos,this._endScenePos),s=new this._paper.Path.Line({from:this._startScenePos,to:i,strokeColor:c.e.COLOR_DARK,strokeWidth:1*e,dashArray:[2*e,2*e]});s.arcTo(a,this._endScenePos);let n=this.referPosNextToEnd(),o=this.referPosNextToStart();s.lineTo(n),s.lineTo(o),s.closePath(),this.addPath(s);let r=new this._paper.Path.Circle({center:i,radius:1.5*e,strokeColor:"black",strokeWidth:2*e});this.addPath(r);let l=this.angle(),d=new this._paper.PointText({point:a,content:Math.abs(Math.round(l))+"Â°",fillColor:c.e.EDGE_COLOR_NORMAL,fontWeight:"normal",fontSize:this.getFontSize()});d.name=c.e.ITEM_PATH_NAME_TEXT,this.addPath(d);let h=this.length(this._startScenePos,this._endScenePos)/100,u=new this._paper.PointText({point:Object(c.r)(Object(c.q)(o,n),2),content:h.toFixed(2)+"m",fillColor:c.e.EDGE_COLOR_NORMAL,fontWeight:"normal",fontSize:this.getFontSize()});u.name=c.e.ITEM_PATH_NAME_TEXT,this.addPath(u)}startDraw(t){if(super.startDraw(t),this.setVisible(!0),this.setStartScenePos(t),this.setEndScenePos(t),null!==this._callbackItemScenePos){let e=this._callbackItemScenePos(t);null!==e&&(this.setStartScenePos(e.scenePos()),this.setEndScenePos(e.scenePos()))}}drawing(t){if(!this.isItemDrawing())return;if(this.length(this._startScenePos,t)<5)return;this.setEndScenePos(t);let e=this.angle();if((this.isCaptureOnAxis(e)||this._paper.Key.isDown("shift"))&&this.setEndScenePos(this.capturePoint()),null!==this._callbackItemScenePos){let e=this._callbackItemScenePos(t);null!==e&&this.setEndScenePos(e.scenePos())}this.updateShape()}endDraw(t){super.endDraw(t),this.reset()}setCallbackItemScenePos(t){this._callbackItemScenePos=t}delete(){super.delete()}length(t,e){let i=Object(c.s)(t,e),a=Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2));return i=null,a}capturePoint(){let t=this.length(this._startScenePos,this._endScenePos),e=this.angle(),i=new this._paper.Point(0,0);return Math.abs(e)<=45||Math.abs(e)>=135?(i.x=this._startScenePos.x+t*Math.cos(Object(c.b)(e)),i.y=this._startScenePos.y):(i.x=this._startScenePos.x,i.y=this._startScenePos.y+t*Math.sin(Object(c.b)(e))),i}isCaptureOnAxis(t){return Math.abs(t)<=c.e.ANGLE_CAPTURE_OFFSET||Math.abs(t+90)<=c.e.ANGLE_CAPTURE_OFFSET||Math.abs(t-90)<=c.e.ANGLE_CAPTURE_OFFSET||Math.abs(t-180)<=c.e.ANGLE_CAPTURE_OFFSET}arcThroughPoint(t,e){let i=new this._paper.Point(0,0),a=t,s=this.length(t,e),n=this.angle();return i.x=a.x+s*Math.cos(Object(c.b)(n/2)),i.y=a.y+s*Math.sin(Object(c.b)(n/2)),i}referPosNextToStart(){let t=this.getItemScaling(),e=new this._paper.Point(0,0),i=this._endScenePos.y-this._startScenePos.y,a=this.angle();return i>=0?(e.y=this._startScenePos.y+c.e.REFER_RECT_HEIGHT*t*Math.cos(Object(c.b)(a)),e.x=this._startScenePos.x-c.e.REFER_RECT_HEIGHT*t*Math.sin(Object(c.b)(a))):(e.y=this._startScenePos.y-c.e.REFER_RECT_HEIGHT*t*Math.cos(Object(c.b)(a)),e.x=this._startScenePos.x+c.e.REFER_RECT_HEIGHT*t*Math.sin(Object(c.b)(a))),e}referPosNextToEnd(){let t=this.getItemScaling(),e=new this._paper.Point(0,0),i=this._endScenePos.y-this._startScenePos.y,a=this.angle();return i>=0?(e.y=this._endScenePos.y+c.e.REFER_RECT_HEIGHT*t*Math.cos(Object(c.b)(a)),e.x=this._endScenePos.x-c.e.REFER_RECT_HEIGHT*t*Math.sin(Object(c.b)(a))):(e.y=this._endScenePos.y-c.e.REFER_RECT_HEIGHT*t*Math.cos(Object(c.b)(a)),e.x=this._endScenePos.x+c.e.REFER_RECT_HEIGHT*t*Math.sin(Object(c.b)(a))),e}angle(){let t=0,e=this._endScenePos.x-this._startScenePos.x,i=this._endScenePos.y-this._startScenePos.y;return Math.abs(e)<=.5?t=i>=0?90:-90:(t=Object(c.h)(Math.atan(i/e)),i>=0&&e<0?t=180+t:e<0&&i<0&&(t-=180)),Math.abs(t)<=c.e.ANGLE_CAPTURE_OFFSET&&(t=0),Math.abs(t+90)<=c.e.ANGLE_CAPTURE_OFFSET&&(t=-90),Math.abs(t-90)<=c.e.ANGLE_CAPTURE_OFFSET&&(t=90),Math.abs(t-180)<=c.e.ANGLE_CAPTURE_OFFSET&&(t=180),Math.abs(t+180)<=c.e.ANGLE_CAPTURE_OFFSET&&(t=-180),t}endScenePoint(){return this._endScenePos}startScenePoint(){return this._startScenePos}}class K extends W{constructor(t,e,i){super(t,e,i),this._isDrawingTangent=!1,this._referItem=new H(t,i)}updateShape(){if(super.updateShape(),null===this._dat||void 0===this._dat)return;let t=this.getStrokeColor(),e=this.getStrokeWidth(),i=this.getItemScaling();var a=this._mapModel.mapToCanvas(new this._paper.Point(this._dat._sx,this._dat._sy)),s=this._mapModel.mapToCanvas(new this._paper.Point(this._dat._ex,this._dat._ey)),n=Object(c.s)(a,s),o=new this._paper.Path;o.name=c.e.ITEM_PATH_NAME_MAIN_CURVE,o.add(a),o.add(s),o.strokeCap="round",o.strokeColor=t,o.strokeWidth=e,o.dashArray=this._dashArray;let r=o.length;var l=Object(c.q)(a,n.normalize(this.getArrowOffset())),d=new this._paper.Path;d.name=c.e.EDGE_PATH_NAME_LEFT_ARROW,d.add(l),d.lineBy(n.normalize(this.getArrowLineLength()).rotate(c.e.ARROW_LINE_ANGLE)),d.strokeColor=t,d.strokeWidth=e,d.strokeCap="round",d.visible=r>c.e.EDGE_ARROW_OFFSET_FROM_START;var h=new this._paper.Path;h.name=c.e.EDGE_PATH_NAME_RIGHT_ARROW,h.add(l),h.lineBy(n.normalize(this.getArrowLineLength()).rotate(-c.e.ARROW_LINE_ANGLE)),h.strokeColor=t,h.strokeWidth=e,h.strokeCap="round",h.visible=r>c.e.EDGE_ARROW_OFFSET_FROM_START;var u=new this._paper.PointText(Object(c.q)(l,Object(c.t)(new this._paper.Point(12,16),i)));u.style={fontSize:this.getFontSize(),fillColor:c.e.EDGE_COLOR_NORMAL,justification:"center"},u.name=c.e.ITEM_PATH_NAME_TEXT,u.content=this.getName(),this.addPath(o),this.addPath(d),this.addPath(h),this.addPath(u),this.setColor(this.getDisplayColor()),this.isSelected()&&!this.isItemDrawing()&&this.drawEdgePole(),this.doAfterUpdateShape()}updateEdge(t,e,i=!0,a=!0,s=!0){this.setStartPos(t),this.setEndScenePoint(e),this.updateDat(),s&&this.updateShape()}updateDat(){super.updateDat()}updateFacing(){let t=this.yaw(this.startScenePos(),this.endScenePos()),e=this.getRobotDirection();e===c.e.EDGE_DIR_BACKWARD?t=(t+Math.PI)%(2*Math.PI):e===c.e.EDGE_DIR_LEFT?t=(t+Math.PI/2)%(2*Math.PI):e===c.e.EDGE_DIR_RIGHT&&(t=(t-Math.PI/2)%(2*Math.PI)),this.setStartFacing(t),this.setEndFacing(t)}startDraw(t){super.startDraw(t),this._referItem.startDraw(t),this.updateEdge(this._referItem.startScenePoint(),this._referItem.startScenePoint())}drawing(t){super.drawing(t),this.isDrawTangent()?this._referItem.drawing(this.scenePosOnTangent(t)):this._referItem.drawing(t),this.updateEdge(this.startScenePos(),this._referItem.endScenePoint())}endDraw(t){super.endDraw(t),this.updateEdge(this.startScenePos(),this._referItem.endScenePoint()),this._referItem.endDraw(t)}setCallbackItemScenePos(t){this._referItem.setCallbackItemScenePos(t)}delete(){super.delete(),this._referItem.delete(),this._referItem=null}setEndScenePoint(t){this.isDrawTangent()?this.setEndPos(this.scenePosOnTangent(t)):this.setEndPos(t)}scenePosOnTangent(t){let e={},i=this.startMapPos(),a=this._mapModel.mapFromCanvas(t);Math.abs(this._mapStartUnitVector.x)>Math.abs(this._mapStartUnitVector.y)?(e.x=a.x-i.x,0===this._mapStartUnitVector.x?e.y=0:e.y=e.x*this._mapStartUnitVector.y/this._mapStartUnitVector.x):(e.y=a.y-i.y,0===this._mapStartUnitVector.y?e.x=0:e.x=e.y*this._mapStartUnitVector.x/this._mapStartUnitVector.y);let s=this._mapModel.mapToCanvas(Object(c.q)(i,e));return e=null,s}setDrawTangent(t){this._isDrawingTangent=t}isDrawTangent(){return this._isDrawingTangent}}class Q extends j{constructor(t,e,i){super(t,e,i),this._isDrawingTangent=!1,this._callbackItemScenePos=null,this._stationId=0,this._featureId=0,this._pathGroup.onMouseEnter=t=>{this.isEditable()&&(this.bringToFront(),this.isSelected()||this.isItemDrawing()||!this.isEditable()||this.setColor(c.e.ITEM_COLOR_HOVE))},this._pathGroup.onMouseLeave=t=>{this.isEditable()&&(this.setColor("#F47A88"),this.sendToBack())}}updateShape(){if(super.updateShape(),null===this._dat||void 0===this._dat)return;let t="#F47A88",e=this.getStrokeWidth();var i=this._mapModel.mapToCanvas(new this._paper.Point(this._dat._sx,this._dat._sy)),a=this._mapModel.mapToCanvas(new this._paper.Point(this._dat._ex,this._dat._ey)),s=new this._paper.Path;s.name=c.e.ITEM_PATH_NAME_MAIN_CURVE,s.add(i),s.add(a),s.strokeCap="round",s.strokeColor=t,s.strokeWidth=e,s.dashArray=[10,10],this.addPath(s),this.setColor(t),this.isSelected()&&!this.isItemDrawing()&&this.drawEdgePole(),this.doAfterUpdateShape()}updateDat(){super.updateDat()}updateFacing(){let t=this.yaw(this.startScenePos(),this.endScenePos()),e=this.getRobotDirection();e===c.e.EDGE_DIR_BACKWARD?t=(t+Math.PI)%(2*Math.PI):e===c.e.EDGE_DIR_LEFT?t=(t+Math.PI/2)%(2*Math.PI):e===c.e.EDGE_DIR_RIGHT&&(t=(t-Math.PI/2)%(2*Math.PI)),this.setStartFacing(t),this.setEndFacing(t)}startDraw(t){let e=this._mapModel.mapFromCanvas(t);this._dat._sx=e.x,this._dat._sy=e.y,super.startDraw(e)}drawing(t){let e=this._mapModel.mapFromCanvas(t);this._dat._ex=e.x,this._dat._ey=e.y,super.drawing(e),this.updateShape()}endDraw(t){let e=this._mapModel.mapFromCanvas(t);this._dat._ex=e.x,this._dat._ey=e.y,super.endDraw(e),this.updateShape()}delete(){super.delete()}setStartScenePoint(t){let e=this._mapModel.mapFromCanvas(t);this._dat._sx=e.x,this._dat._sy=e.y}setEndScenePoint(t){let e=this._mapModel.mapFromCanvas(t);this._dat._ex=e.x,this._dat._ey=e.y}moveBy(t){}setStationId(t){this._stationId=t}getStationId(){return this._stationId}setFeatureId(t){this._featureId=t}getFeatureId(){return this._featureId}}var X=i("5044"),J=i("881e"),Z=i("2d22");class tt extends W{constructor(t,e,i){super(t,e,i),this.setMapStartUnitVector(Object(c.r)(Object(c.s)(this.startMapPos(),this.centerMapPos()),Object(c.n)(this.startMapPos(),this.centerMapPos()))),this.setMapEndUnitVector(Object(c.r)(Object(c.s)(this.dMapPos(),this.endMapPos()),Object(c.n)(this.dMapPos(),this.endMapPos())))}updateShape(){if(super.updateShape(),null===this._dat||void 0===this._dat)return;let t=this.getStrokeColor(),e=this.getStrokeWidth(),i=this.getItemScaling();var a=this._mapModel.mapToCanvas(new this._paper.Point(this._dat._sx,this._dat._sy)),s=this._mapModel.mapToCanvas(new this._paper.Point(this._dat._ex,this._dat._ey)),n=this._mapModel.mapToCanvas(new this._paper.Point(this._dat._cx,this._dat._cy)),o=this._mapModel.mapToCanvas(new this._paper.Point(this._dat._dx,this._dat._dy)),r=new this._paper.Path;r.name=c.e.ITEM_PATH_NAME_MAIN_CURVE,r.add(a),r.cubicCurveTo(n,o,s),r.strokeColor=t,r.strokeWidth=e,r.strokeCap="round",r.dashArray=this._dashArray;var l=Object(c.s)(a,s),d=Object(c.q)(a,l.normalize(this.getArrowOffset())),h=new this._paper.Path;h.add(a),h.add(d),h.strokeColor=t,h.strokeWidth=e,h.strokeCap="round";var u=new this._paper.Path;u.name=c.e.EDGE_PATH_NAME_LEFT_ARROW,u.add(d),u.lineBy(l.normalize(this.getArrowLineLength()).rotate(c.e.ARROW_LINE_ANGLE)),u.strokeColor=t,u.strokeWidth=e,u.strokeCap="round";var p=new this._paper.Path;p.name=c.e.EDGE_PATH_NAME_RIGHT_ARROW,p.add(d),p.lineBy(l.normalize(this.getArrowLineLength()).rotate(-c.e.ARROW_LINE_ANGLE)),p.strokeColor=t,p.strokeWidth=e,p.strokeCap="round";var m=new this._paper.PointText(Object(c.q)(d,Object(c.t)(new this._paper.Point(12,16),i)));if(m.name=c.e.ITEM_PATH_NAME_TEXT,m.style={fontSize:this.getFontSize(),fillColor:c.e.EDGE_COLOR_NORMAL,justification:"center"},m.content=this.getName(),this.addPath(r),this.addPath(h),this.addPath(u),this.addPath(p),this.addPath(m),this.setColor(this.getDisplayColor()),this.isSelected()&&!this.isItemDrawing()&&this.drawEdgePole(),this.isSelected()){let t=c.e.EDGE_POLE_WIDTH*this.getItemScaling(),r=new this._paper.Path.Line({from:a,to:n,strokeColor:c.e.COLOR_DARK,strokeWidth:e,dashArray:[4*i,2*i]});this.addPath(r);let l=new this._paper.Point(-t/2,-t/2),d=new this._paper.Path.Rectangle({name:c.e.EDGE_POLE_C,point:Object(c.q)(n,l),size:[t,t],strokeWidth:e,strokeColor:"blue",fillColor:"white"});d.onMouseDown=t=>{if(this.isEditable()&&null!==this._editPoleCallback){if(this._editPole!==c.e.EDGE_POLE_NONE)return;return this._editPole=c.e.EDGE_POLE_C,this._editPoleCallback(this.getID()),d.fillColor="red",t.stopPropagation(),!1}},this._editPole===c.e.EDGE_POLE_C&&(d.fillColor="red");let h=new this._paper.Path.Line({from:o,to:s,strokeColor:c.e.COLOR_DARK,strokeWidth:e,dashArray:[4*i,2*i]});this.addPath(h);let u=new this._paper.Path.Rectangle({name:c.e.EDGE_POLE_D,point:Object(c.q)(o,l),size:[t,t],strokeWidth:e,strokeColor:"blue",fillColor:"white"});this._editPole===c.e.EDGE_POLE_D&&(u.fillColor="red"),u.onMouseDown=t=>{if(this.isEditable()&&null!==this._editPoleCallback){if(this._editPole!==c.e.EDGE_POLE_NONE)return;return this._editPole=c.e.EDGE_POLE_D,this._editPoleCallback(this.getID()),u.fillColor="red",t.stopPropagation(),!1}},this.addPath(u),this.addPath(d),l=null}this.doAfterUpdateShape()}updateEdge(t,e,i=!0,a=!0,s=!0){this.setStartPos(t),this.setEndPos(e);let n=Object(c.r)(Object(c.q)(t,e),2);if(i){let t=this.getCenterPos(n);this.setCenterPos(t)}if(a){let t=this.getDPos(n);this.setDPos(t)}this.updateDat(),s&&this.updateShape()}updateDat(){super.updateDat()}updateFacing(){let t=this.yaw(this.startScenePos(),this.centerScenePos()),e=this.yaw(this.dScenePos(),this.endScenePos()),i=this.getRobotDirection();i===c.e.EDGE_DIR_BACKWARD?(t=(t+Math.PI)%(2*Math.PI),e=(e+Math.PI)%(2*Math.PI)):i===c.e.EDGE_DIR_LEFT?(t=(t+Math.PI/2)%(2*Math.PI),e=(e+Math.PI/2)%(2*Math.PI)):i===c.e.EDGE_DIR_RIGHT&&(t=(t-Math.PI/2)%(2*Math.PI),e=(e-Math.PI/2)%(2*Math.PI)),this.setStartFacing(t),this.setEndFacing(e)}startDraw(t){super.startDraw(t),this.setStartPos(t),this.setCenterPos(t),this.setDPos(t),this.setEndPos(t)}drawing(t){this.isItemDrawing()&&this.updateEdge(this.startScenePos(),t)}endDraw(t){super.endDraw(t),this.updateEdge(this.startScenePos(),t)}getOnEdgePos(t,e,i){let a={},s=this._mapModel.mapFromCanvas(i);return Math.abs(t.x)>Math.abs(t.y)?(a.x=s.x-e.x,Math.abs(a.x)<c.e.BEZIER_CONTROL_POINT_MIN_OFFSET&&(a.x>=0?a.x=c.e.BEZIER_CONTROL_POINT_MIN_OFFSET:a.x=-c.e.BEZIER_CONTROL_POINT_MIN_OFFSET),0===t.x?a.y=0:a.y=a.x*t.y/t.x):(a.y=s.y-e.y,Math.abs(a.y)<c.e.BEZIER_CONTROL_POINT_MIN_OFFSET&&(a.y>=0?a.y=c.e.BEZIER_CONTROL_POINT_MIN_OFFSET:a.y=-c.e.BEZIER_CONTROL_POINT_MIN_OFFSET),0===t.y?a.x=0:a.x=a.y*t.x/t.y),this._mapModel.mapToCanvas(Object(c.q)(e,a))}getCenterPos(t){return null==this._mapStartUnitVector?t:this.getOnEdgePos(this._mapStartUnitVector,this.startMapPos(),t)}getDPos(t){return null==this._mapEndUnitVector?t:this.getOnEdgePos(this._mapEndUnitVector,this.endMapPos(),t)}adjustPole(t){switch(this._editPole){case c.e.EDGE_POLE_C:{let e=this.getCenterPos(t);this.setCenterPos(e),this.updateShape();break}case c.e.EDGE_POLE_D:{let e=this.getDPos(t);this.setDPos(e),this.updateShape();break}case c.e.EDGE_POLE_START:{let e=this.endScenePos(),i=this.startScenePos(),a=Object(c.s)(i,t);this.setMapStartUnitVector(null),this.setMapEndUnitVector(this.mapUnitVector(this.curveLength())),this.setCenterPos(Object(c.q)(this.centerScenePos(),a)),this.updateEdge(t,e,!1,!0);break}case c.e.EDGE_POLE_END:{let e=this.startScenePos();this.setMapEndUnitVector(null),this.setMapStartUnitVector(this.mapUnitVector(0)),this.updateEdge(e,t);break}}}finishEditPole(t){switch(this._editPole){case c.e.EDGE_POLE_START:this.setMapStartUnitVector(t),this.updateEdge(this.startScenePos(),this.endScenePos());break;case c.e.EDGE_POLE_END:this.setMapEndUnitVector(t),this.updateEdge(this.startScenePos(),this.endScenePos())}super.finishEditPole(t)}}var et=i("8847"),it=i("750b"),at=i("dde5");class st extends j{constructor(t,e,i,a){super(t,e,i),this._adjustSide=c.e.RECT_SIDE_NONE,this._mousePressed=!1,this._vueParent=a,this.setStrokeWidth(2),this.setStrokeColor(c.e.SELECT_AREA_COLOR)}updateShape(){if(super.updateShape(),!this._dat)return;const t=this.getItemScaling(),e=this._areaFillColor(),i=this._mapModel.mapToCanvas(new this._paper.Point(this._dat._pa._x,this._dat._pa._y)),a=this._mapModel.mapToCanvas(new this._paper.Point(this._dat._pc._x,this._dat._pc._y)),s=new this._paper.Path.Rectangle(i,a);if(s.name=c.e.ITEM_PATH_NAME_MAIN_CURVE,this.addPath(s),s.strokeWidth=0,s.fillColor=e,s.fillColor.alpha=.25,s.strokeColor=this.getStrokeColor(),this._dat.isCleanArea())return void(this.isItemDrawing()?(s.strokeWidth=this.getStrokeWidth(),s.dashArray=[4,2],s.strokeColor=this.getStrokeColor(),s.fillColor.alpha=0):s.fillColor.alpha=1);this._dat.isNoteAreaModel()&&(s.fillColor.alpha=this._dat._style.opacity),s.onMouseDown=t=>{this.isEditable()&&(this._mousePressed=!0)},s.onMouseUp=t=>{this.isEditable()&&(this._mousePressed=!1)},s.onMouseMove=t=>{if(!this.isEditable()||!this.isSelected())return;let e=t.point.x,i=t.point.y,a=s.bounds,n=a.left,o=a.right,r=a.top,l=a.bottom;Math.abs(e-n)<c.e.RECT_CAPTURE_OFFSET?Math.abs(i-r)<c.e.RECT_CAPTURE_OFFSET?this.setAdjustSide(c.e.RECT_SIDE_TOP_LEFT):Math.abs(i-l)<c.e.RECT_CAPTURE_OFFSET?this.setAdjustSide(c.e.RECT_SIDE_BOTTOM_LEFT):this.setAdjustSide(c.e.RECT_SIDE_LEFT):Math.abs(e-o)<c.e.RECT_CAPTURE_OFFSET?Math.abs(i-r)<c.e.RECT_CAPTURE_OFFSET?this.setAdjustSide(c.e.RECT_SIDE_TOP_RIGHT):Math.abs(i-l)<c.e.RECT_CAPTURE_OFFSET?this.setAdjustSide(c.e.RECT_SIDE_BOTTOM_RIGHT):this.setAdjustSide(c.e.RECT_SIDE_RIGHT):Math.abs(i-r)<c.e.RECT_CAPTURE_OFFSET?this.setAdjustSide(c.e.RECT_SIDE_TOP):Math.abs(i-l)<c.e.RECT_CAPTURE_OFFSET?this.setAdjustSide(c.e.RECT_SIDE_BOTTOM):this.setAdjustSide(c.e.RECT_SIDE_INSIDE)},s.onMouseLeave=t=>{this.isEditable()&&(this._mousePressed||this.setAdjustSide(c.e.RECT_SIDE_NONE))},s.onMouseDrag=t=>{if(!this.isEditable())return;this._mousePressed=!0;let e=t.point;switch(this._adjustSide){case c.e.RECT_SIDE_TOP_LEFT:this.setPa({x:e.x,y:e.y});break;case c.e.RECT_SIDE_TOP:this.setPa({x:this.scenePa().x,y:e.y});break;case c.e.RECT_SIDE_TOP_RIGHT:this.setPa({x:this.scenePa().x,y:e.y}),this.setPc({x:e.x,y:this.scenePc().y});break;case c.e.RECT_SIDE_RIGHT:this.setPc({x:e.x,y:this.scenePc().y});break;case c.e.RECT_SIDE_BOTTOM_RIGHT:this.setPc({x:e.x,y:e.y});break;case c.e.RECT_SIDE_BOTTOM:this.setPc({x:this.scenePc().x,y:e.y});break;case c.e.RECT_SIDE_BOTTOM_LEFT:this.setPa({x:e.x,y:this.scenePa().y}),this.setPc({x:this.scenePc().x,y:e.y});break;case c.e.RECT_SIDE_LEFT:this.setPa({x:e.x,y:this.scenePa().y})}this.updateDat(),this.updateShape(),this._adjustSide!==c.e.RECT_SIDE_NONE&&this._vueParent.recordHistory("AreaItem areaPath.onMouseDrag _adjustSide RECT_SIDE_: "+this._adjustSide)};const n=s.bounds;this.drawAreaHeaderText(n,t),this.drawAreaBodyText(n,t),this.drawBoundaryPath(),this.updateBoundaryStyle(),this.doAfterUpdateShape(),s.bringToFront()}updateDat(){let t=new this._paper.Rectangle(this.scenePa(),this.scenePc());this.updateRect(t)}updateRect(t){this.setPa(t.topLeft),this.setPc(t.bottomRight),this.setPb(t.topRight),this.setPd(t.bottomLeft)}startDraw(t){super.startDraw(t),this.setPa(t),this.setPc(t)}drawing(t){super.drawing(t),this.isItemDrawing()&&(this.setPc(t),this.updateShape())}endDraw(t){super.endDraw(t),this.setPc(t),this.updateDat(),this.updateShape()}checkRectPaKeepAwayPc(t){return this.setPc(t),this._dat.checkRectPaKeepAwayPc()}moveBy(t){super.moveBy(t),this.setPa(Object(c.q)(this.scenePa(),t)),this.setPb(Object(c.q)(this.scenePb(),t)),this.setPc(Object(c.q)(this.scenePc(),t)),this.setPd(Object(c.q)(this.scenePd(),t))}moveTo(t){super.moveBy(t),this.setPc(Object(c.q)(Object(c.s)(this.scenePc(),this.scenePa()).abs(),t)),this.setPb(Object(c.q)(Object(c.s)(this.scenePb(),this.scenePa()).abs(),t)),this.setPa(t),this.setPd(Object(c.q)(Object(c.s)(this.scenePd(),this.scenePa()).abs(),t)),this.updateShape()}scenePos(){return this.childPath(c.e.ITEM_PATH_NAME_MAIN_CURVE).bounds.center}setSelectedState(t){this._dat.isCleanArea()||(super.setSelectedState(t),this.updateBoundaryStyle(),t||this.setAdjustSide(c.e.RECT_SIDE_NONE))}drawBoundaryPath(){let t=this.childPath(c.e.ITEM_PATH_NAME_MAIN_CURVE).bounds,e=new this._paper.Path.Line(t.topLeft,t.topRight);e.name=c.e.AREA_PATH_NAME_BD,e.strokeWidth=this.getStrokeWidth(),e.strokeColor=this._areaFillColor(),e.lineTo(t.bottomRight),e.lineTo(t.bottomLeft),e.closePath(),this.addPath(e)}updateBoundaryStyle(){this.isSelected()?this.childPath(c.e.AREA_PATH_NAME_BD).dashArray=[6,4]:this.childPath(c.e.AREA_PATH_NAME_BD).dashArray=null}areaTypeName(){var t=et.b.t("label.userDefined");let e=this.itemType();if(e===c.e.MODEL_TYPE_FUNC_AREA)t=Object(it.c)(this._dat._type)||et.b.t("label.regionTypeReserved");else if(e===c.e.MODEL_TYPE_REDRAW_AREA)t=et.b.t("label.redrawRegion");else if(e===c.e.MODEL_TYPE_NOTE_AREA)t=et.b.t("label.noteArea");else if(e===c.e.MODEL_TYPE_LOCATION_AREA){var i;t=`${et.b.t("label.locationArea")}-${null===(i=Object(d.s)().find(t=>t.value===this._dat._type))||void 0===i?void 0:i.label}`}return t}getName(){return this._dat._name||this.areaTypeName()+this.getID()}getStrokeColor(){var t="#50616d";let e=this.itemType();if(e===c.e.MODEL_TYPE_FUNC_AREA)switch(this._dat._type){case c.e.AREA_TYPE_NO_ENTER:t="#F0B3BA";break;case c.e.AREA_TYPE_SPEED_LEVEL_20:case c.e.AREA_TYPE_SPEED_LEVEL_40:case c.e.AREA_TYPE_SPEED_LEVEL_60:case c.e.AREA_TYPE_SPEED_LEVEL_80:t="#D0C2A4";break;case c.e.AREA_TYPE_DISABLE_OBA:t="#B8EAE8";break;case c.e.AREA_TYPE_DISABLE_ROTATE:t="#F2C8B1";break;case c.e.AREA_TYPE_DISABLE_REROUTE:t="#F7BBE5";break;case c.e.AREA_TYPE_LIMIT_CAR_NUMBER:t="#FFBB83";break;case c.e.AREA_TYPE_ONEWAY_TRAFFIC:t="#C0ACF7";break;case c.e.AREA_TYPE_LOCAL_REPLAN:t="#7FCEC7";break;case c.e.AREA_TYPE_USER_DEFINE:t="#C6B5A7"}else t=e===c.e.MODEL_TYPE_CLEAN_AREA?this.isItemDrawing()?"#539CFF":"#BFEFFF":e===c.e.MODEL_TYPE_REDRAW_AREA?"#FFCC66":"#C4C4C4";return t}_areaFillColor(){var t="#50616d";let e=this.itemType();if(e===c.e.MODEL_TYPE_FUNC_AREA)switch(this._dat._type){case c.e.AREA_TYPE_NO_ENTER:t="#F0B3BA";break;case c.e.AREA_TYPE_SPEED_LEVEL_20:case c.e.AREA_TYPE_SPEED_LEVEL_40:case c.e.AREA_TYPE_SPEED_LEVEL_60:case c.e.AREA_TYPE_SPEED_LEVEL_80:t="#D0C2A4";break;case c.e.AREA_TYPE_DISABLE_OBA:t="#B8EAE8";break;case c.e.AREA_TYPE_DISABLE_ROTATE:t="#F2C8B1";break;case c.e.AREA_TYPE_DISABLE_REROUTE:t="#F7BBE5";break;case c.e.AREA_TYPE_LIMIT_CAR_NUMBER:t="#FFBB83";break;case c.e.AREA_TYPE_ONEWAY_TRAFFIC:t="#C0ACF7";break;case c.e.AREA_TYPE_LOCAL_REPLAN:t="#7FCEC7";break;case c.e.AREA_TYPE_USER_DEFINE:t="#C6B5A7"}else if(e===c.e.MODEL_TYPE_CLEAN_AREA)t=this.isItemDrawing()?"#BFEFFF":"#F0F1F5";else if(e===c.e.MODEL_TYPE_REDRAW_AREA)t="#FFCC66";else if(e===c.e.MODEL_TYPE_NOTE_AREA)t=this._dat._style.backgroundColor;else if(e===c.e.MODEL_TYPE_LOCATION_AREA){var i;t=null!==(i={[c.e.LOCATION_AREA_TYPE_LIMIT_JUMP]:"#808001",[c.e.LOCATION_AREA_TYPE_LIMIT_MAP_UPDATE]:"#0e0eff",[c.e.LOCATION_AREA_TYPE_LONG_CORRIDOR]:"#fea21a",[c.e.LOCATION_AREA_TYPE_CRASH_BARRIER]:"#ffff00",[c.e.LOCATION_AREA_TYPE_ERASE]:"#fe1f1f",[c.e.LOCATION_AREA_TYPE_MOVING_OBJECT]:"#36909b",[c.e.LOCATION_AREA_TYPE_ODOM]:"#902190",[c.e.LOCATION_AREA_TYPE_QRCODE]:"#737329"}[this._dat._type])&&void 0!==i?i:"#808001"}else t="#C4C4C4";return t}delete(){super.delete();let t=this._dat._id;switch(this.itemType()){case c.e.MODEL_TYPE_FUNC_AREA:this._mapModel.deleteArea(t);break;case c.e.MODEL_TYPE_REDRAW_AREA:this._mapModel.deleteRedrawArea(t);break;case c.e.MODEL_TYPE_CLEAN_AREA:this._mapModel.deleteCleanArea(t);break;case c.e.MODEL_TYPE_NOTE_AREA:this._mapModel.deleteNoteArea(t)}}setAdjustSide(t){switch(t){case c.e.RECT_SIDE_TOP_LEFT:Object(c.w)("nw-resize");break;case c.e.RECT_SIDE_TOP:Object(c.w)("n-resize");break;case c.e.RECT_SIDE_TOP_RIGHT:Object(c.w)("ne-resize");break;case c.e.RECT_SIDE_RIGHT:Object(c.w)("e-resize");break;case c.e.RECT_SIDE_BOTTOM_RIGHT:Object(c.w)("se-resize");break;case c.e.RECT_SIDE_BOTTOM:Object(c.w)("s-resize");break;case c.e.RECT_SIDE_BOTTOM_LEFT:Object(c.w)("sw-resize");break;case c.e.RECT_SIDE_LEFT:Object(c.w)("w-resize");break;default:Object(c.w)("default")}this._adjustSide=t}setPa(t){let e=this._mapModel.mapFromCanvas(t);this._dat.setPa(e.x,e.y),e=null}setPc(t){let e=this._mapModel.mapFromCanvas(t);this._dat.setPc(e.x,e.y),e=null}setPb(t){let e=this._mapModel.mapFromCanvas(t);this._dat.setPb(e.x,e.y),e=null}setPd(t){let e=this._mapModel.mapFromCanvas(t);this._dat.setPd(e.x,e.y),e=null}mapPa(){return{x:this._dat._pa._x,y:this._dat._pa._y}}mapPb(){return{x:this._dat._pb._x,y:this._dat._pb._y}}mapPc(){return{x:this._dat._pc._x,y:this._dat._pc._y}}mapPd(){return{x:this._dat._pd._x,y:this._dat._pd._y}}scenePa(){let t=this._mapModel.mapToCanvas(this.mapPa()),e=new this._paper.Point({x:t.x,y:t.y});return t=null,e}scenePb(){let t=this._mapModel.mapToCanvas(this.mapPb()),e=new this._paper.Point({x:t.x,y:t.y});return t=null,e}scenePc(){let t=this._mapModel.mapToCanvas(this.mapPc()),e=new this._paper.Point({x:t.x,y:t.y});return t=null,e}scenePd(){let t=this._mapModel.mapToCanvas(this.mapPd()),e=new this._paper.Point({x:t.x,y:t.y});return t=null,e}drawAreaHeaderText(t,e){const i=Object(c.q)(t.topLeft,Object(c.t)(new this._paper.Point(8,12),e)),a=new this._paper.PointText(i);a.name=c.e.ITEM_PATH_NAME_TEXT,a.style={fontSize:this.getFontSize(),fillColor:"#177cb0",justification:"left"},a.content=`#${this._dat.isFuncAreaModel()?this.getName():this.areaTypeName()}#`,this.addPath(a)}drawAreaBodyText(t,e){const i=this._dat.isFuncAreaModel()&&this._dat._type===c.e.AREA_TYPE_USER_DEFINE?(()=>{const t=[];let e=[...this._dat._area_group];Object.keys(this._dat._oba_define_params).length>1&&t.push(et.b.t("label.specialAvoidanceArea")),e.forEach(e=>{const i=Object(it.c)(e);i&&t.push(i)});Object(at.p)("minus",e,it.a).length>0&&t.push(et.b.t("label.regionTypeReserved"));return-1!==this._dat._volume&&t.push(et.b.t("label.musicControlRegion")),t})():[this.areaTypeName()],a={fillColor:"#177cb0",fontSize:this.getFontSize(),justification:"left"},{height:s,topLeft:n}=t;if(this._dat.isFuncAreaModel())for(let t=0,o=i.length;t<o;t++){const r=25+13*t,l=t+1>=o||r+13<=s,d=Object(c.q)(n,Object(c.t)(new this._paper.Point(8,r),e)),h=new this._paper.PointText(d);if(h.name=c.e.ITEM_PATH_NAME_TEXT,h.style=a,h.content=`${i[t]}${l?"":"..."}`,this.addPath(h),!l)break}else this.drawAreaNameText(t,e)}drawAreaNameText(t,e){let i=this.getFontSize(),a="#177cb0",s="left";const n=this._dat.isNoteAreaModel();n&&(i=e*this._dat._style.fontSize,a=this._dat._style.color,s=this._dat._style.justifyContent);const o=n?i+16:28,r=Object(c.q)(t.topLeft,Object(c.t)(new this._paper.Point(8,o),e)),l=new this._paper.PointText({point:r,name:c.e.ITEM_PATH_NAME_TEXT,content:this.getName(),fontSize:i,fillColor:a,justifyContent:s}),{width:d,height:h}=l.bounds;if(n){"right"===s?l.position.x=t.right-d/2-8:"center"===s&&(l.position.x=t.center.x);const{alignItems:e}=this._dat._style;"bottom"===e?l.position.y=t.bottom-h/2-8:"center"===e&&(l.position.y=t.center.y)}this.addPath(l)}}class nt extends j{constructor(t,e,i){super(t,e,i),this._editPoint=c.e.STATION_POINT_NONE,this._pointPathGroup=new this._paper.Group,this._callbackEditPoint=null,this._enterPosDistance=0,this._exitPosDistance=0,this._isAbnormal=!1,this.setStrokeWidth(c.e.STATION_STOKE_WIDTH),this.setStrokeColor(this._stationColor(this._dat._type)),this.setSelectedColor(c.e.ITEM_COLOR_SELECTED),this._pathGroup.onMouseEnter=t=>{this.isSelected()||this.setColor(c.e.ITEM_COLOR_HOVE)},this._pathGroup.onMouseLeave=t=>{this.isSelected()||this.setColor(this.getDisplayColor())}}updateShape(){if(super.updateShape(),null===this._dat||void 0===this._dat)return;let t=this.getItemScaling(),e=c.e.ARROW_LINE_LENGTH*t*.8,i=this.getStrokeColor();var a=this.scenePos();let s=c.e.STATION_RADIUS*t,n=this.getStrokeWidth();var o=this.yaw(),r=a.x+c.e.STATION_ARROW_FROM_START*t*Math.cos(o),l=a.y-c.e.STATION_ARROW_FROM_START*t*Math.sin(o),d=new this._paper.Path.Circle(a,s);d.fillColor=new this._paper.Color(255,255,255,.1),d.name=c.e.ITEM_PATH_NAME_MAIN_CURVE,d.strokeWidth=n,d.strokeColor=i;var h=new this._paper.Path;h.name=c.e.STATION_PATH_NAME_DIRECTION;var u=new this._paper.Point(r,l);h.add(a),h.add(u),h.strokeWidth=n,h.strokeColor=i,h.strokeCap="round";var p=new this._paper.Path;p.name=c.e.STATION_PATH_NAME_LEFT_ARROW;var m=Object(c.s)(a,u);p.add(u),p.lineBy(m.normalize(e).rotate(-c.e.ARROW_LINE_ANGLE)),p.strokeWidth=n,p.strokeColor=i,p.strokeJoin="miter",p.strokeCap="round";var f=new this._paper.Path;f.name=c.e.STATION_PATH_NAME_RIGHT_ARROW,f.add(u),f.lineBy(m.normalize(e).rotate(c.e.ARROW_LINE_ANGLE)),f.strokeWidth=n,f.strokeColor=i,f.strokeJoin="miter",f.strokeCap="round";var g=new this._paper.PointText(Object(c.q)(a,Object(c.t)(new this._paper.Point(2*c.e.STATION_RADIUS+4,0),t)));g.name=c.e.ITEM_PATH_NAME_TEXT,g.style={strokeWidth:1,fontSize:this.getFontSize(),fillColor:i,justification:"center"},g.content="# "+this._dat._id;var _=new this._paper.PointText(Object(c.q)(a,Object(c.t)(new this._paper.Point(2*c.e.STATION_RADIUS+4,16),t)));_.name=c.e.ITEM_PATH_NAME_TEXT,_.style={fontSize:this.getFontSize(),fillColor:i,justification:"center"},_.content=this.getName(),this.addPath(d),this.addPath(h),this.addPath(p),this.addPath(f),this.addPath(g),this.addPath(_),this.setColor(this.getDisplayColor()),this.updatePoints(),this.doAfterUpdateShape()}updatePoints(){this.removePointsPath(),this.edgeId()>0||(this._dat.isNoRotate()&&(this.drawPoint(c.e.STATION_POINT_ENTER),this.drawPoint(c.e.STATION_POINT_EXIT)),this._dat.isPosDynamic()&&this.drawPoint(c.e.STATION_POINT_CHECK))}getDMCodeID(){return this._dat.getDMCodeID()}setDMCodeOffset(t,e,i,a){this._dat.setDMCodeOffset(t,e,i,a)}setPointPos(t){let e=this.getPointOnLine(t);this._editPoint===c.e.STATION_POINT_ENTER?this.setEnterPos(e):this._editPoint===c.e.STATION_POINT_EXIT?this.setExitPos(e):this._editPoint===c.e.STATION_POINT_CHECK&&this.setCheckPos(e),this.updatePoints()}initPointsDistance(){this._enterPosDistance=Object(c.n)(this.scenePos(),this.sceneEnterPos())*this._getSignMark(this.sceneEnterPos()),this._exitPosDistance=Object(c.n)(this.scenePos(),this.sceneExitPos())*this._getSignMark(this.sceneExitPos())}finishSetPoints(t){this._editPoint===c.e.STATION_POINT_ENTER?this._enterPosDistance=Object(c.n)(this.scenePos(),this.sceneEnterPos())*this._getSignMark(this.sceneEnterPos()):this._editPoint===c.e.STATION_POINT_EXIT?this._exitPosDistance=Object(c.n)(this.scenePos(),this.sceneExitPos())*this._getSignMark(this.sceneExitPos()):(this._editPoint,c.e.STATION_POINT_CHECK),this._editPoint=c.e.STATION_POINT_NONE}startDraw(t){this.setInteractionState(!1)}drawing(t){super.drawing(t),this.isItemDrawing()?this.updateYaw(this.scenePos(),t):this.setScenePos(t),this.updateShape()}endDraw(t){super.endDraw(t),this.setInteractionState(!0),0!==this.edgeId()&&this.setScenePos(t),this.updateShape()}updateYaw(t,e){let i=Object(c.s)(t,e);if(Math.abs(i.x)<3&&Math.abs(i.y)<3)return;let a=Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2)),s=Math.acos(i.x/a);i.y>0&&(s=2*Math.PI-s),s=Math.round(Object(c.h)(s)),this.setYaw(Object(c.b)(s))}moveBy(t){super.moveBy(t),this.setScenePos(Object(c.q)(this.scenePos(),t),!1),this.updatePointsPos(t)}updatePointsPos(t){this.edgeId()<=0&&(this._dat.isNoRotate()&&(this.isEnterPointNull()||this.setEnterPos(this._getScenePosFromCenter(this._enterPosDistance)),this.isExitPointNull()||this.setExitPos(this._getScenePosFromCenter(this._exitPosDistance))),this._dat.isPosDynamic()&&(this.isCheckPointNull()||this.setCheckPos(Object(c.q)(this.sceneCheckPos(),t))))}getDisplayColor(){return this.isSelected()?c.e.ITEM_COLOR_SELECTED:this._stationColor(this._dat._type)}_stationColor(t){if(this._isAbnormal)return c.e.ITEM_COLOR_ERROR;let e=c.e.STATION_COLOR_USER_DEFINE;switch(t){case c.e.STATION_TYPE_DEFAULT:e=c.e.STATION_COLOR_DEFAULT;break;case c.e.STATION_TYPE_CHARGE:e=c.e.STATION_COLOR_CHARGE;break;case c.e.STATION_TYPE_DOCK:e=c.e.STATION_COLOR_DOCK;break;case c.e.STATION_TYPE_WORK:e=c.e.STATION_COLOR_WORK;break;case c.e.STATION_TYPE_WAREROOM:e=c.e.STATION_COLOR_WAREROOM;break;case c.e.STATION_TYPE_AVOID:e=c.e.STATION_COLOR_AVOID;break;case c.e.STATION_TYPE_RACK:e=c.e.STATION_COLOR_RACK;break;case c.e.STATION_TYPE_USER_DEFINE:e=c.e.STATION_COLOR_USER_DEFINE}return e}drawPoint(t){let e=this.scenePos(),i=this.pointColor(t),a=this.scenePoint(t);if(!Object(c.u)(a)){let s=new this._paper.Group,n=new this._paper.Path.Line({from:e,to:a,strokeWidth:2,strokeColor:"grey",dashArray:[2,4]});n.strokeScaling=!0,s.addChild(n);let o=new this._paper.Path.Circle({center:a,radius:5*this.getItemScaling(),fillColor:"white",strokeColor:i});o.strokeScaling=!0,s.addChild(o);let r=new this._paper.PointText(Object(c.q)(a,{x:8,y:4}));r.style={fontSize:this.getFontSize(),fillColor:i,justification:"left"},r.name=c.e.ITEM_PATH_NAME_TEXT,r.content=t,s.addChild(r),this._pointPathGroup.addChild(s),s.onMouseEnter=t=>{n.strokeColor=c.e.ITEM_COLOR_HOVE,o.strokeColor=c.e.ITEM_COLOR_HOVE,r.fillColor=c.e.ITEM_COLOR_HOVE},s.onMouseLeave=t=>{n.strokeColor="grey",o.strokeColor=i,r.fillColor=i},s.onMouseDown=e=>{if(this.isEditable()&&this._editPoint===c.e.STATION_POINT_NONE&&null!=this._callbackEditPoint)return this._callbackEditPoint(this.getID()),this._editPoint=t,e.stopPropagation(),!1}}}scenePoint(t){let e=this.getPointOnLine(Object(c.q)(this.scenePos(),{x:50,y:50}));return t===c.e.STATION_POINT_ENTER?this.isEnterPointNull()||(e=this.sceneEnterPos()):t===c.e.STATION_POINT_EXIT?this.isExitPointNull()||(e=this.sceneExitPos()):t===c.e.STATION_POINT_CHECK&&(this.isCheckPointNull()||(e=this.sceneCheckPos())),e}pointColor(t){let e="red";return t===c.e.STATION_POINT_ENTER?e=c.e.STATION_COLOR_ENTER_POINT:t===c.e.STATION_POINT_EXIT?e=c.e.STATION_COLOR_EXIT_POINT:t===c.e.STATION_POINT_CHECK&&(e=c.e.STATION_COLOR_CHECK_POINT),e}getPointOnLine(t){let e={},i={},a=this.yaw(),s=this.scenePos();return e.x=s.x+200*Math.cos(a),e.y=s.y-200*Math.sin(a),i.x=s.x-200*Math.cos(a),i.y=s.y+200*Math.sin(a),Object(c.p)(e,i,t)}setEditPointCallback(t){this._callbackEditPoint=t}setEditable(t){this._editable=t}setIsAbnormal(t){this._isAbnormal=t,this.setColor(this.getDisplayColor()),this.updateShape()}setSelectedState(t){super.setSelectedState(t),this.setColor(this.getDisplayColor())}removeChildren(){super.removeChildren()}removePointsPath(){this._pointPathGroup.removeChildren()}delete(){super.delete(),this._pointPathGroup.remove(),this._mapModel.deleteStation(this._dat._id)}mapEnterPos(){return{x:this._dat._enter_pos._x,y:this._dat._enter_pos._y,yaw:this._dat._enter_pos._yaw}}mapExitPos(){return{x:this._dat._exit_pos._x,y:this._dat._exit_pos._y,yaw:this._dat._exit_pos._yaw}}mapCheckPos(){return{x:this._dat._check_pos._x,y:this._dat._check_pos._y,yaw:this._dat._check_pos._yaw}}isEnterPointNull(){return this._dat.isEnterPosNull()}isExitPointNull(){return this._dat.isExitPosNull()}isAroundPos(t,e=2*c.e.STATION_RADIUS){return Object(c.n)(t,this.scenePos())<e}isCheckPointNull(){return this._dat.isCheckPosNull()}isChargeStation(){return this._dat.isChargeStation()}isExactAt(t){return Object(c.n)(t,this.scenePos())<1}sceneEnterPos(){let t=this.mapEnterPos(),e=this._mapModel.mapToCanvas(t),i={x:e.x,y:e.y,yaw:t.yaw};return t=null,e=null,i}setName(t){this._dat._name=t}setNoRotate(t){this._dat.setNoRotate(t)}setEnterPos(t){let e=this._mapModel.mapFromCanvas(t);this._dat._enter_pos._x=e.x,this._dat._enter_pos._y=e.y,this._dat._enter_pos._yaw=this.yaw(),this._dat._enter_backward=this.isSameDirection(e)}setExitPos(t){let e=this._mapModel.mapFromCanvas(t);this._dat._exit_pos._x=e.x,this._dat._exit_pos._y=e.y,this._dat._exit_pos._yaw=this.yaw(),this._dat._exit_backward=!this.isSameDirection(e)}setCheckPos(t){let e=this._mapModel.mapFromCanvas(t);this._dat._check_pos._x=e.x,this._dat._check_pos._y=e.y,this._dat._check_pos._yaw=this.yaw()}sceneExitPos(){let t=this.mapExitPos(),e=this._mapModel.mapToCanvas(t),i={x:e.x,y:e.y,yaw:t.yaw};return t=null,e=null,i}sceneCheckPos(){let t=this.mapCheckPos(),e=this._mapModel.mapToCanvas(t),i={x:e.x,y:e.y,yaw:t.yaw};return t=null,e=null,i}scenePos(){return this._mapModel.mapToCanvas(this.mapPos())}mapPos(){return{x:this._dat._pos._x,y:this._dat._pos._y}}mapUnitVector(t=0){let e=this.childPath(c.e.STATION_PATH_NAME_DIRECTION);if(null===e)return new this._paper.Point(0,0);let i=e.getTangentAt(t);return null==i?new this._paper.Point(0,0):(i.y=-i.y,i)}setMapPos(t,e=!0){this._dat.setPos(t.x,t.y),e&&this.updateShape()}setScenePos(t,e=!0){let i=this._mapModel.mapFromCanvas(t);this.setMapPos(i),i=null}setYaw(t){this._dat._pos._yaw=t}yaw(){return this._dat._pos._yaw}setMapPose(t){this._dat._pos._x=t.x,this._dat._pos._y=t.y,this._dat._pos._yaw=t.yaw}isSameDirection(t){let e=this.yaw(),i=Object(c.s)(this.mapPos(),t),a={x:Math.cos(e),y:Math.sin(e)},s=i.x*a.x+i.y*a.y;return i=null,a=null,s>0}edgeId(){return this._dat._edge_id}setEdgeId(t){this._dat._edge_id=t}nodeId(){return this._dat._node_id}setNodeId(t){this._dat._node_id=t}_getSignMark(t){let e=Math.sin(this.yaw()),i=Math.cos(this.yaw());return e*(t.y-this.scenePos().y)<0||0===e&&i*(t.x-this.scenePos().x)>0?1:-1}_getScenePosFromCenter(t){let e=this.yaw(),i=this.scenePos();return{x:i.x+t*Math.cos(-e),y:i.y+t*Math.sin(-e)}}isStationTypeWareroom(){return this._dat._type===c.e.STATION_TYPE_WAREROOM}getStationWareroom(){return{wareroomAreaId:this._dat._wareroomAreaId,wareroomRegionId:this._dat._wareroomRegionId,wareroomLocationRow:this._dat._wareroomLocationRow,wareroomLocationColumn:this._dat._wareroomLocationColumn,wareroomLocationStorey:this._dat._wareroomLocationStorey}}getScenePosition(){return this._pathGroup.position}setStationRotate({degree:t=0,isSyncYaw:e=!1,yaw:i=0,centerPos:a=new this._paper.Point(0,0)}={}){this._pathGroup.rotate(t,a),e&&this.setYaw(i),this._pathGroup.rotate(t),this.setScenePos({x:this._pathGroup.position._x,y:this._pathGroup.position._y})}}class ot extends W{constructor(t,e,i){super(t,e,i),this.setStrokeColor("blue"),this.setInteractionState(!1)}updateShape(){if(super.updateShape(),null===this._dat||void 0===this._dat)return;let t=this.getStrokeColor(),e=this.getStrokeWidth(),i=this.getItemScaling();var a=this._mapModel.mapToCanvas(new this._paper.Point(this._dat._cx,this._dat._cy)),s=this._dat._radius*i,n=new this._paper.Path.Circle({name:c.e.ITEM_PATH_NAME_MAIN_CURVE,center:a,radius:s,strokeColor:t,strokeWidth:e,dashArray:[this._dashArray[0]*i,this._dashArray[1]*i]}),o=Object(c.q)(a,new this._paper.Point(s+6,6)),r=new this._paper.PointText({name:c.e.ITEM_PATH_NAME_TEXT,point:o,content:"rotate("+Object(c.h)(this._dat._param).toFixed(1).toString()+")Â°",fillColor:t,fontSize:this.getFontSize()});this.addPath(n),this.addPath(r),this.addPath(new this._paper.Path)}}class rt extends j{constructor(t,e){super(t,null,e),this._visible=!0,this._navPaths=null,this.setInteractionState(!1)}doZoom(){if(super.isNeedUpdate()){if(null==this._navPaths)return;this._navPaths.forEach(t=>{t.doZoom(),t.setColor(c.e.NAV_PATH_COLOR),t.setEdgeNameVisible(!1)})}}setNavPaths(t){if(this.removeAll(),this._navPaths=[],this.isVisible())for(let e=0;e<t.length;e++){let i=t[e];if(null==i)continue;let a=null;switch(i._type){case 1:a=new K(this._paper,i,this._mapModel);break;case 3:a=new tt(this._paper,i,this._mapModel);break;case 4:a=new ot(this._paper,i,this._mapModel)}a&&(a.locked=!0,a.setStrokeWidth(2),a.setDashArray([4,3]),a.updateShape(),a.setColor(c.e.NAV_PATH_COLOR),a.setEdgeNameVisible(!1),a.sendToBack(),this.addNavPath(a))}}setVisible(t){this._visible=t,null!=this._navPaths&&this._navPaths.forEach(e=>{e.setVisible(t)})}isVisible(){return this._visible}addNavPath(t){this._navPaths.push(t)}removeAll(){if(null!=this._navPaths){for(let t=0;t<this._navPaths.length;t++)null!=this._navPaths[t]&&(this._navPaths[t].delete(),this._navPaths[t]=null);this._navPaths=null}}}i("0967");class lt extends j{constructor(t,e){super(t,null,e),A()(this,"setLaserPoints",(t,e,i,a)=>{e.map(e=>{e.points.length>0&&this._drawPoints(t,e.points,e.color,e.color)}),i.map(e=>{e.points.length>0&&this._drawPoints(t,e.points,e.color,e.color)}),a.map(e=>{e.points.length>0&&this._drawPoints(t,e.points,e.color,e.color)})}),A()(this,"_drawPoints",(t,e,i,a)=>{let s=e.length,n=new this._paper.Path({strokeColor:i,strokeWidth:1});n.add(t);let o=new this._paper.CompoundPath({strokeColor:a,strokeWidth:2});for(let t=0;t<s;t++){const{x:i,y:a}=e[t];let s=this._mapModel.mapToCanvas({x:i/10,y:a/10});o.addChild(this._symbol.place(s)),n.add(s),s=null}o.fillColor=a,n.fillColor=i,n.opacity=.3,this.addPath(o),this.addPath(n)}),this.setInteractionState(!1);let i=new this._paper.Path.Circle({center:[0,0],radius:1});this._symbol=new this._paper.Symbol(i)}removeAll(){this.removeChildren()}}class ct extends j{constructor(t,e){super(t,null,e),this._yaw=0,this._robotRaster=null}updateShape(){}updateRobotState(t){let e=null,i=this._yaw;null!=this._robotRaster&&(e=this.scenePos(),this._yaw=0,this._robotRaster.removeChildren(),this._robotRaster=null),null==this._robotRaster&&(this._robotRaster&&this._robotRaster.removeChildren(),this._robotRaster=null),this._robotRaster=t,this._robotRaster.locked=!0,null!==e&&this.setPos({x:e.x,y:e.y,yaw:i})}setPos(t){if(void 0===t||null==this._robotRaster)return;this._robotRaster.position={x:t.x,y:t.y};let e=t.yaw-this._yaw;this._yaw=t.yaw,this._robotRaster.rotate(e)}setSelectedState(t){}scenePos(){var t;return(null===(t=this._robotRaster)||void 0===t?void 0:t.position)||{x:0,y:0}}setVisible(t){null!=this._robotRaster&&(this._robotRaster.visible=t)}isVisible(){return this._robotRaster.visible}isInside(t){return this._robotRaster.isInside(t)}}class dt extends j{constructor(t){super(t,null,null),this._path=new t.Path,this._path.strokeWidth=1,this._path.strokeColor=c.e.LOCUS_COLOR,this._path.locked=!0,this.addPath(this._path),this.setStrokeWidth(1)}doZoom(){super.doZoom(!1)}getDefaultStrokeWidth(){return 1}addPoint(t){this._path.segments.length>5e3&&this._path.removeSegment(0),this._path.lineTo(t),this.bringToFront()}bringToFront(){this._path.bringToFront()}setVisible(t){this._path.visible=t}isVisible(){return this._path.visible}removeChildren(){this._path.removeSegments()}}var ht=i("a39b");class ut extends j{constructor(t,e){super(t,null,e),this.scanTimer=0,this.mapRedrawRaster=null}addMarker(t,e="#FFCC66"){const i=new this._paper.Path.Circle(new this._paper.Point(t.x,t.y),3*c.e.TAG_RADIUS*this.getItemScaling());i.fillColor=new this._paper.Color(e),this.addPath(i)}async updateScanImage(t=!1){t?(this.updateScanImage(!1),this.scanTimer=setInterval(async()=>{const t=await this.getImageInfo("map_new.json","map_new.png");t&&await this.updateRedrawRaster(t)},5e3)):this.scanTimer&&(clearInterval(this.scanTimer),this.scanTimer=0)}async updateRedrawRaster(t){const{sizeX:e=0,sizeY:i=0,zeroOffsetX:a=0,zeroOffsetY:s=0,resolution:n=2,imgUrl:o=null}=t,r=new this._paper.Point(e*n/2,i*n/2),l=new this._paper.Point(a*n,s*n),d=this._mapModel.mapToCanvas({x:0,y:0}),h=Object(c.s)(d,l),u=Object(c.s)(h,r);this.removeRaster(),this.mapRedrawRaster=new this._paper.Raster(window.URL.createObjectURL(o),u),this.mapRedrawRaster.locked=!0,this.mapRedrawRaster.smoothing=!1,this.mapRedrawRaster.onLoad=async()=>{this.mapRedrawRaster.scale(n)},this.mapRedrawRaster.onError=t=>{}}async updateRedrawPreview(){const t=await this.getImageInfo("map_all_with_box.json","map_all_with_box.png");if(t)return await this.updateRedrawRaster(t),t}async getImageInfo(t="",e=""){let[i,a]=[null,null];try{if([i,a]=await Promise.all([Object(ht.eb)("/sros/png_map/"+t,"json"),Object(ht.eb)("/sros/png_map/"+e)]),!a||a.size<=0||!i||!i.meta)throw TypeError("file content is empty or invalid!")}catch(t){return}const{meta:s={},private:n={}}=i,{"size.x":o=0,"size.y":r=0,"zero_offset.x":l=0,"zero_offset.y":c=0,resolution:d=0}=s,{lmks:h=[]}=n;return{sizeX:o,sizeY:r,zeroOffsetX:l,zeroOffsetY:c,resolution:d,lmks:h,imgUrl:a}}removeRaster(){var t,e;null===(t=this.mapRedrawRaster)||void 0===t||t.clear(),null===(e=this.mapRedrawRaster)||void 0===e||e.remove()}delete(){super.delete(),this.removeRaster(),this.mapRedrawRaster=null}}class pt extends j{constructor(t){super(t,null,null),this._pos=new t.Point(0,0),this._yaw=0,this._isSetYaw=!1,this.setStrokeColor("red"),this.setStrokeWidth(2),this.setInteractionState(!1)}scenePos(){return this._pos}getYaw(){return this._yaw}resetShape(){this._pos.x=0,this._pos.y=0,this._yaw=0,this._pathGroup.removeChildren()}initShape(){let t=this.getStrokeColor(),e=this.getStrokeWidth();this.resetShape();var i=new this._paper.Path.Circle({center:[0,0],radius:24,strokeWidth:e,strokeColor:t}),a=new this._paper.Path.Line({from:[-30,-30],to:[30,30],strokeWidth:e,strokeColor:t}),s=new this._paper.Path.Line({from:[30,-30],to:[-30,30],strokeWidth:e,strokeColor:t}),n=new U(this._paper);n.setPos(0,0),n.setColor(t),n.setStrokeWidth(e),n.setLength(48),n.setArrowLength(15),n.initShape(),this.addPath(i),this.addPath(a),this.addPath(s),this.addPath(n.getItem())}startDraw(t){this.setVisible(!0),this._pos=t,this._isSetYaw=!0,this._pathGroup.children.forEach(e=>{e.position=t})}drawing(t){if(this._isSetYaw){var e=new this._paper.Point(t.x-this._pos.x,t.y-this._pos.y);this._pathGroup.lastChild.rotate(e.angle-this._yaw,this._pathGroup.firstChild.bounds.center),this._yaw=e.angle}else this._pathGroup.position=t}endDraw(t){this._isSetYaw=!1}}var mt=i("2cd7");class ft extends j{constructor(t,e){super(t,null,e),this._boundRect=null,this.setStrokeColor("#CED0D8"),this.setInteractionState(!1)}updateShape(){if(null==this._boundRect)return;super.updateShape();let t=this.getStrokeColor(),e=this.getItemScaling(),i=c.e.GRID_CELL_UNIT,a=this._boundRect.height/i+1,s=this._boundRect.width/i+1;for(let n=0;n<a;n++){let a=1,o=[1*e,2*e];n%5==0&&(a=2,o=null);let r=new this._paper.Path.Line({from:Object(c.q)({x:0,y:i*n},this._boundRect.topLeft),to:Object(c.q)(this._boundRect.topLeft,{x:i*s,y:i*n}),strokeColor:t,strokeWidth:a*e,dashArray:o});this.addPath(r)}for(let n=0;n<s;n++){let s=1,o=[1*e,2*e];n%5==0&&(s=2,o=null);let r=new this._paper.Path.Line({from:Object(c.q)({x:i*n,y:0},this._boundRect.topLeft),to:Object(c.q)({x:i*n,y:i*a},this._boundRect.topLeft),strokeColor:t,strokeWidth:s*e,dashArray:o});this.addPath(r)}}setBoundRect(t){this._boundRect=t}setSelectedState(t){}}var gt=i("b5ae"),_t=i("de9c"),yt=i("32e0"),vt={name:"DrawRoundCorner",components:{ChoiceButtons:_t.a,HeaderItem:yt.a},data:()=>({opened:!1,edgeFrom:null,edgeTo:null,radiusMin:1,edgeOptions:null,edgeFromOptions:[],edgeToOptions:[]}),validations:{radiusMin:{required:gt.required}},methods:{setOptions:function(t){this.edgeOptions=null,this.edgeOptions=t,this.edgeFromOptions=t,this.edgeToOptions=t,t.length>0&&(this.edgeFrom=t[0].value,this.edgeTo=t[0].value)},filterFromEdge(t,e){e(""!==t?()=>{const e=t.toLowerCase();this.edgeFromOptions=this.edgeOptions.filter(t=>t.label.toLowerCase().indexOf(e)>-1),1===this.edgeFromOptions.length&&(this.edgeFrom=this.edgeFromOptions[0].value)}:()=>{this.edgeFromOptions=this.edgeOptions})},filterToEdge(t,e){e(""!==t?()=>{const e=t.toLowerCase();this.edgeToOptions=this.edgeOptions.filter(t=>t.label.toLowerCase().indexOf(e)>-1),1===this.edgeToOptions.length&&(this.edgeTo=this.edgeToOptions[0].value)}:()=>{this.edgeToOptions=this.edgeOptions})},onClosed:function(){this.opened=!1,this.$emit("drawCorner",null)},onOkay:function(){if(null==this.edgeFrom)return void this.$notify({message:this.$t("text.chooseStartEdge"),timeout:3e3,type:"negative",position:"top"});if(null==this.edgeTo)return void this.$notify({message:this.$t("text.chooseEndEdge"),timeout:3e3,type:"negative",position:"top"});if(this.$v.$touch(),this.$v.$error)return void this.$notify({message:this.$t("text.inputMinCurvityRadius"),timeout:3e3,type:"negative",position:"top"});if(this.radiusMin<.05)return void this.$notify({message:this.$t("text.minCurvityRadiusTooSmall"),timeout:3e3,type:"negative",position:"top"});let t=this.edgeFrom,e=this.edgeTo,i=this.$parent.checkRoundCorner(this.radiusMin,t,e);""===i?(this.$emit("drawCorner",{radius:this.radiusMin,e1:t,e2:e}),this.opened=!1):this.$notify({message:i,timeout:3e3,type:"negative",position:"top"})}}},bt=i("2877"),Et=i("24e8"),At=i("f09f"),wt=i("1c1c"),St=i("66e5"),Ct=i("4074"),It=i("ddd8"),xt=i("27f9"),Tt=i("eebe"),Mt=i.n(Tt),Pt=Object(bt.a)(vt,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticStyle:{width:"480px"}},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.$t("button.drawBezierCorner")},on:{close:t.onClosed}})],1),null!=t.edgeOptions?e("div",[e("q-list",{staticClass:"q-mt-xs",attrs:{"no-border":""}},[e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.startEdge"))+"\n              ")]),e("q-select",{staticClass:"col-sm-8 col-md-8 col-lg-8",attrs:{options:t.edgeFromOptions,outlined:"",dense:"",autofocus:"","emit-value":"","map-options":"","use-input":"","hide-selected":"","fill-input":""},on:{filter:t.filterFromEdge},model:{value:t.edgeFrom,callback:function(e){t.edgeFrom=e},expression:"edgeFrom"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.endEdge"))+"\n              ")]),e("q-select",{staticClass:"col-sm-8 col-md-8 col-lg-8",attrs:{options:t.edgeToOptions,outlined:"",dense:"",autofocus:"","emit-value":"","map-options":"","use-input":"","hide-selected":"","fill-input":""},on:{filter:t.filterToEdge},model:{value:t.edgeTo,callback:function(e){t.edgeTo=e},expression:"edgeTo"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.minCurvityRadius")+"(m)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"",error:t.$v.radiusMin.$error},on:{blur:t.$v.radiusMin.$touch},model:{value:t.radiusMin,callback:function(e){t.radiusMin=t._n(e)},expression:"radiusMin"}})],1),e("div",{staticClass:"text_main_light_grey q-mt-md"},[t._v(t._s(t.$t("text.minCurvityRadiusDesc")))])])],1)],1),e("div",{staticClass:"q-my-md q-mr-md float-right"},[e("choice-buttons",{attrs:{"label-okay":t.$t("button.save")},on:{okay:t.onOkay,cancel:t.onClosed}})],1)],1):t._e()])],1)},[],!1,null,"57618c99",null),Ot=Pt.exports;Mt()(Pt,"components",{QDialog:Et.a,QCard:At.a,QList:wt.a,QItem:St.a,QItemSection:Ct.a,QSelect:It.a,QInput:xt.a});class Lt extends j{constructor(t,e){super(t,null,e),this._scenePosFrom=null,this._scenePosTo=null,this.setVisible(!1),this.setInteractionState(!1)}updateShape(){super.updateShape();let t=new this._paper.Path.Rectangle({name:c.e.ITEM_PATH_NAME_MAIN_CURVE,from:this._scenePosFrom,to:this._scenePosTo,strokeColor:c.e.SELECT_AREA_COLOR,strokeWidth:2,dashArray:[4,2]});this.addPath(t)}startDraw(t){super.startDraw(t),this._scenePosFrom=t,this._scenePosTo=t,this.updateShape(),this.setVisible(!0)}drawing(t){super.drawing(t),this._scenePosTo=t,this.updateShape()}endDraw(t){super.endDraw(t),this._scenePosTo=t,this.updateShape(),this.setVisible(!1),this.removeChildren()}}var Rt=i("20ff"),Dt=i("d7f1");class Nt extends j{constructor(t,e,i){super(t,e,i),A()(this,"setPose",(t,e)=>{let i=this.calculateBarcodeMapPose(t,e);this._dat.setPose(i.x,i.y,i.yaw),this.updateShape()}),this.setStrokeWidth(1),this.setSelectedColor(c.e.ITEM_COLOR_SELECTED),this._pathGroup.onMouseEnter=t=>{this.isEditable()&&(this.isSelected()||this.isItemDrawing()||!this.isEditable()||(this.setColor(c.e.ITEM_COLOR_HOVE),this.bringToFront()))},this._pathGroup.onMouseLeave=t=>{this.isEditable()&&(this.isSelected()||this.isItemDrawing()||(this.setColor(this.getBarcodeFillColor()),this.sendToBack()))}}updateShape(){if(super.updateShape(),null===this._dat||void 0===this._dat)return;let t=this.getItemScaling(),e=c.e.BARCODE_WIDTH*t,i=this._mapModel.mapToCanvas({x:this._dat._pos._x,y:this._dat._pos._y});var a=new this._paper.Point(i.x,i.y);let s=new this._paper.Path.Rectangle(Object(c.s)({x:e/2,y:e/2},a),new this._paper.Size(e,e));s.name=c.e.ITEM_PATH_NAME_MAIN_CURVE;let n=this.getBarcodeFillColor();this._dat.getIsDamged()&&(n=c.e.DMCODE_COLOR_DAMAGED),s.strokeWidth=this.getStrokeWidth(),s.strokeColor=n,s.fillColor=n,s.fillColor.alpha=.5;let o=new U(this._paper);o.setColor("#999999"),o.setStrokeWidth(t),o.setLength(c.e.BARCODE_WIDTH*t),o.setArrowLength(6*t),o.initShape(),o.setPos(a);let r=new this._paper.PointText(Object(c.q)(a,{x:c.e.BARCODE_WIDTH*t,y:8*t}));r.name=c.e.ITEM_PATH_NAME_TEXT,r.content="X",r.style={fontSize:this.getFontSize(),fillColor:"#999999",justification:"center"};let l=new U(this._paper);l.setColor("#999999"),l.setStrokeWidth(t),l.setLength(c.e.BARCODE_WIDTH*t),l.setArrowLength(6*t),l.initShape(),l.setPos(a),l.rotate(-90);let d=new this._paper.PointText(Object(c.q)(a,{x:-8*t,y:-c.e.BARCODE_WIDTH*t}));d.name=c.e.ITEM_PATH_NAME_TEXT,d.content="Y",d.style={fontSize:this.getFontSize(),fillColor:"#999999",justification:"center"};var h=new this._paper.PointText(Object(c.q)(a,new this._paper.Point(0,c.e.BARCODE_WIDTH*t)));h.name=c.e.ITEM_PATH_NAME_TEXT,h.style={fontSize:this.getFontSize(),fillColor:n,justification:"center"},h.content=this.getName(),this.addPath(s),this.addPath(o.getItem()),this.addPath(l.getItem()),this.addPath(r),this.addPath(d),this._pathGroup.rotate(this.sceneYaw(),a),this.addPath(h),this.doAfterUpdateShape()}setId(t){this._dat._id=t}getName(){return(this.getBarcodeType()===c.e.QRCODE_TYPE_FUSE_LOCATE?"FLQR":"SCQR")+this.getID()}getBarcodeType(){return this._dat._type}getBarcodeFillColor(){return this.getBarcodeType()===c.e.QRCODE_TYPE_FUSE_LOCATE?c.e.DMCODE_COLOR_FUSE_LOCATE:c.e.DMCODE_COLOR_NORMAL}updatePose(t){this._dat.setPose(t.x,t.y,t.yaw),this.updateShape()}scenePos(){return this._mapModel.mapToCanvas({x:this._dat._pos._x,y:this._dat._pos._y})}sceneYaw(){return Object(c.h)(-this._dat.getYaw())}moveBy(t){}setSelectedState(t){super.setSelectedState(t),this.isSelected()?this.setColor(c.e.ITEM_COLOR_HOVE):this.setColor(c.e.DMCODE_COLOR_NORMAL)}delete(){super.delete(),this._mapModel.deletePGV(this._dat._id)}calculateBarcodeMapPose(t,e){let i=0,a=0,s=0,n=t,o={x:0,y:0,yaw:0};n.yaw=t.yaw+0;let r=n.x-i,l=n.y-a;o.x=Math.cos(n.yaw)*r+Math.sin(n.yaw)*l,o.y=-Math.sin(n.yaw)*r+Math.cos(n.yaw)*l,o.yaw=n.yaw-s;let d={x:0,y:0,yaw:0};return d.x=-Math.cos(e.yaw)*o.x+Math.sin(e.yaw)*o.y+e.x,d.y=-Math.sin(e.yaw)*o.x-Math.cos(e.yaw)*o.y+e.y,d.yaw=Object(c.o)(e.yaw-o.yaw),d}}var kt=i("149c"),Ft=i("e9ef"),$t=i("8b52");class qt extends j{constructor(t,e,i){super(t,e,i),this._startPos=null,this._endPos=null,this._referItem=new H(t,i),this._visible=!0,this.setStrokeColor("#F47A88"),this.setStrokeWidth(2),this.setInteractionState(!1)}updateShape(){if(super.updateShape(),null==this._startPos||null==this._endPos||!this.isVisible())return;let t=this.getStrokeColor(),e=this.getItemScaling();var i=new this._paper.Path;if(i.name=c.e.ITEM_PATH_NAME_MAIN_CURVE,i.add(this._startPos),i.add(this._endPos),i.strokeWidth=this.getStrokeWidth(),i.strokeColor=t,i.strokeCap="round",this.addPath(i),!this.isItemDrawing()){let i=this.angle(),a=this.referPosNextToStart(12*e),s=this.referPosNextToEnd(12*e),n=new this._paper.Path;n.strokeWidth=1*e,n.strokeColor=t,n.strokeCap="round",n.add(this._startPos),n.lineTo(a);let o=new this._paper.Path;o.strokeWidth=1*e,o.strokeColor=t,o.strokeCap="round",o.add(this._endPos),o.lineTo(s);let r=Object(c.q)(this.referPosNextToStart(12*e/2),this.referPosNextToEnd(12*e/2)),l=Object(c.r)(r,2),d=new U(this._paper);d.setColor(t),d.setDashArray([3*e,3*e]),d.setStrokeWidth(1*e),d.setLength(Object(c.n)(this._startPos,this._endPos)/2),d.setArrowLength(4*e),d.initShape(),d.setPos(l),d.rotate(i);let h=new U(this._paper);h.setColor(t),h.setDashArray([3*e,3*e]),h.setStrokeWidth(1*e),h.setLength(Object(c.n)(this._startPos,this._endPos)/2),h.setArrowLength(4*e),h.initShape(),h.setPos(l),h.rotate(i-180);let u=new this._paper.PointText({content:this.getDistance()+"m",fillColor:t,fontWeight:"normal",fontSize:this.getFontSize()});u.position=Object(c.r)(Object(c.q)(a,s),2);let p=i%180;p>90&&(p-=180),u.rotate(p),this.addPath(n),this.addPath(o),this.addPath(d.getItem()),this.addPath(h.getItem()),this.addPath(u)}}getDistance(){return(Object(c.n)(this._mapModel.mapFromCanvas(this._startPos),this._mapModel.mapFromCanvas(this._endPos))/100).toFixed(2)}startDraw(t){super.startDraw(t),this._startPos=t,this._referItem.startDraw(t)}drawing(t){super.drawing(t),this.isItemDrawing()&&(this._referItem.drawing(t),this._endPos=this._referItem.endScenePoint(),this.updateShape())}endDraw(t){super.endDraw(t),this._endPos=this._referItem.endScenePoint(),this.updateShape(),this._referItem.endDraw(t)}delete(){super.delete(),this._referItem.delete(),this._referItem=null}referPosNextToStart(t){let e=new this._paper.Point(0,0),i=this._endPos.x-this._startPos.x,a=this.angle();return i<=0?(e.y=this._startPos.y+t*Math.cos(Object(c.b)(a)),e.x=this._startPos.x-t*Math.sin(Object(c.b)(a))):(e.y=this._startPos.y-t*Math.cos(Object(c.b)(a)),e.x=this._startPos.x+t*Math.sin(Object(c.b)(a))),e}referPosNextToEnd(t){let e=new this._paper.Point(0,0),i=this._endPos.x-this._startPos.x,a=this.angle();return i<=0?(e.y=this._endPos.y+t*Math.cos(Object(c.b)(a)),e.x=this._endPos.x-t*Math.sin(Object(c.b)(a))):(e.y=this._endPos.y-t*Math.cos(Object(c.b)(a)),e.x=this._endPos.x+t*Math.sin(Object(c.b)(a))),e}angle(){return Object(c.h)(Object(c.z)(this._startPos,this._endPos))}setVisible(t){this._visible=t,this.updateShape()}isVisible(){return this._visible}}let Gt={sides:6,radius:25,colorDefault:"#827100",colorRedrawLMK:"#f3b433",colorMatched:c.e.ITEM_COLOR_HOVE,colorUnmatched:"#F47A88",width:20,height:20};class Bt extends j{constructor(t,e,i){super(t,e,i),this._dat._itemType=c.e.MODEL_TYPE_LMK,this._pathGroup.pivot=[Gt.width/2,Gt.height/2],this.setStrokeColor(Gt.colorDefault),this.setStrokeWidth(2)}updateShape(){if(super.updateShape(),!this._dat)return;const t={x:this._dat.x,y:this._dat.y},e=this.getStrokeColor(),i=this.getStrokeWidth(),a=this._dat.type,s=new this._paper.PointText([0,50]);if(s.name=c.e.ITEM_PATH_NAME_TEXT,s.style={strokeWidth:1,fontSize:this.getFontSize(),fillColor:e,justification:"center"},s.content="("+(t.x/100).toFixed(2)+"m, "+(t.y/100).toFixed(2)+"m)",1===a){const t=new this._paper.Path.Rectangle({point:[0,0],size:[.9*Gt.width,.6*Gt.height]});t.fillColor=e,this.addPath(t)}else if(2===a){const t=new this._paper.Path.Ellipse({point:[0,0],size:[Gt.width,Gt.height],strokeWidth:i,strokeColor:e,strokeCap:"round"}),a=new this._paper.Path.Line({from:t.getPointAt(t.length/4),to:t.getPointAt(3*t.length/4),strokeWidth:i,strokeColor:e}),s=new this._paper.Path.Line({from:t.getPointAt(0),to:t.getPointAt(1*t.length/2),strokeWidth:i,strokeColor:e});this.addPath(t),this.addPath(a),this.addPath(s)}this.addPath(s),this._pathGroup.position=this._mapModel.mapToCanvas(t),this.doAfterUpdateShape()}doZoom(){super.doZoom(!1)}setColor(t){super.setColor(t),this._fillColor=t}setSelectedState(t){}}const jt="#54DEC7";class Ut extends j{constructor(t,e){super(t,null,e),this.setInteractionState(!1)}updateShape(t=!0){super.updateShape();for(let e=this._dat.length-1;e>=0;e--){let i=this._dat[e];const a=0===e,s=a?2:1,n=t&&a?"#1f4d80":this.getStrokeColor();this.createRect(i.vertexs,s,n)}}setRectDatList(t,e="",i=!0){this._dat=t,this.setStrokeColor(e||jt),this.updateShape(i)}clear(){super.removeChildren()}createRect(t,e,i=jt){let a=new this._paper.Path({strokeColor:i,strokeWidth:e});for(let e of Array.from(t)){let t=this._mapModel.mapToCanvas({x:e.x/10,y:e.y/10});a.add(t)}a.closePath(),a.opacity=.5,this.addPath(a)}setSelectedState(t){}}var Yt=i("09c3"),zt=i("1e4b"),Vt=i("c4c4"),Wt=i("14b2"),Ht=i("d6c6"),Kt=i("c3a9"),Qt=i("6825"),Xt=i("7a6b"),Jt=i("eb21"),Zt=i("d5bc");class te extends j{constructor(t,e,i){super(t,e,i),this._dat._itemType=c.e.MODEL_TYPE_FEATURE,this.setStrokeWidth(c.e.STROKE_WIDTH_2),this.setStrokeColor("#827100")}updateShape(){if(super.updateShape(),null==this._dat)return;let t={x:this._dat.pose.x,y:this._dat.pose.y},e="#F47A88";this._dat.stationId&&0!==this._dat.stationId||(e=this.getStrokeColor());let i=1,a=new this._paper.Path.Ellipse({point:[0,0],size:[20,20],strokeWidth:i/2,strokeColor:e,strokeCap:"round"});if(i*=2,this.addPath(a),"FEATURE_LMK"===this._dat.featureName){let t=new this._paper.Path.Line({from:a.getPointAt(a.length/4),to:a.getPointAt(3*a.length/4),strokeWidth:i,strokeColor:e}),s=new this._paper.Path.Line({from:a.getPointAt(0),to:a.getPointAt(1*a.length/2),strokeWidth:i,strokeColor:e});this.addPath(t),this.addPath(s)}else if("FEATURE_TRI"===this._dat.featureName){let t=new this._paper.Path.Line({from:a.getPointAt(0),to:a.getPointAt(3*a.length/8),strokeWidth:i,strokeColor:e}),s=new this._paper.Path.Line({from:a.getPointAt(0),to:a.getPointAt(1*a.length/2),strokeWidth:i,strokeColor:e});this.addPath(t),this.addPath(s)}else if("FEATURE_CORNER"===this._dat.featureName){let t=new this._paper.Path.Line({from:a.getPointAt(3*a.length/8),to:a.getPointAt(5*a.length/8),strokeWidth:i,strokeColor:e}),s=new this._paper.Path.Line({from:a.getPointAt(7*a.length/8),to:a.getPointAt(5*a.length/8),strokeWidth:i,strokeColor:e});this.addPath(t),this.addPath(s)}else if("FEATURE_ARTICORNER"===this._dat.featureName){let t=new this._paper.Path.Line({from:a.getPointAt(0),to:a.getPointAt(1*a.length/5),strokeWidth:i,strokeColor:e}),s=new this._paper.Path.Line({from:a.getPointAt(0),to:a.getPointAt(4*a.length/5),strokeWidth:i,strokeColor:e});this.addPath(t),this.addPath(s)}else if(this._dat.featureType===c.e.FEATURE_TYPE_FM){let t=a.getPointAt(1*a.length/8),s=a.getPointAt(5*a.length/8),n=new this._paper.Path.Rectangle({from:t,to:s,strokeWidth:i,strokeColor:e}),o=new this._paper.Path.Rectangle({from:{x:8,y:8},to:{x:12,y:12},strokeWidth:i,strokeColor:e});this.addPath(n),this.addPath(o)}else if(this._dat.featureType===c.e.FEATURE_TYPE_DM){let t=a.getPointAt(1*a.length/8),s=a.getPointAt(5*a.length/8),n=new this._paper.Path.Rectangle({from:t,to:s,strokeWidth:i,strokeColor:e}),o=new this._paper.Path.Line({from:{x:6,y:3},to:{x:6,y:17},strokeWidth:i,strokeColor:e}),r=new this._paper.Path.Line({from:{x:3,y:14},to:{x:17,y:14},strokeWidth:i,strokeColor:e});this.addPath(n),this.addPath(o),this.addPath(r)}this._pathGroup.position=this._mapModel.mapToCanvas(t),this.doAfterUpdateShape()}doZoom(){super.doZoom(!1)}setColor(t){super.setColor(t),this._fillColor=t}setSelectedState(t){}scenePos(){return this._mapModel.mapToCanvas(this.mapPos())}mapPos(){return{x:this._dat.pose.x,y:this._dat.pose.y}}setStationId(t){this._dat.stationId=t}getStationId(){return this._dat.stationId}delete(){super.delete(),this._mapModel.deleteFeature(this._dat._id)}}var ee=i("5ff7");var ie=class{constructor(t=21){this.maxSnapshots=t,this.snapshots=[],this.cursor=-1}get canUndo(){return this.cursor>0}get canClear(){return this.snapshots.length}get canRedo(){return this.snapshots.length>this.cursor+1}record(t="",e={}){if(this.checkRepeat(e))return!1;for(;this.cursor<this.snapshots.length-1;)this.snapshots.pop();e.uuid=`${+new Date}${Math.random()}`,this.snapshots.push(JSON.stringify(e)),this.snapshots.length>this.maxSnapshots&&this.snapshots.shift(),this.cursor=this.snapshots.length-1}undo(){return this.canUndo?JSON.parse(this.snapshots[--this.cursor]):null}redo(){return this.canRedo?JSON.parse(this.snapshots[++this.cursor]):null}move(t){if(this.snapshots.length>t)return this.cursor=t,this.snapshots[this.cursor]}clear(){this.cursor=-1,this.snapshots=[]}checkRepeat(t){const e=t;let i={};return this.cursor>=0&&(i=JSON.parse(this.snapshots[this.cursor])),"object"==typeof i&&"object"==typeof e&&(e.uuid=i.uuid,ee.a.deepEqual(i,e))}};a.default.use(p.a,{name:"v-touch"});const ae=1,se=2,ne=3,oe=4,re=5,le=6,ce=8,de=9,he=10,ue=11;var pe={name:"mappage",props:{mapsGroupsIndex:{type:Number,default:0,required:!0},isManualCtrl:{type:Boolean,default:!1},isRightDrawerOpen:{type:Boolean,default:!0},mapEditable:Boolean,areaObaConfigs:{type:Array,default:()=>[]}},inject:["showLoading","hideLoading","doAsk"],components:{MapSearchTool:()=>Promise.all([i.e(0),i.e(2)]).then(i.bind(null,"0a96")),MessageDialog:Zt.a,CheckboxList:Xt.a,OtherFeatureItems:Jt.a,ContextMenu:Qt.a,InputDialog:Kt.a,QuestionDialog:Ht.a,EditMapToolBar:Wt.a,ControlButtons:Vt.a,SelectEdgeGroup:zt.a,EdgeGroupEditor:Yt.a,CheckMapList:$t.a,BarcodeEditor:kt.a,StationDMCodeCreator:Ft.a,SetCoordinate:Dt.a,ScaleItem:Rt.a,DrawRoundCorner:Ot,SelectDialog:mt.a,EdgeEditor:b.a,AreaEditor:v.a,NodeEditor:y.a,StationEditor:_.a,WareroomAreaAndWareroomRegionEditor:X.a,StationBatchCopyEditor:J.a,StationRotateEditor:Z.a,NoteAreaEditor:()=>Promise.all([i.e(0),i.e(1)]).then(i.bind(null,"59d9")),LocationAreaEditor:()=>i.e(4).then(i.bind(null,"44f9"))},data(){return{MapsGroups:c.f,isMobile:this.$q.platform.is.mobile,isHorzontal:!this.$q.platform.is.mobile,mapName:"",mousePressedCnt:0,mouseMoveCnt:0,mousePos:"(0 m, 0 m)",mousePoint:{x:0,y:0},mapScale:1,zoomFactor:1,zoomFactorMin:1,rotateAngle:0,zoomUpdateTimerId:0,isDrawLaserPoints:!1,isDrawHeatmap:!1,isDrawLmk:!0,isDrawAvoidRectangle:!1,followingMode:c.i.None,isSystemStateIdle:!0,isEmergencyState:!1,enableMoveItems:!1,isPerformanceSwitchOn:!0,isContextMenuOpen:!0,action:c.e.ACTION_NONE,mapModel:new B,curEdgeItem:null,curNodeItem:null,curStationAndFeatureBindItem:null,curStationItem:null,curAreaItem:null,editEdgeId:0,editStationId:0,stations:[],edges:[],areas:[],locationAreas:[],noteAreas:[],nodes:[],tags:[],pgvs:[],edgeGroups:[],edgeGroupsList:[],edgeItemList:[],nodeItemList:[],tagItemList:[],stationAndFeatureBindItemList:[],barcodeItemList:[],stationItemList:[],areaItemList:[],redrawAreaItemList:[],cleanAreaItemList:[],noteAreaItemList:[],locationAreaItemList:[],distanceItemList:[],lmkItemList:[],runtimeLmkList:[],featureItems:[],runtimeFeatureItems:[],contextMenuClickedPos:null,moveToStationOpts:[],selectingItems:[],clipboardItems:[],mapCheckList:[],orignalUserDefinedParams:null,stationsOnMovingNode:[],axisItem:null,robotItem:null,robotLocusItem:null,redrawItem:null,targetItem:null,navPathItem:null,laserPointsItem:null,gridItem:null,selectionItem:null,distanceItem:null,avoidRectangleItem:null,mapImgRaster:null,robotLastScenePos:{x:0,y:0,yaw:0},promiseCallback:{},moveDelta:{x:0,y:0},showAllLaserPoint:!1,history:new ie,mapSwitchItems:[{key:c.e.KEY_ROBOT_STATE,layer:"",name:this.$t("label.showRobot"),state:!0},{key:c.e.KEY_MAP_EDGE,layer:c.e.MAP_LAYER_EDGE,name:this.$t("label.showEdges"),state:!0},{key:c.e.KEY_MAP_STATION,layer:c.e.MAP_LAYER_STATION,name:this.$t("label.showStations"),state:!0},{key:c.e.KEY_MAP_NODE,layer:c.e.MAP_LAYER_NODE,name:this.$t("label.showNodes"),state:!0},{key:c.e.KEY_MAP_FUNC_AREA,layer:c.e.MAP_LAYER_FUNC_AREA,name:this.$t("label.showFuncArea"),state:!0},{key:c.e.KEY_MAP_LOCATION_AREA_STATE,layer:c.e.MAP_LAYER_LOCATION_AREA,name:this.$t("button.showData",{name:this.$t("label.locationArea")}),state:!1},{key:c.e.KEY_MAP_NOTE_AREA_STATE,layer:c.e.MAP_LAYER_NOTE_AREA,name:this.$t("button.showData",{name:this.$t("label.noteArea")}),state:!0},{key:c.e.KEY_LMK,layer:c.e.MAP_LAYER_LMK,name:this.$t("label.showLMK"),state:!0},{key:c.e.KEY_BACKGROUND_IMAGE_STATE,layer:c.e.MAP_LAYER_IMG,name:this.$t("label.showOriginalMap"),state:!0},{key:c.e.KEY_MAP_REDRAW_STATE,layer:c.e.MAP_LAYER_REDRAW,name:this.$t("text.displaysTheRecordedRedrawArea"),state:!1},{key:c.e.KEY_MAP_BARCODE,layer:c.e.MAP_LAYER_BARCODE,name:this.$t("label.showBarcode"),state:!0},{key:c.e.KEY_MAP_TAG,layer:c.e.MAP_LAYER_TAG,name:this.$t("label.showTags"),state:!0},{key:c.e.KEY_MAP_FEATURE,layer:c.e.MAP_LAYER_FEATURE,name:this.$t("label.showFeatures"),state:!0},{key:c.e.KEY_ITEM_NAMES,layer:"",name:this.$t("label.showMapItemNames"),state:!0}],otherSwitchItems:[{key:c.e.KEY_FOLLOW_ROBOT,layer:"",name:this.$t("label.autoFollowRobot"),state:!1,level:0},{key:c.e.KEY_LASER_POINT_STATE,layer:"",name:this.$t("label.showLaserPoints"),state:!1,level:0},{type:d.h,key:c.e.KEY_ALL_LASER_POINT_STATE,layer:"",name:this.$t("label.showAllLaser"),state:!1,level:0},{key:c.e.KEY_AVOID_RECTANGLE,layer:"",name:this.$t("label.showAvoidRectangle"),state:!1,level:2},{key:c.e.KEY_RECOGNITION_LIDAR,layer:"",name:this.$t("label.radarSignatureRecognition"),state:!1,level:2},{key:c.e.KEY_HEATMAP,layer:"",name:this.$t("label.testLocationConfidence"),state:!1,level:2},{key:c.e.KEY_DISTANCE_STATE,layer:"",name:this.$t("label.showDistanceMeasurementLine"),state:!0,level:2},{key:c.e.KEY_NAV_PATH_STATE,layer:"",name:this.$t("label.showNavPath"),state:!0,level:2},{key:c.e.KEY_ROBOT_LOCUS_STATE,layer:"",name:this.$t("label.showLocus"),state:!0,level:2}],laserSwitchMap:new Map}},computed:{...Object(m.f)(["isMapRedraw","sensorColorDisplayMap","allowMaxStationId"]),...Object(m.f)("srp",["robotInfo"]),...Object(m.d)("srp",["isNotForkLiftRobot","displayedMapNameIsEqualSrosCurMapName","isLockedByOthers","hasRunningState","stationNo","isLocationSucceed"]),robotIconInfo(){let t=1;this.isEmergencyState?t=3:this.isSystemStateIdle||(t=2);return{status:["idle","busy","error"][t-1]}},isRobotIconShow(){return this.mapSwitchItems.find(t=>t.key===c.e.KEY_ROBOT_STATE).state},isDrawingItem(){return this.action===c.e.ACTION_SET_LINE||this.action===c.e.ACTION_SET_TANGENT||this.action===c.e.ACTION_SET_BEZIER||this.action===c.e.ACTION_SET_NODE||this.action===c.e.ACTION_SET_CLEAN_AREA||this.action===c.e.ACTION_SET_STATION||this.action===c.e.ACTION_SET_SELECTION||this.action===c.e.ACTION_SET_STATION_AND_FEATURE_BINDING},hasSelectedEdge(){for(let t of Array.from(this.selectingItems))if(t.itemType()===c.e.MODEL_TYPE_EDGE)return!0;return!1},hasSelectedFunctionArea(){for(let t of Array.from(this.selectingItems))if(t.itemType()===c.e.MODEL_TYPE_FUNC_AREA)return!0;return!1},hasSelectedStation(){for(let t of Array.from(this.selectingItems))if(t.itemType()===c.e.MODEL_TYPE_STATION)return!0;return!1},hasSelectedNoteArea(){return this.selectingItems.some(t=>t.itemType()===c.e.MODEL_TYPE_NOTE_AREA)},isMapLoaded(){return""!==this.mapName&&"NO_MAP"!==this.mapName},runtimeFeatureGroupDisplay(){return this.otherSwitchItems.some(t=>t.state&&t.key===c.e.KEY_RECOGNITION_LIDAR)},isManualControlPage(){return"/manualcontrol"===this.$route.path},wareroomAreas(){return this.mapModel._wareroomAreaList},wareroomRegions(){return this.mapModel._wareroomRegionList},isNotCanMapSave(){return this.displayedMapNameIsEqualSrosCurMapName&&(this.isLockedByOthers||this.hasRunningState)}},created(){this.paperScope=Object(a.shallowRef)(new s.PaperScope),this.heatmapWrapper=Object(a.shallowRef)(new r)},mounted:async function(){this.initPage(),this.createAllLayers(),this.createOtherItems(),this.initStates(),this.$root.$on("start_location",this.setTarget),this.$root.$on("mapSizeChanged",this.resizeMap),this.mapEditable&&await this.changeEditMapState(this.mapEditable,!1)},beforeDestroy:function(){clearTimeout(this.zoomUpdateTimerId),this.zoomUpdateTimerId=0,this.setRedrawStart(!1),this.$root.$off("start_location",this.setTarget),this.$root.$off("mapSizeChanged",this.resizeMap)},destroyed:function(){},watch:{mapEditable(t,e){this.changeEditMapState(t,!0)},isSystemStateIdle(t,e){t&&this.targetItem.isVisible()&&this.targetItem.setVisible(!1)},robotIconInfo:{deep:!0,handler:function(t,e){this.setRobotStyle()}}},methods:{getMapName(){return this.mapName},loadMapJson:function(t,e,i=!1){if(this.mapName=t,this.resetAll(),null===e)return!1;const a=Object(l.a)(e,"data.area",[]);return Object(l.b)(e,"data.area",a.map(t=>Object(d.B)(t))),this.createAllLayers(),this.mapModel.loadFromJson(e,i,!0)},loadMapImage:function(t){this.addImage(t)},async saveMap(){this.finishDrawing(!0),this.setAllItemsVisible(!0),await this.askDeleteUnusedNodes()&&(this.showLoading(this.$t("label.checkingMap")),setTimeout(()=>{this.setAbnormalItemState(),this.hideLoading(),this.mapCheckList.length>0?this.$refs.checkMapList.opened=!0:this.doSaveMap()},600))},exitEditMap(t){this.finishDrawing(!0),this.$emit("exitEdit",t)},doSaveMap(){this.updateStationRecordedNodeId();let t=this.mapModel.saveToJson();t.private.redrawArea=t.private.redrawArea.filter(t=>!t.isNewborn),this.$emit("saveMap",{mapName:this.mapName,mapJson:t})},setRobotFollowingMode(t){this.followingMode=t,this.heatmapWrapper.value.resetDiffSum()},async setRobotStyle(){this.activeLayer(c.e.MAP_LAYER_ACTIVE);const t=(await Object(d.C)(this.robotIconInfo.status)).svgText;return new Promise((e,i)=>{this.paperScope.value.project.importSVG(t,t=>{null!=this.robotItem&&(t.opacity=.8,this.robotItem.updateRobotState(t),this.robotItem.setVisible(this.isRobotIconShow),e(!0))})})},mapImageScale(){return null==this.mapModel?1:this.mapModel.imageScaling()},getDisplayInfo(){let t=this.paperScope.value.view.center;return{name:this.mapName,zoom:this.zoomFactor,anchor:{x:t.x,y:t.y},rotate:this.rotateAngle}},setMapDisplayInfo(t){t.name===this.mapName&&(this.zoomTo(t.zoom),this.centerOn(t.anchor),this.rotateAngleOffset(t.rotate))},checkMapDat(){this.mapCheckList=[],this.checkStations(),this.checkNodes(),this.checkEdges(),this.checkFuncAreas(),this.mapCheckList.sort((t,e)=>e.type-t.type),this.mapCheckList=this.mapCheckList.map((t,e)=>({...t,id:e+1}))},setAbnormalItemState(){this.checkMapDat();for(let t of Array.from(this.mapCheckList)){let e=t.itemId;switch(t.itemType){case c.e.MODEL_TYPE_STATION:this.stationItem(e).setIsAbnormal(!0);break;case c.e.MODEL_TYPE_NODE:this.nodeItem(e).setIsAbnormal(!0);break}}},async doAction(t){switch(t){case c.e.ACTION_SET_SELECTION:this.drawSelection();break;case c.e.ACTION_SET_TAG:this.addTagItem();break;case c.e.ACTION_SET_STATION:this.drawStation();break;case c.e.ACTION_SET_NODE:this.drawNode();break;case c.e.ACTION_SET_BARCODE:this.startRecordDMCode();break;case c.e.ACTION_SET_STATION_AND_FEATURE_BINDING:{let t=this.itemsAt(this.robotLastScenePos,c.e.MODEL_TYPE_STATION,null,!0);if(0===t.length)return void await this.$refs.messageDlg.doShowMessage({title:this.$t("label.notice"),message:this.$t("text.pleaseKeepThePositionOfTheCarAndTheStationConsistent")});if(!this.runtimeFeatureGroupDisplay)return void await this.$refs.messageDlg.doShowMessage({title:this.$t("label.notice"),message:this.$t("text.pleaseTurnOnFeatureRecognition")});this.drawStationAndFeatureBindingLine(),null===this.curStationAndFeatureBindItem&&(this.curStationAndFeatureBindItem=this.addStationAndFeatureBindItem(this.robotLastScenePos,this.robotLastScenePos),this.curStationAndFeatureBindItem.setStationId(t[0].getID()));break}case c.e.ACTION_SET_LINE:this.drawLine();break;case c.e.ACTION_SET_BEZIER:this.drawBezier();break;case c.e.ACTION_SET_ROUND_CORNER:this.drawRoundCorner();break;case c.e.ACTION_SET_AREA:this.drawArea();break;case c.e.ACTION_SET_REDRAW_AREA:this.drawRedrawArea();break;case c.e.ACTION_SET_CLEAN_AREA:this.drawClearArea();break;case c.e.ACTION_SET_UNCLEAN_AREA:this.cancelCleanArea();break;case c.e.ACTION_SET_NOTE_AREA:this.drawNoteArea();break;case c.e.ACTION_SET_LOCATION_AREA:this.drawLocationArea()}},async askDeleteUnusedNodes(){if(!this.hasUnusedNodes())return!0;let t=!0;try{await this.$refs.questionDlg.doAsk({title:this.$t("button.save"),question:this.$t("text.isKeepUnusedNodes"),labelCancel:this.$t("label.no"),labelOkay:this.$t("label.yes")}),t=!0}catch(e){t=e,t&&this.deleteUnusedNodes()}return t},checkStations(){let t=[],e=[];for(let i of Array.from(this.stationItemList)){let a=i.getID(),s=i.getName();if(a>this.allowMaxStationId){this.mapCheckList.push({type:c.g.MSG_ERROR,itemType:c.e.MODEL_TYPE_STATION,itemId:a,desc:this.$t("text.stationIDTooLarge",{id:a,maxValue:this.allowMaxStationId})});continue}if(t.indexOf(a)>=0){this.mapCheckList.push({type:c.g.MSG_ERROR,itemType:c.e.MODEL_TYPE_STATION,itemId:a,desc:this.$t("text.hasDuplicateStationIDs",{id:a})});continue}if(t.push(a),e.indexOf(s)>=0){this.mapCheckList.push({type:c.g.MSG_ERROR,itemType:c.e.MODEL_TYPE_STATION,itemId:a,desc:this.$t("text.hasDuplicateStationNames",{name:s})});continue}e.push(s);let n=i.edgeId();if(n>0){let t=this.getEdgeById(n,this.edgeItemList);null!==t&&t.isOnEdge(i.scenePos())||this.mapCheckList.push({type:c.g.MSG_ERROR,itemType:c.e.MODEL_TYPE_STATION,itemId:a,desc:this.$t("text.edgeOfStationNotNearby",{stationName:s,edgeId:n})})}else{let t=this.intersectItems(i,c.e.MODEL_TYPE_EDGE,i);this.mapCheckList.push({type:c.g.MSG_WARNING,itemType:c.e.MODEL_TYPE_STATION,itemId:a,desc:this.$t("text.stationMaybeOnEdge",{stationName:s,edgeId:t.length>0?t[0].getID():"å¾é"})})}}},checkEdges(){let t={};for(let e of Array.from(this.edgeItemList)){e._dat._cost<=0&&e.updateDat();const{id:i,type:a,sx:s,sy:n,ex:o,ey:r,cx:l,cy:d,dx:u,dy:p,s_facing:m,e_facing:f,cost:g}=e._dat.toJson();if((Number.isNaN(g)||"number"!=typeof g||g<=0)&&this.mapCheckList.push({type:c.g.MSG_ERROR,itemType:c.e.MODEL_TYPE_EDGE,itemId:i,desc:this.$t("text.edgeCostError",{id:i})}),(Number.isNaN(m)||"number"!=typeof m)&&this.mapCheckList.push({type:c.g.MSG_ERROR,itemType:c.e.MODEL_TYPE_EDGE,itemId:i,desc:this.$t("text.edgeStartDirectionError",{id:i})}),(Number.isNaN(f)||"number"!=typeof f)&&this.mapCheckList.push({type:c.g.MSG_ERROR,itemType:c.e.MODEL_TYPE_EDGE,itemId:i,desc:this.$t("text.edgeEndDirectionError",{id:i})}),e.startNodeId()===e.endNodeId()&&this.mapCheckList.push({type:c.g.MSG_ERROR,itemType:c.e.MODEL_TYPE_EDGE,itemId:i,desc:this.$t("text.illegalEdgeNode",{id:i})}),a===c.e.EDGE_TYPE_BEZIER){const t=Object(h.b)(s,n,l,d,u,p,o,r),{ok:e}=Object(h.c)(t,100,10);e||this.mapCheckList.push({type:c.g.MSG_ERROR,itemType:c.e.MODEL_TYPE_EDGE,itemId:i,desc:this.$t("text.edgeMinRadiusLessThan100mm",{id:i})})}let _=e.nodeIds();if(t.hasOwnProperty(_)){let a=t[_];this.mapCheckList.push({type:c.g.MSG_ERROR,itemType:c.e.MODEL_TYPE_EDGE,itemId:i,desc:this.$t("text.edgeStartEndNodeDuplication",{edge1:`${a.getName()}(${a.getID()})`,edge2:`${e.getName()}(${i})`})})}else t[_]=e;e._dat._cost<=0&&e.updateDat()}},checkNodes(){let t=[];for(let e=0;e<this.nodeItemList.length;e++){let i=this.nodeItemList[e],a=i.getID();if(t.indexOf(a)>=0)continue;if(t.push(a),a<=0){this.mapCheckList.push({type:c.g.MSG_ERROR,itemType:c.e.MODEL_TYPE_NODE,itemId:a,desc:this.$t("text.nodeIdInvalid",{id:a})});continue}const s=i.mapPos();let n=this.nodesExactAt(s,i);if(n.length>0){let e=n[0].getID();t.push(e),this.mapCheckList.push({type:c.g.MSG_ERROR,itemType:c.e.MODEL_TYPE_NODE,itemId:a,desc:this.$t("text.nodesIsTooClosed",{id1:a,id2:e})});continue}for(let s=e+1;s<this.nodeItemList.length;s++){let e=this.nodeItemList[s];if(e.isItemMoving())continue;if(!e.isAroundPos(i.scenePos()))continue;let n=e.getID();this.isEdgeNodes(a,n)||(t.push(n),this.mapCheckList.push({type:c.g.MSG_WARNING,itemType:c.e.MODEL_TYPE_NODE,itemId:a,desc:this.$t("text.nodesIsTooClosed",{id1:a,id2:n})}))}}},checkFuncAreas(){this.mapModel._areaDataList.forEach(t=>{const{state:e,id:i,name:a}=t.checkPos();!e&&this.mapCheckList.push({type:c.g.MSG_ERROR,itemType:c.e.MODEL_TYPE_FUNC_AREA,itemId:i,desc:this.$t("text.areaPosErrorTip",{id:i,name:a})})})},isEdgeNodes(t,e){for(let i of Array.from(this.edgeItemList))if(i.isEdgeNodes(t,e))return!0;return!1},setSaveMapState:function(t){t&&(this.cleanAreaItemList=[],this.mapModel.removeCleanAreaList(),this.mapModel.updateOriginalDat(JSON.stringify(this.mapModel.saveToJson())),this.mapEditable&&(this.executeHistory("clear"),this.recordHistory("setSaveMapState ture init history again")))},setTarget:function(){this.setAction(c.e.ACTION_SET_TARGET)},mapStations:function(){return this.mapModel._stationDataList},setSystemIdleState(t){this.isSystemStateIdle=t},setEmergencyState(t){this.isEmergencyState=t},setItemsMovable(t){this.enableMoveItems=t},resetAll:function(){this.mousePressedCnt=0,this.mouseMoveCnt=0,this.mousePos="(0 m, 0 m)",this.mousePoint={x:0,y:0},this.isContextMenuOpen=!1,this.action=c.e.ACTION_NONE,this.curEdgeItem=null,this.curNodeItem=null,this.curStationAndFeatureBindItem=null,this.curStationItem=null,this.curAreaItem=null,this.redrawItem=null,this.editEdgeId=0,this.editStationId=0,this.stations=[],this.edges=[],this.areas=[],this.locationAreas=[],this.noteAreas=[],this.nodes=[],this.tags=[],this.pgvs=[],this.edgeGroups=[],this.edgeGroupsList=[],this.edgeItemList=[],this.nodeItemList=[],this.tagItemList=[],this.stationAndFeatureBindItemList=[],this.barcodeItemList=[],this.stationItemList=[],this.areaItemList=[],this.redrawAreaItemList=[],this.cleanAreaItemList=[],this.noteAreaItemList=[],this.locationAreaItemList=[],this.distanceItemList=[],this.lmkItemList=[],this.runtimeLmkList=[],this.featureItems=[],this.runtimeFeatureItems=[],this.contextMenuClickedPos=null,this.moveToStationOpts=[],this.selectingItems=[],this.clipboardItems=[],this.mapCheckList=[],this.orignalUserDefinedParams=null,this.stationsOnMovingNode=[],this.axisItem=null,this.robotItem=null,this.robotLocusItem=null,this.navPathItem=null,this.laserPointsItem=null,this.gridItem=null,this.selectionItem=null,this.distanceItem=null,this.avoidRectangleItem=null,this.robotLastScenePos=null,this.moveDelta={x:0,y:0},this.getProjects().forEach(t=>{t.view.scale(1/this.zoomFactor),t.clear()}),this.rotateAngleOffset(-this.rotateAngle),this.zoomFactor=1,this.zoomFactorMin=1,this.mapScale=1,this.rotateAngle=0,this.setHeatmapState(!1),this.getMapSwitchItem(c.e.KEY_HEATMAP).state=!1,this.mapImgRaster=null},initPage:function(){this.setPerformanceState(!this.isMapEditable());let t=document.getElementById(c.f[this.mapsGroupsIndex].viewMapImageId);this.paperScope.value.setup(t);let e=document.getElementById(c.f[this.mapsGroupsIndex].viewMapItemsId);this.paperScope.value.setup(e);let i=document.getElementById(c.f[this.mapsGroupsIndex].viewMapActiveId);this.paperScope.value.setup(i),t.style.background="#F0F1F5";let a=document.getElementById(c.f[this.mapsGroupsIndex].heatmapContainerId);this.setViewAutoUpdate(c.f[this.mapsGroupsIndex].viewMapImageId,!1),this.setViewAutoUpdate(c.f[this.mapsGroupsIndex].viewMapActiveId,!1),this.setViewAutoUpdate(c.f[this.mapsGroupsIndex].viewMapItemsId,!1);let s=this.getView(c.f[this.mapsGroupsIndex].viewMapItemsId),n=this.getView(c.f[this.mapsGroupsIndex].viewMapImageId);this.heatmapWrapper.value.initialize(a),this.heatmapWrapper.value.setData([]);var o=new this.paperScope.value.Tool;o.minDistance=8,e.onmousewheel=t=>{if(t.preventDefault(),t.stopPropagation(),t.ctrlKey)t.deltaY<0?this.onZoomIn():this.onZoomout();else{let e={x:-t.deltaX,y:-t.deltaY};this.translateMapView(e),this.heatmapWrapper.value.move(e.x,e.y)}},e.ontouchmove=t=>{this.action===c.e.ACTION_NONE&&(t.stopPropagation(),this.$refs.ctxMenu.removeTouchMoveEventListener())},s.onResize=t=>{this.resizeMap();let e=document.getElementById("mapView");this.isHorzontal=e.clientWidth>e.clientHeight,e=null},n.onResize=t=>{},s.onFrame=t=>{t.count%2==0&&(this.updateView(c.f[this.mapsGroupsIndex].viewMapItemsId),this.updateView(c.f[this.mapsGroupsIndex].viewMapActiveId))},s.onMouseDown=t=>{this.focusOnMap();let e=t.point;if(2===t.event.button)return this.contextMenuClickedPos=e,this.isMapEditable()||(this.moveToStationOpts=this.getStationOptions(e)),this.setContextMenuState(!0),void this.$nextTick(()=>{this.setOpenContextMenu(!0)});if(1!==t.event.button){if(this.isDrawingHeatmap()){this.projectToView(t.point)}if(0===t.event.button||"touchstart"===t.event.type){switch(this.action){case c.e.ACTION_SET_TARGET:return this.setPerformanceState(!1),void this.targetItem.startDraw(e);case c.e.ACTION_SET_TANGENT:case c.e.ACTION_SET_BEZIER:case c.e.ACTION_SET_LINE:return void this.drawEdgeItem(e);case c.e.ACTION_SET_CLEAN_AREA:case c.e.ACTION_SET_REDRAW_AREA:case c.e.ACTION_SET_NOTE_AREA:case c.e.ACTION_SET_LOCATION_AREA:case c.e.ACTION_SET_AREA:return void this.drawRect(e);case c.e.ACTION_SET_NODE:return void this.endDrawNodeItem(e);case c.e.ACTION_SET_STATION_AND_FEATURE_BINDING:this.drawStationAndFeatureBindingLine(e);break;case c.e.ACTION_SET_EDGE_POLE:return void this.finishAdjustEdge(e);case c.e.ACTION_SET_STATION_POINT:this.finishEditStationPoint(e);break;case c.e.ACTION_SET_SELECTION:this.activeLayer(c.e.MAP_LAYER_OTHER),this.selectionItem.startDraw(e);break;case c.e.ACTION_CALCULATE_DISTANCE:return t.preventDefault(),t.stopPropagation(),void this.drawDistanceItem(e)}this.setSelectingItems(e)}}else this.setMoveDelta(t.event.screenX,t.event.screenY)},s.onMouseUp=t=>{if(1!==t.button){if(0===t.event.button||"touchend"===t.event.type){var e=t.point;switch(this.action){case c.e.ACTION_SET_TARGET:this.setTargetFinished(e),this.setPerformanceState(!0);break;case c.e.ACTION_SET_STATION:return void this.endDrawStation(e);case c.e.ACTION_SET_STATION_AND_FEATURE_BINDING:this.endDrawStationAndFeatureBindingLine(e);break;case c.e.ACTION_SET_SELECTION:this.endDrawSelectionArea(e);case c.e.ACTION_MOVE_ITEMS:}}}else this.setMoveDelta(0,0)},s.onMouseDrag=t=>{var e=t.point;if(4===t.event.buttons){let e=t.event.screenX,i=t.event.screenY,a=this.getMoveDelta(e,i);return void this.translateMapView(a)}switch(this.action){case c.e.ACTION_SET_TARGET:this.targetItem.drawing(e);break;case c.e.ACTION_SET_STATION:break;case c.e.ACTION_SET_SELECTION:this.selectionItem.drawing(e)}},e.onmousemove=t=>{if(null==this.mapModel)return;if(this.isPerformanceSwitchOn){if(t.preventDefault(),t.stopPropagation(),this.mouseMoveCnt++,this.mouseMoveCnt%4!=0)return;this.mouseMoveCnt=0}let e=this.viewToProject({x:t.x,y:t.y}),i=this.mapModel.mapFromCanvas(e);if(this.mousePoint={...e},this.mousePos="("+(i.x/100).toFixed(2)+" m, "+(i.y/100).toFixed(2)+" m)",!this.isSelectDialogPopup())switch(this.action){case c.e.ACTION_SET_TANGENT:case c.e.ACTION_SET_BEZIER:case c.e.ACTION_SET_LINE:this.drawingEdge(e);break;case c.e.ACTION_SET_NODE:this.drawingNodeItem(e);break;case c.e.ACTION_SET_STATION_AND_FEATURE_BINDING:{let t=this.itemsAt(e,c.e.MODEL_TYPE_FEATURE,null,!0);t.length>0?this.drawingStationAndFeatureBindItem(t[0].scenePos()):this.drawingStationAndFeatureBindItem(e);break}case c.e.ACTION_SET_STATION:this.drawingStation(e);break;case c.e.ACTION_SET_CLEAN_AREA:case c.e.ACTION_SET_AREA:case c.e.ACTION_SET_NOTE_AREA:case c.e.ACTION_SET_LOCATION_AREA:case c.e.ACTION_SET_REDRAW_AREA:this.drawingRect(e);break;case c.e.ACTION_SET_EDGE_POLE:this.adjustEdge(e);break;case c.e.ACTION_SET_STATION_POINT:this.setStationPoint(e);break;case c.e.ACTION_CALCULATE_DISTANCE:this.distanceItem&&this.distanceItem.drawing(e)}},this.paperScope.value.tool.onKeyDown=t=>{if("escape"===t.key&&this.finishDrawing(),this.isMapEditable()&&document.activeElement.id===c.f[this.mapsGroupsIndex].viewMapItemsId)if(t.stopPropagation(),t.preventDefault(),"delete"===t.key||"backspace"===t.key)this.deleteAllSelectedItems();else if("t"===t.key&&this.isShiftDown())this.addTagItem();else if("s"===t.key&&this.isCtrlDown())this.saveMap();else if("c"===t.key&&this.isCtrlDown())this.copyAreaItem();else if("v"===t.key&&this.isCtrlDown())this.pasteAreaItem();else if("m"===t.key&&this.isShiftDown()){if(!this.hasItemsSelected())return;this.$refs.selectCoordinate.opened=!0}else if("x"===t.key&&this.isShiftDown()){if(!this.hasItemsSelected())return;this.setSelectedItemsAxis("x")}else if("y"===t.key&&this.isShiftDown()){if(!this.hasItemsSelected())return;this.setSelectedItemsAxis("y")}else if("l"===t.key)this.drawLine();else if("t"===t.key)this.drawTangent();else if("b"===t.key)this.drawBezier();else if("n"===t.key)this.drawNode();else if("q"===t.key)this.startRecordDMCode();else if("s"===t.key)this.drawStation();else if("r"===t.key)this.drawArea();else if("f"===t.key)this.drawRoundCorner();else if("c"===t.key&&this.isShiftDown())this.cancelCleanArea();else if("c"===t.key)this.drawClearArea();else if("space"===t.key)this.drawSelection();else if("z"===t.key&&this.isCtrlDown())this.executeHistory("undo");else if("y"===t.key&&this.isCtrlDown())this.executeHistory("redo");else if("left"===t.key&&this.enableMoveItems){this.startMoveSelectedItems();let t={x:-c.e.MOVE_ITEM_BIG_STEP,y:0};this.isCtrlDown()&&(t.x=-c.e.MOVE_ITEM_SMALL_STEP),this.movingSelectedItems(t)}else if("right"===t.key&&this.enableMoveItems){this.startMoveSelectedItems();let t={x:c.e.MOVE_ITEM_BIG_STEP,y:0};this.isCtrlDown()&&(t.x=c.e.MOVE_ITEM_SMALL_STEP),this.movingSelectedItems(t)}else if("up"===t.key&&this.enableMoveItems){this.startMoveSelectedItems();let t={x:0,y:-c.e.MOVE_ITEM_BIG_STEP};this.isCtrlDown()&&(t.y=-c.e.MOVE_ITEM_SMALL_STEP),this.movingSelectedItems(t)}else if("down"===t.key&&this.enableMoveItems){this.startMoveSelectedItems();let t={x:0,y:c.e.MOVE_ITEM_BIG_STEP};this.isCtrlDown()&&(t.x=c.e.MOVE_ITEM_SMALL_STEP),this.movingSelectedItems(t)}},this.paperScope.value.tool.onKeyUp=t=>{if(!this.isMapEditable())return;let e=t.key;"left"!==e&&"right"!==e&&"up"!==e&&"down"!==e||this.action===c.e.ACTION_MOVE_ITEMS&&this.endMoveSelectedItems({isRecord:!0,fromFun:"onKeyUp "+e})},t=null,e=null,i=null,a=null,o=null},isShiftDown(){return this.paperScope.value.Key.modifiers.shift},isCtrlDown(){return this.paperScope.value.Key.modifiers.control},focusOnMap(){var t=document.getElementById(c.f[this.mapsGroupsIndex].viewMapItemsId);t.setAttribute("tabindex","0"),t.focus(),t=null},onPinchIn:function(t){if(0===t.velocity)return;let e=t.distance/c.e.PINCH_ZOOM_TOTAL_LEVEL;e>.5&&(e=.5),this.zoomFactor<this.zoomFactorMin||this.zoomMap(1-e)},onPinchOut:function(t){if(0===t.velocity)return;let e=t.distance/c.e.PINCH_ZOOM_TOTAL_LEVEL;e>1&&(e=1),this.zoomFactor>c.e.MAX_ZOOM_IN||this.zoomMap(1+e)},onPanStart:function(t){if(!Object(c.l)("default")&&!Object(c.l)(""))return;let e=t.distance,i=t.angle-this.getView(c.f[this.mapsGroupsIndex].viewMapImageId).rotation,a=e*Math.cos(Object(c.b)(i)),s=e*Math.sin(Object(c.b)(i));this.setMoveDelta(a,s),this.isCtrlDown()||this.startMoveSelectedItems(),this.action===c.e.ACTION_NONE&&this.followingMode!==c.i.AllwaysOnCenter&&this.isDrawingHeatmap()&&this.heatmapWrapper.value.resetDiffSum()},onPanMove:function(t){if(t.preventDefault(),!Object(c.l)("default")&&!Object(c.l)(""))return;let e=t.distance,i=t.angle-this.getView(c.f[this.mapsGroupsIndex].viewMapImageId).rotation,a=e*Math.cos(Object(c.b)(i)),s=e*Math.sin(Object(c.b)(i)),n=this.getMoveDelta(a,s);this.action!==c.e.ACTION_MOVE_ITEMS||this.isCtrlDown()?this.action!==c.e.ACTION_NONE||this.isMapEditable()||(this.translateMapView(n),this.heatmapWrapper.value.move(n.x,n.y)):this.movingSelectedItems(n)},onPanEnd:function(t){(Object(c.l)("default")||Object(c.l)(""))&&(this.setMoveDelta(0,0),this.action!==c.e.ACTION_MOVE_ITEMS||this.isCtrlDown()||this.endMoveSelectedItems({isRecord:!0,fromFun:"onPanEnd"}),this.action===c.e.ACTION_NONE&&this.followingMode!==c.i.AllwaysOnCenter&&this.isDrawingHeatmap()&&this.heatmapWrapper.value.resetDiffSum())},onPressed(t){!this.isMapEditable()&&this.isMobile&&(this.contextMenuClickedPos=this.viewToProject(t.center),this.moveToStationOpts=this.getStationOptions(this.contextMenuClickedPos),this.setContextMenuState(!0),this.$nextTick(()=>{this.setOpenContextMenu(!0)}))},setMoveDelta(t,e){this.moveDelta.x=t/this.zoomFactor,this.moveDelta.y=e/this.zoomFactor},getMoveDelta(t,e){let i={x:0,y:0};return i.x=t/this.zoomFactor-this.moveDelta.x,i.y=e/this.zoomFactor-this.moveDelta.y,this.moveDelta.x=t/this.zoomFactor,this.moveDelta.y=e/this.zoomFactor,i},isMapEditable:function(){return this.mapEditable},async askToSaveMap(t=!1){let e=!t;if(e)try{e=await this.$refs.questionDlg.doAsk({title:this.$t("label.saveMap"),question:this.$t("text.isSaveMap")})}catch(t){e=!1}e?await this.saveMap():(this.deleteMainItems(),this.resetMapItemLayer(),this.mapModel.restoreFromOriginDat(),this.updateMainLayer(),this.updateEdgeGroupList(),this.initEdgeGroups(),this.updateMap(!1),this.activeLayer(c.e.MAP_LAYER_ACTIVE))},setPerformanceState:function(t){this.isPerformanceSwitchOn=t},setViewAutoUpdate:function(t,e){this.getView(t).autoUpdate=e},setMapEditable:function(t){this.enableMoveItems=t,this.setPerformanceState(!t);let e=this.allEditableItems();for(let i=0;i<e.length;i++)null!=e[i]&&e[i].setEditable(t);this.setNodesVisible(t),this.finishDrawing()},setMapItemNameVisible(t){for(let e of Array.from(this.allEditableItems()))e.setNameVisible(t)},changeEditMapState:async function(t,e=!0){this.isManualControlPage&&(t?(this.focusOnMap(),this.recordHistory("updateMapEditState init history"),this.isMapRedraw&&(e||await Object(f.Q)(3e3),this.setRedrawStart(!0))):(this.clipboardItems=[],this.deselectAllItems(),!this.isMapRedraw&&this.mapModel.isDatChanged()&&await this.askToSaveMap(this.isNotCanMapSave),this.executeHistory("clear")),this.setMapEditable(t),this.updateMap())},drawLine:function(){if(this.action===c.e.ACTION_SET_LINE)return;let t=null;null!==this.curEdgeItem&&(t=this.curEdgeItem.startScenePos()),this.finishDrawing(),this.setAction(c.e.ACTION_SET_LINE),null!==t&&this.drawEdgeItem(t)},drawTangent:function(){if(this.action===c.e.ACTION_SET_TANGENT)return;let t=null;null!==this.curEdgeItem&&(t=this.curEdgeItem.startScenePos()),this.finishDrawing(),this.setAction(c.e.ACTION_SET_TANGENT),null!==t&&this.drawEdgeItem(t)},drawBezier:function(){if(this.action===c.e.ACTION_SET_BEZIER)return;let t=null;null!==this.curEdgeItem&&(t=this.curEdgeItem.startScenePos()),this.finishDrawing(),this.setAction(c.e.ACTION_SET_BEZIER),null!==t&&this.drawEdgeItem(t)},drawNode:function(){this.action!==c.e.ACTION_SET_NODE&&(this.finishDrawing(),this.setAction(c.e.ACTION_SET_NODE))},drawStationAndFeatureBindingLine:function(){this.action!==c.e.ACTION_SET_STATION_AND_FEATURE_BINDING&&(this.finishDrawing(),this.setAction(c.e.ACTION_SET_STATION_AND_FEATURE_BINDING))},endDrawStationAndFeatureBindingLine:function(t){if(null==this.curStationAndFeatureBindItem)return;let e=this.itemsAt(t,c.e.MODEL_TYPE_FEATURE,null,!0);if(e.length>0){let t=this.curStationAndFeatureBindItem.getStationId();for(let e of this.stationAndFeatureBindItemList)if(e.getStationId()===t&&e.getID()!==this.curStationAndFeatureBindItem.getID()){this.deleteStationAndFeatureBindItem(e.getID());break}let i=this.addFeatureItem(e[0]._dat);this.featureItems.push(i),this.curStationAndFeatureBindItem.endDraw(i.scenePos()),this.curStationAndFeatureBindItem.setFeatureId(i.getID()),i.setStationId(t),this.curStationAndFeatureBindItem=null,this.setAction(c.e.ACTION_NONE),i.updateShape(),this.recordHistory("endDrawStationAndFeatureBindingLine")}},drawStation:function(){this.action!==c.e.ACTION_SET_STATION&&(this.finishDrawing(),this.setAction(c.e.ACTION_SET_STATION))},drawArea:function(){this.action!==c.e.ACTION_SET_AREA&&(this.finishDrawing(),this.setAction(c.e.ACTION_SET_AREA))},drawRoundCorner:function(){this.action!==c.e.ACTION_SET_ROUND_CORNER&&(this.finishDrawing(!1),this.setAction(c.e.ACTION_SET_ROUND_CORNER),this.selectRoundCornerEdges().then(t=>{this.createRoundCorner(t.radius,this.edgeItem(t.e1),this.edgeItem(t.e2)),this.recordHistory("drawRoundCorner")}).catch(t=>{}),this.setAction(c.e.ACTION_NONE))},drawRedrawArea:function(){this.action!==c.e.ACTION_SET_REDRAW_AREA&&(this.finishDrawing(),this.setAction(c.e.ACTION_SET_REDRAW_AREA))},drawClearArea:function(){this.action!==c.e.ACTION_SET_CLEAN_AREA&&(this.finishDrawing(),this.setAction(c.e.ACTION_SET_CLEAN_AREA))},drawNoteArea:function(){this.action!==c.e.ACTION_SET_NOTE_AREA&&(this.finishDrawing(),this.setAction(c.e.ACTION_SET_NOTE_AREA))},drawLocationArea:function(){this.action!==c.e.ACTION_SET_LOCATION_AREA&&(this.finishDrawing(),this.setAction(c.e.ACTION_SET_LOCATION_AREA))},drawSelection:function(){this.action!==c.e.ACTION_SET_SELECTION&&(this.isCtrlDown()||this.finishDrawing(),this.setAction(c.e.ACTION_SET_SELECTION))},startRecordDMCode(){let t=this.stationNo;if(!t&&this.isLocationSucceed){const e=this.itemsAt(this.robotLastScenePos,c.e.MODEL_TYPE_STATION);e.length>0&&(t=e[0].getID())}this.$refs.refStationDMCodeCreator.init(t)},async recordDMCode(t){let e=!1;const i=this.stationItemList.filter(e=>e.getDMCodeID()===t.pgvId&&e.getID()!==t.stationId).map(t=>t.getName());i.length>0&&(e=await this.doAsk({title:this.$t("label.notice"),question:this.$t("text.askResetStationDmcode",{dmCodeId:t.pgvId,stations:i.join(",")}),labelCancel:this.$t("label.no"),labelOkay:this.$t("label.yes")})),this.addDMcodeItem({...t,type:c.e.QRCODE_TYPE_PGV},e);const a=this.stationItem(t.stationId);a&&a.setDMCodeOffset(t.pgvId,t.x,t.y,Object(c.b)(t.angle)),this.recordHistory("recordDMCode")},cancelCleanArea:function(){this.finishDrawing();let t=this.cleanAreaItemList.length;t<=0||(this.deleteCleanArea(this.cleanAreaItemList[t-1].getID()),this.recordHistory("cancelCleanArea"))},drawEdgeItem:function(t){this.mousePressedCnt++<=0?this.startDrawEdge(t):this.endDrawEdge(t)},startDrawEdge:function(t){if(!this.drawEdgeCheck(t))return void(this.mousePressedCnt=0);let e=this.mapModel.createModel(c.e.MODEL_TYPE_EDGE);switch(this.action){case c.e.ACTION_SET_TANGENT:case c.e.ACTION_SET_LINE:e._type=c.e.EDGE_TYPE_LINE;break;case c.e.ACTION_SET_BEZIER:e._type=c.e.EDGE_TYPE_BEZIER}null!=this.curEdgeItem&&(this.deleteEdge(this.curEdgeItem.getID()),this.curEdgeItem=null),this.curEdgeItem=this.createEdge(e),this.action===c.e.ACTION_SET_TANGENT&&this.curEdgeItem.setDrawTangent(!0);let i=this.itemsAt(t,c.e.MODEL_TYPE_STATION);if(this.action!==c.e.ACTION_SET_LINE){let e=t;i.length>0&&(e=i[0].scenePos()),this.selectEdge(e,this.curEdgeItem).then(t=>{if(null==t&&this.action===c.e.ACTION_SET_BEZIER)return void this.drawingEdgeStart(e);let i=this.edgeItem(t.value);if(!this.setEdgeUnitVector(e,c.e.EDGE_POLE_START,i,this.curEdgeItem))return this.deleteEdge(this.curEdgeItem.getID()),void(this.curEdgeItem=null);this.drawingEdgeStart(e)}).catch(t=>{this.deleteEdge(this.curEdgeItem.getID()),this.curEdgeItem=null})}else this.drawingEdgeStart(t)},drawingEdge:async function(t){if(null==this.curEdgeItem)return void(this.mousePressedCnt=0);if(this.isCtrlDown()){if(null===this.curEdgeItem.mapStartUnitVector()){let t=this.itemsAt(this.curEdgeItem.startScenePos(),c.e.MODEL_TYPE_STATION);if(t.length>0){let e=await this.selectItem(this.$t("text.chooseStation"),this.selectItemOptions(t));if(null==e)return;let i=this.stationItem(e.id);null!==i&&(this.action===c.e.ACTION_SET_LINE&&this.curEdgeItem.setDrawTangent(!0),this.curEdgeItem.setMapStartUnitVector(i.mapUnitVector()))}}}else this.action===c.e.ACTION_SET_LINE&&(this.curEdgeItem.setDrawTangent(!1),this.curEdgeItem.setMapStartUnitVector(null));let e=this.itemScenePosAt(t);null!==e?this.curEdgeItem.drawing(e.scenePos()):this.curEdgeItem.drawing(t)},endDrawEdge:function(t){if(this.mousePressedCnt=0,null!=this.curEdgeItem){if(this.curEdgeItem.isStartScenePos(t)||Object(c.n)(this.curEdgeItem.startScenePos(),t)<10)return this.deleteEdge(this.curEdgeItem.getID()),this.curEdgeItem=null,void this.setAction(c.e.ACTION_NONE);if(this.action===c.e.ACTION_SET_BEZIER){let e=this.itemsAt(t,c.e.MODEL_TYPE_STATION),i=t;e.length>0&&(i=e[0].scenePos()),this.selectEdge(i,this.curEdgeItem).then(t=>{if(null!==t){let e=this.edgeItem(t.value);if(!this.setEdgeUnitVector(i,c.e.EDGE_POLE_END,e,this.curEdgeItem))return this.deleteEdge(this.curEdgeItem.getID()),this.curEdgeItem=null,void this.setAction(c.e.ACTION_NONE)}this.drawingEdgeEnd(i),this.setEdgeForStation(this.curEdgeItem);let e=this.curEdgeItem.endScenePos();this.curEdgeItem=null,this.recordHistory("endDrawEdge BEZIER"),this.drawEdgeItem(e)}).catch(t=>{this.deleteEdge(this.curEdgeItem.getID()),this.curEdgeItem=null,this.setAction(c.e.ACTION_NONE)})}else{this.drawingEdgeEnd(t);let e=this.curEdgeItem.endScenePos();this.curEdgeItem=null,this.recordHistory("endDrawEdge normal - LINE: 2, TANGENT: 3, ARC: 4, BEZIER: 5; value: "+this.action),this.drawEdgeItem(e)}}},drawingEdgeStart:function(t){if(null==this.curEdgeItem)return;let e=this.itemsAt(t,c.e.MODEL_TYPE_STATION),i=this.itemsAt(t,c.e.MODEL_TYPE_NODE);i.length>0?(this.curEdgeItem.startDraw(i[0].scenePos()),this.curEdgeItem.setStartNodeId(i[0].getID())):e.length>0?this.curEdgeItem.startDraw(e[0].scenePos()):this.curEdgeItem.startDraw(t)},drawingEdgeEnd:function(t){if(null==this.curEdgeItem)return;let e=this.curEdgeItem.startScenePos(),i=this.itemsAt(e,c.e.MODEL_TYPE_NODE);i.length<=0?this.curEdgeItem.setStartNodeId(this.addNodeItem(e).getID()):this.curEdgeItem.setStartNodeId(i[0].getID());let a=this.itemsAt(t,c.e.MODEL_TYPE_NODE),s=this.itemsAt(t,c.e.MODEL_TYPE_STATION);a.length>0?(this.curEdgeItem.endDraw(a[0].scenePos()),this.curEdgeItem.setEndNodeId(a[0].getID())):s.length>0?(this.curEdgeItem.endDraw(s[0].scenePos()),a=this.itemsAt(s[0].scenePos(),c.e.MODEL_TYPE_NODE),a.length>0?this.curEdgeItem.setEndNodeId(a[0].getID()):this.curEdgeItem.setEndNodeId(this.addNodeItem(s[0].scenePos()).getID())):(this.curEdgeItem.endDraw(t),this.curEdgeItem.setEndNodeId(this.addNodeItem(this.curEdgeItem.endScenePos()).getID())),this.curEdgeItem.bringToFront()},drawRect:function(t){0===this.mousePressedCnt++?this.startDrawRect(t):this.endDrawRect(t)},startDrawRect:function(t){null!==this.curAreaItem&&(this.curAreaItem=null);let e=this.createRectDat(this.action);null!=e&&(this.curAreaItem=this.createArea(e),this.curAreaItem.startDraw(t))},drawingRect:function(t){null!=this.curAreaItem?this.curAreaItem.drawing(t):this.mousePressedCnt=0},endDrawRect:function(t){if(!this.curAreaItem)return void(this.mousePressedCnt=0);if(!this.curAreaItem.checkRectPaKeepAwayPc(t))return;this.mousePressedCnt=0,this.curAreaItem.endDraw(t);let e=this.curAreaItem.itemType();this.curAreaItem=null,this.recordHistory("endDrawRect - action: "+this.action),e===c.e.MODEL_TYPE_CLEAN_AREA?this.drawClearArea():this.setAction(c.e.ACTION_NONE)},copyAreaItem(){this.action===c.e.ACTION_NONE&&this.hasItemsSelected()&&(this.hasSelectedFunctionArea||this.hasSelectedNoteArea)&&(this.clipboardItems=[this.selectingItems[0]])},pasteAreaItem(){if(this.action===c.e.ACTION_NONE&&1===this.clipboardItems.length){let t=this.clipboardItems[0].getDat();if(!t.isFuncAreaModel()&&!t.isNoteAreaModel())return;const e=this.createRectDat(t.isFuncAreaModel()?c.e.ACTION_SET_AREA:c.e.ACTION_SET_NOTE_AREA),i=this.createArea(e),{x:a,y:s}=this.mapModel.mapFromCanvas(this.mousePoint),n=t.toJson(!1),{"pa.x":o,"pa.y":r,"pc.x":l,"pc.y":d}=n,[h,u]=[Math.abs(l-o),Math.abs(r-d)];let p={...n,"pa.x":a,"pa.y":s,"pc.x":a+h,"pc.y":s-u,"pb.x":a+h,"pb.y":s,"pd.x":a,"pd.y":s-u,id:i.getID(),name:i.getName()};e.fromJson(p,!1),i.updateShape(),this.recordHistory("pasteAreaItem")}},drawingStation:function(t){if(null==this.curStationItem){let e=this.mapModel.createModel(c.e.MODEL_TYPE_STATION);if(null==e)return;if(this.curStationItem=this.createStation(e),this.curStationItem.startDraw(t),null==this.curStationItem)return}this.isBeyondControlDistance(this.curStationItem.scenePos(),t)&&this.curStationItem.drawing(t);let e=this.itemScenePosAt(t,this.curStationItem);if(null!=e)return t=e.scenePos(),void this.curStationItem.drawing(t);let i=this.intersectItems(this.curStationItem,c.e.MODEL_TYPE_EDGE);if(i=this.getEdgeByType(c.e.EDGE_TYPE_LINE,i),i.length>0){let e=i[0].nearestPosOnEdge(t);if(null==e)return;this.curStationItem.drawing(e)}else this.curStationItem.drawing(t)},endDrawStation:function(t){if(null==this.curStationItem)return;this.intersectItems(this.curStationItem,c.e.MODEL_TYPE_EDGE).length>0?this.selectEdge(this.curStationItem.scenePos()).then(e=>{if(null==e||null==this.edgeItem(e.value))this.drawStationDone(t);else{let i=this.edgeItem(e.value);if(i.edgeType()===c.e.EDGE_TYPE_BEZIER&&!i.isStartScenePos(t)&&!i.isEndScenePos(t))return void this.$notify({message:this.$t("text.unsupportDropStationOnBezier"),timeout:3e3,type:"negative",position:"top"});this.curStationItem.setEdgeId(i.getID()),i.isStartScenePos(t)?this.curStationItem.setYaw(i.startFacing()):this.curStationItem.setYaw(i.endFacing());let a=i.nearestPosOnEdge(t);null==a?this.drawStationDone(t):this.drawStationDone(a)}}).catch(t=>{}):this.drawStationDone(t)},drawStationDone:function(t){if(this.isSelectDialogPopup())return;if(null==this.curStationItem)return;let e=this.itemScenePosAt(t);null!=e&&(t=e.scenePos()),this.curStationItem.endDraw(t),this.curStationItem.bringToFront(),this.curStationItem=null,this.recordHistory("drawStationDone")},async drawDistanceItem(t){0===this.mousePressedCnt++?(this.activeLayer(c.e.MAP_LAYER_ACTIVE),this.distanceItem&&(this.distanceItem.delete(),this.distanceItem=null),this.distanceItem=this.createDistance(),this.distanceItem.startDraw(t)):(this.distanceItem.endDraw(t),this.mousePressedCnt=0,this.setAction(c.e.ACTION_NONE),await this.$refs.messageDlg.doShowMessage({title:this.$t("button.calculateDistance"),message:this.$t("text.distanceBetween",{len:this.distanceItem.getDistance()})}),this.distanceItemList.push(this.distanceItem),this.distanceItem=null)},createRectDat:function(t){let e=null;switch(t){case c.e.ACTION_SET_AREA:e=this.mapModel.createModel(c.e.MODEL_TYPE_FUNC_AREA),e._name=this.$t("label.region")+e.getID();break;case c.e.ACTION_SET_REDRAW_AREA:e=this.mapModel.createModel(c.e.MODEL_TYPE_REDRAW_AREA),e._name=this.$t("label.redrawRegion")+e.getID(),e.setNewborn(!0);break;case c.e.ACTION_SET_CLEAN_AREA:e=this.mapModel.createModel(c.e.MODEL_TYPE_CLEAN_AREA);break;case c.e.ACTION_SET_NOTE_AREA:e=this.mapModel.createModel(c.e.MODEL_TYPE_NOTE_AREA),e._name=this.$t("label.noteArea")+e.getID();break;case c.e.ACTION_SET_LOCATION_AREA:e=this.mapModel.createModel(c.e.MODEL_TYPE_LOCATION_AREA),e._name=this.$t("label.locationArea")+e.getID()}return e},drawingNodeItem:function(t){null==this.curNodeItem&&(this.curNodeItem=this.addNodeItem(t),this.curNodeItem.startDraw(t),this.curNodeItem.updateShape()),this.isBeyondControlDistance(this.curNodeItem.scenePos(),t)&&this.curNodeItem.drawing(t);let e=this.itemScenePosAt(t);if(null!=e)return void this.curNodeItem.drawing(e.scenePos());let i=this.intersectItems(this.curNodeItem,c.e.MODEL_TYPE_EDGE);if(i=this.getEdgeByType(c.e.EDGE_TYPE_LINE,i),i.length>0){let e=i[0].nearestPosOnEdge(t);if(null==e)return;this.curNodeItem.drawing(e)}else this.curNodeItem.drawing(t)},endDrawNodeItem:function(t){if(null==this.curNodeItem)return;if(this.itemsAt(t,c.e.MODEL_TYPE_NODE,this.curNodeItem).length>0)return this.deleteNode(this.curNodeItem.getID()),void(this.curNodeItem=null);let e=this.itemScenePosAt(t,this.curNodeItem),i=this.intersectItems(this.curNodeItem,c.e.MODEL_TYPE_EDGE),a=this.getEdgeByType(c.e.EDGE_TYPE_LINE,i),s=this.getEdgeByType(c.e.EDGE_TYPE_BEZIER,i);if(null!=e&&(this.curNodeItem.endDraw(e.scenePos()),0===a.length||s.length))return this.curNodeItem=null,void this.recordHistory("endDrawNodeItem nodeStation");if(s.length>0)for(let e of Array.from(s))if(null!==e.hitTest(t))return void this.$notify({message:this.$t("text.unsupportDropNodeOnBezier"),timeout:3e3,type:"negative",position:"top"});if(a.length>0){e||this.curNodeItem.endDraw(a[0].nearestPosOnEdge(t));for(let t=0;t<a.length;t++){let e=a[t];if(null==e)return this.deleteNode(this.curNodeItem.getID()),void(this.curNodeItem=null);this.repaireEdgeNode(e),this.splitEdge(this.curNodeItem.getID(),e)}this.curNodeItem=null,this.recordHistory("endDrawNodeItem splitEdge")}else this.curNodeItem.endDraw(t),this.curNodeItem=null,this.recordHistory("endDrawNodeItem normal")},drawingStationAndFeatureBindItem:function(t){null!=this.curStationAndFeatureBindItem&&this.curStationAndFeatureBindItem.drawing(t)},setAction:function(t){this.action=t},checkRoundCorner:function(t,e,i){let a="",s=this.edgeItem(e),n=this.edgeItem(i);if(null==s||null==n)return a=this.$t("text.illegalEdge"),a;if(s===n)return a=this.$t("text.unableToDrawBezierCornerByTheSelectedEdge"),a;let o=Object(c.h)(s.startToEndYaw()),r=Object(c.h)(n.startToEndYaw());if(Math.abs(o-r)<1)return a=this.$t("text.unableToDrawBezierCornerByTheSelectedEdge"),a;let l=this.lineCrossPos(s,n);if(this.isPointBetween(s.startScenePos(),l,s.endScenePos()))return a=this.$t("text.unableToDrawBezierCornerByTheSelectedEdge"),a;if(this.isPointBetween(n.endScenePos(),l,n.startScenePos()))return a=this.$t("text.unableToDrawBezierCornerByTheSelectedEdge"),a;let d=this.calculateBezierPoint(t,s,n);if(null==d)return a=this.$t("text.failCalculateBezierPath"),d=null,a;let h=d.b0,u=d.e0;return this.isPointBetween(h,s.startScenePos(),l)&&this.isPointBetween(u,n.endScenePos(),l)?(l=null,d=null,a):(a=this.$t("text.illegalMinRadius"),a)},calculateBezierPoint:function(t,e,i){if(null==e||null==i||t<.001)return null;let a=this.lineCrossPos(e,i),s=Object(c.n)(e.startScenePos(),a),n=Object(c.n)(a,i.endScenePos()),o=.4*(Math.sqrt(6)-1),r=(o+4)/13.2364,l=Math.pow(o+4,2)/(54*r),d=1/t,h=i.radToEdge(e),u=Math.abs(h)/2,p=l*Math.sin(u)/(d*Math.pow(Math.cos(u),2));p/=.02;let m=r*p,f=o*r*p,g=6*r*Math.cos(u)*p/(o+4),_={},y={},v={},b={},E={},A={},w={},S={},C={},I={};return _.x=(e.startScenePos().x-a.x)/s,_.y=(e.startScenePos().y-a.y)/s,v.x=a.x+p*_.x,v.y=a.y+p*_.y,b.x=v.x-f*_.x,b.y=v.y-f*_.y,E.x=b.x-m*_.x,E.y=b.y-m*_.y,_.x=(i.endScenePos().x-a.x)/n,_.y=(i.endScenePos().y-a.y)/n,w.x=a.x+p*_.x,w.y=a.y+p*_.y,S.x=w.x-f*_.x,S.y=w.y-f*_.y,C.x=S.x-m*_.x,C.y=S.y-m*_.y,y.x=(C.x-E.x)/Math.sqrt(Math.pow(C.x-E.x,2)+Math.pow(C.y-E.y,2)),y.y=(C.y-E.y)/Math.sqrt(Math.pow(C.x-E.x,2)+Math.pow(C.y-E.y,2)),A.x=E.x+g*y.x,A.y=E.y+g*y.y,I.x=C.x-g*y.x,I.y=C.y-g*y.y,{b0:v,b1:b,b2:E,b3:A,e0:w,e1:S,e2:C,e3:I}},createRoundCorner:function(t,e,i){let a=this.calculateBezierPoint(t,e,i);if(null==a)return null;let s=a.b0,n=a.b1,o=a.b2,r=a.b3,l=a.e0,c=a.e1,d=a.e2,h=a.e3;this.addBezierItem(s,r,n,o),this.addBezierItem(h,l,d,c),e.setEndPos(s),e.updateShape(),this.repairEdgeEndNode(e),i.setStartPos(l),i.updateShape(),this.repairEdgeStartNode(i)},addNodeItem:function(t){let e=this.mapModel.createModel(c.e.MODEL_TYPE_NODE),i=this.createNode(e);return i.setScenePos(t),i.updateShape(),i.sendToBack(),i},addFeatureItem:function(t){let e=this.mapModel.createModel(c.e.MODEL_TYPE_FEATURE);e.setData(t);let i=this.createFeatureItem(e);return i.updateShape(),i.sendToBack(),i},addTagItem:async function(){if(this.itemsAt(this.robotLastScenePos,c.e.MODEL_TYPE_TAG).length>0)try{await this.$refs.questionDlg.doAsk({title:this.$t("button.drawTag"),question:this.$t("text.tagExistAtCurrentPos")})}catch(t){return}let t=this.mapModel.createModel(c.e.MODEL_TYPE_TAG),e=this.createTag(t);return e.setScenePos(this.robotLastScenePos),e.setSceneYaw(this.robotLastScenePos.yaw),e.updateShape(),this.recordHistory("addTagItem"),e},addStationAndFeatureBindItem:function(t,e){let i=this.mapModel.createModel(c.e.MODEL_TYPE_STATION_AND_FEATURE_BIND),a=this.createStationAndFeatureBind(i);return a.setStartScenePoint(t),a.setEndScenePoint(e),a.updateShape(),a},async addDMcodeItem(t,e=!1){let i=t.pgvId;null!==this.pgvItem(i)&&this.deletePGV(i,e);let a=Object(c.b)(-this.robotLastScenePos.yaw),s=this.mapModel.mapFromCanvas(this.robotLastScenePos);s.yaw=a,t.yaw=Object(c.b)(t.angle);let n=this.mapModel.createModel(c.e.MODEL_TYPE_BARCODE),o=this.createBarcode(n);return o.setPose(t,s),o.setId(i),o.updateShape(),this.addPGVItemToList(o),o},updateBarcodeItem(t){let e=this.pgvItem(t.pgvId),i=Object(c.b)(-this.robotLastScenePos.yaw),a=this.mapModel.mapFromCanvas(this.robotLastScenePos);a.yaw=i,t.yaw=Object(c.b)(t.angle),e.setPose(t,a)},addLineItem:function(t,e,i,a,s){let n=this.mapModel.createModel(c.e.MODEL_TYPE_EDGE);if(null==n)return;n._type=c.e.EDGE_TYPE_LINE;let o=this.createEdge(n);return o.setStartNodeId(t),o.setEndNodeId(e),o.setRobotDirection(s),o.updateEdge(i,a),o.updateDat(),o},addBezierItem:function(t,e,i,a){let s=this.mapModel.createModel(c.e.MODEL_TYPE_EDGE);if(null==s)return;s._type=c.e.EDGE_TYPE_BEZIER;let n=this.createEdge(s),o=this.mapModel.mapFromCanvas(t),r=this.mapModel.mapFromCanvas(e),l=this.mapModel.mapFromCanvas(i),d=this.mapModel.mapFromCanvas(a);return n.setStartPos(t),n.setEndPos(e),n.setCenterPos(i),n.setDPos(a),n.setMapStartUnitVector(Object(c.r)(Object(c.s)(o,l),Object(c.n)(o,l))),n.setMapEndUnitVector(Object(c.r)(Object(c.s)(d,r),Object(c.n)(d,r))),n.updateShape(),n.updateDat(),this.repaireEdgeNode(n),o=null,r=null,l=null,d=null,n},drawEdgeCheck:function(t){if(this.action===c.e.ACTION_SET_LINE)return!0;let e=this.itemsAt(t,c.e.MODEL_TYPE_NODE);if(e.length<=0&&this.action!==c.e.ACTION_SET_BEZIER)return!1;if(e.length>0){let t=e[0].getID();if(this.findEdgeByNode(t).length<=0&&this.action!==c.e.ACTION_SET_BEZIER)return!1}return!0},finishDrawing:function(t=!0){t&&this.clearSelectingItems(),this.resetDrawingItem(),this.action===c.e.ACTION_SET_EDGE_POLE?this.finishAdjustEdge(null):this.action===c.e.ACTION_SET_STATION_AND_FEATURE_BINDING&&(this.deleteStationAndFeatureBindItem(this.curStationAndFeatureBindItem.getID()),this.curStationAndFeatureBindItem=null),this.mousePressedCnt=0,this.setAction(c.e.ACTION_NONE)},onCalculateDistance(){this.finishDrawing(),this.setAction(c.e.ACTION_CALCULATE_DISTANCE)},setMoveStation(t){this.$emit("selectStation",t)},async setOpenContextMenu(t){if(!t||this.action===c.e.ACTION_CALCULATE_DISTANCE)return;let e=[];if(this.isDrawingItem)e.push({id:ae,name:this.$t("button.cancel"),isActive:!1});else if(this.selectingItems.length>0)e.push({id:se,name:this.$t("button.delete"),isActive:!1});else if(!this.mapEditable&&this.moveToStationOpts.length>0)for(let t of Array.from(this.moveToStationOpts))e.push({id:ne,name:this.$t("label.moveTo")+" "+t.name,isActive:!1,stationID:t.id});else this.mapEditable||e.push({id:oe,name:this.$t("button.moveToPose"),isActive:!1});this.mapEditable&&this.hasSelectedEdge&&e.push({id:re,name:this.$t("button.addToGroup"),isActive:!1}),this.mapEditable&&this.action===c.e.ACTION_NONE&&1===this.selectingItems.length&&(this.hasSelectedFunctionArea||this.hasSelectedNoteArea)&&e.push({id:ce,name:this.$t("button.copy"),isActive:!1}),this.mapEditable&&this.hasSelectedStation&&(e.push({id:ue,name:this.$t("button.rotateSitesInBatches"),isActive:!1}),1===this.selectingItems.length&&e.push({id:he,name:this.$t("button.bulkCopySite"),isActive:!1})),this.mapEditable&&this.action===c.e.ACTION_NONE&&1===this.clipboardItems.length&&this.clipboardItems[0].getDat().isFuncAreaModel()&&e.push({id:de,name:this.$t("button.paste"),isActive:!1}),e.push({id:le,name:this.$t("button.calculateDistance"),isActive:!1});let i=null;try{i=await this.$refs.ctxMenu.openContextMenu(e)}catch(t){}this.setContextMenuState(!1),null!=i&&this.performContextMenu(i)},performContextMenu(t){switch(t.id){case ae:this.finishDrawing();break;case se:this.deleteAllSelectedItems();break;case ne:this.setMoveStation(t.stationID);break;case oe:this.setMoveToPose();break;case re:this.addEdgesToGroup();break;case le:this.onCalculateDistance();break;case ce:this.copyAreaItem();break;case de:this.pasteAreaItem();break;case he:this.onBatchCopyStation();break;case ue:this.onStationRotateEditor()}},setContextMenuState(t){t?Object(c.w)("pointer"):Object(c.w)("default"),this.isMobile?(this.isContextMenuOpen=t,this.isContextMenuOpen||this.$nextTick(()=>{this.isContextMenuOpen=!0})):this.isContextMenuOpen=t},setMoveToPose(){let t=this.mapModel.mapFromCanvas(this.contextMenuClickedPos);this.$emit("setMovePose",{x:t.x,y:t.y,yaw:0})},addEdgesToGroup(){this.edgeGroupsList.length>1&&this.$refs.selectEdgeGroup.setSeletedItem(this.edgeGroupsList[1].value),this.$refs.selectEdgeGroup.opened=!0},resetDrawingItem:function(){if(null!==this.curNodeItem&&(this.deleteNode(this.curNodeItem.getID()),this.curNodeItem=null),null!==this.curStationItem&&(this.deleteStation(this.curStationItem.getID()),this.curStationItem=null),null!==this.curEdgeItem&&(this.deleteEdge(this.curEdgeItem.getID()),this.curEdgeItem=null),null!==this.distanceItem&&(this.distanceItem.delete(),this.distanceItem=null),null!==this.curAreaItem){let t=this.curAreaItem.getID();switch(this.action){case c.e.ACTION_SET_AREA:this.deleteArea(t);break;case c.e.ACTION_SET_REDRAW_AREA:this.deleteRedrawArea(t);break;case c.e.ACTION_SET_CLEAN_AREA:this.deleteCleanArea(t);break;case c.e.ACTION_SET_NOTE_AREA:this.deleteNoteArea(t);break;case c.e.ACTION_SET_LOCATION_AREA:this.deleteLocationArea(t)}}},adjustEdge:function(t){let e=this.edgeItem(this.editEdgeId);if(null!=e){if(e.edgePole()===c.e.EDGE_POLE_START||e.edgePole()===c.e.EDGE_POLE_END){let i=this.itemScenePosAt(t);if(null!==i)return void e.adjustPole(i.scenePos())}e.adjustPole(t)}},finishAdjustEdge:function(t){let e=this.edgeItem(this.editEdgeId);if(null==e)return this.editEdgeId=0,void this.setAction(c.e.ACTION_NONE);if(e.edgePole()===c.e.EDGE_POLE_END||e.edgePole()===c.e.EDGE_POLE_START){let i=null;t=e.edgePole()===c.e.EDGE_POLE_START?e.startScenePos():e.endScenePos(),e.edgeType()===c.e.EDGE_TYPE_BEZIER?this.selectEdge(t,e).then(e=>{let a=null;null!=e&&(a=this.edgeItem(e.value)),null!==a&&(i=a.mapUnitVector(0),a.isStartScenePos(t)||(i=a.mapUnitVector(a.curveLength()))),this.dofinishAjustEdgePole(t,i)}).catch(t=>{}):this.dofinishAjustEdgePole(t,i)}else e.finishEditPole(null),this.recordHistory("finishAdjustEdge bezier pole c/d, editEdgeId: "+this.editEdgeId),this.editEdgeId=0,this.setAction(c.e.ACTION_NONE)},dofinishAjustEdgePole:function(t,e){let i=this.edgeItem(this.editEdgeId);if(null==i)return;let a=this.itemsAt(t,c.e.MODEL_TYPE_NODE);if(a.length>0)i.setNodeId(a[0].getID());else{let e=this.itemsAt(t,c.e.MODEL_TYPE_STATION);e.length>0?i.setNodeId(this.addNodeItem(e[0].scenePos()).getID()):i.setNodeId(this.addNodeItem(i.editPoleScenePos()).getID())}i.finishEditPole(e),this.setEdgeForStation(i),this.activeItemLayer(i),i.bringToFront(),this.recordHistory("dofinishAjustEdgePole pole s/e editEdgeId: "+this.editEdgeId),this.editEdgeId=0,this.setAction(c.e.ACTION_NONE)},setStationPoint:function(t){let e=this.stationItem(this.editStationId);null!=e&&e.setPointPos(t)},finishEditStationPoint:function(t){let e=this.stationItem(this.editStationId);null!=e&&(e.finishSetPoints(t),this.editStationId=0,this.setAction(c.e.ACTION_NONE))},setEdgeUnitVector:function(t,e,i,a){if(null==a)return!1;if(null==i)return e!==c.e.EDGE_POLE_START||this.action===c.e.ACTION_SET_LINE||this.action===c.e.ACTION_SET_BEZIER;let s=this.itemsAt(t,c.e.MODEL_TYPE_NODE);if(s.length>0){let t=null,n=s[0].getID();switch(t=i.isStartNode(n)?i.mapUnitVector(0):i.mapUnitVector(i.curveLength()),e){case c.e.EDGE_POLE_START:a.setMapStartUnitVector(t);break;case c.e.EDGE_POLE_END:a.setMapEndUnitVector(t)}}return!0},selectEdge:function(t,e=null,i=null){let a=this.edgeLst(t,e,i),s=this.selectEdgeOptions(a);return this.selectItem(this.$t("label.select"),s)},selectItemAt:function(t){let e=this.itemsAt(t),i=this.selectItemOptions(e);return this.selectItem(this.$t("label.select"),i)},selectItem:async function(t,e){if(e.length<=0)return null;if(1===e.length)return e[0];let i=await this.showSelectBox(t,e),a=null;for(let t of Array.from(e))if(t.value===i){a=t;break}return a},edgeLst:function(t,e=null,i=null){let a=[],s=this.itemsAt(t,c.e.MODEL_TYPE_NODE);if(s.length<=0||s.length>0&&s[0]===i)a=this.itemsAt(t,c.e.MODEL_TYPE_EDGE,e);else{let t=s[0].getID();a=this.findEdgeByNode(t,e)}return a},itemScenePosAt(t,e=null){let i=this.itemsAt(t,c.e.MODEL_TYPE_NODE,e,!0);if(i.length>0)return i[0];let a=this.itemsAt(t,c.e.MODEL_TYPE_STATION,e,!0);return a.length>0?a[0]:null},resizeMap:function(){this.updateMap()},updateMap:function(t=!0){this.getViews().forEach(e=>{e.autoUpdate&&t||e.update()})},updateMapDisplayStyle(){if(clearTimeout(this.zoomUpdateTimerId),this.zoomUpdateTimerId=0,!(this.mapScale>=c.e.MAP_SCALE_12)){for(let t of Array.from(this.allEditableItems()))null!=t&&t.doZoom();for(let t of Array.from(this.allUneditableItems()))null!=t&&t.doZoom()}},setTargetFinished:function(t){this.setAction(c.e.ACTION_NONE),this.targetItem.endDraw(t);var e=this.targetItem.scenePos(),i=this.targetItem.getYaw(),a=this.mapModel.mapFromCanvas({x:e.x,y:e.y});this.$root.$emit("set_target",{x:a.x,y:a.y,yaw:-i})},deleteEdgeUnselectedNodes:function(){let t=[];this.nodeItemList.forEach(e=>{if(!this.isNodeOnAnyEdge(e.getID()))return;if(e.isSelected())return;let i=this.edgesCrossNode(e.getID());if(!(i.length<=0)){for(let t=0;t<i.length;t++)if(!i[t].isSelected())return;t.push(e.getID())}}),t.forEach(t=>{this.deleteOnlyNode(t)})},startMoveSelectedItems:function(){if(this.isMapEditable()&&(this.stationsOnMovingNode=[],this.hasItemsSelected()&&this.action===c.e.ACTION_NONE)){this.setAction(c.e.ACTION_MOVE_ITEMS);let t=this.allSelectedItems();1===t.length&&t[0].itemType()===c.e.MODEL_TYPE_NODE&&(this.stationsOnMovingNode=this.stationsExactAt(t[0].scenePos())),t.forEach(t=>{this.activeItemLayer(t),t.startMove()})}},movingSelectedItems:function(t){if(!this.isMapEditable())return;let e=this.allSelectedItems();e.forEach(i=>{if(this.doMoveItem(i,t),!(e.length>1))switch(i.itemType()){case c.e.MODEL_TYPE_EDGE:this.onMovingEdge(i);break;case c.e.MODEL_TYPE_NODE:case c.e.MODEL_TYPE_STATION:i.setScenePos(i.moveNewScenePos()),this.setNodeStationCapture(i),i.itemType()===c.e.MODEL_TYPE_NODE&&(this.updateEdgeByNode(i),this.updateStationPosAfterNodeChanged(i))}})},doMoveItem(t,e){this.activeItemLayer(t),t.moveBy(e)},endMoveSelectedItems:function({isRecord:t=!0,fromFun:e=""}={}){if(!this.isMapEditable())return;let i=this.allSelectedItems();for(let t=0;t<i.length;t++){let e=i[t];switch(this.activeItemLayer(e),e.itemType()){case c.e.MODEL_TYPE_EDGE:this.repaireEdgeNode(e);break;case c.e.MODEL_TYPE_NODE:1===i.length&&this.endMoveNode(e),this.updateEdgeByNode(e),this.updateStationPosAfterNodeChanged(e);break;case c.e.MODEL_TYPE_STATION:1===i.length&&this.endMoveStation(e)}}if(1===i.length){let t=i[0].itemType();t!==c.e.MODEL_TYPE_EDGE&&t!==c.e.MODEL_TYPE_NODE&&t!==c.e.MODEL_TYPE_STATION||this.updateAllStationBelongedEdge()}i.forEach(t=>{t.endMove()}),t&&this.recordHistory(e),this.setAction(c.e.ACTION_NONE),this.stationsOnMovingNode=[]},moveSelectedItems(t){this.startMoveSelectedItems(),this.movingSelectedItems(t),this.endMoveSelectedItems({isRecord:!0,fromFun:"moveSelectedItems"})},endDrawSelectionArea:function(t){let e=this.intersectItems(this.selectionItem);this.isCtrlDown()||this.clearSelectingItems(),e.length>0&&(this.selectingItems=this.selectingItems.concat(e),this.updateSelectingItemsState()),this.selectionItem.endDraw(t),this.setAction(c.e.ACTION_NONE)},async getSelectedItem(t){let e=this.allSelectedItems(),i=this.itemsAt(t);if(1===e.length)for(let t=0;t<i.length;t++)if(e[0]===i[t])return e[0];let a=this.itemsAt(t,c.e.MODEL_TYPE_NONE);if(a.length<=0)return null;if(1===a.length)return a[0];try{let e=await this.selectItemAt(t);return null==e?null:this.findMapItem(e.type,e.id)}catch(t){}return null},deleteAllSelectedItems(){if(!this.isMapEditable())return;let t=this.allSelectedItems();for(let e=0;e<t.length;e++){let i=t[e],a=i.getID();switch(i.itemType()){case c.e.MODEL_TYPE_STATION:this.deleteStation(a);break;case c.e.MODEL_TYPE_NODE:this.deleteNode(a);break;case c.e.MODEL_TYPE_TAG:this.deleteTag(a);break;case c.e.MODEL_TYPE_BARCODE:this.deletePGV(a);break;case c.e.MODEL_TYPE_EDGE:this.deleteEdge(a);break;case c.e.MODEL_TYPE_FUNC_AREA:this.deleteArea(a);break;case c.e.MODEL_TYPE_REDRAW_AREA:this.deleteRedrawArea(a);break;case c.e.MODEL_TYPE_CLEAN_AREA:break;case c.e.MODEL_TYPE_NOTE_AREA:this.deleteNoteArea(a);break;case c.e.MODEL_TYPE_LOCATION_AREA:this.deleteLocationArea(a);break;case c.e.MODEL_TYPE_STATION_AND_FEATURE_BIND:this.deleteStationAndFeatureBindItem(a)}}this.recordHistory("deleteAllSelectedItems")},findEdgeByNode:function(t,e){let i=[];for(let a=0;a<this.edgeItemList.length;a++){let s=this.edgeItemList[a];s!==e&&(s.startNodeId()!==t&&s.endNodeId()!==t||i.push(s))}return i},endMoveStation:function(t){if(t.itemType()!==c.e.MODEL_TYPE_STATION)return;let e=t.scenePos(),i=this.intersectItems(t,c.e.MODEL_TYPE_STATION,t),a=this.itemsAt(t.scenePos(),c.e.MODEL_TYPE_NODE),s=this.intersectItems(t,c.e.MODEL_TYPE_EDGE);if(a.length>0){return this.itemsAt(a[0].scenePos()).length>0?void this.selectEdge(a[0].scenePos(),null,null).then(e=>{this.setStationToEdge(t,this.edgeItem(e.value))}).catch(t=>{}):(t.setScenePos(a[0].scenePos()),t.updatePointsPos(Object(c.s)(e,t.scenePos())),t.setEdgeId(0),void t.updateShape())}if(i.length>0)return t.setScenePos(i[0].scenePos()),t.updatePointsPos(Object(c.s)(e,t.scenePos())),t.setEdgeId(0),void t.updateShape();s.length>0&&this.selectEdge(t.scenePos(),null,null).then(e=>{if(null==e)return;let i=this.edgeItem(e.value);null!=i&&this.setStationToEdge(t,i)}).catch(t=>{}),t.setEdgeId(0),t.updateShape()},endMoveNode:function(t){if(t.itemType()!==c.e.MODEL_TYPE_NODE)return;let e=this.intersectItems(t,c.e.MODEL_TYPE_STATION,t),i=this.intersectItems(t,c.e.MODEL_TYPE_NODE,t),a=this.intersectItems(t,c.e.MODEL_TYPE_EDGE);return i.length>0?(this.updateEdgeNodeId(t.getID(),i[0].getID()),void this.deleteNode(t.getID())):e.length>0?(t.setScenePos(e[0].scenePos()),void t.updateShape()):void(a.length>0&&!this.isNodeOnAnyEdge(t.getID())&&this.selectEdge(t.scenePos(),null,t).then(e=>{if(null==e)return;let i=this.edgeItem(e.value);if(null!=i){if(i.edgeType()===c.e.EDGE_TYPE_BEZIER)return void this.$notify({message:this.$t("text.unsupportDropNodeOnBezier"),timeout:3e3,type:"negative",position:"top"});t.setScenePos(i.nearestPosOnEdge(t.scenePos())),this.splitEdge(t.getID(),i),t.updateShape()}}).catch(t=>{}))},setStationToEdge:function(t,e){if(null==t||null==e)return;let i=t.scenePos();t.setScenePos(e.nearestPosOnEdge(t.scenePos())),t.updatePointsPos(Object(c.s)(i,t.scenePos())),t.setEdgeId(e.getID()),t.setNoRotate(!1),t.setYaw(e.startFacing()),t.updateShape()},onMovingEdge:function(t){this.setEdgePoleCapture(t,c.e.EDGE_POLE_START),this.setEdgePoleCapture(t,c.e.EDGE_POLE_END)},setEdgePoleCapture:function(t,e){let i=null;e===c.e.EDGE_POLE_START?i=t.moveNewStartScenePos():e===c.e.EDGE_POLE_END&&(i=t.moveNewEndScenePos());let a=this.itemScenePosAt(i);null!=a?(e===c.e.EDGE_POLE_START?t.setStartPos(a.scenePos()):e===c.e.EDGE_POLE_END&&t.setEndPos(a.scenePos()),a.itemType()===c.e.MODEL_TYPE_STATION&&a.edgeId()<=0&&(a.setEdgeId(t.getID()),a.setYaw(t.startFacing()))):e===c.e.EDGE_POLE_START?t.setStartPos(i):e===c.e.EDGE_POLE_END&&t.setEndPos(i)},setNodeStationCapture:function(t){if(t.itemType()!==c.e.MODEL_TYPE_NODE&&t.itemType()!==c.e.MODEL_TYPE_STATION)return;if(t.itemType()===c.e.MODEL_TYPE_NODE&&this.isNodeOnAnyEdge(t.getID())&&this.allSelectedItems()>1)return;let e=this.intersectItems(t,c.e.MODEL_TYPE_STATION,t),i=this.intersectItems(t,c.e.MODEL_TYPE_NODE,t);if(e.length>0||i.length>0){let a=null;return i.length>0?a=i[0].scenePos():e.length>0&&(a=e[0].scenePos()),t.setScenePos(a),void t.updateShape()}if(t.itemType()===c.e.MODEL_TYPE_NODE&&this.isNodeOnAnyEdge(t.getID()))return;let a=this.intersectItems(t,c.e.MODEL_TYPE_EDGE);a=this.getEdgeByType(c.e.EDGE_TYPE_LINE,a),a.length>0&&(t.setScenePos(a[0].nearestPosOnEdge(t.scenePos())),t.updateShape())},intersectItems:function(t,e,i=null){let a=[],s=this.mapItems(e);for(let e=0;e<s.length;e++){let n=s[e];n!==i&&(n.isItemMoving()||n.intersects(t)&&a.push(n))}return a},getItemsNearby(t,e,i=null){let a=[],s=this.mapItems(e);for(let e=0;e<s.length;e++){let n=s[e];if(n instanceof z||n instanceof nt||n instanceof W){if(n===i)continue;if(n.isItemMoving())continue;n.isAroundPos(t)&&a.push(n)}}return a},mapItems:function(t=c.e.MODEL_TYPE_NONE){let e=[];switch(t){case c.e.MODEL_TYPE_NODE:e=this.nodeItemList;break;case c.e.MODEL_TYPE_TAG:e=this.tagItemList;break;case c.e.MODEL_TYPE_BARCODE:e=this.barcodeItemList;break;case c.e.MODEL_TYPE_STATION:e=this.stationItemList;break;case c.e.MODEL_TYPE_EDGE:e=this.edgeItemList;break;case c.e.MODEL_TYPE_FUNC_AREA:e=this.areaItemList;break;case c.e.MODEL_TYPE_REDRAW_AREA:e=this.redrawAreaItemList;break;case c.e.MODEL_TYPE_NOTE_AREA:e=this.noteAreaItemList;break;case c.e.MODEL_TYPE_LOCATION_AREA:e=this.locationAreaItemList;break;case c.e.MODEL_TYPE_FEATURE:e=this.runtimeFeatureItems;break;case c.e.MODEL_TYPE_STATION_AND_FEATURE_BIND:e=this.stationAndFeatureBindItemList;break;default:e=e.concat(this.allEditableItems())}return e},itemsAt:function(t,e,i=null,a=!1){let s=[],n=this.mapItems(e);for(let e=0;e<n.length;e++){let o=n[e];if(o!==i&&o.isVisible()&&(!o.isItemMoving()&&o.isPointOn(t)&&(s.push(o),a)))break}return s},stationsExactAt(t){let e=[];for(let i of Array.from(this.stationItemList))i.isExactAt(t)&&e.push(i);return e},nodesExactAt(t,e=null){let i=[],a=this.mapItems(c.e.MODEL_TYPE_NODE);for(let s=0;s<a.length;s++){let n=a[s];n!==e&&(n.isExactAt(t)&&i.push(n))}return i},nodesAt:function(t,e=null){let i=[],a=this.mapItems(c.e.MODEL_TYPE_NODE);for(let s=0;s<a.length;s++){let n=a[s];n!==e&&(n.isPointOn(t)&&i.push(n))}return i},selectedItems:function(t){let e=[];for(let i=0;i<t.length;i++){let a=t[i];a instanceof j&&a.isVisible()&&a.isSelected()&&e.push(a)}return e},hasItemsSelected:function(){return this.allSelectedItems().length>0},allSelectedItems:function(){let t=[];return t=t.concat(this.selectedItems(this.nodeItemList)),t=t.concat(this.selectedItems(this.tagItemList)),t=t.concat(this.selectedItems(this.barcodeItemList)),t=t.concat(this.selectedItems(this.stationItemList)),t=t.concat(this.selectedItems(this.edgeItemList)),t=t.concat(this.selectedItems(this.areaItemList)),t=t.concat(this.selectedItems(this.redrawAreaItemList.filter(t=>t._dat.isNewborn))),t=t.concat(this.selectedItems(this.noteAreaItemList)),t=t.concat(this.selectedItems(this.stationAndFeatureBindItemList)),t},allEditableItems:function(){let t=[];return t=t.concat(this.nodeItemList),t=t.concat(this.tagItemList),t=t.concat(this.barcodeItemList),t=t.concat(this.stationItemList),t=t.concat(this.edgeItemList),t=t.concat(this.areaItemList),t=t.concat(this.redrawAreaItemList.filter(t=>t._dat.isNewborn)),t=t.concat(this.noteAreaItemList),t=t.concat(this.stationAndFeatureBindItemList),t},allUneditableItems(){let t=[];return t.push(this.axisItem),t.push(this.navPathItem),t.push(this.gridItem),t.push(this.robotLocusItem),t=t.concat(this.distanceItemList),t=t.concat(this.lmkItemList),t},allIds:function(t){let e=[];return null==t||t.forEach(t=>{e.push(t.getID())}),e},deleteEdgeOfNode:function(t){let e=[];this.edgeItemList.forEach(i=>{i.startNodeId()!==t&&i.endNodeId()!==t||e.push(i.getID())}),e.forEach(t=>{this.deleteEdge(t)})},deleteEdge:function(t){this.deleteMapItem(t,this.edgeItemList),this.deleteEdgeFromList(t),this.updateAllStationBelongedEdge(),this.deleteEdgeFromAllGroups(t)},deleteNode:function(t){this.deleteEdgeOfNode(t),this.deleteOnlyNode(t)},deleteOnlyNode:function(t){this.deleteMapItem(t,this.nodeItemList),this.deleteNodeFromList(t)},deleteTag:function(t){this.deleteMapItem(t,this.tagItemList),this.deleteTagFromList(t)},deletePGV:function(t,e=!1){this.deleteMapItem(t,this.barcodeItemList),this.deletePGVFromList(t),e||this.resetStationPGV(t)},deleteStation:function(t){this.deleteMapItem(t,this.stationItemList),this.deleteStationItemFromList(t);for(let e of this.stationAndFeatureBindItemList)e.getStationId()===t&&this.deleteStationAndFeatureBindItem(e.getID())},deleteArea:function(t){this.deleteMapItem(t,this.areaItemList),this.deleteAreaFromList(t)},deleteRedrawArea:function(t){this.deleteMapItem(t,this.redrawAreaItemList)},deleteCleanArea:function(t){this.deleteMapItem(t,this.cleanAreaItemList)},deleteNoteArea:function(t){this.deleteMapItem(t,this.noteAreaItemList),this.deleteNoteAreaFromList(t)},deleteLocationArea:function(t){this.deleteMapItem(t,this.locationAreaItemList),this.deleteLocationAreaFromList(t)},deleteFeatureItem:function(t){this.deleteMapItem(t,this.featureItems)},deleteStationAndFeatureBindItem:function(t){for(let e=0;e<this.stationAndFeatureBindItemList.length;e++)if(this.stationAndFeatureBindItemList[e].getID()===t){let t=this.stationAndFeatureBindItemList.splice(e,1);this.deleteFeatureItem(t[0].getFeatureId()),t[0].delete();break}},deleteMainItems:function(){this.deleteAllNodes(),this.deleteAllTags(),this.deleteAllPGVs(),this.deleteAllStations(),this.deleteAllEdges(),this.deleteAllFuncArea(),this.deleteAllStationAndFeatureBind(),this.deleteAllRedrawAreas(),this.deleteAllCleanArea(),this.deleteAllNoteAreas(),this.deleteAllLocationAreas(),this.deleteAllLMK(),this.deleteRuntimeLMK(),this.deleteRuntimeFeatureItems(),this.deleteAllEdgeGroups(),this.deleteAllWareroomAreaAndWareroomRegion()},deleteAllStations:function(){let t=this.allIds(this.stationItemList);t.forEach(t=>{this.deleteStation(t)}),t=null},deleteAllStationAndFeatureBind:function(){let t=this.allIds(this.stationAndFeatureBindItemList);t.forEach(t=>{this.deleteStationAndFeatureBindItem(t)}),t=null},deleteAllNodes:function(){let t=this.allIds(this.nodeItemList);t.forEach(t=>{this.deleteNode(t)}),t=null},deleteAllTags:function(){let t=this.allIds(this.tagItemList);t.forEach(t=>{this.deleteTag(t)}),t=null},deleteAllPGVs:function(){let t=this.allIds(this.barcodeItemList);t.forEach(t=>{this.deletePGV(t)}),t=null},deleteAllEdges:function(){let t=this.allIds(this.edgeItemList);t.forEach(t=>{this.deleteEdge(t)}),t=null},deleteAllFuncArea:function(){let t=this.allIds(this.areaItemList);t.forEach(t=>{this.deleteArea(t)}),t=null},deleteAllEdgeGroups:function(){if(null==this.mapModel)return;this.allIds(this.mapModel._edgeGroupDataList).forEach(t=>{this.deleteEdgeGroup(t,!1)}),this.updateEdgeGroupList()},deleteAllRedrawAreas:function(){this.allIds(this.redrawAreaItemList).forEach(t=>{this.deleteRedrawArea(t)})},deleteAllCleanArea:function(){this.allIds(this.cleanAreaItemList).forEach(t=>{this.deleteCleanArea(t)})},deleteAllNoteAreas:function(){var t;null===(t=this.allIds(this.noteAreaItemList))||void 0===t||t.forEach(t=>{this.deleteNoteArea(t)})},deleteAllLocationAreas:function(){var t;null===(t=this.allIds(this.locationAreaItemList))||void 0===t||t.forEach(t=>{this.deleteLocationArea(t)})},deleteAllLMK:function(){for(let t of Array.from(this.lmkItemList))t.delete(),t=null;this.lmkItemList=[]},deleteRuntimeLMK:function(){for(let t of Array.from(this.runtimeLmkList))t.delete(),t=null;this.runtimeLmkList=[]},deleteRuntimeFeatureItems:function(){for(let t of Array.from(this.runtimeFeatureItems))t.delete(),t=null;this.runtimeFeatureItems=[]},deleteMapItem:function(t,e){let i=-1;for(let a=0;a<e.length;a++)if(e[a].getID()===t){i=a;break}i<0||e.splice(i,1)[0].delete()},resetStationPGV(t){for(let e of Array.from(this.stationItemList))e.getDMCodeID()===t&&e.setDMCodeOffset("",0,0,0)},onZoomIn:function(){this.zoomFactor>c.e.MAX_ZOOM_IN||this.zoomMap(1.1)},onZoomout:function(){this.zoomFactor<this.zoomFactorMin||this.zoomMap(.9)},zoomMap:function(t){this.isDrawingHeatmap()||(this.zoomFactor=this.zoomFactor*t,this.mapScale=1/this.zoomFactor,this.getViews().forEach(e=>{e.scale(t)}),this.zoomUpdateTimerId<=0&&(this.zoomUpdateTimerId=setTimeout(this.updateMapDisplayStyle,400)),this.updateMap(),this.heatmapWrapper.value.scale(t),this.updateVisibleViewItems())},zoomTo(t){let e=1*t/this.zoomFactor;this.zoomMap(e)},centerRobot:function(){this.zoomMap(1/this.zoomFactor),this.doCenterRobot()},doCenterRobot(t=!1){let e=this.robotItem.scenePos();if(t&&Object(c.n)(this.robotLastScenePos,e)<3)return;let i=this.projectToView(e);if(this.centerOn(e),this.isDrawingHeatmap()){let t=this.projectToView(this.robotItem.scenePos()),e=Object(c.s)(t,i);this.heatmapWrapper.value.move(-e.x,-e.y)}},centerOn:function(t){this.getViews().forEach(e=>{e.center=t}),this.updateVisibleViewItems(),this.updateMap()},centerOnItem(t){this.deselectAllItems(),this.centerOn(t.scenePos()),this.activeItemLayer(t),t.setSelectedState(!0)},centerOnEdgeGroup(t){this.deselectAllItems(),this.setEdgeGroupSelected(t);let e=this.mapModel.edgeGroupModel(t);if(null==e)return;let i=this.edgeItem(e.edgeId(0));null!=i&&this.centerOn(i.scenePos())},setCenterElement(t={id:0,type:0}){const{id:e,type:i}=t,a=this.findMapItem(i,e);a&&this.centerOnItem(a)},setRobotState(t){this.robotItem.setVisible(t)},setRobotLocusState(t){this.robotLocusItem.setVisible(t)},setLaserPointsState:function(t){t!==this.isDrawLaserPoints&&(this.isDrawLaserPoints=t,this.$emit("laserPointStateChange",t))},setHeatmapState(t){t?this.centerRobot():this.heatmapWrapper.value.clear(),this.isDrawHeatmap=t},setAvoidRectangleState(t){t||this.avoidRectangleItem.clear(),this.isDrawAvoidRectangle=t,this.$emit("avoidRectangle",t)},isDrawingHeatmap(){return this.isDrawHeatmap},setNavPathState:function(t){this.navPathItem.setVisible(t)},setDistanceItemListState(t){this.distanceItemList.forEach(e=>e.setVisible(t))},setLayerVisibleState:function(t){this.setLayerVisible(t.layer,t.state)},clearRobotLocus:function(){this.robotLocusItem.removeChildren(),this.heatmapWrapper.value.clear()},onSwitchStateChanged:function(t){let e=t.state;switch(t.key){case c.e.KEY_LASER_POINT_STATE:e||(this.showAllLaserPoint=!1,this.otherSwitchItems.forEach(t=>{t.key===c.e.KEY_ALL_LASER_POINT_STATE&&(t.state=!1)})),this.setLaserPointsState(e);break;case c.e.KEY_ALL_LASER_POINT_STATE:e?(this.otherSwitchItems.some(t=>t.key===c.e.KEY_LASER_POINT_STATE&&!t.state)&&(this.otherSwitchItems.forEach(t=>{t.key===c.e.KEY_LASER_POINT_STATE&&(t.state=!0)}),this.setLaserPointsState(e)),this.showAllLaserPoint=!0):this.showAllLaserPoint=!1;break;case c.e.KEY_ROBOT_STATE:this.setRobotState(e);break;case c.e.KEY_NAV_PATH_STATE:this.setNavPathState(e);break;case c.e.KEY_ROBOT_LOCUS_STATE:this.setRobotLocusState(e);break;case c.e.KEY_DISTANCE_STATE:this.setDistanceItemListState(e);break;case c.e.KEY_MAP_REDRAW_STATE:e?this.redrawAreaItemList.length&&this.redrawAreaItemList.some(t=>!t._dat.isNewborn)?this.redrawAreaItemList.forEach(t=>{t._dat.isNewborn||t.setVisible(e,!0)}):(this.addAreaList(this.mapModel._redrawAreaDataList.filter(t=>!t.isNewborn)),this.redrawAreaItemList.forEach(t=>{t._dat.isNewborn||t.setInteractionState(!1)})):this.redrawAreaItemList.forEach(t=>{t._dat.isNewborn||t.setVisible(e,!1)});break;case c.e.KEY_MAP_LOCATION_AREA_STATE:e&&!this.locationAreaItemList.length?this.addAreaList(this.mapModel._locationAreaDataList.filter(t=>t.isLocationAreaNormalModel)):this.setLayerVisibleState(t);break;case c.e.KEY_BACKGROUND_IMAGE_STATE:case c.e.KEY_MAP_EDGE:case c.e.KEY_MAP_STATION:case c.e.KEY_MAP_FEATURE:case c.e.KEY_MAP_NODE:case c.e.KEY_MAP_FUNC_AREA:case c.e.KEY_MAP_BARCODE:case c.e.KEY_LMK:case c.e.KEY_MAP_NOTE_AREA_STATE:case c.e.KEY_MAP_TAG:this.setLayerVisibleState(t),t.key===c.e.KEY_LMK&&(this.isDrawLmk=e);break;case c.e.KEY_HEATMAP:this.setHeatmapState(e);break;case c.e.KEY_AVOID_RECTANGLE:this.setAvoidRectangleState(e);break;case c.e.KEY_FOLLOW_ROBOT:e?this.setRobotFollowingMode(c.i.AllwaysOnCenter):this.setRobotFollowingMode(c.i.None);break;case c.e.KEY_ITEM_NAMES:this.setMapItemNameVisible(e);break;case c.e.KEY_RECOGNITION_LIDAR:this.$emit("recognitionStateChanged",e,"LIDAR",this.runtimeFeatureGroupDisplay);break;default:t.type===d.h&&this.laserSwitchMap.set(t.key,e)}},onDoMapAction(t){switch(t){case c.e.EVENT_ZOOM_IN:this.onZoomIn();break;case c.e.EVENT_ZOOM_OUT:this.onZoomout();break;case c.e.EVENT_ROTATE_LEFT:this.onRotateLeft();break;case c.e.EVENT_ROTATE_RIGHT:this.onRotateRight();break;case c.e.EVENT_CENTER_ROBOT:this.centerRobot();break;case c.e.EVENT_CLEAR_LOCUS:this.clearRobotLocus()}},onRotateLeft:function(){if(this.isDrawingHeatmap())return;let t=-c.e.ANGLE_ROTATE_BIG_STEP;this.paperScope.value.Key.modifiers.shift&&(t=-c.e.ANGLE_ROTATE_LITTLE_STEP),this.rotateAngleOffset(t)},onRotateRight:function(){if(this.isDrawingHeatmap())return;let t=c.e.ANGLE_ROTATE_BIG_STEP;this.paperScope.value.Key.modifiers.shift&&(t=c.e.ANGLE_ROTATE_LITTLE_STEP),this.rotateAngleOffset(t)},rotateAngleOffset(t){this.rotateAngle+=t,this.rotateAngle=this.rotateAngle%360,this.getViews().forEach(e=>{e.rotate(t)}),this.updateMap()},async onEditFromMapItemList(t){if(t.type===c.e.MODEL_TYPE_EDGE_GROUP){let e=this.mapModel.edgeGroupModel(t.id);try{let t=await this.$refs.edgeGroupEditor.doEditEdgeGroup(e.toJson());this.onUpdateEdgeGroup(t)}catch(t){}}},onDeleteItemFromMapItemList:function(t){let e=t.id;switch(t.type){case c.e.MODEL_TYPE_STATION:e<0?this.deleteAllStations():this.deleteStation(e);break;case c.e.MODEL_TYPE_NODE:e<0?this.deleteAllNodes():this.deleteNode(e);break;case c.e.MODEL_TYPE_TAG:e<0?this.deleteAllTags():this.deleteTag(e);break;case c.e.MODEL_TYPE_BARCODE:e<0?this.deleteAllPGVs():this.deletePGV(e);break;case c.e.MODEL_TYPE_EDGE:e<0?this.deleteAllEdges():t.groupId>0?this.deleteEdgeFromGroup(t.groupId,e):this.deleteEdge(e);break;case c.e.MODEL_TYPE_FUNC_AREA:e<0?this.deleteAllFuncArea():this.deleteArea(e);break;case c.e.MODEL_TYPE_LOCATION_AREA:e<0?this.deleteAllLocationAreas():this.deleteLocationArea(e);break;case c.e.MODEL_TYPE_NOTE_AREA:e<0?this.deleteAllNoteAreas():this.deleteNoteArea(e);break;case c.e.MODEL_TYPE_EDGE_GROUP:e<0?this.deleteAllEdgeGroups():this.deleteEdgeGroup(e)}this.recordHistory("onDeleteItemFromMapItemList")},onTag2Node(t){null!=t&&(t<0?this.allTags2Nodes():this.tag2Node(t),this.recordHistory("onTag2Node"))},onTag2Station(t){null!=t&&(t<0?this.allTags2Stations():this.tag2Station(t),this.recordHistory("onTag2Station"))},tag2Node(t){let e=this.tagItem(t);null!=e&&(this.itemsAt(e.scenePos(),c.e.MODEL_TYPE_NODE).length>0||(this.addNodeItem(e.scenePos()),this.deleteTag(t)))},allTags2Nodes(){this.allIds(this.tagItemList).forEach(t=>{this.tag2Node(t)})},tag2Station(t){let e=this.tagItem(t);if(null==e)return;let i=this.mapModel.createModel(c.e.MODEL_TYPE_STATION),a=this.createStation(i);a.setMapPose(e.mapPose()),a.updateShape(),this.deleteTag(t)},allTags2Stations(){this.allIds(this.tagItemList).forEach(t=>{this.tag2Station(t)})},onClickItemFromMapItemList:function(t){let e=t.id,i=null;switch(t.type){case c.e.MODEL_TYPE_STATION:i=this.stationItem(e);break;case c.e.MODEL_TYPE_NODE:i=this.nodeItem(e);break;case c.e.MODEL_TYPE_TAG:i=this.tagItem(e);break;case c.e.MODEL_TYPE_EDGE:i=this.edgeItem(e);break;case c.e.MODEL_TYPE_FUNC_AREA:i=this.areaItem(e);break;case c.e.MODEL_TYPE_LOCATION_AREA:i=this.locationAreaItem(e);break;case c.e.MODEL_TYPE_NOTE_AREA:i=this.noteAreaItem(e);break;case c.e.MODEL_TYPE_BARCODE:i=this.pgvItem(e);break;case c.e.MODEL_TYPE_EDGE_GROUP:return void this.centerOnEdgeGroup(e)}null!=i&&this.centerOnItem(i)},async onDBLClickItemFromMapItemList(t){let e=t.id,i=null;switch(t.type){case c.e.MODEL_TYPE_STATION:i=this.stationItem(e);break;case c.e.MODEL_TYPE_NODE:i=this.nodeItem(e);break;case c.e.MODEL_TYPE_TAG:i=this.tagItem(e);break;case c.e.MODEL_TYPE_EDGE:i=this.edgeItem(e);break;case c.e.MODEL_TYPE_FUNC_AREA:i=this.areaItem(e);break;case c.e.MODEL_TYPE_BARCODE:i=this.pgvItem(e);break;case c.e.MODEL_TYPE_EDGE_GROUP:try{await this.onEditFromMapItemList(t)}catch(t){}return;case c.e.MODEL_TYPE_NOTE_AREA:i=this.noteAreaItem(e);break;case c.e.MODEL_TYPE_LOCATION_AREA:i=this.locationAreaItem(e)}null!=i&&this.onItemDoubleClicked(i.getDat())},translateMapView:function(t){this.getViews().forEach(e=>{e.translate(t)}),this.updateVisibleViewItems(),this.updateMap()},updateVisibleViewItems(){let t=this.getView(c.f[this.mapsGroupsIndex].viewMapItemsId).bounds,e=[];for(let i of Array.from(this.allEditableItems()))if(i.isIntersectsRect(t)||i.isItemDrawing()){let t=this.getMapLayerByItemType(i.itemType());t&&(this.activeLayer(t.name),i.addToLayer(t)),i.setVisible(!0),i.itemType()===c.e.MODEL_TYPE_EDGE&&e.push(i)}else i.setVisible(!1);for(let t of Array.from(e)){let e=this.getMapLayer(c.e.MAP_LAYER_NODE);if(!e)continue;let i=this.nodeItem(t.startNodeId()),a=this.nodeItem(t.endNodeId());i&&!i.isVisible()&&(this.activeLayer(e.name),i.addToLayer(e),i.setVisible(!0)),a&&!a.isVisible()&&(this.activeLayer(e.name),a.addToLayer(e),a.setVisible(!0))}},updateNavPath:function(t){if(null!=this.navPathItem){var e=[];for(let i=0;i<t.length;i++){let a=new O(c.e.MODEL_TYPE_EDGE);a.fromJson(t[i]),4===a._type&&(a._cx=a._sx,a._cy=a._sy,a._radius=10,a._param=t[i].rotateAngle/1e3),e.push(a)}this.activeLayer(c.e.MAP_LAYER_ACTIVE),this.navPathItem.setNavPaths(e);for(let t=0;t<e.length;t++)e[t]=null;e=null}},updateLaserPoints(t={},e=this.isDrawLaserPoints){if(!this.laserPointsItem)return;if(this.activeLayer(c.e.MAP_LAYER_LARGE_CPU),this.laserPointsItem.removeAll(),!e)return void this.updateView(c.f[this.mapsGroupsIndex].viewMapImageId);const{locLaserPoints:i=[],extLaserPoints:a=[],obaLaserPoints:s=[]}=t,n={isShowLaser:e,isShowAllLaser:this.showAllLaserPoint,isMobile:this.isMobile,sensorColorDisplayMap:this.sensorColorDisplayMap,colorType:"sensorColor",defaultColor:"#70f3ff"};this.laserPointsItem.setLaserPoints(this.robotLastScenePos,Object(d.z)(i,this.laserSwitchMap,this.otherSwitchItems,n),Object(d.z)(a,this.laserSwitchMap,this.otherSwitchItems,{...n,defaultColor:"#ffd600"}),Object(d.z)(s,this.laserSwitchMap,this.otherSwitchItems,{...n,colorType:"obaColor",defaultColor:"#d50000"})),this.updateView(c.f[this.mapsGroupsIndex].viewMapImageId)},updateAvoidPolygons(t={}){if(null==this.avoidRectangleItem||!this.isDrawAvoidRectangle)return;const{carSimulatePoses:e=[],color:i,type:a=1}=t;this.activeLayer(c.e.MAP_LAYER_ACTIVE),this.avoidRectangleItem.setRectDatList(e,i,1===a)},updateRobotPos:function(t){if(null==this.robotItem||null==t)return;let e=new this.paperScope.value.Point(t.x,t.y),i=this.mapModel.mapToCanvas(e);i.yaw=-t.yaw,this.activeLayer(c.e.MAP_LAYER_ACTIVE),this.robotItem.setPos(i);var a=new this.paperScope.value.Point(i.x,i.y);0===t.x&&0===t.y||this.robotLocusItem.addPoint(a),this.isDrawingHeatmap()&&this.addHeatMapPoint(i,t.confidence),this.setRobotFollowing(),this.robotLastScenePos=i},setRobotFollowing(){switch(this.followingMode){case c.i.AllwaysOnCenter:this.doCenterRobot(!0);break;case c.i.CenterWhenOutside:this.setAutoTranslateView()}},setAutoTranslateView(){if(null==this.robotItem)return;let t=this.getView(c.f[this.mapsGroupsIndex].viewMapItemsId).bounds;this.robotItem.isInside(t)||this.doCenterRobot()},addHeatMapPoint(t,e){let i=this.projectToView(t),a={x:Math.round(i.x),y:Math.round(i.y),value:parseInt(e)};this.heatmapWrapper.value.addData(a)},toPoint:function(t,e,i,a){let s=Math.cos(i),n=Math.sin(i),o={};return o.x=a.x*s-a.y*n+t,o.y=a.x*n+a.y*s+e,o},centerOnImageLayer:function(){try{this.activeLayer(c.e.MAP_LAYER_IMG);let t=this.findMapLayer(c.e.MAP_LAYER_IMG,!0);if(null==t)return;this.getViews().forEach(e=>{e.center=t.position}),this.updateMap()}catch(t){}},addImage:function(t){this.mapSwitchItems.find(t=>t.key===c.e.KEY_ROBOT_STATE).state=!0,this.activeLayer(c.e.MAP_LAYER_IMG);var e=this.getMapCenterPos();this.mapImgRaster=new this.paperScope.value.Raster(t,e),this.mapImgRaster.locked=!0,this.mapImgRaster.smoothing=!1,this.mapImgRaster.onLoad=async()=>{this.mapImgRaster.scale(this.mapModel._mapResolution/this.mapModel.imageScaling()),this.createMapItems(),await this.initStates();let t=this.getMapLayer(c.e.MAP_LAYER_IMG);t&&t.sendToBack(),this.$emit("loadMapFinished",c.d.LOAD_MAP_OK)},this.mapImgRaster.onError=()=>{null!=this.mapImgRaster&&(this.mapImgRaster.scale(this.mapModel._mapResolution/this.mapModel.imageScaling()),this.createMapItems(),this.initStates(),this.$emit("loadMapFinished",c.d.LOAD_MAP_IMG_ERR))}},createAllLayers(){this.createMapLayer(c.e.MAP_LAYER_IMG),this.createMapLayer(c.e.MAP_LAYER_REDRAW),this.createMapLayer(c.e.MAP_LAYER_NOTE_AREA),this.createMapLayer(c.e.MAP_LAYER_LOCATION_AREA),this.createMapLayer(c.e.MAP_LAYER_BOTTOM),this.createMapLayer(c.e.MAP_LAYER_LARGE_CPU),this.createMapLayer(c.e.MAP_LAYER_BG),this.createMapLayer(c.e.MAP_LAYER_FUNC_AREA),this.createMapLayer(c.e.MAP_LAYER_BARCODE),this.createMapLayer(c.e.MAP_LAYER_TAG),this.createMapLayer(c.e.MAP_LAYER_LMK),this.createMapLayer(c.e.MAP_LAYER_EDGE),this.createMapLayer(c.e.MAP_LAYER_STATION),this.createMapLayer(c.e.MAP_LAYER_FEATURE),this.createMapLayer(c.e.MAP_LAYER_NODE),this.createMapLayer(c.e.MAP_LAYER_ACTIVE),this.createMapLayer(c.e.MAP_LAYER_OTHER)},createMapItems:function(){this.updateMainLayer(),this.activeLayer(c.e.MAP_LAYER_OTHER),this.selectionItem=new Lt(this.getPaperScope(),this.mapModel),this.createOtherItems()},initEdgeGroups(){this.edgeGroups.length=0;for(let t of Array.from(this.mapModel._edgeGroupDataList)){let e=this.addItemToList(t,this.edgeGroups);for(let i of Array.from(t.getEdgeIds()))this.addEdgeToGroupForItemList(i,e.id)}},async initStates(){if(this.mapScale=1,this.updateEdgeGroupList(),this.initEdgeGroups(),this.centerOnImageLayer(),this.updateGrid(),this.setMapEditable(this.isMapEditable()),this.bringToFrontLayer(c.e.MAP_LAYER_ACTIVE),await this.setRobotStyle(),this.mapModel._mapSize.x>1){let t=this.getView(c.f[this.mapsGroupsIndex].viewMapImageId),e=t.viewSize.width/this.mapModel._mapSize.x,i=t.viewSize.height/this.mapModel._mapSize.y,a=Math.min(e,i);this.zoomFactorMin=a/2,this.zoomMap(a)}this.setRobotState(this.getMapSwitchItem(c.e.KEY_ROBOT_STATE).state),this.setRobotLocusState(this.getMapSwitchItem(c.e.KEY_ROBOT_LOCUS_STATE).state),this.setNavPathState(this.getMapSwitchItem(c.e.KEY_NAV_PATH_STATE).state),this.setLaserPointsState(this.getMapSwitchItem(c.e.KEY_LASER_POINT_STATE).state),this.setMapItemNameVisible(this.getMapSwitchItem(c.e.KEY_ITEM_NAMES).state)},updateEdgeGroupList(){this.edgeGroupsList=[{label:this.$t("button.create")+this.$t("label.edgeGroup")+"...",value:-1}];for(let t of Array.from(this.mapModel._edgeGroupDataList))this.edgeGroupsList.push({label:t.getName(),value:t.getID()})},createMapLayer:function(t){let e=this.getViewByLayer(t);e&&e._project.activate();let i=this.findMapLayer(t);return null==i&&(i=new this.paperScope.value.Layer,i.name=t),t!==c.e.MAP_LAYER_BG&&t!==c.e.MAP_LAYER_LOCATION_AREA&&t!==c.e.MAP_LAYER_IMG&&t!==c.e.MAP_LAYER_LARGE_CPU&&t!==c.e.MAP_LAYER_BOTTOM&&t!==c.e.MAP_LAYER_ACTIVE||(i.locked=!0),i},activeLayer:function(t){let e=this.getViewByLayer(t);if(e&&e._project.activate(),this.paperScope.value.project.activeLayer.name===t)return;let i=this.findMapLayer(t);if(null==i)return;[c.e.MAP_LAYER_BOTTOM,c.e.MAP_LAYER_BG,c.e.MAP_LAYER_LARGE_CPU,c.e.MAP_LAYER_REDRAW,c.e.MAP_LAYER_NOTE_AREA,c.e.MAP_LAYER_LOCATION_AREA,c.e.MAP_LAYER_FUNC_AREA].includes(t)||i.bringToFront(),i.activate()},activeItemLayer(t){switch(t.itemType()){case c.e.MODEL_TYPE_EDGE:this.activeLayer(c.e.MAP_LAYER_EDGE);break;case c.e.MODEL_TYPE_STATION:this.activeLayer(c.e.MAP_LAYER_STATION);break;case c.e.MAP_LAYER_FEATURE:this.activeLayer(c.e.MAP_LAYER_FEATURE);break;case c.e.MODEL_TYPE_NODE:this.activeLayer(c.e.MAP_LAYER_NODE);break;case c.e.MODEL_TYPE_FUNC_AREA:this.activeLayer(c.e.MAP_LAYER_FUNC_AREA);break;case c.e.MODEL_TYPE_BARCODE:this.activeLayer(c.e.MAP_LAYER_BARCODE);break;case c.e.MODEL_TYPE_TAG:this.activeLayer(c.e.MAP_LAYER_TAG);break;case c.e.MODEL_TYPE_REDRAW_AREA:this.activeLayer(c.e.MAP_LAYER_REDRAW);break;case c.e.MODEL_TYPE_NOTE_AREA:this.activeLayer(c.e.MAP_LAYER_NOTE_AREA);break;case c.e.MODEL_TYPE_LOCATION_AREA:this.activeLayer(c.e.MAP_LAYER_LOCATION_AREA);break;default:this.activeLayer(c.e.MAP_LAYER_OTHER)}},resetMapItemLayer(){this.resetLayer(c.e.MAP_LAYER_EDGE),this.resetLayer(c.e.MAP_LAYER_STATION),this.resetLayer(c.e.MAP_LAYER_FEATURE),this.resetLayer(c.e.MAP_LAYER_NODE),this.resetLayer(c.e.MAP_LAYER_FUNC_AREA),this.resetLayer(c.e.MAP_LAYER_BARCODE),this.resetLayer(c.e.MAP_LAYER_TAG),this.resetLayer(c.e.MAP_LAYER_LMK),this.resetLayer(c.e.MAP_LAYER_REDRAW),this.resetLayer(c.e.MAP_LAYER_NOTE_AREA),this.resetLayer(c.e.MAP_LAYER_LOCATION_AREA)},resetLayer(t){let e=this.getViewByLayer(t);e&&e._project.activate();let i=this.findMapLayer(t);return null==i?(i=new this.paperScope.value.Layer,i.name=t):i.removeChildren(),i},getView:function(t){let e=this.paperScope.value.projects;for(let i=0;i<e.length;i++)if(e[i].view._id===t)return e[i].view;return null},getViewByLayer:function(t){return t===c.e.MAP_LAYER_IMG||t===c.e.MAP_LAYER_LARGE_CPU?this.getView(c.f[this.mapsGroupsIndex].viewMapImageId):t===c.e.MAP_LAYER_ACTIVE?this.getView(c.f[this.mapsGroupsIndex].viewMapActiveId):this.getView(c.f[this.mapsGroupsIndex].viewMapItemsId)},getMapLayerByItemType(t){let e=null;switch(t){case c.e.MODEL_TYPE_EDGE:e=this.getMapLayer(c.e.MAP_LAYER_EDGE);break;case c.e.MODEL_TYPE_STATION:e=this.getMapLayer(c.e.MAP_LAYER_STATION);break;case c.e.MODEL_TYPE_FEATURE:case c.e.MODEL_TYPE_STATION_AND_FEATURE_BIND:e=this.getMapLayer(c.e.MAP_LAYER_FEATURE);break;case c.e.MODEL_TYPE_NODE:e=this.getMapLayer(c.e.MAP_LAYER_NODE);break;case c.e.MODEL_TYPE_FUNC_AREA:e=this.getMapLayer(c.e.MAP_LAYER_FUNC_AREA);break;case c.e.MODEL_TYPE_BARCODE:e=this.getMapLayer(c.e.MAP_LAYER_BARCODE);break;case c.e.MODEL_TYPE_TAG:e=this.getMapLayer(c.e.MAP_LAYER_TAG);break;case c.e.MODEL_TYPE_REDRAW_AREA:e=this.getMapLayer(c.e.MAP_LAYER_REDRAW);break;case c.e.MODEL_TYPE_NOTE_AREA:e=this.getMapLayer(c.e.MAP_LAYER_NOTE_AREA);break;case c.e.MODEL_TYPE_LOCATION_AREA:e=this.getMapLayer(c.e.MAP_LAYER_LOCATION_AREA);break;case c.e.MODEL_TYPE_LMK:e=this.getMapLayer(c.e.MAP_LAYER_LMK);case c.e.MODEL_TYPE_DISTANCE:}return e},getMapLayer:function(t){var e;let i=null===(e=this.getViewByLayer(t))||void 0===e?void 0:e._id,a=this.getProjectByView(i),s=null;return a.layers.forEach(e=>{e.name===t&&(s=e)}),s},getProjectByView:function(t){let e=this.getView(t),i=null;return this.getProjects().forEach(t=>{t.view===e&&(i=t)}),i},getPaperScope:function(){return this.paperScope.value},getViews:function(){let t=[];if(null==this.paperScope.value)return t;let e=this.paperScope.value.projects;for(let i=0;i<e.length;i++)t[i]=e[i].view;return t},getProjects:function(){return this.paperScope.value.projects},projectToView(t){return this.getView(c.f[this.mapsGroupsIndex].viewMapItemsId).projectToView(t)},viewToProject(t){return this.getView(c.f[this.mapsGroupsIndex].viewMapItemsId).viewToProject(t)},updateView:function(t){this.getView(t).update()},bringToFrontLayer:function(t){var e;null===(e=this.getViewByLayer(t))||void 0===e||e._project.activate();let i=this.findMapLayer(t);null!=i&&i.bringToFront()},getMapCenterPos(){let t=this.mapModel._mapSize.x*this.mapModel._mapResolution/2,e=this.mapModel._mapSize.y*this.mapModel._mapResolution/2;return new this.paperScope.value.Point(t,e)},sendToBackLayer:function(t){let e=this.findMapLayer(t);null!=e&&e.sendToBack()},findMapLayer:function(t="",e=!1){if(e)return this.paperScope.value.projects.map(t=>t.layers).flat().find(e=>e.name===t)||null;for(var i=0;i<this.paperScope.value.project.layers.length;i++){var a=this.paperScope.value.project.layers[i];if(a.name===t)return a}return null},getProjectItems(t){this.paperScope.value.project.getItems({recursive:!1,overlapping:t})},updateMainLayer:function(){if(this.addAreaList(this.mapModel._areaDataList),this.addNodeList(this.mapModel._nodeDataList),this.isManualControlPage){this.addAreaList(this.mapModel._cleanAreaDataList),this.addFeatureList(this.mapModel._featureDataList),this.addTagList(this.mapModel._tagDataList),this.addPGVList(this.mapModel._barCodeDataList);const t=this.getMapSwitchItem(c.e.KEY_MAP_REDRAW_STATE).state;this.addAreaList(this.mapModel._redrawAreaDataList.filter(e=>t||e.isNewborn)),this.addAreaList(this.mapModel._noteAreaDataList);this.getMapSwitchItem(c.e.KEY_MAP_LOCATION_AREA_STATE).state&&this.addAreaList(this.mapModel._locationAreaDataList.filter(t=>t.isLocationAreaNormalModel))}this.addEdgetList(this.mapModel._edgeDataList),this.addStationList(this.mapModel._stationDataList)},createNode:function(t){if(null==t)return null;this.activeLayer(c.e.MAP_LAYER_NODE);var e=new z(this.getPaperScope(),t,this.mapModel);return e.setEditable(!0),e.setNameVisible(this.getMapSwitchItem(c.e.KEY_ITEM_NAMES).state),e.setDoubleClickCallback(this.onItemDoubleClicked),e.updateShape(),this.nodeItemList.push(e),this.addNodeItemToList(e),e.bringToFront(),e},createTag:function(t){if(null==t)return null;this.activeLayer(c.e.MAP_LAYER_TAG);let e=new V(this.getPaperScope(),t,this.mapModel);return e.setEditable(!0),e.setNameVisible(this.getMapSwitchItem(c.e.KEY_ITEM_NAMES).state),e.setDoubleClickCallback(this.onItemDoubleClicked),e.updateShape(),this.tagItemList.push(e),this.addTagItemToList(e),e.bringToFront(),e},createStationAndFeatureBind:function(t){if(null==t)return null;this.activeLayer(c.e.MAP_LAYER_FEATURE);let e=null;return e=new Q(this.getPaperScope(),t,this.mapModel),e.setEditable(!0),e.setNameVisible(this.getMapSwitchItem(c.e.KEY_ITEM_NAMES).state),e.setDoubleClickCallback(this.onItemDoubleClicked),e.updateShape(),e.bringToFront(),this.stationAndFeatureBindItemList.push(e),e},createBarcode:function(t){if(null==t)return null;this.activeLayer(c.e.MAP_LAYER_BARCODE);let e=new Nt(this.getPaperScope(),t,this.mapModel);return e.setEditable(!0),e.setNameVisible(this.getMapSwitchItem(c.e.KEY_ITEM_NAMES).state),e.setDoubleClickCallback(this.onItemDoubleClicked),e.updateShape(),this.barcodeItemList.push(e),e.bringToFront(),e},createLmkItem:function(t,e=Gt.colorDefault){if(null===t)return;this.activeLayer(c.e.MAP_LAYER_LMK);let i=new Bt(this.getPaperScope(),t,this.mapModel);return i.updateShape(),i.setColor(e),i},createFeatureItem:function(t){if(null==t)return null;this.activeLayer(c.e.MAP_LAYER_FEATURE);let e=new te(this.getPaperScope(),t,this.mapModel);return e.setEditable(!0),e.setNameVisible(this.getMapSwitchItem(c.e.KEY_ITEM_NAMES).state),e.setDoubleClickCallback(this.onItemDoubleClicked),e.updateShape(),e},createStation:function(t){if(null==t)return null;this.activeLayer(c.e.MAP_LAYER_STATION);var e=new nt(this.getPaperScope(),t,this.mapModel);return""===e.getName()&&e.setName(this.$t("label.station")+e.getID()),e.initPointsDistance(),e.setEditable(!0),e.setNameVisible(this.getMapSwitchItem(c.e.KEY_ITEM_NAMES).state),e.setEditPointCallback(this.onEditStationPoint),e.setDoubleClickCallback(this.onItemDoubleClicked),e.updateShape(),this.stationItemList.push(e),this.addStationItemToList(e),e.bringToFront(),e},createEdge:function(t){if(null==t)return null;this.activeLayer(c.e.MAP_LAYER_EDGE);let e=null;switch(t._type){case c.e.EDGE_TYPE_LINE:e=new K(this.getPaperScope(),t,this.mapModel),e.setCallbackItemScenePos(this.itemScenePosAt);break;case c.e.EDGE_TYPE_BEZIER:e=new tt(this.getPaperScope(),t,this.mapModel)}return e&&(e.setEditable(!0),e.setNameVisible(this.getMapSwitchItem(c.e.KEY_ITEM_NAMES).state),e.setEditPoleCallback(this.onAdjustEdgePole),e.setDoubleClickCallback(this.onItemDoubleClicked),e.updateShape(),e.bringToFront(),this.edgeItemList.push(e),this.addEdgeItemToList(e)),e},createArea:function(t){if(null==t)return null;t.isCleanArea()?this.activeLayer(c.e.MAP_LAYER_BOTTOM):t.isRedrawAreaModel()?this.activeLayer(c.e.MAP_LAYER_REDRAW):t.isNoteAreaModel()?this.activeLayer(c.e.MAP_LAYER_NOTE_AREA):t.isLocationAreaModel()?this.activeLayer(c.e.MAP_LAYER_LOCATION_AREA):t.isFuncAreaModel()&&this.activeLayer(c.e.MAP_LAYER_FUNC_AREA);let e=new st(this.getPaperScope(),t,this.mapModel,this);return e.setEditable(!0),e.setNameVisible(this.getMapSwitchItem(c.e.KEY_ITEM_NAMES).state),e.setDoubleClickCallback(this.onItemDoubleClicked),e.updateShape(),e.bringToFront(),null==e?null:(t.isFuncAreaModel()?(this.areaItemList.push(e),this.addAreaItemToList(e)):t.isRedrawAreaModel()?this.redrawAreaItemList.push(e):t.isCleanArea()?this.cleanAreaItemList.push(e):t.isNoteAreaModel()?(this.noteAreaItemList.push(e),this.addNoteAreaItemToList(e)):t.isLocationAreaModel()&&(this.locationAreaItemList.push(e),this.addLocationAreaItemToList(e)),e)},createDistance(){let t=new F(c.e.MODEL_TYPE_DISTANCE);return new qt(this.getPaperScope(),t,this.mapModel)},createEdgeGroup(t){let e=this.mapModel.createModel(c.e.MODEL_TYPE_EDGE_GROUP);return e.setName(t),this.updateEdgeGroupList(),this.addItemToList(e,this.edgeGroups),e},deleteEdgeGroup(t,e=!0){this.mapModel.deleteEdgeGroup(t),e&&this.updateEdgeGroupList(),this.deleteItemFromList(t,this.edgeGroups)},updateEdgeGroup(t){let e=t.id,i=t.name,a=this.mapModel.edgeGroupModel(e);if(null==a)return;a.fromJson(t);let s=this.getItem(e,this.edgeGroups);s.label=i,this.updateEdgeGroupList(),this.recordHistory("updateEdgeGroup")},doAddEdgeToGroup(t,e){let i=this.mapModel.edgeGroupModel(t);null!=i&&(i.addEdge(e),this.addEdgeToGroupForItemList(e,t))},getEdgeBelongGroups(t){let e=[];for(let i of Array.from(this.mapModel._edgeGroupDataList))i.hasEdge(t)&&e.push(i);return e},deleteEdgeFromAllGroups(t){if(null!=this.mapModel)for(let e of Array.from(this.mapModel._edgeGroupDataList))this.deleteEdgeFromGroup(e.getID(),t)},deleteEdgeFromGroup(t,e){let i=this.mapModel.edgeGroupModel(t);null!=i&&(i.removeEdge(e),this.removeEdgeFromGroupForItemList(t,e))},addAreaList:function(t){for(var e=0;e<t.length;e++){var i=t[e];this.createArea(i)}},addStationList:function(t){for(var e=0;e<t.length;e++){var i=t[e];this.createStation(i)}},addNodeList:function(t){for(var e=0;e<t.length;e++){var i=t[e];this.createNode(i)}},addFeatureList:function(t){for(let e=0;e<t.length;e++){let i=t[e],a=this.mapModel.stationModel(i.stationId),s=this.createFeatureItem(i);this.featureItems.push(s);let n=this.addStationAndFeatureBindItem(s.scenePos(),this.mapModel.mapToCanvas(a.getPos()));n.setStationId(a.getID()),n.setFeatureId(s.getID())}},addTagList:function(t){for(let e=0;e<t.length;e++){let i=t[e];this.createTag(i)}},addPGVList:function(t){for(let e=0;e<t.length;e++){let i=t[e];this.addPGVItemToList(this.createBarcode(i))}},addLmkList:function(t){this.deleteAllLMK(),this.lmkItemList=t.map(t=>this.createLmkItem({x:t.x,y:t.y,type:t.type},t.version?Gt.colorRedrawLMK:Gt.colorDefault)),this.setLmkVisible(this.isDrawLmk)},setRuntimeLmkList:function(t){this.deleteRuntimeLMK(),this.isDrawLmk&&(this.runtimeLmkList=t.map(t=>this.createLmkItem({x:t.x/10,y:t.y/10,type:t.lmkType},t.isMatched?Gt.colorMatched:Gt.colorUnmatched)))},setRuntimeFeatureItems:function(t){this.deleteRuntimeFeatureItems();for(let e of Array.from(t)){let t=this.createFeatureItem(e);this.runtimeFeatureItems.push(t)}},addEdgetList:function(t){for(var e=0;e<t.length;e++){var i=t[e];this.createEdge(i)}},addStationItemToList:function(t){this.addItemToList(t,this.stations)},addNodeItemToList:function(t){this.addItemToList(t,this.nodes)},addTagItemToList:function(t){this.addItemToList(t,this.tags)},addPGVItemToList:function(t){this.addItemToList(t,this.pgvs)},addEdgeItemToList:function(t){this.addItemToList(t,this.edges)},addStationAndFeatureBindItemToList:function(t){this.addItemToList(t,this.stationAndFeatureBindItemList)},addAreaItemToList:function(t){this.addItemToList(t,this.areas)},addNoteAreaItemToList(t){this.addItemToList(t,this.noteAreas)},addLocationAreaItemToList(t){this.addItemToList(t,this.locationAreas)},addItemToList:function(t,e){try{if(null!==this.getItem(t.getID(),e))return null;let i={key:t.itemType()+t.getName()+t.getID(),label:t.getName(),id:t.getID(),type:t.itemType(),isSelected:!1,isActive:!1};return t.itemType()===c.e.MODEL_TYPE_EDGE_GROUP&&(i.isExpand=!1),e.push(i),i}catch(t){return null}},addEdgeToGroupForItemList(t,e){let i=this.getItem(e,this.edgeGroups);if(null==i)return;i.hasOwnProperty("edges")||(i.edges=[]);let a=this.edgeItem(t),s=this.addItemToList(a,i.edges);null!=s&&(s.groupId=e)},removeEdgeFromGroupForItemList(t,e){let i=this.getItem(t,this.edgeGroups);null!=i&&this.deleteItemFromList(e,i.edges)},deleteStationItemFromList:function(t){this.deleteItemFromList(t,this.stations)},deleteNodeFromList:function(t){this.deleteItemFromList(t,this.nodes)},deleteTagFromList:function(t){this.deleteItemFromList(t,this.tags)},deletePGVFromList:function(t){this.deleteItemFromList(t,this.pgvs)},deleteEdgeFromList:function(t){this.deleteItemFromList(t,this.edges)},deleteAreaFromList:function(t){this.deleteItemFromList(t,this.areas)},deleteNoteAreaFromList(t){this.deleteItemFromList(t,this.noteAreas)},deleteLocationAreaFromList(t){this.deleteItemFromList(t,this.locationAreas)},deleteItemFromList:function(t,e){if(null==e)return;let i=-1;for(let a=0;a<e.length;a++)if(e[a].id===t){i=a;break}i<0||e.splice(i,1)},onItemDoubleClicked:function(t){if(this.isMapEditable()){if(t.isStationModel()){const e=this.stationItem(t.getID());e&&this.updateStationRecordedNodeId([e]),this.$refs.stationEditor.model=t.toJson(!1),this.$refs.stationEditor.stationItems=this.stationItemList,this.$refs.stationEditor.opened=!0}else if(t.isNodeModel()){let e=this.nodeItem(t.getID());this.stationsOnMovingNode=this.stationsExactAt(e.scenePos()),this.$refs.nodeEditor.model=t.toJson(!1),this.$refs.nodeEditor.opened=!0}else if(t.isFuncAreaModel())this.orignalUserDefinedParams=this.mapModel.getOrignalAreaUserDefinedParams(t.getID()),this.$refs.areaEditor.model=t.toJson(!1),this.$refs.areaEditor.opened=!0;else if(t.isEdgeModel())this.$refs.edgeEditor.model=t.toJson(!1),this.$refs.edgeEditor.setBelongEdgeGroups(this.getEdgeBelongGroups(t.getID())),this.$refs.edgeEditor.opened=!0;else if(t.isBarcodeModel()){const e=t.toJson(!1),i=this.stationItemList.filter(t=>t.getDMCodeID()===e.dmcode_id).map(t=>t.getName());this.$refs.barcodeEditor.init(e,i)}else t.isNoteAreaModel()?this.$refs.refNoteAreaEditor.setData(t.toJson(!1)):t.isLocationAreaModel()&&this.$refs.refAreaLocationEditor.setData(t.toJson(!1));this.setContextMenuState(!1)}},stationItem(t){return this.mapItem(t,this.stationItemList)},nodeItem:function(t){return this.mapItem(t,this.nodeItemList)},tagItem(t){return this.mapItem(t,this.tagItemList)},pgvItem(t){return this.mapItem(t,this.barcodeItemList)},areaItem:function(t){return this.mapItem(t,this.areaItemList)},edgeItem:function(t){return this.mapItem(t,this.edgeItemList)},redrawAreaItem:function(t){return this.mapItem(t,this.redrawAreaItemList)},noteAreaItem:function(t){return this.mapItem(t,this.noteAreaItemList)},locationAreaItem:function(t){return this.mapItem(t,this.locationAreaItemList)},getItem(t,e){for(let i=0;i<e.length;i++)if(e[i].id===t)return e[i];return null},mapItem:function(t,e){for(let i=0;i<e.length;i++)if(e[i].getID()===t)return e[i];return null},findMapItem:function(t,e){let i=this.mapItems(t);if(i.length<=0)return null;for(let t=0;t<i.length;t++)if(i[t].getID()===e)return i[t];return null},setLayerVisible(t,e){let i=this.getMapLayer(t);switch(i&&(i.visible=e),t){case c.e.MAP_LAYER_STATION:case c.e.MAP_LAYER_FEATURE:this.setStationsVisible(e);break;case c.e.MAP_LAYER_NODE:this.setNodesVisible(e);break;case c.e.MAP_LAYER_EDGE:this.setEdgesVisible(e);break;case c.e.MAP_LAYER_FUNC_AREA:this.setFunctionAreaVisible(e);break;case c.e.MAP_LAYER_TAG:this.setTagsVisible(e);break;case c.e.MAP_LAYER_BARCODE:this.setBarcodesVisible(e);break;case c.e.MAP_LAYER_LMK:this.setLmkVisible(e);break;case c.e.MAP_LAYER_REDRAW:this.setRedrawAreaVisible(e);break;case c.e.MAP_LAYER_NOTE_AREA:this.setNoteAreaVisible(e);break;case c.e.MAP_LAYER_LOCATION_AREA:this.setLocationAreaVisible(e)}t===c.e.MAP_LAYER_IMG?this.updateView(c.f[this.mapsGroupsIndex].viewMapImageId):this.updateView(c.f[this.mapsGroupsIndex].viewMapItemsId)},setAllItemsVisible(t){this.setStationsVisible(t),this.setNodesVisible(t),this.setEdgesVisible(t),this.setFunctionAreaVisible(t),this.setNoteAreaVisible(t),this.setLocationAreaVisible(t),this.setRedrawAreaVisible(t),this.setTagsVisible(t),this.setBarcodesVisible(t),this.setLmkVisible(t)},setStationsVisible(t){this.setItemsVisible(this.stationItemList,t)},setEdgesVisible(t){this.setItemsVisible(this.edgeItemList,t)},setNodesVisible:function(t){this.setItemsVisible(this.nodeItemList,t)},setFunctionAreaVisible(t){this.setItemsVisible(this.areaItemList,t,c.e.MAP_LAYER_FUNC_AREA)},setRedrawAreaVisible(t){this.setItemsVisible(this.redrawAreaItemList,t)},setNoteAreaVisible(t){this.setItemsVisible(this.noteAreaItemList,t)},setLocationAreaVisible(t){this.setItemsVisible(this.locationAreaItemList,t)},setTagsVisible(t){this.setItemsVisible(this.tagItemList,t)},setBarcodesVisible(t){this.setItemsVisible(this.barcodeItemList,t)},setLmkVisible(t){this.setItemsVisible(this.lmkItemList,t)},setItemsVisible(t,e,i=""){t.forEach(t=>{i!==c.e.MAP_LAYER_FUNC_AREA&&t.isVisible()||t.setVisible(e)})},drawCornerDialog:function(){return this.$refs.drawCorner},onEditStationPoint:function(t){this.setAction(c.e.ACTION_SET_STATION_POINT),this.editStationId=t},onAdjustEdgePole:function(t){this.editEdgeId=t,this.setAction(c.e.ACTION_SET_EDGE_POLE);let e=this.edgeItem(this.editEdgeId);if(null==e)return;let i=0;e.edgePole()===c.e.EDGE_POLE_START?(i=e.startNodeId(),e.setStartNodeId(0)):e.edgePole()===c.e.EDGE_POLE_END&&(i=e.endNodeId(),e.setEndNodeId(0)),i<=0||this.isNodeOnAnyEdge(i,e)||this.deleteNode(i)},onUpdateStation:function(t,e){let i=this.mapModel.stationModel(t);if(null==i)return;let a=this.stationItem(t);null!=a&&(i.fromJson(e,!1),a.updatePointsPos(0),this.onUpdateFeatureItemByStation(t,e.id),a.updateShape(),this.getView(c.f[this.mapsGroupsIndex].viewMapItemsId).requestUpdate(),this.recordHistory("onUpdateStation"))},onUpdateFeatureItemByStation(t,e){t!==e&&(this.stationAndFeatureBindItemList.forEach(i=>{i.getStationId()===t&&i.setStationId(e)}),this.featureItems.forEach(i=>{i.getStationId()===t&&i.setStationId(e)}))},onUpdateNode:function(t){let e=t.id,i=this.mapModel.nodeModel(e);if(null==i)return;i.fromJson(t,!1);let a=this.nodeItem(e);null!=a&&(a.updateShape(),this.updateEdgeByNode(a),this.updateStationPosAfterNodeChanged(a),this.updateAllStationBelongedEdge(),this.recordHistory("onUpdateNode"))},onUpdateArea:function(t){let e=t.id,i=this.mapModel.areaModel(e);if(null==i)return;i.fromJson(t,!1);let a=this.areaItem(e);null!=a&&(a.updateShape(),this.recordHistory("onUpdateArea"))},onUpdateNoteArea(t){const{id:e}=t,i=this.mapModel.noteAreaModel(e);if(!i)return;i.fromJson(t,!1);const a=this.noteAreaItem(e);a&&(a.updateShape(),this.recordHistory("onUpdateNoteArea"))},onUpdateLocationArea(t){const{id:e}=t,i=this.mapModel.locationAreaModel(e);if(!i)return;i.fromJson(t,!1);const a=this.locationAreaItem(e);a&&(a.updateShape(),this.recordHistory("onUpdateLocationArea"))},onUpdateEdge:function(t){let e=t.id,i=this.mapModel.edgeModel(e);if(null==i)return;i.fromJson(t,!1);let a=this.edgeItem(e);null!=a&&(a.updateFacing(),a.updateShape(),this.recordHistory("onUpdateEdge"))},onUpdateBarcode(t){let e=t.dmcode_id,i=this.pgvItem(e);null!=i&&(i.updatePose({x:t.x,y:t.y,yaw:t.yaw}),this.recordHistory("onUpdateBarcode"))},onUpdateEdgeGroup(t){if(t.id<=0){let e=this.createEdgeGroup(t.name),i=e.getID();e.fromJson(t),e.setID(i),this.$nextTick(()=>{this.$refs.selectEdgeGroup.setSeletedItem(i),this.$refs.selectEdgeGroup.opened=!0}),this.recordHistory("onUpdateEdgeGroup createEdgeGroup")}else this.updateEdgeGroup(t)},async onCreateEdgeGroup(){try{let t=await this.$refs.edgeGroupEditor.doEditEdgeGroup({id:0,name:"",types:[],desc:""});this.onUpdateEdgeGroup(t)}catch(t){}},onSelectEdgeGroup(t){if(t<0)return void this.onCreateEdgeGroup();let e=!1;for(let i of Array.from(this.selectingItems))i.itemType()===c.e.MODEL_TYPE_EDGE&&(this.doAddEdgeToGroup(t,i.getID()),e=!0);e&&this.recordHistory("doAddEdgeToGroup")},onSelectItem:function(t){null!==t?this.promiseCallback.resolve(t):this.promiseCallback.reject("Cancel select item")},selectRoundCornerEdges:function(){return new Promise((t,e)=>{this.promiseCallback.resolve=t,this.promiseCallback.reject=e;let i=this.drawCornerDialog();if(i.setOptions(this.selectEdgeOptions(this.edgeItemList,c.e.EDGE_TYPE_LINE)),this.isSelecting2Lines()){let t=this.selectingItems[0].getID(),e=this.selectingItems[1].getID();""===this.checkRoundCorner(.1,t,e)?(i.edgeFrom=t,i.edgeTo=e):""===this.checkRoundCorner(.1,e,t)&&(i.edgeFrom=e,i.edgeTo=t)}i.opened=!0})},isSelecting2Lines(){if(2!==this.selectingItems.length)return!1;let t=this.selectingItems[0],e=this.selectingItems[1];return t.itemType()===c.e.MODEL_TYPE_EDGE&&e.itemType()===c.e.MODEL_TYPE_EDGE&&(t.edgeType()===c.e.EDGE_TYPE_LINE&&e.edgeType()===c.e.EDGE_TYPE_LINE)},onDrawRoundCorner:function(t){null!==t?this.promiseCallback.resolve(t):this.promiseCallback.reject("Cancel draw round corner")},deselectItemList:function(t){for(let e=0;e<t.length;e++)t[e].isSelected()&&(this.activeItemLayer(t[e]),t[e].setSelectedState(!1))},deselectAllItems:function(){this.deselectItemList(this.allEditableItems())},createOtherItems:function(){this.activeLayer(c.e.MAP_LAYER_LARGE_CPU),this.laserPointsItem=new lt(this.getPaperScope(),this.mapModel),this.activeLayer(c.e.MAP_LAYER_ACTIVE),this.robotItem=new ct(this.getPaperScope(),this.mapModel),this.targetItem=new pt(this.getPaperScope()),this.targetItem.initShape(),this.targetItem.setVisible(!1),this.navPathItem=new rt(this.getPaperScope(),this.mapModel),this.robotLocusItem=new dt(this.getPaperScope()),this.avoidRectangleItem=new Ut(this.getPaperScope(),this.mapModel),this.activeLayer(c.e.MAP_LAYER_BG),this.axisItem=new Y(this.getPaperScope(),this.mapModel),this.axisItem.updateShape(),this.gridItem=new ft(this.getPaperScope(),this.mapModel);let t=null;t=null==this.mapImgRaster?new this.paperScope.value.Rectangle(0,0,this.mapModel._mapSize.x,this.mapModel._mapSize.y):this.mapImgRaster.bounds,this.gridItem.setBoundRect(t),this.gridItem.updateShape()},getEdgeByType(t,e){let i=[];return e.forEach(e=>{e.edgeType()===t&&i.push(e)}),i},getEdgeById(t,e){for(let i of Array.from(e))if(i.getID()===t)return i;return null},lineCrossPos:function(t,e){let i={};if(t.isVerticalToXAxis()&&e.isVerticalToXAxis())return null;if(t.isVerticalToXAxis()){let a=(e.startScenePos().y-e.endScenePos().y)/(e.startScenePos().x-e.endScenePos().x),s=e.startScenePos().y-a*e.startScenePos().x;return i.x=t.startScenePos().x,i.y=a*i.x+s,i}if(e.isVerticalToXAxis()){let a=(t.startScenePos().y-t.endScenePos().y)/(t.startScenePos().x-t.endScenePos().x),s=t.startScenePos().y-a*t.startScenePos().x;return i.x=e.startScenePos().x,i.y=a*i.x+s,i}let a=(t.startScenePos().y-t.endScenePos().y)/(t.startScenePos().x-t.endScenePos().x),s=t.startScenePos().y-a*t.startScenePos().x,n=(e.startScenePos().y-e.endScenePos().y)/(e.startScenePos().x-e.endScenePos().x),o=e.startScenePos().y-n*e.startScenePos().x;return i.x=(s-o)/(n-a),i.y=a*i.x+s,i},isBeyondControlDistance:function(t,e){return Object(c.n)(t,e)>c.e.MAX_INTERSECT_DISTANCE},splitEdge:function(t,e){if(null==e)return;let i=this.nodeItem(t);if(null!=i&&!e.isStartScenePos(i.scenePos())&&!e.isEndScenePos(i.scenePos())){let a=e.getRobotDirection();this.addLineItem(e.startNodeId(),t,e.startScenePos(),i.scenePos(),a),this.addLineItem(t,e.endNodeId(),i.scenePos(),e.endScenePos(),a),this.deleteEdge(e.getID())}},updateStationPosAfterNodeChanged(t){for(let e of Array.from(this.stationsOnMovingNode))e.setScenePos(t.scenePos())},updateEdgeByNode:function(t){if(null==t)return;let e=t.getID(),i=t.scenePos();this.edgeItemList.forEach(t=>{null!=t&&(t.isItemMoving()||(t.isStartNode(e)||t.isEndNode(e))&&(t.isStartNode(e)?t.setEdgePole(c.e.EDGE_POLE_START):t.isEndNode(e)&&t.setEdgePole(c.e.EDGE_POLE_END),t.adjustPole(i),t.finishEditPole(null),this.setEdgeForStation(t)))})},updateEdgeNodeId:function(t,e){this.edgeItemList.forEach(i=>{i.startNodeId()!==t?i.endNodeId()===t&&i.setEndNodeId(e):i.setStartNodeId(e)})},getMapSwitchItem:function(t){let e=null;return this.mapSwitchItems.forEach(i=>{i.key===t&&(e=i)}),this.otherSwitchItems.forEach(i=>{i.key===t&&(e=i)}),e},setEdgeForStation:function(t){null!=t&&t.edgeType()!==c.e.EDGE_TYPE_BEZIER&&this.stationItemList.forEach(e=>{null!=e&&(e.edgeId()>0||e.isChargeStation()||(t.isStartScenePos(e.scenePos())||t.isEndScenePos(e.scenePos()))&&(e.setEdgeId(t.getID()),t.isStartScenePos(e.scenePos())?e.setYaw(t.startFacing()):t.isEndScenePos(e.scenePos())&&e.setYaw(t.endFacing()),e.updateShape()))})},getStationOptions(t){let e=[],i=this.itemsAt(t,c.e.MODEL_TYPE_STATION,null,!0);for(let t of Array.from(i))e.push({id:t.getID(),name:t.getName()});return e},hasUnusedNodes(){for(let t of Array.from(this.nodeItemList)){if(null==t)return;if(!this.isNodeOnAnyEdge(t.getID()))return!0}return!1},deleteUnusedNodes:function(){let t=[];this.nodeItemList.forEach(e=>{null!=e&&(this.isNodeOnAnyEdge(e.getID())||t.push(e.getID()))}),t.forEach(t=>{this.deleteNode(t)})},isEdgeConnectToArcOrBezier:function(t){if(null==t)return;let e=t.startNodeId(),i=t.endNodeId();for(let a=0;a<this.edgeItemList.length;a++){let s=this.edgeItemList[a];if(s!==t&&(s.edgeType()===c.e.EDGE_TYPE_BEZIER&&(this.isNodeOnEdge(e,s)||this.isNodeOnEdge(i,s))))return!0}return!1},isNodeOnEdge:function(t,e){return null!=e&&(e.startNodeId()===t||e.endNodeId()===t)},isNodeOnAnyEdge:function(t,e=null){for(let i=0;i<this.edgeItemList.length;i++){let a=this.edgeItemList[i];if(a!==e&&this.isNodeOnEdge(t,a))return!0}return!1},isStationOnEdge:function(t){let e=this.stationItem(t);return null!=e&&e.getID()>0},isPointBetween:function(t,e,i){return t.x===e.x&&t.x===i.x?t.y>e.y&&t.y<i.y||t.y>i.y&&t.y<e.y:t.x>=e.x&&t.x<=i.x||t.x>=i.x&&t.x<=e.x},isItemUniqueSelected(t){let e=this.allSelectedItems();return null!==t&&1===e.length&&e[0]===t},setEdgeGroupSelected(t){let e=this.mapModel.edgeGroupModel(t);if(null!=e){this.activeLayer(c.e.MAP_LAYER_EDGE);for(let t of Array.from(e.getEdgeIds())){this.edgeItem(t).setSelectedState(!0)}}},edgesCrossNode:function(t){let e=[];return this.edgeItemList.forEach(i=>{i.startNodeId()!==t&&i.endNodeId()!==t||e.push(i)}),e},repaireAllEdgeNode:function(t){null!=t&&t.forEach(t=>{this.repaireEdgeNode(t)})},repaireEdgeNode:function(t){let e=this.nodeItem(t.startNodeId());(null==e||null!==e&&!t.isStartScenePos(e.scenePos()))&&this.repairEdgeStartNode(t),e=this.nodeItem(t.endNodeId()),(null==e||null!==e&&!t.isEndScenePos(e.scenePos()))&&this.repairEdgeEndNode(t)},repairEdgeStartNode:function(t){let e=this.nodesAt(t.startScenePos(),c.e.MODEL_TYPE_NODE);e.length>0&&t.isStartScenePos(e[0].scenePos())?t.setStartNodeId(e[0].getID()):t.setStartNodeId(this.addNodeItem(t.startScenePos()).getID())},repairEdgeEndNode:function(t){let e=this.nodesAt(t.endScenePos(),c.e.MODEL_TYPE_NODE);e.length>0&&t.isEndScenePos(e[0].scenePos())?t.setEndNodeId(e[0].getID()):t.setEndNodeId(this.addNodeItem(t.endScenePos()).getID())},updateAllStationBelongedEdge:function(){for(let t of Array.from(this.stationItemList)){if(t.isSelected())continue;let e=t.edgeId();if(null!==this.edgeItem(e))continue;let i=this.itemsAt(t.scenePos(),c.e.MODEL_TYPE_EDGE);t.setEdgeId(0);let a=null;for(let t=0;t<i.length;t++)if(i[t].edgeType()!==c.e.EDGE_TYPE_BEZIER&&i[t].getID()!==e){a=i[t];break}null!==a&&(t.setEdgeId(a.getID()),!t.isChargeStation()&&t.setYaw(a.startFacing())),t.updateShape()}},updateGrid:function(){if(null==this.gridItem)return;let t=null;t=null!=this.mapImgRaster?this.mapImgRaster.position:this.getMapCenterPos(),this.gridItem.setScenePos(t)},showSelectBox:function(t,e){let i=this.selectBox();if(void 0!==i&&null!=i)return i.doSelect({title:t,options:e})},selectBox:function(){return this.$refs.selectedBox},selectEdgeOptions:function(t,e=c.e.EDGE_TYPE_NONE){let i=[];return t.forEach(t=>{e!==c.e.EDGE_TYPE_NONE&&e!==t.edgeType()||i.push({label:t.getName(),type:t.itemType(),value:t.getID()})}),i},selectItemOptions:function(t){return(t=t||[]).map(t=>({label:t.getName(),type:t.itemType(),id:t.getID(),value:Object(g.a)()}))},isSelectDialogPopup:function(){let t=this.selectBox();return void 0!==t&&null!=t&&t.opened},clearSelectingItems(){this.selectingItems=null,this.selectingItems=[],this.deselectAllItems()},addSelectingItem(t){this.selectingItems.push(t)},removeSelectingItem(t){let e=this.selectingItems.indexOf(t);e>-1&&this.selectingItems.splice(e,1)},setSelectingItems(t){if(this.isMapEditable()&&this.action===c.e.ACTION_NONE){if(!this.isCtrlDown()&&this.selectingItems.length>1&&this.itemsAt(t).length>0)return;this.getSelectedItem(t).then(t=>{this.isItemUniqueSelected(t)||(this.isCtrlDown()||this.clearSelectingItems(),null!==t&&(t.isSelected()?this.removeSelectingItem(t):this.addSelectingItem(t)),this.updateSelectingItemsState())}).catch(t=>{})}},updateSelectingItemsState(){this.deselectAllItems(),this.selectingItems.forEach(t=>{this.activeItemLayer(t),t.setSelectedState(!0)})},async setSelectedItemsAxis(t){let e=this.selectedItems(this.nodeItemList);e=e.concat(this.selectedItems(this.stationItemList));let i=await this.getInputAxis(t,this.getAverageAxis(t,e));null!=i&&("x"===t?e.forEach(t=>{t.setMapPos({x:i,y:t.mapPos().y}),t.itemType()===c.e.MODEL_TYPE_NODE&&this.updateEdgeByNode(t)}):e.forEach(t=>{t.setMapPos({x:t.mapPos().x,y:i}),t.itemType()===c.e.MODEL_TYPE_NODE&&this.updateEdgeByNode(t)}),this.updateAllStationBelongedEdge(),this.recordHistory("setSelectedItemsAxis type : ",t))},getAverageAxis(t,e){let i=0;return e.forEach(e=>{let a=e.mapPos();i+="x"===t?a.x:a.y}),(i/e.length).toFixed(2)},async getInputAxis(t,e){try{let i=await this.$refs.inputDlg.doInput({type:"number",title:this.$t("label.setCoordinate"),desc:this.$t("text.setCoordinateBatch",{axisType:t}),value:e});return parseFloat(i)}catch(t){return null}},displayTime(){},recordHistory(t=""){this.history.record(t,this.mapModel.saveToJson())},executeHistory(t){let e=null;switch(t){case"undo":e=this.history.undo();break;case"redo":e=this.history.redo();break;case"clear":this.history.clear()}e?(this.finishDrawing(),this.deleteAllNodes(),this.deleteAllFuncArea(),this.deleteAllCleanArea(),this.deleteAllTags(),this.deleteAllPGVs(),this.deleteAllStations(),this.deleteAllStationAndFeatureBind(),this.deleteAllEdges(),this.deleteAllEdgeGroups(),this.deleteAllWareroomAreaAndWareroomRegion(),this.deleteAllRedrawAreas(),this.deleteAllNoteAreas(),this.deleteAllLocationAreas(),this.resetLayer(c.e.MAP_LAYER_EDGE),this.resetLayer(c.e.MAP_LAYER_STATION),this.resetLayer(c.e.MAP_LAYER_FEATURE),this.resetLayer(c.e.MAP_LAYER_NODE),this.resetLayer(c.e.MAP_LAYER_FUNC_AREA),this.resetLayer(c.e.MAP_LAYER_BARCODE),this.resetLayer(c.e.MAP_LAYER_TAG),this.resetLayer(c.e.MAP_LAYER_REDRAW),this.resetLayer(c.e.MAP_LAYER_NOTE_AREA),this.resetLayer(c.e.MAP_LAYER_LOCATION_AREA),this.$nextTick(()=>{this.mapModel.loadFromJson(e,!0,!1),this.updateMainLayer(),this.updateEdgeGroupList(),this.initEdgeGroups(),this.updateMap(!1),this.activeLayer(c.e.MAP_LAYER_ACTIVE)})):["undo","redo"].includes(t)&&this.$notify({message:this.$t("text.noMoreRecords")+this.$t("label.execute")+this.$t(`button.${t}`),timeout:3e3,type:"negative",position:"top"})},onEditWareroomAreaAndWareroomRegion(){this.action===c.e.ACTION_NONE&&(this.$refs.refWareroomAreaAndWareroomRegionEditor.wareroomAreas=this.wareroomAreas.map(t=>({...t,canDelete:!this.stationItemList.some(e=>e.isStationTypeWareroom()&&e.getStationWareroom().wareroomAreaId===t.id)})),this.$refs.refWareroomAreaAndWareroomRegionEditor.wareroomRegions=this.wareroomRegions.map(t=>({...t,canDelete:!this.stationItemList.some(e=>e.isStationTypeWareroom()&&e.getStationWareroom().wareroomRegionId===t.id)})),this.$refs.refWareroomAreaAndWareroomRegionEditor.opened=!0)},onUpdateWareroomAreaAndWareroomRegion(t=[],e=[]){this.mapModel.saveWareroomToMapModal(t,e),this.recordHistory("onUpdateWareroomAreaAndWareroomRegion")},deleteAllWareroomAreaAndWareroomRegion(){this.mapModel.saveWareroomToMapModal([],[])},onBatchCopyStation(){this.clipboardItems=[this.selectingItems[0]],this.finishDrawing(),this.$refs.refStationBatchCopyEditor.opened=!0},onUpdateStationBatchCopy({rowCount:t=1,rowDistance:e=0,columnCount:i=1,columnDistance:a=0}={}){if(1!==this.clipboardItems.length||!this.clipboardItems[0].getDat().isStationModel())return void this.$notify({message:this.$t("text.copyDuplicatesWareroomInformation"),timeout:3e3,type:"negative",position:"top"});let s=[],n=this.clipboardItems[0].getDat().toJson(!1);for(let o=0;o<t;o++)for(let t=0;t<i;t++)if(0!==o||0!==t){let i={"pos.x":n["pos.x"]+t*a,"pos.y":n["pos.y"]+o*e,edge_id:0,dmcode_id:"","pgv_offset.x":0,"pgv_offset.y":0,"pgv_offset.yaw":0};n.type===c.e.STATION_TYPE_WAREROOM&&(i.wareroomLocationRow=n.wareroomLocationRow+o,i.wareroomLocationColumn=n.wareroomLocationColumn+t);let r={...n,...i};delete r.id,delete r.name,s.push(r)}let o=[];n.type===c.e.STATION_TYPE_WAREROOM&&this.stationItemList.forEach(t=>{s.forEach((e,i)=>{let a=t.getStationWareroom();t.isStationTypeWareroom()&&a.wareroomAreaId===e.wareroomAreaId&&a.wareroomRegionId===e.wareroomRegionId&&a.wareroomLocationRow===e.wareroomLocationRow&&a.wareroomLocationColumn===e.wareroomLocationColumn&&o.push({stationName:t.getName(),i:i})})}),o.length?o.forEach(t=>{this.$notify({message:this.$t("text.copyDuplicatesWareroomInformation",{index:t.i,stationName:t.stationName}),timeout:3e3,type:"negative",position:"top"})}):(this.clipboardItems=[],this.onBatchCopyStationStart(s))},onBatchCopyStationStart(t=[]){try{t.forEach(t=>{let e=this.mapModel.createModel(c.e.MODEL_TYPE_STATION),i=this.createStation(e),a={...e.toJson(!1),...t};e.fromJson(a,!1),i.updateShape()})}catch(t){}this.recordHistory("onBatchCopyStationStart")},async onStationRotateEditor(){let t=this.selectingItems.filter(t=>t.getDat().isStationModel());this.finishDrawing(),this.$refs.refStationRotateEditor.opened=!0;let e=null,i=null;try{e=await this.$refs.refStationRotateEditor.initDat(),i=this.stationItemList.filter(t=>t.getID()===e.stationId)[0]}catch(t){}if(e&&i){try{t.forEach(t=>{t.getID()!==e.stationId&&t.setStationRotate({degree:e.degree,isSyncYaw:e.isSyncYaw,centerPos:i.getScenePosition(),yaw:i.yaw()})})}catch(t){}this.recordHistory("onStationRotateEditor")}},setRedrawStart(t=!0){var e;if(!t)return void(null===(e=this.redrawItem)||void 0===e||e.updateScanImage(!1));if(this.redrawItem)return;this.redrawItem=new ut(this.getPaperScope(),this.mapModel);const i=this.getMapSwitchItem(c.e.KEY_BACKGROUND_IMAGE_STATE);i.state=!0,this.onSwitchStateChanged(i),this.isMapRedraw&&(this.activeLayer(c.e.MAP_LAYER_REDRAW),this.redrawItem.addMarker(this.robotLastScenePos)),this.redrawItem.updateScanImage(!0)},async updateRedrawAreaPreview(){const t=this.getMapSwitchItem(c.e.KEY_BACKGROUND_IMAGE_STATE);t.state=!1,this.onSwitchStateChanged(t),this.activeLayer(c.e.MAP_LAYER_REDRAW);const e=await this.redrawItem.updateRedrawPreview();e&&this.addLmkList(e.lmks)},setRedrawReset(t=!1){var e,i,a;if(t)return;[...this.mapModel._redrawAreaDataList].forEach(t=>{t.isNewborn&&this.deleteRedrawArea(t.getID())}),null===(e=this.redrawItem)||void 0===e||e.updateScanImage(!1),null===(i=this.redrawItem)||void 0===i||i.removeRaster(),null===(a=this.redrawItem)||void 0===a||a.delete(),this.redrawItem=null;const s=this.getMapSwitchItem(c.e.KEY_BACKGROUND_IMAGE_STATE);s.state=!0,this.onSwitchStateChanged(s)},getRedrawPolygonData(){return this.mapModel.toJson(this.mapModel._redrawAreaDataList.filter(t=>t.isNewborn)).map(t=>({vertexs:[{x:t["pa.x"],y:t["pa.y"]},{x:t["pb.x"],y:t["pb.y"]},{x:t["pc.x"],y:t["pc.y"]},{x:t["pd.x"],y:t["pd.y"]}]}))},updateStationRecordedNodeId(t=this.stationItemList){const e=this.nodeItemList.map(t=>({...t.mapPos(),id:t.getID()}));t.forEach(t=>{var i,a;const s=t.mapPos();let n=[];e.forEach(t=>{const e=Object(c.n)(s,t);e<1&&n.push({id:t.id,distance:e})}),n.sort((t,e)=>t.distance-e.distance),t.setNodeId(null!==(i=null===(a=n[0])||void 0===a?void 0:a.id)&&void 0!==i?i:0)})}}},me=(i("c026"),i("de5e")),fe=i("9c40"),ge=i("0016"),_e=i("4e73"),ye=Object(bt.a)(pe,function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"mapView"}},[t.isContextMenuOpen?e("context-menu",{ref:"ctxMenu"}):t._e(),e("v-touch",{attrs:{"pin-options":{threshold:0},"pan-options":{threshold:0}},on:{pinchin:t.onPinchIn,pinchout:t.onPinchOut,panstart:t.onPanStart,panmove:t.onPanMove,panend:t.onPanEnd,press:t.onPressed}},[e("div",{staticClass:"fit"},[e("canvas",{staticStyle:{"pointer-events":"none"},attrs:{id:t.MapsGroups[t.mapsGroupsIndex].viewMapImageId,resize:""}}),e("div",{staticStyle:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%"},attrs:{id:t.MapsGroups[t.mapsGroupsIndex].heatmapContainerId}}),e("canvas",{attrs:{id:t.MapsGroups[t.mapsGroupsIndex].viewMapItemsId,resize:""}}),e("canvas",{staticStyle:{"pointer-events":"none"},attrs:{id:t.MapsGroups[t.mapsGroupsIndex].viewMapActiveId,resize:""}})])]),!t.isMobile&&t.mapEditable?e("q-page-sticky",{staticClass:"full-height",staticStyle:{width:"280px"},attrs:{position:"top-right",offset:[1,1]}},[e("edit-map-tool-bar",{staticStyle:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%"},attrs:{"display-map":t.mapName,"cur-action":t.action,stations:t.stations,edges:t.edges,areas:t.areas,nodes:t.nodes,locationAreas:t.locationAreas,noteAreas:t.noteAreas,tags:t.tags,pgvs:t.pgvs,"edge-groups":t.edgeGroups},on:{doAction:t.doAction,executeHistory:t.executeHistory,saveMap:t.saveMap,exitEdit:t.exitEditMap,clickItem:t.onClickItemFromMapItemList,dblClickItem:t.onDBLClickItemFromMapItemList,deleteItem:t.onDeleteItemFromMapItemList,edit:t.onEditFromMapItemList,tag2node:t.onTag2Node,tag2station:t.onTag2Station,editWareroomAreaAndWareroomRegion:t.onEditWareroomAreaAndWareroomRegion}})],1):t._e(),t.isMapLoaded?[t.isManualControlPage?[e("q-page-sticky",{attrs:{position:"bottom-right",offset:t.isMapEditable()?[300,12]:t.isMobile||!t.isRightDrawerOpen?[60,12]:[16,12]}},[e("scale-item",{attrs:{"mouse-pos":t.mousePos,scale:t.mapScale}})],1),e("q-page-sticky",{attrs:{position:"bottom-right",offset:t.isMapEditable()?[294,60]:[12,60]}},[e("control-buttons",{on:{click:t.onDoMapAction}})],1)]:[e("div",{staticClass:"absolute absolute-bottom-right bottom-50"},[e("control-buttons",{on:{click:t.onDoMapAction}})],1),e("div",{staticClass:"absolute absolute-bottom-right right-10"},[e("scale-item",{attrs:{"mouse-pos":t.mousePos,scale:t.mapScale}})],1)]]:t._e(),!t.isMapLoaded||!t.isManualControlPage||t.isMobile&&t.isManualCtrl?t._e():e("q-page-sticky",{staticClass:"q-mt-sm",attrs:{position:t.isHorzontal?"top-right":"bottom",offset:t.isMapEditable()?[290,8]:[10,8]}},[e("div",{staticClass:"row justify-between"},[e("q-btn",{staticClass:"no-shadow button_width background_white",attrs:{dense:"","no-caps":"",unelevated:""}},[e("q-icon",{staticClass:"std_eye_grey icon_size_20"}),e("div",{staticClass:"text_main_grey_style q-ml-sm"},[t._v("\n          "+t._s(t.$t("label.mapPage")+t.$t("label.element"))+"\n        ")]),e("q-menu",{attrs:{anchor:"bottom right",self:"top right"}},[e("checkbox-list",{attrs:{"checkbox-items":t.mapSwitchItems},on:{change:t.onSwitchStateChanged}})],1)],1),e("q-btn",{staticClass:"background_white q-ml-sm button_width",attrs:{dense:"","no-caps":"",unelevated:""}},[e("q-icon",{staticClass:"std_eye_grey icon_size_20"}),e("div",{staticClass:"text_main_grey_style q-ml-sm"},[t._v(t._s(t.$t("label.others")))]),e("q-menu",{attrs:{anchor:"bottom right",self:"top right"}},[e("OtherFeatureItems",{attrs:{otherSwitchItems:t.otherSwitchItems},on:{change:t.onSwitchStateChanged}})],1)],1)],1),e("MapSearchTool",{attrs:{stations:t.stations,edges:t.edges,areas:t.areas,nodes:t.nodes,locationAreas:t.locationAreas,noteAreas:t.noteAreas,tags:t.tags,dmCodes:t.pgvs,"edge-groups":t.edgeGroups},on:{"search:select":t.setCenterElement}})],1),e("StationEditor",{ref:"stationEditor",attrs:{wareroomAreas:t.wareroomAreas,wareroomRegions:t.wareroomRegions},on:{updateModel:t.onUpdateStation}}),e("StationBatchCopyEditor",{ref:"refStationBatchCopyEditor",on:{updateModel:t.onUpdateStationBatchCopy}}),e("WareroomAreaAndWareroomRegionEditor",{ref:"refWareroomAreaAndWareroomRegionEditor",on:{updateModel:t.onUpdateWareroomAreaAndWareroomRegion}}),e("StationRotateEditor",{ref:"refStationRotateEditor",attrs:{stations:t.stations}}),e("NodeEditor",{ref:"nodeEditor",on:{updateModel:t.onUpdateNode}}),e("AreaEditor",{ref:"areaEditor",attrs:{preference:t.areaObaConfigs,orignalParams:t.orignalUserDefinedParams},on:{updateModel:t.onUpdateArea}}),e("NoteAreaEditor",{ref:"refNoteAreaEditor",on:{updateModel:t.onUpdateNoteArea}}),e("LocationAreaEditor",{ref:"refAreaLocationEditor",on:{updateModel:t.onUpdateLocationArea}}),e("EdgeEditor",{ref:"edgeEditor",on:{updateModel:t.onUpdateEdge}}),e("StationDMCodeCreator",{ref:"refStationDMCodeCreator",attrs:{stations:t.stations},on:{updateModel:t.recordDMCode}}),e("BarcodeEditor",{ref:"barcodeEditor",on:{updateModel:t.onUpdateBarcode}}),e("edge-group-editor",{ref:"edgeGroupEditor",attrs:{"edge-groups":t.edgeGroupsList}}),e("select-edge-group",{ref:"selectEdgeGroup",attrs:{options:t.edgeGroupsList},on:{selectItem:t.onSelectEdgeGroup}}),e("SelectDialog",{ref:"selectedBox",on:{selectItem:t.onSelectItem}}),e("question-dialog",{ref:"questionDlg"}),e("message-dialog",{ref:"messageDlg"}),e("input-dialog",{ref:"inputDlg"}),e("DrawRoundCorner",{ref:"drawCorner",on:{drawCorner:t.onDrawRoundCorner}}),e("set-coordinate",{ref:"selectCoordinate",on:{setcoordinate:t.moveSelectedItems}}),e("check-map-list",{ref:"checkMapList",attrs:{"check-list":t.mapCheckList},on:{close:t.doSaveMap}})],2)},[],!1,null,"68a26be8",null);e.a=ye.exports;Mt()(ye,"components",{QPageSticky:me.a,QBtn:fe.a,QIcon:ge.a,QMenu:_e.a})},f2c2:function(t,e,i){"use strict";i("4394")},f330:function(t,e,i){},fbec:function(t,e,i){"use strict";var a=i("b69e"),s=i("32e0"),n=i("de9c"),o={name:"EdgeEditor",components:{AddProperty:i("13ad").a,ChoiceButtons:n.a,HeaderItem:s.a},data(){return{opened:!1,model:null,userDefineProperties:[],selectedProperty:[],pagination:{rowsPerPage:30},edgeGroupList:"",edgeTypeOptions:[{label:this.$t("label.line"),value:1},{label:this.$t("label.bezier"),value:3}],moveDirOptions:[{label:this.$t("label.forward"),value:a.e.EDGE_DIR_FORWARD},{label:this.$t("label.backward"),value:a.e.EDGE_DIR_BACKWARD},{label:this.$t("label.dirLeft"),value:a.e.EDGE_DIR_LEFT},{label:this.$t("label.dirRight"),value:a.e.EDGE_DIR_RIGHT}],rotateDirOptions:[{label:this.$t("label.anticlockwise"),value:1},{label:this.$t("label.clockwise"),value:2}],executeOptions:[{label:"EXECUTE_FREE",value:1},{label:"EXECUTE_LOAD",value:2},{label:"EXECUTE_ALL",value:255}],pathBehaviorTypeOptions:[{label:this.$t("label.default"),value:0},{label:"ä»¥ä¸è§äºç»´ç ä¸ºè¿å¨ä¸­å¿ç§»å¨å¯¹æ¥",value:1}],pathBehaviorTriggerStageOptions:[{label:this.$t("label.default"),value:0},{label:this.$t("label.enterBefore"),value:1}],pathBehaviorLoadStateOptions:[{label:this.$t("label.default"),value:0},{label:this.$t("label.notLifting"),value:1},{label:this.$t("label.lifting"),value:2}],columns:[{name:"name",label:this.$t("label.name"),field:"name",required:!0,align:"center",sortable:!1},{name:"value",label:this.$t("label.value"),field:"value",required:!0,align:"center",sortable:!1}]}},computed:{startFacing:{get:function(){return null==this.model?0:Object(a.x)(Object(a.h)(this.model.s_facing))},set:function(t){null!=this.model&&(this.model.s_facing=t)}},endFacing:{get:function(){return null==this.model?0:Object(a.x)(Object(a.h)(this.model.e_facing))},set:function(t){null!=this.model&&(this.model.e_facing=t)}},edgeDirection:{get(){let t=0;switch(this.model.type){case a.e.EDGE_TYPE_LINE:t=this.yaw(this.startMapPos(),this.endMapPos());break;case a.e.EDGE_TYPE_BEZIER:t=this.yaw(this.startMapPos(),this.centerMapPos())}let e=a.e.EDGE_DIR_FORWARD,i=this.model.s_facing-t;return Object(a.m)(i,Math.PI)?e=a.e.EDGE_DIR_BACKWARD:Object(a.m)(i,Math.PI/2)?e=a.e.EDGE_DIR_LEFT:Object(a.m)(i,-Math.PI/2)&&(e=a.e.EDGE_DIR_RIGHT),e},set(t){let e=0,i=0;switch(this.model.type){case a.e.EDGE_TYPE_LINE:e=this.yaw(this.startMapPos(),this.endMapPos()),i=e;break;case a.e.EDGE_TYPE_BEZIER:e=this.yaw(this.startMapPos(),this.centerMapPos()),i=this.yaw(this.dMapPos(),this.endMapPos())}t===a.e.EDGE_DIR_BACKWARD?(e=(e+Math.PI)%(2*Math.PI),i=(i+Math.PI)%(2*Math.PI)):t===a.e.EDGE_DIR_LEFT?(e=(e+Math.PI/2)%(2*Math.PI),i=(i+Math.PI/2)%(2*Math.PI)):t===a.e.EDGE_DIR_RIGHT&&(e=(e-Math.PI/2)%(2*Math.PI),i=(i-Math.PI/2)%(2*Math.PI)),this.model.robot_direction=t,this.startFacing=e,this.endFacing=i}},maxRotateAngle:{get:function(){return null==this.model?0:Object(a.x)(Object(a.h)(this.model.limit_w))},set:function(t){null!=this.model&&(this.model.limit_w=Object(a.b)(t%360))}},edgeOrientation:{get:function(){return null==this.model?-1:Object(a.h)(this.model.orientation)},set:function(t){null!=this.model&&(this.model.orientation=Object(a.b)(t))}}},watch:{opened(t,e){if(t){let t=this.model.user_define_properties;this.userDefineProperties=[];for(let e in t)this.userDefineProperties.push({name:e,value:t[e]});document.addEventListener("keydown",this.onKeyDown),this.model.type!==a.e.EDGE_TYPE_LINE?this.moveDirOptions=[{label:this.$t("label.forward"),value:a.e.EDGE_DIR_FORWARD},{label:this.$t("label.backward"),value:a.e.EDGE_DIR_BACKWARD}]:this.moveDirOptions=[{label:this.$t("label.forward"),value:a.e.EDGE_DIR_FORWARD},{label:this.$t("label.backward"),value:a.e.EDGE_DIR_BACKWARD},{label:this.$t("label.dirLeft"),value:a.e.EDGE_DIR_LEFT},{label:this.$t("label.dirRight"),value:a.e.EDGE_DIR_RIGHT}]}else document.removeEventListener("keydown",this.onKeyDown)}},methods:{setBelongEdgeGroups(t){this.edgeGroupList="";for(let e of Array.from(t))this.edgeGroupList+=e.getName()+"; ";this.edgeGroupList=this.edgeGroupList.trim(),this.edgeGroupList=this.edgeGroupList.substr(0,this.edgeGroupList.length-1)},onClosed:function(){!0!==this.$refs.addPropertyDlg.opened&&(this.opened=!1)},onSaved:function(){if(!0===this.$refs.addPropertyDlg.opened)return;let t={};for(let e of Array.from(this.userDefineProperties))t[e.name]=e.value;this.model.user_define_properties=t,this.$emit("updateModel",this.model),this.onClosed()},onKeyDown(t){"s"===t.key&&t.ctrlKey&&(t.stopPropagation(),t.preventDefault(),this.onSaved())},yaw(t,e){let i=Object(a.s)(t,e),s=Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2)),n=Math.acos(i.x/s);return i.y<0&&(n=2*Math.PI-n),n},startMapPos(){return this.mapPos(this.model.sx,this.model.sy)},endMapPos(){return this.mapPos(this.model.ex,this.model.ey)},centerMapPos(){return this.mapPos(this.model.cx,this.model.cy)},onChangePathBehavior(t){this.model.path_behavior.type=t,1===t?(this.model.path_behavior.trigger_stage=1,this.model.path_behavior.trigger_condition.load_state=2):(this.model.path_behavior.trigger_stage=0,this.model.path_behavior.trigger_condition.load_state=0)},dMapPos(){return this.mapPos(this.model.dx,this.model.dy)},mapPos:(t,e)=>({x:t,y:e}),getProperty(t){for(let e of Array.from(this.userDefineProperties))if(e.name===t)return e;return null},onAddProperty(t){let e=t.name;null===this.getProperty(e)?this.doAddProperty(t):this.$notify({message:this.$t("text.userDefinedPropertyHasExist",{name:e}),timeout:3e3,type:"warning",position:"top"})},doAddProperty(t){this.userDefineProperties.push(t)},onAddUserDefinedProperty(){this.$refs.addPropertyDlg.model={name:"",value:""},this.$refs.addPropertyDlg.opened=!0},onDeleteProperty(){for(let t of Array.from(this.selectedProperty))this.doDeleteProperty(t.name);this.selectedProperty=[]},doDeleteProperty(t){let e=-1;for(let i=0;i<this.userDefineProperties.length;i++)if(t===this.userDefineProperties[i].name){e=i;break}e>=0&&this.userDefineProperties.splice(e,1)}}},r=i("2877"),l=i("24e8"),c=i("f09f"),d=i("1c1c"),h=i("66e5"),u=i("4074"),p=i("27f9"),m=i("ddd8"),f=i("eaac"),g=i("9c40"),_=i("eebe"),y=i.n(_),v=Object(r.a)(o,function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{"no-backdrop-dismiss":""},model:{value:t.opened,callback:function(e){t.opened=e},expression:"opened"}},[e("q-card",{staticStyle:{width:"480px"}},[e("div",{staticClass:"q-mx-md q-mt-md"},[e("header-item",{attrs:{title:t.$t("label.editEdge")},on:{close:t.onClosed}})],1),null!=t.model?e("div",[e("q-list",{staticClass:"q-mt-xs scroll q-mr-md",staticStyle:{"max-height":"600px"},attrs:{"no-border":""}},[e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.edgeId"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right",disable:""},model:{value:t.model.id,callback:function(e){t.$set(t.model,"id",t._n(e))},expression:"model.id"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.type"))+"\n              ")]),e("q-select",{staticClass:"col-sm-8 col-md-8 col-lg-8",attrs:{options:t.edgeTypeOptions,outlined:"",dense:"",autofocus:"",disable:"","emit-value":"","map-options":"",dir:"rtl"},model:{value:t.model.type,callback:function(e){t.$set(t.model,"type",e)},expression:"model.type"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.belongEdgeGroup"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"text","input-class":"text-right",disable:""},model:{value:t.edgeGroupList,callback:function(e){t.edgeGroupList=e},expression:"edgeGroupList"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.startNode"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right",disable:""},model:{value:t.model.s_node,callback:function(e){t.$set(t.model,"s_node",t._n(e))},expression:"model.s_node"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.endNode"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right",disable:""},model:{value:t.model.e_node,callback:function(e){t.$set(t.model,"e_node",t._n(e))},expression:"model.e_node"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.startPos")+"x(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right",disable:""},model:{value:t.model.sx,callback:function(e){t.$set(t.model,"sx",t._n(e))},expression:"model.sx"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.startPos")+"y(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right",disable:""},model:{value:t.model.sy,callback:function(e){t.$set(t.model,"sy",t._n(e))},expression:"model.sy"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.endPos")+"x(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right",disable:""},model:{value:t.model.ex,callback:function(e){t.$set(t.model,"ex",t._n(e))},expression:"model.ex"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.endPos")+"y(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right",disable:""},model:{value:t.model.ey,callback:function(e){t.$set(t.model,"ey",t._n(e))},expression:"model.ey"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.bezierCPos")+"x(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right",disable:""},model:{value:t.model.cx,callback:function(e){t.$set(t.model,"cx",t._n(e))},expression:"model.cx"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.bezierCPos")+"y(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right",disable:""},model:{value:t.model.cy,callback:function(e){t.$set(t.model,"cy",t._n(e))},expression:"model.cy"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.bezierDPos")+"x(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right",disable:""},model:{value:t.model.dx,callback:function(e){t.$set(t.model,"dx",t._n(e))},expression:"model.dx"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.bezierDPos")+"y(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right",disable:""},model:{value:t.model.dy,callback:function(e){t.$set(t.model,"dy",t._n(e))},expression:"model.dy"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.maxLineSpeed")+"(m/s)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.model.limit_v,callback:function(e){t.$set(t.model,"limit_v",t._n(e))},expression:"model.limit_v"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.maxRadSpeed")+"(Â°/s)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.maxRotateAngle,callback:function(e){t.maxRotateAngle=t._n(e)},expression:"maxRotateAngle"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.startAngle")+"(Â°)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",disable:"",type:"number","input-class":"text-right"},model:{value:t.startFacing,callback:function(e){t.startFacing=t._n(e)},expression:"startFacing"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.endAngle")+"(Â°)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",disable:"",type:"number","input-class":"text-right"},model:{value:t.endFacing,callback:function(e){t.endFacing=t._n(e)},expression:"endFacing"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.orientation")+"(Â°)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number",min:"-1",max:"360","input-class":"text-right"},model:{value:t.edgeOrientation,callback:function(e){t.edgeOrientation=t._n(e)},expression:"edgeOrientation"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.moveDirection"))+"\n              ")]),e("q-select",{staticClass:"col-sm-8 col-md-8 col-lg-8",attrs:{options:t.moveDirOptions,outlined:"",dense:"",autofocus:"","emit-value":"","map-options":"",dir:"rtl"},model:{value:t.edgeDirection,callback:function(e){t.edgeDirection=e},expression:"edgeDirection"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.rotateDirection"))+"\n              ")]),e("q-select",{staticClass:"col-sm-8 col-md-8 col-lg-8",attrs:{options:t.rotateDirOptions,outlined:"",dense:"",autofocus:"","emit-value":"","map-options":"",dir:"rtl"},model:{value:t.model.rotate_direction,callback:function(e){t.$set(t.model,"rotate_direction",e)},expression:"model.rotate_direction"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.executeType"))+"\n              ")]),e("q-select",{staticClass:"col-sm-8 col-md-8 col-lg-8",attrs:{options:t.executeOptions,outlined:"",dense:"",autofocus:"","emit-value":"","map-options":"",dir:"rtl"},model:{value:t.model.param,callback:function(e){t.$set(t.model,"param",e)},expression:"model.param"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.cost")+"(cm)")+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"number","input-class":"text-right"},model:{value:t.model.cost,callback:function(e){t.$set(t.model,"cost",t._n(e))},expression:"model.cost"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.pathBehavior"))+"\n              ")]),e("q-select",{staticClass:"col-sm-8 col-md-8 col-lg-8",attrs:{options:t.pathBehaviorTypeOptions,outlined:"",dense:"","emit-value":"","map-options":"",dir:"rtl"},on:{input:t.onChangePathBehavior},model:{value:t.model.path_behavior.type,callback:function(e){t.$set(t.model.path_behavior,"type",e)},expression:"model.path_behavior.type"}})],1)])],1),t.model.path_behavior.type?[e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style q-pl-md field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                  "+t._s(t.$t("label.stage"))+"\n                ")]),e("q-select",{staticClass:"col-sm-8 col-md-8 col-lg-8",attrs:{options:t.pathBehaviorTriggerStageOptions,outlined:"",disable:"",dense:"","emit-value":"","map-options":"",dir:"rtl"},model:{value:t.model.path_behavior.trigger_stage,callback:function(e){t.$set(t.model.path_behavior,"trigger_stage",e)},expression:"model.path_behavior.trigger_stage"}})],1)])],1),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style q-pl-md field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                  "+t._s(t.$t("label.liftingState"))+"\n                ")]),e("q-select",{staticClass:"col-sm-8 col-md-8 col-lg-8",attrs:{options:t.pathBehaviorLoadStateOptions,outlined:"",disable:"",dense:"","emit-value":"","map-options":"",dir:"rtl"},model:{value:t.model.path_behavior.trigger_condition.load_state,callback:function(e){t.$set(t.model.path_behavior.trigger_condition,"load_state",e)},expression:"model.path_behavior.trigger_condition.load_state"}})],1)])],1)]:t._e(),e("q-item",[e("q-item-section",{staticClass:"full-width"},[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-sm-4 col-md-4 col-lg-4"},[t._v("\n                "+t._s(t.$t("label.remark"))+"\n              ")]),e("q-input",{staticClass:"map_property_input col-sm-8 col-md-8 col-lg-8",staticStyle:{"max-height":"64px"},attrs:{dense:"","hide-bottom-space":"",outlined:"",type:"textarea"},model:{value:t.model.desc,callback:function(e){t.$set(t.model,"desc",e)},expression:"model.desc"}})],1)])],1),e("q-item",[e("div",{staticClass:"row full-width"},[e("div",{staticClass:"text_main_grey_style field_name_align_vcenter col-4"},[t._v("\n              "+t._s(t.$t("label.userDefinedProperty"))+"\n            ")]),e("div",{staticClass:"col-6"},[e("q-table",{staticClass:"no-shadow q-mt-md border_passive_style",staticStyle:{width:"280px"},attrs:{dense:"","hide-bottom":"",columns:t.columns,data:t.userDefineProperties,"row-key":"name",color:"primary",separator:"cell","table-class":"no-scroll text_main_grey_style",pagination:t.pagination,selection:"multiple",selected:t.selectedProperty},on:{"update:pagination":function(e){t.pagination=e},"update:selected":function(e){t.selectedProperty=e}}}),e("div",{staticClass:"flex justify-end q-mt-md"},[e("q-btn",{staticClass:"no-shadow q-ml-lg q-mt-md",staticStyle:{height:"32px"},attrs:{outline:"",unelevated:"","no-caps":"",label:t.$t("button.newAdd"),color:"primary",size:"sm"},on:{click:t.onAddUserDefinedProperty}}),e("q-btn",{staticClass:"background_red no-shadow q-ml-lg q-mt-md text_main_white_style",staticStyle:{height:"32px"},attrs:{"no-caps":"",unelevated:"",label:t.$t("button.delete"),size:"sm",disable:t.selectedProperty.length<=0},on:{click:t.onDeleteProperty}})],1)],1)])])],2),e("div",{staticClass:"q-my-md q-mr-md float-right"},[e("choice-buttons",{attrs:{"label-okay":t.$t("button.save")},on:{okay:t.onSaved,cancel:t.onClosed}})],1)],1):t._e()]),e("add-property",{ref:"addPropertyDlg",on:{add:t.onAddProperty}})],1)},[],!1,null,"337098a3",null);e.a=v.exports;y()(v,"components",{QDialog:l.a,QCard:c.a,QList:d.a,QItem:h.a,QItemSection:u.a,QInput:p.a,QSelect:m.a,QTable:f.a,QBtn:g.a})},fbff:function(t,e,i){"use strict";var a={name:"NoMapComponent",data(){return{isUserAccount:this.$store.getters["srp/isUser"]}},methods:{onCreateMap(){this.$emit("createMap",!0)},onImportMap(){this.$emit("importMap",!0)}}},s=(i("e1c3"),i("2877")),n=i("9c40"),o=i("0016"),r=i("eebe"),l=i.n(r),c=Object(s.a)(a,function(){var t=this,e=t._self._c;return e("div",{staticClass:"absolute-center"},[e("q-btn",{staticClass:"no-border no-pointer-events",attrs:{"no-caps":"",unelevated:""}},[e("q-icon",{staticClass:"std_no_map",staticStyle:{width:"240px",height:"240px"}})],1),e("div",{staticClass:"text_large_dark text-center q-mt-lg"},[t._v(t._s(t.$t("text.noMapExist")))]),t.isUserAccount?t._e():e("div",{staticClass:"row justify-center q-mt-md"},[e("q-btn",{staticClass:"button_style no-shadow",attrs:{"no-caps":"",unelevated:"",dense:"",color:"primary"},on:{click:t.onCreateMap}},[e("q-icon",{staticClass:"std_add_white"}),e("div",{staticClass:"text_small_white_style q-ml-sm"},[t._v("\n        "+t._s(t.$t("button.create")+t.$t("label.mapPage"))+"\n      ")])],1),e("q-btn",{staticClass:"q-ml-sm button_style no-shadow",attrs:{"no-caps":"",unelevated:"",dense:"",color:"primary"},on:{click:t.onImportMap}},[e("q-icon",{staticClass:"std_upload_white"}),e("div",{staticClass:"text_small_white_style q-ml-sm"},[t._v("\n        "+t._s(t.$t("button.import")+t.$t("label.mapPage"))+"\n      ")])],1)],1)],1)},[],!1,null,"cbd94b0e",null);e.a=c.exports;l()(c,"components",{QBtn:n.a,QIcon:o.a})}}]);