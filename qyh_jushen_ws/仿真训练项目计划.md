# å…·èº«æ™ºèƒ½ä»¿çœŸè®­ç»ƒé¡¹ç›® - å®Œæ•´å®æ–½è®¡åˆ’

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**ç›®æ ‡**ï¼šé€šè¿‡Gazeboä»¿çœŸå®ç°åŒ7è½´æœºæ¢°è‡‚æ¨¡ä»¿å­¦ä¹ è®­ç»ƒ
- ä»»åŠ¡ï¼šæŠ“å–é›¶ä»¶ â†’ è°ƒæ•´å§¿æ€ â†’ å£æœä¸Šæ”¾ç½®åˆ°ç›®æ ‡åŒºåŸŸ
- æ–¹æ³•ï¼šMobile ALOHAçš„ACT/ACT++ç®—æ³•
- ä¼˜åŠ¿ï¼šæ— éœ€å®ä½“ç¡¬ä»¶å³å¯å¼€å§‹æ¨¡å‹è®­ç»ƒ

## ğŸ¯ å…­ä¸ªé˜¶æ®µå®æ–½è®¡åˆ’

### âœ… é˜¶æ®µä¸€ï¼šä»¿çœŸç¯å¢ƒæ­å»ºï¼ˆå·²å®Œæˆï¼‰

**æˆæœ**ï¼š
- âœ… åˆ›å»º`sim_training_env` ROS2åŒ…
- âœ… ç¼–å†™Gazebo worldæ–‡ä»¶ï¼ˆåŒ…å«æ¡Œå­ã€é›¶ä»¶ã€ç›®æ ‡åŒºåŸŸï¼‰
- âœ… åˆ›å»ºlaunchæ–‡ä»¶
- âœ… ç¼–å†™å®Œæ•´é¡¹ç›®æ–‡æ¡£

**éªŒè¯æ–¹æ³•**ï¼š
```bash
cd ~/qyh_jushen_ws/qyh_jushen_ws
colcon build --packages-select sim_training_env
source install/setup.bash
ros2 launch sim_training_env training_sim.launch.py
```

**é¢„æœŸç»“æœ**ï¼šGazeboæ‰“å¼€ï¼Œæ˜¾ç¤ºåŒè‡‚æœºå™¨äººã€æ¡Œå­å’Œçº¢è‰²é›¶ä»¶

---

### ğŸ”„ é˜¶æ®µäºŒï¼šé…ç½®æœºæ¢°è‡‚æ§åˆ¶ï¼ˆè¿›è¡Œä¸­ï¼‰

**ç›®æ ‡**ï¼šè®©ä»¿çœŸä¸­çš„æœºæ¢°è‡‚å¯ä»¥æ¥æ”¶å’Œæ‰§è¡Œè¿åŠ¨å‘½ä»¤

**ä»»åŠ¡æ¸…å•**ï¼š
1. [ ] æ£€æŸ¥`Dual-Arms-gazebo.urdf`æ˜¯å¦åŒ…å«Gazeboæ’ä»¶
2. [ ] æ·»åŠ `gazebo_ros2_control`æ’ä»¶åˆ°URDF
3. [ ] é…ç½®`joint_trajectory_controller`
4. [ ] æµ‹è¯•å…³èŠ‚æ§åˆ¶å‘½ä»¤

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶**ï¼š
```
qyh_jushen_ws/src/Dual-Arms/urdf/Dual-Arms-gazebo.urdf
qyh_jushen_ws/src/Dual-Arms/config/dual_arms_controllers.yaml
```

**æµ‹è¯•å‘½ä»¤**ï¼š
```bash
# å¯åŠ¨ä»¿çœŸ
ros2 launch sim_training_env training_sim.launch.py

# å¦ä¸€ä¸ªç»ˆç«¯ï¼šæŸ¥çœ‹å¯ç”¨æ§åˆ¶å™¨
ros2 control list_controllers

# å‘é€æµ‹è¯•è½¨è¿¹
ros2 topic pub /right_arm_controller/joint_trajectory ...
```

---

### â³ é˜¶æ®µä¸‰ï¼šTeleoperationæ§åˆ¶

**ç›®æ ‡**ï¼šå®ç°äººç±»ç¤ºæ•™æ§åˆ¶ç•Œé¢

**æ–¹æ¡ˆA - é”®ç›˜æ§åˆ¶**ï¼ˆç®€å•å¿«é€Ÿï¼‰ï¼š
```python
# scripts/teleop_keyboard.py
æŒ‰é”®æ˜ å°„ï¼š
- WASD: æ§åˆ¶æœ«ç«¯XY
- QE: æ§åˆ¶æœ«ç«¯Z
- IJKL: è°ƒæ•´å§¿æ€
- ç©ºæ ¼: åˆ‡æ¢å·¦å³è‡‚
- G: å¤¹çˆªå¼€åˆ
- R: å¼€å§‹/åœæ­¢å½•åˆ¶
```

**æ–¹æ¡ˆB - RVizæ’ä»¶**ï¼ˆå¯è§†åŒ–æ›´å¥½ï¼‰ï¼š
- ä½¿ç”¨MoveIt2çš„äº¤äº’å¼marker
- æ‹–åŠ¨æœ«ç«¯æ‰§è¡Œå™¨åˆ°ç›®æ ‡ä½ç½®
- åŒæ—¶æ˜¾ç¤ºç›¸æœºè§†å›¾

**å…³é”®ä»£ç **ï¼š
```python
# ä¼ªä»£ç ç¤ºä¾‹
while True:
    key = get_keyboard_input()
    if key == 'w':
        target_pose.position.x += 0.01
    # ä½¿ç”¨IKæ±‚è§£ç›®æ ‡å…³èŠ‚è§’åº¦
    joint_angles = solve_ik(target_pose)
    # å‘é€åˆ°æ§åˆ¶å™¨
    send_trajectory(joint_angles)
```

---

### â³ é˜¶æ®µå››ï¼šæ•°æ®å½•åˆ¶ç³»ç»Ÿ

**ç›®æ ‡**ï¼šåŒæ­¥å½•åˆ¶è§†è§‰ã€å…³èŠ‚çŠ¶æ€ç­‰å¤šæ¨¡æ€æ•°æ®

**æ•°æ®æ ¼å¼è®¾è®¡**ï¼š
```
demo_recordings/
â”œâ”€â”€ demo_0001_20251111_143022/
â”‚   â”œâ”€â”€ rgb/
â”‚   â”‚   â”œâ”€â”€ frame_00001.jpg
â”‚   â”‚   â”œâ”€â”€ frame_00002.jpg
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ depth/
â”‚   â”‚   â”œâ”€â”€ frame_00001.png
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ joint_states.json      # æ¯å¸§å…³èŠ‚è§’åº¦
â”‚   â””â”€â”€ meta.yaml              # ä»»åŠ¡ä¿¡æ¯ã€æˆåŠŸæ ‡æ³¨
â”œâ”€â”€ demo_0002_.../
â””â”€â”€ ...
```

**å½•åˆ¶èŠ‚ç‚¹åŠŸèƒ½**ï¼š
```python
class DataRecorder(Node):
    def __init__(self):
        # è®¢é˜…è¯é¢˜
        self.rgb_sub = self.create_subscription(Image, '/camera/rgb', ...)
        self.depth_sub = self.create_subscription(Image, '/camera/depth', ...)
        self.joint_sub = self.create_subscription(JointState, '/joint_states', ...)
    
    def start_recording(self):
        # æ¸…ç©ºç¼“å†²åŒºï¼Œå¼€å§‹è®°å½•
        
    def stop_recording(self, success=True):
        # ä¿å­˜æ•°æ®åˆ°ç£ç›˜
```

**å½•åˆ¶æµç¨‹**ï¼š
```bash
# ç»ˆç«¯1: å¯åŠ¨ä»¿çœŸ
ros2 launch sim_training_env training_sim.launch.py

# ç»ˆç«¯2: å¯åŠ¨å½•åˆ¶èŠ‚ç‚¹
ros2 run sim_training_env data_recorder

# ç»ˆç«¯3: æ§åˆ¶æœºæ¢°è‡‚
ros2 run sim_training_env teleop_keyboard

# æ“ä½œæµç¨‹ï¼š
# 1. æŒ‰'R'å¼€å§‹å½•åˆ¶
# 2. æ§åˆ¶æœºæ¢°è‡‚å®Œæˆä»»åŠ¡
# 3. å†æŒ‰'R'ç»“æŸå½•åˆ¶å¹¶ä¿å­˜
# 4. é‡å¤50-100æ¬¡
```

---

### â³ é˜¶æ®µäº”ï¼šæ•°æ®å¤„ç†Pipeline

**ç›®æ ‡**ï¼šå°†å½•åˆ¶æ•°æ®è½¬æ¢ä¸ºACTæ¨¡å‹è®­ç»ƒæ ¼å¼

**è¾“å…¥**ï¼š`demo_0001/`, `demo_0002/`, ...
**è¾“å‡º**ï¼š`dataset.npz`

**æ•°æ®ç»“æ„**ï¼š
```python
dataset = {
    'observations': {
        'images': np.array([N, T, H, W, 3]),  # Nä¸ªdemoï¼Œæ¯ä¸ªTå¸§
        'qpos': np.array([N, T, 14])          # åŒè‡‚å…³èŠ‚ä½ç½®(7+7)
    },
    'actions': np.array([N, T, 14]),          # ä¸‹ä¸€å¸§çš„ç›®æ ‡ä½ç½®
    'episode_ends': [T, 2*T, 3*T, ...]        # æ¯ä¸ªdemoçš„ç»“æŸç´¢å¼•
}
```

**å¤„ç†è„šæœ¬**ï¼š
```python
# scripts/data_processor.py
def process_demo(demo_dir):
    # 1. è¯»å–æ‰€æœ‰å›¾åƒ
    images = load_images(demo_dir + '/rgb/')
    
    # 2. è¯»å–å…³èŠ‚çŠ¶æ€
    with open(demo_dir + '/joint_states.json') as f:
        joints = json.load(f)
    
    # 3. æ—¶é—´å¯¹é½ï¼ˆæ’å€¼ï¼‰
    aligned_data = align_timestamps(images, joints)
    
    # 4. ç”ŸæˆåŠ¨ä½œæ ‡ç­¾ï¼ˆä¸‹ä¸€å¸§çŠ¶æ€ï¼‰
    actions = joints[1:]  # ç®€å•ç‰ˆæœ¬
    
    return {'obs': aligned_data, 'actions': actions}
```

---

### â³ é˜¶æ®µå…­ï¼šACTæ¨¡å‹è®­ç»ƒ

**æ¨¡å‹ç»“æ„**ï¼š
```
è¾“å…¥: [RGBå›¾åƒ(640x480x3), å½“å‰å…³èŠ‚è§’åº¦(14,)]
  â†“
[ResNet18ç¼–ç å™¨] + [å…³èŠ‚ç¼–ç å™¨]
  â†“
[Transformer Encoder (6å±‚)]
  â†“
[Action Chunk Decoder]
  â†“
è¾“å‡º: æœªæ¥Kå¸§çš„åŠ¨ä½œåºåˆ— (K, 14)
```

**è®­ç»ƒè„šæœ¬æ¡†æ¶**ï¼š
```python
# train_act.py
import torch
from torch.utils.data import Dataset, DataLoader

class DemoDataset(Dataset):
    def __init__(self, npz_file):
        data = np.load(npz_file)
        self.images = data['observations/images']
        self.qpos = data['observations/qpos']
        self.actions = data['actions']
    
    def __getitem__(self, idx):
        return {
            'image': self.images[idx],
            'qpos': self.qpos[idx],
            'action': self.actions[idx]
        }

# è®­ç»ƒå¾ªç¯
for epoch in range(1000):
    for batch in dataloader:
        predicted_actions = model(batch['image'], batch['qpos'])
        loss = F.mse_loss(predicted_actions, batch['action'])
        loss.backward()
        optimizer.step()
```

**è®­ç»ƒå‘½ä»¤**ï¼š
```bash
python train_act.py \
    --data dataset.npz \
    --epochs 1000 \
    --lr 1e-4 \
    --chunk_size 20 \
    --hidden_dim 512
```

---

## ğŸ“Š æ—¶é—´çº¿ä¼°è®¡

| é˜¶æ®µ | é¢„è®¡å·¥ä½œé‡ | å…³é”®é‡Œç¨‹ç¢‘ |
|------|-----------|-----------|
| âœ… ä¸€ï¼šç¯å¢ƒæ­å»º | 1å¤© | ä»¿çœŸèƒ½æ­£å¸¸å¯åŠ¨ |
| ğŸ”„ äºŒï¼šé…ç½®æ§åˆ¶ | 2-3å¤© | æœºæ¢°è‡‚å“åº”å‘½ä»¤ |
| ä¸‰ï¼šTeleoperation | 3-5å¤© | èƒ½é¡ºç•…ç¤ºæ•™æ“ä½œ |
| å››ï¼šæ•°æ®å½•åˆ¶ | 2å¤© | å½•åˆ¶50+æ¼”ç¤º |
| äº”ï¼šæ•°æ®å¤„ç† | 2å¤© | ç”Ÿæˆè®­ç»ƒæ•°æ®é›† |
| å…­ï¼šæ¨¡å‹è®­ç»ƒ | 5-7å¤© | æ¨¡å‹æ”¶æ•›ï¼ŒæˆåŠŸç‡>70% |

**æ€»è®¡**ï¼šçº¦3-4å‘¨å®Œæˆæ•´ä¸ªpipeline

---

## ğŸš€ å¿«é€Ÿå¼€å§‹æ¸…å•

### ä»Šå¤©è¦åšçš„äº‹ï¼š

1. **ç¼–è¯‘sim_training_envåŒ…**
```bash
cd ~/qyh_jushen_ws/qyh_jushen_ws
colcon build --packages-select sim_training_env
source install/setup.bash
```

2. **æµ‹è¯•ä»¿çœŸå¯åŠ¨**
```bash
ros2 launch sim_training_env training_sim.launch.py
# é¢„æœŸï¼šGazeboæ‰“å¼€ï¼Œçœ‹åˆ°æœºå™¨äººå’Œåœºæ™¯
```

3. **æ£€æŸ¥Dual-Arms URDF**
```bash
# æŸ¥çœ‹æ˜¯å¦æœ‰Gazeboæ’ä»¶
grep -n "gazebo_ros2_control" qyh_jushen_ws/src/Dual-Arms/urdf/Dual-Arms-gazebo.urdf
```

4. **å¦‚æœç¼ºå°‘æ’ä»¶ï¼Œéœ€è¦æ·»åŠ **
   - å‚è€ƒMobile ALOHAçš„URDFé…ç½®
   - æ·»åŠ `<gazebo>`æ ‡ç­¾å’Œ`<plugin>`

---

## ğŸ“š å‚è€ƒèµ„æº

- **Mobile ALOHAè®ºæ–‡**: https://arxiv.org/abs/2401.02117
- **ALOHAå®˜ç½‘**: https://tonyzhaozh.github.io/aloha/
- **ACTä»£ç **: https://github.com/tonyzhaozh/act
- **AgileXä»¿çœŸç¤ºä¾‹**: https://github.com/agilexrobotics/mobile_aloha_sim

---

## â“ å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨çœŸå®æ‘„åƒå¤´ï¼Ÿ**
A: ä»¿çœŸå¯ä»¥å¿«é€Ÿè¿­ä»£ï¼ŒéªŒè¯ç®—æ³•å¯è¡Œæ€§ï¼Œä¸”æˆæœ¬ä¸ºé›¶ã€‚ç®—æ³•éªŒè¯åå†è½¬å®æœºã€‚

**Q: éœ€è¦å¤šå°‘æ¼”ç¤ºæ•°æ®ï¼Ÿ**
A: ACTè®ºæ–‡ä¸­ï¼Œ50æ¡æ¼”ç¤ºå³å¯è¾¾åˆ°ä¸é”™æ•ˆæœï¼›100æ¡ä»¥ä¸Šä¼šæ›´ç¨³å®šã€‚

**Q: è®­ç»ƒéœ€è¦ä»€ä¹ˆç¡¬ä»¶ï¼Ÿ**
A: æœ€ä½ï¼š8GB GPUï¼ˆå¦‚RTX 3060ï¼‰ï¼›æ¨èï¼š16GB+ GPUï¼ˆå¦‚RTX 4080ï¼‰

**Q: ä»¿çœŸè®­ç»ƒçš„æ¨¡å‹èƒ½ç›´æ¥ç”¨åˆ°å®æœºå—ï¼Ÿ**
A: éœ€è¦sim-to-realè¿ç§»ã€‚å»ºè®®ï¼š
   1. ä»¿çœŸä¸­åŠ domain randomization
   2. ç”¨å°‘é‡å®æœºæ•°æ®fine-tune
   3. æˆ–é‡‡ç”¨co-trainingï¼ˆä»¿çœŸ+å®æœºæ•°æ®æ··åˆï¼‰

---

## ğŸ“ å¼€å‘æ—¥å¿—

### 2025-11-11
- âœ… åˆ›å»ºsim_training_envåŒ…ç»“æ„
- âœ… ç¼–å†™Gazebo worldæ–‡ä»¶
- âœ… åˆ›å»ºtraining_sim.launch.py
- âœ… ç¼–å†™å®Œæ•´é¡¹ç›®æ–‡æ¡£
- ğŸ”„ ä¸‹ä¸€æ­¥ï¼šæµ‹è¯•ä»¿çœŸå¯åŠ¨ï¼Œé…ç½®æ§åˆ¶å™¨

---

**é¡¹ç›®ä½ç½®**: `~/qyh_jushen_ws/qyh_jushen_ws/src/sim_training_env/`
**è¯¦ç»†æ–‡æ¡£**: è§`sim_training_env/README.md`
