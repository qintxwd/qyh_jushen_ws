# GUI关节控制程序使用说明

## 界面预览

这是一个可视化的双臂机器人关节控制GUI程序，提供：

- ✅ 左臂7个关节的独立控制
- ✅ 右臂7个关节的独立控制  
- ✅ 每个关节的增加/减小按钮
- ✅ 滑动条直观控制
- ✅ 实时显示角度（度和弧度）
- ✅ 快捷复位功能
- ✅ 系统状态显示
- ✅ 运动参数配置

## 依赖安装

首先安装PyQt5：

```bash
pip install PyQt5
```

或使用conda：

```bash
conda install pyqt
```

## 启动步骤

### 1. 启动机器人节点

首先在一个终端启动JAKA机器人控制节点：

```bash
cd ~/qyh_jushen_ws
source install/setup.bash
ros2 launch jaka_control jaka_robot.launch.py
```

### 2. 启动GUI程序

在另一个终端启动GUI：

```bash
cd ~/qyh_jushen_ws
source install/setup.bash
cd src/jaka_control/scripts
chmod +x gui_joint_control.py
python3 gui_joint_control.py
```

或者直接运行：

```bash
python3 ~/qyh_jushen_ws/src/jaka_control/scripts/gui_joint_control.py
```

## 使用方法

### 基本操作流程

1. **检查连接状态**
   - 界面顶部会显示"✓ 已连接"（绿色）或"✗ 服务未就绪"（红色）
   - 确保状态为"已连接"

2. **初始化机器人**
   - 点击"清除错误"按钮
   - 点击"上电"按钮，等待2秒
   - 点击"使能"按钮

3. **选择控制目标**
   - 使用下拉菜单选择：
     - "左臂 (LEFT)" - 只控制左臂
     - "右臂 (RIGHT)" - 只控制右臂
     - "双臂 (DUAL)" - 同时控制两个臂

4. **调整关节角度**
   
   **方法1: 使用按钮**
   - 点击"◀"减小角度（每次-5°）
   - 点击"▶"增加角度（每次+5°）
   - 点击"⟲"快速复位到0°
   
   **方法2: 使用滑动条**
   - 拖动滑动条直接设置角度
   - 范围：-180° 到 +180°
   
   **方法3: 显示区域**
   - 左侧显示当前角度（度）
   - 右侧显示当前角度（弧度）

5. **配置运动参数**
   - 速度：0.1 ~ 2.0 rad/s（默认0.5）
   - 加速度：0.1 ~ 3.0 rad/s²（默认1.0）

6. **执行运动**
   - 点击"🚀 执行运动"按钮
   - 系统会发送14个关节值到机器人
   - 弹窗显示详细的运动信息

### 快捷操作

- **全部复位**: 将所有关节角度设置为0°
- **回到初始位置**: 复位所有关节并执行运动

## 界面说明

### 顶部控制面板

```
┌─────────────┬──────────────┬─────────────────┐
│  系统状态   │  控制目标     │   系统控制       │
│  ✓ 已连接   │ [左臂▼]      │ [清除错误] [上电] [使能] │
└─────────────┴──────────────┴─────────────────┘
```

### 左臂控制区域

```
左臂 (Left Arm)
┌──────────────────────────────────────────────┐
│ 关节1: [◀] ========●======= [▶]  45.00°  0.785rad [⟲] │
│ 关节2: [◀] ========●======= [▶]   0.00°  0.000rad [⟲] │
│ 关节3: [◀] ========●======= [▶] -30.00° -0.524rad [⟲] │
│ 关节4: [◀] ========●======= [▶]  90.00°  1.571rad [⟲] │
│ 关节5: [◀] ========●======= [▶]   0.00°  0.000rad [⟲] │
│ 关节6: [◀] ========●======= [▶]   0.00°  0.000rad [⟲] │
│ 关节7: [◀] ========●======= [▶]   0.00°  0.000rad [⟲] │
└──────────────────────────────────────────────┘
```

### 右臂控制区域

（布局与左臂相同）

### 底部操作面板

```
┌─────────────────┬──────────────────────────────────┐
│  快捷操作        │      运动控制                     │
│ [全部复位]       │ 速度: [0.50] 加速度: [1.00]       │
│ [回到初始位置]   │         [🚀 执行运动]             │
└─────────────────┴──────────────────────────────────┘
```

## 功能特点

### 1. 双臂独立控制
- 左臂和右臂各有7个关节的独立控制界面
- 可以同时调整两个臂的姿态
- 支持单臂或双臂运动模式

### 2. 实时角度显示
- 度数显示：直观的角度值
- 弧度显示：与ROS通信的实际值
- 滑动条刻度：30°间隔标记

### 3. 多种控制方式
- 按钮控制：精确的5°步进
- 滑动条：连续调整
- 快速复位：一键归零

### 4. 安全提示
- 服务状态实时监控
- 操作确认提示
- 运动参数显示

### 5. 颜色编码
- 🔴 红色：减小按钮
- 🟢 绿色：增加按钮
- 🟠 橙色：复位按钮
- 🟦 蓝色：执行运动按钮

## 示例操作场景

### 场景1：控制左臂到指定姿态

1. 选择"左臂 (LEFT)"
2. 调整左臂各关节：
   - 关节1: 0°
   - 关节2: 30°
   - 关节3: 0°
   - 关节4: -90°
   - 关节5: 0°
   - 关节6: -30°
   - 关节7: 0°
3. 右臂保持零位（默认）
4. 设置速度: 0.3 rad/s
5. 点击"🚀 执行运动"

### 场景2：双臂镜像运动

1. 选择"双臂 (DUAL)"
2. 左臂设置：关节2 = 45°, 关节4 = -60°
3. 右臂设置：关节2 = 45°, 关节4 = -60°（相同值）
4. 点击"🚀 执行运动"
5. 两个臂将同步运动到相同姿态

### 场景3：微调单个关节

1. 选择目标机械臂
2. 使用"◀"和"▶"按钮微调特定关节
3. 实时观察角度变化
4. 满意后点击"🚀 执行运动"

## 故障排除

### 问题1: 窗口显示"✗ 服务未就绪"

**原因**: 机器人节点未启动或服务未就绪

**解决**:
```bash
# 检查节点是否运行
ros2 node list | grep jaka

# 检查服务是否存在
ros2 service list | grep move_j

# 重启机器人节点
ros2 launch jaka_control jaka_robot.launch.py
```

### 问题2: 点击"执行运动"无反应

**原因**: 机器人未上电或未使能

**解决**:
1. 先点击"清除错误"
2. 点击"上电"，等待2秒
3. 点击"使能"
4. 再执行运动

### 问题3: PyQt5 导入错误

**原因**: PyQt5未安装

**解决**:
```bash
pip install PyQt5
# 或
conda install pyqt
```

### 问题4: 运动后机器人没有响应

**检查**:
- 机器人是否处于使能状态
- IP地址配置是否正确
- 检查launch文件的robot_ip参数
- 查看机器人节点的日志输出

## 技术说明

### 数据格式

GUI内部维护14个关节值：
```python
joint_positions = [
    # 左臂 (索引 0-6)
    left_j1, left_j2, left_j3, left_j4, left_j5, left_j6, left_j7,
    # 右臂 (索引 7-13)
    right_j1, right_j2, right_j3, right_j4, right_j5, right_j6, right_j7
]
```

### ROS服务调用

```python
request = MoveJ.Request()
request.robot_id = robot_id  # 0=LEFT, 1=RIGHT, -1=DUAL
request.joint_positions = [14个浮点数]  # 弧度
request.move_mode = False  # 绝对运动
request.velocity = 0.5  # rad/s
request.acceleration = 1.0  # rad/s²
request.is_block = False  # 非阻塞
```

### 角度范围限制

- 滑动条范围: -180° ~ +180°
- 实际机器人关节限位以硬件为准
- 建议在安全范围内操作

## 未来改进

可以考虑添加的功能：

- [ ] 位姿保存/加载功能
- [ ] 轨迹录制/回放
- [ ] 关节角度曲线显示
- [ ] 笛卡尔坐标控制
- [ ] 碰撞检测可视化
- [ ] 3D机器人模型显示
- [ ] 实时关节角度反馈（从机器人读取）
- [ ] 运动速度实时调整
- [ ] 急停按钮

## 注意事项

⚠️ **安全警告**:

1. **首次使用前请确保**：
   - 机器人周围无人员或障碍物
   - 急停按钮触手可及
   - 了解机器人的工作空间范围

2. **操作时注意**：
   - 从小角度开始测试
   - 使用较低的速度和加速度
   - 观察机器人运动轨迹
   - 发现异常立即按下急停

3. **调试建议**：
   - 先在仿真环境测试
   - 确认角度值合理后再发送到真实机器人
   - 记录常用的安全位姿

## 联系与支持

如有问题或建议，请查看项目文档：
- `README.md` - 总体说明
- `QUICK_START.md` - 快速开始
- `IMPORTANT_NOTE.md` - 14个关节值的重要说明

祝使用愉快！🤖
