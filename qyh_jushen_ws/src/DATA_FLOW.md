# VRåŒè‡‚é¥æ“ä½œç³»ç»Ÿ - æ•°æ®æµä¸çŠ¶æ€æ–‡æ¡£

## ğŸ“‹ ç³»ç»Ÿæ¦‚è§ˆ

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°VRé¥æ“ä½œç³»ç»Ÿä¸­æ‰€æœ‰èŠ‚ç‚¹ã€è¯é¢˜ã€TFå˜æ¢å’Œæ•°æ®æµå‘ï¼Œå¹¶æ ‡æ³¨å½“å‰å®ç°çŠ¶æ€ã€‚

**çŠ¶æ€å›¾ä¾‹ï¼š**
- âœ… **å·²å®ç°**ï¼šç‹¬ç«‹åŒ…å·²åˆ›å»ºï¼ŒåŠŸèƒ½å·²å°±ç»ª
- âš ï¸ **éƒ¨åˆ†å®ç°/å¾…è¿ç§»**ï¼šåŠŸèƒ½å­˜åœ¨äºæ—§åŒ…ä¸­ï¼Œéœ€è¦è¿ç§»æˆ–é‡æ„
- âŒ **æœªå®ç°**ï¼šå°šæœªåˆ›å»º

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           PICO4 VR è®¾å¤‡                                  â”‚
â”‚                     (60-100Hz, UDPæ•°æ®åŒ…)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ UDP 10000
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [èŠ‚ç‚¹1] vr_bridge_node                                      âœ… å·²å®ç°   â”‚
â”‚  - åŒ…å: qyh_vr_bridge                                                   â”‚
â”‚  - æ¥æ”¶VR UDPæ•°æ®                                                        â”‚
â”‚  - â­åº•å±‚åæ ‡å¯¹é½: PICO [Xå³Yä¸Š-Zå‰] â†’ ROS [Xå‰Yå·¦Zä¸Š]                 â”‚
â”‚  - è¾“å‡ºå·²ç»æ˜¯ROSæ ‡å‡†åæ ‡ç³»                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                             â”‚
                â†“ TF                          â†“ Topics
    vr_origin â†’ vr_head                    /vr/head/pose
    vr_origin â†’ vr_left_controller        /vr/left_controller/pose
    vr_origin â†’ vr_right_controller       /vr/right_controller/pose
                â”‚                          /vr/left_controller/joy
                â”‚                          /vr/right_controller/joy
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [èŠ‚ç‚¹2] teleop_manager_node                                 âš ï¸ å¾…è¿ç§»   â”‚
â”‚  - åŒ…å: qyh_teleop_manager (ç›®å‰åœ¨ qyh_dual_arm_teleop)                 â”‚
â”‚  - é›¶ä½æ ¡å‡†ç®¡ç†                                                          â”‚
â”‚  - é¥æ“ä½œçŠ¶æ€æ§åˆ¶                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                             â”‚
                â†“ TF                          â†“ Services
    base_link â†’ teleop_base                /teleop/start
    teleop_base â†’ vr_origin                /teleop/stop
                â”‚                          /teleop/recenter
                â”‚                             â”‚
                â†“                             â†“ Topics
                                           /teleop/status
                                              
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [èŠ‚ç‚¹3] coordinate_mapper_node                              âœ… å·²å®ç°   â”‚
â”‚  - åŒ…å: qyh_dual_arm_teleop                                             â”‚
â”‚  - æ¡æŒè¡¥å¿ï¼ˆ35Â°pitchï¼‰                                                 â”‚
â”‚  - ä½é€šæ»¤æ³¢ (EMA + Slerp)                                               â”‚
â”‚  - é€Ÿåº¦/åŠ é€Ÿåº¦é™åˆ¶                                                       â”‚
â”‚  - ä½ç½®ç¼©æ”¾ (2.0x)                                                      â”‚
â”‚  - â­ è¾“å‡ºåæ ‡ç³»: vr_origin (äººä½“è¯­ä¹‰ç©ºé—´)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                             â”‚
                â†“ TF (100Hz)                  â†“ Topics (100Hz)
    vr_left_controller â†’              /teleop/left_hand/target
        human_left_hand               (geometry_msgs/PoseStamped)
    vr_right_controller â†’             frame_id: "vr_origin" â­
        human_right_hand              /teleop/right_hand/target
                â”‚                     frame_id: "vr_origin" â­
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [èŠ‚ç‚¹4] dual_arm_ik_solver_node                             âœ… å·²å®ç°   â”‚
â”‚  - åŒ…å: qyh_dual_arm_ik_solver                                          â”‚
â”‚  - è®¢é˜…ç›®æ ‡ä½å§¿ (frame_id="vr_origin")                                 â”‚
â”‚  - â­ TFè½¬æ¢: vr_origin â†’ base_link_left/right                          â”‚
â”‚  - â­ æœ«ç«¯åæ ‡ç³»æ ¡æ­£: human_hand [Xå‰] â†’ lt/rt [Xå·¦]                   â”‚
â”‚  - é«˜é¢‘IKæ±‚è§£ (125Hz, JAKA SDK)                                        â”‚
â”‚  - âœ… å…³èŠ‚é™ä½æ£€æŸ¥ï¼ˆÂ±5Â°è£•åº¦ï¼‰                                           â”‚
â”‚  - âœ… å…³èŠ‚é€Ÿåº¦æ£€æŸ¥ï¼ˆ80%é™åˆ¶ï¼‰                                           â”‚
â”‚  - ä½¿ç”¨å½“å‰å…³èŠ‚çŠ¶æ€ä½œä¸ºIKå‚è€ƒ                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                             â”‚
                â†“ Topics (125Hz)              â†“ Status
    /left_arm/joint_command            /ik_solver/status
    (sensor_msgs/JointState)           (std_msgs/Bool)
    /right_arm/joint_command
    (sensor_msgs/JointState)
                â”‚
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [èŠ‚ç‚¹5] qyh_jaka_control                                    âœ… å·²å®ç°   â”‚
â”‚  - åŒ…å: qyh_jaka_control                                                â”‚
â”‚  - è®¢é˜…å…³èŠ‚æŒ‡ä»¤                                                          â”‚
â”‚  - ä¼ºæœæ§åˆ¶ (125Hz)                                                     â”‚
â”‚  - å®‰å…¨æ£€æŸ¥                                                              â”‚
â”‚  - å‘å¸ƒæœºæ¢°è‡‚çŠ¶æ€                                                        â”‚
â”‚  - â­ å¿…é¡»é…åˆ robot_state_publisher å¯åŠ¨                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                             â”‚
                â†“ TF (å®æ—¶)                   â†“ Topics
    base_link â†’ base_link_left          /joint_states
    (é€šè¿‡URDFå‘å¸ƒï¼Œé™æ€å˜æ¢) â­         (sensor_msgs/JointState)
    base_link â†’ base_link_right         /robot_status
    (é€šè¿‡URDFå‘å¸ƒï¼Œé™æ€å˜æ¢) â­
    base_link_left â†’ l1 â†’ ... â†’ lt
    (é€šè¿‡robot_state_publisheråŠ¨æ€å‘å¸ƒ)
    base_link_right â†’ r1 â†’ ... â†’ rt
    (é€šè¿‡robot_state_publisheråŠ¨æ€å‘å¸ƒ)
                â”‚
                â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  JAKA Zu7æ§åˆ¶å™¨â”‚
        â”‚ 192.168.2.200  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   æœºæ¢°è‡‚è¿åŠ¨   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š èŠ‚ç‚¹çŠ¶æ€è¯¦ç»†è¯´æ˜

### 1ï¸âƒ£ VR Bridge Node (âœ… å·²å®ç°)
- **åŒ…å**: `qyh_vr_bridge`
- **çŠ¶æ€**: ç‹¬ç«‹åŒ…å·²å­˜åœ¨ï¼ŒåŠŸèƒ½å®Œæ•´ã€‚
- **åŠŸèƒ½**: æ¥æ”¶PICO4 UDPæ•°æ®ï¼Œå‘å¸ƒåŸå§‹TFå’ŒTopicã€‚

### 2ï¸âƒ£ Teleop Manager Node (âš ï¸ å¾…è¿ç§»)
- **åŒ…å**: `qyh_teleop_manager` (è®¡åˆ’ä¸­)
- **å½“å‰çŠ¶æ€**: åŠŸèƒ½ä»£ç å­˜åœ¨äºæ—§åŒ… `qyh_dual_arm_teleop` ä¸­ã€‚
- **ä»»åŠ¡**: éœ€è¦å°† `teleop_manager_node` æå–ä¸ºç‹¬ç«‹åŒ…ï¼Œæˆ–é‡æ„ `qyh_dual_arm_teleop`ã€‚
- **åŠŸèƒ½**: ç®¡ç†é¥æ“ä½œçŠ¶æ€ï¼ˆå¼€å§‹/åœæ­¢ï¼‰ï¼Œå¤„ç†é›¶ä½æ ¡å‡†ï¼ˆå‘å¸ƒ `teleop_base â†’ vr_origin` TFï¼‰ã€‚

### 3ï¸âƒ£ Coordinate Mapper Node (âœ… å·²å®ç°)
- **åŒ…å**: `qyh_dual_arm_teleop`ï¼ˆcoordinate_mapper_node.cppï¼‰
- **çŠ¶æ€**: å·²å®ç°ï¼ŒåŠŸèƒ½å®Œæ•´ã€‚
- **åŠŸèƒ½**: æ ¸å¿ƒæ•°æ®å¤„ç†ã€‚æ¥æ”¶å·²å¯¹é½çš„ROSåæ ‡ â†’ æ¡æŒè¡¥å¿ï¼ˆ35Â°pitchï¼‰â†’ æ»¤æ³¢ â†’ é€Ÿåº¦é™åˆ¶ â†’ ç¼©æ”¾ï¼ˆ2.0xï¼‰ã€‚
- **âš ï¸ é‡è¦**: vr_bridgeå·²å®ŒæˆPICOâ†’ROSåæ ‡å¯¹é½ï¼Œæ­¤èŠ‚ç‚¹æ¥æ”¶çš„æ˜¯ROSæ ‡å‡†åæ ‡ã€‚

### 4ï¸âƒ£ Dual Arm IK Solver Node (âœ… å·²å®ç°)
- **åŒ…å**: `qyh_dual_arm_ik_solver`
- **çŠ¶æ€**: åˆšåˆšåˆ›å»ºï¼ŒåŠŸèƒ½å®Œæ•´ã€‚
- **åŠŸèƒ½**: ä½œä¸ºç¬¬äºŒå®¢æˆ·ç«¯è¿æ¥JAKAï¼Œè¿›è¡Œé«˜é¢‘IKæ±‚è§£ã€‚

### 5ï¸âƒ£ Arm Controller Node (âœ… å·²å®ç°)
- **åŒ…å**: `qyh_jaka_control`
- **çŠ¶æ€**: å·²å­˜åœ¨ï¼ŒåŠŸèƒ½å®Œæ•´ã€‚
- **åŠŸèƒ½**: ä¸»æ§åˆ¶èŠ‚ç‚¹ï¼Œè´Ÿè´£åº•å±‚ä¼ºæœé€šä¿¡ã€‚
- **â­ é‡è¦ä¾èµ–**: å¿…é¡»åŒæ—¶å¯åŠ¨ `robot_state_publisher` å‘å¸ƒæœºæ¢°è‡‚TFæ ‘
  - **URDFæ–‡ä»¶**: å®šä¹‰äº† `base_link â†’ base_link_left/right` çš„é™æ€å˜æ¢ï¼ˆåŒ…å«æ ¡å‡†åç§»ï¼‰
  - **robot_state_publisher**: æ ¹æ® `/joint_states` å‘å¸ƒå®Œæ•´çš„æœºæ¢°è‡‚è¿åŠ¨å­¦TFæ ‘
  - **æ²¡æœ‰è¿™äº›TF**: IKæ±‚è§£å™¨æ— æ³•è¿›è¡Œåæ ‡è½¬æ¢ï¼Œç³»ç»Ÿå°†æ— æ³•å·¥ä½œ

---

## ğŸ”„ å®Œæ•´æ•°æ®æµæ—¶åºå›¾

```
æ—¶é—´è½´ â†’

T0: VRæ‰‹æŸ„ç§»åŠ¨
    â”‚
    â†“ (10ms, 100Hz)
T1: [vr_bridge] æ¥æ”¶UDPæ•°æ®
    â”‚ - è§£æä½å§¿
    â”‚ - åæ ‡è½¬æ¢ (PICO â†’ ROS)
    â”‚ - å‘å¸ƒTF: vr_origin â†’ vr_left_controller
    â”‚ - å‘å¸ƒTopic: /vr/left_controller/pose
    â”‚
    â†“ (0ms, TFç«‹å³å¯ç”¨)
T2: [coordinate_mapper] æŸ¥è¯¢TF
    â”‚ - è½´å¯¹é½: VR â†’ äººæ‰‹è¯­ä¹‰
    â”‚ - ä½é€šæ»¤æ³¢ (alpha=0.3, ~3å¸§å¹³å‡)
    â”‚ - é€Ÿåº¦é™åˆ¶ (0.5 m/s)
    â”‚ - ä½ç½®ç¼©æ”¾ (scale=1.0)
    â”‚ - å‘å¸ƒTF: vr_left_controller â†’ human_left_hand
    â”‚ - å‘å¸ƒTopic: /teleop/left_hand/target
    â”‚
    â†“ (0ms, å›è°ƒè§¦å‘)
T3: [dual_arm_ik_solver] æ¥æ”¶target
    â”‚ - è½¬æ¢å•ä½ (m â†’ mm, quat â†’ euler)
    â”‚ - è°ƒç”¨IK: kine_inverse(0, ref_joints, target_pose)
    â”‚ - æ›´æ–°å‚è€ƒå…³èŠ‚
    â”‚ - å‘å¸ƒTopic: /left_arm/joint_command
    â”‚
    â†“ (0ms, å›è°ƒè§¦å‘)
T4: [qyh_jaka_control] æ¥æ”¶joint_command
    â”‚ - å®‰å…¨æ£€æŸ¥
    â”‚ - è°ƒç”¨servoJ(joint_pos, 0.008)
    â”‚ - å‘é€åˆ°JAKAæ§åˆ¶å™¨
    â”‚
    â†“ (8ms, ä¼ºæœå‘¨æœŸ)
T5: JAKAæ§åˆ¶å™¨æ‰§è¡Œ
    â”‚ - å…³èŠ‚è¿åŠ¨
    â”‚ - æ›´æ–°æœºæ¢°è‡‚çŠ¶æ€
    â”‚
    â†“
T6: æœºæ¢°è‡‚åˆ°è¾¾ç›®æ ‡
```

**æ€»å»¶è¿Ÿä¼°ç®—**ï¼š
- VR â†’ ç½‘ç»œä¼ è¾“: ~5-10ms
- vr_bridgeå¤„ç†: ~1ms
- coordinate_mapperå¤„ç†: ~1ms + æ»¤æ³¢å»¶è¿Ÿ(~30ms)
- IKæ±‚è§£: ~1ms
- JAKAä¼ºæœå“åº”: ~8ms
- **æ€»è®¡**: ~46-56ms (çº¦20-22 Hzç«¯åˆ°ç«¯å»¶è¿Ÿ)

---

## ğŸ“¡ Topicè¯¦ç»†å®šä¹‰

### `/vr/left_controller/pose`
```yaml
type: geometry_msgs/PoseStamped
frame_id: vr_origin
frequency: 60-100 Hz
content:
  position: [x, y, z]  # å·²å¯¹é½åˆ°ROSåæ ‡ç³» [Xå‰, Yå·¦, Zä¸Š]
  orientation: [x, y, z, w]  # å·²å¯¹é½åˆ°ROSåæ ‡ç³» (å››å…ƒæ•°)
processing:
  - âœ… vr_bridgeå·²å®ŒæˆPICOâ†’ROSåæ ‡è½¬æ¢
  - âœ… è¾“å‡ºç¬¦åˆREP-103æ ‡å‡†
```

### `/teleop/left_hand/target`
```yaml
type: geometry_msgs/PoseStamped
frame_id: "vr_origin"  # â­ é‡è¦ï¼šåœ¨VRé›¶ä½åæ ‡ç³»ä¸‹
frequency: 100 Hz
content:
  position: [x, y, z]  # äººæ‰‹è¯­ä¹‰ä½ç½® (å·²æ»¤æ³¢, å·²ç¼©æ”¾, ç±³)
  orientation: [x, y, z, w]  # äººæ‰‹è¯­ä¹‰å§¿æ€ (å·²æ»¤æ³¢, å››å…ƒæ•°)
processing:
  - âœ… åæ ‡è½´å¯¹é½å®Œæˆ (VR â†’ äººæ‰‹è¯­ä¹‰)
  - âœ… ä½é€šæ»¤æ³¢åº”ç”¨ (alpha=0.3)
  - âœ… é€Ÿåº¦é™åˆ¶åº”ç”¨ (0.5 m/s)
  - âœ… å¹³æ»‘ä¸”å®‰å…¨
  - âŒ å°šæœªè½¬æ¢åˆ°æœºå™¨äººåæ ‡ç³» (ç”±IKæ±‚è§£å™¨å®Œæˆ)
note:
  IKæ±‚è§£å™¨éœ€è¦é€šè¿‡TFæŸ¥è¯¢å°†æ­¤ä½å§¿è½¬æ¢åˆ°base_link_left/rightåæ ‡ç³»
```

### `/left_arm/joint_command`
```yaml
type: sensor_msgs/JointState
frequency: 125 Hz
content:
  name: [j1, j2, j3, j4, j5, j6, j7]
  position: [rad, rad, rad, rad, rad, rad, rad]  # 7ä¸ªå…³èŠ‚è§’åº¦
  velocity: []  # å¯é€‰
  effort: []  # å¯é€‰
source: IKæ±‚è§£ç»“æœ
```

### `/joint_states`
```yaml
type: sensor_msgs/JointState
frequency: 125 Hz
content:
  name: [l1, l2, ..., l7, r1, r2, ..., r7]  # åŒè‡‚14ä¸ªå…³èŠ‚
  position: [rad Ã— 14]  # å½“å‰å…³èŠ‚è§’åº¦
  velocity: [rad/s Ã— 14]  # å½“å‰å…³èŠ‚é€Ÿåº¦
  effort: [Nm Ã— 14]  # å½“å‰å…³èŠ‚åŠ›çŸ©
source: JAKAæ§åˆ¶å™¨åé¦ˆ
```

---

## ğŸŒ² TFæ ‘å®Œæ•´ç»“æ„

```
map (å¯é€‰)
â”‚
â””â”€â”€ base_link  â† æœºå™¨äººä¸­å¿ƒ
    â”‚
    â”œâ”€â”€ base_link_left  â† å·¦è‡‚åŸºåº§ (å«æ ¡å‡†åç§»)
    â”‚   â””â”€â”€ l1 â†’ l2 â†’ l3 â†’ l4 â†’ l5 â†’ l6 â†’ l7 â†’ lt
    â”‚       â†‘ å·¦è‡‚å…³èŠ‚é“¾               â†‘ å·¦è‡‚æœ«ç«¯
    â”‚
    â”œâ”€â”€ base_link_right  â† å³è‡‚åŸºåº§ (å«æ ¡å‡†åç§»)
    â”‚   â””â”€â”€ r1 â†’ r2 â†’ r3 â†’ r4 â†’ r5 â†’ r6 â†’ r7 â†’ rt
    â”‚       â†‘ å³è‡‚å…³èŠ‚é“¾               â†‘ å³è‡‚æœ«ç«¯
    â”‚
    â”œâ”€â”€ base_vr  â† VRå‚è€ƒåæ ‡ç³»
    â”‚
    â””â”€â”€ teleop_base  â† äººä½“è¯­ä¹‰åæ ‡ç³» (é™æ€)
        â””â”€â”€ vr_origin  â† VRé›¶ä½ (åŠ¨æ€æ ¡å‡†)
            â”œâ”€â”€ vr_head
            â”‚
            â”œâ”€â”€ vr_left_controller  â† VRå·¦æ‰‹æŸ„åŸå§‹
            â”‚   â””â”€â”€ human_left_hand  â† å·¦æ‰‹è¯­ä¹‰ (æ»¤æ³¢å)
            â”‚
            â””â”€â”€ vr_right_controller  â† VRå³æ‰‹æŸ„åŸå§‹
                â””â”€â”€ human_right_hand  â† å³æ‰‹è¯­ä¹‰ (æ»¤æ³¢å)
```

**TFå‘å¸ƒé¢‘ç‡**ï¼š
- `vr_origin â†’ vr_*_controller`: 60-100 Hz (vr_bridge)
- `vr_*_controller â†’ human_*_hand`: 100 Hz (coordinate_mapper)
- `base_link_* â†’ l1~lt / r1~rt`: 125 Hz (qyh_jaka_control)
- `base_link â†’ teleop_base`: é™æ€
- `teleop_base â†’ vr_origin`: 50 Hz (teleop_manager)

---

## ğŸ”§ å…³é”®å‚æ•°é…ç½®

### coordinate_mapperå‚æ•°
```yaml
update_rate: 100.0        # 100Hzæ•°æ®å¤„ç†
position_scale: 1.0       # ä½ç½®ç¼©æ”¾ (1.0 = æ— ç¼©æ”¾)
rotation_scale: 1.0       # æ—‹è½¬ç¼©æ”¾
filter_alpha: 0.3         # æ»¤æ³¢ç³»æ•° (0.3 = å¹³è¡¡)
max_linear_velocity: 0.5  # æœ€å¤§çº¿é€Ÿåº¦ m/s
max_angular_velocity: 1.0 # æœ€å¤§è§’é€Ÿåº¦ rad/s
enable_filter: true
enable_velocity_limit: true
```

**æ»¤æ³¢æ•ˆæœ**ï¼š
- alpha=0.1: æå¹³æ»‘, å»¶è¿Ÿ~100ms
- alpha=0.3: å¹³è¡¡, å»¶è¿Ÿ~30ms âœ… æ¨è
- alpha=0.5: å¿«é€Ÿ, å»¶è¿Ÿ~10ms
- alpha=1.0: æ— æ»¤æ³¢, æŠ–åŠ¨æ˜æ˜¾

### dual_arm_ik_solverå‚æ•°
```yaml
robot_ip: "192.168.2.200"
ik_rate: 125.0            # 125HzåŒ¹é…ä¼ºæœ
auto_connect: true
use_tf_lookup: false      # ç›´æ¥è®¢é˜…topicæ›´é«˜æ•ˆ
```

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… |
|------|------|------|
| VRæ•°æ®é¢‘ç‡ | 60-100 Hz | å–å†³äºPICO4 |
| åæ ‡æ˜ å°„é¢‘ç‡ | 100 Hz | 100 Hz âœ… |
| IKæ±‚è§£é¢‘ç‡ | 125 Hz | 125 Hz âœ… |
| ä¼ºæœæ§åˆ¶é¢‘ç‡ | 125 Hz | 125 Hz âœ… |
| ç«¯åˆ°ç«¯å»¶è¿Ÿ | <100ms | ~50ms âœ… |
| IKæˆåŠŸç‡ | >95% | >95% (å·¥ä½œç©ºé—´å†…) âœ… |
| CPUå ç”¨ | <50% | å¾…æµ‹è¯• |
| ç½‘ç»œå»¶è¿Ÿ | <10ms | å–å†³äºWiFi |

---

## ğŸš¦ å¯åŠ¨é¡ºåº

```bash
# ç»ˆç«¯1: VRæ•°æ®æ¥æ”¶
ros2 launch qyh_vr_bridge vr_bridge.launch.py

# ç»ˆç«¯2: é¥æ“ä½œç®¡ç†å™¨ + åæ ‡æ˜ å°„
# teleop_manager_node å’Œ coordinate_mapper_node éƒ½åœ¨è¿™ä¸ªåŒ…ä¸­
ros2 launch qyh_dual_arm_teleop teleop.launch.py

# ç»ˆç«¯3: æœºæ¢°è‡‚æ§åˆ¶ (ç¬¬ä¸€JAKAè¿æ¥)
ros2 launch qyh_jaka_control jaka_control.launch.py

# ç»ˆç«¯4: IKæ±‚è§£å™¨ (ç¬¬äºŒJAKAè¿æ¥)
ros2 launch qyh_dual_arm_ik_solver ik_solver.launch.py
```

**å¯åŠ¨é¡ºåºé‡è¦æ€§**ï¼š
1. âœ… vr_bridge å¿…é¡»å…ˆå¯åŠ¨ (æä¾›VR TF)
2. âœ… jaka_control å¿…é¡»åœ¨ik_solverå‰å¯åŠ¨ (å ç”¨ç¬¬ä¸€è¿æ¥)
3. âš ï¸ å…¶ä»–èŠ‚ç‚¹é¡ºåºçµæ´»

---

## ğŸ› è°ƒè¯•å·¥å…·

### æŸ¥çœ‹æ‰€æœ‰è¯é¢˜
```bash
ros2 topic list
```

### ç›‘æ§è¯é¢˜é¢‘ç‡
```bash
ros2 topic hz /teleop/left_hand/target
ros2 topic hz /left_arm/joint_command
```

### æŸ¥çœ‹è¯é¢˜å†…å®¹
```bash
ros2 topic echo /teleop/left_hand/target
```

### æŸ¥çœ‹TFæ ‘
```bash
ros2 run tf2_tools view_frames
# ç”Ÿæˆ frames.pdf
```

### æŸ¥çœ‹ç‰¹å®šTF
```bash
ros2 run tf2_ros tf2_echo vr_origin human_left_hand
```

### RVizå¯è§†åŒ–
```bash
ros2 run rviz2 rviz2
# æ·»åŠ ï¼š
# - TF Display (æ˜¾ç¤ºæ‰€æœ‰åæ ‡ç³»)
# - RobotModel (æ˜¾ç¤ºæœºæ¢°è‡‚)
# - PoseStamped (/teleop/left_hand/target)
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [TF_design.md](TF_design.md) - åæ ‡ç³»è®¾è®¡æ–‡æ¡£ï¼ˆå·²æ›´æ–°vr_bridgeèŒè´£è¯´æ˜ï¼‰
- [IMPLEMENTATION_STATUS.md](IMPLEMENTATION_STATUS.md) - å®Œæ•´å®ç°çŠ¶æ€éªŒè¯æŠ¥å‘Š
- [SAFETY_CHECKS_UPDATE.md](../SAFETY_CHECKS_UPDATE.md) - å®‰å…¨æ£€æŸ¥åŠŸèƒ½æ›´æ–°è¯´æ˜
- [qyh_dual_arm_teleop/README.md](../qyh_jushen_ws/src/qyh_dual_arm_teleop/README.md) - é¥æ“ä½œåŒ…ï¼ˆå«coordinate_mapperï¼‰
- [qyh_dual_arm_ik_solver/README.md](../qyh_jushen_ws/src/qyh_dual_arm_ik_solver/README.md) - IKæ±‚è§£å™¨è¯¦ç»†è¯´æ˜

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å¤šå®¢æˆ·ç«¯è¿æ¥é™åˆ¶
- JAKA SDKæœ€å¤šæ”¯æŒ**2ä¸ªå®¢æˆ·ç«¯**åŒæ—¶è¿æ¥
- å®¢æˆ·ç«¯1: qyh_jaka_control (ä¸»æ§åˆ¶)
- å®¢æˆ·ç«¯2: dual_arm_ik_solver (IKæ±‚è§£)
- âŒ ç¬¬ä¸‰ä¸ªè¿æ¥ä¼šå¤±è´¥

### åæ ‡ç³»æ–¹å‘
- **PICO SDKåŸå§‹**: X-å³, Y-ä¸Š, -Z-å‰ (OpenXRæ ‡å‡†)
- **vr_bridgeè¾“å‡º** (vr_*_controller): X-å‰, Y-å·¦, Z-ä¸Š â­å·²å¯¹é½åˆ°ROS
- **human_*_hand**: X-å‰, Y-å·¦, Z-ä¸Š (ç»æ¡æŒè¡¥å¿+æ»¤æ³¢)
- **æœºæ¢°è‡‚æœ«ç«¯lt/rt**: X-å·¦, Y-ä¸Š, Z-å
- âš ï¸ **coordinate_mapper**: å¤„ç†æ¡æŒè¡¥å¿ã€æ»¤æ³¢ã€ç¼©æ”¾ï¼ˆä¸åšåŸºç¡€åæ ‡å¯¹é½ï¼‰
- âš ï¸ **dual_arm_ik_solver**: åº”ç”¨æœ«ç«¯åæ ‡ç³»æ ¡æ­£ï¼ˆhuman_hand â†’ lt/rt æ—‹è½¬ï¼‰

### é¢‘ç‡åŒ¹é…
- VRæ•°æ®: 60-100 Hz (ä¸å¯æ§)
- coordinate_mapper: 100 Hz (å›ºå®š)
- IKæ±‚è§£: 125 Hz (åŒ¹é…ä¼ºæœ)
- ä¼ºæœæ§åˆ¶: 125 Hz (8mså‘¨æœŸ)
- âœ… é¢‘ç‡é€’å¢ï¼Œç¡®ä¿æ•°æ®æµç•…

### å•ä½è½¬æ¢
- ROSæ ‡å‡†: ç±³(m), å¼§åº¦(rad), å››å…ƒæ•°
- JAKA SDK: æ¯«ç±³(mm), å¼§åº¦(rad), æ¬§æ‹‰è§’(RPY)
- âš ï¸ dual_arm_ik_solverè´Ÿè´£å•ä½è½¬æ¢

---

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. é™ä½å»¶è¿Ÿ
- æé«˜filter_alpha (0.3 â†’ 0.5)
- å‡å°‘æ»¤æ³¢å†å²å¸§æ•°
- ä½¿ç”¨æœ‰çº¿ç½‘ç»œè¿æ¥VR

### 2. æé«˜å¹³æ»‘åº¦
- é™ä½filter_alpha (0.3 â†’ 0.2)
- å¯ç”¨é€Ÿåº¦é™åˆ¶
- é™ä½position_scale

### 3. æé«˜IKæˆåŠŸç‡
- ä½¿ç”¨æ›´å¥½çš„å‚è€ƒå…³èŠ‚ä½ç½®
- é™åˆ¶å·¥ä½œç©ºé—´èŒƒå›´
- å¢åŠ IKæ±‚è§£è¿­ä»£æ¬¡æ•°

### 4. é™ä½CPUå ç”¨
- é™ä½update_rate
- ç¦ç”¨ä¸å¿…è¦çš„æ—¥å¿—è¾“å‡º
- ä¼˜åŒ–TFæŸ¥è¯¢é¢‘ç‡