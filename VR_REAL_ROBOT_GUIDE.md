# VR é¥æ“ä½œçœŸæœºæ§åˆ¶æŒ‡å—

## ç›®æ ‡

ç”¨ PICO 4 VR æ‰‹æŸ„æ§åˆ¶çœŸå® JAKA ZU7 åŒè‡‚æœºå™¨äººï¼Œå®ç°ä½å»¶è¿Ÿã€é«˜ç²¾åº¦çš„é¥æ“ä½œæ§åˆ¶ã€‚

**æ§åˆ¶æ–¹å¼**: Clutch ç¦»åˆå™¨æ¨¡å¼
- **æŒ‰ä½ Grip é”®**: æœºæ¢°è‡‚è·Ÿéš VR æ‰‹æŸ„ç§»åŠ¨
- **æ¾å¼€ Grip é”®**: æœºæ¢°è‡‚ä¿æŒå½“å‰ä½ç½®

## âš ï¸ å®‰å…¨è­¦å‘Š

> **çœŸæœºæ“ä½œå‰è¯·åŠ¡å¿…ç¡®è®¤ï¼š**
> 1. æœºæ¢°è‡‚å·¥ä½œç©ºé—´å†…æ— äººå‘˜å’Œéšœç¢ç‰©
> 2. æ€¥åœæŒ‰é’®åœ¨æ‰‹è¾¹ï¼Œéšæ—¶å¯è§¦å‘
> 3. é¦–æ¬¡æµ‹è¯•ä½¿ç”¨ä½é€Ÿæ¨¡å¼
> 4. ç†Ÿæ‚‰æœºæ¢°è‡‚å·¥ä½œèŒƒå›´

---

## ç³»ç»Ÿæ¶æ„

```mermaid
flowchart TD
    subgraph VRç«¯
        PICO[PICO 4 VR å¤´æ˜¾] -->|UDP 9999| UDP[UDP å¹¿æ’­]
    end

    subgraph Jetson/å·¥æ§æœº
        UDP --> VRBridge[vr_bridge_node]
        VRBridge -->|/vr/*/pose\n/vr/*/joy| Clutch[vr_clutch_node]
        Clutch -->|/vr/*_target_pose| Teleop[teleoperation_controller]
        Teleop -->|/left_arm/joint_command\n/right_arm/joint_command| Bridge[jaka_bridge_node]
        Bridge -->|EtherCAT 125Hz| SDK[JAKA SDK]
        SDK --> Robot[åŒè‡‚æœºå™¨äºº]
        Robot -->|å…³èŠ‚åé¦ˆ| Bridge
        Bridge -->|/joint_states| Teleop
        Teleop --> Virtual[è™šæ‹Ÿè‡‚ RViz]
    end

    subgraph Webæ§åˆ¶å°
        Web[Web ç®¡ç†ç•Œé¢] -->|HTTP API| Backend[FastAPI åç«¯]
        Backend -->|ROS2| Teleop
    end
```

---

## æ•°æ®æµè¯¦è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           çœŸæœº VR é¥æ“ä½œæ•°æ®æµ                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚   PICO VR (90Hz)                                                                â”‚
â”‚        â”‚ UDP 9999                                                               â”‚
â”‚        â–¼                                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚   â”‚   vr_bridge_node    â”‚  åæ ‡å˜æ¢: VRâ†’ROS, æ¡æŒè¡¥å¿                           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚        â”‚ /vr/left_hand/pose, /vr/left_hand/joy                                 â”‚
â”‚        â”‚ /vr/right_hand/pose, /vr/right_hand/joy                               â”‚
â”‚        â–¼                                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚   â”‚   vr_clutch_node    â”‚  simulation_mode=false                               â”‚
â”‚   â”‚   Clutch ç¦»åˆå™¨æ§åˆ¶  â”‚  grip>0.8: æ¥åˆ, grip<0.2: é‡Šæ”¾                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚        â”‚ /vr/left_target_pose, /vr/right_target_pose                           â”‚
â”‚        â”‚ /vr/left_clutch_engaged, /vr/right_clutch_engaged                     â”‚
â”‚        â–¼                                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚   â”‚   qyh_teleoperation_controller          â”‚                                   â”‚
â”‚   â”‚   â”œâ”€ å·®åˆ†IK (Damped Least Squares)      â”‚                                   â”‚
â”‚   â”‚   â”œâ”€ è½¨è¿¹å¹³æ»‘ (é€Ÿåº¦/åŠ é€Ÿåº¦/jerké™å¹…)     â”‚                                   â”‚
â”‚   â”‚   â””â”€ å®‰å…¨æ£€æŸ¥ (å…³èŠ‚é™ä½/ç¢°æ’/å¥‡å¼‚ç‚¹)     â”‚                                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚        â”‚ /left_arm/joint_command (JointState, 125Hz)                           â”‚
â”‚        â”‚ /right_arm/joint_command (JointState, 125Hz)                          â”‚
â”‚        â–¼                                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚   â”‚  jaka_bridge_node   â”‚  è½¨è¿¹ç¼“å†² + çº¿æ€§æ’å€¼                                  â”‚
â”‚   â”‚  (125Hz EtherCAT)   â”‚                                                       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚        â”‚ edgServoJ (8ms å‘¨æœŸ)                                                   â”‚
â”‚        â–¼                                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚   â”‚    JAKA SDK         â”‚                                                       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚        â”‚                                                                        â”‚
â”‚        â–¼                                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚   â”‚  åŒè‡‚æœºå™¨äºº          â”‚  JAKA ZU7 Ã— 2                                        â”‚
â”‚   â”‚  (192.168.2.200)    â”‚                                                       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç¬¬ä¸€æ­¥ï¼šç¡¬ä»¶æ£€æŸ¥

### 1.1 è®¾å¤‡è¿æ¥ç¡®è®¤

| è®¾å¤‡ | è¿æ¥æ–¹å¼ | IP åœ°å€ | æ£€æŸ¥æ–¹æ³• |
|------|----------|---------|----------|
| JAKA åŒè‡‚ | EtherCAT | 192.168.2.200 | `ping 192.168.2.200` |
| Jetson | æœ‰çº¿ç½‘ç»œ | 192.168.2.x | - |
| PICO VR | WiFi (åŒä¸€å±€åŸŸç½‘) | DHCP | VR åº”ç”¨å†…æ˜¾ç¤º |

### 1.2 ç½‘ç»œè¿é€šæ€§æµ‹è¯•

```bash
# åœ¨ Jetson ä¸Šæµ‹è¯•
ping 192.168.2.200  # JAKA æœºå™¨äºº

# æ£€æŸ¥ UDP ç«¯å£æ˜¯å¦è¢«å ç”¨
sudo lsof -i :9999
```

---

## ç¬¬äºŒæ­¥ï¼šWeb æ§åˆ¶å°æ“ä½œ (æ¨è)

### 2.1 å¯åŠ¨ Web æœåŠ¡

```bash
# ç»ˆç«¯ 1: å¯åŠ¨åç«¯
cd ~/qyh_jushen_ws/qyh_jushen_web/backend
source venv/bin/activate
uvicorn app.main:app --host 0.0.0.0 --port 8000

# ç»ˆç«¯ 2: å¯åŠ¨å‰ç«¯
cd ~/qyh_jushen_ws/qyh_jushen_web/frontend
npm run dev -- --host
```

### 2.2 è®¿é—® Web ç•Œé¢

æµè§ˆå™¨æ‰“å¼€: `http://<Jetson_IP>:3000`

- ç”¨æˆ·å: `admin`
- å¯†ç : `admin123`

### 2.3 æœºæ¢°è‡‚ä¸Šç”µä¸ä½¿èƒ½ (Web ç•Œé¢æ“ä½œ)

> **é‡è¦**: å¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œï¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æœºæ¢°è‡‚æ§åˆ¶é¢æ¿                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1ï¸âƒ£ ç”µæºæ§åˆ¶                                                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚     â”‚  ä¸Š ç”µ   â”‚ â†  â”‚  ä¸‹ ç”µ   â”‚                               â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚     (ç‚¹å‡»"ä¸Šç”µ"æŒ‰é’®ï¼Œç­‰å¾…æœºæ¢°è‡‚ç”µæºç¯äº®)                          â”‚
â”‚                                                                 â”‚
â”‚  2ï¸âƒ£ ä½¿èƒ½æ§åˆ¶                                                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚     â”‚  ä½¿ èƒ½   â”‚ â†  â”‚ å»ä½¿èƒ½   â”‚                               â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚     (ç‚¹å‡»"ä½¿èƒ½"æŒ‰é’®ï¼Œæœºæ¢°è‡‚å¯ä»¥è¿åŠ¨)                              â”‚
â”‚                                                                 â”‚
â”‚  3ï¸âƒ£ ä¼ºæœæ¨¡å¼                                                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚     â”‚å¯åŠ¨ä¼ºæœ  â”‚ â†  â”‚åœæ­¢ä¼ºæœ  â”‚                               â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚     (å¯åŠ¨ä¼ºæœåï¼Œå¯ä»¥æ¥æ”¶ VR é¥æ“ä½œå‘½ä»¤)                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ“ä½œæ­¥éª¤**:

1. **ä¸Šç”µ**: ç‚¹å‡»"ä¸Šç”µ"æŒ‰é’®
   - ç­‰å¾…çŠ¶æ€å˜ä¸º"å·²ä¸Šç”µ" (ç»¿è‰²æŒ‡ç¤ºç¯)
   - çº¦éœ€ 3-5 ç§’

2. **ä½¿èƒ½**: ç‚¹å‡»"ä½¿èƒ½"æŒ‰é’®
   - ç­‰å¾…çŠ¶æ€å˜ä¸º"å·²ä½¿èƒ½"
   - æœºæ¢°è‡‚ä¼šæœ‰è½»å¾®éœ‡åŠ¨ï¼Œè¡¨ç¤ºå…³èŠ‚å·²é”å®š

3. **å¯åŠ¨ä¼ºæœ**: ç‚¹å‡»"å¯åŠ¨ä¼ºæœ"æŒ‰é’®
   - çŠ¶æ€æ˜¾ç¤º"è¿è¡Œä¸­"
   - æ˜¾ç¤ºä¼ºæœé¢‘ç‡ (çº¦ 125 Hz)

### 2.4 VR é¥æ“ä½œé¢æ¿

åˆ‡æ¢åˆ° "VR é¥æ“ä½œ" æ ‡ç­¾é¡µï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VR é¥æ“ä½œé¢æ¿                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  VR çŠ¶æ€: â— å·²è¿æ¥                                              â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚      å·¦ æ‰‹         â”‚    â”‚      å³ æ‰‹         â”‚              â”‚
â”‚  â”‚                    â”‚    â”‚                    â”‚              â”‚
â”‚  â”‚   ğŸ”“ CLUTCH OFF    â”‚    â”‚   ğŸ”’ CLUTCH ON     â”‚              â”‚
â”‚  â”‚                    â”‚    â”‚                    â”‚              â”‚
â”‚  â”‚   Grip: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 60% â”‚    â”‚   Grip: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 95% â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                 â”‚
â”‚  æ“ä½œæŒ‡å—:                                                      â”‚
â”‚  â€¢ æŒ‰ä½ Grip é”® (>80%) æ¥åˆ Clutch                              â”‚
â”‚  â€¢ æ¾å¼€ Grip é”® (<20%) é‡Šæ”¾ Clutch                              â”‚
â”‚  â€¢ Clutch æ¥åˆæ—¶æœºæ¢°è‡‚è·Ÿéš VR æ‰‹æŸ„ç§»åŠ¨                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç¬¬ä¸‰æ­¥ï¼šROS2 èŠ‚ç‚¹å¯åŠ¨

### 3.1 ä¸€é”®å¯åŠ¨è„šæœ¬

```bash
cd ~/qyh_jushen_ws/qyh_jushen_ws
./src/start_vr_real_robot.sh
```

### 3.2 æ‰‹åŠ¨åˆ†æ­¥å¯åŠ¨

å¦‚æœéœ€è¦è°ƒè¯•ï¼Œå¯ä»¥åˆ†æ­¥å¯åŠ¨ï¼š

#### ç»ˆç«¯ 1: MoveIt (ç”¨äº IK è®¡ç®—å’Œå¯è§†åŒ–)

```bash
cd ~/qyh_jushen_ws/qyh_jushen_ws
source /opt/ros/humble/setup.bash
source install/setup.bash
ros2 launch qyh_dual_arms_moveit_config move_group.launch.py
```

#### ç»ˆç«¯ 2: VR Bridge (æ¥æ”¶ VR æ•°æ®)

```bash
cd ~/qyh_jushen_ws/qyh_jushen_ws
source /opt/ros/humble/setup.bash
source install/setup.bash
ros2 run qyh_vr_bridge vr_bridge_node --ros-args -p grip_offset_deg:=35.0
```

#### ç»ˆç«¯ 3: VR Clutch (ç¦»åˆå™¨æ§åˆ¶, çœŸæœºæ¨¡å¼)

```bash
cd ~/qyh_jushen_ws/qyh_jushen_ws
source /opt/ros/humble/setup.bash
source install/setup.bash
ros2 launch qyh_vr_calibration vr_clutch.launch.py simulation_mode:=false
```

#### ç»ˆç«¯ 4: Teleoperation Controller (å·®åˆ† IK + å¹³æ»‘)

```bash
cd ~/qyh_jushen_ws/qyh_jushen_ws
source /opt/ros/humble/setup.bash
source install/setup.bash
ros2 launch qyh_teleoperation_controller teleoperation_controller.launch.py
```

#### ç»ˆç«¯ 5: JAKA Bridge (125Hz ä¼ºæœ)

```bash
cd ~/qyh_jushen_ws/qyh_jushen_ws
source /opt/ros/humble/setup.bash
source install/setup.bash
ros2 launch qyh_jaka_control jaka_bridge.launch.py robot_ip:=192.168.2.200
```

---

## ç¬¬å››æ­¥ï¼šå¼€å§‹é¥æ“ä½œ

### 4.1 å¯åŠ¨ VR åº”ç”¨

1. æˆ´ä¸Š PICO 4 å¤´æ˜¾
2. å¯åŠ¨ VR é¥æ“ä½œåº”ç”¨
3. ç¡®è®¤ Web ç•Œé¢æ˜¾ç¤º "VR å·²è¿æ¥"

### 4.2 æ“ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VR é¥æ“ä½œæµç¨‹                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. ç¡®è®¤æœºæ¢°è‡‚å·²ä½¿èƒ½ã€ä¼ºæœå·²å¯åŠ¨                                  â”‚
â”‚                                                                 â”‚
â”‚  2. å°† VR æ‰‹æŸ„ç§»åŠ¨åˆ°èˆ’é€‚ä½ç½®                                     â”‚
â”‚                                                                 â”‚
â”‚  3. æŒ‰ä½ Grip é”® (ä¾§é¢æ¡é”®)                                     â”‚
â”‚     â””â”€â†’ Web ç•Œé¢æ˜¾ç¤º "CLUTCH ON"                                â”‚
â”‚     â””â”€â†’ æœºæ¢°è‡‚å¼€å§‹è·Ÿéš VR æ‰‹æŸ„                                   â”‚
â”‚                                                                 â”‚
â”‚  4. ç§»åŠ¨æ‰‹æŸ„æ§åˆ¶æœºæ¢°è‡‚                                           â”‚
â”‚     â€¢ ä½ç½®: æ‰‹æŸ„ä½ç§» Ã— ç¼©æ”¾æ¯”ä¾‹ = æœ«ç«¯ä½ç§»                        â”‚
â”‚     â€¢ å§¿æ€: æ‰‹æŸ„æ—‹è½¬ = æœ«ç«¯æ—‹è½¬                                  â”‚
â”‚                                                                 â”‚
â”‚  5. æ¾å¼€ Grip é”®                                                â”‚
â”‚     â””â”€â†’ Web ç•Œé¢æ˜¾ç¤º "CLUTCH OFF"                               â”‚
â”‚     â””â”€â†’ æœºæ¢°è‡‚ä¿æŒå½“å‰ä½ç½®                                       â”‚
â”‚                                                                 â”‚
â”‚  6. é‡æ–°æŒ‰ä½ Grip â†’ ä»å½“å‰ä½ç½®ç»§ç»­è·Ÿéš                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å‚æ•°é…ç½®

### Clutch å‚æ•°

æ–‡ä»¶: `qyh_vr_calibration/config/vr_clutch_params.yaml`

```yaml
vr_clutch_node:
  ros__parameters:
    simulation_mode: false    # çœŸæœºæ¨¡å¼
    clutch:
      engage_threshold: 0.8   # grip > 0.8 æ¥åˆ
      release_threshold: 0.2  # grip < 0.2 é‡Šæ”¾
      position_scale: 1.5     # ä½ç½®ç¼©æ”¾ (æœºæ¢°è‡‚/äººè‡‚ çº¦1.5å€)
      rotation_scale: 1.0     # æ—‹è½¬ç¼©æ”¾
      max_position_delta: 0.02  # å•å¸§æœ€å¤§ä½ç§» (m)
      max_rotation_delta: 0.05  # å•å¸§æœ€å¤§æ—‹è½¬ (rad)
```

### Teleoperation Controller å‚æ•°

æ–‡ä»¶: `qyh_teleoperation_controller/config/teleoperation_params.yaml`

```yaml
teleoperation_node:
  ros__parameters:
    control_frequency: 125.0   # æ§åˆ¶é¢‘ç‡ (Hz)
    
    differential_ik:
      position_tolerance: 0.001   # ä½ç½®å®¹å·® (m)
      orientation_tolerance: 0.01 # å§¿æ€å®¹å·® (rad)
      damping_factor: 0.01        # é˜»å°¼ç³»æ•°
      
    trajectory_smoothing:
      max_velocity: 1.0           # æœ€å¤§é€Ÿåº¦ (rad/s)
      max_acceleration: 0.5       # æœ€å¤§åŠ é€Ÿåº¦ (rad/sÂ²)
      max_jerk: 5.0               # æœ€å¤§åŠ åŠ é€Ÿåº¦ (rad/sÂ³)
      low_pass_cutoff: 10.0       # ä½é€šæ»¤æ³¢æˆªæ­¢é¢‘ç‡ (Hz)
```

### JAKA Bridge å‚æ•°

æ–‡ä»¶: `qyh_jaka_control/config/jaka_bridge_params.yaml`

```yaml
jaka_bridge_node:
  ros__parameters:
    robot_ip: "192.168.2.200"
    servo_frequency: 125.0    # ä¼ºæœé¢‘ç‡ (Hz)
    buffer_size: 10           # è½¨è¿¹ç¼“å†²åŒºå¤§å°
    interpolation_weight: 0.5 # æ’å€¼æƒé‡ (0=çº¯ç¼“å†², 1=çº¯æœ€æ–°)
    auto_connect: true        # è‡ªåŠ¨è¿æ¥
```

---

## éªŒè¯æ•°æ®æµ

```bash
# VR åŸå§‹æ•°æ®
ros2 topic hz /vr/left_hand/pose     # åº”è¯¥ ~90Hz
ros2 topic echo /vr/left_hand/joy --once  # axes[3] æ˜¯ grip å€¼

# Clutch è¾“å‡º
ros2 topic echo /vr/left_clutch_engaged  # Bool: true/false
ros2 topic hz /vr/left_target_pose       # Clutch æ¥åˆæ—¶æœ‰è¾“å‡º

# Teleoperation è¾“å‡º
ros2 topic hz /left_arm/joint_command    # åº”è¯¥ ~125Hz

# JAKA Bridge è¾“å‡º
ros2 topic hz /joint_states              # åº”è¯¥ ~125Hz
```

---

## æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|------|
| VR è¾“å…¥é¢‘ç‡ | 90 Hz | PICO 4 åˆ·æ–°ç‡ |
| Clutch è¾“å‡ºé¢‘ç‡ | 90 Hz | è·Ÿéš VR |
| Teleoperation è¾“å‡º | 125 Hz | åŒ¹é… JAKA ä¼ºæœ |
| JAKA ä¼ºæœé¢‘ç‡ | 125 Hz | EtherCAT å‘¨æœŸ 8ms |
| ç«¯åˆ°ç«¯å»¶è¿Ÿ | < 50 ms | VR â†’ æœºå™¨äººå“åº” |

---

## ç´§æ€¥æƒ…å†µå¤„ç†

### æ€¥åœ

1. **ç‰©ç†æ€¥åœ**: æŒ‰ä¸‹æ€¥åœæŒ‰é’®
2. **è½¯æ€¥åœ**: Web ç•Œé¢ç‚¹å‡»"åœæ­¢ä¼ºæœ"
3. **ç»ˆç«¯**: `Ctrl+C` åœæ­¢æ‰€æœ‰èŠ‚ç‚¹

### é”™è¯¯æ¢å¤

```bash
# Web ç•Œé¢æ“ä½œ
1. ç‚¹å‡» "åœæ­¢ä¼ºæœ"
2. ç‚¹å‡» "å»ä½¿èƒ½"
3. æ£€æŸ¥å¹¶æ¸…é™¤é”™è¯¯
4. é‡æ–° "ä½¿èƒ½" â†’ "å¯åŠ¨ä¼ºæœ"

# æˆ–ä½¿ç”¨ ROS2 æœåŠ¡
ros2 service call /jaka/bridge/stop_servo std_srvs/srv/Trigger
ros2 service call /jaka/robot/clear_error std_srvs/srv/Trigger
```

---

## å¸¸è§é—®é¢˜

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|
| æœºæ¢°è‡‚ä¸åŠ¨ | ä¼ºæœæœªå¯åŠ¨ | Web ç•Œé¢ç‚¹å‡»"å¯åŠ¨ä¼ºæœ" |
| æœºæ¢°è‡‚æŠ–åŠ¨ | å¹³æ»‘å‚æ•°è¿‡å° | å¢å¤§ `max_jerk` æˆ– `low_pass_cutoff` |
| ä½ç½®è·³å˜æŠ¥é”™ | é€Ÿåº¦é™åˆ¶è¿‡å¤§ | å‡å° `max_velocity` |
| å»¶è¿Ÿå¤§ | ç¼“å†²åŒºè¿‡å¤§ | å‡å° `buffer_size` |
| Grip æ— å“åº” | VR æ•°æ®æœªåˆ°è¾¾ | æ£€æŸ¥ç½‘ç»œå’Œ UDP ç«¯å£ |
| IK å¤±è´¥ | ç›®æ ‡è¶…å‡ºå·¥ä½œç©ºé—´ | æ£€æŸ¥ Clutch çš„ `max_position_delta` |

---

## å¯¹æ¯”ï¼šä»¿çœŸ vs çœŸæœº

| é¡¹ç›® | ä»¿çœŸ | çœŸæœº |
|------|------|------|
| IK æ±‚è§£ | MoveIt `/compute_ik` (~30Hz) | å·®åˆ† IK (125Hz) |
| è¾“å‡º | `/joint_states` â†’ RViz | `/left_arm/joint_command` â†’ JAKA |
| è½¨è¿¹å¹³æ»‘ | æ—  | ä¸‰çº§é™å¹… + ä½é€šæ»¤æ³¢ |
| å®‰å…¨æ£€æŸ¥ | MoveIt å†…éƒ¨ | ç‹¬ç«‹å®‰å…¨æ£€æŸ¥æ¨¡å— |
| vr_clutch | `simulation_mode=true` | `simulation_mode=false` |
| æ§åˆ¶é¢‘ç‡ | ~30Hz | 125Hz |

---

## ä¸‹ä¸€æ­¥

- [ ] è°ƒè¯•å·®åˆ† IK å‚æ•°
- [ ] ä¼˜åŒ–è½¨è¿¹å¹³æ»‘å™¨
- [ ] é›†æˆå¤¹çˆªæ§åˆ¶
- [ ] æ·»åŠ åŠ›åé¦ˆ
- [ ] æ•°æ®å½•åˆ¶åŠŸèƒ½
